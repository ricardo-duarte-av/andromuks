const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DG_IYqWk.js","./matrix-sdk-crypto-wasm-DMhr4gdY.js","./polyfill-force-C-cqkbSt.js","./index-BHYrFcE-.js","./polyfill-force-C5_YvYDd.js"])))=>i.map(i=>d[i]);
try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new t.Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="a83948f9-fc71-47d1-aec2-9884b4c9319a",t._sentryDebugIdIdentifier="sentry-dbid-a83948f9-fc71-47d1-aec2-9884b4c9319a")}catch{}function Wge(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"embedded-v0.16.3"}}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Sat=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Eat(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var yk={exports:{}},f1={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wF;function Yge(){if(wF)return f1;wF=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var a in i)a!=="key"&&(s[a]=i[a])}else s=i;return i=s.ref,{$$typeof:t,type:r,key:o,ref:i!==void 0?i:null,props:s}}return f1.Fragment=e,f1.jsx=n,f1.jsxs=n,f1}var CF;function Xge(){return CF||(CF=1,yk.exports=Yge()),yk.exports}var E=Xge();function TF(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(l){return void n(l)}a.done?e(c):Promise.resolve(c).then(r,i)}function B(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(c){TF(s,r,i,o,a,"next",c)}function a(c){TF(s,r,i,o,a,"throw",c)}o(void 0)})}}function ob(t){"@babel/helpers - typeof";return ob=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ob(t)}function Jge(t,e){if(ob(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(ob(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Qge(t){var e=Jge(t,"string");return ob(e)=="symbol"?e:e+""}function L(t,e,n){return(e=Qge(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const Zge="l",eve="rn",tve={0:"O",1:"l","֭":"֖","֮":"֘","֨":"֙","֤":"֚","᪴":"ۛ","⃛":"ۛ","ؙ":"̓","ࣳ":"̓","̓":"̓","̕":"̓","ُ":"̓","ٝ":"̔","֜":"́","֝":"́","ؘ":"́","݇":"́","́":"́","॔":"́","َ":"́","̀":"̀","॓":"̀","̌":"̆","꙼":"̆","٘":"̆","ٚ":"̆","ͮ":"̆","ۨ":"̆̇","̐":"̆̇","ँ":"̆̇","ঁ":"̆̇","ઁ":"̆̇","ଁ":"̆̇","ఀ":"̆̇","ಁ":"̆̇","ഁ":"̆̇","𑒿":"̆̇","᳐":"̂","̑":"̂","ٛ":"̂","߮":"̂","꛰":"̂","֯":"̊","۟":"̊","៓":"̊","゚":"̊","ْ":"̊","ஂ":"̊","ံ":"̊","ំ":"̊","𑌀":"̊","ํ":"̊","ໍ":"̊","ͦ":"̊","ⷪ":"̊","࣫":"̈","߳":"̈","ً":"̋","ࣰ":"̋","͂":"̃","ٓ":"̃","ׄ":"̇","۬":"̇","݀":"̇","࣪":"̇","݁":"̇","͘":"̇","ֹ":"̇","ֺ":"̇","ׂ":"̇","ׁ":"̇","߭":"̇","ं":"̇","ਂ":"̇","ં":"̇","்":"̇","̷":"̸","᪷":"̨","̢":"̨","ͅ":"̨","᳒":"̄","̅":"̄","ٙ":"̄","߫":"̄","꛱":"̄","᳚":"̎","ٗ":"̒","͗":"͐","ࣿ":"͐","ࣸ":"͐","ऀ":"͒","᳭":"̖","᳜":"̩","ٖ":"̩","᳕":"̫","͇":"̳","ࣹ":"͔","ࣺ":"͕","゛":"ﾞ","゜":"ﾟ","̶":"̵","〬":"̉","ׅ":"̣","࣭":"̣","᳝":"̣","ִ":"̣","ٜ":"̣","़":"̣","়":"̣","਼":"̣","઼":"̣","଼":"̣","𑇊":"̣","𑓃":"̣","𐨺":"̣","࣮":"̤","᳞":"̤","༷":"̥","〭":"̥","̧":"̦","̡":"̦","̹":"̦","᳙":"̭","᳘":"̮","॒":"̱","̠":"̱","ࣱ":"ٌ","ࣨ":"ٌ","ࣥ":"ٌ",ﱞ:"ﹲّ","ࣲ":"ٍ",ﱟ:"ﹴّ",ﳲ:"ﹷّ",ﱠ:"ﹶّ",ﳳ:"ﹹّ",ﱡ:"ﹸّ","ؚ":"ِ","̗":"ِ",ﳴ:"ﹻّ",ﱢ:"ﹺّ",ﱣ:"ﹼٰ","ٟ":"ٕ","̍":"ٰ","݂":"ܼ","ਃ":"ঃ","ః":"ঃ","ಃ":"ঃ","ഃ":"ঃ","ඃ":"ঃ","း":"ঃ","𑓁":"ঃ","់":"่","່":"่","້":"้","໊":"๊","໋":"๋","꙯":"⃩","\u2028":" ","\u2029":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" ","ߺ":"_","﹍":"_","﹎":"_","﹏":"_","‐":"-","‑":"-","‒":"-","–":"-","﹘":"-","۔":"-","⁃":"-","˗":"-","−":"-","➖":"-","Ⲻ":"-","⨩":"-̓","⸚":"-̈","﬩":"-̇","∸":"-̇","⨪":"-̣","꓾":"-.","～":"〜","؍":",","٫":",","‚":",","¸":",","ꓹ":",","⸲":"،","٬":"،",";":";","⸵":"؛","ः":":","ઃ":":","：":":","։":":","܃":":","܄":":","᛬":":","︰":":","᠃":":","᠉":":","⁚":":","׃":":","˸":":","꞉":":","∶":":",ː:":","ꓽ":":","⩴":"::=","⧴":":→","！":"!",ǃ:"!","ⵑ":"!","‼":"!!","⁉":"!?",ʔ:"?","Ɂ":"?","ॽ":"?",Ꭾ:"?","ꛫ":"?","⁈":"?!","⁇":"??","⸮":"؟","𝅭":".","․":".","܁":".","܂":".","꘎":".","𐩐":".","٠":".","۰":".","ꓸ":".","ꓻ":".,","‥":"..","ꓺ":"..","…":"...","꛴":"꛳꛳","・":"·","･":"·","᛫":"·","·":"·","⸱":"·","𐄁":"·","•":"·","‧":"·","∙":"·","⋅":"·","ꞏ":"·",ᐧ:"·","⋯":"···","ⵈ":"···",ᑄ:"·<","⋗":"·>",ᐷ:"·>",ᑀ:"·>",ᔯ:"·4",ᑾ:"·b",ᒀ:"·ḃ",ᑺ:"·d",ᒘ:"·J",ᒶ:"·L",ᑶ:"·P",ᑗ:"·U",ᐺ:"·V",ᐼ:"·Ʌ",ᒮ:"·Γ",ᐎ:"·Δ",ᑙ:"·Ո",ᐌ:"·ᐁ",ᐐ:"·ᐄ",ᐒ:"·ᐅ",ᐔ:"·ᐆ",ᐗ:"·ᐊ",ᐙ:"·ᐋ",ᐾ:"·ᐲ",ᑂ:"·ᐴ",ᑆ:"·ᐹ",ᑛ:"·ᑏ",ᑔ:"·ᑐ",ᑝ:"·ᑐ",ᑟ:"·ᑑ",ᑡ:"·ᑕ",ᑣ:"·ᑖ",ᑴ:"·ᑫ",ᑸ:"·ᑮ",ᑼ:"·ᑰ",ᒒ:"·ᒉ",ᒔ:"·ᒋ",ᒖ:"·ᒌ",ᒚ:"·ᒎ",ᒜ:"·ᒐ",ᒞ:"·ᒑ",ᒬ:"·ᒣ",ᒰ:"·ᒦ",ᒲ:"·ᒧ",ᒴ:"·ᒨ",ᒸ:"·ᒫ",ᓉ:"·ᓀ","ᣆ":"·ᓂ","ᣈ":"·ᓃ","ᣊ":"·ᓄ","ᣌ":"·ᓅ",ᓋ:"·ᓇ",ᓍ:"·ᓈ",ᓜ:"·ᓓ",ᓞ:"·ᓕ",ᓠ:"·ᓖ",ᓢ:"·ᓗ",ᓤ:"·ᓘ",ᓦ:"·ᓚ",ᓨ:"·ᓛ",ᓶ:"·ᓭ",ᓸ:"·ᓯ",ᓺ:"·ᓰ",ᓼ:"·ᓱ",ᓾ:"·ᓲ",ᔀ:"·ᓴ",ᔂ:"·ᓵ",ᔗ:"·ᔐ",ᔙ:"·ᔑ",ᔛ:"·ᔒ",ᔝ:"·ᔓ",ᔟ:"·ᔔ",ᔡ:"·ᔕ",ᔣ:"·ᔖ",ᔱ:"·ᔨ",ᔳ:"·ᔩ",ᔵ:"·ᔪ",ᔷ:"·ᔫ",ᔹ:"·ᔭ",ᔻ:"·ᔮ","ᣎ":"·ᕃ","ᣏ":"·ᕆ","ᣐ":"·ᕇ","ᣑ":"·ᕈ","ᣒ":"·ᕉ","ᣓ":"·ᕋ",ᕎ:"·ᕌ",ᕛ:"·ᕚ",ᕨ:"·ᕧ","ᢳ":"·ᢱ","ᢶ":"·ᢴ","ᢹ":"·ᢸ","ᣂ":"·ᣀ","꠰":"।","॥":"।।","᰼":"᰻᰻","။":"၊၊","᪩":"᪨᪨","᪫":"᪪᪨","᭟":"᭞᭞","𐩗":"𐩖𐩖","𑑌":"𑑋𑑋","𑙂":"𑙁𑙁","𑱂":"𑱁𑱁","᱿":"᱾᱾","՝":"'","＇":"'","‘":"'","’":"'","‛":"'","′":"'","‵":"'","՚":"'","׳":"'","`":"'","`":"'","｀":"'","´":"'","΄":"'","´":"'","᾽":"'","᾿":"'","῾":"'","ʹ":"'","ʹ":"'","ˈ":"'","ˊ":"'","ˋ":"'","˴":"'",ʻ:"'",ʽ:"'",ʼ:"'",ʾ:"'","ꞌ":"'",י:"'","ߴ":"'","ߵ":"'",ᑊ:"'",ᛌ:"'","𖽑":"'","𖽒":"'","᳓":"''",'"':"''","＂":"''","“":"''","”":"''","‟":"''","″":"''","‶":"''","〃":"''","״":"''","˝":"''","ʺ":"''","˶":"''",ˮ:"''",ײ:"''","‴":"'''","‷":"'''","⁗":"''''",Ɓ:"'B",Ɗ:"'D",ŉ:"'n",Ƥ:"'P",Ƭ:"'T",Ƴ:"'Y","［":"(","❨":"(","❲":"(","〔":"(","﴾":"(","⸨":"((","㈠":"(ー)","⑵":"(2)","⒇":"(2O)","⑶":"(3)","⑷":"(4)","⑸":"(5)","⑹":"(6)","⑺":"(7)","⑻":"(8)","⑼":"(9)","⒜":"(a)","🄐":"(A)","⒝":"(b)","🄑":"(B)","⒞":"(c)","🄒":"(C)","⒟":"(d)","🄓":"(D)","⒠":"(e)","🄔":"(E)","⒡":"(f)","🄕":"(F)","⒢":"(g)","🄖":"(G)","⒣":"(h)","🄗":"(H)","⒤":"(i)","⒥":"(j)","🄙":"(J)","⒦":"(k)","🄚":"(K)","⑴":"(l)","🄘":"(l)","⒧":"(l)","🄛":"(L)","⑿":"(l2)","⒀":"(l3)","⒁":"(l4)","⒂":"(l5)","⒃":"(l6)","⒄":"(l7)","⒅":"(l8)","⒆":"(l9)","⑾":"(ll)","⑽":"(lO)","🄜":"(M)","⒩":"(n)","🄝":"(N)","⒪":"(o)","🄞":"(O)","⒫":"(p)","🄟":"(P)","⒬":"(q)","🄠":"(Q)","⒭":"(r)","🄡":"(R)","⒨":"(rn)","⒮":"(s)","🄢":"(S)","🄪":"(S)","⒯":"(t)","🄣":"(T)","⒰":"(u)","🄤":"(U)","⒱":"(v)","🄥":"(V)","⒲":"(w)","🄦":"(W)","⒳":"(x)","🄧":"(X)","⒴":"(y)","🄨":"(Y)","⒵":"(z)","🄩":"(Z)","㈀":"(ᄀ)","㈎":"(가)","㈁":"(ᄂ)","㈏":"(나)","㈂":"(ᄃ)","㈐":"(다)","㈃":"(ᄅ)","㈑":"(라)","㈄":"(ᄆ)","㈒":"(마)","㈅":"(ᄇ)","㈓":"(바)","㈆":"(ᄉ)","㈔":"(사)","㈇":"(ᄋ)","㈕":"(아)","㈝":"(오전)","㈞":"(오후)","㈈":"(ᄌ)","㈖":"(자)","㈜":"(주)","㈉":"(ᄎ)","㈗":"(차)","㈊":"(ᄏ)","㈘":"(카)","㈋":"(ᄐ)","㈙":"(타)","㈌":"(ᄑ)","㈚":"(파)","㈍":"(ᄒ)","㈛":"(하)","㈦":"(七)","㈢":"(三)","🉁":"(三)","㈨":"(九)","㈡":"(二)","🉂":"(二)","㈤":"(五)","㈹":"(代)","㈽":"(企)","㉁":"(休)","㈧":"(八)","㈥":"(六)","㈸":"(労)","🉇":"(勝)","㈩":"(十)","㈿":"(協)","㈴":"(名)","㈺":"(呼)","㈣":"(四)","㈯":"(土)","㈻":"(学)","🉃":"(安)","🉅":"(打)","🉈":"(敗)","㈰":"(日)","㈪":"(月)","㈲":"(有)","㈭":"(木)","🉀":"(本)","㈱":"(株)","㈬":"(水)","㈫":"(火)","🉄":"(点)","㈵":"(特)","🉆":"(盗)","㈼":"(監)","㈳":"(社)","㈷":"(祝)","㉀":"(祭)","㉂":"(自)","㉃":"(至)","㈶":"(財)","㈾":"(資)","㈮":"(金)","］":")","❩":")","❳":")","〕":")","﴿":")","⸩":"))","❴":"{","𝄔":"{","❵":"}","〚":"⟦","〛":"⟧","⟨":"❬","〈":"❬","〈":"❬","㇛":"❬",く:"❬","𡿨":"❬","⟩":"❭","〉":"❭","〉":"❭","＾":"︿","⸿":"¶","⁎":"*","٭":"*","∗":"*","𐌟":"*","᜵":"/","⁁":"/","∕":"/","⁄":"/","╱":"/","⟋":"/","⧸":"/","𝈺":"/","㇓":"/",〳:"/","Ⳇ":"/",ノ:"/",丿:"/","⼃":"/","⧶":"/̄","⫽":"//","⫻":"///","＼":"\\","﹨":"\\","∖":"\\","⟍":"\\","⧵":"\\","⧹":"\\","𝈏":"\\","𝈻":"\\","㇔":"\\",丶:"\\","⼂":"\\","⳹":"\\\\","⑊":"\\\\","⟈":"\\ᑕ","ꝸ":"&","૰":"॰","𑂻":"॰","𑇇":"॰","⚬":"॰","𑇛":"꣼","៙":"๏","៕":"๚","៚":"๛","༌":"་","༎":"།།","˄":"^","ˆ":"^","꙾":"ˇ","˘":"ˇ","‾":"ˉ","﹉":"ˉ","﹊":"ˉ","﹋":"ˉ","﹌":"ˉ","¯":"ˉ","￣":"ˉ","▔":"ˉ",ъ:"ˉb","ꙑ":"ˉbi","͵":"ˏ","˻":"˪","꜖":"˪","꜔":"˫","。":"˳","⸰":"°","˚":"°","∘":"°","○":"°","◦":"°","⍜":"°̲","⍤":"°̈","℃":"°C","℉":"°F","௵":"௳","༛":"༚༚","༟":"༚༝","࿎":"༝༚","༞":"༝༝","Ⓒ":"©","Ⓡ":"®","Ⓟ":"℗","𝈛":"⅄","⯬":"↞","⯭":"↟","⯮":"↠","⯯":"↡","↵":"↲","⥥":"⇃⇂","⥯":"⇃ᛚ","𝛛":"∂","𝜕":"∂","𝝏":"∂","𝞉":"∂","𝟃":"∂","𞣌":"∂","𞣍":"∂̵",ð:"∂̵","⌀":"∅","𝛁":"∇","𝛻":"∇","𝜵":"∇","𝝯":"∇","𝞩":"∇","𑢨":"∇","⍢":"∇̈","⍫":"∇̴","█":"∎","■":"∎","⨿":"∐","᛭":"+","➕":"+","𐊛":"+","⨣":"+̂","⨢":"+̊","⨤":"+̃","∔":"+̇","⨥":"+̣","⨦":"+̰","⨧":"+₂","➗":"÷","‹":"<","❮":"<","˂":"<","𝈶":"<",ᐸ:"<",ᚲ:"<","⋖":"<·","Ⲵ":"<·",ᑅ:"<·","≪":"<<","⋘":"<<<","᐀":"=","⹀":"=","゠":"=","꓿":"=","≚":"=̆","≙":"=̂","≗":"=̊","≐":"=̇","≑":"=̣̇","⩮":"=⃰","⩵":"==","⩶":"===","≞":"=ͫ","›":">","❯":">","˃":">","𝈷":">",ᐳ:">","𖼿":">",ᑁ:">·","⪥":"><","≫":">>","⨠":">>","⋙":">>>","⁓":"~","˜":"~","῀":"~","∼":"~","⍨":"~̈","⸞":"~̇","⩪":"~̇","⸟":"~̣","𞣈":"∠","⋀":"∧","∯":"∮∮","∰":"∮∮∮","⸫":"∴","⸪":"∵","⸬":"∷","𑇞":"≈","♎":"≏","🝞":"≏","≣":"≡","⨃":"⊍","⨄":"⊎","𝈸":"⊏","𝈹":"⊐","⨅":"⊓","⨆":"⊔","⨂":"⊗","⍟":"⊛","🝱":"⊠","🝕":"⊡","◁":"⊲","▷":"⊳","⍣":"⋆̈","︴":"⌇","◠":"⌒","⨽":"⌙","⌥":"⌤","⧇":"⌻","◎":"⌾","⦾":"⌾","⧅":"⍂","⦰":"⍉","⏃":"⍋","⏂":"⍎","⏁":"⍕","⏆":"⍭","☸":"⎈","︵":"⏜","︶":"⏝","︷":"⏞","︸":"⏟","︹":"⏠","︺":"⏡","▱":"⏥","⏼":"⏻","︱":"│","｜":"│","┃":"│","┏":"┌","┣":"├","▐":"▌","▗":"▖","▝":"▘","☐":"□","￭":"▪","▸":"▶","►":"▶","⳩":"☧","🜊":"☩","🌒":"☽","🌙":"☽","⏾":"☾","🌘":"☾","⧙":"⦚","🜺":"⧟","⨾":"⨟","𐆠":"⳨","♩":"𝅘𝅥","♪":"𝅘𝅥𝅮","⓪":"🄍","↺":"🄎","˙":"ॱ","ൎ":"ॱ","－":"ー","—":"ー","―":"ー","─":"ー","━":"ー","㇐":"ー","ꟷ":"ー",ᅳ:"ー",ㅡ:"ー",一:"ー","⼀":"ー",ᆖ:"ーー","ힹ":"ーᅡ","ힺ":"ーᅥ","ힻ":"ーᅥ丨","ힼ":"ーᅩ",ᆕ:"ーᅮ",ᅴ:"ー丨",ㅢ:"ー丨",ᆗ:"ー丨ᅮ","🄏":"$⃠","₤":"£","〒":"₸","〶":"₸","᭜":"᭐","꧆":"꧐","𑓑":"১","೧":"౧","ၥ":"၁","①":"➀","⑩":"➉","⏨":"₁₀","𝟐":"2","𝟚":"2","𝟤":"2","𝟮":"2","𝟸":"2","🯲":"2","Ꝛ":"2",Ƨ:"2",Ϩ:"2","Ꙅ":"2",ᒿ:"2","ꛯ":"2","ꧏ":"٢","۲":"٢","૨":"२","𑓒":"২","೨":"౨","②":"➁",ƻ:"2̵","🄃":"2,","⒉":"2.","㏵":"22日","㍮":"22点","㏶":"23日","㍯":"23点","㏷":"24日","㍰":"24点","㏸":"25日","㏹":"26日","㏺":"27日","㏻":"28日","㏼":"29日","㏴":"2l日","㍭":"2l点","⒛":"2O.","㏳":"2O日","㍬":"2O点","෩":"෨ා","෯":"෨ී","㏡":"2日","㋁":"2月","㍚":"2点","𝈆":"3","𝟑":"3","𝟛":"3","𝟥":"3","𝟯":"3","𝟹":"3","🯳":"3","Ɜ":"3",Ȝ:"3",Ʒ:"3","Ꝫ":"3","Ⳍ":"3",З:"3",Ӡ:"3","𖼻":"3","𑣊":"3","۳":"٣","𞣉":"٣","૩":"३","③":"➂",Ҙ:"3̦","🄄":"3,","⒊":"3.","㏾":"3l日","㏽":"3O日","㏢":"3日","㋂":"3月","㍛":"3点","𝟒":"4","𝟜":"4","𝟦":"4","𝟰":"4","𝟺":"4","🯴":"4",Ꮞ:"4","𑢯":"4","۴":"٤","૪":"४","④":"➃","🄅":"4,","⒋":"4.",ᔰ:"4·","㏣":"4日","㋃":"4月","㍜":"4点","𝟓":"5","𝟝":"5","𝟧":"5","𝟱":"5","𝟻":"5","🯵":"5",Ƽ:"5","𑢻":"5","⑤":"➄","🄆":"5,","⒌":"5.","㏤":"5日","㋄":"5月","㍝":"5点","𝟔":"6","𝟞":"6","𝟨":"6","𝟲":"6","𝟼":"6","🯶":"6","Ⳓ":"6",б:"6",Ꮾ:"6","𑣕":"6","۶":"٦","𑓖":"৬","⑥":"➅","🄇":"6,","⒍":"6.","㏥":"6日","㋅":"6月","㍞":"6点","𝈒":"7","𝟕":"7","𝟟":"7","𝟩":"7","𝟳":"7","𝟽":"7","🯷":"7","𐓒":"7","𑣆":"7","⑦":"➆","🄈":"7,","⒎":"7.","㏦":"7日","㋆":"7月","㍟":"7点","ଃ":"8","৪":"8","੪":"8","𞣋":"8","𝟖":"8","𝟠":"8","𝟪":"8","𝟴":"8","𝟾":"8","🯸":"8",ȣ:"8",Ȣ:"8","𐌚":"8","૮":"८","⑧":"➇","🄉":"8,","⒏":"8.","㏧":"8日","㋇":"8月","㍠":"8点","੧":"9","୨":"9","৭":"9","൭":"9","𝟗":"9","𝟡":"9","𝟫":"9","𝟵":"9","𝟿":"9","🯹":"9","Ꝯ":"9","Ⳋ":"9","𑣌":"9","𑢬":"9","𑣖":"9","१":"٩","𑣤":"٩","۹":"٩","೯":"౯","⑨":"➈","🄊":"9,","⒐":"9.","㏨":"9日","㋈":"9月","㍡":"9点","⍺":"a",ａ:"a","𝐚":"a","𝑎":"a","𝒂":"a","𝒶":"a","𝓪":"a","𝔞":"a","𝕒":"a","𝖆":"a","𝖺":"a","𝗮":"a","𝘢":"a","𝙖":"a","𝚊":"a",ɑ:"a",α:"a","𝛂":"a","𝛼":"a","𝜶":"a","𝝰":"a","𝞪":"a",а:"a","ⷶ":"ͣ",Ａ:"A","𝐀":"A","𝐴":"A","𝑨":"A","𝒜":"A","𝓐":"A","𝔄":"A","𝔸":"A","𝕬":"A","𝖠":"A","𝗔":"A","𝘈":"A","𝘼":"A","𝙰":"A",Α:"A","𝚨":"A","𝛢":"A","𝜜":"A","𝝖":"A","𝞐":"A",А:"A",Ꭺ:"A",ᗅ:"A","ꓮ":"A","𖽀":"A","𐊠":"A","⍶":"a̲",ǎ:"ă",Ǎ:"Ă",ȧ:"å",Ȧ:"Å",ẚ:"ả","℀":"a/c","℁":"a/s","ꜳ":"aa","Ꜳ":"AA",æ:"ae",ӕ:"ae",Æ:"AE",Ӕ:"AE","ꜵ":"ao","Ꜵ":"AO","🜇":"AR","ꜷ":"au","Ꜷ":"AU","ꜹ":"av","ꜻ":"av","Ꜹ":"AV","Ꜻ":"AV","ꜽ":"ay","Ꜽ":"AY","ꭺ":"ᴀ","∀":"Ɐ","𝈗":"Ɐ",ᗄ:"Ɐ","ꓯ":"Ɐ","𐐟":"Ɒ","𝐛":"b","𝑏":"b","𝒃":"b","𝒷":"b","𝓫":"b","𝔟":"b","𝕓":"b","𝖇":"b","𝖻":"b","𝗯":"b","𝘣":"b","𝙗":"b","𝚋":"b",Ƅ:"b",Ь:"b",Ꮟ:"b",ᑲ:"b",ᖯ:"b",Ｂ:"B",ℬ:"B","𝐁":"B","𝐵":"B","𝑩":"B","𝓑":"B","𝔅":"B","𝔹":"B","𝕭":"B","𝖡":"B","𝗕":"B","𝘉":"B","𝘽":"B","𝙱":"B","Ꞵ":"B",Β:"B","𝚩":"B","𝛣":"B","𝜝":"B","𝝗":"B","𝞑":"B",В:"B",Ᏼ:"B",ᗷ:"B","ꓐ":"B","𐊂":"B","𐊡":"B","𐌁":"B",ɓ:"b̔",ᑳ:"ḃ",ƃ:"b̄",Ƃ:"b̄",Б:"b̄",ƀ:"b̵",ҍ:"b̵",Ҍ:"b̵",ѣ:"b̵",Ѣ:"b̵",ᑿ:"b·",ᒁ:"ḃ·",ᒈ:"b'",Ы:"bl",в:"ʙ","ᏼ":"ʙ",ｃ:"c","ⅽ":"c","𝐜":"c","𝑐":"c","𝒄":"c","𝒸":"c","𝓬":"c","𝔠":"c","𝕔":"c","𝖈":"c","𝖼":"c","𝗰":"c","𝘤":"c","𝙘":"c","𝚌":"c","ᴄ":"c",ϲ:"c","ⲥ":"c",с:"c","ꮯ":"c","𐐽":"c","ⷭ":"ͨ","🝌":"C","𑣲":"C","𑣩":"C",Ｃ:"C","Ⅽ":"C",ℂ:"C",ℭ:"C","𝐂":"C","𝐶":"C","𝑪":"C","𝒞":"C","𝓒":"C","𝕮":"C","𝖢":"C","𝗖":"C","𝘊":"C","𝘾":"C","𝙲":"C","Ϲ":"C","Ⲥ":"C",С:"C",Ꮯ:"C","ꓚ":"C","𐊢":"C","𐌂":"C","𐐕":"C","𐔜":"C","¢":"c̸","ȼ":"c̸","₡":"C⃫","🅮":"C⃠",ç:"c̦",ҫ:"c̦",Ç:"C̦",Ҫ:"C̦",Ƈ:"C'","℅":"c/o","℆":"c/u","🅭":"㏄	⃝","⋴":"ꞓ",ɛ:"ꞓ",ε:"ꞓ","ϵ":"ꞓ","𝛆":"ꞓ","𝛜":"ꞓ","𝜀":"ꞓ","𝜖":"ꞓ","𝜺":"ꞓ","𝝐":"ꞓ","𝝴":"ꞓ","𝞊":"ꞓ","𝞮":"ꞓ","𝟄":"ꞓ","ⲉ":"ꞓ",є:"ꞓ","ԑ":"ꞓ","ꮛ":"ꞓ","𑣎":"ꞓ","𐐩":"ꞓ","€":"Ꞓ","Ⲉ":"Ꞓ",Є:"Ꞓ","⍷":"ꞓ̲","ͽ":"ꜿ","Ͽ":"Ꜿ","ⅾ":"d","ⅆ":"d","𝐝":"d","𝑑":"d","𝒅":"d","𝒹":"d","𝓭":"d","𝔡":"d","𝕕":"d","𝖉":"d","𝖽":"d","𝗱":"d","𝘥":"d","𝙙":"d","𝚍":"d","ԁ":"d",Ꮷ:"d",ᑯ:"d","ꓒ":"d","Ⅾ":"D","ⅅ":"D","𝐃":"D","𝐷":"D","𝑫":"D","𝒟":"D","𝓓":"D","𝔇":"D","𝔻":"D","𝕯":"D","𝖣":"D","𝗗":"D","𝘋":"D","𝘿":"D","𝙳":"D",Ꭰ:"D",ᗞ:"D",ᗪ:"D","ꓓ":"D",ɗ:"d̔",ɖ:"d̨",ƌ:"d̄",đ:"d̵",Đ:"D̵",Ð:"D̵",Ɖ:"D̵","₫":"ḏ̵","ꝺ":"Ꝺ",ᑻ:"d·",ᒇ:"d'",ʤ:"dȝ",ǳ:"dz",ʣ:"dz",ǲ:"Dz",Ǳ:"DZ",ǆ:"dž",ǅ:"Dž",Ǆ:"DŽ",ʥ:"dʑ","ꭰ":"ᴅ","⸹":"ẟ",δ:"ẟ","𝛅":"ẟ","𝛿":"ẟ","𝜹":"ẟ","𝝳":"ẟ","𝞭":"ẟ",ծ:"ẟ",ᕷ:"ẟ","℮":"e",ｅ:"e",ℯ:"e","ⅇ":"e","𝐞":"e","𝑒":"e","𝒆":"e","𝓮":"e","𝔢":"e","𝕖":"e","𝖊":"e","𝖾":"e","𝗲":"e","𝘦":"e","𝙚":"e","𝚎":"e","ꬲ":"e",е:"e",ҽ:"e","ⷷ":"ͤ","⋿":"E",Ｅ:"E",ℰ:"E","𝐄":"E","𝐸":"E","𝑬":"E","𝓔":"E","𝔈":"E","𝔼":"E","𝕰":"E","𝖤":"E","𝗘":"E","𝘌":"E","𝙀":"E","𝙴":"E",Ε:"E","𝚬":"E","𝛦":"E","𝜠":"E","𝝚":"E","𝞔":"E",Е:"E","ⴹ":"E",Ꭼ:"E","ꓰ":"E","𑢦":"E","𑢮":"E","𐊆":"E",ě:"ĕ",Ě:"Ĕ","ɇ":"e̸","Ɇ":"E̸",ҿ:"ę","ꭼ":"ᴇ",ə:"ǝ",ә:"ǝ","∃":"Ǝ","ⴺ":"Ǝ","ꓱ":"Ǝ",ɚ:"ǝ˞","ᴔ":"ǝo","ꭁ":"ǝo̸","ꭂ":"ǝo̵",Ә:"Ə","𝈡":"Ɛ",ℇ:"Ɛ","Ԑ":"Ɛ",Ꮛ:"Ɛ","𖼭":"Ɛ","𐐁":"Ɛ","ᶟ":"ᵋ","ᴈ":"ɜ",з:"ɜ",ҙ:"ɜ̦","𐑂":"ɞ","ꞝ":"ʚ","𐐪":"ʚ","𝐟":"f","𝑓":"f","𝒇":"f","𝒻":"f","𝓯":"f","𝔣":"f","𝕗":"f","𝖋":"f","𝖿":"f","𝗳":"f","𝘧":"f","𝙛":"f","𝚏":"f","ꬵ":"f","ꞙ":"f",ſ:"f","ẝ":"f",ք:"f","𝈓":"F",ℱ:"F","𝐅":"F","𝐹":"F","𝑭":"F","𝓕":"F","𝔉":"F","𝔽":"F","𝕱":"F","𝖥":"F","𝗙":"F","𝘍":"F","𝙁":"F","𝙵":"F","Ꞙ":"F",Ϝ:"F","𝟊":"F",ᖴ:"F","ꓝ":"F","𑣂":"F","𑢢":"F","𐊇":"F","𐊥":"F","𐔥":"F",ƒ:"f̦",Ƒ:"F̦","ᵮ":"f̴","℻":"FAX",ﬀ:"ff",ﬃ:"ffi",ﬄ:"ffl",ﬁ:"fi",ﬂ:"fl",ʩ:"fŋ",ᖵ:"Ⅎ","ꓞ":"Ⅎ","𝈰":"ꟻ",ᖷ:"ꟻ",ｇ:"g",ℊ:"g","𝐠":"g","𝑔":"g","𝒈":"g","𝓰":"g","𝔤":"g","𝕘":"g","𝖌":"g","𝗀":"g","𝗴":"g","𝘨":"g","𝙜":"g","𝚐":"g",ɡ:"g","ᶃ":"g",ƍ:"g",ց:"g","𝐆":"G","𝐺":"G","𝑮":"G","𝒢":"G","𝓖":"G","𝔊":"G","𝔾":"G","𝕲":"G","𝖦":"G","𝗚":"G","𝘎":"G","𝙂":"G","𝙶":"G","Ԍ":"G",Ꮐ:"G",Ᏻ:"G","ꓖ":"G","ᶢ":"ᵍ",ɠ:"g̔",ǧ:"ğ",Ǧ:"Ğ",ǵ:"ģ",ǥ:"g̵",Ǥ:"G̵",Ɠ:"G'","ԍ":"ɢ","ꮐ":"ɢ","ᏻ":"ɢ",ｈ:"h",ℎ:"h","𝐡":"h","𝒉":"h","𝒽":"h","𝓱":"h","𝔥":"h","𝕙":"h","𝖍":"h","𝗁":"h","𝗵":"h","𝘩":"h","𝙝":"h","𝚑":"h",һ:"h",հ:"h",Ꮒ:"h",Ｈ:"H",ℋ:"H",ℌ:"H",ℍ:"H","𝐇":"H","𝐻":"H","𝑯":"H","𝓗":"H","𝕳":"H","𝖧":"H","𝗛":"H","𝘏":"H","𝙃":"H","𝙷":"H",Η:"H","𝚮":"H","𝛨":"H","𝜢":"H","𝝜":"H","𝞖":"H","Ⲏ":"H",Н:"H",Ꮋ:"H",ᕼ:"H","ꓧ":"H","𐋏":"H","ᵸ":"ᴴ",ɦ:"h̔","ꚕ":"h̔",Ᏺ:"h̔","Ⱨ":"H̩",Ң:"H̩",ħ:"h̵",ℏ:"h̵",ћ:"h̵",Ħ:"H̵","Ӊ":"H̦",Ӈ:"H̦",н:"ʜ","ꮋ":"ʜ",ң:"ʜ̩","ӊ":"ʜ̦",ӈ:"ʜ̦","Ԋ":"Ƕ","ꮀ":"ⱶ","Ͱ":"Ⱶ",Ꭸ:"Ⱶ",Ꮀ:"Ⱶ","ꚱ":"Ⱶ","ꞕ":"ꜧ","˛":"i","⍳":"i",ｉ:"i","ⅰ":"i",ℹ:"i","ⅈ":"i","𝐢":"i","𝑖":"i","𝒊":"i","𝒾":"i","𝓲":"i","𝔦":"i","𝕚":"i","𝖎":"i","𝗂":"i","𝗶":"i","𝘪":"i","𝙞":"i","𝚒":"i",ı:"i","𝚤":"i",ɪ:"i",ɩ:"i",ι:"i",ι:"i",ͺ:"i","𝛊":"i","𝜄":"i","𝜾":"i","𝝸":"i","𝞲":"i",і:"i","ꙇ":"i","ӏ":"i","ꭵ":"i",Ꭵ:"i","𑣃":"i","ⓛ":"Ⓘ","⍸":"i̲",ǐ:"ĭ",Ǐ:"Ĭ",ɨ:"i̵","ᵻ":"i̵","ᵼ":"i̵","ⅱ":"ii","ⅲ":"iii",ĳ:"ij","ⅳ":"iv","ⅸ":"ix",ｊ:"j","ⅉ":"j","𝐣":"j","𝑗":"j","𝒋":"j","𝒿":"j","𝓳":"j","𝔧":"j","𝕛":"j","𝖏":"j","𝗃":"j","𝗷":"j","𝘫":"j","𝙟":"j","𝚓":"j",ϳ:"j",ј:"j",Ｊ:"J","𝐉":"J","𝐽":"J","𝑱":"J","𝒥":"J","𝓙":"J","𝔍":"J","𝕁":"J","𝕵":"J","𝖩":"J","𝗝":"J","𝘑":"J","𝙅":"J","𝙹":"J","Ʝ":"J","Ϳ":"J",Ј:"J",Ꭻ:"J",ᒍ:"J","ꓙ":"J","ɉ":"j̵","Ɉ":"J̵",ᒙ:"J·","𝚥":"ȷ",յ:"ȷ","ꭻ":"ᴊ","𝐤":"k","𝑘":"k","𝒌":"k","𝓀":"k","𝓴":"k","𝔨":"k","𝕜":"k","𝖐":"k","𝗄":"k","𝗸":"k","𝘬":"k","𝙠":"k","𝚔":"k",K:"K",Ｋ:"K","𝐊":"K","𝐾":"K","𝑲":"K","𝒦":"K","𝓚":"K","𝔎":"K","𝕂":"K","𝕶":"K","𝖪":"K","𝗞":"K","𝘒":"K","𝙆":"K","𝙺":"K",Κ:"K","𝚱":"K","𝛫":"K","𝜥":"K","𝝟":"K","𝞙":"K","Ⲕ":"K",К:"K",Ꮶ:"K",ᛕ:"K","ꓗ":"K","𐔘":"K",ƙ:"k̔","Ⱪ":"K̩",Қ:"K̩","₭":"K̵","Ꝁ":"K̵",Ҟ:"K̵",Ƙ:"K'","׀":"l","|":"l","∣":"l","⏽":"l","￨":"l","١":"l","۱":"l","𐌠":"l","𞣇":"l","𝟏":"l","𝟙":"l","𝟣":"l","𝟭":"l","𝟷":"l","🯱":"l",I:Zge,Ｉ:"l","Ⅰ":"l",ℐ:"l",ℑ:"l","𝐈":"l","𝐼":"l","𝑰":"l","𝓘":"l","𝕀":"l","𝕴":"l","𝖨":"l","𝗜":"l","𝘐":"l","𝙄":"l","𝙸":"l",Ɩ:"l",ｌ:"l","ⅼ":"l",ℓ:"l","𝐥":"l","𝑙":"l","𝒍":"l","𝓁":"l","𝓵":"l","𝔩":"l","𝕝":"l","𝖑":"l","𝗅":"l","𝗹":"l","𝘭":"l","𝙡":"l","𝚕":"l",ǀ:"l",Ι:"l","𝚰":"l","𝛪":"l","𝜤":"l","𝝞":"l","𝞘":"l","Ⲓ":"l",І:"l",Ӏ:"l",ו:"l",ן:"l",ا:"l","𞸀":"l","𞺀":"l",ﺎ:"l",ﺍ:"l","ߊ":"l","ⵏ":"l",ᛁ:"l","ꓲ":"l","𖼨":"l","𐊊":"l","𐌉":"l","𝈪":"L","Ⅼ":"L",ℒ:"L","𝐋":"L","𝐿":"L","𝑳":"L","𝓛":"L","𝔏":"L","𝕃":"L","𝕷":"L","𝖫":"L","𝗟":"L","𝘓":"L","𝙇":"L","𝙻":"L","Ⳑ":"L",Ꮮ:"L",ᒪ:"L","ꓡ":"L","𖼖":"L","𑢣":"L","𑢲":"L","𐐛":"L","𐔦":"L",ﴼ:"l̋",ﴽ:"l̋",ł:"l̸",Ł:"L̸",ɭ:"l̨",Ɨ:"l̵",ƚ:"l̵",ɫ:"l̴",إ:"lٕ",ﺈ:"lٕ",ﺇ:"lٕ",ٳ:"lٕ",ŀ:"l·",Ŀ:"l·",ᒷ:"l·","🄂":"l,","⒈":"l.",ױ:"l'","⒓":"l2.","㏫":"l2日","㋋":"l2月","㍤":"l2点","⒔":"l3.","㏬":"l3日","㍥":"l3点","⒕":"l4.","㏭":"l4日","㍦":"l4点","⒖":"l5.","㏮":"l5日","㍧":"l5点","⒗":"l6.","㏯":"l6日","㍨":"l6点","⒘":"l7.","㏰":"l7日","㍩":"l7点","⒙":"l8.","㏱":"l8日","㍪":"l8点","⒚":"l9.","㏲":"l9日","㍫":"l9点",ǉ:"lj",Ĳ:"lJ",ǈ:"Lj",Ǉ:"LJ","‖":"ll","∥":"ll","Ⅱ":"ll",ǁ:"ll",װ:"ll","𐆙":"l̵l̵","⒒":"ll.","Ⅲ":"lll","𐆘":"l̵l̵S̵","㏪":"ll日","㋊":"ll月","㍣":"ll点",Ю:"lO","⒑":"lO.","㏩":"lO日","㋉":"lO月","㍢":"lO点",ʪ:"ls","₶":"lt","Ⅳ":"lV","Ⅸ":"lX",ɮ:"lȝ",ʫ:"lz",أ:"lٴ",ﺄ:"lٴ",ﺃ:"lٴ",ٲ:"lٴ",ٵ:"lٴ",ﷳ:"lكبر",ﷲ:"lللّٰo","㏠":"l日","㋀":"l月","㍙":"l点","ⳑ":"ʟ","ꮮ":"ʟ","𐑃":"ʟ",Ｍ:"M","Ⅿ":"M",ℳ:"M","𝐌":"M","𝑀":"M","𝑴":"M","𝓜":"M","𝔐":"M","𝕄":"M","𝕸":"M","𝖬":"M","𝗠":"M","𝘔":"M","𝙈":"M","𝙼":"M",Μ:"M","𝚳":"M","𝛭":"M","𝜧":"M","𝝡":"M","𝞛":"M","Ϻ":"M","Ⲙ":"M",М:"M",Ꮇ:"M",ᗰ:"M",ᛖ:"M","ꓟ":"M","𐊰":"M","𐌑":"M","Ӎ":"M̦","🝫":"MB","ⷨ":"ᷟ","𝐧":"n","𝑛":"n","𝒏":"n","𝓃":"n","𝓷":"n","𝔫":"n","𝕟":"n","𝖓":"n","𝗇":"n","𝗻":"n","𝘯":"n","𝙣":"n","𝚗":"n",ո:"n",ռ:"n",Ｎ:"N",ℕ:"N","𝐍":"N","𝑁":"N","𝑵":"N","𝒩":"N","𝓝":"N","𝔑":"N","𝕹":"N","𝖭":"N","𝗡":"N","𝘕":"N","𝙉":"N","𝙽":"N",Ν:"N","𝚴":"N","𝛮":"N","𝜨":"N","𝝢":"N","𝞜":"N","Ⲛ":"N","ꓠ":"N","𐔓":"N","𐆎":"N̊",ɳ:"n̨",ƞ:"n̩",η:"n̩","𝛈":"n̩","𝜂":"n̩","𝜼":"n̩","𝝶":"n̩","𝞰":"n̩",Ɲ:"N̦","ᵰ":"n̴",ǌ:"nj",ǋ:"Nj",Ǌ:"NJ","№":"No","ͷ":"ᴎ",и:"ᴎ","𐑍":"ᴎ",ņ:"ɲ","ం":"o","ಂ":"o","ം":"o","ං":"o","०":"o","੦":"o","૦":"o","௦":"o","౦":"o","೦":"o","൦":"o","๐":"o","໐":"o","၀":"o","٥":"o","۵":"o",ｏ:"o",ℴ:"o","𝐨":"o","𝑜":"o","𝒐":"o","𝓸":"o","𝔬":"o","𝕠":"o","𝖔":"o","𝗈":"o","𝗼":"o","𝘰":"o","𝙤":"o","𝚘":"o","ᴏ":"o","ᴑ":"o","ꬽ":"o",ο:"o","𝛐":"o","𝜊":"o","𝝄":"o","𝝾":"o","𝞸":"o",σ:"o","𝛔":"o","𝜎":"o","𝝈":"o","𝞂":"o","𝞼":"o","ⲟ":"o",о:"o","ჿ":"o",օ:"o",ס:"o",ه:"o","𞸤":"o","𞹤":"o","𞺄":"o",ﻫ:"o",ﻬ:"o",ﻪ:"o",ﻩ:"o",ھ:"o",ﮬ:"o",ﮭ:"o",ﮫ:"o",ﮪ:"o",ہ:"o",ﮨ:"o",ﮩ:"o",ﮧ:"o",ﮦ:"o",ە:"o",ഠ:"o",ဝ:"o","𐓪":"o","𑣈":"o","𑣗":"o","𐐬":"o","߀":"O","০":"O","୦":"O","〇":"O","𑓐":"O","𑣠":"O","𝟎":"O","𝟘":"O","𝟢":"O","𝟬":"O","𝟶":"O","🯰":"O",Ｏ:"O","𝐎":"O","𝑂":"O","𝑶":"O","𝒪":"O","𝓞":"O","𝔒":"O","𝕆":"O","𝕺":"O","𝖮":"O","𝗢":"O","𝘖":"O","𝙊":"O","𝙾":"O",Ο:"O","𝚶":"O","𝛰":"O","𝜪":"O","𝝤":"O","𝞞":"O","Ⲟ":"O",О:"O",Օ:"O","ⵔ":"O",ዐ:"O",ଠ:"O","𐓂":"O","ꓳ":"O","𑢵":"O","𐊒":"O","𐊫":"O","𐐄":"O","𐔖":"O","⁰":"º","ᵒ":"º",ǒ:"ŏ",Ǒ:"Ŏ","ۿ":"ô",Ő:"Ö",ø:"o̸","ꬾ":"o̸",Ø:"O̸","ⵁ":"O̸",Ǿ:"Ó̸",ɵ:"o̵","ꝋ":"o̵",ө:"o̵",ѳ:"o̵","ꮎ":"o̵","ꮻ":"o̵","⊖":"O̵","⊝":"O̵","⍬":"O̵","𝈚":"O̵","🜔":"O̵",Ɵ:"O̵","Ꝋ":"O̵",θ:"O̵",ϑ:"O̵","𝛉":"O̵","𝛝":"O̵","𝜃":"O̵","𝜗":"O̵","𝜽":"O̵","𝝑":"O̵","𝝷":"O̵","𝞋":"O̵","𝞱":"O̵","𝟅":"O̵",Θ:"O̵","ϴ":"O̵","𝚯":"O̵","𝚹":"O̵","𝛩":"O̵","𝛳":"O̵","𝜣":"O̵","𝜭":"O̵","𝝝":"O̵","𝝧":"O̵","𝞗":"O̵","𝞡":"O̵",Ө:"O̵",Ѳ:"O̵","ⴱ":"O̵",Ꮎ:"O̵",Ꮻ:"O̵","ꭴ":"ơ",ﳙ:"oٰ","🄁":"O,","🄀":"O.",ơ:"o'",Ơ:"O'",Ꭴ:"O'","%":"º/₀","٪":"º/₀","⁒":"º/₀","‰":"º/₀₀","؉":"º/₀₀","‱":"º/₀₀₀","؊":"º/₀₀₀",œ:"oe",Œ:"OE",ɶ:"oᴇ","∞":"oo","ꝏ":"oo","ꚙ":"oo","Ꝏ":"OO","Ꚙ":"OO",ﳗ:"oج",ﱑ:"oج",ﳘ:"oم",ﱒ:"oم",ﶓ:"oمج",ﶔ:"oمم",ﱓ:"oى",ﱔ:"oى","ൟ":"oരo",တ:"oာ","㍘":"O点","ↄ":"ɔ","ᴐ":"ɔ","ͻ":"ɔ","𐑋":"ɔ","Ↄ":"Ɔ","Ͻ":"Ɔ","ꓛ":"Ɔ","𐐣":"Ɔ","ꬿ":"ɔ̸","ꭢ":"ɔe","𐐿":"ɷ","⍴":"p",ｐ:"p","𝐩":"p","𝑝":"p","𝒑":"p","𝓅":"p","𝓹":"p","𝔭":"p","𝕡":"p","𝖕":"p","𝗉":"p","𝗽":"p","𝘱":"p","𝙥":"p","𝚙":"p",ρ:"p",ϱ:"p","𝛒":"p","𝛠":"p","𝜌":"p","𝜚":"p","𝝆":"p","𝝔":"p","𝞀":"p","𝞎":"p","𝞺":"p","𝟈":"p","ⲣ":"p",р:"p",Ｐ:"P",ℙ:"P","𝐏":"P","𝑃":"P","𝑷":"P","𝒫":"P","𝓟":"P","𝔓":"P","𝕻":"P","𝖯":"P","𝗣":"P","𝘗":"P","𝙋":"P","𝙿":"P",Ρ:"P","𝚸":"P","𝛲":"P","𝜬":"P","𝝦":"P","𝞠":"P","Ⲣ":"P",Р:"P",Ꮲ:"P",ᑭ:"P","ꓑ":"P","𐊕":"P",ƥ:"p̔","ᵽ":"p̵",ᑷ:"p·",ᒆ:"P'","ᴩ":"ᴘ","ꮲ":"ᴘ",φ:"ɸ",ϕ:"ɸ","𝛗":"ɸ","𝛟":"ɸ","𝜑":"ɸ","𝜙":"ɸ","𝝋":"ɸ","𝝓":"ɸ","𝞅":"ɸ","𝞍":"ɸ","𝞿":"ɸ","𝟇":"ɸ","ⲫ":"ɸ",ф:"ɸ","𝐪":"q","𝑞":"q","𝒒":"q","𝓆":"q","𝓺":"q","𝔮":"q","𝕢":"q","𝖖":"q","𝗊":"q","𝗾":"q","𝘲":"q","𝙦":"q","𝚚":"q","ԛ":"q",գ:"q",զ:"q",ℚ:"Q","𝐐":"Q","𝑄":"Q","𝑸":"Q","𝒬":"Q","𝓠":"Q","𝔔":"Q","𝕼":"Q","𝖰":"Q","𝗤":"Q","𝘘":"Q","𝙌":"Q","𝚀":"Q","ⵕ":"Q",ʠ:"q̔","🜀":"QE","ᶐ":"ɋ","ᴋ":"ĸ",κ:"ĸ",ϰ:"ĸ","𝛋":"ĸ","𝛞":"ĸ","𝜅":"ĸ","𝜘":"ĸ","𝜿":"ĸ","𝝒":"ĸ","𝝹":"ĸ","𝞌":"ĸ","𝞳":"ĸ","𝟆":"ĸ","ⲕ":"ĸ",к:"ĸ","ꮶ":"ĸ",қ:"ĸ̩",ҟ:"ĸ̵","𝐫":"r","𝑟":"r","𝒓":"r","𝓇":"r","𝓻":"r","𝔯":"r","𝕣":"r","𝖗":"r","𝗋":"r","𝗿":"r","𝘳":"r","𝙧":"r","𝚛":"r","ꭇ":"r","ꭈ":"r","ᴦ":"r","ⲅ":"r",г:"r","ꮁ":"r","𝈖":"R",ℛ:"R",ℜ:"R",ℝ:"R","𝐑":"R","𝑅":"R","𝑹":"R","𝓡":"R","𝕽":"R","𝖱":"R","𝗥":"R","𝘙":"R","𝙍":"R","𝚁":"R",Ʀ:"R",Ꭱ:"R",Ꮢ:"R","𐒴":"R",ᖇ:"R","ꓣ":"R","𖼵":"R",ɽ:"r̨",ɼ:"r̩","ɍ":"r̵",ғ:"r̵","ᵲ":"r̴",ґ:"r'","𑣣":"rn",m:eve,"ⅿ":"rn","𝐦":"rn","𝑚":"rn","𝒎":"rn","𝓂":"rn","𝓶":"rn","𝔪":"rn","𝕞":"rn","𝖒":"rn","𝗆":"rn","𝗺":"rn","𝘮":"rn","𝙢":"rn","𝚖":"rn","𑜀":"rn","₥":"rn̸",ɱ:"rn̦","ᵯ":"rn̴","₨":"Rs","ꭱ":"ʀ","ꮢ":"ʀ",я:"ᴙ","ᵳ":"ɾ̴","℩":"ɿ",ｓ:"s","𝐬":"s","𝑠":"s","𝒔":"s","𝓈":"s","𝓼":"s","𝔰":"s","𝕤":"s","𝖘":"s","𝗌":"s","𝘀":"s","𝘴":"s","𝙨":"s","𝚜":"s","ꜱ":"s",ƽ:"s",ѕ:"s","ꮪ":"s","𑣁":"s","𐑈":"s",Ｓ:"S","𝐒":"S","𝑆":"S","𝑺":"S","𝒮":"S","𝓢":"S","𝔖":"S","𝕊":"S","𝕾":"S","𝖲":"S","𝗦":"S","𝘚":"S","𝙎":"S","𝚂":"S",Ѕ:"S",Տ:"S",Ꮥ:"S",Ꮪ:"S","ꓢ":"S","𖼺":"S","𐊖":"S","𐐠":"S",ʂ:"s̨","ᵴ":"s̴","ꞵ":"ß",β:"ß",ϐ:"ß","𝛃":"ß","𝛽":"ß","𝜷":"ß","𝝱":"ß","𝞫":"ß",Ᏸ:"ß","🝜":"sss",ﬆ:"st","∫":"ʃ","ꭍ":"ʃ","∑":"Ʃ","⅀":"Ʃ",Σ:"Ʃ","𝚺":"Ʃ","𝛴":"Ʃ","𝜮":"Ʃ","𝝨":"Ʃ","𝞢":"Ʃ","ⵉ":"Ʃ","∬":"ʃʃ","∭":"ʃʃʃ","⨌":"ʃʃʃʃ","𝐭":"t","𝑡":"t","𝒕":"t","𝓉":"t","𝓽":"t","𝔱":"t","𝕥":"t","𝖙":"t","𝗍":"t","𝘁":"t","𝘵":"t","𝙩":"t","𝚝":"t","⊤":"T","⟙":"T","🝨":"T",Ｔ:"T","𝐓":"T","𝑇":"T","𝑻":"T","𝒯":"T","𝓣":"T","𝔗":"T","𝕋":"T","𝕿":"T","𝖳":"T","𝗧":"T","𝘛":"T","𝙏":"T","𝚃":"T",Τ:"T","𝚻":"T","𝛵":"T","𝜯":"T","𝝩":"T","𝞣":"T","Ⲧ":"T",Т:"T",Ꭲ:"T","ꓔ":"T","𖼊":"T","𑢼":"T","𐊗":"T","𐊱":"T","𐌕":"T",ƭ:"t̔","⍡":"T̈","Ⱦ":"T̸",Ț:"Ţ",Ʈ:"T̨",Ҭ:"T̩","₮":"T⃫",ŧ:"t̵",Ŧ:"T̵","ᵵ":"t̴",Ⴀ:"Ꞇ","Ꜩ":"T3",ʨ:"tɕ","℡":"TEL","ꝷ":"tf",ʦ:"ts",ʧ:"tʃ","ꜩ":"tȝ",τ:"ᴛ","𝛕":"ᴛ","𝜏":"ᴛ","𝝉":"ᴛ","𝞃":"ᴛ","𝞽":"ᴛ",т:"ᴛ","ꭲ":"ᴛ",ҭ:"ᴛ̩",ţ:"ƫ",ț:"ƫ",Ꮏ:"ƫ","𝐮":"u","𝑢":"u","𝒖":"u","𝓊":"u","𝓾":"u","𝔲":"u","𝕦":"u","𝖚":"u","𝗎":"u","𝘂":"u","𝘶":"u","𝙪":"u","𝚞":"u","ꞟ":"u","ᴜ":"u","ꭎ":"u","ꭒ":"u",ʋ:"u",υ:"u","𝛖":"u","𝜐":"u","𝝊":"u","𝞄":"u","𝞾":"u",ս:"u","𐓶":"u","𑣘":"u","∪":"U","⋃":"U","𝐔":"U","𝑈":"U","𝑼":"U","𝒰":"U","𝓤":"U","𝔘":"U","𝕌":"U","𝖀":"U","𝖴":"U","𝗨":"U","𝘜":"U","𝙐":"U","𝚄":"U",Ս:"U",ሀ:"U","𐓎":"U",ᑌ:"U","ꓴ":"U","𖽂":"U","𑢸":"U",ǔ:"ŭ",Ǔ:"Ŭ","ᵾ":"u̵","ꮜ":"u̵","Ʉ":"U̵",Ꮜ:"U̵",ᑘ:"U·",ᑧ:"U'","ᵫ":"ue","ꭣ":"uo",ṃ:"ꭑ",պ:"ɰ",ሣ:"ɰ","℧":"Ʊ",ᘮ:"Ʊ",ᘴ:"Ʊ","ᵿ":"ʊ̵","∨":"v","⋁":"v",ｖ:"v","ⅴ":"v","𝐯":"v","𝑣":"v","𝒗":"v","𝓋":"v","𝓿":"v","𝔳":"v","𝕧":"v","𝖛":"v","𝗏":"v","𝘃":"v","𝘷":"v","𝙫":"v","𝚟":"v","ᴠ":"v",ν:"v","𝛎":"v","𝜈":"v","𝝂":"v","𝝼":"v","𝞶":"v",ѵ:"v",ט:"v","𑜆":"v","ꮩ":"v","𑣀":"v","𝈍":"V","٧":"V","۷":"V","Ⅴ":"V","𝐕":"V","𝑉":"V","𝑽":"V","𝒱":"V","𝓥":"V","𝔙":"V","𝕍":"V","𝖁":"V","𝖵":"V","𝗩":"V","𝘝":"V","𝙑":"V","𝚅":"V",Ѵ:"V","ⴸ":"V",Ꮩ:"V",ᐯ:"V","ꛟ":"V","ꓦ":"V","𖼈":"V","𑢠":"V","𐔝":"V","𐆗":"V̵",ᐻ:"V·","🝬":"VB","ⅵ":"vi","ⅶ":"vii","ⅷ":"viii","Ⅵ":"Vl","Ⅶ":"Vll","Ⅷ":"Vlll","🜈":"Vᷤ","ᴧ":"ʌ","𐓘":"ʌ","٨":"Ʌ","۸":"Ʌ",Λ:"Ʌ","𝚲":"Ʌ","𝛬":"Ʌ","𝜦":"Ʌ","𝝠":"Ʌ","𝞚":"Ʌ",Л:"Ʌ","ⴷ":"Ʌ","𐒰":"Ʌ",ᐱ:"Ʌ","ꛎ":"Ʌ","ꓥ":"Ʌ","𖼽":"Ʌ","𐊍":"Ʌ","Ӆ":"Ʌ̦",ᐽ:"Ʌ·",ɯ:"w","𝐰":"w","𝑤":"w","𝒘":"w","𝓌":"w","𝔀":"w","𝔴":"w","𝕨":"w","𝖜":"w","𝗐":"w","𝘄":"w","𝘸":"w","𝙬":"w","𝚠":"w","ᴡ":"w",ѡ:"w","ԝ":"w",ա:"w","𑜊":"w","𑜎":"w","𑜏":"w","ꮃ":"w","𑣯":"W","𑣦":"W","𝐖":"W","𝑊":"W","𝑾":"W","𝒲":"W","𝓦":"W","𝔚":"W","𝕎":"W","𝖂":"W","𝖶":"W","𝗪":"W","𝘞":"W","𝙒":"W","𝚆":"W","Ԝ":"W",Ꮃ:"W",Ꮤ:"W","ꓪ":"W",ѽ:"w҆҇","𑓅":"ẇ","₩":"W̵","ꝡ":"w̦","ᴍ":"ʍ",м:"ʍ","ꮇ":"ʍ","ӎ":"ʍ̦","᙮":"x","×":"x","⤫":"x","⤬":"x","⨯":"x",ｘ:"x","ⅹ":"x","𝐱":"x","𝑥":"x","𝒙":"x","𝓍":"x","𝔁":"x","𝔵":"x","𝕩":"x","𝖝":"x","𝗑":"x","𝘅":"x","𝘹":"x","𝙭":"x","𝚡":"x",х:"x",ᕁ:"x",ᕽ:"x","ⷯ":"ͯ","᙭":"X","╳":"X","𐌢":"X","𑣬":"X",Ｘ:"X","Ⅹ":"X","𝐗":"X","𝑋":"X","𝑿":"X","𝒳":"X","𝓧":"X","𝔛":"X","𝕏":"X","𝖃":"X","𝖷":"X","𝗫":"X","𝘟":"X","𝙓":"X","𝚇":"X","Ꭓ":"X",Χ:"X","𝚾":"X","𝛸":"X","𝜲":"X","𝝬":"X","𝞦":"X","Ⲭ":"X",Х:"X","ⵝ":"X",ᚷ:"X","ꓫ":"X","𐊐":"X","𐊴":"X","𐌗":"X","𐔧":"X","⨰":"ẋ",Ҳ:"X̩","𐆖":"X̵","ⅺ":"xi","ⅻ":"xii","Ⅺ":"Xl","Ⅻ":"Xll",ɣ:"y","ᶌ":"y",ｙ:"y","𝐲":"y","𝑦":"y","𝒚":"y","𝓎":"y","𝔂":"y","𝔶":"y","𝕪":"y","𝖞":"y","𝗒":"y","𝘆":"y","𝘺":"y","𝙮":"y","𝚢":"y",ʏ:"y","ỿ":"y","ꭚ":"y",γ:"y","ℽ":"y","𝛄":"y","𝛾":"y","𝜸":"y","𝝲":"y","𝞬":"y",у:"y",ү:"y",ყ:"y","𑣜":"y",Ｙ:"Y","𝐘":"Y","𝑌":"Y","𝒀":"Y","𝒴":"Y","𝓨":"Y","𝔜":"Y","𝕐":"Y","𝖄":"Y","𝖸":"Y","𝗬":"Y","𝘠":"Y","𝙔":"Y","𝚈":"Y",Υ:"Y",ϒ:"Y","𝚼":"Y","𝛶":"Y","𝜰":"Y","𝝪":"Y","𝞤":"Y","Ⲩ":"Y",У:"Y",Ү:"Y",Ꭹ:"Y",Ꮍ:"Y","ꓬ":"Y","𖽃":"Y","𑢤":"Y","𐊲":"Y",ƴ:"y̔","ɏ":"y̵",ұ:"y̵","¥":"Y̵","Ɏ":"Y̵",Ұ:"Y̵",ʒ:"ȝ","ꝫ":"ȝ","ⳍ":"ȝ",ӡ:"ȝ",ჳ:"ȝ","𝐳":"z","𝑧":"z","𝒛":"z","𝓏":"z","𝔃":"z","𝔷":"z","𝕫":"z","𝖟":"z","𝗓":"z","𝘇":"z","𝘻":"z","𝙯":"z","𝚣":"z","ᴢ":"z","ꮓ":"z","𑣄":"z","𐋵":"Z","𑣥":"Z",Ｚ:"Z",ℤ:"Z",ℨ:"Z","𝐙":"Z","𝑍":"Z","𝒁":"Z","𝒵":"Z","𝓩":"Z","𝖅":"Z","𝖹":"Z","𝗭":"Z","𝘡":"Z","𝙕":"Z","𝚉":"Z",Ζ:"Z","𝚭":"Z","𝛧":"Z","𝜡":"Z","𝝛":"Z","𝞕":"Z",Ꮓ:"Z","ꓜ":"Z","𑢩":"Z",ʐ:"z̨",ƶ:"z̵",Ƶ:"Z̵",ȥ:"z̦",Ȥ:"Z̦","ᵶ":"z̴",ƿ:"þ","ϸ":"þ","Ϸ":"Þ","𐓄":"Þ","⁹":"ꝰ","ᴤ":"ƨ",ϩ:"ƨ","ꙅ":"ƨ",ь:"ƅ","ꮟ":"ƅ",ы:"ƅi","ꭾ":"ɂ",ˤ:"ˁ","ꛍ":"ʡ","⊙":"ʘ","☉":"ʘ","⨀":"ʘ","Ꙩ":"ʘ","ⵙ":"ʘ","𐓃":"ʘ","ℾ":"Γ","𝚪":"Γ","𝛤":"Γ","𝜞":"Γ","𝝘":"Γ","𝞒":"Γ","Ⲅ":"Γ",Г:"Γ",Ꮁ:"Γ",ᒥ:"Γ","𖼇":"Γ",Ғ:"Γ̵",ᒯ:"Γ·",Ґ:"Γ'","∆":"Δ","△":"Δ","🜂":"Δ","𝚫":"Δ","𝛥":"Δ","𝜟":"Δ","𝝙":"Δ","𝞓":"Δ","Ⲇ":"Δ","ⵠ":"Δ",ᐃ:"Δ","𖼚":"Δ","𐊅":"Δ","𐊣":"Δ","⍙":"Δ̲",ᐏ:"Δ·",ᐬ:"Δᐠ","𝟋":"ϝ","𝛇":"ζ","𝜁":"ζ","𝜻":"ζ","𝝵":"ζ","𝞯":"ζ","ⳤ":"ϗ","𝛌":"λ","𝜆":"λ","𝝀":"λ","𝝺":"λ","𝞴":"λ","Ⲗ":"λ","𐓛":"λ",µ:"μ","𝛍":"μ","𝜇":"μ","𝝁":"μ","𝝻":"μ","𝞵":"μ","𝛏":"ξ","𝜉":"ξ","𝝃":"ξ","𝝽":"ξ","𝞷":"ξ","𝚵":"Ξ","𝛯":"Ξ","𝜩":"Ξ","𝝣":"Ξ","𝞝":"Ξ",ϖ:"π","ℼ":"π","𝛑":"π","𝛡":"π","𝜋":"π","𝜛":"π","𝝅":"π","𝝕":"π","𝝿":"π","𝞏":"π","𝞹":"π","𝟉":"π","ᴨ":"π",п:"π","∏":"Π","ℿ":"Π","𝚷":"Π","𝛱":"Π","𝜫":"Π","𝝥":"Π","𝞟":"Π","Ⲡ":"Π",П:"Π","ꛛ":"Π","𐊭":"Ϙ","𐌒":"Ϙ",ϛ:"ς","𝛓":"ς","𝜍":"ς","𝝇":"ς","𝞁":"ς","𝞻":"ς","𝚽":"Φ","𝛷":"Φ","𝜱":"Φ","𝝫":"Φ","𝞥":"Φ","Ⲫ":"Φ",Ф:"Φ",Փ:"Φ",ቀ:"Φ","ᛰ":"Φ","𐊳":"Φ","ꭓ":"χ","ꭕ":"χ","𝛘":"χ","𝜒":"χ","𝝌":"χ","𝞆":"χ","𝟀":"χ","ⲭ":"χ","𝛙":"ψ","𝜓":"ψ","𝝍":"ψ","𝞇":"ψ","𝟁":"ψ",ѱ:"ψ","𐓹":"ψ","𝚿":"Ψ","𝛹":"Ψ","𝜳":"Ψ","𝝭":"Ψ","𝞧":"Ψ","Ⲯ":"Ψ",Ѱ:"Ψ","𐓑":"Ψ",ᛘ:"Ψ","𐊵":"Ψ","⍵":"ω","ꞷ":"ω","𝛚":"ω","𝜔":"ω","𝝎":"ω","𝞈":"ω","𝟂":"ω","ⲱ":"ω","ꙍ":"ω",Ω:"Ω","𝛀":"Ω","𝛺":"Ω","𝜴":"Ω","𝝮":"Ω","𝞨":"Ω",ᘯ:"Ω",ᘵ:"Ω","𐊶":"Ω","⍹":"ω̲",ώ:"ῴ","☰":"Ⲷ","Ⳝ":"Ϭ",җ:"ж̩",Җ:"Ж̩","𝈋":"И","Ͷ":"И","ꚡ":"И","𐐥":"И",Й:"Ѝ","Ҋ":"Ѝ̦",ѝ:"й","ҋ":"й̦","𐒼":"Ӄ","ᴫ":"л","ӆ":"л̦","ꭠ":"љ","𐓫":"ꙩ","ᷮ":"ⷬ","𐓍":"Ћ","𝈂":"Ӿ","𝈢":"Ѡ",Ꮗ:"Ѡ",ᗯ:"Ѡ",Ѽ:"Ѡ҆҇","ᣭ":"Ѡ·","Ꞷ":"Ꙍ",ӌ:"ҷ",Ӌ:"Ҷ",Ҿ:"Ҽ̨","ⲽ":"ш","Ⲽ":"Ш","Ꙑ":"Ъl","℈":"Э","🜁":"Ꙙ","𖼜":"Ꙙ","ꦒ":"ⰿ",և:"եւ",ኔ:"ձ",ﬔ:"մե",ﬕ:"մի",ﬗ:"մխ",ﬓ:"մն","∩":"Ո","⋂":"Ո","𝉅":"Ո",በ:"Ո",ᑎ:"Ո","ꓵ":"Ո",ᑚ:"Ո·",ᑨ:"Ո'",ﬖ:"վն","₽":"Ք","˓":"ՙ",ʿ:"ՙ",ℵ:"א",ﬡ:"א",אָ:"אַ",אּ:"אַ",ﭏ:"אל",ℶ:"ב",ℷ:"ג",ℸ:"ד",ﬢ:"ד",ﬣ:"ה",יּ:"יִ",ﬤ:"כ",ﬥ:"ל",ﬦ:"ם",ﬠ:"ע",ﬧ:"ר",שׂ:"שׁ",שּ:"שׁ",שּׂ:"שּׁ",ﬨ:"ת",ﺀ:"ء","۽":"ء͈",ﺂ:"آ",ﺁ:"آ",ﭑ:"ٱ",ﭐ:"ٱ","𞸁":"ب","𞸡":"ب","𞹡":"ب","𞺁":"ب","𞺡":"ب",ﺑ:"ب",ﺒ:"ب",ﺐ:"ب",ﺏ:"ب","ݑ":"بۛ","ࢶ":"بۢ","ࢡ":"بٔ",ﲠ:"بo",ﳢ:"بo",ﲜ:"بج",ﰅ:"بج",ﲝ:"بح",ﰆ:"بح",ﷂ:"بحى",ﲞ:"بخ",ﰇ:"بخ",ﳒ:"بخ",ﱋ:"بخ",ﶞ:"بخى",ﱪ:"بر",ﱫ:"بز",ﲟ:"بم",ﳡ:"بم",ﱬ:"بم",ﰈ:"بم",ﱭ:"بن",ﱮ:"بى",ﰉ:"بى",ﱯ:"بى",ﰊ:"بى",ﭔ:"ٻ",ﭕ:"ٻ",ﭓ:"ٻ",ﭒ:"ٻ",ې:"ٻ",ﯦ:"ٻ",ﯧ:"ٻ",ﯥ:"ٻ",ﯤ:"ٻ",ﭜ:"ڀ",ﭝ:"ڀ",ﭛ:"ڀ",ﭚ:"ڀ","ࢩ":"ݔ","ݧ":"ݔ","⍥":"ة",ö:"ة",ﺔ:"ة",ﺓ:"ة",ۃ:"ة","𞸕":"ت","𞸵":"ت","𞹵":"ت","𞺕":"ت","𞺵":"ت",ﺗ:"ت",ﺘ:"ت",ﺖ:"ت",ﺕ:"ت",ﲥ:"تo",ﳤ:"تo",ﲡ:"تج",ﰋ:"تج",ﵐ:"تجم",ﶠ:"تجى",ﶟ:"تجى",ﲢ:"تح",ﰌ:"تح",ﵒ:"تحج",ﵑ:"تحج",ﵓ:"تحم",ﲣ:"تخ",ﰍ:"تخ",ﵔ:"تخم",ﶢ:"تخى",ﶡ:"تخى",ﱰ:"تر",ﱱ:"تز",ﲤ:"تم",ﳣ:"تم",ﱲ:"تم",ﰎ:"تم",ﵕ:"تمج",ﵖ:"تمح",ﵗ:"تمخ",ﶤ:"تمى",ﶣ:"تمى",ﱳ:"تن",ﱴ:"تى",ﰏ:"تى",ﱵ:"تى",ﰐ:"تى",ﭠ:"ٺ",ﭡ:"ٺ",ﭟ:"ٺ",ﭞ:"ٺ",ﭤ:"ٿ",ﭥ:"ٿ",ﭣ:"ٿ",ﭢ:"ٿ","𞸂":"ج","𞸢":"ج","𞹂":"ج","𞹢":"ج","𞺂":"ج","𞺢":"ج",ﺟ:"ج",ﺠ:"ج",ﺞ:"ج",ﺝ:"ج",ﲧ:"جح",ﰕ:"جح",ﶦ:"جحى",ﶾ:"جحى",ﷻ:"جل جلlلo",ﲨ:"جم",ﰖ:"جم",ﵙ:"جمح",ﵘ:"جمح",ﶧ:"جمى",ﶥ:"جمى",ﴝ:"جى",ﴁ:"جى",ﴞ:"جى",ﴂ:"جى",ﭸ:"ڃ",ﭹ:"ڃ",ﭷ:"ڃ",ﭶ:"ڃ",ﭴ:"ڄ",ﭵ:"ڄ",ﭳ:"ڄ",ﭲ:"ڄ",ﭼ:"چ",ﭽ:"چ",ﭻ:"چ",ﭺ:"چ",ﮀ:"ڇ",ﮁ:"ڇ",ﭿ:"ڇ",ﭾ:"ڇ","𞸇":"ح","𞸧":"ح","𞹇":"ح","𞹧":"ح","𞺇":"ح","𞺧":"ح",ﺣ:"ح",ﺤ:"ح",ﺢ:"ح",ﺡ:"ح",څ:"حۛ",ځ:"حٔ","ݲ":"حٔ",ﲩ:"حج",ﰗ:"حج",ﶿ:"حجى",ﲪ:"حم",ﰘ:"حم",ﵛ:"حمى",ﵚ:"حمى",ﴛ:"حى",ﳿ:"حى",ﴜ:"حى",ﴀ:"حى","𞸗":"خ","𞸷":"خ","𞹗":"خ","𞹷":"خ","𞺗":"خ","𞺷":"خ",ﺧ:"خ",ﺨ:"خ",ﺦ:"خ",ﺥ:"خ",ﲫ:"خج",ﰙ:"خج",ﰚ:"خح",ﲬ:"خم",ﰛ:"خم",ﴟ:"خى",ﴃ:"خى",ﴠ:"خى",ﴄ:"خى","𐋡":"د","𞸃":"د","𞺃":"د","𞺣":"د",ﺪ:"د",ﺩ:"د",ڈ:"دؕ",ﮉ:"دؕ",ﮈ:"دؕ",ڎ:"دۛ",ﮇ:"دۛ",ﮆ:"دۛ","ۮ":"د̂","ࢮ":"د̤̣","𞸘":"ذ","𞺘":"ذ","𞺸":"ذ",ﺬ:"ذ",ﺫ:"ذ",ﱛ:"ذٰ",ڋ:"ڊؕ",ﮅ:"ڌ",ﮄ:"ڌ",ﮃ:"ڍ",ﮂ:"ڍ","𞸓":"ر","𞺓":"ر","𞺳":"ر",ﺮ:"ر",ﺭ:"ر",ڑ:"رؕ",ﮍ:"رؕ",ﮌ:"رؕ",ژ:"رۛ",ﮋ:"رۛ",ﮊ:"رۛ",ڒ:"ر̆","ࢹ":"ر̆̇","ۯ":"ر̂","ݬ":"رٔ",ﱜ:"رٰ",ﷶ:"رسول","﷼":"رىlل","𞸆":"ز","𞺆":"ز","𞺦":"ز",ﺰ:"ز",ﺯ:"ز","ࢲ":"ز̂","ݱ":"ڗؕ","𞸎":"س","𞸮":"س","𞹎":"س","𞹮":"س","𞺎":"س","𞺮":"س",ﺳ:"س",ﺴ:"س",ﺲ:"س",ﺱ:"س",ش:"سۛ","𞸔":"سۛ","𞸴":"سۛ","𞹔":"سۛ","𞹴":"سۛ","𞺔":"سۛ","𞺴":"سۛ",ﺷ:"سۛ",ﺸ:"سۛ",ﺶ:"سۛ",ﺵ:"سۛ","ݾ":"س̂",ﴱ:"سo",ﳨ:"سo",ﴲ:"سۛo",ﳪ:"سۛo",ﲭ:"سج",ﴴ:"سج",ﰜ:"سج",ﴭ:"سۛج",ﴷ:"سۛج",ﴥ:"سۛج",ﴉ:"سۛج",ﵝ:"سجح",ﵞ:"سجى",ﵩ:"سۛجى",ﲮ:"سح",ﴵ:"سح",ﰝ:"سح",ﴮ:"سۛح",ﴸ:"سۛح",ﴦ:"سۛح",ﴊ:"سۛح",ﵜ:"سحج",ﵨ:"سۛحم",ﵧ:"سۛحم",ﶪ:"سۛحى",ﲯ:"سخ",ﴶ:"سخ",ﰞ:"سخ",ﴯ:"سۛخ",ﴹ:"سۛخ",ﴧ:"سۛخ",ﴋ:"سۛخ",ﶨ:"سخى",ﷆ:"سخى",ﴪ:"سر",ﴎ:"سر",ﴩ:"سۛر",ﴍ:"سۛر",ﲰ:"سم",ﳧ:"سم",ﰟ:"سم",ﴰ:"سۛم",ﳩ:"سۛم",ﴨ:"سۛم",ﴌ:"سۛم",ﵡ:"سمج",ﵠ:"سمح",ﵟ:"سمح",ﵫ:"سۛمخ",ﵪ:"سۛمخ",ﵣ:"سمم",ﵢ:"سمم",ﵭ:"سۛمم",ﵬ:"سۛمم",ﴗ:"سى",ﳻ:"سى",ﴘ:"سى",ﳼ:"سى",ﴙ:"سۛى",ﳽ:"سۛى",ﴚ:"سۛى",ﳾ:"سۛى","𐋲":"ص","𞸑":"ص","𞸱":"ص","𞹑":"ص","𞹱":"ص","𞺑":"ص","𞺱":"ص",ﺻ:"ص",ﺼ:"ص",ﺺ:"ص",ﺹ:"ص",ڞ:"صۛ","ࢯ":"ص̤̣",ﲱ:"صح",ﰠ:"صح",ﵥ:"صحح",ﵤ:"صحح",ﶩ:"صحى",ﲲ:"صخ",ﴫ:"صر",ﴏ:"صر",ﷵ:"صلعم",ﷹ:"صلى",ﷰ:"صلى",ﷺ:"صلى lللo علىo وسلم",ﲳ:"صم",ﰡ:"صم",ﷅ:"صمم",ﵦ:"صمم",ﴡ:"صى",ﴅ:"صى",ﴢ:"صى",ﴆ:"صى","𞸙":"ض","𞸹":"ض","𞹙":"ض","𞹹":"ض","𞺙":"ض","𞺹":"ض",ﺿ:"ض",ﻀ:"ض",ﺾ:"ض",ﺽ:"ض",ﲴ:"ضج",ﰢ:"ضج",ﲵ:"ضح",ﰣ:"ضح",ﵮ:"ضحى",ﶫ:"ضحى",ﲶ:"ضخ",ﰤ:"ضخ",ﵰ:"ضخم",ﵯ:"ضخم",ﴬ:"ضر",ﴐ:"ضر",ﲷ:"ضم",ﰥ:"ضم",ﴣ:"ضى",ﴇ:"ضى",ﴤ:"ضى",ﴈ:"ضى","𐋨":"ط","𞸈":"ط","𞹨":"ط","𞺈":"ط","𞺨":"ط",ﻃ:"ط",ﻄ:"ط",ﻂ:"ط",ﻁ:"ط",ڟ:"طۛ",ﲸ:"طح",ﰦ:"طح",ﴳ:"طم",ﴺ:"طم",ﰧ:"طم",ﵲ:"طمح",ﵱ:"طمح",ﵳ:"طمم",ﵴ:"طمى",ﴑ:"طى",ﳵ:"طى",ﴒ:"طى",ﳶ:"طى","𞸚":"ظ","𞹺":"ظ","𞺚":"ظ","𞺺":"ظ",ﻇ:"ظ",ﻈ:"ظ",ﻆ:"ظ",ﻅ:"ظ",ﲹ:"ظم",ﴻ:"ظم",ﰨ:"ظم","؏":"ع","𞸏":"ع","𞸯":"ع","𞹏":"ع","𞹯":"ع","𞺏":"ع","𞺯":"ع",ﻋ:"ع",ﻌ:"ع",ﻊ:"ع",ﻉ:"ع",ﲺ:"عج",ﰩ:"عج",ﷄ:"عجم",ﵵ:"عجم",ﷷ:"علىo",ﲻ:"عم",ﰪ:"عم",ﵷ:"عمم",ﵶ:"عمم",ﵸ:"عمى",ﶶ:"عمى",ﴓ:"عى",ﳷ:"عى",ﴔ:"عى",ﳸ:"عى","𞸛":"غ","𞸻":"غ","𞹛":"غ","𞹻":"غ","𞺛":"غ","𞺻":"غ",ﻏ:"غ",ﻐ:"غ",ﻎ:"غ",ﻍ:"غ",ﲼ:"غج",ﰫ:"غج",ﲽ:"غم",ﰬ:"غم",ﵹ:"غمم",ﵻ:"غمى",ﵺ:"غمى",ﴕ:"غى",ﳹ:"غى",ﴖ:"غى",ﳺ:"غى","𞸐":"ف","𞸰":"ف","𞹰":"ف","𞺐":"ف","𞺰":"ف",ﻓ:"ف",ﻔ:"ف",ﻒ:"ف",ﻑ:"ف",ڧ:"ف",ﲾ:"فج",ﰭ:"فج",ﲿ:"فح",ﰮ:"فح",ﳀ:"فخ",ﰯ:"فخ",ﵽ:"فخم",ﵼ:"فخم",ﳁ:"فم",ﰰ:"فم",ﷁ:"فمى",ﱼ:"فى",ﰱ:"فى",ﱽ:"فى",ﰲ:"فى","𞸞":"ڡ","𞹾":"ڡ","ࢻ":"ڡ","ٯ":"ڡ","𞸟":"ڡ","𞹟":"ڡ","ࢼ":"ڡ",ڤ:"ڡۛ",ﭬ:"ڡۛ",ﭭ:"ڡۛ",ﭫ:"ڡۛ",ﭪ:"ڡۛ",ڨ:"ڡۛ","ࢤ":"ڢۛ",ﭰ:"ڦ",ﭱ:"ڦ",ﭯ:"ڦ",ﭮ:"ڦ","𞸒":"ق","𞸲":"ق","𞹒":"ق","𞹲":"ق","𞺒":"ق","𞺲":"ق",ﻗ:"ق",ﻘ:"ق",ﻖ:"ق",ﻕ:"ق",ﳂ:"قح",ﰳ:"قح",ﷱ:"قلى",ﳃ:"قم",ﰴ:"قم",ﶴ:"قمح",ﵾ:"قمح",ﵿ:"قمم",ﶲ:"قمى",ﱾ:"قى",ﰵ:"قى",ﱿ:"قى",ﰶ:"قى","𞸊":"ك","𞸪":"ك","𞹪":"ك",ﻛ:"ك",ﻜ:"ك",ﻚ:"ك",ﻙ:"ك",ک:"ك",ﮐ:"ك",ﮑ:"ك",ﮏ:"ك",ﮎ:"ك",ڪ:"ك",ڭ:"كۛ",ﯕ:"كۛ",ﯖ:"كۛ",ﯔ:"كۛ",ﯓ:"كۛ","ݣ":"كۛ",ﲀ:"كl",ﰷ:"كl",ﳄ:"كج",ﰸ:"كج",ﳅ:"كح",ﰹ:"كح",ﳆ:"كخ",ﰺ:"كخ",ﳇ:"كل",ﳫ:"كل",ﲁ:"كل",ﰻ:"كل",ﳈ:"كم",ﳬ:"كم",ﲂ:"كم",ﰼ:"كم",ﷃ:"كمم",ﶻ:"كمم",ﶷ:"كمى",ﲃ:"كى",ﰽ:"كى",ﲄ:"كى",ﰾ:"كى","ݢ":"ڬ",ﮔ:"گ",ﮕ:"گ",ﮓ:"گ",ﮒ:"گ","ࢰ":"گ",ڴ:"گۛ",ﮜ:"ڱ",ﮝ:"ڱ",ﮛ:"ڱ",ﮚ:"ڱ",ﮘ:"ڳ",ﮙ:"ڳ",ﮗ:"ڳ",ﮖ:"ڳ","𞸋":"ل","𞸫":"ل","𞹋":"ل","𞺋":"ل","𞺫":"ل",ﻟ:"ل",ﻠ:"ل",ﻞ:"ل",ﻝ:"ل",ڷ:"لۛ",ڵ:"ل̆",ﻼ:"لl",ﻻ:"لl",ﻺ:"لlٕ",ﻹ:"لlٕ",ﻸ:"لlٴ",ﻷ:"لlٴ",ﳍ:"لo",ﻶ:"لآ",ﻵ:"لآ",ﳉ:"لج",ﰿ:"لج",ﶃ:"لجج",ﶄ:"لجج",ﶺ:"لجم",ﶼ:"لجم",ﶬ:"لجى",ﳊ:"لح",ﱀ:"لح",ﶵ:"لحم",ﶀ:"لحم",ﶂ:"لحى",ﶁ:"لحى",ﳋ:"لخ",ﱁ:"لخ",ﶆ:"لخم",ﶅ:"لخم",ﳌ:"لم",ﳭ:"لم",ﲅ:"لم",ﱂ:"لم",ﶈ:"لمح",ﶇ:"لمح",ﶭ:"لمى",ﲆ:"لى",ﱃ:"لى",ﲇ:"لى",ﱄ:"لى","𞸌":"م","𞸬":"م","𞹬":"م","𞺌":"م","𞺬":"م",ﻣ:"م",ﻤ:"م",ﻢ:"م",ﻡ:"م","ࢧ":"مۛ","۾":"م͈",ﲈ:"مl",ﳎ:"مج",ﱅ:"مج",ﶌ:"مجح",ﶒ:"مجخ",ﶍ:"مجم",ﷀ:"مجى",ﳏ:"مح",ﱆ:"مح",ﶉ:"محج",ﶊ:"محم",ﷴ:"محمد",ﶋ:"محى",ﳐ:"مخ",ﱇ:"مخ",ﶎ:"مخج",ﶏ:"مخم",ﶹ:"مخى",ﳑ:"مم",ﲉ:"مم",ﱈ:"مم",ﶱ:"ممى",ﱉ:"مى",ﱊ:"مى","𞸍":"ن","𞸭":"ن","𞹍":"ن","𞹭":"ن","𞺍":"ن","𞺭":"ن",ﻧ:"ن",ﻨ:"ن",ﻦ:"ن",ﻥ:"ن","ݨ":"نؕ","ݩ":"ن̆",ﳖ:"نo",ﳯ:"نo",ﶸ:"نجح",ﶽ:"نجح",ﶘ:"نجم",ﶗ:"نجم",ﶙ:"نجى",ﷇ:"نجى",ﳓ:"نح",ﱌ:"نح",ﶕ:"نحم",ﶖ:"نحى",ﶳ:"نحى",ﳔ:"نخ",ﱍ:"نخ",ﲊ:"نر",ﲋ:"نز",ﳕ:"نم",ﳮ:"نم",ﲌ:"نم",ﱎ:"نم",ﶛ:"نمى",ﶚ:"نمى",ﲍ:"نن",ﲎ:"نى",ﱏ:"نى",ﲏ:"نى",ﱐ:"نى",ۂ:"ۀ",ﮥ:"ۀ",ﮤ:"ۀ","𐋤":"و","𞸅":"و","𞺅":"و","𞺥":"و",ﻮ:"و",ﻭ:"و","ࢱ":"و",ۋ:"وۛ",ﯟ:"وۛ",ﯞ:"وۛ",ۇ:"و̓",ﯘ:"و̓",ﯗ:"و̓",ۆ:"و̆",ﯚ:"و̆",ﯙ:"و̆",ۉ:"و̂",ﯣ:"و̂",ﯢ:"و̂",ۈ:"وٰ",ﯜ:"وٰ",ﯛ:"وٰ",ؤ:"وٴ",ﺆ:"وٴ",ﺅ:"وٴ",ٶ:"وٴ",ٷ:"و̓ٴ",ﯝ:"و̓ٴ",ﷸ:"وسلم",ﯡ:"ۅ",ﯠ:"ۅ","ٮ":"ى","𞸜":"ى","𞹼":"ى",ں:"ى","𞸝":"ى","𞹝":"ى",ﮟ:"ى",ﮞ:"ى","ࢽ":"ى",ﯨ:"ى",ﯩ:"ى",ﻰ:"ى",ﻯ:"ى",ي:"ى","𞸉":"ى","𞸩":"ى","𞹉":"ى","𞹩":"ى","𞺉":"ى","𞺩":"ى",ﻳ:"ى",ﻴ:"ى",ﻲ:"ى",ﻱ:"ى",ی:"ى",ﯾ:"ى",ﯿ:"ى",ﯽ:"ى",ﯼ:"ى",ے:"ى",ﮯ:"ى",ﮮ:"ى",ٹ:"ىؕ",ﭨ:"ىؕ",ﭩ:"ىؕ",ﭧ:"ىؕ",ﭦ:"ىؕ",ڻ:"ىؕ",ﮢ:"ىؕ",ﮣ:"ىؕ",ﮡ:"ىؕ",ﮠ:"ىؕ",پ:"ىۛ",ﭘ:"ىۛ",ﭙ:"ىۛ",ﭗ:"ىۛ",ﭖ:"ىۛ",ث:"ىۛ","𞸖":"ىۛ","𞸶":"ىۛ","𞹶":"ىۛ","𞺖":"ىۛ","𞺶":"ىۛ",ﺛ:"ىۛ",ﺜ:"ىۛ",ﺚ:"ىۛ",ﺙ:"ىۛ",ڽ:"ىۛ",ۑ:"ىۛ","ؿ":"ىۛ","ࢷ":"ىۛۢ","ݖ":"ى̆",ێ:"ى̆","ࢺ":"ى̆̇","ؽ":"ى̂","ࢨ":"ىٔ",ﲐ:"ىٰ",ﱝ:"ىٰ",ﳞ:"ىo",ﳱ:"ىo",ﳦ:"ىۛo",ئ:"ىٴ",ﺋ:"ىٴ",ﺌ:"ىٴ",ﺊ:"ىٴ",ﺉ:"ىٴ",ٸ:"ىٴ",ﯫ:"ىٴl",ﯪ:"ىٴl",ﲛ:"ىٴo",ﳠ:"ىٴo",ﯭ:"ىٴo",ﯬ:"ىٴo",ﯸ:"ىٴٻ",ﯷ:"ىٴٻ",ﯶ:"ىٴٻ",ﲗ:"ىٴج",ﰀ:"ىٴج",ﲘ:"ىٴح",ﰁ:"ىٴح",ﲙ:"ىٴخ",ﱤ:"ىٴر",ﱥ:"ىٴز",ﲚ:"ىٴم",ﳟ:"ىٴم",ﱦ:"ىٴم",ﰂ:"ىٴم",ﱧ:"ىٴن",ﯯ:"ىٴو",ﯮ:"ىٴو",ﯱ:"ىٴو̓",ﯰ:"ىٴو̓",ﯳ:"ىٴو̆",ﯲ:"ىٴو̆",ﯵ:"ىٴوٰ",ﯴ:"ىٴوٰ",ﯻ:"ىٴى",ﯺ:"ىٴى",ﱨ:"ىٴى",ﯹ:"ىٴى",ﰃ:"ىٴى",ﱩ:"ىٴى",ﰄ:"ىٴى",ﳚ:"ىج",ﱕ:"ىج",ﰑ:"ىۛج",ﶯ:"ىجى",ﳛ:"ىح",ﱖ:"ىح",ﶮ:"ىحى",ﳜ:"ىخ",ﱗ:"ىخ",ﲑ:"ىر",ﱶ:"ىۛر",ﲒ:"ىز",ﱷ:"ىۛز",ﳝ:"ىم",ﳰ:"ىم",ﲓ:"ىم",ﱘ:"ىم",ﲦ:"ىۛم",ﳥ:"ىۛم",ﱸ:"ىۛم",ﰒ:"ىۛم",ﶝ:"ىمم",ﶜ:"ىمم",ﶰ:"ىمى",ﲔ:"ىن",ﱹ:"ىۛن",ﲕ:"ىى",ﱙ:"ىى",ﲖ:"ىى",ﱚ:"ىى",ﱺ:"ىۛى",ﰓ:"ىۛى",ﱻ:"ىۛى",ﰔ:"ىۛى",ﮱ:"ۓ",ﮰ:"ۓ","𐊸":"ⵀ","⁞":"ⵂ","⸽":"ⵂ","⦙":"ⵂ","︙":"ⵗ","⁝":"ⵗ","⋮":"ⵗ",Մ:"ሆ",Ռ:"ቡ",Ի:"ኮ",Պ:"ጣ",आ:"अा",ऒ:"अाॆ",ओ:"अाे",औ:"अाै","ऄ":"अॆ",ऑ:"अॉ",ऍ:"एॅ",ऎ:"एॆ",ऐ:"एे",ई:"र्इ",ઽ:"ऽ","𑇜":"ꣻ","𑇋":"ऺ","ુ":"ु","ૂ":"ू","ੋ":"ॆ","੍":"्","્":"्",আ:"অা",ৠ:"ঋৃ",ৡ:"ঋৃ","𑒒":"ঘ","𑒔":"চ","𑒖":"জ","𑒘":"ঞ","𑒙":"ট","𑒛":"ড","𑒪":"ণ","𑒞":"ত","𑒟":"থ","𑒠":"দ","𑒡":"ধ","𑒢":"ন","𑒣":"প","𑒩":"ব","𑒧":"ম","𑒨":"য","𑒫":"র","𑒝":"ল","𑒭":"ষ","𑒮":"স","𑓄":"ঽ","𑒰":"া","𑒱":"ি","𑒹":"ে","𑒼":"ো","𑒾":"ৌ","𑓂":"্","𑒽":"ৗ",ਉ:"ੳੁ",ਊ:"ੳੂ",ਆ:"ਅਾ",ਐ:"ਅੈ",ਔ:"ਅੌ",ਇ:"ੲਿ",ਈ:"ੲੀ",ਏ:"ੲੇ",આ:"અા",ઑ:"અાૅ",ઓ:"અાે",ઔ:"અાૈ",ઍ:"અૅ",એ:"અે",ઐ:"અૈ",ଆ:"ଅା","௮":"அ",ர:"ஈ","ா":"ஈ","௫":"ஈு","௨":"உ",ഉ:"உ",ஊ:"உள",ഊ:"உൗ","௭":"எ","௷":"எவ",ஜ:"ஐ",ജ:"ஐ","௧":"க","௪":"ச","௬":"சு","௲":"சூ","ഺ":"டி",ണ:"ண","௺":"நீ","௴":"மீ","௰":"ய",ഴ:"ழ","ௗ":"ள","ை":"ன",ശ:"ஶ","௸":"ஷ","ി":"ி","ീ":"ி","ொ":"ெஈ","ௌ":"ெள","ோ":"ேஈ",ಅ:"అ",ಆ:"ఆ",ಇ:"ఇ",ౠ:"ఋా",ౡ:"ఌా",ಒ:"ఒ",ఔ:"ఒౌ",ಔ:"ఒౌ",ఓ:"ఒౕ",ಓ:"ఒౕ",ಜ:"జ",ಞ:"ఞ",ఢ:"డ̣",ಣ:"ణ",థ:"ధּ",భ:"బ̣",ಯ:"య",ఠ:"రּ",ಱ:"ఱ",ಲ:"ల",ష:"వ̣",హ:"వా",మ:"వు","ూ":"ుా","ౄ":"ృా",ೡ:"ಌಾ",ഈ:"ഇൗ",ഐ:"എെ",ഓ:"ഒാ",ഔ:"ഒൗ",ൡ:"ഞ","൫":"ദ്ര","൹":"നു",ഌ:"നു",ങ:"നു","൯":"ന്","ൻ":"ന്","൬":"ന്ന","൚":"ന്മ",റ:"ര","൪":"ര്","ർ":"ര്","൮":"വ്ര","൶":"ഹ്മ","ൂ":"ു","ൃ":"ു","ൈ":"െെ","෪":"ජ","෫":"ද","𑐓":"𑐴𑑂𑐒","𑐙":"𑐴𑑂𑐘","𑐤":"𑐴𑑂𑐣","𑐪":"𑐴𑑂𑐩","𑐭":"𑐴𑑂𑐬","𑐯":"𑐴𑑂𑐮","𑗘":"𑖂","𑗙":"𑖂","𑗚":"𑖃","𑗛":"𑖄","𑗜":"𑖲","𑗝":"𑖳",ฃ:"ข",ด:"ค",ต:"ค",ม:"ฆ",ຈ:"จ",ซ:"ช",ฏ:"ฎ",ท:"ฑ",ບ:"บ",ປ:"ป",ຝ:"ฝ",ພ:"พ",ຟ:"ฟ",ฦ:"ภ",ຍ:"ย","។":"ฯ",ๅ:"า",ำ:"̊า","ិ":"ิ","ី":"ี","ឹ":"ึ","ឺ":"ื","ຸ":"ุ","ູ":"ู",แ:"เเ",ໜ:"ຫນ",ໝ:"ຫມ",ຳ:"̊າ","༂":"འུྂཿ","༃":"འུྂ༔",ཪ:"ར",ༀ:"ཨོཾ","ཷ":"ྲཱྀ","ཹ":"ླཱྀ","𑲲":"𑲪","ႁ":"ဂှ",က:"ဂာ","ၰ":"ဃှ","ၦ":"ပှ",ဟ:"ပာ","ၯ":"ပာှ","ၾ":"ၽှ",ဩ:"သြ",ဪ:"သြော်","႞":"ႃ̊",ឣ:"អ","᧐":"ᦞ","᧑":"ᦱ","᪀":"ᩅ","᪐":"ᩅ","꩓":"ꨁ","꩖":"ꨣ","᭒":"ᬍ","᭓":"ᬑ","᭘":"ᬨ","ꦣ":"ꦝ",ᢖ:"ᡜ",ᡕ:"ᠵ",ῶ:"Ꮿ",ᐍ:"ᐁ·",ᐫ:"ᐁᐠ",ᐑ:"ᐄ·",ᐓ:"ᐅ·",ᐭ:"ᐅᐠ",ᐕ:"ᐆ·",ᐘ:"ᐊ·",ᐮ:"ᐊᐠ",ᐚ:"ᐋ·","ᣝ":"ᐞᣟ",ᓑ:"ᐡ",ᕀ:"ᐩ",ᐿ:"ᐲ·",ᑃ:"ᐴ·","⍩":"ᐵ",ᑇ:"ᐹ·",ᑜ:"ᑏ·","⸧":"ᑐ","⊃":"ᑐ",ᑞ:"ᑐ·",ᑩ:"ᑐ'","⟉":"ᑐ/","⫗":"ᑐᑕ",ᑠ:"ᑑ·","⸦":"ᑕ","⊂":"ᑕ",ᑢ:"ᑕ·",ᑪ:"ᑕ'",ᑤ:"ᑖ·",ᑵ:"ᑫ·",ᒅ:"ᑫ'",ᑹ:"ᑮ·",ᑽ:"ᑰ·",ᘃ:"ᒉ",ᒓ:"ᒉ·",ᒕ:"ᒋ·",ᒗ:"ᒌ·",ᒛ:"ᒎ·",ᘂ:"ᒐ",ᒝ:"ᒐ·",ᒟ:"ᒑ·",ᒭ:"ᒣ·",ᒱ:"ᒦ·",ᒳ:"ᒧ·",ᒵ:"ᒨ·",ᒹ:"ᒫ·",ᓊ:"ᓀ·","ᣇ":"ᓂ·","ᣉ":"ᓃ·","ᣋ":"ᓄ·","ᣍ":"ᓅ·",ᓌ:"ᓇ·",ᓎ:"ᓈ·",ᘄ:"ᓓ",ᓝ:"ᓓ·",ᓟ:"ᓕ·",ᓡ:"ᓖ·",ᓣ:"ᓗ·",ᓥ:"ᓘ·",ᘇ:"ᓚ",ᓧ:"ᓚ·",ᓩ:"ᓛ·",ᓷ:"ᓭ·",ᓹ:"ᓯ·",ᓻ:"ᓰ·",ᓽ:"ᓱ·",ᓿ:"ᓲ·",ᔁ:"ᓴ·",ᔃ:"ᓵ·",ᔌ:"ᔋ<",ᔎ:"ᔋb",ᔍ:"ᔋᑕ",ᔏ:"ᔋᒐ",ᔘ:"ᔐ·",ᔚ:"ᔑ·",ᔜ:"ᔒ·",ᔞ:"ᔓ·",ᔠ:"ᔔ·",ᔢ:"ᔕ·",ᔤ:"ᔖ·",ᔲ:"ᔨ·",ᔴ:"ᔩ·",ᔶ:"ᔪ·",ᔸ:"ᔫ·",ᔺ:"ᔭ·",ᔼ:"ᔮ·",ᘢ:"ᕃ","ᣠ":"ᕃ·",ᘣ:"ᕆ",ᘤ:"ᕊ",ᕏ:"ᕌ·",ᖃ:"ᕐb",ᖄ:"ᕐḃ",ᖁ:"ᕐd",ᕿ:"ᕐP",ᙯ:"ᕐᑫ",ᕾ:"ᕐᑬ",ᖀ:"ᕐᑮ",ᖂ:"ᕐᑰ",ᖅ:"ᕐᒃ",ᕜ:"ᕚ·","ᣣ":"ᕞ·","ᣤ":"ᕦ·",ᕩ:"ᕧ·","ᣥ":"ᕫ·","ᣨ":"ᖆ·",ᖑ:"ᖕJ",ᙰ:"ᖕᒉ",ᖎ:"ᖕᒊ",ᖏ:"ᖕᒋ",ᖐ:"ᖕᒌ",ᖒ:"ᖕᒎ",ᖓ:"ᖕᒐ",ᖔ:"ᖕᒑ",ᙳ:"ᖖJ",ᙱ:"ᖖᒋ",ᙲ:"ᖖᒌ",ᙴ:"ᖖᒎ",ᙵ:"ᖖᒐ",ᙶ:"ᖖᒑ","ᣪ":"ᖗ·","ᙷ":"ᖧ·","ᙸ":"ᖨ·","ᙹ":"ᖩ·","ᙺ":"ᖪ·","ᙻ":"ᖫ·","ᙼ":"ᖬ·","ᙽ":"ᖭ·","⪫":"ᗒ","⪪":"ᗕ","ꓷ":"ᗡ","ᣰ":"ᗴ·","ᣲ":"ᘛ·","ᶻ":"ᙆ","ꓭ":"ᙠ","ᶺ":"ᣔ","ᴾ":"ᣖ","ᣜ":"ᣟᐞ",ˡ:"ᣳ",ʳ:"ᣴ",ˢ:"ᣵ","ᣛ":"ᣵ","ꚰ":"ᚹ",ᛡ:"ᚼ","⍿":"ᚽ",ᛂ:"ᚽ","𝈿":"ᛋ","↑":"ᛏ","↿":"ᛐ","⥮":"ᛐ⇂","⥣":"ᛐᛚ","ⵣ":"ᛯ","↾":"ᛚ","⨡":"ᛚ","⋄":"ᛜ","◇":"ᛜ","◊":"ᛜ","♢":"ᛜ","🝔":"ᛜ","𑢷":"ᛜ","𐊔":"ᛜ","⍚":"ᛜ̲","⋈":"ᛞ","⨝":"ᛞ","𐓐":"ᛦ","↕":"ᛨ","𐳼":"𐲂","𐳺":"𐲥",ㄱ:"ᄀ",ᆨ:"ᄀ",ᄁ:"ᄀᄀ",ㄲ:"ᄀᄀ",ᆩ:"ᄀᄀ","ᇺ":"ᄀᄂ","ᅚ":"ᄀᄃ",ᇃ:"ᄀᄅ","ᇻ":"ᄀᄇ",ᆪ:"ᄀᄉ",ㄳ:"ᄀᄉ",ᇄ:"ᄀᄉᄀ","ᇼ":"ᄀᄎ","ᇽ":"ᄀᄏ","ᇾ":"ᄀᄒ",ㄴ:"ᄂ",ᆫ:"ᄂ",ᄓ:"ᄂᄀ",ᇅ:"ᄂᄀ",ᄔ:"ᄂᄂ",ㅥ:"ᄂᄂ","ᇿ":"ᄂᄂ",ᄕ:"ᄂᄃ",ㅦ:"ᄂᄃ",ᇆ:"ᄂᄃ","ퟋ":"ᄂᄅ",ᄖ:"ᄂᄇ","ᅛ":"ᄂᄉ",ᇇ:"ᄂᄉ",ㅧ:"ᄂᄉ","ᅜ":"ᄂᄌ",ᆬ:"ᄂᄌ",ㄵ:"ᄂᄌ","ퟌ":"ᄂᄎ",ᇉ:"ᄂᄐ","ᅝ":"ᄂᄒ",ᆭ:"ᄂᄒ",ㄶ:"ᄂᄒ",ᇈ:"ᄂᅀ",ㅨ:"ᄂᅀ",ㄷ:"ᄃ",ᆮ:"ᄃ",ᄗ:"ᄃᄀ",ᇊ:"ᄃᄀ",ᄄ:"ᄃᄃ",ㄸ:"ᄃᄃ","ퟍ":"ᄃᄃ","ퟎ":"ᄃᄃᄇ","ᅞ":"ᄃᄅ",ᇋ:"ᄃᄅ","ꥠ":"ᄃᄆ","ꥡ":"ᄃᄇ","ퟏ":"ᄃᄇ","ꥢ":"ᄃᄉ","ퟐ":"ᄃᄉ","ퟑ":"ᄃᄉᄀ","ꥣ":"ᄃᄌ","ퟒ":"ᄃᄌ","ퟓ":"ᄃᄎ","ퟔ":"ᄃᄐ",ㄹ:"ᄅ",ᆯ:"ᄅ","ꥤ":"ᄅᄀ",ᆰ:"ᄅᄀ",ㄺ:"ᄅᄀ","ꥥ":"ᄅᄀᄀ","ퟕ":"ᄅᄀᄀ",ᇌ:"ᄅᄀᄉ",ㅩ:"ᄅᄀᄉ","ퟖ":"ᄅᄀᄒ",ᄘ:"ᄅᄂ",ᇍ:"ᄅᄂ","ꥦ":"ᄅᄃ",ᇎ:"ᄅᄃ",ㅪ:"ᄅᄃ","ꥧ":"ᄅᄃᄃ",ᇏ:"ᄅᄃᄒ",ᄙ:"ᄅᄅ",ᇐ:"ᄅᄅ","ퟗ":"ᄅᄅᄏ","ꥨ":"ᄅᄆ",ᆱ:"ᄅᄆ",ㄻ:"ᄅᄆ",ᇑ:"ᄅᄆᄀ",ᇒ:"ᄅᄆᄉ","ퟘ":"ᄅᄆᄒ","ꥩ":"ᄅᄇ",ᆲ:"ᄅᄇ",ㄼ:"ᄅᄇ","ퟙ":"ᄅᄇᄃ","ꥪ":"ᄅᄇᄇ",ᇓ:"ᄅᄇᄉ",ㅫ:"ᄅᄇᄉ","ꥫ":"ᄅᄇᄋ",ᇕ:"ᄅᄇᄋ","ퟚ":"ᄅᄇᄑ",ᇔ:"ᄅᄇᄒ","ꥬ":"ᄅᄉ",ᆳ:"ᄅᄉ",ㄽ:"ᄅᄉ",ᇖ:"ᄅᄉᄉ",ᄛ:"ᄅᄋ","ퟝ":"ᄅᄋ","ꥭ":"ᄅᄌ","ꥮ":"ᄅᄏ",ᇘ:"ᄅᄏ",ᆴ:"ᄅᄐ",ㄾ:"ᄅᄐ",ᆵ:"ᄅᄑ",ㄿ:"ᄅᄑ",ᄚ:"ᄅᄒ",ㅀ:"ᄅᄒ",ᄻ:"ᄅᄒ",ᆶ:"ᄅᄒ","ퟲ":"ᄅᄒ",ᇗ:"ᄅᅀ",ㅬ:"ᄅᅀ","ퟛ":"ᄅᅌ",ᇙ:"ᄅᅙ",ㅭ:"ᄅᅙ","ퟜ":"ᄅᅙᄒ",ㅁ:"ᄆ",ᆷ:"ᄆ","ꥯ":"ᄆᄀ",ᇚ:"ᄆᄀ","ퟞ":"ᄆᄂ","ퟟ":"ᄆᄂᄂ","ꥰ":"ᄆᄃ",ᇛ:"ᄆᄅ","ퟠ":"ᄆᄆ",ᄜ:"ᄆᄇ",ㅮ:"ᄆᄇ",ᇜ:"ᄆᄇ","ퟡ":"ᄆᄇᄉ","ꥱ":"ᄆᄉ",ᇝ:"ᄆᄉ",ㅯ:"ᄆᄉ",ᇞ:"ᄆᄉᄉ",ᄝ:"ᄆᄋ",ㅱ:"ᄆᄋ",ᇢ:"ᄆᄋ","ퟢ":"ᄆᄌ",ᇠ:"ᄆᄎ",ᇡ:"ᄆᄒ",ᇟ:"ᄆᅀ",ㅰ:"ᄆᅀ",ㅂ:"ᄇ",ᆸ:"ᄇ",ᄞ:"ᄇᄀ",ㅲ:"ᄇᄀ",ᄟ:"ᄇᄂ",ᄠ:"ᄇᄃ",ㅳ:"ᄇᄃ","ퟣ":"ᄇᄃ",ᇣ:"ᄇᄅ","ퟤ":"ᄇᄅᄑ","ퟥ":"ᄇᄆ",ᄈ:"ᄇᄇ",ㅃ:"ᄇᄇ","ퟦ":"ᄇᄇ",ᄬ:"ᄇᄇᄋ",ㅹ:"ᄇᄇᄋ",ᄡ:"ᄇᄉ",ㅄ:"ᄇᄉ",ᆹ:"ᄇᄉ",ᄢ:"ᄇᄉᄀ",ㅴ:"ᄇᄉᄀ",ᄣ:"ᄇᄉᄃ",ㅵ:"ᄇᄉᄃ","ퟧ":"ᄇᄉᄃ",ᄤ:"ᄇᄉᄇ",ᄥ:"ᄇᄉᄉ",ᄦ:"ᄇᄉᄌ","ꥲ":"ᄇᄉᄐ",ᄫ:"ᄇᄋ",ㅸ:"ᄇᄋ",ᇦ:"ᄇᄋ",ᄧ:"ᄇᄌ",ㅶ:"ᄇᄌ","ퟨ":"ᄇᄌ",ᄨ:"ᄇᄎ","ퟩ":"ᄇᄎ","ꥳ":"ᄇᄏ",ᄩ:"ᄇᄐ",ㅷ:"ᄇᄐ",ᄪ:"ᄇᄑ",ᇤ:"ᄇᄑ","ꥴ":"ᄇᄒ",ᇥ:"ᄇᄒ",ㅅ:"ᄉ",ᆺ:"ᄉ",ᄭ:"ᄉᄀ",ㅺ:"ᄉᄀ",ᇧ:"ᄉᄀ",ᄮ:"ᄉᄂ",ㅻ:"ᄉᄂ",ᄯ:"ᄉᄃ",ㅼ:"ᄉᄃ",ᇨ:"ᄉᄃ",ᄰ:"ᄉᄅ",ᇩ:"ᄉᄅ",ᄱ:"ᄉᄆ","ퟪ":"ᄉᄆ",ᄲ:"ᄉᄇ",ㅽ:"ᄉᄇ",ᇪ:"ᄉᄇ",ᄳ:"ᄉᄇᄀ","ퟫ":"ᄉᄇᄋ",ᄊ:"ᄉᄉ",ㅆ:"ᄉᄉ",ᆻ:"ᄉᄉ","ퟬ":"ᄉᄉᄀ","ퟭ":"ᄉᄉᄃ","ꥵ":"ᄉᄉᄇ",ᄴ:"ᄉᄉᄉ",ᄵ:"ᄉᄋ",ᄶ:"ᄉᄌ",ㅾ:"ᄉᄌ","ퟯ":"ᄉᄌ",ᄷ:"ᄉᄎ","ퟰ":"ᄉᄎ",ᄸ:"ᄉᄏ",ᄹ:"ᄉᄐ","ퟱ":"ᄉᄐ",ᄺ:"ᄉᄑ","ퟮ":"ᄉᅀ",ㅇ:"ᄋ",ᆼ:"ᄋ",ᅁ:"ᄋᄀ",ᇬ:"ᄋᄀ",ᇭ:"ᄋᄀᄀ",ᅂ:"ᄋᄃ","ꥶ":"ᄋᄅ",ᅃ:"ᄋᄆ",ᅄ:"ᄋᄇ",ᅅ:"ᄋᄉ",ᇱ:"ᄋᄉ",ㆂ:"ᄋᄉ",ᅇ:"ᄋᄋ",ㆀ:"ᄋᄋ",ᇮ:"ᄋᄋ",ᅈ:"ᄋᄌ",ᅉ:"ᄋᄎ",ᇯ:"ᄋᄏ",ᅊ:"ᄋᄐ",ᅋ:"ᄋᄑ","ꥷ":"ᄋᄒ",ᅆ:"ᄋᅀ",ᇲ:"ᄋᅀ",ㆃ:"ᄋᅀ",ㅈ:"ᄌ",ᆽ:"ᄌ","ퟷ":"ᄌᄇ","ퟸ":"ᄌᄇᄇ",ᅍ:"ᄌᄋ",ᄍ:"ᄌᄌ",ㅉ:"ᄌᄌ","ퟹ":"ᄌᄌ","ꥸ":"ᄌᄌᄒ",ㅊ:"ᄎ",ᆾ:"ᄎ",ᅒ:"ᄎᄏ",ᅓ:"ᄎᄒ",ㅋ:"ᄏ",ᆿ:"ᄏ",ㅌ:"ᄐ",ᇀ:"ᄐ","ꥹ":"ᄐᄐ",ㅍ:"ᄑ",ᇁ:"ᄑ",ᅖ:"ᄑᄇ",ᇳ:"ᄑᄇ","ퟺ":"ᄑᄉ",ᅗ:"ᄑᄋ",ㆄ:"ᄑᄋ",ᇴ:"ᄑᄋ","ퟻ":"ᄑᄐ","ꥺ":"ᄑᄒ",ㅎ:"ᄒ",ᇂ:"ᄒ",ᇵ:"ᄒᄂ",ᇶ:"ᄒᄅ",ᇷ:"ᄒᄆ",ᇸ:"ᄒᄇ","ꥻ":"ᄒᄉ",ᅘ:"ᄒᄒ",ㆅ:"ᄒᄒ",ᄽ:"ᄼᄼ",ᄿ:"ᄾᄾ",ㅿ:"ᅀ",ᇫ:"ᅀ","ퟳ":"ᅀᄇ","ퟴ":"ᅀᄇᄋ",ㆁ:"ᅌ",ᇰ:"ᅌ","ퟵ":"ᅌᄆ","ퟶ":"ᅌᄒ",ᅏ:"ᅎᅎ",ᅑ:"ᅐᅐ",ㆆ:"ᅙ",ᇹ:"ᅙ","ꥼ":"ᅙᅙ",ㅤ:"ᅠ",ㅏ:"ᅡ","ᆣ":"ᅡー",ᅶ:"ᅡᅩ",ᅷ:"ᅡᅮ",ᅢ:"ᅡ丨",ㅐ:"ᅡ丨",ㅑ:"ᅣ",ᅸ:"ᅣᅩ",ᅹ:"ᅣᅭ","ᆤ":"ᅣᅮ",ᅤ:"ᅣ丨",ㅒ:"ᅣ丨",ㅓ:"ᅥ",ᅼ:"ᅥー",ᅺ:"ᅥᅩ",ᅻ:"ᅥᅮ",ᅦ:"ᅥ丨",ㅔ:"ᅥ丨",ㅕ:"ᅧ","ᆥ":"ᅧᅣ",ᅽ:"ᅧᅩ",ᅾ:"ᅧᅮ",ᅨ:"ᅧ丨",ㅖ:"ᅧ丨",ㅗ:"ᅩ",ᅪ:"ᅩᅡ",ㅘ:"ᅩᅡ",ᅫ:"ᅩᅡ丨",ㅙ:"ᅩᅡ丨","ᆦ":"ᅩᅣ","ᆧ":"ᅩᅣ丨",ᅿ:"ᅩᅥ",ᆀ:"ᅩᅥ丨","ힰ":"ᅩᅧ",ᆁ:"ᅩᅧ丨",ᆂ:"ᅩᅩ","ힱ":"ᅩᅩ丨",ᆃ:"ᅩᅮ",ᅬ:"ᅩ丨",ㅚ:"ᅩ丨",ㅛ:"ᅭ","ힲ":"ᅭᅡ","ힳ":"ᅭᅡ丨",ᆄ:"ᅭᅣ",ㆇ:"ᅭᅣ",ᆆ:"ᅭᅣ",ᆅ:"ᅭᅣ丨",ㆈ:"ᅭᅣ丨","ힴ":"ᅭᅥ",ᆇ:"ᅭᅩ",ᆈ:"ᅭ丨",ㆉ:"ᅭ丨",ㅜ:"ᅮ",ᆉ:"ᅮᅡ",ᆊ:"ᅮᅡ丨",ᅯ:"ᅮᅥ",ㅝ:"ᅮᅥ",ᆋ:"ᅮᅥー",ᅰ:"ᅮᅥ丨",ㅞ:"ᅮᅥ丨","ힵ":"ᅮᅧ",ᆌ:"ᅮᅧ丨",ᆍ:"ᅮᅮ",ᅱ:"ᅮ丨",ㅟ:"ᅮ丨","ힶ":"ᅮ丨丨",ㅠ:"ᅲ",ᆎ:"ᅲᅡ","ힷ":"ᅲᅡ丨",ᆏ:"ᅲᅥ",ᆐ:"ᅲᅥ丨",ᆑ:"ᅲᅧ",ㆊ:"ᅲᅧ",ᆒ:"ᅲᅧ丨",ㆋ:"ᅲᅧ丨","ힸ":"ᅲᅩ",ᆓ:"ᅲᅮ",ᆔ:"ᅲ丨",ㆌ:"ᅲ丨",ㆍ:"ᆞ","ퟅ":"ᆞᅡ",ᆟ:"ᆞᅥ","ퟆ":"ᆞᅥ丨",ᆠ:"ᆞᅮ",ᆢ:"ᆞᆞ",ᆡ:"ᆞ丨",ㆎ:"ᆞ丨",ヘ:"へ","⍁":"〼","⧄":"〼","꒞":"ꁊ","꒬":"ꁐ","꒜":"ꃀ","꒨":"ꄲ","꒿":"ꉙ","꒾":"ꊱ","꒔":"ꋍ","꓀":"ꎫ","꓂":"ꎵ","꒺":"ꎿ","꒰":"ꏂ","꒧":"ꑘ","⊥":"ꓕ","⟂":"ꓕ","𝈜":"ꓕ","Ʇ":"ꓕ","Ꞟ":"ꓤ","⅁":"ꓨ","⅂":"ꓶ","𝈕":"ꓶ","𝈫":"ꓶ","𖼦":"ꓶ","𐐑":"ꓶ","⅃":"𖼀","𑫦":"𑫥𑫯","𑫨":"𑫥𑫥","𑫩":"𑫥𑫥𑫯","𑫪":"𑫥𑫥𑫰","𑫧":"𑫥𑫰","𑫴":"𑫳𑫯","𑫶":"𑫳𑫳","𑫷":"𑫳𑫳𑫯","𑫸":"𑫳𑫳𑫰","𑫵":"𑫳𑫰","𑫬":"𑫫𑫯","𑫭":"𑫫𑫫","𑫮":"𑫫𑫫𑫯","⊕":"𐊨","⨁":"𐊨","🜨":"𐊨","Ꚛ":"𐊨","▽":"𐊼","𝈔":"𐊼","🜄":"𐊼","⧖":"𐋀","ꞛ":"𐐺","Ꞛ":"𐐒","𐒠":"𐒆","𐏑":"𐎂","𐏓":"𐎓","𒀸":"𐎚","☥":"𐦞","𓋹":"𐦞","〹":"卄",不:"不","丽":"丽","並":"並","⎜":"丨","⎟":"丨","⎢":"丨","⎥":"丨","⎪":"丨","⎮":"丨","㇑":"丨",ᅵ:"丨",ㅣ:"丨","⼁":"丨",ᆜ:"丨ー",ᆘ:"丨ᅡ",ᆙ:"丨ᅣ","ힽ":"丨ᅣᅩ","ힾ":"丨ᅣ丨","ힿ":"丨ᅧ","ퟀ":"丨ᅧ丨",ᆚ:"丨ᅩ","ퟁ":"丨ᅩ丨","ퟂ":"丨ᅭ",ᆛ:"丨ᅮ","ퟃ":"丨ᅲ",ᆝ:"丨ᆞ","ퟄ":"丨丨",串:"串","丸":"丸",丹:"丹","乁":"乁","㇠":"乙","⼄":"乙","㇟":"乚","⺃":"乚","㇖":"乛","⺂":"乛","⻲":"亀",亂:"亂","㇚":"亅","⼅":"亅",了:"了",ニ:"二","⼆":"二","𠄢":"𠄢","⼇":"亠",亮:"亮","⼈":"人",イ:"亻","⺅":"亻",什:"什","仌":"仌",令:"令","你":"你",倂:"併","倂":"併","侀":"侀",來:"來",例:"例","侮":"侮","侮":"侮","侻":"侻",便:"便",值:"値",倫:"倫","偺":"偺","備":"備","像":"像",僚:"僚","僧":"僧","僧":"僧","㒞":"㒞","⼉":"儿",兀:"兀","⺎":"兀","充":"充","免":"免","免":"免","兔":"兔","兤":"兤","⼊":"入","內":"內","全":"全",兩:"兩",ハ:"八","⼋":"八",六:"六","具":"具","𠔜":"𠔜","𠔥":"𠔥","冀":"冀","㒹":"㒹","⼌":"冂","再":"再","𠕋":"𠕋","冒":"冒","冕":"冕","㒻":"㒻","最":"最","⼍":"冖","冗":"冗","冤":"冤","⼎":"冫","冬":"冬","况":"况","况":"况",冷:"冷",凉:"凉",凌:"凌",凜:"凜",凞:"凞","⼏":"几","𠘺":"𠘺","凵":"凵","⼐":"凵","⼑":"刀","⺉":"刂","刃":"刃",切:"切","切":"切",列:"列",利:"利","㓟":"㓟",刺:"刺","刻":"刻","剆":"剆","割":"割","剷":"剷",劉:"劉","𠠄":"𠠄",カ:"力",力:"力","⼒":"力",劣:"劣","㔕":"㔕","劳":"劳","勇":"勇","勇":"勇","勉":"勉","勉":"勉",勒:"勒",勞:"勞","勤":"勤","勤":"勤",勵:"勵","⼓":"勹","勺":"勺","勺":"勺","包":"包","匆":"匆","𠣞":"𠣞","⼔":"匕",北:"北","北":"北","⼕":"匚","⼖":"匸",匿:"匿","⼗":"十","〸":"十","〺":"卅","卉":"卉","࿖":"卍","࿕":"卐","卑":"卑","卑":"卑","博":"博",ト:"卜","⼘":"卜","⼙":"卩","⺋":"㔾","即":"即",卵:"卵","卽":"卽","卿":"卿","卿":"卿","卿":"卿","⼚":"厂","𠨬":"𠨬","⼛":"厶",參:"參","⼜":"又","及":"及","叟":"叟","𠭣":"𠭣",ロ:"口","⼝":"口",囗:"口","⼞":"口",句:"句","叫":"叫","叱":"叱","吆":"吆",吏:"吏",吝:"吝","吸":"吸",呂:"呂","呈":"呈","周":"周","咞":"咞","咢":"咢",咽:"咽",䎛:"㖈","哶":"哶","唐":"唐","啓":"啓",啟:"啓","啕":"啕","啣":"啣","善":"善","善":"善",喇:"喇","喙":"喙","喙":"喙","喝":"喝","喝":"喝","喫":"喫","喳":"喳",嗀:"嗀","嗂":"嗂","嗢":"嗢","嘆":"嘆","嘆":"嘆","噑":"噑","噴":"噴","器":"器",囹:"囹","圖":"圖","圗":"圗","⼟":"土",士:"土","⼠":"土","型":"型","城":"城",㦳:"㘽","埴":"埴","堍":"堍","報":"報","堲":"堲","塀":"塀",塚:"塚","塚":"塚",塞:"塞",填:"塡",壿:"墫","墬":"墬","墳":"墳",壘:"壘",壟:"壟","𡓤":"𡓤","壮":"壮","売":"売","壷":"壷","⼡":"夂","夆":"夆","⼢":"夊",タ:"夕","⼣":"夕","多":"多","夢":"夢","⼤":"大","奄":"奄",奈:"奈",契:"契","奔":"奔","奢":"奢",女:"女","⼥":"女","𡚨":"𡚨","𡛪":"𡛪","姘":"姘","姬":"姬","娛":"娛","娧":"娧","婢":"婢","婦":"婦",嬀:"媯","㛮":"㛮","㛼":"㛼","媵":"媵","嬈":"嬈","嬨":"嬨","嬾":"嬾","嬾":"嬾","⼦":"子","⼧":"宀",宅:"宅","𡧈":"𡧈","寃":"寃","寘":"寘",寧:"寧",寧:"寧","寧":"寧",寮:"寮","寳":"寳","𡬘":"𡬘","⼨":"寸","寿":"寿","将":"将","⼩":"小","尢":"尢","⺐":"尢","⼪":"尢","⺏":"尣","㞁":"㞁","⼫":"尸",尿:"尿","屠":"屠",屢:"屢","層":"層",履:"履","屮":"屮","屮":"屮","⼬":"屮","𡴋":"𡴋","⼭":"山","峀":"峀","岍":"岍","𡷤":"𡷤","𡷦":"𡷦",崙:"崙","嵃":"嵃",嵐:"嵐","嵫":"嵫","嵮":"嵮","嵼":"嵼","嶲":"嶲",嶺:"嶺","⼮":"巛","巢":"巢",エ:"工","⼯":"工","⼰":"己","⺒":"巳","㠯":"㠯","巽":"巽","⼱":"巾",帲:"帡","帨":"帨","帽":"帽","幩":"幩","㡢":"㡢","𢆃":"𢆃","⼲":"干",年:"年","𢆟":"𢆟","⺓":"幺","⼳":"幺","⼴":"广",度:"度","㡼":"㡼","庰":"庰","庳":"庳","庶":"庶",廊:"廊","廊":"廊",廉:"廉","廒":"廒",廓:"廓","廙":"廙",廬:"廬","⼵":"廴","廾":"廾","⼶":"廾","𢌱":"𢌱","𢌱":"𢌱",弄:"弄","⼷":"弋","⼸":"弓","弢":"弢","弢":"弢","⼹":"彐","⺔":"彑","当":"当","㣇":"㣇","⼺":"彡","形":"形","彩":"彩","彫":"彫","⼻":"彳",律:"律","㣣":"㣣","徚":"徚",復:"復","徭":"徭","⼼":"心","⺖":"忄","⺗":"㣺","忍":"忍","志":"志",念:"念","忹":"忹",怒:"怒",怜:"怜","恵":"恵","㤜":"㤜","㤺":"㤺","悁":"悁","悔":"悔","悔":"悔","惇":"惇","惘":"惘",惡:"惡","𢛔":"𢛔","愈":"愈","慨":"慨",慄:"慄","慈":"慈","慌":"慌","慌":"慌","慎":"慎","慎":"慎","慠":"慠","慺":"慺","憎":"憎","憎":"憎","憎":"憎",憐:"憐","憤":"憤","憯":"憯","憲":"憲","𢡄":"𢡄","𢡊":"𢡊","懞":"懞","懲":"懲","懲":"懲","懲":"懲",懶:"懶","懶":"懶",戀:"戀","⼽":"戈","成":"成","戛":"戛",戮:"戮","戴":"戴","⼾":"戶",戸:"戶","⼿":"手","⺘":"扌","扝":"扝","抱":"抱",拉:"拉",拏:"拏",拓:"拓","拔":"拔","拼":"拼",拾:"拾","𢬌":"𢬌","挽":"挽","捐":"捐","捨":"捨",捻:"捻","掃":"掃",掠:"掠","掩":"掩","揄":"揄","揤":"揤","摒":"摒","𢯱":"𢯱","搜":"搜","搢":"搢","揅":"揅","摩":"摩","摷":"摷","摾":"摾","㨮":"㨮",搉:"㩁",撚:"撚","撝":"撝",擄:"擄","㩬":"㩬","⽀":"支","⽁":"攴","⺙":"攵","敏":"敏","敏":"敏","敖":"敖","敬":"敬",數:"數","𣀊":"𣀊","⽂":"文","⻫":"斉","⽃":"斗",料:"料","⽄":"斤","⽅":"方",旅:"旅","⽆":"无","⺛":"旡","既":"既","旣":"旣","⽇":"日",易:"易",曶:"㫚","㫤":"㫤","晉":"晉",晩:"晚",晴:"晴","晴":"晴","暑":"暑","暑":"暑",暈:"暈","㬈":"㬈","暜":"暜",暴:"暴",曆:"曆","㬙":"㬙","𣊸":"𣊸","⽈":"曰",更:"更","書":"書","⽉":"月","𣍟":"𣍟",肦:"朌",胐:"朏",胊:"朐",脁:"朓",胶:"㬵",朗:"朗","朗":"朗","朗":"朗",脧:"朘","望":"望","望":"望",幐:"㬺",䐠:"㬻","𣎓":"𣎓",膧:"朣","𣎜":"𣎜","⽊":"木",李:"李","杓":"杓","杖":"杖","杞":"杞","𣏃":"𣏃",柿:"杮",杻:"杻","枅":"枅",林:"林","㭉":"㭉","𣏕":"𣏕",柳:"柳","柺":"柺",栗:"栗","栟":"栟","桒":"桒","𣑭":"𣑭",梁:"梁","梅":"梅","梅":"梅","梎":"梎",梨:"梨","椔":"椔","楂":"楂","㮝":"㮝","㮝":"㮝",槩:"㮣",樧:"榝","榣":"榣","槪":"槪",樂:"樂",樂:"樂",樂:"樂",樓:"樓","𣚣":"𣚣","檨":"檨",櫓:"櫓","櫛":"櫛",欄:"欄","㰘":"㰘","⽋":"欠","次":"次","𣢧":"𣢧","歔":"歔","㱎":"㱎","⽌":"止","⻭":"歯","歲":"歲",歷:"歷","歹":"歹","⽍":"歹","⺞":"歺","殟":"殟",殮:"殮","⽎":"殳",殺:"殺","殺":"殺","殺":"殺","殻":"殻","𣪍":"𣪍","⽏":"毋","⺟":"母","𣫺":"𣫺","⽐":"比","⽑":"毛","⽒":"氏","⺠":"民","⽓":"气","⽔":"水","⺡":"氵","⺢":"氺","汎":"汎","汧":"汧",沈:"沈","沿":"沿",泌:"泌","泍":"泍",泥:"泥","𣲼":"𣲼",洛:"洛",洞:"洞","洴":"洴","派":"派",流:"流","流":"流","流":"流","洖":"洖","浩":"浩",浪:"浪","海":"海","海":"海","浸":"浸","涅":"涅","𣴞":"𣴞",淋:"淋",淚:"淚",淪:"淪","淹":"淹","渚":"渚","港":"港","湮":"湮",潙:"溈","滋":"滋","滋":"滋",溜:"溜",溺:"溺","滇":"滇",滑:"滑","滛":"滛","㴳":"㴳",漏:"漏","漢":"漢","漢":"漢",漣:"漣","𣻑":"𣻑","潮":"潮","𣽞":"𣽞","𣾎":"𣾎","濆":"濆",濫:"濫",濾:"濾","瀛":"瀛","瀞":"瀞","瀞":"瀞","瀹":"瀹","灊":"灊","㶖":"㶖","⽕":"火","⺣":"灬","灰":"灰","灷":"灷","災":"災",炙:"炙","炭":"炭",烈:"烈",烙:"烙","煮":"煮","煮":"煮","𤉣":"𤉣","煅":"煅",煉:"煉","𤋮":"𤋮","熜":"熜",燎:"燎",燐:"燐","𤎫":"𤎫",爐:"爐",爛:"爛","爨":"爨","⽖":"爪","爫":"爫","⺤":"爫","爵":"爵","爵":"爵","⽗":"父","⽘":"爻","⺦":"丬","⽙":"爿","⽚":"片","牐":"牐","⽛":"牙","𤘈":"𤘈","⽜":"牛",牢:"牢","犀":"犀","犕":"犕","⽝":"犬","⺨":"犭","犯":"犯",狀:"狀","𤜵":"𤜵",狼:"狼",猪:"猪","猪":"猪","𤠔":"𤠔",獵:"獵","獺":"獺","⽞":"玄",率:"率",率:"率","⽟":"玉","王":"王","㺬":"㺬","玥":"玥",玲:"玲","㺸":"㺸","㺸":"㺸",珞:"珞",琉:"琉",理:"理","琢":"琢","瑇":"瑇","瑜":"瑜",瑩:"瑩","瑱":"瑱","瑱":"瑱","璅":"璅",璉:"璉",璘:"璘","瓊":"瓊","⽠":"瓜","⽡":"瓦","㼛":"㼛","甆":"甆","⽢":"甘","⽣":"生","甤":"甤","⽤":"用","⽥":"田","画":"画","甾":"甾","𤰶":"𤰶",留:"留",略:"略",異:"異","異":"異","𤲒":"𤲒","⽦":"疋","⽧":"疒",痢:"痢","瘐":"瘐","瘟":"瘟","瘝":"瘝",療:"療",癩:"癩","⽨":"癶","⽩":"白","𤾡":"𤾡","𤾸":"𤾸","⽪":"皮","⽫":"皿","𥁄":"𥁄","㿼":"㿼",益:"益","益":"益","盛":"盛",盧:"盧","䀈":"䀈","⽬":"目","直":"直","直":"直","𥃲":"𥃲","𥃳":"𥃳",省:"省","䀘":"䀘","𥄙":"𥄙","眞":"眞","真":"真","真":"真","𥄳":"𥄳","着":"着","睊":"睊","睊":"睊","鿃":"䀹","䀹":"䀹","䀹":"䀹",晣:"䀿","䁆":"䁆","瞋":"瞋","𥉉":"𥉉","瞧":"瞧","⽭":"矛","⽮":"矢","⽯":"石","䂖":"䂖","𥐝":"𥐝",硏:"研","硎":"硎",硫:"硫",碌:"碌","碌":"碌","碑":"碑",磊:"磊","磌":"磌","磌":"磌",磻:"磻","䃣":"䃣",礪:"礪","⽰":"示","⺭":"礻",礼:"礼","社":"社","祈":"祈","祉":"祉","𥘦":"𥘦","祐":"祐","祖":"祖","祖":"祖","祝":"祝",神:"神",祥:"祥","視":"視","視":"視",祿:"祿","𥚚":"𥚚","禍":"禍","禎":"禎",福:"福","福":"福","𥛅":"𥛅",禮:"禮","⽱":"禸","⽲":"禾",秊:"秊","䄯":"䄯","秫":"秫",稜:"稜","穊":"穊","穀":"穀","穀":"穀","穏":"穏","⽳":"穴","突":"突","𥥼":"𥥼","窱":"窱",立:"立","⽴":"立","⻯":"竜","𥪧":"𥪧","𥪧":"𥪧","竮":"竮","⽵":"竹",笠:"笠","節":"節","節":"節","䈂":"䈂","𥮫":"𥮫","篆":"篆","䈧":"䈧","築":"築","𥲀":"𥲀","𥳐":"𥳐",簾:"簾",籠:"籠","⽶":"米","类":"类",粒:"粒",精:"精","糒":"糒",糖:"糖","糨":"糨","䊠":"䊠","糣":"糣",糧:"糧","⽷":"糸","⺯":"糹","𥾆":"𥾆","紀":"紀",紐:"紐",索:"索",累:"累",絶:"絕","絣":"絣","絛":"絛",綠:"綠",綾:"綾","緇":"緇",練:"練","練":"練","練":"練","縂":"縂","䌁":"䌁","縉":"縉",縷:"縷","繁":"繁","繅":"繅","𦇚":"𦇚","䌴":"䌴","⽸":"缶","𦈨":"𦈨","缾":"缾","𦉇":"𦉇","⽹":"网","⺫":"罒","⺲":"罒","⺱":"罓","䍙":"䍙","署":"署","𦋙":"𦋙",罹:"罹","罺":"罺",羅:"羅","𦌾":"𦌾","⽺":"羊","羕":"羕",羚:"羚",羽:"羽","⽻":"羽","翺":"翺",老:"老","⽼":"老","⺹":"耂","者":"者","者":"者","者":"者","⽽":"而","𦓚":"𦓚","⽾":"耒","𦔣":"𦔣","⽿":"耳",聆:"聆","聠":"聠","𦖨":"𦖨",聯:"聯","聰":"聰",聾:"聾","⾀":"聿","⺺":"肀","⾁":"肉",肋:"肋","肭":"肭","育":"育","䏕":"䏕","䏙":"䏙",腁:"胼","脃":"脃","脾":"脾","䐋":"䐋","朡":"朡","𦞧":"𦞧","𦞵":"𦞵",朦:"䑃",臘:"臘","⾂":"臣",臨:"臨","⾃":"自","臭":"臭","⾄":"至","⾅":"臼","舁":"舁","舁":"舁","舄":"舄","⾆":"舌","舘":"舘","⾇":"舛","⾈":"舟","䑫":"䑫","⾉":"艮",良:"良","⾊":"色","⾋":"艸","艹":"艹","艹":"艹","⺾":"艹","⺿":"艹","⻀":"艹","芋":"芋","芑":"芑","芝":"芝","花":"花","芳":"芳","芽":"芽",若:"若","若":"若","苦":"苦","𦬼":"𦬼",茶:"茶","荒":"荒","荣":"荣","茝":"茝","茣":"茣","莽":"莽","荓":"荓",菉:"菉","菊":"菊","菌":"菌","菜":"菜","菧":"菧","華":"華",菱:"菱","著":"著","著":"著","𦰶":"𦰶","莭":"莭",落:"落",葉:"葉",蔿:"蒍","𦳕":"𦳕","𦵫":"𦵫",蓮:"蓮","蓱":"蓱","蓳":"蓳",蓼:"蓼","蔖":"蔖","䔫":"䔫","蕤":"蕤","𦼬":"𦼬",藍:"藍","䕝":"䕝","𦾱":"𦾱","䕡":"䕡",藺:"藺",蘆:"蘆","䕫":"䕫",蘒:"蘒",蘭:"蘭","𧃒":"𧃒",虁:"蘷",蘿:"蘿","⾌":"虍","⻁":"虎","虐":"虐",虜:"虜","虜":"虜","虧":"虧","虩":"虩","⾍":"虫","蚩":"蚩","蚈":"蚈","蛢":"蛢","蜎":"蜎","蜨":"蜨","蝫":"蝫","蟡":"蟡","蝹":"蝹","蝹":"蝹","螆":"螆","䗗":"䗗","𧏊":"𧏊",螺:"螺","蠁":"蠁","䗹":"䗹",蠟:"蠟","⾎":"血",行:"行","⾏":"行","衠":"衠","衣":"衣","⾐":"衣","⻂":"衤",裂:"裂","𧙧":"𧙧",裏:"裏","裗":"裗","裞":"裞",裡:"裡",裸:"裸","裺":"裺","䘵":"䘵","褐":"褐","襁":"襁",襤:"襤","⾑":"襾","⻄":"西","⻃":"覀","覆":"覆",見:"見","⾒":"見","𧢮":"𧢮","⻅":"见","⾓":"角","⾔":"言","𧥦":"𧥦",詽:"訮",訞:"䚶","䚾":"䚾","䛇":"䛇","誠":"誠",說:"說",說:"說","調":"調","請":"請",諒:"諒",論:"論","諭":"諭","諭":"諭",諸:"諸","諸":"諸",諾:"諾","諾":"諾","謁":"謁","謁":"謁","謹":"謹","謹":"謹",識:"識",讀:"讀",讏:"讆","變":"變","變":"變","⻈":"讠","⾕":"谷","⾖":"豆",豈:"豈","豕":"豕","⾗":"豕",豣:"豜","⾘":"豸","𧲨":"𧲨","⾙":"貝","貫":"貫","賁":"賁",賂:"賂",賈:"賈","賓":"賓","贈":"贈","贈":"贈","贛":"贛","⻉":"贝","⾚":"赤","⾛":"走","起":"起",趆:"赿","𧻓":"𧻓","𧼯":"𧼯","⾜":"足","跋":"跋","趼":"趼",跺:"跥",路:"路","跰":"跰",躛:"躗","⾝":"身",車:"車","⾞":"車","軔":"軔",輧:"軿",輦:"輦",輪:"輪","輸":"輸","輸":"輸",輻:"輻",轢:"轢","⻋":"车","⾟":"辛","辞":"辞",辰:"辰","⾠":"辰","⾡":"辵","辶":"辶","⻌":"辶","⻍":"辶","巡":"巡",連:"連",逸:"逸","逸":"逸","遲":"遲",遼:"遼","𨗒":"𨗒","𨗭":"𨗭",邏:"邏","⾢":"邑","邔":"邔",郎:"郎",郞:"郎","郞":"郎","郱":"郱",都:"都","𨜮":"𨜮","鄑":"鄑","鄛":"鄛","⾣":"酉",酪:"酪","醙":"醙",醴:"醴","⾤":"釆",里:"里","⾥":"里",量:"量",金:"金","⾦":"金",鈴:"鈴","鈸":"鈸","鉶":"鉶","鋗":"鋗","鋘":"鋘","鉼":"鉼",錄:"錄",鍊:"鍊",鎮:"鎭","鏹":"鏹","鐕":"鐕","𨯺":"𨯺","⻐":"钅","⻑":"長","⾧":"長","⻒":"镸","⻓":"长","⾨":"門","開":"開","䦕":"䦕",閭:"閭","閷":"閷","𨵷":"𨵷","⻔":"门","⾩":"阜","⻏":"阝","⻖":"阝",阮:"阮",陋:"陋",降:"降",陵:"陵",陸:"陸","陼":"陼",隆:"隆",隣:"隣","䧦":"䧦","⾪":"隶","隷":"隷",隸:"隷",隸:"隷","⾫":"隹","雃":"雃",離:"離","難":"難","難":"難","⾬":"雨",零:"零",雷:"雷","霣":"霣","𩅅":"𩅅",露:"露",靈:"靈","⾭":"靑","⻘":"青",靖:"靖","靖":"靖","𩇟":"𩇟","⾮":"非","⾯":"面","𩈚":"𩈚","⾰":"革","䩮":"䩮","䩶":"䩶","⾱":"韋","韛":"韛","韠":"韠","⻙":"韦","⾲":"韭","𩐊":"𩐊","⾳":"音","響":"響","響":"響","⾴":"頁","䪲":"䪲","頋":"頋","頋":"頋","頋":"頋",領:"領","頩":"頩","𩒖":"𩒖","頻":"頻","頻":"頻",類:"類","⻚":"页","⾵":"風","𩖶":"𩖶","⻛":"风","⾶":"飛","⻜":"飞","⻝":"食","⾷":"食","⻟":"飠","飢":"飢",飯:"飯",飼:"飼","䬳":"䬳",館:"館","餩":"餩","⻠":"饣","⾸":"首","⾹":"香","馧":"馧","⾺":"馬","駂":"駂",駱:"駱","駾":"駾",驪:"驪","⻢":"马","⾻":"骨","䯎":"䯎","⾼":"高","⾽":"髟","𩬰":"𩬰","鬒":"鬒","鬒":"鬒","⾾":"鬥","⾿":"鬯","⿀":"鬲","⿁":"鬼","⻤":"鬼","⿂":"魚",魯:"魯","鱀":"鱀",鱗:"鱗","⻥":"鱼","⿃":"鳥","鳽":"鳽","䳎":"䳎","鵧":"鵧","䳭":"䳭","𪃎":"𪃎",鶴:"鶴","𪄅":"𪄅","䳸":"䳸",鷺:"鷺","𪈎":"𪈎",鸞:"鸞",鹃:"鹂","⿄":"鹵",鹿:"鹿","⿅":"鹿","𪊑":"𪊑",麗:"麗",麟:"麟","⿆":"麥","⻨":"麦","麻":"麻","⿇":"麻","𪎒":"𪎒","⿈":"黃","⻩":"黄","⿉":"黍",黎:"黎","䵖":"䵖","⿊":"黑",黒:"黑","墨":"墨","黹":"黹","⿋":"黹","⿌":"黽","鼅":"鼅","黾":"黾","⿍":"鼎","鼏":"鼏","⿎":"鼓","鼖":"鼖","⿏":"鼠","鼻":"鼻","⿐":"鼻","齃":"齃","⿑":"齊","⻬":"齐","⿒":"齒","𪘀":"𪘀","⻮":"齿",龍:"龍","⿓":"龍","龎":"龎","⻰":"龙",龜:"龜",龜:"龜","龜":"龜","⿔":"龜","⻳":"龟","⿕":"龠"};var bk,RF;function nve(){if(RF)return bk;RF=1;var t=tve;function e(s){return s.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var n=RegExp(Object.keys(t).map(e).join("|"),"g");function r(s){return t[s]}function i(s){return s.replace(n,r)}return bk=i,bk}var rve=nve();const ive=cl(rve),sve=Object.prototype.toString,ove=t=>sve.call(t)==="[object Error]",ave=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function cve(t){if(!(t&&ove(t)&&t.name==="TypeError"&&typeof t.message=="string"))return!1;const{message:n,stack:r}=t;return n==="Load failed"?r===void 0||"__sentry_captured__"in t:n.startsWith("error sending request for url")?!0:ave.has(n)}function lve(t){if(typeof t=="number"){if(t<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(t))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(t!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function b2(t,e,{min:n=0,allowInfinity:r=!1}={}){if(e!==void 0){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected \`${t}\` to be a number${r?" or Infinity":""}.`);if(!r&&!Number.isFinite(e))throw new TypeError(`Expected \`${t}\` to be a finite number.`);if(e<n)throw new TypeError(`Expected \`${t}\` to be ≥ ${n}.`)}}class FX extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const uve=(t,e,n)=>{const r=n.retries-(e-1);return Object.freeze({error:t,attemptNumber:e,retriesLeft:r})};function dve(t,e){const n=e.randomize?Math.random()+1:1;let r=Math.round(n*Math.max(e.minTimeout,1)*e.factor**(t-1));return r=Math.min(r,e.maxTimeout),r}async function fve(t,e,n,r,i){let s=t;if(s instanceof Error||(s=new TypeError(`Non-error was thrown: "${s}". You should only throw errors.`)),s instanceof FX)throw s.originalError;if(s instanceof TypeError&&!cve(s))throw s;const o=uve(s,e,n);await n.onFailedAttempt(o);const a=Date.now();if(a-r>=i||e>=n.retries+1||!await n.shouldRetry(o))throw s;const c=dve(e,n),l=i-(a-r);if(l<=0)throw s;const d=Math.min(c,l);d>0&&await new Promise((h,m)=>{const g=()=>{clearTimeout(y),n.signal?.removeEventListener("abort",g),m(n.signal.reason)},y=setTimeout(()=>{n.signal?.removeEventListener("abort",g),h()},d);n.unref&&y.unref?.(),n.signal?.addEventListener("abort",g,{once:!0})}),n.signal?.throwIfAborted()}async function hve(t,e={}){if(e={...e},lve(e.retries),Object.hasOwn(e,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");e.retries??=10,e.factor??=2,e.minTimeout??=1e3,e.maxTimeout??=Number.POSITIVE_INFINITY,e.randomize??=!1,e.onFailedAttempt??=()=>{},e.shouldRetry??=()=>!0,b2("factor",e.factor,{min:0,allowInfinity:!1}),b2("minTimeout",e.minTimeout,{min:0,allowInfinity:!1}),b2("maxTimeout",e.maxTimeout,{min:0,allowInfinity:!0});const n=e.maxRetryTime??Number.POSITIVE_INFINITY;b2("maxRetryTime",n,{min:0,allowInfinity:!0}),e.factor>0||(e.factor=1),e.signal?.throwIfAborted();let r=0;const i=Date.now(),s=n;for(;r<e.retries+1;){r++;try{e.signal?.throwIfAborted();const o=await t(r);return e.signal?.throwIfAborted(),o}catch(o){await fve(o,r,e,i,s)}}throw new Error("Retry attempts exhausted without throwing an error.")}let a_=class{constructor(e,n){if(this.stable=e,this.unstable=n,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}get name(){return this.stable?this.stable:this.unstable}get altName(){return this.stable?this.unstable:null}get names(){var e=[this.name],n=this.altName;return n&&e.push(n),e}matches(e){return this.name===e||this.altName===e}findIn(e){var n=void 0;return this.name&&(n=e?.[this.name]),!n&&this.altName&&(n=e?.[this.altName]),n}includedIn(e){var n=!1;return this.name&&(n=e.includes(this.name)),!n&&this.altName&&(n=e.includes(this.altName)),n}};class K3 extends a_{constructor(){super(...arguments),L(this,"preferUnstable",!1)}setPreferUnstable(e){this.preferUnstable=e}get name(){return this.stable&&!this.preferUnstable?this.stable:this.unstable}}class Ar extends a_{constructor(e,n){if(super(e,n),!this.unstable)throw new Error("Unstable value must be supplied")}get name(){return this.unstable}get altName(){return this.stable}}var ev=function(t){return t.Self="m.self",t.Pin="m.pin",t}({}),c_=new Ar("m.asset","org.matrix.msc3488.asset"),Lf=new Ar("m.ts","org.matrix.msc3488.ts"),l_=new Ar("m.location","org.matrix.msc3488.location"),ls=function(t){return t.Read="m.read",t.FullyRead="m.fully_read",t.ReadPrivate="m.read.private",t}({}),u_="main";function IF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function kF(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?IF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):IF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var _k=new Map;function Sk(t){return t instanceof String&&(t=t.toString()),_k.has(t)||_k.set(t,t),_k.get(t)}function B5(t,e){var n=e??new URLSearchParams,r=function(a){s!=null&&(Array.isArray(s)?s.forEach(c=>{n.append(a,String(c))}):n.append(a,String(s)))};for(var[i,s]of Object.entries(t))r(i);return n}function xF(t,e,n){var r=kF(kF({},n),{},{[e]:n[t]});return delete r[t],r}function xe(t,e){for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];r!=null&&(t=t.replace(n,encodeURIComponent(r)))}return t}function tC(t,e,n){var r;if(n){for(r=t.length-1;r>=0;r--)if(e(t[r],r,t))return t.splice(r,1),!0}else for(r=0;r<t.length;r++)if(e(t[r],r,t))return t.splice(r,1),!0;return!1}function $X(t,e){for(var n of e)if(!t.hasOwnProperty(n))throw new Error("Missing required key: "+n)}function d_(t){return JSON.parse(JSON.stringify(t))}function ff(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="number"&&isNaN(t)&&isNaN(e))return!0;if(t===null||e===null)return t===e;if(!(t instanceof Object)||t.constructor!==e.constructor||t.prototype!==e.prototype)return!1;if(t instanceof RegExp||t instanceof Date)return t.toString()===e.toString();if(Array.isArray(t)){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!ff(t[n],e[n]))return!1}else{for(var r in e)if(e.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;for(var i in t)if(e.hasOwnProperty(i)!==t.hasOwnProperty(i)||!ff(t[i],e[i]))return!1}return!0}function H5(t){if(typeof t!="object"||t==null||Array.isArray(t))return t;var e=[];for(var[n,r]of Object.entries(t))e.push([n,H5(r)]);return e.sort((i,s)=>qE(i[0],s[0])),e}function AF(t){return typeof t=="number"&&isFinite(t)}function Qd(t){return typeof t=="string"?ive(t.normalize("NFD").replace(mve,"")):""}function nC(t){return typeof t=="string"?t.replace(/[\u202d-\u202e]/g,""):""}function pve(t){return Qd(t.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()}var mve=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\u2800\u2062-\u2063\s]/g;function BX(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function HX(t){return BX(t).replace(/\\\*/g,".*").replace(/\?/g,".")}function Ek(t){return t!=null&&t.endsWith("/")?t.slice(0,-1):t}function _p(t,e){return new Promise(n=>{setTimeout(n,t,e)})}function Cat(t,e,n){return V5.apply(this,arguments)}function V5(){return V5=B(function*(t,e,n){var r=Date.now();try{return yield n()}finally{var i=Date.now();t.debug("[Perf]: ".concat(e," took ").concat(i-r,"ms"))}}),V5.apply(this,arguments)}function gve(t,e,n){var r=Date.now();try{return n()}finally{var i=Date.now();t.debug("[Perf]: ".concat(e," took ").concat(i-r,"ms"))}}function VX(t){return t==null}function og(t,e){return q5.apply(this,arguments)}function q5(){return q5=B(function*(t,e){for(var n of t)yield e(yield n)}),q5.apply(this,arguments)}function km(t){return Promise.resolve(t())}function vve(t,e){return hve(n=>t(n),{retries:1/0,shouldRetry:e?n=>{var{error:r}=n;return e(r)}:void 0,factor:2,minTimeout:3e3,maxTimeout:15e3})}var hf=(()=>{for(var t="",e=32;e<=126;e++)t+=String.fromCharCode(e);return t})();function PF(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:hf;return t.padEnd(e,n[0])}function ab(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hf,n=BigInt(e.length);if(t<=n){var r;return(r=e[Number(t)-1])!==null&&r!==void 0?r:""}var i=t/n,s=Number(t%n)-1;return s<0&&(i-=BigInt(Math.abs(s)),s=Number(n)-1),ab(i,e)+e[s]}function rC(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hf,n=BigInt(e.length),r=BigInt(0),i=t.length-1,s=BigInt(0);i>=0;i--,s++){var o=t.charCodeAt(i)-e.charCodeAt(0);r+=BigInt(1+o)*n**s}return r}function yve(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:hf,r=Math.max(t.length,e.length),i=rC(PF(t,r,n),n),s=rC(PF(e,r,n),n),o=(i+s)/BigInt(2);return o===i||o==s?ab(o,n)+n[0]:ab(o,n)}function h1(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hf;return ab(rC(t,e)+BigInt(1),e)}function LF(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hf;return ab(rC(t,e)-BigInt(1),e)}function qE(t,e){return t<e?-1:t>e?1:0}function qX(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;for(var[r,i]of Object.entries(e)){if(t[r]instanceof Object&&i){qX(t[r],i);continue}if(i!=null||!n){iC(t,r,i);continue}}return t}function OF(t){var e;return(e=Lf.findIn(t.getContent()))!==null&&e!==void 0?e:-1}function bve(t,e){return OF(e)-OF(t)}function OO(t){return[ls.Read,ls.ReadPrivate].includes(t)}function MF(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(o,a)=>o===a;if(t.size!==e.size)return!1;for(var[r,i]of t){var s=e.get(r);if(s===void 0||!n(i,s))return!1}return!0}function GX(t){return t instanceof Map?Mh(t):Array.isArray(t)?t.map(e=>GX(e)):t}function Mh(t){var e=new Map;for(var[n,r]of t)e.set(n,GX(r));return Object.fromEntries(e.entries())}function Ey(t){return t==="__proto__"||t==="prototype"||t==="constructor"}function iC(t,e,n){if(Ey(e))throw new Error("Trying to modify prototype or constructor");t[e]=n}function Ka(t){return!(Ey(t.room_id)||Ey(t.sender)||Ey(t.event_id))}class vu extends Map{constructor(e){super(),this.createDefault=e}getOrCreate(e){return this.has(e)||this.set(e,this.createDefault()),this.get(e)}}var G5="migrationState",tv=function(t){return t[t.NOT_STARTED=0]="NOT_STARTED",t[t.INITIAL_DATA_MIGRATED=1]="INITIAL_DATA_MIGRATED",t[t.OLM_SESSIONS_MIGRATED=2]="OLM_SESSIONS_MIGRATED",t[t.MEGOLM_SESSIONS_MIGRATED=3]="MEGOLM_SESSIONS_MIGRATED",t[t.ROOM_SETTINGS_MIGRATED=4]="ROOM_SETTINGS_MIGRATED",t[t.INITIAL_OWN_KEY_QUERY_DONE=5]="INITIAL_OWN_KEY_QUERY_DONE",t}({}),nv=50;function DF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function NF(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?DF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):DF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function _2(t,e){return encodeURIComponent(t)+"/"+encodeURIComponent(e)}function _ve(t){var e=t.split("/"),n=decodeURIComponent(e[0]),r=decodeURIComponent(e[1]);return{senderKey:n,sessionId:r}}class z3{constructor(){L(this,"migrationState",tv.NOT_STARTED),L(this,"account",null),L(this,"crossSigningKeys",null),L(this,"privateKeys",{}),L(this,"sessions",{}),L(this,"inboundGroupSessions",{}),L(this,"inboundGroupSessionsWithheld",{}),L(this,"rooms",{}),L(this,"sessionsNeedingBackup",{})}containsData(){var e=this;return B(function*(){return e.account!==null})()}startup(){var e=this;return B(function*(){return e})()}deleteAllData(){return Promise.resolve()}getMigrationState(){var e=this;return B(function*(){return e.migrationState})()}setMigrationState(e){var n=this;return B(function*(){n.migrationState=e})()}getAccount(e,n){n(this.account)}storeAccount(e,n){this.account=n}getCrossSigningKeys(e,n){n(this.crossSigningKeys)}getSecretStorePrivateKey(e,n,r){var i=this.privateKeys[r];n(i||null)}storeSecretStorePrivateKey(e,n,r){this.privateKeys[n]=r}countEndToEndSessions(e,n){var r=0;for(var i of Object.values(this.sessions))r+=Object.keys(i).length;n(r)}getEndToEndSession(e,n,r,i){var s=this.sessions[e]||{};i(s[n]||null)}getEndToEndSessions(e,n,r){r(this.sessions[e]||{})}storeEndToEndSession(e,n,r,i){var s=this.sessions[e];s===void 0&&(s={},this.sessions[e]=s),iC(s,n,r)}getEndToEndSessionsBatch(){var e=this;return B(function*(){var n=[];for(var r of Object.values(e.sessions))for(var i of Object.values(r))if(n.push(i),n.length>=nv)return n;return n.length===0?null:n})()}deleteEndToEndSessionsBatch(e){var n=this;return B(function*(){for(var{deviceKey:r,sessionId:i}of e){var s=n.sessions[r]||{};delete s[i],Object.keys(s).length===0&&delete n.sessions[r]}})()}getEndToEndInboundGroupSession(e,n,r,i){var s=_2(e,n);i(this.inboundGroupSessions[s]||null,this.inboundGroupSessionsWithheld[s]||null)}storeEndToEndInboundGroupSession(e,n,r,i){var s=_2(e,n);this.inboundGroupSessions[s]=r}countEndToEndInboundGroupSessions(){var e=this;return B(function*(){return Object.keys(e.inboundGroupSessions).length})()}getEndToEndInboundGroupSessionsBatch(){var e=this;return B(function*(){var n=[];for(var[r,i]of Object.entries(e.inboundGroupSessions))if(n.push(NF(NF({},_ve(r)),{},{sessionData:i,needsBackup:r in e.sessionsNeedingBackup})),n.length>=nv)return n;return n.length===0?null:n})()}deleteEndToEndInboundGroupSessionsBatch(e){var n=this;return B(function*(){for(var{senderKey:r,sessionId:i}of e){var s=_2(r,i);delete n.inboundGroupSessions[s]}})()}getEndToEndRooms(e,n){n(this.rooms)}markSessionsNeedingBackup(e){for(var n of e){var r=_2(n.senderKey,n.sessionId);this.sessionsNeedingBackup[r]=!0}return Promise.resolve()}doTxn(e,n,r){return Promise.resolve(r(null))}}var Sve=/^(?:(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:\[[\dA-Fa-f:.]{2,45}])|(?:[A-Za-z\d\-.]{1,255}))(?::\d{1,5})?$/;function Eve(t){var e=Sve.exec(t);return e?.[0]===t}var wve=/^[\w-]+$/;function Cve(t){var e=wve.exec(t);return e?.[0]===t}function W3(t,e,n,r,i){var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,o=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0;if(typeof e!="string"||!e)return"";if(!e.startsWith("mxc://"))return s?e:"";var[c,l,...d]=e.slice(6).split("/");if(d.length>0||!Eve(c)||!Cve(l))return"";a&&(o=!0);var h,m=!!n||!!r||!!i,g=m?"thumbnail":"download";a?h="/_matrix/client/v1/media/".concat(g):h="/_matrix/media/v3/".concat(g);var y=new URL("".concat(h,"/").concat(c,"/").concat(l),t);return n&&y.searchParams.set("width",Math.round(n).toString()),r&&y.searchParams.set("height",Math.round(r).toString()),i&&y.searchParams.set("method",i),typeof o=="boolean"&&y.searchParams.set("allow_redirect",JSON.stringify(o)),y.href}var GE={exports:{}},Tve=GE.exports,UF;function Rve(){return UF||(UF=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(Tve,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(v,w){var S=v[w];if(typeof S.bind=="function")return S.bind(v);try{return Function.prototype.bind.call(S,v)}catch{return function(){return Function.prototype.apply.apply(S,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&r?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function d(){for(var v=this.getLevel(),w=0;w<i.length;w++){var S=i[w];this[S]=w<v?e:this.methodFactory(S,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function h(v){return function(){typeof console!==n&&(d.call(this),this[v].apply(this,arguments))}}function m(v,w,S){return l(v)||h.apply(this,arguments)}function g(v,w){var S=this,R,x,T,I="loglevel";typeof v=="string"?I+=":"+v:typeof v=="symbol"&&(I=void 0);function k(U){var $=(i[U]||"silent").toUpperCase();if(!(typeof window===n||!I)){try{window.localStorage[I]=$;return}catch{}try{window.document.cookie=encodeURIComponent(I)+"="+$+";"}catch{}}}function A(){var U;if(!(typeof window===n||!I)){try{U=window.localStorage[I]}catch{}if(typeof U===n)try{var $=window.document.cookie,K=encodeURIComponent(I),Y=$.indexOf(K+"=");Y!==-1&&(U=/^([^;]+)/.exec($.slice(Y+K.length+1))[1])}catch{}return S.levels[U]===void 0&&(U=void 0),U}}function O(){if(!(typeof window===n||!I)){try{window.localStorage.removeItem(I)}catch{}try{window.document.cookie=encodeURIComponent(I)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function D(U){var $=U;if(typeof $=="string"&&S.levels[$.toUpperCase()]!==void 0&&($=S.levels[$.toUpperCase()]),typeof $=="number"&&$>=0&&$<=S.levels.SILENT)return $;throw new TypeError("log.setLevel() called with invalid level: "+U)}S.name=v,S.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},S.methodFactory=w||m,S.getLevel=function(){return T??x??R},S.setLevel=function(U,$){return T=D(U),$!==!1&&k(T),d.call(S)},S.setDefaultLevel=function(U){x=D(U),A()||S.setLevel(U,!1)},S.resetLevel=function(){T=null,O(),d.call(S)},S.enableAll=function(U){S.setLevel(S.levels.TRACE,U)},S.disableAll=function(U){S.setLevel(S.levels.SILENT,U)},S.rebuild=function(){if(o!==S&&(R=D(o.getLevel())),d.call(S),o===S)for(var U in s)s[U].rebuild()},R=D(o?o.getLevel():"WARN");var N=A();N!=null&&(T=D(N)),d.call(S)}o=new g,o.getLogger=function(w){if(typeof w!="symbol"&&typeof w!="string"||w==="")throw new TypeError("You must supply a name when creating a logger.");var S=s[w];return S||(S=s[w]=new g(w,o.methodFactory)),S};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return s},o.default=o,o})}(GE)),GE.exports}var Ive=Rve();const K5=cl(Ive);var kve="matrix";K5.methodFactory=function(t,e,n){return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.prefix&&i.unshift(this.prefix);var o=t==="error"||t==="warn"||t==="trace"||t==="info"||t==="debug";return o?console[t](...i):console.log(...i)}};function KX(t){var e=kve+(t===void 0?"":"-".concat(t)),n=K5.getLogger(e);return n.getChild===void 0&&(n.prefix=t,n.getChild=r=>{var i=KX((t??"")+r);return i.methodFactory=n.methodFactory,i.rebuild(),i},n.setLevel(K5.levels.DEBUG,!1)),n}var M=KX();class Tat{constructor(e,n){this.parent=e,L(this,"name",void 0),this.name=n+":"}trace(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.trace(this.name,...n)}debug(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.debug(this.name,...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.info(this.name,...n)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.warn(this.name,...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.error(this.name,...n)}}class MO{constructor(e){this.debugInstance=e}trace(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.debugWithPrefix("[TRACE]",...n)}debug(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.debugWithPrefix("[DEBUG]",...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.debugWithPrefix("[INFO]",...n)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.debugWithPrefix("[WARN]",...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.debugWithPrefix("[ERROR]",...n)}getChild(e){return new MO(this.debugInstance.extend(e))}debugWithPrefix(e){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];if(i.length===0)n="";else if(i[0]instanceof Error){var o=i.shift();n=o.stack||o.message}else typeof i[0]=="string"?n=i.shift():n="%O";this.debugInstance(e+" "+n,...i)}}var S2={exports:{}},jF;function xve(){if(jF)return S2.exports;jF=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(I,k,A){return Function.prototype.apply.call(I,k,A)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(I){return Object.getOwnPropertyNames(I).concat(Object.getOwnPropertySymbols(I))}:n=function(I){return Object.getOwnPropertyNames(I)};function r(T){console&&console.warn&&console.warn(T)}var i=Number.isNaN||function(I){return I!==I};function s(){s.init.call(this)}S2.exports=s,S2.exports.once=S,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(T){if(typeof T!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof T)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(T){if(typeof T!="number"||T<0||i(T))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+T+".");o=T}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(I){if(typeof I!="number"||I<0||i(I))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+I+".");return this._maxListeners=I,this};function c(T){return T._maxListeners===void 0?s.defaultMaxListeners:T._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(I){for(var k=[],A=1;A<arguments.length;A++)k.push(arguments[A]);var O=I==="error",D=this._events;if(D!==void 0)O=O&&D.error===void 0;else if(!O)return!1;if(O){var N;if(k.length>0&&(N=k[0]),N instanceof Error)throw N;var U=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw U.context=N,U}var $=D[I];if($===void 0)return!1;if(typeof $=="function")e($,this,k);else for(var K=$.length,Y=y($,K),A=0;A<K;++A)e(Y[A],this,k);return!0};function l(T,I,k,A){var O,D,N;if(a(k),D=T._events,D===void 0?(D=T._events=Object.create(null),T._eventsCount=0):(D.newListener!==void 0&&(T.emit("newListener",I,k.listener?k.listener:k),D=T._events),N=D[I]),N===void 0)N=D[I]=k,++T._eventsCount;else if(typeof N=="function"?N=D[I]=A?[k,N]:[N,k]:A?N.unshift(k):N.push(k),O=c(T),O>0&&N.length>O&&!N.warned){N.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+N.length+" "+String(I)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.emitter=T,U.type=I,U.count=N.length,r(U)}return T}s.prototype.addListener=function(I,k){return l(this,I,k,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(I,k){return l(this,I,k,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(T,I,k){var A={fired:!1,wrapFn:void 0,target:T,type:I,listener:k},O=d.bind(A);return O.listener=k,A.wrapFn=O,O}s.prototype.once=function(I,k){return a(k),this.on(I,h(this,I,k)),this},s.prototype.prependOnceListener=function(I,k){return a(k),this.prependListener(I,h(this,I,k)),this},s.prototype.removeListener=function(I,k){var A,O,D,N,U;if(a(k),O=this._events,O===void 0)return this;if(A=O[I],A===void 0)return this;if(A===k||A.listener===k)--this._eventsCount===0?this._events=Object.create(null):(delete O[I],O.removeListener&&this.emit("removeListener",I,A.listener||k));else if(typeof A!="function"){for(D=-1,N=A.length-1;N>=0;N--)if(A[N]===k||A[N].listener===k){U=A[N].listener,D=N;break}if(D<0)return this;D===0?A.shift():v(A,D),A.length===1&&(O[I]=A[0]),O.removeListener!==void 0&&this.emit("removeListener",I,U||k)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(I){var k,A,O;if(A=this._events,A===void 0)return this;if(A.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):A[I]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete A[I]),this;if(arguments.length===0){var D=Object.keys(A),N;for(O=0;O<D.length;++O)N=D[O],N!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(k=A[I],typeof k=="function")this.removeListener(I,k);else if(k!==void 0)for(O=k.length-1;O>=0;O--)this.removeListener(I,k[O]);return this};function m(T,I,k){var A=T._events;if(A===void 0)return[];var O=A[I];return O===void 0?[]:typeof O=="function"?k?[O.listener||O]:[O]:k?w(O):y(O,O.length)}s.prototype.listeners=function(I){return m(this,I,!0)},s.prototype.rawListeners=function(I){return m(this,I,!1)},s.listenerCount=function(T,I){return typeof T.listenerCount=="function"?T.listenerCount(I):g.call(T,I)},s.prototype.listenerCount=g;function g(T){var I=this._events;if(I!==void 0){var k=I[T];if(typeof k=="function")return 1;if(k!==void 0)return k.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function y(T,I){for(var k=new Array(I),A=0;A<I;++A)k[A]=T[A];return k}function v(T,I){for(;I+1<T.length;I++)T[I]=T[I+1];T.pop()}function w(T){for(var I=new Array(T.length),k=0;k<I.length;++k)I[k]=T[k].listener||T[k];return I}function S(T,I){return new Promise(function(k,A){function O(N){T.removeListener(I,D),A(N)}function D(){typeof T.removeListener=="function"&&T.removeListener("error",O),k([].slice.call(arguments))}x(T,I,D,{once:!0}),I!=="error"&&R(T,O,{once:!0})})}function R(T,I,k){typeof T.on=="function"&&x(T,"error",I,k)}function x(T,I,k,A){if(typeof T.on=="function")A.once?T.once(I,k):T.on(I,k);else if(typeof T.addEventListener=="function")T.addEventListener(I,function O(D){A.once&&T.removeEventListener(I,O),k(D)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof T)}return S2.exports}var Y3=xve();const zX=cl(Y3);var WX=function(t){return t.NewListener="newListener",t.RemoveListener="removeListener",t.Error="error",t}({});class On extends Y3.EventEmitter{addListener(e,n){return super.addListener(e,n)}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return super.emit(e,...r)}emitPromised(e){var n=arguments,r=this;return B(function*(){for(var i=n.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=n[o];var a=r.listeners(e);return Promise.allSettled(a.map(c=>c(...s))).then(()=>a.length>0)})()}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}off(e,n){return super.off(e,n)}on(e,n){return super.on(e,n)}once(e,n){return super.once(e,n)}prependListener(e,n){return super.prependListener(e,n)}prependOnceListener(e,n){return super.prependOnceListener(e,n)}removeAllListeners(e){return e===void 0?super.removeAllListeners():super.removeAllListeners(e)}removeListener(e,n){return super.removeListener(e,n)}rawListeners(e){return super.rawListeners(e)}}var Z=function(t){return t.RoomCanonicalAlias="m.room.canonical_alias",t.RoomCreate="m.room.create",t.RoomJoinRules="m.room.join_rules",t.RoomMember="m.room.member",t.RoomThirdPartyInvite="m.room.third_party_invite",t.RoomPowerLevels="m.room.power_levels",t.RoomName="m.room.name",t.RoomTopic="m.room.topic",t.RoomAvatar="m.room.avatar",t.RoomPinnedEvents="m.room.pinned_events",t.RoomEncryption="m.room.encryption",t.RoomHistoryVisibility="m.room.history_visibility",t.RoomGuestAccess="m.room.guest_access",t.RoomServerAcl="m.room.server_acl",t.RoomTombstone="m.room.tombstone",t.RoomPredecessor="org.matrix.msc3946.room_predecessor",t.PolicyRuleUser="m.policy.rule.user",t.PolicyRuleRoom="m.policy.rule.room",t.PolicyRuleServer="m.policy.rule.server",t.SpaceChild="m.space.child",t.SpaceParent="m.space.parent",t.RoomRedaction="m.room.redaction",t.RoomMessage="m.room.message",t.RoomMessageEncrypted="m.room.encrypted",t.Sticker="m.sticker",t.CallInvite="m.call.invite",t.CallCandidates="m.call.candidates",t.CallAnswer="m.call.answer",t.CallHangup="m.call.hangup",t.CallReject="m.call.reject",t.CallSelectAnswer="m.call.select_answer",t.CallNegotiate="m.call.negotiate",t.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",t.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",t.CallReplaces="m.call.replaces",t.CallAssertedIdentity="m.call.asserted_identity",t.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",t.CallEncryptionKeysPrefix="io.element.call.encryption_keys",t.KeyVerificationRequest="m.key.verification.request",t.KeyVerificationStart="m.key.verification.start",t.KeyVerificationCancel="m.key.verification.cancel",t.KeyVerificationMac="m.key.verification.mac",t.KeyVerificationDone="m.key.verification.done",t.KeyVerificationKey="m.key.verification.key",t.KeyVerificationAccept="m.key.verification.accept",t.KeyVerificationReady="m.key.verification.ready",t.RoomMessageFeedback="m.room.message.feedback",t.Reaction="m.reaction",t.PollStart="org.matrix.msc3381.poll.start",t.Typing="m.typing",t.Receipt="m.receipt",t.Presence="m.presence",t.FullyRead="m.fully_read",t.Tag="m.tag",t.SpaceOrder="org.matrix.msc3230.space_order",t.PushRules="m.push_rules",t.Direct="m.direct",t.IgnoredUserList="m.ignored_user_list",t.RoomKey="m.room_key",t.RoomKeyRequest="m.room_key_request",t.ForwardedRoomKey="m.forwarded_room_key",t.Dummy="m.dummy",t.SecretRequest="m.secret.request",t.SecretSend="m.secret.send",t.GroupCallPrefix="org.matrix.msc3401.call",t.GroupCallMemberPrefix="org.matrix.msc3401.call.member",t.CallNotify="org.matrix.msc4075.call.notify",t.RTCNotification="org.matrix.msc4075.rtc.notification",t.RTCDecline="org.matrix.msc4310.rtc.decline",t}({}),vn=function(t){return t.Annotation="m.annotation",t.Replace="m.replace",t.Reference="m.reference",t.Thread="m.thread",t}({}),ll=function(t){return t.Text="m.text",t.Emote="m.emote",t.Notice="m.notice",t.Image="m.image",t.File="m.file",t.Audio="m.audio",t.Location="m.location",t.Video="m.video",t.KeyVerificationRequest="m.key.verification.request",t}({}),sC="type",wg=function(t){return t.Space="m.space",t.UnstableCall="org.matrix.msc3417.call",t.ElementVideo="io.element.video",t}({}),X3="org.matrix.msgid",z5=new Ar("m.room.purpose","org.matrix.msc3088.purpose"),W5=new Ar("m.enabled","org.matrix.msc3088.enabled"),Y5=new Ar("m.data_tree","org.matrix.msc3089.data_tree"),YX=new Ar("m.leaf","org.matrix.msc3089.leaf"),ru=new Ar("m.branch","org.matrix.msc3089.branch"),XX=new Ar("m.room.marker","org.matrix.msc2716.marker"),X5=new Ar("with_rel_types","org.matrix.msc3912.with_relations"),JX=new Ar("io.element.functional_members","io.element.functional_members"),Dh=new Ar("m.visibility","org.matrix.msc3531.visibility"),J5=new Ar("enabled","org.matrix.msc3881.enabled"),Ave=new Ar("device_id","org.matrix.msc3881.device_id"),QX=new Ar("m.local_notification_settings","org.matrix.msc3890.local_notification_settings"),oC=new Ar("thread_id","org.matrix.msc4023.thread_id"),ZX=new a_("membership","io.element.msc4115.membership"),Be=function(t){return t.Ban="ban",t.Invite="invite",t.Join="join",t.Knock="knock",t.Leave="leave",t}({}),Vs=function(t){return t.Membership="RoomMember.membership",t.Name="RoomMember.name",t.PowerLevel="RoomMember.powerLevel",t.Typing="RoomMember.typing",t}({});class cb extends On{constructor(e,n){super(),this.roomId=e,this.userId=n,L(this,"_isOutOfBand",!1),L(this,"modified",-1),L(this,"requestedProfileInfo",!1),L(this,"typing",!1),L(this,"name",void 0),L(this,"rawDisplayName",void 0),L(this,"powerLevel",0),L(this,"user",void 0),L(this,"membership",void 0),L(this,"disambiguate",!1),L(this,"events",{}),this.name=n,this.rawDisplayName=n,this.updateModifiedTime()}markOutOfBand(){this._isOutOfBand=!0}isOutOfBand(){return this._isOutOfBand}setMembershipEvent(e,n){var r,i,s=(r=e.getDirectionalContent().displayname)!==null&&r!==void 0?r:"";if(e.getType()===Z.RoomMember){this._isOutOfBand=!1,this.events.member=e;var o=this.membership;this.membership=e.getDirectionalContent().membership,this.membership===void 0&&M.trace("membership event with membership undefined (forwardLooking: ".concat(e.forwardLooking,")!"),e.getContent(),"prevcontent is ",e.getPrevContent()),this.disambiguate=Ove(this.userId,s,n);var a=this.name;this.name=Mve(this.userId,s,this.disambiguate),this.rawDisplayName=nC((i=e.getDirectionalContent().displayname)!==null&&i!==void 0?i:""),(!this.rawDisplayName||!Qd(this.rawDisplayName))&&(this.rawDisplayName=this.userId),o!==this.membership&&(this.updateModifiedTime(),this.emit(Vs.Membership,e,this,o)),a!==this.name&&(this.updateModifiedTime(),this.emit(Vs.Name,e,this,a))}}setPowerLevel(e,n){var r=this.powerLevel;this.powerLevel=e,r!==this.powerLevel&&(this.updateModifiedTime(),this.emit(Vs.PowerLevel,n,this))}setTypingEvent(e){if(e.getType()==="m.typing"){var n=this.typing;this.typing=!1;var r=e.getContent().user_ids;Array.isArray(r)&&(r.indexOf(this.userId)!==-1&&(this.typing=!0),n!==this.typing&&(this.updateModifiedTime(),this.emit(Vs.Typing,e,this)))}}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}isKicked(){return this.membership===Be.Leave&&this.events.member!==void 0&&this.events.member.getSender()!==this.events.member.getStateKey()}getDMInviter(){if(this.events.member){var e=this.events.member,n=e.getContent(),r=e.getSender();if(n.membership===Be.Join&&(n=e.getPrevContent(),r=e.getUnsigned().prev_sender),n.membership===Be.Invite&&n.is_direct)return r}}getAvatarUrl(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1,c=this.getMxcAvatarUrl();if(!c&&!s)return null;var l=W3(e,c,n,r,i,o,void 0,a);return l||null}getMxcAvatarUrl(){if(this.events.member)return this.events.member.getDirectionalContent().avatar_url;if(this.user)return this.user.avatarUrl}}var Pve=/@.+:.+/,Lve=/[\u200E\u200F\u202A-\u202F]/;function Ove(t,e,n){if(!e||e===t||!n)return!1;var r=Qd(e);if(!r)return!1;if(Pve.test(r)||Lve.test(e))return!0;var i=n.getUserIdsWithDisplayName(e);return!!i.some(s=>s!==t)}function Mve(t,e,n){return!e||e===t?t:n?nC(e)+" ("+t+")":Qd(e)?nC(e):t}var wk={},p1={},m1={},FF;function eJ(){if(FF)return m1;FF=1,Object.defineProperty(m1,"__esModule",{value:!0}),m1.NamespacedMap=void 0;function t(c,l){var d=typeof Symbol<"u"&&c[Symbol.iterator]||c["@@iterator"];if(!d){if(Array.isArray(c)||(d=e(c))||l){d&&(c=d);var h=0,m=function(){};return{s:m,n:function(){return h>=c.length?{done:!0}:{done:!1,value:c[h++]}},e:function(S){throw S},f:m}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var g=!0,y=!1,v;return{s:function(){d=d.call(c)},n:function(){var S=d.next();return g=S.done,S},e:function(S){y=!0,v=S},f:function(){try{!g&&d.return!=null&&d.return()}finally{if(y)throw v}}}}function e(c,l){if(c){if(typeof c=="string")return n(c,l);var d=Object.prototype.toString.call(c).slice(8,-1);if(d==="Object"&&c.constructor&&(d=c.constructor.name),d==="Map"||d==="Set")return Array.from(c);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return n(c,l)}}function n(c,l){(l==null||l>c.length)&&(l=c.length);for(var d=0,h=new Array(l);d<l;d++)h[d]=c[d];return h}function r(c,l){if(!(c instanceof l))throw new TypeError("Cannot call a class as a function")}function i(c,l){for(var d=0;d<l.length;d++){var h=l[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}function s(c,l,d){return l&&i(c.prototype,l),Object.defineProperty(c,"prototype",{writable:!1}),c}function o(c,l,d){return l in c?Object.defineProperty(c,l,{value:d,enumerable:!0,configurable:!0,writable:!0}):c[l]=d,c}var a=function(){function c(l){if(r(this,c),o(this,"internalMap",new Map),l){var d=t(l),h;try{for(d.s();!(h=d.n()).done;){var m=h.value;this.set(m[0],m[1])}}catch(g){d.e(g)}finally{d.f()}}}return s(c,[{key:"get",value:function(d){return d.name&&this.internalMap.has(d.name)?this.internalMap.get(d.name):d.altName&&this.internalMap.has(d.altName)?this.internalMap.get(d.altName):null}},{key:"set",value:function(d,h){d.name&&this.internalMap.set(d.name,h),d.altName&&this.internalMap.set(d.altName,h)}},{key:"has",value:function(d){return!!this.get(d)}},{key:"delete",value:function(d){d.name&&this.internalMap.delete(d.name),d.altName&&this.internalMap.delete(d.altName)}},{key:"hasNamespaced",value:function(d){return this.internalMap.has(d)}},{key:"getNamespaced",value:function(d){return this.internalMap.get(d)}}]),c}();return m1.NamespacedMap=a,m1}var g1={},$F;function Uv(){if($F)return g1;$F=1;function t(y){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},t(y)}Object.defineProperty(g1,"__esModule",{value:!0}),g1.InvalidEventError=void 0;function e(y,v,w){return Object.defineProperty(y,"prototype",{writable:!1}),y}function n(y,v){if(!(y instanceof v))throw new TypeError("Cannot call a class as a function")}function r(y,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function");y.prototype=Object.create(v&&v.prototype,{constructor:{value:y,writable:!0,configurable:!0}}),Object.defineProperty(y,"prototype",{writable:!1}),v&&h(y,v)}function i(y){var v=l();return function(){var S=m(y),R;if(v){var x=m(this).constructor;R=Reflect.construct(S,arguments,x)}else R=S.apply(this,arguments);return s(this,R)}}function s(y,v){if(v&&(t(v)==="object"||typeof v=="function"))return v;if(v!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return o(y)}function o(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}function a(y){var v=typeof Map=="function"?new Map:void 0;return a=function(S){if(S===null||!d(S))return S;if(typeof S!="function")throw new TypeError("Super expression must either be null or a function");if(typeof v<"u"){if(v.has(S))return v.get(S);v.set(S,R)}function R(){return c(S,arguments,m(this).constructor)}return R.prototype=Object.create(S.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),h(R,S)},a(y)}function c(y,v,w){return l()?c=Reflect.construct:c=function(R,x,T){var I=[null];I.push.apply(I,x);var k=Function.bind.apply(R,I),A=new k;return T&&h(A,T.prototype),A},c.apply(null,arguments)}function l(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function d(y){return Function.toString.call(y).indexOf("[native code]")!==-1}function h(y,v){return h=Object.setPrototypeOf||function(S,R){return S.__proto__=R,S},h(y,v)}function m(y){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(w){return w.__proto__||Object.getPrototypeOf(w)},m(y)}var g=function(y){r(w,y);var v=i(w);function w(S){return n(this,w),v.call(this,S)}return e(w)}(a(Error));return g1.InvalidEventError=g,g1}var xm={},v1={},y1={},BF;function f_(){if(BF)return y1;BF=1,Object.defineProperty(y1,"__esModule",{value:!0}),y1.ExtensibleEvent=void 0;function t(i,s){if(!(i instanceof s))throw new TypeError("Cannot call a class as a function")}function e(i,s){for(var o=0;o<s.length;o++){var a=s[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}}function n(i,s,o){return s&&e(i.prototype,s),Object.defineProperty(i,"prototype",{writable:!1}),i}var r=function(){function i(s){t(this,i),this.wireFormat=s}return n(i,[{key:"wireContent",get:function(){return this.wireFormat.content}}]),i}();return y1.ExtensibleEvent=r,y1}var b1={},HF;function tJ(){if(HF)return b1;HF=1,Object.defineProperty(b1,"__esModule",{value:!0}),b1.isOptionalAString=t,b1.isProvided=e;function t(n){return e(n)&&typeof n=="string"}function e(n){return n!=null}return b1}var fo={},dh={},VF;function jv(){if(VF)return dh;VF=1;function t(g){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},t(g)}Object.defineProperty(dh,"__esModule",{value:!0}),dh.UnstableValue=dh.NamespacedValue=void 0;function e(g,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function");g.prototype=Object.create(y&&y.prototype,{constructor:{value:g,writable:!0,configurable:!0}}),Object.defineProperty(g,"prototype",{writable:!1}),y&&n(g,y)}function n(g,y){return n=Object.setPrototypeOf||function(w,S){return w.__proto__=S,w},n(g,y)}function r(g){var y=o();return function(){var w=a(g),S;if(y){var R=a(this).constructor;S=Reflect.construct(w,arguments,R)}else S=w.apply(this,arguments);return i(this,S)}}function i(g,y){if(y&&(t(y)==="object"||typeof y=="function"))return y;if(y!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return s(g)}function s(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function o(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function a(g){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(v){return v.__proto__||Object.getPrototypeOf(v)},a(g)}function c(g,y){if(!(g instanceof y))throw new TypeError("Cannot call a class as a function")}function l(g,y){for(var v=0;v<y.length;v++){var w=y[v];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(g,w.key,w)}}function d(g,y,v){return y&&l(g.prototype,y),Object.defineProperty(g,"prototype",{writable:!1}),g}var h=function(){function g(y,v){if(c(this,g),this.stable=y,this.unstable=v,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return d(g,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(v){return!!this.name&&this.name===v||!!this.altName&&this.altName===v}},{key:"findIn",value:function(v){var w;return this.name&&(w=v?.[this.name]),!w&&this.altName&&(w=v?.[this.altName]),w}},{key:"includedIn",value:function(v){var w=!1;return this.name&&(w=v.includes(this.name)),!w&&this.altName&&(w=v.includes(this.altName)),w}}]),g}();dh.NamespacedValue=h;var m=function(g){e(v,g);var y=r(v);function v(w,S){var R;if(c(this,v),R=y.call(this,w,S),!R.unstable)throw new Error("Unstable value must be supplied");return R}return d(v,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),v}(h);return dh.UnstableValue=m,dh}var qF;function ul(){if(qF)return fo;qF=1,Object.defineProperty(fo,"__esModule",{value:!0}),fo.M_TEXT=fo.M_NOTICE=fo.M_MESSAGE=fo.M_HTML=fo.M_EMOTE=void 0;var t=jv(),e=new t.UnstableValue("m.message","org.matrix.msc1767.message");fo.M_MESSAGE=e;var n=new t.UnstableValue("m.text","org.matrix.msc1767.text");fo.M_TEXT=n;var r=new t.UnstableValue("m.html","org.matrix.msc1767.html");fo.M_HTML=r;var i=new t.UnstableValue("m.emote","org.matrix.msc1767.emote");fo.M_EMOTE=i;var s=new t.UnstableValue("m.notice","org.matrix.msc1767.notice");return fo.M_NOTICE=s,fo}var E2={},GF;function Sp(){if(GF)return E2;GF=1,Object.defineProperty(E2,"__esModule",{value:!0}),E2.isEventTypeSame=t;function t(e,n){if(typeof e=="string")return typeof n=="string"?n===e:n.matches(e);if(typeof n=="string")return e.matches(n);var r=n,i=e;return r.matches(i.name)||r.matches(i.altName)}return E2}var KF;function Ep(){if(KF)return v1;KF=1;function t(T){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},t(T)}Object.defineProperty(v1,"__esModule",{value:!0}),v1.MessageEvent=void 0;var e=f_(),n=tJ(),r=Uv(),i=ul(),s=Sp();function o(T,I){var k=Object.keys(T);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(T);I&&(A=A.filter(function(O){return Object.getOwnPropertyDescriptor(T,O).enumerable})),k.push.apply(k,A)}return k}function a(T){for(var I=1;I<arguments.length;I++){var k=arguments[I]!=null?arguments[I]:{};I%2?o(Object(k),!0).forEach(function(A){R(T,A,k[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(T,Object.getOwnPropertyDescriptors(k)):o(Object(k)).forEach(function(A){Object.defineProperty(T,A,Object.getOwnPropertyDescriptor(k,A))})}return T}function c(T,I){if(!(T instanceof I))throw new TypeError("Cannot call a class as a function")}function l(T,I){for(var k=0;k<I.length;k++){var A=I[k];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(T,A.key,A)}}function d(T,I,k){return I&&l(T.prototype,I),k&&l(T,k),Object.defineProperty(T,"prototype",{writable:!1}),T}function h(T,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(I&&I.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),Object.defineProperty(T,"prototype",{writable:!1}),I&&m(T,I)}function m(T,I){return m=Object.setPrototypeOf||function(A,O){return A.__proto__=O,A},m(T,I)}function g(T){var I=w();return function(){var A=S(T),O;if(I){var D=S(this).constructor;O=Reflect.construct(A,arguments,D)}else O=A.apply(this,arguments);return y(this,O)}}function y(T,I){if(I&&(t(I)==="object"||typeof I=="function"))return I;if(I!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return v(T)}function v(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function w(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(T){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(k){return k.__proto__||Object.getPrototypeOf(k)},S(T)}function R(T,I,k){return I in T?Object.defineProperty(T,I,{value:k,enumerable:!0,configurable:!0,writable:!0}):T[I]=k,T}var x=function(T){h(k,T);var I=g(k);function k(A){var O;c(this,k),O=I.call(this,A),R(v(O),"text",void 0),R(v(O),"html",void 0),R(v(O),"renderings",void 0);var D=i.M_MESSAGE.findIn(O.wireContent),N=i.M_TEXT.findIn(O.wireContent),U=i.M_HTML.findIn(O.wireContent);if((0,n.isProvided)(D)){if(!Array.isArray(D))throw new r.InvalidEventError("m.message contents must be an array");var $=D.find(function(Y){return!(0,n.isProvided)(Y.mimetype)||Y.mimetype==="text/plain"}),K=D.find(function(Y){return Y.mimetype==="text/html"});if(!$)throw new r.InvalidEventError("m.message is missing a plain text representation");O.text=$.body,O.html=K?.body,O.renderings=D}else if((0,n.isOptionalAString)(N))O.text=N,O.html=U,O.renderings=[{body:N,mimetype:"text/plain"}],O.html&&O.renderings.push({body:O.html,mimetype:"text/html"});else throw new r.InvalidEventError("Missing textual representation for event");return O}return d(k,[{key:"isEmote",get:function(){return i.M_EMOTE.matches(this.wireFormat.type)||(0,n.isProvided)(i.M_EMOTE.findIn(this.wireFormat.content))}},{key:"isNotice",get:function(){return i.M_NOTICE.matches(this.wireFormat.type)||(0,n.isProvided)(i.M_NOTICE.findIn(this.wireFormat.content))}},{key:"isEquivalentTo",value:function(O){return(0,s.isEventTypeSame)(O,i.M_MESSAGE)}},{key:"serializeMMessageOnly",value:function(){var O=R({},i.M_MESSAGE.name,this.renderings);if(this.renderings.length===1){var D=this.renderings[0].mimetype;(D===void 0||D==="text/plain")&&(O=R({},i.M_TEXT.name,this.renderings[0].body))}return O}},{key:"serialize",value:function(){var O;return{type:"m.room.message",content:a(a({},this.serializeMMessageOnly()),{},{body:this.text,msgtype:"m.text",format:this.html?"org.matrix.custom.html":void 0,formatted_body:(O=this.html)!==null&&O!==void 0?O:void 0})}}}],[{key:"from",value:function(O,D){var N;return new k({type:i.M_MESSAGE.name,content:(N={},R(N,i.M_TEXT.name,O),R(N,i.M_HTML.name,D),N)})}}]),k}(e.ExtensibleEvent);return v1.MessageEvent=x,v1}var _1={},zF;function DO(){if(zF)return _1;zF=1;function t(R){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},t(R)}Object.defineProperty(_1,"__esModule",{value:!0}),_1.NoticeEvent=void 0;var e=Ep(),n=ul(),r=Sp();function i(R,x,T){return x in R?Object.defineProperty(R,x,{value:T,enumerable:!0,configurable:!0,writable:!0}):R[x]=T,R}function s(R,x){if(!(R instanceof x))throw new TypeError("Cannot call a class as a function")}function o(R,x){for(var T=0;T<x.length;T++){var I=x[T];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(R,I.key,I)}}function a(R,x,T){return x&&o(R.prototype,x),T&&o(R,T),Object.defineProperty(R,"prototype",{writable:!1}),R}function c(){return typeof Reflect<"u"&&Reflect.get?c=Reflect.get:c=function(x,T,I){var k=l(x,T);if(k){var A=Object.getOwnPropertyDescriptor(k,T);return A.get?A.get.call(arguments.length<3?x:I):A.value}},c.apply(this,arguments)}function l(R,x){for(;!Object.prototype.hasOwnProperty.call(R,x)&&(R=w(R),R!==null););return R}function d(R,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(x&&x.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),Object.defineProperty(R,"prototype",{writable:!1}),x&&h(R,x)}function h(R,x){return h=Object.setPrototypeOf||function(I,k){return I.__proto__=k,I},h(R,x)}function m(R){var x=v();return function(){var I=w(R),k;if(x){var A=w(this).constructor;k=Reflect.construct(I,arguments,A)}else k=I.apply(this,arguments);return g(this,k)}}function g(R,x){if(x&&(t(x)==="object"||typeof x=="function"))return x;if(x!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return y(R)}function y(R){if(R===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}function v(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function w(R){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(T){return T.__proto__||Object.getPrototypeOf(T)},w(R)}var S=function(R){d(T,R);var x=m(T);function T(I){return s(this,T),x.call(this,I)}return a(T,[{key:"isNotice",get:function(){return!0}},{key:"isEquivalentTo",value:function(k){return(0,r.isEventTypeSame)(k,n.M_NOTICE)||c(w(T.prototype),"isEquivalentTo",this).call(this,k)}},{key:"serialize",value:function(){var k=c(w(T.prototype),"serialize",this).call(this);return k.content.msgtype="m.notice",k}}],[{key:"from",value:function(k,A){var O;return new T({type:n.M_NOTICE.name,content:(O={},i(O,n.M_TEXT.name,k),i(O,n.M_HTML.name,A),O)})}}]),T}(e.MessageEvent);return _1.NoticeEvent=S,_1}var S1={},WF;function NO(){if(WF)return S1;WF=1;function t(R){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},t(R)}Object.defineProperty(S1,"__esModule",{value:!0}),S1.EmoteEvent=void 0;var e=Ep(),n=ul(),r=Sp();function i(R,x,T){return x in R?Object.defineProperty(R,x,{value:T,enumerable:!0,configurable:!0,writable:!0}):R[x]=T,R}function s(R,x){if(!(R instanceof x))throw new TypeError("Cannot call a class as a function")}function o(R,x){for(var T=0;T<x.length;T++){var I=x[T];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(R,I.key,I)}}function a(R,x,T){return x&&o(R.prototype,x),T&&o(R,T),Object.defineProperty(R,"prototype",{writable:!1}),R}function c(){return typeof Reflect<"u"&&Reflect.get?c=Reflect.get:c=function(x,T,I){var k=l(x,T);if(k){var A=Object.getOwnPropertyDescriptor(k,T);return A.get?A.get.call(arguments.length<3?x:I):A.value}},c.apply(this,arguments)}function l(R,x){for(;!Object.prototype.hasOwnProperty.call(R,x)&&(R=w(R),R!==null););return R}function d(R,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(x&&x.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),Object.defineProperty(R,"prototype",{writable:!1}),x&&h(R,x)}function h(R,x){return h=Object.setPrototypeOf||function(I,k){return I.__proto__=k,I},h(R,x)}function m(R){var x=v();return function(){var I=w(R),k;if(x){var A=w(this).constructor;k=Reflect.construct(I,arguments,A)}else k=I.apply(this,arguments);return g(this,k)}}function g(R,x){if(x&&(t(x)==="object"||typeof x=="function"))return x;if(x!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return y(R)}function y(R){if(R===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}function v(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function w(R){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(T){return T.__proto__||Object.getPrototypeOf(T)},w(R)}var S=function(R){d(T,R);var x=m(T);function T(I){return s(this,T),x.call(this,I)}return a(T,[{key:"isEmote",get:function(){return!0}},{key:"isEquivalentTo",value:function(k){return(0,r.isEventTypeSame)(k,n.M_EMOTE)||c(w(T.prototype),"isEquivalentTo",this).call(this,k)}},{key:"serialize",value:function(){var k=c(w(T.prototype),"serialize",this).call(this);return k.content.msgtype="m.emote",k}}],[{key:"from",value:function(k,A){var O;return new T({type:n.M_EMOTE.name,content:(O={},i(O,n.M_TEXT.name,k),i(O,n.M_HTML.name,A),O)})}}]),T}(e.MessageEvent);return S1.EmoteEvent=S,S1}var YF;function nJ(){if(YF)return xm;YF=1,Object.defineProperty(xm,"__esModule",{value:!0}),xm.LEGACY_M_ROOM_MESSAGE=void 0,xm.parseMRoomMessage=l;var t=Ep(),e=DO(),n=NO(),r=jv(),i=ul();function s(d,h){var m=Object.keys(d);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(d);h&&(g=g.filter(function(y){return Object.getOwnPropertyDescriptor(d,y).enumerable})),m.push.apply(m,g)}return m}function o(d){for(var h=1;h<arguments.length;h++){var m=arguments[h]!=null?arguments[h]:{};h%2?s(Object(m),!0).forEach(function(g){a(d,g,m[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(m)):s(Object(m)).forEach(function(g){Object.defineProperty(d,g,Object.getOwnPropertyDescriptor(m,g))})}return d}function a(d,h,m){return h in d?Object.defineProperty(d,h,{value:m,enumerable:!0,configurable:!0,writable:!0}):d[h]=m,d}var c=new r.NamespacedValue("m.room.message");xm.LEGACY_M_ROOM_MESSAGE=c;function l(d){var h,m,g;if(i.M_MESSAGE.findIn(d.content)||i.M_TEXT.findIn(d.content))return new t.MessageEvent(d);var y=(h=d.content)===null||h===void 0?void 0:h.msgtype,v=(m=d.content)===null||m===void 0?void 0:m.body,w=((g=d.content)===null||g===void 0?void 0:g.format)==="org.matrix.custom.html"?d.content.formatted_body:null;if(y==="m.text"){var S;return new t.MessageEvent(o(o({},d),{},{content:o(o({},d.content),{},(S={},a(S,i.M_TEXT.name,v),a(S,i.M_HTML.name,w),S))}))}else if(y==="m.notice"){var R;return new e.NoticeEvent(o(o({},d),{},{content:o(o({},d.content),{},(R={},a(R,i.M_TEXT.name,v),a(R,i.M_HTML.name,w),R))}))}else if(y==="m.emote"){var x;return new n.EmoteEvent(o(o({},d),{},{content:o(o({},d.content),{},(x={},a(x,i.M_TEXT.name,v),a(x,i.M_HTML.name,w),x))}))}else return null}return xm}var w2={},XF;function rJ(){if(XF)return w2;XF=1,Object.defineProperty(w2,"__esModule",{value:!0}),w2.parseMMessage=i;var t=Ep(),e=ul(),n=NO(),r=DO();function i(s){return e.M_EMOTE.matches(s.type)?new n.EmoteEvent(s):e.M_NOTICE.matches(s.type)?new r.NoticeEvent(s):new t.MessageEvent(s)}return w2}var ho={},JF;function Fv(){if(JF)return ho;JF=1,Object.defineProperty(ho,"__esModule",{value:!0}),ho.M_POLL_START=ho.M_POLL_RESPONSE=ho.M_POLL_KIND_UNDISCLOSED=ho.M_POLL_KIND_DISCLOSED=ho.M_POLL_END=void 0;var t=jv(),e=new t.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");ho.M_POLL_KIND_DISCLOSED=e;var n=new t.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");ho.M_POLL_KIND_UNDISCLOSED=n;var r=new t.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");ho.M_POLL_START=r;var i=new t.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");ho.M_POLL_RESPONSE=i;var s=new t.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");return ho.M_POLL_END=s,ho}var C2={},fh={},QF;function iJ(){if(QF)return fh;QF=1;function t(G){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},t(G)}Object.defineProperty(fh,"__esModule",{value:!0}),fh.PollStartEvent=fh.PollAnswerSubevent=void 0;var e=Fv(),n=Ep(),r=ul(),i=Uv(),s=jv(),o=Sp(),a=f_();function c(G){return m(G)||h(G)||d(G)||l()}function l(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function d(G,F){if(G){if(typeof G=="string")return g(G,F);var q=Object.prototype.toString.call(G).slice(8,-1);if(q==="Object"&&G.constructor&&(q=G.constructor.name),q==="Map"||q==="Set")return Array.from(G);if(q==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(q))return g(G,F)}}function h(G){if(typeof Symbol<"u"&&G[Symbol.iterator]!=null||G["@@iterator"]!=null)return Array.from(G)}function m(G){if(Array.isArray(G))return g(G)}function g(G,F){(F==null||F>G.length)&&(F=G.length);for(var q=0,z=new Array(F);q<F;q++)z[q]=G[q];return z}function y(G,F){var q=Object.keys(G);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(G);F&&(z=z.filter(function(W){return Object.getOwnPropertyDescriptor(G,W).enumerable})),q.push.apply(q,z)}return q}function v(G){for(var F=1;F<arguments.length;F++){var q=arguments[F]!=null?arguments[F]:{};F%2?y(Object(q),!0).forEach(function(z){N(G,z,q[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(G,Object.getOwnPropertyDescriptors(q)):y(Object(q)).forEach(function(z){Object.defineProperty(G,z,Object.getOwnPropertyDescriptor(q,z))})}return G}function w(G,F){if(!(G instanceof F))throw new TypeError("Cannot call a class as a function")}function S(G,F){for(var q=0;q<F.length;q++){var z=F[q];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(G,z.key,z)}}function R(G,F,q){return F&&S(G.prototype,F),q&&S(G,q),Object.defineProperty(G,"prototype",{writable:!1}),G}function x(G,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function");G.prototype=Object.create(F&&F.prototype,{constructor:{value:G,writable:!0,configurable:!0}}),Object.defineProperty(G,"prototype",{writable:!1}),F&&T(G,F)}function T(G,F){return T=Object.setPrototypeOf||function(z,W){return z.__proto__=W,z},T(G,F)}function I(G){var F=O();return function(){var z=D(G),W;if(F){var V=D(this).constructor;W=Reflect.construct(z,arguments,V)}else W=z.apply(this,arguments);return k(this,W)}}function k(G,F){if(F&&(t(F)==="object"||typeof F=="function"))return F;if(F!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return A(G)}function A(G){if(G===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return G}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(G){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(q){return q.__proto__||Object.getPrototypeOf(q)},D(G)}function N(G,F,q){return F in G?Object.defineProperty(G,F,{value:q,enumerable:!0,configurable:!0,writable:!0}):G[F]=q,G}var U=function(G){x(q,G);var F=I(q);function q(z){var W;w(this,q),W=F.call(this,z),N(A(W),"id",void 0);var V=z.content.id;if(!V||typeof V!="string")throw new i.InvalidEventError("Answer ID must be a non-empty string");return W.id=V,W}return R(q,[{key:"serialize",value:function(){return{type:"org.matrix.sdk.poll.answer",content:v({id:this.id},this.serializeMMessageOnly())}}}],[{key:"from",value:function(W,V){return new q({type:"org.matrix.sdk.poll.answer",content:N({id:W},r.M_TEXT.name,V)})}}]),q}(n.MessageEvent);fh.PollAnswerSubevent=U;var $=function(G){x(q,G);var F=I(q);function q(z){var W;w(this,q),W=F.call(this,z),N(A(W),"question",void 0),N(A(W),"kind",void 0),N(A(W),"rawKind",void 0),N(A(W),"maxSelections",void 0),N(A(W),"answers",void 0);var V=e.M_POLL_START.findIn(W.wireContent);if(!V.question)throw new i.InvalidEventError("A question is required");if(W.question=new n.MessageEvent({type:"org.matrix.sdk.poll.question",content:V.question}),W.rawKind=V.kind,e.M_POLL_KIND_DISCLOSED.matches(W.rawKind)?W.kind=e.M_POLL_KIND_DISCLOSED:W.kind=e.M_POLL_KIND_UNDISCLOSED,W.maxSelections=Number.isFinite(V.max_selections)&&V.max_selections>0?V.max_selections:1,!Array.isArray(V.answers))throw new i.InvalidEventError("Poll answers must be an array");var X=V.answers.slice(0,20).map(function(ne){return new U({type:"org.matrix.sdk.poll.answer",content:ne})});if(X.length<=0)throw new i.InvalidEventError("No answers available");return W.answers=X,W}return R(q,[{key:"isEquivalentTo",value:function(W){return(0,o.isEventTypeSame)(W,e.M_POLL_START)}},{key:"serialize",value:function(){var W;return{type:e.M_POLL_START.name,content:(W={},N(W,e.M_POLL_START.name,{question:this.question.serialize().content,kind:this.rawKind,max_selections:this.maxSelections,answers:this.answers.map(function(V){return V.serialize().content})}),N(W,r.M_TEXT.name,"".concat(this.question.text,`
`).concat(this.answers.map(function(V,X){return"".concat(X+1,". ").concat(V.text)}).join(`
`))),W)}}}],[{key:"from",value:function(W,V,X){var ne,fe=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;return new q({type:e.M_POLL_START.name,content:(ne={},N(ne,r.M_TEXT.name,W),N(ne,e.M_POLL_START.name,{question:N({},r.M_TEXT.name,W),kind:X instanceof s.NamespacedValue?X.name:X,max_selections:fe,answers:V.map(function(ye){return N({id:Y()},r.M_TEXT.name,ye)})}),ne)})}}]),q}(a.ExtensibleEvent);fh.PollStartEvent=$;var K="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";function Y(){return c(Array(16)).map(function(){return K.charAt(Math.floor(Math.random()*K.length))}).join("")}return fh}var E1={},w1={},ZF;function UO(){if(ZF)return w1;ZF=1,Object.defineProperty(w1,"__esModule",{value:!0}),w1.REFERENCE_RELATION=void 0;var t=jv(),e=new t.NamespacedValue("m.reference");return w1.REFERENCE_RELATION=e,w1}var e$;function sJ(){if(e$)return E1;e$=1;function t(R){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},t(R)}Object.defineProperty(E1,"__esModule",{value:!0}),E1.PollResponseEvent=void 0;var e=f_(),n=Fv(),r=Uv(),i=UO(),s=Sp();function o(R,x){if(!(R instanceof x))throw new TypeError("Cannot call a class as a function")}function a(R,x){for(var T=0;T<x.length;T++){var I=x[T];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(R,I.key,I)}}function c(R,x,T){return x&&a(R.prototype,x),T&&a(R,T),Object.defineProperty(R,"prototype",{writable:!1}),R}function l(R,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(x&&x.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),Object.defineProperty(R,"prototype",{writable:!1}),x&&d(R,x)}function d(R,x){return d=Object.setPrototypeOf||function(I,k){return I.__proto__=k,I},d(R,x)}function h(R){var x=y();return function(){var I=v(R),k;if(x){var A=v(this).constructor;k=Reflect.construct(I,arguments,A)}else k=I.apply(this,arguments);return m(this,k)}}function m(R,x){if(x&&(t(x)==="object"||typeof x=="function"))return x;if(x!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return g(R)}function g(R){if(R===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}function y(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function v(R){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(T){return T.__proto__||Object.getPrototypeOf(T)},v(R)}function w(R,x,T){return x in R?Object.defineProperty(R,x,{value:T,enumerable:!0,configurable:!0,writable:!0}):R[x]=T,R}var S=function(R){l(T,R);var x=h(T);function T(I){var k;o(this,T),k=x.call(this,I),w(g(k),"internalAnswerIds",void 0),w(g(k),"internalSpoiled",void 0),w(g(k),"pollEventId",void 0);var A=k.wireContent["m.relates_to"];if(!i.REFERENCE_RELATION.matches(A?.rel_type)||typeof A?.event_id!="string")throw new r.InvalidEventError("Relationship must be a reference to an event");return k.pollEventId=A.event_id,k.validateAgainst(null),k}return c(T,[{key:"answerIds",get:function(){return this.internalAnswerIds}},{key:"spoiled",get:function(){return this.internalSpoiled}},{key:"validateAgainst",value:function(k){var A=n.M_POLL_RESPONSE.findIn(this.wireContent);if(!Array.isArray(A?.answers)){this.internalSpoiled=!0,this.internalAnswerIds=[];return}var O=A.answers;if(O.some(function(D){return typeof D!="string"})||O.length===0){this.internalSpoiled=!0,this.internalAnswerIds=[];return}if(k){if(O.some(function(D){return!k.answers.some(function(N){return N.id===D})})){this.internalSpoiled=!0,this.internalAnswerIds=[];return}O=O.slice(0,k.maxSelections)}this.internalAnswerIds=O,this.internalSpoiled=!1}},{key:"isEquivalentTo",value:function(k){return(0,s.isEventTypeSame)(k,n.M_POLL_RESPONSE)}},{key:"serialize",value:function(){return{type:n.M_POLL_RESPONSE.name,content:w({"m.relates_to":{rel_type:i.REFERENCE_RELATION.name,event_id:this.pollEventId}},n.M_POLL_RESPONSE.name,{answers:this.spoiled?void 0:this.answerIds})}}}],[{key:"from",value:function(k,A){return new T({type:n.M_POLL_RESPONSE.name,content:w({"m.relates_to":{rel_type:i.REFERENCE_RELATION.name,event_id:A}},n.M_POLL_RESPONSE.name,{answers:k})})}}]),T}(e.ExtensibleEvent);return E1.PollResponseEvent=S,E1}var C1={},t$;function oJ(){if(t$)return C1;t$=1;function t(k){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},t(k)}Object.defineProperty(C1,"__esModule",{value:!0}),C1.PollEndEvent=void 0;var e=Fv(),n=Uv(),r=UO(),i=Ep(),s=ul(),o=Sp(),a=f_();function c(k,A){var O=Object.keys(k);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(k);A&&(D=D.filter(function(N){return Object.getOwnPropertyDescriptor(k,N).enumerable})),O.push.apply(O,D)}return O}function l(k){for(var A=1;A<arguments.length;A++){var O=arguments[A]!=null?arguments[A]:{};A%2?c(Object(O),!0).forEach(function(D){T(k,D,O[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(O)):c(Object(O)).forEach(function(D){Object.defineProperty(k,D,Object.getOwnPropertyDescriptor(O,D))})}return k}function d(k,A){if(!(k instanceof A))throw new TypeError("Cannot call a class as a function")}function h(k,A){for(var O=0;O<A.length;O++){var D=A[O];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(k,D.key,D)}}function m(k,A,O){return A&&h(k.prototype,A),O&&h(k,O),Object.defineProperty(k,"prototype",{writable:!1}),k}function g(k,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function");k.prototype=Object.create(A&&A.prototype,{constructor:{value:k,writable:!0,configurable:!0}}),Object.defineProperty(k,"prototype",{writable:!1}),A&&y(k,A)}function y(k,A){return y=Object.setPrototypeOf||function(D,N){return D.__proto__=N,D},y(k,A)}function v(k){var A=R();return function(){var D=x(k),N;if(A){var U=x(this).constructor;N=Reflect.construct(D,arguments,U)}else N=D.apply(this,arguments);return w(this,N)}}function w(k,A){if(A&&(t(A)==="object"||typeof A=="function"))return A;if(A!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return S(k)}function S(k){if(k===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return k}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function x(k){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)},x(k)}function T(k,A,O){return A in k?Object.defineProperty(k,A,{value:O,enumerable:!0,configurable:!0,writable:!0}):k[A]=O,k}var I=function(k){g(O,k);var A=v(O);function O(D){var N;d(this,O),N=A.call(this,D),T(S(N),"pollEventId",void 0),T(S(N),"closingMessage",void 0);var U=N.wireContent["m.relates_to"];if(!r.REFERENCE_RELATION.matches(U?.rel_type)||typeof U?.event_id!="string")throw new n.InvalidEventError("Relationship must be a reference to an event");return N.pollEventId=U.event_id,N.closingMessage=new i.MessageEvent(N.wireFormat),N}return m(O,[{key:"isEquivalentTo",value:function(N){return(0,o.isEventTypeSame)(N,e.M_POLL_END)}},{key:"serialize",value:function(){return{type:e.M_POLL_END.name,content:l(T({"m.relates_to":{rel_type:r.REFERENCE_RELATION.name,event_id:this.pollEventId}},e.M_POLL_END.name,{}),this.closingMessage.serialize().content)}}}],[{key:"from",value:function(N,U){var $;return new O({type:e.M_POLL_END.name,content:($={"m.relates_to":{rel_type:r.REFERENCE_RELATION.name,event_id:N}},T($,e.M_POLL_END.name,{}),T($,s.M_TEXT.name,U),$)})}}]),O}(a.ExtensibleEvent);return C1.PollEndEvent=I,C1}var n$;function aJ(){if(n$)return C2;n$=1,Object.defineProperty(C2,"__esModule",{value:!0}),C2.parseMPoll=i;var t=Fv(),e=iJ(),n=sJ(),r=oJ();function i(s){return t.M_POLL_START.matches(s.type)?new e.PollStartEvent(s):t.M_POLL_RESPONSE.matches(s.type)?new n.PollResponseEvent(s):t.M_POLL_END.matches(s.type)?new r.PollEndEvent(s):null}return C2}var r$;function Dve(){if(r$)return p1;r$=1,Object.defineProperty(p1,"__esModule",{value:!0}),p1.ExtensibleEvents=void 0;var t=eJ(),e=Uv(),n=nJ(),r=rJ(),i=ul(),s=Fv(),o=aJ();function a(v,w){var S=typeof Symbol<"u"&&v[Symbol.iterator]||v["@@iterator"];if(!S){if(Array.isArray(v)||(S=c(v))||w){S&&(v=S);var R=0,x=function(){};return{s:x,n:function(){return R>=v.length?{done:!0}:{done:!1,value:v[R++]}},e:function(O){throw O},f:x}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var T=!0,I=!1,k;return{s:function(){S=S.call(v)},n:function(){var O=S.next();return T=O.done,O},e:function(O){I=!0,k=O},f:function(){try{!T&&S.return!=null&&S.return()}finally{if(I)throw k}}}}function c(v,w){if(v){if(typeof v=="string")return l(v,w);var S=Object.prototype.toString.call(v).slice(8,-1);if(S==="Object"&&v.constructor&&(S=v.constructor.name),S==="Map"||S==="Set")return Array.from(v);if(S==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(S))return l(v,w)}}function l(v,w){(w==null||w>v.length)&&(w=v.length);for(var S=0,R=new Array(w);S<w;S++)R[S]=v[S];return R}function d(v,w){if(!(v instanceof w))throw new TypeError("Cannot call a class as a function")}function h(v,w){for(var S=0;S<w.length;S++){var R=w[S];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(v,R.key,R)}}function m(v,w,S){return w&&h(v.prototype,w),S&&h(v,S),Object.defineProperty(v,"prototype",{writable:!1}),v}function g(v,w,S){return w in v?Object.defineProperty(v,w,{value:S,enumerable:!0,configurable:!0,writable:!0}):v[w]=S,v}var y=function(){function v(){d(this,v),g(this,"interpreters",new t.NamespacedMap([[n.LEGACY_M_ROOM_MESSAGE,n.parseMRoomMessage],[i.M_MESSAGE,r.parseMMessage],[i.M_EMOTE,r.parseMMessage],[i.M_NOTICE,r.parseMMessage],[s.M_POLL_START,o.parseMPoll],[s.M_POLL_RESPONSE,o.parseMPoll],[s.M_POLL_END,o.parseMPoll]])),g(this,"_unknownInterpretOrder",[i.M_MESSAGE])}return m(v,[{key:"unknownInterpretOrder",get:function(){var S;return(S=this._unknownInterpretOrder)!==null&&S!==void 0?S:[]},set:function(S){this._unknownInterpretOrder=S}},{key:"registerInterpreter",value:function(S,R){this.interpreters.set(S,R)}},{key:"parse",value:function(S){try{if(this.interpreters.hasNamespaced(S.type))return this.interpreters.getNamespaced(S.type)(S);var R=a(this.unknownInterpretOrder),x;try{for(R.s();!(x=R.n()).done;){var T=x.value;if(this.interpreters.has(T)){var I=this.interpreters.get(T)(S);if(I)return I}}}catch(k){R.e(k)}finally{R.f()}return null}catch(k){if(k instanceof e.InvalidEventError)return null;throw k}}}],[{key:"defaultInstance",get:function(){return v._defaultInstance}},{key:"unknownInterpretOrder",get:function(){return v.defaultInstance.unknownInterpretOrder},set:function(S){v.defaultInstance.unknownInterpretOrder=S}},{key:"registerInterpreter",value:function(S,R){v.defaultInstance.registerInterpreter(S,R)}},{key:"parse",value:function(S){return v.defaultInstance.parse(S)}}]),v}();return p1.ExtensibleEvents=y,g(y,"_defaultInstance",new y),p1}var Ck={},i$;function Nve(){return i$||(i$=1,Object.defineProperty(Ck,"__esModule",{value:!0})),Ck}var hh={},s$;function Uve(){if(s$)return hh;s$=1,Object.defineProperty(hh,"__esModule",{value:!0}),hh.LegacyMsgType=void 0,hh.isEventLike=n;var t=ul(),e;hh.LegacyMsgType=e,function(r){r.Text="m.text",r.Notice="m.notice",r.Emote="m.emote"}(e||(hh.LegacyMsgType=e={}));function n(r,i){var s=r.content;return i===e.Text?t.M_MESSAGE.matches(r.type)||r.type==="m.room.message"&&s?.msgtype==="m.text":i===e.Emote?t.M_EMOTE.matches(r.type)||r.type==="m.room.message"&&s?.msgtype==="m.emote":i===e.Notice?t.M_NOTICE.matches(r.type)||r.type==="m.room.message"&&s?.msgtype==="m.notice":!1}return hh}var o$;function jve(){return o$||(o$=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Dve();Object.keys(e).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===e[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return e[k]}})});var n=Nve();Object.keys(n).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===n[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return n[k]}})});var r=Uv();Object.keys(r).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===r[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return r[k]}})});var i=jv();Object.keys(i).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===i[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return i[k]}})});var s=eJ();Object.keys(s).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===s[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return s[k]}})});var o=tJ();Object.keys(o).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===o[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return o[k]}})});var a=Uve();Object.keys(a).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===a[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return a[k]}})});var c=Sp();Object.keys(c).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===c[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return c[k]}})});var l=nJ();Object.keys(l).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===l[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return l[k]}})});var d=rJ();Object.keys(d).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===d[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return d[k]}})});var h=aJ();Object.keys(h).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===h[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return h[k]}})});var m=UO();Object.keys(m).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===m[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return m[k]}})});var g=f_();Object.keys(g).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===g[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return g[k]}})});var y=ul();Object.keys(y).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===y[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return y[k]}})});var v=Ep();Object.keys(v).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===v[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return v[k]}})});var w=NO();Object.keys(w).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===w[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return w[k]}})});var S=DO();Object.keys(S).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===S[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return S[k]}})});var R=Fv();Object.keys(R).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===R[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return R[k]}})});var x=iJ();Object.keys(x).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===x[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return x[k]}})});var T=sJ();Object.keys(T).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===T[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return T[k]}})});var I=oJ();Object.keys(I).forEach(function(k){k==="default"||k==="__esModule"||k in t&&t[k]===I[k]||Object.defineProperty(t,k,{enumerable:!0,get:function(){return I[k]}})})}(wk)),wk}var to=jve();const Fve="modulepreload",$ve=function(t,e){return new URL(t,e).href},a$={},lb=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let l=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=a?.nonce||a?.getAttribute("nonce");i=l(n.map(d=>{if(d=$ve(d,r),d in a$)return;a$[d]=!0;const h=d.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(!!r)for(let v=o.length-1;v>=0;v--){const w=o[v];if(w.href===d&&(!h||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${m}`))return;const y=document.createElement("link");if(y.rel=h?"stylesheet":Fve,h||(y.as="script"),y.crossOrigin="",y.href=d,c&&y.setAttribute("nonce",c),document.head.appendChild(y),h)return new Promise((v,w)=>{y.addEventListener("load",v),y.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};function Bve(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.includes(r))continue;n[r]=t[r]}return n}function Hve(t,e){if(t==null)return{};var n,r,i=Bve(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.includes(n)||{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var Ui=function(t){return t.DisplayName="User.displayName",t.AvatarUrl="User.avatarUrl",t.Presence="User.presence",t.CurrentlyActive="User.currentlyActive",t.LastPresenceTs="User.lastPresenceTs",t}({});class yu extends On{constructor(e){super(),this.userId=e,L(this,"modified",-1),L(this,"displayName",void 0),L(this,"rawDisplayName",void 0),L(this,"avatarUrl",void 0),L(this,"presenceStatusMsg",void 0),L(this,"presence","offline"),L(this,"lastActiveAgo",0),L(this,"lastPresenceTs",0),L(this,"currentlyActive",!1),L(this,"events",{}),this.displayName=e,this.rawDisplayName=e,this.updateModifiedTime()}static createUser(e,n){var r=new yu(e);return n.reEmitter.reEmit(r,[Ui.AvatarUrl,Ui.DisplayName,Ui.Presence,Ui.CurrentlyActive,Ui.LastPresenceTs]),r}setPresenceEvent(e){if(e.getType()==="m.presence"){var n=this.events.presence===null;this.events.presence=e;var r=[];(e.getContent().presence!==this.presence||n)&&r.push(Ui.Presence),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&r.push(Ui.AvatarUrl),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&r.push(Ui.DisplayName),e.getContent().currently_active!==void 0&&e.getContent().currently_active!==this.currentlyActive&&r.push(Ui.CurrentlyActive),this.presence=e.getContent().presence,r.push(Ui.LastPresenceTs),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime();for(var i of r)this.emit(i,e,this)}}setDisplayName(e){var n=this.displayName;this.displayName=e,e!==n&&this.updateModifiedTime()}setRawDisplayName(e){this.rawDisplayName=e}setAvatarUrl(e){var n=this.avatarUrl;this.avatarUrl=e,e!==n&&this.updateModifiedTime()}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getLastActiveTs(){return this.lastPresenceTs-this.lastActiveAgo}}var ht=function(t){return t.Backward="b",t.Forward="f",t}({});class Me{static setEventMetadata(e,n,r){e.setMetadata(n,r)}constructor(e){var n,r;this.eventTimelineSet=e,L(this,"roomId",void 0),L(this,"name",void 0),L(this,"events",[]),L(this,"baseIndex",0),L(this,"startState",void 0),L(this,"endState",void 0),L(this,"startToken",null),L(this,"endToken",null),L(this,"prevTimeline",null),L(this,"nextTimeline",null),L(this,"paginationRequests",{[ht.Backward]:null,[ht.Forward]:null}),this.roomId=(n=(r=e.room)===null||r===void 0?void 0:r.roomId)!==null&&n!==void 0?n:null,this.roomId&&(this.startState=new gb(this.roomId),this.endState=new gb(this.roomId)),this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+new Date().toISOString()}initialiseState(e){var n,r,{timelineWasEmpty:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.events.length>0)throw new Error("Cannot initialise state after events are added");(n=this.startState)===null||n===void 0||n.setStateEvents(e,{timelineWasEmpty:i}),(r=this.endState)===null||r===void 0||r.setStateEvents(e,{timelineWasEmpty:i})}forkLive(e){var n=this.getState(e),r=new Me(this.eventTimelineSet);return r.startState=n?.clone(),r.endState=n,this.endState=n?.clone(),r}fork(e){var n=this.getState(e),r=new Me(this.eventTimelineSet);return r.startState=n?.clone(),r.endState=n?.clone(),r}getRoomId(){return this.roomId}getFilter(){return this.eventTimelineSet.getFilter()}getTimelineSet(){return this.eventTimelineSet}getBaseIndex(){return this.baseIndex}getEvents(){return this.events}getState(e){if(e==Me.BACKWARDS)return this.startState;if(e==Me.FORWARDS)return this.endState;throw new Error("Invalid direction '"+e+"'")}getPaginationToken(e){return this.roomId?this.getState(e).paginationToken:e===ht.Backward?this.startToken:this.endToken}setPaginationToken(e,n){this.roomId?this.getState(n).paginationToken=e:n===ht.Backward?this.startToken=e:this.endToken=e}getNeighbouringTimeline(e){if(e==Me.BACKWARDS)return this.prevTimeline;if(e==Me.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+e+"'")}setNeighbouringTimeline(e,n){if(this.getNeighbouringTimeline(n))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+n+")");if(n==Me.BACKWARDS)this.prevTimeline=e;else if(n==Me.FORWARDS)this.nextTimeline=e;else throw new Error("Invalid direction '"+n+"'");this.setPaginationToken(null,n)}addEvent(e,n){var{toStartOfTimeline:r,roomState:i,timelineWasEmpty:s,addToState:o}=n;i||(i=r?this.startState:this.endState);var a=this.getTimelineSet();if(a.room&&(Me.setEventMetadata(e,i,r),o&&e.isState()&&a.room.getUnfilteredTimelineSet()===a)){var c;(c=i)===null||c===void 0||c.setStateEvents([e],{timelineWasEmpty:s}),(!e.sender||e.getType()===Z.RoomMember&&!r)&&Me.setEventMetadata(e,i,r)}var l;r?l=0:l=this.events.length,this.events.splice(l,0,e),r&&this.baseIndex++}insertEvent(e,n,r,i){var s=this.getTimelineSet();s.room&&(Me.setEventMetadata(e,r,!1),i&&e.isState()&&s.room.getUnfilteredTimelineSet()===s&&(r.setStateEvents([e],{}),(!e.sender||e.getType()===Z.RoomMember)&&Me.setEventMetadata(e,r,!1))),this.events.splice(n,0,e)}removeEvent(e){for(var n=this.events.length-1;n>=0;n--){var r=this.events[n];if(r.getId()==e)return this.events.splice(n,1),n<this.baseIndex&&this.baseIndex--,r}return null}toString(){return this.name}}L(Me,"BACKWARDS",ht.Backward);L(Me,"FORWARDS",ht.Forward);var KE=function(t){return t.Add="Relations.add",t.Remove="Relations.remove",t.Redaction="Relations.redaction",t}({}),Vve=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return[n,...r].includes(e)};class jO extends On{constructor(e,n,r,i){var s;super(),s=this,this.relationType=e,this.eventType=n,this.altEventTypes=i,L(this,"relationEventIds",new Set),L(this,"relations",new Set),L(this,"annotationsByKey",{}),L(this,"annotationsBySender",{}),L(this,"sortedAnnotationsByKey",[]),L(this,"targetEvent",null),L(this,"creationEmitted",!1),L(this,"client",void 0),L(this,"onEventStatus",(o,a)=>{if(!o.isSending()){o.removeListener(Kt.Status,this.onEventStatus);return}a===rt.CANCELLED&&(o.removeListener(Kt.Status,this.onEventStatus),this.removeEvent(o))}),L(this,"onBeforeRedaction",function(){var o=B(function*(a){if(s.relations.has(a)){if(s.relations.delete(a),s.relationType===vn.Annotation)s.removeAnnotationFromAggregation(a);else if(s.relationType===vn.Replace&&s.targetEvent&&!s.targetEvent.isState()){var c=yield s.getLastReplacement();s.targetEvent.makeReplaced(c)}a.removeListener(Kt.BeforeRedaction,s.onBeforeRedaction),s.emit(KE.Redaction,a)}});return function(a){return o.apply(this,arguments)}}()),this.client=r instanceof Q3?r.client:r}addEvent(e){var n=this;return B(function*(){if(!n.relationEventIds.has(e.getId())){var r=e.getRelation();if(!r){M.error("Event must have relation info");return}var i=r.rel_type,s=e.getType();if(n.relationType!==i||!Vve(s,n.eventType,n.altEventTypes)){M.error("Event relation info doesn't match this container");return}if(e.isSending()&&e.on(Kt.Status,n.onEventStatus),n.relations.add(e),n.relationEventIds.add(e.getId()),n.relationType===vn.Annotation)n.addAnnotationToAggregation(e);else if(n.relationType===vn.Replace&&n.targetEvent&&!n.targetEvent.isState()){var o=yield n.getLastReplacement();n.targetEvent.makeReplaced(o)}e.on(Kt.BeforeRedaction,n.onBeforeRedaction),n.emit(KE.Add,e),n.maybeEmitCreated()}})()}removeEvent(e){var n=this;return B(function*(){if(n.relations.has(e)){if(n.relations.delete(e),n.relationType===vn.Annotation)n.removeAnnotationFromAggregation(e);else if(n.relationType===vn.Replace&&n.targetEvent&&!n.targetEvent.isState()){var r=yield n.getLastReplacement();n.targetEvent.makeReplaced(r)}n.emit(KE.Remove,e)}})()}getRelations(){return[...this.relations]}addAnnotationToAggregation(e){var n,{key:r}=(n=e.getRelation())!==null&&n!==void 0?n:{};if(r){var i=this.annotationsByKey[r];i||(i=this.annotationsByKey[r]=new Set,this.sortedAnnotationsByKey.push([r,i])),i.add(e),this.sortedAnnotationsByKey.sort((a,c)=>{var l=a[1],d=c[1];return d.size-l.size});var s=e.getSender(),o=this.annotationsBySender[s];o||(o=this.annotationsBySender[s]=new Set),o.add(e)}}removeAnnotationFromAggregation(e){var n,{key:r}=(n=e.getRelation())!==null&&n!==void 0?n:{};if(r){var i=this.annotationsByKey[r];i&&(i.delete(e),this.sortedAnnotationsByKey.sort((a,c)=>{var l=a[1],d=c[1];return d.size-l.size}));var s=e.getSender(),o=this.annotationsBySender[s];o&&o.delete(e)}}getSortedAnnotationsByKey(){return this.relationType!==vn.Annotation?null:this.sortedAnnotationsByKey}getAnnotationsBySender(){return this.relationType!==vn.Annotation?null:this.annotationsBySender}getLastReplacement(){var e=this;return B(function*(){if(e.relationType!==vn.Replace||!e.targetEvent)return null;var n=e.targetEvent.getServerAggregatedRelation(vn.Replace),r=n?.origin_server_ts,i=e.getRelations().reduce((s,o)=>o.getSender()!==e.targetEvent.getSender()||r&&r>o.getTs()||s&&s.getTs()>o.getTs()?s:o,null);return i!=null&&i.shouldAttemptDecryption()&&e.client.getCrypto()?yield i.attemptDecryption(e.client.getCrypto()):i!=null&&i.isBeingDecrypted()&&(yield i.getDecryptionPromise()),i})()}setTargetEvent(e){var n=this;return B(function*(){if(!n.targetEvent){if(n.targetEvent=e,n.relationType===vn.Replace&&!n.targetEvent.isState()){var r=yield n.getLastReplacement();r&&n.targetEvent.makeReplaced(r)}n.maybeEmitCreated()}})()}maybeEmitCreated(){this.creationEmitted||!this.targetEvent||!this.relations.size||(this.creationEmitted=!0,this.targetEvent.emit(Kt.RelationsCreated,this.relationType,this.eventType))}}class cJ{constructor(e,n){this.client=e,this.room=n,L(this,"relations",new Map)}getChildEventsForEvent(e,n,r){var i;return(i=this.relations.get(e))===null||i===void 0||(i=i.get(n))===null||i===void 0?void 0:i.get(r)}getAllChildEventsForEvent(e){var n,r=(n=this.relations.get(e))!==null&&n!==void 0?n:new Map,i=[];for(var s of r.values())for(var o of s.values())i.push(...o.getRelations());return i}aggregateParentEvent(e){var n=this.relations.get(e.getId());if(n)for(var r of n.values())for(var i of r.values())i.setTargetEvent(e)}aggregateChildEvent(e,n){if(!(e.isRedacted()||e.status===rt.CANCELLED)){var r=e.getRelation();if(r){var i=()=>{if(e.isDecryptionFailure()){e.once(Kt.Decrypted,i);return}this.aggregateChildEvent(e,n)};if(e.isBeingDecrypted()||e.shouldAttemptDecryption()){e.once(Kt.Decrypted,i);return}var{event_id:s,rel_type:o}=r,a=e.getType(),c=this.relations.get(s);c||(c=new Map,this.relations.set(s,c));var l=c.get(o);l||(l=new Map,c.set(o,l));var d=l.get(a);if(!d){var h,m,g;d=new jO(o,a,this.client),l.set(a,d);var y=(h=this.room)!==null&&h!==void 0?h:n?.room,v=(m=(g=n?.findEventById(s))!==null&&g!==void 0?g:y?.findEventById(s))!==null&&m!==void 0?m:y?.getPendingEvent(s);v&&d.setTargetEvent(v)}d.addEvent(e)}}}}var Zm;Zm=M.log.bind(M);var wy=function(t){return t.Ignore="ignore",t.Replace="replace",t}({});class ag extends On{constructor(e){var n,r,i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;super(),this.room=e,this.thread=a,this.threadListType=c,L(this,"relations",void 0),L(this,"timelineSupport",void 0),L(this,"displayPendingEvents",void 0),L(this,"liveTimeline",void 0),L(this,"timelines",void 0),L(this,"_eventIdToTimeline",new Map),L(this,"filter",void 0),this.timelineSupport=!!s.timelineSupport,this.liveTimeline=new Me(this),this.displayPendingEvents=s.pendingEvents!==!1,this.timelines=[this.liveTimeline],this._eventIdToTimeline=new Map,this.filter=s.filter,this.relations=(n=(r=this.room)===null||r===void 0?void 0:r.relations)!==null&&n!==void 0?n:new cJ((i=e?.client)!==null&&i!==void 0?i:o)}getTimelines(){return this.timelines}getFilter(){return this.filter}setFilter(e){this.filter=e}getPendingEvents(){return!this.room||!this.displayPendingEvents?[]:this.room.getPendingEvents()}getLiveTimeline(){return this.liveTimeline}setLiveTimeline(e){this.liveTimeline=e}eventIdToTimeline(e){return this._eventIdToTimeline.get(e)}replaceEventId(e,n){var r=this._eventIdToTimeline.get(e);r&&(this._eventIdToTimeline.delete(e),this._eventIdToTimeline.set(n,r))}resetLiveTimeline(e,n){var r=!this.timelineSupport||!n,i=this.liveTimeline,s=r?i.forkLive(Me.FORWARDS):i.fork(Me.FORWARDS);r?(this.timelines=[s],this._eventIdToTimeline=new Map):this.timelines.push(s),n&&i.setPaginationToken(n,Me.FORWARDS),s.setPaginationToken(e??null,Me.BACKWARDS),this.liveTimeline=s,this.emit(ke.TimelineReset,this.room,this,r)}getTimelineForEvent(e){if(e==null)return null;var n=this._eventIdToTimeline.get(e);return n===void 0?null:n}findEventById(e){var n=this.getTimelineForEvent(e);if(n)return n.getEvents().find(function(r){return r.getId()==e})}addTimeline(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");var e=new Me(this);return this.timelines.push(e),e}addEventsToTimeline(e,n,r,i,s){if(!i)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!n&&i==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(!(this.filter&&(e=this.filter.filterRoomTimeline(e),!e.length))){var o=n?Me.BACKWARDS:Me.FORWARDS,a=n?Me.FORWARDS:Me.BACKWARDS,c=!1,l=!1;for(var d of e){var h=d.getId(),m=this._eventIdToTimeline.get(h);if(!m){this.addEventToTimeline(d,i,{toStartOfTimeline:n,addToState:r}),l=!0,c=!0;continue}if(l=!1,m==i){Zm("Event "+h+" already in timeline "+i);continue}var g=i.getNeighbouringTimeline(o);if(g){m==g?Zm("Event "+h+" in neighbouring timeline - switching to "+m):Zm("Event "+h+" already in a different timeline "+m),i=m;continue}M.info("Already have timeline for "+h+" - joining timeline "+i+" to "+m);var y=m===this.liveTimeline,v=i===this.liveTimeline,w=o===Me.BACKWARDS&&y,S=o===Me.FORWARDS&&v;if(w||S){w&&M.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+m+")"),S&&M.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+i+")");continue}i.setNeighbouringTimeline(m,o),m.setNeighbouringTimeline(i,a),i=m,c=!0}if(l||!c){if(o===Me.FORWARDS&&i===this.liveTimeline){M.warn({lastEventWasNew:l,didUpdate:c}),M.warn("Refusing to set forwards pagination token of live timeline "+"".concat(i," to ").concat(s));return}i.setPaginationToken(s??null,o)}}}addLiveEvent(e,n){var{duplicateStrategy:r,fromCache:i,roomState:s,timelineWasEmpty:o,addToState:a}=n;if(this.filter){var c=this.filter.filterRoomTimeline([e]);if(!c.length)return}var l=this._eventIdToTimeline.get(e.getId());if(l){if(r===wy.Replace){Zm("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());for(var d=l.getEvents(),h=0;h<d.length;h++)if(d[h].getId()===e.getId()){s||(s=l.getState(Me.FORWARDS)),Me.setEventMetadata(e,s,!1),d[h]=e;break}}else Zm("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());return}this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,fromCache:i,roomState:s,timelineWasEmpty:o,addToState:a})}addEventToTimeline(e,n,r){var{toStartOfTimeline:i,fromCache:s=!1,roomState:o,timelineWasEmpty:a,addToState:c}=r;if(n.getTimelineSet()!==this){var l;throw new Error("EventTimelineSet.addEventToTimeline: Timeline=".concat(n.toString(),` does not belong " +
                "in timelineSet(threadId=`).concat((l=this.thread)===null||l===void 0?void 0:l.id,")"))}var d=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){var h,m="event=".concat(d);e.threadRootId&&(m+="(belongs to thread=".concat(e.threadRootId,")")),M.warn("EventTimelineSet.addEventToTimeline: Ignoring ".concat(m," that does not belong ")+"in timeline=".concat(n.toString()," timelineSet(threadId=").concat((h=this.thread)===null||h===void 0?void 0:h.id,")"));return}n.addEvent(e,{toStartOfTimeline:i,roomState:o,timelineWasEmpty:a,addToState:c}),this._eventIdToTimeline.set(d,n);var g={timeline:n,liveEvent:!i&&n==this.liveTimeline&&!s};this.emit(ke.Timeline,e,this.room,!!i,!1,g)}insertEventIntoTimeline(e,n,r,i){if(n.getTimelineSet()!==this){var s;throw new Error("EventTimelineSet.insertEventIntoTimeline: Timeline=".concat(n.toString(),` does not belong " +
                "in timelineSet(threadId=`).concat((s=this.thread)===null||s===void 0?void 0:s.id,")"))}var o=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){var a,c="event=".concat(o);e.threadRootId&&(c+="(belongs to thread=".concat(e.threadRootId,")")),M.warn("EventTimelineSet.insertEventIntoTimeline: Ignoring ".concat(c," that does not belong ")+"in timeline=".concat(n.toString()," timelineSet(threadId=").concat((a=this.thread)===null||a===void 0?void 0:a.id,")"));return}var l=e.relationEventId;if(!l){this.addEventToTimeline(e,n,{toStartOfTimeline:!1,fromCache:!1,timelineWasEmpty:!1,roomState:r,addToState:i});return}for(var d=this.findEventById(l),h=n.getEvents(),m=d!==void 0?h.indexOf(d):0,g=m;g<h.length;g++){var y=h[g];if(y.getTs()>e.getTs())break}n.insertEvent(e,g,r,i),this._eventIdToTimeline.set(o,n);var v={timeline:n,liveEvent:!1};this.emit(ke.Timeline,e,this.room,!1,!1,v)}handleRemoteEcho(e,n,r){var i=this._eventIdToTimeline.get(n);i?(this._eventIdToTimeline.delete(n),this._eventIdToTimeline.set(r,i)):(!this.filter||this.filter.filterRoomTimeline([e]).length)&&this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,addToState:!1})}removeEvent(e){var n=this._eventIdToTimeline.get(e);if(!n)return null;var r=n.removeEvent(e);if(r){this._eventIdToTimeline.delete(e);var i={timeline:n};this.emit(ke.Timeline,r,this.room,void 0,!0,i)}return r}compareEventOrdering(e,n){if(e==n)return 0;var r=this._eventIdToTimeline.get(e),i=this._eventIdToTimeline.get(n);if(r===void 0||i===void 0)return null;if(r===i){for(var s=void 0,o=void 0,a=r.getEvents(),c=0;c<a.length&&(s===void 0||o===void 0);c++){var l=a[c].getId();l==e&&(s=c),l==n&&(o=c)}var d=s-o;return d<0?-1:d>0?1:0}for(var h=r;h;){if(h===i)return-1;h=h.getNeighbouringTimeline(Me.FORWARDS)}for(h=r;h;){if(h===i)return 1;h=h.getNeighbouringTimeline(Me.BACKWARDS)}return null}canContain(e){if(!this.room)throw new Error("Cannot call `EventTimelineSet::canContain without a `room` set. Set the room when creating the EventTimelineSet to call this method.");var{threadId:n,shouldLiveInRoom:r,shouldLiveInThread:i}=this.room.eventShouldLiveIn(e);if(this.thread)return this.thread.id===n;if(!r&&!i){var s;M.warn("EventTimelineSet:canContain event encountered which cannot be added to any timeline roomId=".concat((s=this.room)===null||s===void 0?void 0:s.roomId," eventId=").concat(e.getId()," threadId=").concat(e.threadRootId))}return r}}var rt=function(t){return t.NOT_SENT="not_sent",t.ENCRYPTING="encrypting",t.SENDING="sending",t.QUEUED="queued",t.SENT="sent",t.CANCELLED="cancelled",t}({});class lJ{constructor(e,n){this.roomId=e}}class uJ{constructor(e){this.target=e,L(this,"reEmitters",new WeakMap)}reEmit(e,n){var r=this,i=this.reEmitters.get(e);i||(i=new Map,this.reEmitters.set(e,i));var s=function(c){if(i.has(c))return 1;var l=function(){if(!(c==="error"&&r.target.listenerCount("error")===0)){for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];r.target.emit(c,...m,e)}};e.on(c,l),i.set(c,l)};for(var o of n)s(o)}stopReEmitting(e,n){var r=this.reEmitters.get(e);if(r){for(var i of n)e.off(i,r.get(i)),r.delete(i);r.size===0&&this.reEmitters.delete(e)}}}class $v extends uJ{constructor(e){super(e)}reEmit(e,n){super.reEmit(e,n)}stopReEmitting(e,n){super.stopReEmitting(e,n)}}var ub=new K3("unread_thread_notifications","org.matrix.msc3773.unread_thread_notifications");function qve(t,e){if(e.endsWith("*")){var n=e.slice(0,-1);return t.slice(0,n.length)===n}else return t===e}class c${constructor(e,n){this.filterJson=e,this.userId=n}check(e){var n,r,i=((n=e.getUnsigned())===null||n===void 0?void 0:n["m.relations"])||{},s=Object.keys(i),o=[];return this.userId&&i!==null&&i!==void 0&&(r=i[wn.name])!==null&&r!==void 0&&r.current_user_participated&&o.push(this.userId),this.checkFields(e.getRoomId(),e.getSender(),e.getType(),e.getContent()?e.getContent().url!==void 0:!1,s,o)}toJSON(){return Object.fromEntries(Object.entries({types:this.filterJson.types,not_types:this.filterJson.not_types,rooms:this.filterJson.rooms,not_rooms:this.filterJson.not_rooms,senders:this.filterJson.senders,not_senders:this.filterJson.not_senders,contains_url:this.filterJson.contains_url,[Ig.name]:this.filterJson[Ig.name],[kg.name]:this.filterJson[kg.name]}).filter(e=>{var[n,r]=e;return r}))}checkFields(e,n,r,i,s,o){var a={rooms:function(S){return e===S},senders:function(S){return n===S},types:function(S){return qve(r,S)}};for(var c in a){var l=a[c],d="not_"+c,h=this.filterJson[d];if(h!=null&&h.some(l))return!1;var m=this.filterJson[c];if(m&&!m.some(l))return!1}var g=this.filterJson.contains_url;if(g!==void 0&&g!==i)return!1;var y=this.filterJson[kg.name];if(y!==void 0&&!this.arrayMatchesFilter(y,s))return!1;var v=this.filterJson[Ig.name];return!(v!==void 0&&!this.arrayMatchesFilter(v,o))}arrayMatchesFilter(e,n){return n.length>0&&e.every(r=>n.includes(r))}filter(e){return e.filter(this.check,this)}limit(){return this.filterJson.limit!==void 0?this.filterJson.limit:10}}function l$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Am(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?l$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Tk(t,e,n){for(var r=e.split("."),i=t,s=0;s<r.length-1;s++)i[r[s]]||(i[r[s]]={}),i=i[r[s]];i[r[r.length-1]]=n}class Us{static fromJson(e,n,r){var i=new Us(e,n);return i.setDefinition(r),i}constructor(e,n){this.userId=e,this.filterId=n,L(this,"definition",{}),L(this,"roomFilter",void 0),L(this,"roomTimelineFilter",void 0)}getFilterId(){return this.filterId}getDefinition(){return this.definition}setDefinition(e){this.definition=e;var n=e.room,r={};n&&(n.rooms&&(r.rooms=n.rooms),n.rooms&&(r.not_rooms=n.not_rooms)),this.roomFilter=new c$(r,this.userId),this.roomTimelineFilter=new c$(n?.timeline||{},this.userId)}getRoomTimelineFilterComponent(){return this.roomTimelineFilter}filterRoomTimeline(e){return this.roomFilter&&(e=this.roomFilter.filter(e)),this.roomTimelineFilter&&(e=this.roomTimelineFilter.filter(e)),e}setTimelineLimit(e){Tk(this.definition,"room.timeline.limit",e)}setUnreadThreadNotifications(e){var n,r;this.definition=Am(Am({},this.definition),{},{room:Am(Am({},(n=this.definition)===null||n===void 0?void 0:n.room),{},{timeline:Am(Am({},(r=this.definition)===null||r===void 0||(r=r.room)===null||r===void 0?void 0:r.timeline),{},{[ub.name]:e})})})}setLazyLoadMembers(e){Tk(this.definition,"room.state.lazy_load_members",e)}setIncludeLeaveRooms(e){Tk(this.definition,"room.include_leave",e)}}L(Us,"LAZY_LOADING_MESSAGES_FILTER",{lazy_load_members:!0});function aC(t){return t!=null}var Gve=new to.UnstableValue("m.message","org.matrix.msc1767.message"),FO=new to.UnstableValue("m.text","org.matrix.msc1767.text"),Kve=new to.UnstableValue("m.html","org.matrix.msc1767.html"),dJ=new to.NamespacedValue("m.reference");function zve(t,e){if(typeof t=="string")return typeof e=="string"?e===t:e.matches(t);if(typeof e=="string")return t.matches(e);var n=e,r=t;return n.matches(r.name)||aC(r.altName)&&n.matches(r.altName)}var $O=new a_("m.topic");function u$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Wve(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?u$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function fJ(t,e){return{msgtype:ll.Text,format:"org.matrix.custom.html",body:t,formatted_body:e}}function hJ(t,e){return{msgtype:ll.Notice,format:"org.matrix.custom.html",body:t,formatted_body:e}}function pJ(t,e){return{msgtype:ll.Emote,format:"org.matrix.custom.html",body:t,formatted_body:e}}function mJ(t){return{msgtype:ll.Text,body:t}}function gJ(t){return{msgtype:ll.Notice,body:t}}function vJ(t){return{msgtype:ll.Emote,body:t}}var yJ=(t,e,n,r)=>{var i="at ".concat(new Date(n).toISOString()),s=e===ev.Self?"User":void 0,o=r?'"'.concat(r,'"'):void 0;return[s,"Location",o,t,i].filter(Boolean).join(" ")},bJ=(t,e,n,r,i)=>{var s=t??yJ(e,i||ev.Self,n,r),o=n?{[Lf.name]:n}:{};return Wve({msgtype:ll.Location,body:s,geo_uri:e,[l_.name]:{description:r,uri:e},[c_.name]:{type:i||ev.Self},[FO.name]:s},o)},Yve=t=>{var e,n,r=l_.findIn(t),i=c_.findIn(t),s=Lf.findIn(t),o=FO.findIn(t),a=(e=r?.uri)!==null&&e!==void 0?e:t?.geo_uri,c=r?.description,l=(n=i?.type)!==null&&n!==void 0?n:ev.Self,d=o??t.body;return bJ(d,a,s??void 0,c,l)},_J=(t,e)=>{var n=[];return aC(e)&&n.push({body:e,mimetype:"text/html"}),aC(t)&&n.push({body:t,mimetype:"text/plain"}),{topic:t,[$O.name]:{"m.text":n}}},Xve=t=>{var e,n,r,i,s=$O.findIn(t),o=Array.isArray(s)?s:s?.["m.text"];if(!Array.isArray(o)){var a;return{text:(a=t.topic)!==null&&a!==void 0?a:void 0}}var c=(e=(n=o==null||(r=o.find(d=>!aC(d.mimetype)||d.mimetype==="text/plain"))===null||r===void 0?void 0:r.body)!==null&&n!==void 0?n:t.topic)!==null&&e!==void 0?e:void 0,l=o==null||(i=o.find(d=>d.mimetype==="text/html"))===null||i===void 0?void 0:i.body;return{text:c,html:l}},Jve=(t,e,n,r,i)=>({description:n,timeout:t,live:e,[Lf.name]:i||Date.now(),[c_.name]:{type:r??ev.Self}}),SJ=t=>{var e,{description:n,timeout:r,live:i}=t,s=(e=Lf.findIn(t))!==null&&e!==void 0?e:void 0,o=c_.findIn(t);return{description:n,timeout:r,live:i,assetType:o?.type,timestamp:s}},Qve=(t,e,n,r)=>({[l_.name]:{description:r,uri:t},[Lf.name]:e,"m.relates_to":{rel_type:dJ.name,event_id:n}}),Q5=t=>{var e,n=l_.findIn(t),r=(e=Lf.findIn(t))!==null&&e!==void 0?e:void 0;return{description:n?.description,uri:n?.uri,timestamp:r}};const Zve=Object.freeze(Object.defineProperty({__proto__:null,getTextForLocationEvent:yJ,makeBeaconContent:Qve,makeBeaconInfoContent:Jve,makeEmoteMessage:vJ,makeHtmlEmote:pJ,makeHtmlMessage:fJ,makeHtmlNotice:hJ,makeLocationContent:bJ,makeNotice:gJ,makeTextMessage:mJ,makeTopicContent:_J,parseBeaconContent:Q5,parseBeaconInfoContent:SJ,parseLocationEvent:Yve,parseTopicContent:Xve},Symbol.toStringTag,{value:"Module"}));var qn=function(t){return t.New="Beacon.new",t.Update="Beacon.update",t.LivenessChange="Beacon.LivenessChange",t.Destroy="Beacon.Destroy",t.LocationUpdate="Beacon.LocationUpdate",t}({}),Z5=(t,e,n)=>n>=t&&t+e>=n,cC=t=>"".concat(t.getRoomId(),"_").concat(t.getStateKey());class EJ extends On{constructor(e){super(),this.rootEvent=e,L(this,"roomId",void 0),L(this,"_beaconInfo",void 0),L(this,"_isLive",void 0),L(this,"livenessWatchTimeout",void 0),L(this,"_latestLocationEvent",void 0),L(this,"clearLatestLocation",()=>{this._latestLocationEvent=void 0,this.emit(qn.LocationUpdate,this.latestLocationState)}),this.roomId=this.rootEvent.getRoomId(),this.setBeaconInfo(this.rootEvent)}get isLive(){return!!this._isLive}get identifier(){return cC(this.rootEvent)}get beaconInfoId(){return this.rootEvent.getId()}get beaconInfoOwner(){return this.rootEvent.getStateKey()}get beaconInfoEventType(){return this.rootEvent.getType()}get beaconInfo(){return this._beaconInfo}get latestLocationState(){return this._latestLocationEvent&&Q5(this._latestLocationEvent.getContent())}get latestLocationEvent(){return this._latestLocationEvent}update(e){if(cC(e)!==this.identifier)throw new Error("Invalid updating event");e.getTs()<this.rootEvent.getTs()||(this.rootEvent=e,this.setBeaconInfo(this.rootEvent),this.emit(qn.Update,e,this),this.clearLatestLocation())}destroy(){this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this._isLive=!1,this.emit(qn.Destroy,this.identifier)}monitorLiveness(){if(this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this.checkLiveness(),!!this.beaconInfo)if(this.isLive){var e=this.beaconInfo.timestamp+this.beaconInfo.timeout-Date.now();e>1&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},e))}else this.beaconInfo.timestamp>Date.now()&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},this.beaconInfo.timestamp-Date.now()))}addLocations(e){var n;if(this.isLive){var r=e.filter(s=>{var o=s.getContent(),a=Q5(o);if(!a.uri||!a.timestamp)return!1;var{timestamp:c}=a;return this._beaconInfo.timestamp&&Z5(this._beaconInfo.timestamp,this._beaconInfo.timeout,c)&&(!this.latestLocationState||c>this.latestLocationState.timestamp)}),i=(n=r.sort(bve))===null||n===void 0?void 0:n[0];i&&(this._latestLocationEvent=i,this.emit(qn.LocationUpdate,this.latestLocationState))}}setBeaconInfo(e){this._beaconInfo=SJ(e.getContent()),this.checkLiveness()}checkLiveness(){var e=this.isLive;if(this.beaconInfo){var n=this.beaconInfo.timestamp>Date.now()?this.beaconInfo.timestamp-36e4:this.beaconInfo.timestamp;this._isLive=!!this._beaconInfo.live&&!!n&&Z5(n,this._beaconInfo.timeout,Date.now()),e!==this.isLive&&this.emit(qn.LivenessChange,this.isLive,this)}}}function d$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function e0e(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?d$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function wJ(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return new $i({content:{[e.getId()]:{[n]:{[t]:e0e({ts:e.getTs()},!r&&{thread_id:ov(e)})}}},type:Z.Receipt,room_id:e.getRoomId()})}var Pm=0,Lm=1;class CJ extends On{constructor(){super(...arguments),L(this,"receipts",new vu(()=>new Map)),L(this,"receiptCacheByEventId",new Map)}getReadReceiptForUserId(e){var n,r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ls.Read,[o,a]=(n=(r=this.receipts.get(s))===null||r===void 0?void 0:r.get(e))!==null&&n!==void 0?n:[null,null];return i?o:a??o}compareReceipts(e,n){var r;return(r=this.getUnfilteredTimelineSet().compareEventOrdering(e.eventId,n.eventId))!==null&&r!==void 0?r:e.data.ts-n.data.ts}getEventReadUpTo(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=this.getLatestReceipt(e,n);return r&&this.receiptPointsAtConsistentEvent(r)?r.eventId:null}receiptPointsAtConsistentEvent(e){var n,r=this.findEventById(e.eventId);if(!r)return!1;if(!((n=e.data)!==null&&n!==void 0&&n.thread_id))return!0;if(e.data.thread_id===u_){var i=mb(r);if(i)return!0}else if(r.threadRootId===e.data.thread_id)return!0;return M.warn("Ignoring receipt because its thread_id (".concat(e.data.thread_id,") disagrees ")+"with the thread root (".concat(r.threadRootId,") of the referenced event ")+"(event ID = ".concat(e.eventId,")")),!1}getLatestReceipt(e,n){var r,i,s=this.getReadReceiptForUserId(e,n,ls.Read),o=this.getReadReceiptForUserId(e,n,ls.ReadPrivate),a;return s!=null&&s.eventId&&o!==null&&o!==void 0&&o.eventId&&(a=this.compareReceipts(s,o)),a?(i=a<0?o:s)!==null&&i!==void 0?i:null:(r=o??s)!==null&&r!==void 0?r:null}addReceiptToStructure(e,n,r,i,s){var o,a,c=this.receipts.getOrCreate(n),l=c.get(r);l||(l=[null,null],c.set(r,l));var d=l[Pm];if(s){var h;d=(h=l[Lm])!==null&&h!==void 0?h:l[Pm]}var m={eventId:e,data:i};if(d){var g=this.compareReceipts(d,m);if(g>=0)return}var y=s?l[Pm]:m,v=s?m:l[Lm],w=null;y&&v&&(w=this.getUnfilteredTimelineSet().compareEventOrdering(y.eventId,v.eventId));var S=w===null||w<0,R=(o=l[Lm])!==null&&o!==void 0?o:l[Pm];s&&S?l[Lm]=m:s||(l[Pm]=m,S||(l[Lm]=null));var x=(a=l[Lm])!==null&&a!==void 0?a:l[Pm];if(R!==x){if(R&&this.receiptCacheByEventId.get(R.eventId)){var T=R.eventId;this.receiptCacheByEventId.set(T,this.receiptCacheByEventId.get(T).filter(I=>I.type!==n||I.userId!==r)),this.receiptCacheByEventId.get(T).length<1&&this.receiptCacheByEventId.delete(T)}this.receiptCacheByEventId.get(e)||this.receiptCacheByEventId.set(e,[]),this.receiptCacheByEventId.get(e).push({userId:r,type:n,data:i})}}getReceiptsForEvent(e){return this.receiptCacheByEventId.get(e.getId())||[]}fixupNotifications(e){var n=this.getReadReceiptForUserId(e,!1),r=this.timeline[this.timeline.length-1];r&&n?.eventId===r.getId()&&e===r.getSender()&&(this.setUnread(Jt.Total,0),this.setUnread(Jt.Highlight,0))}addLocalEchoReceipt(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;this.addReceipt(wJ(e,n,r,i),!0)}getUsersReadUpTo(e){return this.getReceiptsForEvent(e).filter(function(n){return OO(n.type)}).map(function(n){return n.userId})}}var t0e=new to.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed"),n0e=new to.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed"),r0e=new to.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start"),db=new to.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response"),lC=new to.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end"),Md=function(t){return t.New="Poll.new",t.End="Poll.end",t.Update="Poll.update",t.Responses="Poll.Responses",t.Destroy="Poll.Destroy",t.UndecryptableRelations="Poll.UndecryptableRelations",t}({}),f$=(t,e)=>{var n=t.filter(r=>{if(!r.isDecryptionFailure())return db.matches(r.getType())&&r.getTs()<=e});return{responseEvents:n}};class TJ extends On{constructor(e,n,r){if(super(),this.rootEvent=e,this.matrixClient=n,this.room=r,L(this,"roomId",void 0),L(this,"pollEvent",void 0),L(this,"_isFetchingResponses",!1),L(this,"relationsNextBatch",void 0),L(this,"responses",null),L(this,"endEvent",void 0),L(this,"undecryptableRelationEventIds",new Set),L(this,"countUndecryptableEvents",i=>{var s=i.filter(a=>a.isDecryptionFailure()).map(a=>a.getId()),o=this.undecryptableRelationsCount;this.undecryptableRelationEventIds=new Set([...this.undecryptableRelationEventIds,...s]),this.undecryptableRelationsCount!==o&&this.emit(Md.UndecryptableRelations,this.undecryptableRelationsCount)}),!this.rootEvent.getRoomId()||!this.rootEvent.getId())throw new Error("Invalid poll start event.");this.roomId=this.rootEvent.getRoomId(),this.pollEvent=this.rootEvent.unstableExtensibleEvent}get pollId(){return this.rootEvent.getId()}get endEventId(){var e;return(e=this.endEvent)===null||e===void 0?void 0:e.getId()}get isEnded(){return!!this.endEvent}get isFetchingResponses(){return this._isFetchingResponses}get undecryptableRelationsCount(){return this.undecryptableRelationEventIds.size}getResponses(){var e=this;return B(function*(){return e.responses||e.isFetchingResponses||(yield e.fetchResponses()),e.responses})()}onNewRelation(e){var n;if(lC.matches(e.getType())&&this.validateEndEvent(e)&&(this.endEvent=e,this.refilterResponsesOnEnd(),this.emit(Md.End)),!!this.responses){var r=((n=this.endEvent)===null||n===void 0?void 0:n.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:i}=f$([e],r);this.countUndecryptableEvents([e]),i.length&&(i.forEach(s=>{this.responses.addEvent(s)}),this.emit(Md.Responses,this.responses))}}fetchResponses(){var e=this;return B(function*(){var n,r;e._isFetchingResponses=!0;var i=yield e.matrixClient.relations(e.roomId,e.rootEvent.getId(),"m.reference",void 0,{from:e.relationsNextBatch||void 0});yield Promise.all(i.events.map(l=>e.matrixClient.decryptEventIfNeeded(l)));var s=e.responses||new jO("m.reference",db.name,e.matrixClient,[db.altName]),o=i.events.find(l=>lC.matches(l.getType()));e.validateEndEvent(o)&&(e.endEvent=o,e.refilterResponsesOnEnd(),e.emit(Md.End));var a=((n=e.endEvent)===null||n===void 0?void 0:n.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:c}=f$(i.events,a);c.forEach(l=>{s.addEvent(l)}),e.relationsNextBatch=(r=i.nextBatch)!==null&&r!==void 0?r:void 0,e.responses=s,e.countUndecryptableEvents(i.events),e.relationsNextBatch?e.fetchResponses():e._isFetchingResponses=!1,e.emit(Md.Responses,e.responses)})()}refilterResponsesOnEnd(){var e;if(this.responses){var n=((e=this.endEvent)===null||e===void 0?void 0:e.getTs())||Number.MAX_SAFE_INTEGER;this.responses.getRelations().forEach(r=>{if(r.getTs()>n){var i;(i=this.responses)===null||i===void 0||i.removeEvent(r)}}),this.emit(Md.Responses,this.responses)}}validateEndEvent(e){if(!e||this.endEvent&&this.endEvent.getTs()<e.getTs())return!1;var n=this.room.currentState,r=e.getSender();return!!r&&(r===this.rootEvent.getSender()||n.maySendRedactionForEvent(this.rootEvent,r))}}var RJ=t=>{var e=t.getType();return to.M_POLL_START.matches(e)||db.matches(e)||lC.matches(e)};class i0e{constructor(e){L(this,"room",void 0),L(this,"threadedReceipts",void 0),L(this,"unthreadedReceipts",void 0),L(this,"danglingReceipts",void 0),L(this,"onTimelineEvent",n=>{var r=n.getId();if(r){var i=this.danglingReceipts.remove(r);i?.forEach(s=>{s.receipt.thread_id?this.threadedReceipts.set(s.receipt.thread_id,s.eventId,s.receiptType,s.userId,s.receipt.ts,s.synthetic):this.unthreadedReceipts.set(r,s.receiptType,s.userId,s.receipt.ts,s.synthetic)})}}),this.room=e,this.threadedReceipts=new c0e(e),this.unthreadedReceipts=new IJ(e),this.danglingReceipts=new l0e,e.on(ke.Timeline,this.onTimelineEvent)}add(e,n){for(var[r,i]of Object.entries(e))for(var[s,o]of Object.entries(i))for(var[a,c]of Object.entries(o)){var l=this.room.findEventById(r);l?c.thread_id?this.threadedReceipts.set(c.thread_id,r,s,a,c.ts,n):this.unthreadedReceipts.set(r,s,a,c.ts,n):this.danglingReceipts.add(new o0e(r,s,a,c,n))}}hasUserReadEvent(e,n){var r=this.unthreadedReceipts.get(e);if(r&&eA(r.eventId,n,this.room))return!0;var i=this.room.findEventById(n);if(!i)return M.warn("hasUserReadEvent event ID ".concat(n," not found in room ").concat(this.room.roomId,": this shouldn't happen!")),!1;var s=ov(i),o=this.threadedReceipts.get(s,e);return!!(o&&eA(o.eventId,n,this.room)||this.userSentLatestEventInThread(s,e))}userSentLatestEventInThread(e,n){var r,i=e===u_?this.room.getLiveTimeline().getEvents():(r=this.room.getThread(e))===null||r===void 0?void 0:r.timeline;return!!(i&&i.length>0&&i[i.length-1].getSender()===n)}}class s0e{constructor(e,n,r){this.eventId=e,this.receiptType=n,this.ts=r}}class o0e{constructor(e,n,r,i,s){this.eventId=e,this.receiptType=n,this.userId=r,this.receipt=i,this.synthetic=s}}class a0e{constructor(e){L(this,"room",void 0),L(this,"real",void 0),L(this,"synthetic",void 0),this.room=e,this.real=void 0,this.synthetic=void 0}set(e,n){e?this.synthetic=n:this.real=n,this.synthetic&&this.real&&eA(this.real.eventId,this.synthetic.eventId,this.room)&&(this.synthetic=void 0)}get(){var e;return(e=this.synthetic)!==null&&e!==void 0?e:this.real}getByType(e){return e?this.synthetic:this.real}}class IJ{constructor(e){L(this,"room",void 0),L(this,"data",void 0),this.room=e,this.data=new Map}set(e,n,r,i,s){var o=BO(this.data,r,()=>new a0e(this.room)),a=o.getByType(s);a&&u0e(a.eventId,e,this.room)||o.set(s,new s0e(e,n,i))}get(e){var n;return(n=this.data.get(e))===null||n===void 0?void 0:n.get()}}class c0e{constructor(e){L(this,"room",void 0),L(this,"data",void 0),this.room=e,this.data=new Map}set(e,n,r,i,s,o){var a=BO(this.data,e,()=>new IJ(this.room));a.set(n,r,i,s,o)}get(e,n){var r;return(r=this.data.get(e))===null||r===void 0?void 0:r.get(n)}}class l0e{constructor(){L(this,"data",new Map)}add(e){var n=BO(this.data,e.eventId,()=>[]);n.push(e)}remove(e){var n=this.data.get(e);return this.data.delete(e),n}}function BO(t,e,n){var r=t.get(e);if(r)return r;var i=n();return t.set(e,i),i}function eA(t,e,n){var r=n.compareEventOrdering(t,e);return r!==null&&r>=0}function u0e(t,e,n){var r=n.compareEventOrdering(t,e);return r!==null&&r>0}function d0e(t,e,n){var r=t.findEventById(e),i=t.findEventById(n);if(!r||!i)return null;var s=mb(r),o=mb(i);return s&&o?f0e(t,e,n,r,i):h0e(e,n,r,i)}function f0e(t,e,n,r,i){var s=t.getUnfilteredTimelineSet(),o=s.compareEventOrdering(e,n);if(o!==null)return o;var a=s.getTimelineForEvent(e);if(a===s.getLiveTimeline())return 1;var c=s.getTimelineForEvent(n);return c===s.getLiveTimeline()?-1:kJ(r,i)}function h0e(t,e,n,r){var i=ov(n),s=ov(r),o=n.getThread();return o&&i===s?o.timelineSet.compareEventOrdering(t,e):kJ(n,r)}function kJ(t,e){var n=t.getTs(),r=e.getTs();return n<r?-1:n>r?1:0}var de=function(t){return t.Get="GET",t.Put="PUT",t.Post="POST",t.Delete="DELETE",t.Options="OPTIONS",t.Head="HEAD",t.Patch="PATCH",t}({});function h$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function p0e(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?h$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class ep extends Error{constructor(e,n,r){super(e),this.httpStatus=n,this.httpHeaders=r}isRateLimitError(){return this.httpStatus===429}getRetryAfterMs(){var e,n=(e=this.httpHeaders)===null||e===void 0?void 0:e.get("Retry-After");if(n!=null){if(/^\d+$/.test(n)){var r=Number.parseInt(n)*1e3;if(!Number.isFinite(r))throw new Error("Retry-After header integer value is too large");return r}var i=new Date(n);if(i.toUTCString()!==n)throw new Error("Retry-After header value is not a valid HTTP-date or non-negative decimal integer");return i.getTime()-Date.now()}return null}}class tr extends ep{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,o=e.error||"Unknown message";n&&(o="[".concat(n,"] ").concat(o)),r&&(o="".concat(o," (").concat(r,")")),super("MatrixError: ".concat(o),n,s),this.url=r,this.event=i,L(this,"errcode",void 0),L(this,"data",void 0),this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.data=e}isRateLimitError(){return this.errcode==="M_LIMIT_EXCEEDED"||(this.errcode==="M_UNKNOWN"||this.errcode===void 0)&&super.isRateLimitError()}getRetryAfterMs(){var e=super.getRetryAfterMs();if(e!==null)return e;if(this.errcode==="M_LIMIT_EXCEEDED"&&"retry_after_ms"in this.data){if(!Number.isInteger(this.data.retry_after_ms))throw new Error("retry_after_ms is not an integer");return this.data.retry_after_ms}return null}asWidgetApiErrorData(){var e,n,r,i,s={};if(this.httpHeaders)for(var[o,a]of this.httpHeaders)s[o]=a;return{http_status:(e=this.httpStatus)!==null&&e!==void 0?e:400,http_headers:s,url:(n=this.url)!==null&&n!==void 0?n:"",response:p0e({errcode:(r=this.errcode)!==null&&r!==void 0?r:"M_UNKNOWN",error:(i=this.data.error)!==null&&i!==void 0?i:"Unknown message"},this.data)}}static fromWidgetApiErrorData(e){return new tr(e.response,e.http_status,e.url,void 0,new Headers(e.http_headers))}}function HO(t,e){if(!(t instanceof ep)||!t.isRateLimitError())return e;try{var n;return(n=t.getRetryAfterMs())!==null&&n!==void 0?n:e}catch{return e}}let wp=class extends Error{constructor(e,n){super(e+(n?": ".concat(n.message):""))}get name(){return"ConnectionError"}};class xJ extends Error{constructor(e){var n;super((n=e?.message)!==null&&n!==void 0?n:"")}get name(){return"TokenRefreshError"}}class VO extends Error{constructor(e){var n;super((n=e?.message)!==null&&n!==void 0?n:"")}get name(){return"TokenRefreshLogoutError"}}var tA=function(t){return t.SessionLoggedOut="Session.logged_out",t.NoConsent="no_consent",t}({}),T2={};/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var p$;function m0e(){if(p$)return T2;p$=1;var t=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,e=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,n=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,r=/\\([\u000b\u0020-\u00ff])/g,i=/([\\"])/g,s=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;T2.format=o,T2.parse=a;function o(h){if(!h||typeof h!="object")throw new TypeError("argument obj is required");var m=h.parameters,g=h.type;if(!g||!s.test(g))throw new TypeError("invalid type");var y=g;if(m&&typeof m=="object")for(var v,w=Object.keys(m).sort(),S=0;S<w.length;S++){if(v=w[S],!n.test(v))throw new TypeError("invalid parameter name");y+="; "+v+"="+l(m[v])}return y}function a(h){if(!h)throw new TypeError("argument string is required");var m=typeof h=="object"?c(h):h;if(typeof m!="string")throw new TypeError("argument string is required to be a string");var g=m.indexOf(";"),y=g!==-1?m.slice(0,g).trim():m.trim();if(!s.test(y))throw new TypeError("invalid media type");var v=new d(y.toLowerCase());if(g!==-1){var w,S,R;for(t.lastIndex=g;S=t.exec(m);){if(S.index!==g)throw new TypeError("invalid parameter format");g+=S[0].length,w=S[1].toLowerCase(),R=S[2],R.charCodeAt(0)===34&&(R=R.slice(1,-1),R.indexOf("\\")!==-1&&(R=R.replace(r,"$1"))),v.parameters[w]=R}if(g!==m.length)throw new TypeError("invalid parameter format")}return v}function c(h){var m;if(typeof h.getHeader=="function"?m=h.getHeader("content-type"):typeof h.headers=="object"&&(m=h.headers&&h.headers["content-type"]),typeof m!="string")throw new TypeError("content-type header is missing from object");return m}function l(h){var m=String(h);if(n.test(m))return m;if(m.length>0&&!e.test(m))throw new TypeError("invalid parameter value");return'"'+m.replace(i,"\\$1")+'"'}function d(h){this.parameters=Object.create(null),this.type=h}return T2}var g0e=m0e();function J3(t){var e=new AbortController;return setTimeout(()=>{e.abort()},t),e.signal}function AJ(t){var e=new AbortController;function n(){for(var s of t)s.removeEventListener("abort",r)}function r(){e.abort(),n()}for(var i of t){if(i.aborted){r();break}i.addEventListener("abort",r)}return{signal:e.signal,cleanup:n}}function qO(t,e){var n,r,i=m$(t)?new Headers(t.getAllResponseHeaders().trim().split(/[\r\n]+/).map(o=>{var a=o.indexOf(":");return[o.substring(0,a),o.substring(a+1)]})):t.headers,s;try{s=v0e(i)}catch(o){return o}return((n=s)===null||n===void 0?void 0:n.type)==="application/json"&&e?new tr(JSON.parse(e),t.status,m$(t)?t.responseURL:t.url,void 0,i):((r=s)===null||r===void 0?void 0:r.type)==="text/plain"?new ep("Server returned ".concat(t.status," error: ").concat(e),t.status,i):new ep("Server returned ".concat(t.status," error"),t.status,i)}function m$(t){return"getResponseHeader"in t}function v0e(t){var e=t.get("Content-Type");if(e===null)return null;try{return g0e.parse(e)}catch(n){throw new Error("Error parsing Content-Type '".concat(e,"': ").concat(n))}}function nA(t,e){return rA.apply(this,arguments)}function rA(){return rA=B(function*(t,e){for(var n=0,r=null;n<t;)try{if(n>0){var i=1e3*Math.pow(2,n);M.log("network operation failed ".concat(n," times, retrying in ").concat(i,"ms...")),yield _p(i)}return yield e()}catch(s){if(s instanceof wp)n+=1,r=s;else throw s}throw r}),rA.apply(this,arguments)}function GO(t,e,n){return e>4||t instanceof wp&&!n||t.httpStatus&&Math.floor(t.httpStatus/100)===4&&t.httpStatus!==429||t.name==="AbortError"||t.name==="M_TOO_LARGE"?-1:HO(t,1e3*Math.pow(2,e))}var Dd=function(t){return t.Success="success",t.Failure="failure",t.Logout="logout",t}({}),y0e=500,b0e=60*1e3;class _0e{constructor(e){this.opts=e,L(this,"tokenRefreshPromise",void 0),L(this,"latestTokenRefreshExpiry",void 0)}prepareForRequest(){var e=this;return B(function*(){return yield e.refreshIfNeeded(),{accessToken:e.opts.accessToken,refreshToken:e.opts.refreshToken,expiry:e.latestTokenRefreshExpiry}})()}refreshIfNeeded(){var e=this;return B(function*(){if(e.tokenRefreshPromise)return e.tokenRefreshPromise;if(e.latestTokenRefreshExpiry){var n=e.latestTokenRefreshExpiry.getTime()-Date.now();n<=y0e&&(yield e._handleUnknownToken())}})()}handleUnknownToken(e,n){var r=this;return B(function*(){return r._handleUnknownToken(e,n)})()}_handleUnknownToken(e,n){var r=this;return B(function*(){if(e!=null&&e.expiry){var i=e.expiry.getTime()-Date.now();if(i>=b0e)return Dd.Logout}if(!e||e?.accessToken===r.opts.accessToken){var s;(s=r.tokenRefreshPromise)!==null&&s!==void 0||(r.tokenRefreshPromise=r.doTokenRefresh(n));try{return yield r.tokenRefreshPromise}finally{r.tokenRefreshPromise=void 0}}return Dd.Success})()}doTokenRefresh(e){var n=this;return B(function*(){if(!n.opts.refreshToken||!n.opts.tokenRefreshFunction){var r;return(r=n.opts.logger)===null||r===void 0||r.error("Unable to refresh token - no refresh token or refresh function"),Dd.Logout}e&&e>1&&(yield _p(1e3*Math.min(32,2**e)));try{var i,s;(i=n.opts.logger)===null||i===void 0||i.debug("Attempting to refresh token");var{accessToken:o,refreshToken:a,expiry:c}=yield n.opts.tokenRefreshFunction(n.opts.refreshToken);return n.opts.accessToken=o,n.opts.refreshToken=a,n.latestTokenRefreshExpiry=c,(s=n.opts.logger)===null||s===void 0||s.debug("... token refresh complete, new token expiry:",c),Dd.Success}catch(h){var l;if(h instanceof VO||h instanceof tr){var d;return(d=n.opts.logger)===null||d===void 0||d.error("Failed to refresh token",h),Dd.Logout}return(l=n.opts.logger)===null||l===void 0||l.warn("Failed to refresh token",h),Dd.Failure}})()}}function g$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function v$(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?g$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class S0e{constructor(e,n){var r;if(this.eventEmitter=e,this.opts=n,L(this,"abortController",new AbortController),L(this,"tokenRefresher",void 0),$X(n,["baseUrl","prefix"]),!n.onlyData)throw new Error("Constructing FetchHttpApi without `onlyData=true` is no longer supported.");n.useAuthorizationHeader=(r=n.useAuthorizationHeader)!==null&&r!==void 0?r:!0,this.tokenRefresher=new _0e(n)}abort(){this.abortController.abort(),this.abortController=new AbortController}fetch(e,n){return this.opts.fetchFn?this.opts.fetchFn(e,n):globalThis.fetch(e,n)}setIdBaseUrl(e){this.opts.idBaseUrl=e}idServerRequest(e,n,r,i,s){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");var o=void 0,a=void 0;e===de.Get?o=r:a=r;var c=this.getUrl(n,o,i,this.opts.idBaseUrl),l={json:!0,headers:{}};return s&&(l.headers.Authorization="Bearer ".concat(s)),this.requestOtherUrl(e,c,a,l)}authedRequest(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return this.doAuthedRequest(1,e,n,r,i,s)}doAuthedRequest(e,n,r,i,s){var o=arguments,a=this;return B(function*(){var c=o.length>5&&o[5]!==void 0?o[5]:{},l=d_(c);l.abortSignal=c.abortSignal;var d=yield a.tokenRefresher.prepareForRequest();d.accessToken&&(a.opts.useAuthorizationHeader?(l.headers||(l.headers={}),l.headers.Authorization||(l.headers.Authorization="Bearer ".concat(d.accessToken)),i.access_token&&delete i.access_token):i.access_token||(i.access_token=d.accessToken));try{var h=yield a.request(n,r,i,s,l);return h}catch(g){if(!(g instanceof tr))throw g;if(g.errcode==="M_UNKNOWN_TOKEN"){var m=yield a.tokenRefresher.handleUnknownToken(d,e);if(m===Dd.Success)return a.doAuthedRequest(e+1,n,r,i,s,c);if(m===Dd.Failure)throw new xJ(g);l!=null&&l.inhibitLogoutEmit||a.eventEmitter.emit(tA.SessionLoggedOut,g)}else g.errcode=="M_CONSENT_NOT_GIVEN"&&a.eventEmitter.emit(tA.NoConsent,g.message,g.data.consent_uri);throw g}})()}request(e,n,r,i,s){var o=this.getUrl(n,r,s?.prefix,s?.baseUrl);return this.requestOtherUrl(e,o,i,s)}requestOtherUrl(e,n,r){var i=arguments,s=this;return B(function*(){var o,a,c,l,d=i.length>3&&i[3]!==void 0?i[3]:{};if(d.json!==void 0&&d.rawResponseBody!==void 0)throw new Error("Invalid call to `FetchHttpApi` sets both `opts.json` and `opts.rawResponseBody`");var h=s.sanitizeUrlForLogs(n);(o=s.opts.logger)===null||o===void 0||o.debug("FetchHttpApi: --> ".concat(e," ").concat(h));var m=Object.assign({},d.headers||{}),g=!d.rawResponseBody&&d.json!==!1;g&&(m.Accept||(m.Accept="application/json"));var y=(a=d.localTimeoutMs)!==null&&a!==void 0?a:s.opts.localTimeoutMs,v=(c=d.keepAlive)!==null&&c!==void 0?c:!1,w=[s.abortController.signal];y!==void 0&&w.push(J3(y)),d.abortSignal&&w.push(d.abortSignal);var S;d.json!==!1&&(r==null||(l=r.constructor)===null||l===void 0?void 0:l.name)===Object.name?(S=JSON.stringify(r),m["Content-Type"]||(m["Content-Type"]="application/json")):S=r;var{signal:R,cleanup:x}=AJ(w),T,I=Date.now();try{var k;T=yield s.fetch(n,{signal:R,method:e,body:S,headers:m,mode:"cors",redirect:"follow",referrer:"",referrerPolicy:"no-referrer",cache:"no-cache",credentials:"omit",keepalive:v,priority:d.priority}),(k=s.opts.logger)===null||k===void 0||k.debug("FetchHttpApi: <-- ".concat(e," ").concat(h," [").concat(Date.now()-I,"ms ").concat(T.status,"]"))}catch(O){var A;throw(A=s.opts.logger)===null||A===void 0||A.debug("FetchHttpApi: <-- ".concat(e," ").concat(h," [").concat(Date.now()-I,"ms ").concat(O,"]")),O.name==="AbortError"?O:new wp("fetch failed",O)}finally{x()}if(!T.ok)throw qO(T,yield T.text());return d.rawResponseBody?yield T.blob():g?yield T.json():yield T.text()})()}sanitizeUrlForLogs(e){try{var n;typeof e=="string"?n=new URL(e):n=e;var r=new URLSearchParams;for(var i of n.searchParams.keys())r.append(i,"xxx");var s=r.toString(),o=s?"?".concat(s):"";return n.origin+n.pathname+o}catch{return"??"}}getUrl(e,n,r,i){var s=i??this.opts.baseUrl,o=s.endsWith("/")?s.slice(0,-1):s,a=new URL(o+(r??this.opts.prefix)+e);if(this.opts.extraParams||n){var c=v$(v$({},this.opts.extraParams),n);B5(c,a.searchParams)}return a}}var Xr=function(t){return t.V1="/_matrix/client/v1",t.V3="/_matrix/client/v3",t.Unstable="/_matrix/client/unstable",t}({}),$l=function(t){return t.V2="/_matrix/identity/v2",t}({}),Cg=function(t){return t.V1="/_matrix/media/v1",t.V3="/_matrix/media/v3",t}({}),E0e=1e3,w0e=0,Rk,hu=[],C0e=function(){};function y$(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];e=e||0,e<0&&(e=0);var s=Date.now()+e,o=w0e++,a={runAt:s,func:t,params:r,key:o},c=R0e(hu,function(l){return l.runAt-s});return hu.splice(c,0,a),KO(),o}function b$(t){if(hu.length!==0){var e;for(e=0;e<hu.length;e++){var n=hu[e];if(n.key==t){hu.splice(e,1);break}}e===0&&KO()}}function KO(){Rk&&globalThis.clearTimeout(Rk);var t=hu[0];if(t){var e=Date.now(),n=Math.min(t.runAt-e,E0e);Rk=globalThis.setTimeout(T0e,n)}}function T0e(){for(var t=Date.now(),e=[];;){var n=hu[0];if(!n||n.runAt>t)break;var r=hu.shift();C0e("runCallbacks: popping",r.key),e.push(r)}KO();for(var i of e)try{i.func.apply(globalThis,i.params)}catch(s){M.error("Uncaught exception in callback function",s)}}function R0e(t,e){for(var n=0,r=t.length;n<r;){var i=n+r>>1,s=e(t[i]);s>0?r=i:n=i+1}return n}class PJ extends S0e{constructor(){super(...arguments),L(this,"uploads",[])}uploadContent(e){var n,r,i,s,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=(n=o.includeFilename)!==null&&n!==void 0?n:!0,c=(r=o.abortController)!==null&&r!==void 0?r:new AbortController,l=((i=o.type)!==null&&i!==void 0?i:e.type)||"application/octet-stream",d=(s=o.name)!==null&&s!==void 0?s:e.name,h={loaded:0,total:0,abortController:c},m=Promise.withResolvers();if(globalThis.XMLHttpRequest){var g=new globalThis.XMLHttpRequest,y=function(){g.abort(),m.reject(new Error("Timeout"))},v=y$(y,3e4);g.onreadystatechange=function(){switch(g.readyState){case globalThis.XMLHttpRequest.DONE:b$(v);try{if(g.status===0)throw new DOMException(g.statusText,"AbortError");if(!g.responseText)throw new Error("No response body.");g.status>=400?m.reject(qO(g,g.responseText)):m.resolve(JSON.parse(g.responseText))}catch(x){if(x.name==="AbortError"){m.reject(x);return}m.reject(new wp("request failed",x))}break}},g.upload.onprogress=x=>{var T;b$(v),h.loaded=x.loaded,h.total=x.total,v=y$(y,3e4),(T=o.progressHandler)===null||T===void 0||T.call(o,{loaded:x.loaded,total:x.total})};var w=this.getUrl("/upload",void 0,Cg.V3);a&&d&&w.searchParams.set("filename",encodeURIComponent(d)),!this.opts.useAuthorizationHeader&&this.opts.accessToken&&w.searchParams.set("access_token",encodeURIComponent(this.opts.accessToken)),g.open(de.Post,w.href),this.opts.useAuthorizationHeader&&this.opts.accessToken&&g.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),g.setRequestHeader("Content-Type",l),g.send(e),c.signal.addEventListener("abort",()=>{g.abort()})}else{var S={};a&&d&&(S.filename=d);var R={"Content-Type":l};this.authedRequest(de.Post,"/upload",S,e,{prefix:Cg.V3,headers:R,abortSignal:c.signal}).then(m.resolve,m.reject)}return h.promise=m.promise.finally(()=>{tC(this.uploads,x=>x===h)}),c.signal.addEventListener("abort",()=>{tC(this.uploads,x=>x===h),m.reject(new DOMException("Aborted","AbortError"))}),this.uploads.push(h),h.promise}cancelUpload(e){var n=this.uploads.find(r=>r.promise===e);return n?(n.abortController.abort(),!0):!1}getCurrentUploads(){return this.uploads}getContentUri(){return{base:this.opts.baseUrl,path:Cg.V3+"/upload",params:{access_token:this.opts.accessToken}}}}var I0e=6*60*60*1e3,k0e=30*1e3,LJ=function(t){return t.Stable="stable",t.Unstable="unstable",t}({});class OJ{constructor(e,n){var r=this;this.logger=e,this.http=n,L(this,"capabilities",void 0),L(this,"retryTimeout",void 0),L(this,"refreshTimeout",void 0),L(this,"fetchCapabilities",B(function*(){var i=yield r.http.authedRequest(de.Get,"/capabilities");return r.capabilities=i.capabilities,r.capabilities})),L(this,"poll",B(function*(){try{yield r.fetchCapabilities(),r.clearTimeouts(),r.refreshTimeout=setTimeout(r.poll,I0e),r.logger.debug("Fetched new server capabilities")}catch(s){r.clearTimeouts();var i=Math.floor(k0e+Math.random()*5e3);r.retryTimeout=setTimeout(r.poll,i),r.logger.warn("Failed to refresh capabilities: retrying in ".concat(i,"ms"),s)}}))}start(){this.poll().then()}stop(){this.clearTimeouts()}getCachedCapabilities(){return this.capabilities}clearTimeouts(){this.refreshTimeout&&(clearInterval(this.refreshTimeout),this.refreshTimeout=void 0),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0)}}function _$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function T1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var MJ="10",x0e=["1","2","3","4","5","6","7","8","9","10"],A0e=30,Jt=function(t){return t.Highlight="highlight",t.Total="total",t}({}),ke=function(t){return t.MyMembership="Room.myMembership",t.Tags="Room.tags",t.AccountData="Room.accountData",t.Receipt="Room.receipt",t.Name="Room.name",t.Redaction="Room.redaction",t.RedactionCancelled="Room.redactionCancelled",t.LocalEchoUpdated="Room.localEchoUpdated",t.Timeline="Room.timeline",t.TimelineReset="Room.timelineReset",t.TimelineRefresh="Room.TimelineRefresh",t.OldStateUpdated="Room.OldStateUpdated",t.CurrentStateUpdated="Room.CurrentStateUpdated",t.HistoryImportedWithinTimeline="Room.historyImportedWithinTimeline",t.UnreadNotifications="Room.UnreadNotifications",t.Summary="Room.Summary",t}({});let Q3=class extends CJ{constructor(e,n,r){var i,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),i=this,this.roomId=e,this.client=n,this.myUserId=r,this.opts=s,L(this,"reEmitter",void 0),L(this,"txnToEvent",new Map),L(this,"notificationCounts",{}),L(this,"bumpStamp",void 0),L(this,"threadNotifications",new Map),L(this,"cachedThreadReadReceipts",new Map),L(this,"oldestThreadedReceiptTs",1/0),L(this,"unthreadedReceipts",new Map),L(this,"timelineSets",void 0),L(this,"polls",new Map),L(this,"threadsTimelineSets",[]),L(this,"filteredTimelineSets",{}),L(this,"timelineNeedsRefresh",!1),L(this,"pendingEventList",void 0),L(this,"blacklistUnverifiedDevices",void 0),L(this,"selfMembership",void 0),L(this,"heroes",null),L(this,"getTypeWarning",!1),L(this,"membersPromise",void 0),L(this,"name",void 0),L(this,"normalizedName",void 0),L(this,"tags",{}),L(this,"accountData",new Map),L(this,"summary",null),L(this,"oldState",void 0),L(this,"currentState",void 0),L(this,"relations",void 0),L(this,"threads",new Map),L(this,"visibilityEvents",new Map),L(this,"roomReceipts",new i0e(this)),L(this,"threadTimelineSetsPromise",null),L(this,"threadsReady",!1),L(this,"updateThreadRootEvents",(o,a,c)=>{if(o.length){var l;if(this.updateThreadRootEvent((l=this.threadsTimelineSets)===null||l===void 0?void 0:l[0],o,a,c),o.hasCurrentUserParticipated){var d;this.updateThreadRootEvent((d=this.threadsTimelineSets)===null||d===void 0?void 0:d[1],o,a,c)}}}),L(this,"updateThreadRootEvent",(o,a,c,l)=>{o&&a.rootEvent&&(l&&o.removeEvent(a.id),Un.hasServerSideSupport?o.addLiveEvent(a.rootEvent,{duplicateStrategy:wy.Replace,fromCache:!1,roomState:this.currentState,addToState:!1}):o.addEventToTimeline(a.rootEvent,o.getLiveTimeline(),{toStartOfTimeline:c,addToState:!1}))}),L(this,"tryApplyRedaction",o=>{if(o.isRedaction()){var a=o.event.redacts,c=a?this.findEventById(a):void 0;c&&this.applyEventAsRedaction(o,c)}else if(o.getType()===Z.RoomMember){var l=o.getContent().membership;if(l!==Be.Ban&&!(l===Be.Leave&&o.getStateKey()!==o.getSender()))return;var d=o.getContent()["org.matrix.msc4293.redact_events"];if(d!==!0)return;var h=this.getLiveTimeline().getState(ht.Forward);if(!h.maySendRedactionForEvent(o,o.getSender()))return;var m=this.getTimelineSets().map(y=>y.getTimelines()).reduce((y,v)=>(y.push(...v),y),[]).map(y=>y.getEvents().filter(v=>v.getSender()===o.getStateKey())).reduce((y,v)=>(y.push(...v),v),[]);for(var g of m)this.applyEventAsRedaction(o,g)}}),this.setMaxListeners(100),this.reEmitter=new $v(this),s.pendingEventOrdering=s.pendingEventOrdering||sv.Chronological,this.name=e,this.normalizedName=e,this.relations=new cJ(this.client,this),this.on(ke.Receipt,this.onReceipt),this.timelineSets=[new ag(this,s)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),[ke.Timeline,ke.TimelineReset]),this.fixUpLegacyTimelineFields(),this.opts.pendingEventOrdering===sv.Detached&&(this.pendingEventList=[],this.client.store.getPendingEvents(this.roomId).then(o=>{var a=this.client.getEventMapper({decrypt:!1});o.forEach(function(){var c=B(function*(l){var d=a(l);yield n.decryptEventIfNeeded(d),d.setStatus(rt.NOT_SENT),i.addPendingEvent(d,d.getTxnId())});return function(l){return c.apply(this,arguments)}}())})),this.opts.lazyLoadMembers?this.membersPromise=void 0:this.membersPromise=Promise.resolve(!1)}createThreadsTimelineSets(){var e=this;return B(function*(){var n;if(e.threadTimelineSetsPromise)return e.threadTimelineSetsPromise;if((n=e.client)!==null&&n!==void 0&&n.supportsThreads())try{e.threadTimelineSetsPromise=Promise.all([e.createThreadTimelineSet(),e.createThreadTimelineSet(Ba.My)]);var r=yield e.threadTimelineSetsPromise;return e.threadsTimelineSets[0]=r[0],e.threadsTimelineSets[1]=r[1],r}catch{return e.threadTimelineSetsPromise=null,null}return null})()}decryptCriticalEvents(){var e=this;return B(function*(){if(e.client.getCrypto()){var n=e.getEventReadUpTo(e.client.getUserId(),!0),r=e.getLiveTimeline().getEvents(),i=r.findIndex(o=>o.event.event_id===n),s=r.slice(i).reverse().map(o=>e.client.decryptEventIfNeeded(o));yield Promise.allSettled(s)}})()}decryptAllEvents(){var e=this;return B(function*(){if(e.client.getCrypto()){var n=e.getUnfilteredTimelineSet().getLiveTimeline().getEvents().slice(0).reverse().map(r=>e.client.decryptEventIfNeeded(r));yield Promise.allSettled(n)}})()}getCreator(){var e,n=this.currentState.getStateEvents(Z.RoomCreate,"");return(e=n?.getSender())!==null&&e!==void 0?e:null}getVersion(){return this.currentState.getRoomVersion()}getRecommendedVersion(){var e=this;return B(function*(){var n={};try{n=yield e.client.getCapabilities()}catch{}var r=n["m.room_versions"];if(!r){r={default:MJ,available:{}};for(var i of x0e)r.available[i]=LJ.Stable}var s=e.checkVersionAgainstCapability(r);if(s.urgent&&s.needsUpgrade){M.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about.");try{n=yield e.client.fetchCapabilities()}catch(o){M.warn("Failed to refresh room version capabilities",o)}if(r=n["m.room_versions"],r)s=e.checkVersionAgainstCapability(r);else return M.warn("No room version capability - assuming upgrade required."),s}return s})()}checkVersionAgainstCapability(e){var n=this.getVersion();M.log("[".concat(this.roomId,"] Current version: ").concat(n)),M.log("[".concat(this.roomId,"] Version capability: "),e);var r={version:n,needsUpgrade:!1,urgent:!1};if(n===e.default)return r;var i=Object.keys(e.available).filter(s=>e.available[s]==="stable");return i.includes(n)||(r.version=e.default,r.needsUpgrade=!0,r.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),r.urgent?M.warn("URGENT upgrade required on ".concat(this.roomId)):M.warn("Non-urgent upgrade required on ".concat(this.roomId))),r}userMayUpgradeRoom(e){return this.currentState.maySendStateEvent(Z.RoomTombstone,e)}getPendingEvents(){if(!this.pendingEventList)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}removePendingEvent(e){if(!this.pendingEventList)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);var n=tC(this.pendingEventList,function(r){return r.getId()==e},!1);return this.savePendingEvents(),n}hasPendingEvent(e){var n,r;return(n=(r=this.pendingEventList)===null||r===void 0?void 0:r.some(i=>i.getId()===e))!==null&&n!==void 0?n:!1}getPendingEvent(e){var n,r;return(n=(r=this.pendingEventList)===null||r===void 0?void 0:r.find(i=>i.getId()===e))!==null&&n!==void 0?n:null}getLiveTimeline(){return this.getUnfilteredTimelineSet().getLiveTimeline()}get timeline(){return this.getLiveTimeline().getEvents()}getLastActiveTimestamp(){var e=this.getLiveTimeline(),n=e.getEvents();if(n.length){var r=n[n.length-1];return r.getTs()}else return Number.MIN_SAFE_INTEGER}getLastLiveEvent(){var e,n,r=this.getLiveTimeline().getEvents(),i=r[r.length-1],s=this.getLastThread();if(!s)return i;var o=s.events[s.events.length-1];return((e=i?.getTs())!==null&&e!==void 0?e:0)>((n=o?.getTs())!==null&&n!==void 0?n:0)?i:o}getLastThread(){return this.getThreads().reduce((e,n)=>{var r,i;if(!e)return n;var s=n.events[n.events.length-1],o=e.events[e.events.length-1];return((r=s?.getTs())!==null&&r!==void 0?r:0)>=((i=o?.getTs())!==null&&i!==void 0?i:0)?n:e},void 0)}getMyMembership(){var e;return(e=this.selfMembership)!==null&&e!==void 0?e:Be.Leave}getDMInviter(){var e=this.getMember(this.myUserId);if(e)return e.getDMInviter();if(this.selfMembership===Be.Invite){var n=this.getInvitedAndJoinedMemberCount();if(n===2){var r;return(r=this.heroes)===null||r===void 0||(r=r[0])===null||r===void 0?void 0:r.userId}}}guessDMUserId(){var e=this.getMember(this.myUserId);if(e){var n=e.getDMInviter();if(n)return n}if(Array.isArray(this.heroes)&&this.heroes.length)return this.heroes[0].userId;var r=this.currentState.getMembers(),i=r.find(s=>s.userId!==this.myUserId);return i?i.userId:this.myUserId}getFunctionalMembers(){var e=this.currentState.getStateEvents(JX.name,"");return Array.isArray(e?.getContent().service_members)?e.getContent().service_members:[]}getAvatarFallbackMember(){var e,n=this.getFunctionalMembers(),r=0;if(this.getMembers().forEach(v=>{v.membership!=="join"&&v.membership!=="invite"||n.includes(v.userId)||r++}),!(r>2)){var i=(e=this.heroes)===null||e===void 0?void 0:e.filter(v=>!n.includes(v.userId)),s=Array.isArray(i)&&i.length;if(s){for(var o of i)if(o.fromMSC4186){var c=new cb(this.roomId,o.userId);return c.setMembershipEvent(new $i({event_id:"$"+this.roomId+o.userId+new Date().getTime(),type:Z.RoomMember,state_key:o.userId,content:{displayname:o.displayName,avatar_url:o.avatarUrl}})),c}else{var a=this.getMember(o.userId);if(a)return a}var l=i.map(v=>this.getMember(v.userId)).find(v=>!!v);if(l)return l}var d=this.getMembers(),h=d?.filter(v=>!n.includes(v.userId));if(h.length<=2){var m=h.find(v=>v.userId!==this.myUserId);if(m)return m}if(s){var g=i.map(v=>this.client.getUser(v.userId)).find(v=>!!v);if(g){var y=new cb(this.roomId,g.userId);return y.user=g,y}}}}updateMyMembership(e){var n=this.selfMembership;this.selfMembership=e,n!==e&&(e===Be.Leave&&this.cleanupAfterLeaving(),this.emit(ke.MyMembership,this,e,n))}loadMembersFromServer(){var e=this;return B(function*(){var n=e.client.store.getSyncToken(),r=yield e.client.members(e.roomId,void 0,Be.Leave,n??void 0);return r.chunk})()}loadMembers(){var e=this;return B(function*(){var n=!1,r=yield e.client.store.getOutOfBandMembers(e.roomId);(r===null||e.hasEncryptionStateEvent())&&(n=!0,r=yield e.loadMembersFromServer(),M.log("LL: got ".concat(r.length," ")+"members from server for room ".concat(e.roomId)));var i=r.filter(Ka).map(e.client.getEventMapper());return{memberEvents:i,fromServer:n}})()}membersLoaded(){return this.opts.lazyLoadMembers?this.currentState.outOfBandMembersReady():!0}loadMembersIfNeeded(){if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();var e=this.loadMembers().then(n=>(this.currentState.setOutOfBandMembers(n.memberEvents),n.fromServer)).catch(n=>{throw this.membersPromise=void 0,this.currentState.markOutOfBandMembersFailed(),n});return e.then(n=>{if(n){var r=this.currentState.getMembers().filter(s=>s.isOutOfBand()).map(s=>{var o;return(o=s.events.member)===null||o===void 0?void 0:o.event});M.log("LL: telling store to write ".concat(r.length)+" members for room ".concat(this.roomId));var i=this.client.store;return i.setOutOfBandMembers(this.roomId,r).catch(s=>{M.log("LL: storing OOB room members failed, oh well",s)})}}).catch(n=>{M.error(n)}),this.membersPromise=e,this.membersPromise}clearLoadedMembersIfNeeded(){var e=this;return B(function*(){e.opts.lazyLoadMembers&&e.membersPromise&&(yield e.loadMembersIfNeeded(),yield e.client.store.clearOutOfBandMembers(e.roomId),e.currentState.clearOutOfBandMembers(),e.membersPromise=void 0)})()}cleanupAfterLeaving(){this.clearLoadedMembersIfNeeded().catch(e=>{M.error("error after clearing loaded members from "+"room ".concat(this.roomId," after leaving")),M.log(e)})}refreshLiveTimeline(){var e=this;return B(function*(){var n=e.getLiveTimeline(),r=n.getPaginationToken(Me.FORWARDS),i=n.getPaginationToken(Me.BACKWARDS),s=n.getEvents(),o=s[s.length-1];M.log("[refreshLiveTimeline for ".concat(e.roomId,"] at ")+"mostRecentEventInTimeline=".concat(o&&o.getId()," ")+"liveTimelineBefore=".concat(n.toString()," ")+"forwardPaginationToken=".concat(r," ")+"backwardPaginationToken=".concat(i));var a=e.getUnfilteredTimelineSet(),c;o?(e.resetLiveTimeline(null,null),e.emit(ke.TimelineRefresh,e,a),c=yield e.client.getEventTimeline(a,o.getId())):c=yield e.client.getLatestTimeline(a);var l=a.getLiveTimeline();!l||l.getPaginationToken(ht.Forward)===null&&l.getPaginationToken(ht.Backward)===null&&l.getEvents().length===0?(M.log("[refreshLiveTimeline for ".concat(e.roomId,"] using our new live timeline")),c.setPaginationToken(r,Me.FORWARDS),a.setLiveTimeline(c),e.fixUpLegacyTimelineFields()):M.log("[refreshLiveTimeline for ".concat(e.roomId,"] `/sync` or some other request beat us to creating a new ")+"live timeline after we reset it. We'll use that instead since any events in the scrollback from this timeline will include the history."),e.setTimelineNeedsRefresh(!1),e.emit(ke.TimelineRefresh,e,a)})()}resetLiveTimeline(e,n){for(var r of this.timelineSets)r.resetLiveTimeline(e??void 0,n??void 0);for(var i of this.threads.values())i.resetLiveTimeline(e,n);this.fixUpLegacyTimelineFields()}fixUpLegacyTimelineFields(){var e=this.oldState,n=this.currentState;this.oldState=this.getLiveTimeline().getState(Me.BACKWARDS),this.currentState=this.getLiveTimeline().getState(Me.FORWARDS),e!==this.oldState&&this.emit(ke.OldStateUpdated,this,e,this.oldState),n!==this.currentState&&(this.emit(ke.CurrentStateUpdated,this,n,this.currentState),this.reEmitter.stopReEmitting(n,[pt.Events,pt.Members,pt.NewMember,pt.Update,pt.Marker,qn.New,qn.Update,qn.Destroy,qn.LivenessChange]),this.reEmitter.reEmit(this.currentState,[pt.Events,pt.Members,pt.NewMember,pt.Update,pt.Marker,qn.New,qn.Update,qn.Destroy,qn.LivenessChange]))}onReceipt(e){this.hasEncryptionStateEvent()&&this.clearNotificationsOnReceipt(e)}clearNotificationsOnReceipt(e){var n=[],r=!1,i=e.getContent();for(var s of Object.values(i))for(var[o,a]of Object.entries(s))if(OO(o)&&a){for(var[c,l]of Object.entries(a))if(!(!l||typeof l!="object")){var d=l;c===this.client.getUserId()&&(d.thread_id===void 0?r=!0:typeof d.thread_id=="string"&&n.push(d.thread_id))}}r&&(n=this.getThreads().filter(I=>this.getThreadUnreadNotificationCount(I.id,Jt.Total)>0||this.getThreadUnreadNotificationCount(I.id,Jt.Highlight)>0).map(I=>I.id),n.push("main"));for(var h of n){var m,g=20,y=h==="main"?this.getLiveTimeline():(m=this.getThread(h))===null||m===void 0?void 0:m.liveTimeline;if(!y){M.warn("Couldn't find timeline for thread ID ".concat(h," in room ").concat(this.roomId));continue}for(var v=y.getEvents(),w=0,S=v.length-1;S>=0;S--){var R;if(S===v.length-g)return;var x=v[S];if(this.hasUserReadEvent(this.client.getUserId(),x.getId()))break;var T=this.client.getPushActionsForEvent(x);w+=T!=null&&(R=T.tweaks)!==null&&R!==void 0&&R.highlight?1:0}h==="main"?this.setUnreadNotificationCount(Jt.Highlight,w):this.setThreadUnreadNotificationCount(h,Jt.Highlight,w)}}getTimelineSets(){return this.timelineSets}getUnfilteredTimelineSet(){return this.timelineSets[0]}getTimelineForEvent(e){var n=this.findEventById(e),r=this.findThreadForEvent(n);return r?r.timelineSet.getTimelineForEvent(e):this.getUnfilteredTimelineSet().getTimelineForEvent(e)}addTimeline(){return this.getUnfilteredTimelineSet().addTimeline()}setTimelineNeedsRefresh(e){this.timelineNeedsRefresh=e}getTimelineNeedsRefresh(){return this.timelineNeedsRefresh}findEventById(e){var n=this.getUnfilteredTimelineSet().findEventById(e);if(!n)for(var r=this.getThreads(),i=0;i<r.length;i++){var s=r[i];if(n=s.findEventById(e),n)return n}return n}getUnreadNotificationCount(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Jt.Total,n=this.getRoomUnreadNotificationCount(e);for(var r of this.threadNotifications.values()){var i;n+=(i=r[e])!==null&&i!==void 0?i:0}return n}getUnreadCountForEventContext(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Jt.Total,r=arguments.length>1?arguments[1]:void 0,i=!!r.threadRootId&&!r.isThreadRoot;return(e=i?this.getThreadUnreadNotificationCount(r.threadRootId,n):this.getRoomUnreadNotificationCount(n))!==null&&e!==void 0?e:0}getRoomUnreadNotificationCount(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Jt.Total;return(e=this.notificationCounts[n])!==null&&e!==void 0?e:0}getThreadUnreadNotificationCount(e){var n,r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Jt.Total;return(n=(r=this.threadNotifications.get(e))===null||r===void 0?void 0:r[i])!==null&&n!==void 0?n:0}hasThreadUnreadNotification(){for(var e of this.threadNotifications.values()){var n,r;if(((n=e.highlight)!==null&&n!==void 0?n:0)>0||((r=e.total)!==null&&r!==void 0?r:0)>0)return!0}return!1}setThreadUnreadNotificationCount(e,n,r){var i,s,o=T1({highlight:(i=this.threadNotifications.get(e))===null||i===void 0?void 0:i.highlight,total:(s=this.threadNotifications.get(e))===null||s===void 0?void 0:s.total},{[n]:r});this.threadNotifications.set(e,o),this.emit(ke.UnreadNotifications,o,e)}get threadsAggregateNotificationType(){var e=null;for(var n of this.threadNotifications.values()){var r,i;if(((r=n.highlight)!==null&&r!==void 0?r:0)>0)return Jt.Highlight;((i=n.total)!==null&&i!==void 0?i:0)>0&&!e&&(e=Jt.Total)}return e}resetThreadUnreadNotificationCountFromSync(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=this.hasEncryptionStateEvent();for(var[r,i]of this.threadNotifications)e.includes(r)||(i.total=0,n||(i.highlight=0));this.emit(ke.UnreadNotifications)}setBumpStamp(e){this.bumpStamp=e}getBumpStamp(){return this.bumpStamp}setUnreadNotificationCount(e,n){this.notificationCounts[e]=n,this.emit(ke.UnreadNotifications,this.notificationCounts)}setUnread(e,n){return this.setUnreadNotificationCount(e,n)}setSummary(e){var n,r=(n=e["m.heroes"])===null||n===void 0?void 0:n.map(o=>({userId:o,fromMSC4186:!1})),i=e["m.joined_member_count"],s=e["m.invited_member_count"];Number.isInteger(i)&&this.currentState.setJoinedMemberCount(i),Number.isInteger(s)&&this.currentState.setInvitedMemberCount(s),Array.isArray(r)&&(this.heroes=r.filter(o=>o.userId!=this.myUserId)),this.emit(ke.Summary,e)}setMSC4186SummaryData(e,n,r){e&&(this.heroes=e.filter(i=>i.user_id!==this.myUserId).map(i=>({userId:i.user_id,displayName:i.displayname,avatarUrl:i.avatar_url,fromMSC4186:!0}))),n!==void 0&&Number.isInteger(n)&&this.currentState.setJoinedMemberCount(n),r!==void 0&&Number.isInteger(r)&&this.currentState.setInvitedMemberCount(r),this.emit(ke.Summary,{"m.heroes":this.heroes?this.heroes.map(i=>i.userId):[],"m.joined_member_count":n,"m.invited_member_count":r})}setBlacklistUnverifiedDevices(e){this.blacklistUnverifiedDevices=e}getBlacklistUnverifiedDevices(){return this.blacklistUnverifiedDevices===void 0?null:this.blacklistUnverifiedDevices}getAvatarUrl(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,a=this.currentState.getStateEvents(Z.RoomAvatar,"");if(!a&&!s)return null;var c=a?a.getContent().url:null;return c?W3(e,c,n,r,i,void 0,void 0,o):null}getMxcAvatarUrl(){var e;return((e=this.currentState.getStateEvents(Z.RoomAvatar,""))===null||e===void 0||(e=e.getContent())===null||e===void 0?void 0:e.url)||null}getCanonicalAlias(){var e=this.currentState.getStateEvents(Z.RoomCanonicalAlias,"");return e&&e.getContent().alias||null}getAltAliases(){var e=this.currentState.getStateEvents(Z.RoomCanonicalAlias,"");return e?e.getContent().alt_aliases||[]:[]}addEventsToTimeline(e,n,r,i,s){i.getTimelineSet().addEventsToTimeline(e,n,r,i,s)}getThread(e){var n;return(n=this.threads.get(e))!==null&&n!==void 0?n:null}getThreads(){return Array.from(this.threads.values())}getMember(e){return this.currentState.getMember(e)}getMembers(){return this.currentState.getMembers()}getJoinedMembers(){return this.getMembersWithMembership(Be.Join)}getJoinedMemberCount(){return this.currentState.getJoinedMemberCount()}getInvitedMemberCount(){return this.currentState.getInvitedMemberCount()}getInvitedAndJoinedMemberCount(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}getMembersWithMembership(e){return this.currentState.getMembers().filter(function(n){return n.membership===e})}getEncryptionTargetMembers(){var e=this;return B(function*(){yield e.loadMembersIfNeeded();var n=e.getMembersWithMembership(Be.Join);return e.shouldEncryptForInvitedMembers()&&(n=n.concat(e.getMembersWithMembership(Be.Invite))),n})()}shouldEncryptForInvitedMembers(){var e,n=this.currentState.getStateEvents(Z.RoomHistoryVisibility,"");return(n==null||(e=n.getContent())===null||e===void 0?void 0:e.history_visibility)!=="joined"}getDefaultRoomName(e){return this.calculateRoomName(e,!0)}hasMembershipState(e,n){var r=this.getMember(e);return r?r.membership===n:!1}getOrCreateFilteredTimelineSet(e){var{prepopulateTimeline:n=!0,useSyncEvents:r=!0,pendingEvents:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];var s=Object.assign({filter:e,pendingEvents:i},this.opts),o=new ag(this,s);this.reEmitter.reEmit(o,[ke.Timeline,ke.TimelineReset]),r&&(this.filteredTimelineSets[e.filterId]=o,this.timelineSets.push(o));var a=this.getLiveTimeline();if(n){a.getEvents().forEach(function(d){o.addLiveEvent(d,{addToState:!1})});for(var c=a;c.getNeighbouringTimeline(Me.BACKWARDS);)c=c.getNeighbouringTimeline(Me.BACKWARDS);o.getLiveTimeline().setPaginationToken(c.getPaginationToken(Me.BACKWARDS),Me.BACKWARDS)}else if(r){var l=a.getPaginationToken(ht.Forward);o.getLiveTimeline().setPaginationToken(l,ht.Backward)}return o}getThreadListFilter(){var e=arguments,n=this;return B(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:Ba.All,i=n.client.getUserId(),s=new Us(i),o={room:{timeline:{[kg.name]:[wn.name]}}};r===Ba.My&&(o.room.timeline[Ig.name]=[i]),s.setDefinition(o);var a=yield n.client.getOrCreateFilter("THREAD_PANEL_".concat(n.roomId,"_").concat(r),s);return s.filterId=a,s})()}createThreadTimelineSet(e){var n=this;return B(function*(){var r;if(Un.hasServerSideListSupport)r=new ag(n,T1(T1({},n.opts),{},{pendingEvents:!1}),void 0,void 0,e??Ba.All),n.reEmitter.reEmit(r,[ke.Timeline,ke.TimelineReset]);else if(Un.hasServerSideSupport){var i=yield n.getThreadListFilter(e);r=n.getOrCreateFilteredTimelineSet(i,{prepopulateTimeline:!1,useSyncEvents:!1,pendingEvents:!1})}else r=new ag(n,{pendingEvents:!1}),Array.from(n.threads).forEach(s=>{var[,o]=s;if(o.length!==0){var a=o.timeline.some(c=>c.getSender()===n.client.getUserId());(e!==Ba.My||a)&&r.getLiveTimeline().addEvent(o.rootEvent,{toStartOfTimeline:!1,addToState:!1})}});return r})()}processThreadRoots(e,n){if(this.client.supportsThreads())for(var r of e)Me.setEventMetadata(r,this.currentState,n),this.getThread(r.getId())||this.createThread(r.getId(),r,[],n)}fetchRoomThreads(){var e=this;return B(function*(){if(!(e.threadsReady||!e.client.supportsThreads())){if(Un.hasServerSideListSupport)yield Promise.all([e.fetchRoomThreadList(Ba.All),e.fetchRoomThreadList(Ba.My)]);else{var n=yield e.getThreadListFilter(),{chunk:r}=yield e.client.createMessagesRequest(e.roomId,"",Number.MAX_SAFE_INTEGER,ht.Backward,n);if(!r.length)return;var i=r.map(e.client.getEventMapper()).sort((m,g)=>{var y=m.getServerAggregatedRelation(wn.name),v=g.getServerAggregatedRelation(wn.name);return y.latest_event.origin_server_ts-v.latest_event.origin_server_ts}),s,o=e.getLiveTimeline().getState(Me.FORWARDS);for(var a of i){var c,l={duplicateStrategy:wy.Ignore,fromCache:!1,addToState:!1,roomState:o};(c=e.threadsTimelineSets[0])===null||c===void 0||c.addLiveEvent(a,l);var d=a.getServerAggregatedRelation(wn.name);if(d!=null&&d.current_user_participated){var h;(h=e.threadsTimelineSets[1])===null||h===void 0||h.addLiveEvent(a,l),s=a}}e.processThreadRoots(i,!0),e.client.decryptEventIfNeeded(i[i.length-1]),s&&e.client.decryptEventIfNeeded(s)}e.on(us.NewReply,e.onThreadReply),e.on(us.Update,e.onThreadUpdate),e.on(us.Delete,e.onThreadDelete),e.threadsReady=!0}})()}processPollEvents(e){var n=this;return B(function*(){for(var r of e)try{if(!r.isEncrypted()&&!RJ(r))continue;yield n.client.decryptEventIfNeeded(r),n.processPollEvent(r)}catch(i){M.warn("Error processing poll event",r.getId(),i)}})()}processPollEvent(e){var n=this;return B(function*(){if(e.isDecryptionFailure()){e.once(Kt.Decrypted,o=>{n.processPollEvent(o)});return}if(to.M_POLL_START.matches(e.getType())){try{var r=new TJ(e,n.client,n);n.polls.set(e.getId(),r),n.emit(Md.New,r),e.once(Kt.BeforeRedaction,o=>{n.polls.delete(o.getId())})}catch{}return}var i=e.relationEventId;if(i&&n.polls.has(i)){var s=n.polls.get(i);s?.onNewRelation(e)}})()}fetchRoomThreadList(e){var n=this;return B(function*(){if(n.client.supportsThreads()&&n.threadsTimelineSets.length!==0){var r=e===Ba.My?n.threadsTimelineSets[1]:n.threadsTimelineSets[0],{chunk:i,end:s}=yield n.client.createThreadListMessagesRequest(n.roomId,null,void 0,ht.Backward,r.threadListType,r.getFilter());if(r.getLiveTimeline().setPaginationToken(s??null,ht.Backward),!!i.length){var o=i.map(n.client.getEventMapper());n.processThreadRoots(o,!0);var a=n.getLiveTimeline().getState(Me.FORWARDS);for(var c of o)r.addLiveEvent(c,{duplicateStrategy:wy.Replace,fromCache:!1,roomState:a,addToState:!1})}}})()}onThreadUpdate(e){this.updateThreadRootEvents(e,!1,!1)}onThreadReply(e){this.updateThreadRootEvents(e,!1,!0)}onThreadDelete(e){var n;this.threads.delete(e.id);var r=this.getTimelineForEvent(e.id),i=r==null||(n=r.getEvents())===null||n===void 0?void 0:n.find(o=>o.getId()===e.id);i?e.clearEventMetadata(i):M.debug("onThreadDelete: Could not find root event in room timeline");for(var s of this.threadsTimelineSets)s.removeEvent(e.id)}removeFilteredTimelineSet(e){var n=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];var r=this.timelineSets.indexOf(n);r>-1&&this.timelineSets.splice(r,1)}eventShouldLiveIn(e,n,r){var i;if(!((i=this.client)!==null&&i!==void 0&&i.supportsThreads()))return{shouldLiveInRoom:!0,shouldLiveInThread:!1};if(e.isThreadRoot||r!=null&&r.has(e.getId()))return{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.getId()};var s=e.isRelation(wn.name),o=e.getAssociatedId(),a=e.threadRootId;if(o&&!s&&(a===o||r!=null&&r.has(o)))return{shouldLiveInRoom:!0,shouldLiveInThread:!1};var c;if(o){var l;c=(l=this.findEventById(o))!==null&&l!==void 0?l:n?.find(d=>d.getId()===o)}return c&&!s?this.eventShouldLiveIn(c,n,r):a!=null?{shouldLiveInRoom:!1,shouldLiveInThread:!0,threadId:a}:!o||e.replyEventId?{shouldLiveInRoom:!0,shouldLiveInThread:!1}:{shouldLiveInRoom:!1,shouldLiveInThread:!1}}findThreadForEvent(e){if(!e)return null;var{threadId:n}=this.eventShouldLiveIn(e);return n?this.getThread(n):null}addThreadedEvents(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.getThread(e);if(i)i.addEvents(n,r);else{var s,o=(s=this.findEventById(e))!==null&&s!==void 0?s:n.find(a=>a.getId()===e);this.createThread(e,o,n,r)}}processThreadedEvents(e,n){e.forEach(this.tryApplyRedaction);var r={};for(var i of e){var s,{threadId:o,shouldLiveInThread:a}=this.eventShouldLiveIn(i);a&&!r[o]&&(r[o]=[]),(s=r[o])===null||s===void 0||s.push(i)}Object.entries(r).map(c=>{var[l,d]=c;return this.addThreadedEvents(l,d,n)})}createThread(e,n){var r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=arguments.length>3?arguments[3]:void 0;if(this.threads.has(e))return this.threads.get(e);if(n){var o=this.relations.getAllChildEventsForEvent(n.getId());o!=null&&o.length&&(i=i.concat(o.filter(c=>!c.isRelation(vn.Replace))))}var a=new Un(e,n,{room:this,client:this.client,pendingEventOrdering:this.opts.pendingEventOrdering,receipts:(r=this.cachedThreadReadReceipts.get(e))!==null&&r!==void 0?r:[]});return this.reEmitter.reEmit(a,[us.Delete,us.Update,us.NewReply,ke.Timeline,ke.TimelineReset]),this.cachedThreadReadReceipts.delete(e),this.threads.set(a.id,a),a.addEvents(i,!1),this.threadsReady&&a.initialEventsFetched&&this.updateThreadRootEvents(a,s,!1),this.emit(us.New,a,s),a}applyEventAsRedaction(e,n){var r=n.threadRootId;if(n.makeRedacted(e,this),n.isState()){var i=this.currentState.getStateEvents(n.getType(),n.getStateKey());i?.getId()===n.getId()&&this.currentState.setStateEvents([n])}this.emit(ke.Redaction,e,this,r),this.visibilityEvents.delete(n.getId()),n.isVisibilityEvent()&&this.redactVisibilityChangeEvent(e)}processLiveEvent(e){this.tryApplyRedaction(e),e.isVisibilityEvent()&&this.applyNewVisibilityEvent(e),this.applyPendingVisibilityEvents(e);var n=e.getUnsigned().transaction_id;if(!n&&e.getSender()===this.myUserId){for(var[r,i]of this.txnToEvent)if(i.getId()===e.getId()){M.debug("processLiveEvent: found sent event without txn ID: ",r,e.getId());var s=e.getUnsigned();s.transaction_id=r,e.setUnsigned(s);break}}}addLiveEvent(e,n){var{duplicateStrategy:r,timelineWasEmpty:i,fromCache:s,addToState:o}=n;for(var a of this.timelineSets)a.addLiveEvent(e,{duplicateStrategy:r,fromCache:s,timelineWasEmpty:i,addToState:o});e.sender&&e.getType()!==Z.RoomRedaction&&this.addReceipt(wJ(e.sender.userId,e,ls.Read),!0)}addPendingEvent(e,n){if(e.status!==rt.SENDING&&e.status!==rt.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent.get(n))throw new Error("addPendingEvent called on an event with known txnId "+n);if(Me.setEventMetadata(e,this.getLiveTimeline().getState(Me.FORWARDS),!1),this.txnToEvent.set(n,e),this.pendingEventList){if(this.pendingEventList.some(o=>o.status===rt.NOT_SENT)&&(M.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(rt.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){var r=e.event.redacts,i=this.pendingEventList.find(o=>o.getId()===r);!i&&r&&(i=this.findEventById(r)),i&&(i.markLocallyRedacted(e),this.emit(ke.Redaction,e,this,i.threadRootId))}}else for(var s of this.timelineSets)s.getFilter()?s.getFilter().filterRoomTimeline([e]).length&&s.addEventToTimeline(e,s.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1}):s.addEventToTimeline(e,s.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1});this.emit(ke.LocalEchoUpdated,e,this)}savePendingEvents(){if(this.pendingEventList){var e=this.pendingEventList.map(n=>T1(T1({},n.event),{},{txn_id:n.getTxnId()})).filter(n=>{var r=n.type===Z.RoomMessageEncrypted,i=this.hasEncryptionStateEvent();return r||!i});this.client.store.setPendingEvents(this.roomId,e)}}aggregateNonLiveRelation(e){this.relations.aggregateChildEvent(e)}getEventForTxnId(e){return this.txnToEvent.get(e)}handleRemoteEcho(e,n){var r=n.getId(),i=e.getId(),s=n.status;M.debug("Got remote echo for event ".concat(r," -> ").concat(i," old status ").concat(s)),this.txnToEvent.delete(e.getUnsigned().transaction_id),this.pendingEventList&&this.removePendingEvent(r),n.handleRemoteEcho(e.event);var{shouldLiveInRoom:o,threadId:a}=this.eventShouldLiveIn(e),c=a?this.getThread(a):null;if(c?.setEventMetadata(n),c?.timelineSet.handleRemoteEcho(n,r,i),o)for(var l of this.timelineSets)l.handleRemoteEcho(n,r,i);this.emit(ke.LocalEchoUpdated,n,this,r,s)}updatePendingEvent(e,n,r){if(M.log("setting pendingEvent status to ".concat(n," in ").concat(e.getRoomId()," ")+"event ID ".concat(e.getId()," -> ").concat(r)),n==rt.SENT&&!r)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(n==rt.SENT){var i=this.getTimelineForEvent(r);if(i){var s=this.findEventById(r),o=s?.getUnsigned().transaction_id;if(!o&&s){var a=s.getUnsigned();a.transaction_id=e.getTxnId(),s.setUnsigned(a),this.removeEvent(s.getId()),this.handleRemoteEcho(s,e)}return}}var c=e.status,l=e.getId();if(!c)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");var d=P0e[c];if(!(d!=null&&d.includes(n)))throw new Error("Invalid EventStatus transition ".concat(c,"->").concat(n));if(e.setStatus(n),n==rt.SENT){e.replaceLocalEventId(r);var{shouldLiveInRoom:h,threadId:m}=this.eventShouldLiveIn(e),g=m?this.getThread(m):void 0;if(g?.setEventMetadata(e),g?.timelineSet.replaceEventId(l,r),h)for(var y of this.timelineSets)y.replaceEventId(l,r)}else if(n==rt.CANCELLED){if(this.pendingEventList){var v=this.getPendingEvent(l);this.removePendingEvent(l),v!=null&&v.isRedaction()&&this.revertRedactionLocalEcho(v)}this.removeEvent(l)}this.savePendingEvents(),this.emit(ke.LocalEchoUpdated,e,this,l,c)}revertRedactionLocalEcho(e){var n=e.event.redacts;if(n){var r=this.getUnfilteredTimelineSet().findEventById(n);r&&(r.unmarkLocallyRedacted(),this.emit(ke.RedactionCancelled,e,this),r.isRelation()&&this.aggregateNonLiveRelation(r))}}assertTimelineSetsAreLive(){for(var e=0;e<this.timelineSets.length;e++){var n=this.timelineSets[e].getLiveTimeline();if(n.getPaginationToken(Me.FORWARDS))throw new Error("live timeline "+e+" is no longer live - it has a pagination token ("+n.getPaginationToken(Me.FORWARDS)+")");if(n.getNeighbouringTimeline(Me.FORWARDS))throw new Error("live timeline ".concat(e," is no longer live - it has a neighbouring timeline"))}}addLiveEvents(e,n){var r=this;return B(function*(){var{duplicateStrategy:i,fromCache:s,timelineWasEmpty:o=!1,addToState:a}=n;if(i&&["replace","ignore"].indexOf(i)===-1)throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");r.assertTimelineSetsAreLive();var c=r.findThreadRoots(e),l={},d={duplicateStrategy:i,fromCache:s,timelineWasEmpty:o,addToState:a},h=[...e];for(var m of e){var g;if(r.processLiveEvent(m),m.getUnsigned().transaction_id){var y=r.txnToEvent.get(m.getUnsigned().transaction_id);if(y){r.handleRemoteEcho(m,y);continue}}var{shouldLiveInRoom:v,shouldLiveInThread:w,threadId:S=""}=r.eventShouldLiveIn(m,h,c);if(!w&&!v&&m.isRelation())try{var R=new $i(yield r.client.fetchRoomEvent(r.roomId,m.relationEventId));if(h.push(R),R.threadRootId){c.add(R.threadRootId);var x=m.getUnsigned();x[oC.name]=R.threadRootId,m.setUnsigned(x)}({shouldLiveInRoom:v,shouldLiveInThread:w,threadId:S=""}=r.eventShouldLiveIn(m,h,c))}catch(T){M.error("Failed to load parent event of unhandled relation",T)}w&&!l[S]&&(l[S]=[]),(g=l[S])===null||g===void 0||g.push(m),v?r.addLiveEvent(m,d):!w&&m.isRelation()&&r.relations.aggregateChildEvent(m)}Object.entries(l).forEach(T=>{var[I,k]=T;r.addThreadedEvents(I,k,!1)})})()}partitionThreadedEvents(e){var n=0,r=1,i=2;if(this.client.supportsThreads()){var s=this.findThreadRoots(e);return e.reduce((o,a)=>{var{shouldLiveInRoom:c,shouldLiveInThread:l,threadId:d}=this.eventShouldLiveIn(a,e,s);return c&&o[n].push(a),l&&(a.setThreadId(d??""),o[r].push(a)),!l&&!c&&o[i].push(a),o},[[],[],[]])}else return[e,[],[]]}findThreadRoots(e){var n=new Set;for(var r of e){var i=r.threadRootId;i!=null&&n.add(i)}return n}addReceipt(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e.getContent();this.roomReceipts.add(r,n),Object.keys(r).forEach(i=>{Object.keys(r[i]).forEach(s=>{Object.keys(r[i][s]).forEach(o=>{var a,c,l,d=r[i][s][o],h=!d.thread_id||d.thread_id===u_,m=h?this:this.threads.get((a=d.thread_id)!==null&&a!==void 0?a:"");if(m){if(m.addReceiptToStructure(i,s,o,d,n),!n&&this.client.isInitialSyncComplete()&&o===this.client.getUserId()){var g=m.timeline[m.timeline.length-1];g&&i===g.getId()&&o===g.getSender()&&(m.setUnread(Jt.Total,0),m.setUnread(Jt.Highlight,0))}}else{var y;this.cachedThreadReadReceipts.set(d.thread_id,[...(y=this.cachedThreadReadReceipts.get(d.thread_id))!==null&&y!==void 0?y:[],{eventId:i,receiptType:s,userId:o,receipt:d,synthetic:n}])}var v=this.client.getUserId();o===v&&!h&&d.ts<this.oldestThreadedReceiptTs&&(this.oldestThreadedReceiptTs=d.ts),!d.thread_id&&d.ts>((c=(l=this.unthreadedReceipts.get(o))===null||l===void 0?void 0:l.ts)!==null&&c!==void 0?c:0)&&this.unthreadedReceipts.set(o,d)})})}),this.emit(ke.Receipt,e,this)}addEphemeralEvents(e){for(var n of e)n.getType()===Z.Typing?this.currentState.setTypingEvent(n):n.getType()===Z.Receipt&&this.addReceipt(n)}removeEvents(e){for(var n of e)this.removeEvent(n)}removeEvent(e){var n=!1;for(var r of this.timelineSets){var i=r.removeEvent(e);i&&(i.isRedaction()&&this.revertRedactionLocalEcho(i),n=!0)}return n}recalculate(){var e=this.currentState.getStateEvents(Z.RoomMember,this.myUserId);if(e){var n=e.getContent().membership;if(this.updateMyMembership(n),n===Be.Invite){var r=e.getUnsigned().invite_room_state||[];r.forEach(s=>{var o=this.currentState.getStateEvents(s.type,s.state_key);o||this.currentState.setStateEvents([new $i({type:s.type,state_key:s.state_key,content:s.content,event_id:"$fake"+Date.now(),room_id:this.roomId,sender:this.myUserId})])})}}var i=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=pve(this.name),this.summary=new lJ(this.roomId,{title:this.name}),i!==this.name&&this.emit(ke.Name,this)}addTags(e){this.tags=e.getContent().tags||{},this.emit(ke.Tags,e,this)}addAccountData(e){for(var n of e){n.getType()==="m.tag"&&this.addTags(n);var r=n.getType(),i=this.accountData.get(r);this.accountData.set(r,n),this.emit(ke.AccountData,n,this,i)}}getAccountData(e){return this.accountData.get(e)}maySendMessage(){return this.getMyMembership()===Be.Join&&(this.hasEncryptionStateEvent()?this.currentState.maySendEvent(Z.RoomMessageEncrypted,this.myUserId):this.currentState.maySendEvent(Z.RoomMessage,this.myUserId))}canInvite(e){var n=this.getMyMembership()===Be.Join,r=this.currentState.getStateEvents(Z.RoomPowerLevels,""),i=r&&r.getContent(),s=this.getMember(e);return i&&s&&i.invite>s.powerLevel&&(n=!1),n}getJoinRule(){return this.currentState.getJoinRule()}getHistoryVisibility(){return this.currentState.getHistoryVisibility()}getGuestAccess(){return this.currentState.getGuestAccess()}getType(){var e=this.currentState.getStateEvents(Z.RoomCreate,"");if(!e){this.getTypeWarning||(M.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0);return}return e.getContent()[sC]}isSpaceRoom(){return this.getType()===wg.Space}isCallRoom(){return this.getType()===wg.UnstableCall}isElementVideoRoom(){return this.getType()===wg.ElementVideo}findPredecessor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=this.getLiveTimeline().getState(Me.FORWARDS);return n?n.findPredecessor(e):null}roomNameGenerator(e){if(this.client.roomNameGenerator){var n=this.client.roomNameGenerator(this.roomId,e);if(n!==null)return n}switch(e.type){case Pc.Actual:return e.name;case Pc.Generated:switch(e.subtype){case"Inviting":return"Inviting ".concat(S$(e.names,e.count));default:return S$(e.names,e.count)}case Pc.EmptyRoom:return e.oldName?"Empty room (was ".concat(e.oldName,")"):"Empty room"}}calculateRoomName(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!n){var r=this.currentState.getStateEvents(Z.RoomName,"");if(r!=null&&r.getContent().name)return this.roomNameGenerator({type:Pc.Actual,name:r.getContent().name})}var i=this.getCanonicalAlias();if(i)return this.roomNameGenerator({type:Pc.Actual,name:i});var s=this.currentState.getJoinedMemberCount(),o=this.currentState.getInvitedMemberCount(),a=s+o-1,c=this.getFunctionalMembers(),l=[];if(this.heroes)this.heroes.forEach(S=>{if(c.includes(S.userId)){a--;return}if(S.displayName)l.push(S.displayName);else{var R=this.getMember(S.userId);l.push(R?R.name:S.userId)}});else{var d=this.currentState.getMembers().filter(S=>S.userId!==e&&(S.membership===Be.Invite||S.membership===Be.Join));d=d.filter(S=>{var{userId:R}=S;return c.includes(R)?(a--,!1):!0});var h=new Intl.Collator;d.sort((S,R)=>h.compare(S.userId,R.userId)),d=d.slice(0,5),l=d.map(S=>S.name)}if(a)return this.roomNameGenerator({type:Pc.Generated,names:l,count:a});var m=this.getMyMembership();if(m==Be.Join){var g=this.currentState.getStateEvents(Z.RoomThirdPartyInvite);if(g!=null&&g.length){var y=g.map(S=>S.getContent().display_name);return this.roomNameGenerator({type:Pc.Generated,subtype:"Inviting",names:y,count:y.length+1})}}var v=l;v.length||(v=this.currentState.getMembers().filter(S=>S.userId!==e&&S.membership!==Be.Invite&&S.membership!==Be.Join).map(S=>S.name));var w;return v.length&&(w=this.roomNameGenerator({type:Pc.Generated,names:v,count:v.length+1})),this.roomNameGenerator({type:Pc.EmptyRoom,oldName:w})}applyNewVisibilityEvent(e){var n=e.asVisibilityChange();if(n){var r=e.getSender();if(r){var i=Dh.name&&this.currentState.maySendStateEvent(Dh.name,r)||Dh.altName&&this.currentState.maySendStateEvent(Dh.altName,r);if(i){var s=this.visibilityEvents.get(n.eventId);if(s){for(var o=s.length-1,a=Math.max(0,s.length-A0e);o>=a;--o){var c=s[o];if(c.getTs()<e.getTs())break}o===-1?s.unshift(e):s.splice(o+1,0,e)}else this.visibilityEvents.set(n.eventId,[e]);var l=this.findEventById(n.eventId);l&&l.applyVisibilityEvent(n)}}}}redactVisibilityChangeEvent(e){if(!e.isVisibilityEvent)throw new Error("expected a visibility change event");var n=e.getRelation(),r=n?.event_id,i=this.visibilityEvents.get(r);if(i){var s=i.findIndex(l=>l.getId()===e.getId());if(s!==-1&&(i.splice(s,1),s===i.length)){var o=this.findEventById(r);if(!o)return;if(s===0)this.visibilityEvents.delete(r),o.applyVisibilityEvent();else{var a=i[i.length-1],c=a.asVisibilityChange();if(!c)throw new Error("at this stage, visibility changes should be well-formed");o.applyVisibilityEvent(c)}}}}applyPendingVisibilityEvents(e){var n=this.visibilityEvents.get(e.getId());if(!(!n||n.length==0)){var r=n[n.length-1],i=r.asVisibilityChange();i&&(i.visible,!(r.getTs()<e.getTs())&&e.applyVisibilityEvent(i))}}getOldestThreadedReceiptTs(){return this.oldestThreadedReceiptTs}hasUserReadEvent(e,n){return this.roomReceipts.hasUserReadEvent(e,n)}getLastUnthreadedReceiptFor(e){return this.unthreadedReceipts.get(e)}fixupNotifications(e){super.fixupNotifications(e);var n=this.getThreads().filter(i=>this.getThreadUnreadNotificationCount(i.id,Jt.Total)>0);for(var r of n)r.fixupNotifications(e)}compareEventOrdering(e,n){return d0e(this,e,n)}hasEncryptionStateEvent(){var e;return!!(!((e=this.getLiveTimeline().getState(Me.FORWARDS))===null||e===void 0)&&e.getStateEvents(Z.RoomEncryption,""))}};var P0e={[rt.ENCRYPTING]:[rt.SENDING,rt.NOT_SENT,rt.CANCELLED],[rt.SENDING]:[rt.ENCRYPTING,rt.QUEUED,rt.NOT_SENT,rt.SENT],[rt.QUEUED]:[rt.SENDING,rt.NOT_SENT,rt.CANCELLED],[rt.SENT]:[],[rt.NOT_SENT]:[rt.SENDING,rt.QUEUED,rt.CANCELLED],[rt.CANCELLED]:[]},Pc=function(t){return t[t.EmptyRoom=0]="EmptyRoom",t[t.Generated=1]="Generated",t[t.Actual=2]="Actual",t}({});function S$(t,e){var n=e-1;if(t.length){if(t.length===1&&n<=1)return t[0];if(t.length===2&&n<=2)return"".concat(t[0]," and ").concat(t[1]);var r=n>1;return r?"".concat(t[0]," and ").concat(n," others"):"".concat(t[0]," and 1 other")}else return"Empty room"}var Zr=function(t){return t[t.Stable=0]="Stable",t[t.Unstable=1]="Unstable",t[t.Unsupported=2]="Unsupported",t}({}),ti=function(t){return t.Thread="Thread",t.ThreadUnreadNotifications="ThreadUnreadNotifications",t.LoginTokenRequest="LoginTokenRequest",t.RelationBasedRedactions="RelationBasedRedactions",t.AccountDataDeletion="AccountDataDeletion",t.RelationsRecursion="RelationsRecursion",t.IntentionalMentions="IntentionalMentions",t}({}),L0e={[ti.Thread]:{unstablePrefixes:["org.matrix.msc3440"],matrixVersion:"v1.3"},[ti.ThreadUnreadNotifications]:{unstablePrefixes:["org.matrix.msc3771","org.matrix.msc3773"],matrixVersion:"v1.4"},[ti.LoginTokenRequest]:{unstablePrefixes:["org.matrix.msc3882"]},[ti.RelationBasedRedactions]:{unstablePrefixes:["org.matrix.msc3912"]},[ti.AccountDataDeletion]:{unstablePrefixes:["org.matrix.msc3391"]},[ti.RelationsRecursion]:{unstablePrefixes:["org.matrix.msc3981"],matrixVersion:"v1.10"},[ti.IntentionalMentions]:{unstablePrefixes:["org.matrix.msc3952_intentional_mentions"],matrixVersion:"v1.7"}};function O0e(t){return iA.apply(this,arguments)}function iA(){return iA=B(function*(t){var e=new Map;for(var[n,r]of Object.entries(L0e)){var i,s,o,a,c=(i=(s=t.versions)===null||s===void 0?void 0:s.includes(r.matrixVersion||""))!==null&&i!==void 0?i:!1,l=(o=(a=r.unstablePrefixes)===null||a===void 0?void 0:a.every(d=>{var h;return((h=t.unstable_features)===null||h===void 0?void 0:h[d])===!0}))!==null&&o!==void 0?o:!1;c?e.set(n,Zr.Stable):l?e.set(n,Zr.Unstable):e.set(n,Zr.Unsupported)}return e}),iA.apply(this,arguments)}function E$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function uC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?E$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var w$=80*1e3,M0e=3,Gt=function(t){return t.Error="ERROR",t.Prepared="PREPARED",t.Stopped="STOPPED",t.Syncing="SYNCING",t.Catchup="CATCHUP",t.Reconnecting="RECONNECTING",t}({}),D0e=["org.matrix.msc2716v3"];function C$(t,e){return"FILTER_SYNC_".concat(t)+(e?"_"+e:"")}var DJ=function(t){return t.Offline="offline",t.Online="online",t.Unavailable="unavailable",t}({});function NJ(t){return uC({initialSyncLimit:8,resolveInvitesToProfiles:!1,pollTimeout:30*1e3,pendingEventOrdering:sv.Chronological,threadSupport:!1},t)}function UJ(t){return uC({canResetEntireTimeline:e=>!1},t)}class Vd{constructor(e,n,r){var i=this;this.client=e,L(this,"opts",void 0),L(this,"syncOpts",void 0),L(this,"_peekRoom",null),L(this,"currentSyncRequest",void 0),L(this,"abortController",void 0),L(this,"syncState",null),L(this,"syncStateData",void 0),L(this,"catchingUp",!1),L(this,"running",!1),L(this,"keepAliveTimer",void 0),L(this,"connectionReturnedResolvers",void 0),L(this,"notifEvents",[]),L(this,"failedSyncCount",0),L(this,"storeIsInvalid",!1),L(this,"presence",void 0),L(this,"getPushRules",B(function*(){try{i.syncOpts.logger.debug("Getting push rules...");var s=yield i.client.getPushRules();i.syncOpts.logger.debug("Got push rules"),i.client.pushRules=s}catch(o){return i.syncOpts.logger.error("Getting push rules failed",o),i.shouldAbortSync(o)?void 0:(i.syncOpts.logger.debug("Waiting for saved sync before retrying push rules..."),yield i.recoverFromSyncStartupError(i.savedSyncPromise,o),i.getPushRules())}})),L(this,"buildDefaultFilter",()=>{var s=new Us(this.client.credentials.userId);return this.client.canSupport.get(ti.ThreadUnreadNotifications)!==Zr.Unsupported&&s.setUnreadThreadNotifications(!0),s}),L(this,"prepareLazyLoadingForSync",B(function*(){i.syncOpts.logger.debug("Prepare lazy loading for sync..."),i.client.isGuest()&&(i.opts.lazyLoadMembers=!1),i.opts.lazyLoadMembers&&(i.syncOpts.logger.debug("Enabling lazy load on sync filter..."),i.opts.filter||(i.opts.filter=i.buildDefaultFilter()),i.opts.filter.setLazyLoadMembers(!0))})),L(this,"storeClientOptions",B(function*(){try{i.syncOpts.logger.debug("Storing client options..."),yield i.client.storeClientOptions(),i.syncOpts.logger.debug("Stored client options")}catch(s){throw i.syncOpts.logger.error("Storing client options failed",s),s}})),L(this,"getFilter",B(function*(){i.syncOpts.logger.debug("Getting filter...");var s;i.opts.filter?s=i.opts.filter:s=i.buildDefaultFilter();var o;try{o=yield i.client.getOrCreateFilter(C$(i.client.credentials.userId),s)}catch(a){return i.syncOpts.logger.error("Getting filter failed",a),i.shouldAbortSync(a)?{}:(i.syncOpts.logger.debug("Waiting for saved sync before retrying filter..."),yield i.recoverFromSyncStartupError(i.savedSyncPromise,a),i.getFilter())}return{filter:s,filterId:o}})),L(this,"savedSyncPromise",void 0),L(this,"onOnline",()=>{this.syncOpts.logger.debug("Browser thinks we are back online"),this.startKeepAlives(0)}),this.opts=NJ(n),this.syncOpts=UJ(r),e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),[ke.Timeline,ke.TimelineReset])}createRoom(e){var n=jJ(this.client,e,this.opts);return n.on(pt.Marker,(r,i)=>{this.onMarkerStateEvent(n,r,i)}),n}onMarkerStateEvent(e,n){var{timelineWasEmpty:r}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(r){this.syncOpts.logger.debug("MarkerState: Ignoring markerEventId=".concat(n.getId()," in roomId=").concat(e.roomId," ")+"because the timeline was empty before the marker arrived which means there is nothing to refresh.");return}var i=D0e.includes(e.getVersion())||n.getSender()===e.getCreator();i?(this.syncOpts.logger.debug("MarkerState: Timeline needs to be refreshed because "+"a new markerEventId=".concat(n.getId()," was sent in roomId=").concat(e.roomId)),e.setTimelineNeedsRefresh(!0),e.emit(ke.HistoryImportedWithinTimeline,n,e)):this.syncOpts.logger.debug("MarkerState: Ignoring markerEventId=".concat(n.getId()," in roomId=").concat(e.roomId," because ")+"MSC2716 is not supported in the room version or for any room version, the marker wasn't sent by the room creator.")}syncLeftRooms(){var e=this;return B(function*(){var n,r=e.client,i=new Us(e.client.credentials.userId);i.setTimelineLimit(1),i.setIncludeLeaveRooms(!0);var s=e.opts.pollTimeout+w$,o=yield r.getOrCreateFilter(C$(r.credentials.userId,"LEFT_ROOMS"),i),a={timeout:0,filter:o,"org.matrix.msc4222.use_state_after":!0},c=yield r.http.authedRequest(de.Get,"/sync",a,void 0,{localTimeoutMs:s}),l=[];(n=c.rooms)!==null&&n!==void 0&&n.leave&&(l=e.mapSyncResponseToRoomArray(c.rooms.leave));var d=yield Promise.all(l.map(function(){var h=B(function*(m){var g=m.room;if(m.isBrandNewRoom){m.timeline=m.timeline||{prev_batch:null,events:[]},g.getLiveTimeline().setPaginationToken(m.timeline.prev_batch,Me.BACKWARDS);var{timelineEvents:y}=yield e.mapAndInjectRoomEvents(m);return g.recalculate(),r.store.storeRoom(g),r.emit(Le.Room,g),e.processEventsForNotifs(g,y),g}});return function(m){return h.apply(this,arguments)}}()));return d.filter(Boolean)})()}peek(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:20;if(((n=this._peekRoom)===null||n===void 0?void 0:n.roomId)===e)return Promise.resolve(this._peekRoom);var i=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,r).then(s=>{var o;if(((o=this._peekRoom)===null||o===void 0?void 0:o.roomId)!==e)throw new Error("Peeking aborted");s.messages=s.messages||{chunk:[]},s.messages.chunk=s.messages.chunk||[],s.state=s.state||[];var a=d_(s.state).map(i.getEventMapper()),c=s.state.map(i.getEventMapper()),l=s.messages.chunk.map(i.getEventMapper());return Array.isArray(s.presence)&&s.presence.map(i.getEventMapper()).forEach(function(d){var h=i.store.getUser(d.getContent().user_id);h?h.setPresenceEvent(d):(h=yu.createUser(d.getContent().user_id,i),h.setPresenceEvent(d),i.store.storeUser(h)),i.emit(Le.Event,d)}),s.messages.start&&(this._peekRoom.oldState.paginationToken=s.messages.start),this._peekRoom.oldState.setStateEvents(a),this._peekRoom.currentState.setStateEvents(c),this.resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(l.reverse(),!0,!0,this._peekRoom.getLiveTimeline(),s.messages.start),i.store.storeRoom(this._peekRoom),i.emit(Le.Room,this._peekRoom),this.peekPoll(this._peekRoom),this._peekRoom})}stopPeeking(){this._peekRoom=null}peekPoll(e,n){var r,i=this;if(this._peekRoom!==e){this.syncOpts.logger.debug("Stopped peeking in room %s",e.roomId);return}this.client.http.authedRequest(de.Get,"/events",{room_id:e.roomId,timeout:String(30*1e3),from:n},void 0,{localTimeoutMs:50*1e3,abortSignal:(r=this.abortController)===null||r===void 0?void 0:r.signal}).then(function(){var s=B(function*(o){if(i._peekRoom!==e){i.syncOpts.logger.debug("Stopped peeking in room %s",e.roomId);return}o.chunk.filter(function(c){return c.type==="m.presence"}).map(i.client.getEventMapper()).forEach(c=>{var l=i.client.store.getUser(c.getContent().user_id);l?l.setPresenceEvent(c):(l=yu.createUser(c.getContent().user_id,i.client),l.setPresenceEvent(c),i.client.store.storeUser(l)),i.client.emit(Le.Event,c)});var a=o.chunk.filter(function(c){return c.room_id===e.roomId&&c.event_id}).map(i.client.getEventMapper());yield e.addLiveEvents(a,{addToState:!0}),i.peekPoll(e,o.end)});return function(o){return s.apply(this,arguments)}}(),s=>{this.syncOpts.logger.error("[%s] Peek poll failed: %s",e.roomId,s),setTimeout(()=>{this.peekPoll(e,n)},30*1e3)})}getSyncState(){return this.syncState}getSyncStateData(){var e;return(e=this.syncStateData)!==null&&e!==void 0?e:null}recoverFromSyncStartupError(e,n){var r=this;return B(function*(){yield e;var i=r.startKeepAlives();r.updateSyncState(Gt.Error,{error:n}),yield i})()}shouldAbortSync(e){return e.errcode==="M_UNKNOWN_TOKEN"?(this.syncOpts.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(Gt.Error,{error:e}),!0):!1}sync(){var e=this;return B(function*(){var n,r;if(e.running=!0,e.abortController=new AbortController,(n=globalThis.window)===null||n===void 0||(r=n.addEventListener)===null||r===void 0||r.call(n,"online",e.onOnline,!1),e.client.isGuest())return e.doSync({});e.syncOpts.logger.debug("Getting saved sync token...");var i=e.client.store.getSavedSyncToken().then(d=>(e.syncOpts.logger.debug("Got saved sync token"),d));e.savedSyncPromise=e.client.store.getSavedSync().then(d=>{if(e.syncOpts.logger.debug("Got reply from saved sync, exists? ".concat(!!d)),d)return e.syncFromCache(d)}).catch(d=>{e.syncOpts.logger.error("Getting saved sync failed",d)}),yield e.getPushRules(),yield e.prepareLazyLoadingForSync(),yield e.storeClientOptions();var{filterId:s,filter:o}=yield e.getFilter();if(o){if(e.client.resetNotifTimelineSet(),!e.currentSyncRequest){var a=s,c=yield i;if(c)e.syncOpts.logger.debug("Sending first sync request...");else{e.syncOpts.logger.debug("Sending initial sync request...");var l=e.buildDefaultFilter();l.setDefinition(o.getDefinition()),l.setTimelineLimit(e.opts.initialSyncLimit),a=JSON.stringify(l.getDefinition())}e.currentSyncRequest=e.doSyncRequest({filter:a},c)}return e.syncOpts.logger.debug("Waiting for saved sync before starting sync processing..."),yield e.savedSyncPromise,e.doSync({filter:s})}})()}stop(){var e,n,r;this.syncOpts.logger.debug("SyncApi.stop"),(e=globalThis.window)===null||e===void 0||(n=e.removeEventListener)===null||n===void 0||n.call(e,"online",this.onOnline,!1),this.running=!1,(r=this.abortController)===null||r===void 0||r.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=void 0)}retryImmediately(){return this.connectionReturnedResolvers?(this.startKeepAlives(0),!0):!1}syncFromCache(e){var n=this;return B(function*(){n.syncOpts.logger.debug("sync(): not doing HTTP hit, instead returning stored /sync data");var r=e.nextBatch;n.client.store.setSyncToken(r);var i={nextSyncToken:r,catchingUp:!1,fromCache:!0},s={next_batch:r,rooms:e.roomsData,account_data:{events:e.accountData}};try{yield n.processSyncResponse(i,s)}catch(o){n.syncOpts.logger.error("Error processing cached sync",o)}n.storeIsInvalid||n.updateSyncState(Gt.Prepared,i)})()}doSync(e){var n=this;return B(function*(){for(;n.running;){var r=n.client.store.getSyncToken(),i=void 0;try{n.currentSyncRequest||(n.currentSyncRequest=n.doSyncRequest(e,r)),i=yield n.currentSyncRequest}catch(a){var s=yield n.onSyncError(a);if(s)return;continue}finally{n.currentSyncRequest=void 0}n.client.store.setSyncToken(i.next_batch),n.failedSyncCount=0;var o={oldSyncToken:r??void 0,nextSyncToken:i.next_batch,catchingUp:n.catchingUp};try{yield n.processSyncResponse(o,i)}catch(a){n.syncOpts.logger.error("Caught /sync error",a),n.client.emit(Le.SyncUnexpectedError,a)}yield n.client.store.setSyncData(i),o.catchingUp=n.catchingUp,e.hasSyncedBefore||(n.updateSyncState(Gt.Prepared,o),e.hasSyncedBefore=!0),n.syncOpts.cryptoCallbacks&&(yield n.syncOpts.cryptoCallbacks.onSyncCompleted(o)),n.updateSyncState(Gt.Syncing,o),n.client.store.wantsSave()&&(yield n.client.store.save())}n.running||(n.syncOpts.logger.debug("Sync no longer running: exiting."),n.connectionReturnedResolvers&&(n.connectionReturnedResolvers.reject(),n.connectionReturnedResolvers=void 0),n.updateSyncState(Gt.Stopped))})()}doSyncRequest(e,n){var r,i=this.getSyncParams(e,n);return this.client.http.authedRequest(de.Get,"/sync",i,void 0,{localTimeoutMs:i.timeout+w$,abortSignal:(r=this.abortController)===null||r===void 0?void 0:r.signal})}getSyncParams(e,n){var r=this.opts.pollTimeout;(this.getSyncState()!==Gt.Syncing||this.catchingUp)&&(this.catchingUp=!0,r=0);var i=e.filter;this.client.isGuest()&&!i&&(i=this.getGuestFilter());var s={filter:i,timeout:r,"org.matrix.msc4222.use_state_after":!0};return this.opts.disablePresence?s.set_presence=DJ.Offline:this.presence!==void 0&&(s.set_presence=this.presence),n?s.since=n:s._cacheBuster=Date.now(),[Gt.Reconnecting,Gt.Error].includes(this.getSyncState())&&(s.timeout=0),s}setPresence(e){this.presence=e}onSyncError(e){var n=this;return B(function*(){if(!n.running)return n.syncOpts.logger.debug("Sync no longer running: exiting"),n.connectionReturnedResolvers&&(n.connectionReturnedResolvers.reject(),n.connectionReturnedResolvers=void 0),n.updateSyncState(Gt.Stopped),!0;if(n.syncOpts.logger.error("/sync error %s",e),n.shouldAbortSync(e))return!0;n.failedSyncCount++,n.syncOpts.logger.debug("Number of consecutive failed sync requests:",n.failedSyncCount),n.syncOpts.logger.debug("Starting keep-alive");var r=n.startKeepAlives();n.currentSyncRequest=void 0,n.updateSyncState(n.failedSyncCount>=M0e?Gt.Error:Gt.Reconnecting,{error:e});var i=yield r;return i&&n.getSyncState()===Gt.Error&&n.updateSyncState(Gt.Catchup,{catchingUp:!0}),!1})()}processSyncResponse(e,n){var r=this;return B(function*(){var i,s,o,a,c=r.client;if(Array.isArray((i=n.presence)===null||i===void 0?void 0:i.events)&&n.presence.events.filter(Ka).map(c.getEventMapper()).forEach(function(S){var R=c.store.getUser(S.getSender());R?R.setPresenceEvent(S):(R=yu.createUser(S.getSender(),c),R.setPresenceEvent(S),c.store.storeUser(R)),c.emit(Le.Event,S)}),Array.isArray((s=n.account_data)===null||s===void 0?void 0:s.events)){var l=n.account_data.events.filter(Ka).map(c.getEventMapper()),d=l.reduce((S,R)=>(S[R.getType()]=c.store.getAccountData(R.getType()),S),{});c.store.storeAccountDataEvents(l),l.forEach(function(S){if(S.getType()===Z.PushRules){var R=S.getContent();c.setPushRules(R)}var x=d[S.getType()];return c.emit(Le.AccountData,S,x),S})}if(n.to_device&&Array.isArray(n.to_device.events)&&n.to_device.events.length>0){var h=n.to_device.events.filter(Ka),m;r.syncOpts.cryptoCallbacks?m=yield r.syncOpts.cryptoCallbacks.preprocessToDeviceMessages(h):m=h.map(S=>({message:S,encryptionInfo:null})),FJ(m,c)}else r.catchingUp=!1;var g=[],y=[],v=[],w=[];n.rooms&&(n.rooms.invite&&(g=r.mapSyncResponseToRoomArray(n.rooms.invite)),n.rooms.join&&(y=r.mapSyncResponseToRoomArray(n.rooms.join)),n.rooms.leave&&(v=r.mapSyncResponseToRoomArray(n.rooms.leave)),n.rooms.knock&&(w=r.mapSyncResponseToRoomArray(n.rooms.knock))),r.notifEvents=[],yield og(g,function(){var S=B(function*(R){var x=R.room,T=r.mapSyncEventsFormat(R.invite_state,x);yield r.injectRoomEvents(x,T,void 0),R.isBrandNewRoom?(x.recalculate(),c.store.storeRoom(x),c.emit(Le.Room,x)):x.recalculate(),T.forEach(function(I){c.emit(Le.Event,I)})});return function(R){return S.apply(this,arguments)}}()),yield og(y,function(){var S=B(function*(R){var x,T=R.room,I=r.mapSyncEventsFormat(R.state,T),k=r.mapSyncEventsFormat(R["org.matrix.msc4222.state_after"],T),A=r.mapSyncEventsFormat(R.timeline,T,!1),O=r.mapSyncEventsFormat(R.ephemeral),D=r.mapSyncEventsFormat(R.account_data),N=R["org.matrix.msc4222.state_after"]?k:I.concat(A),U=r.isRoomEncrypted(T,N);if(R.unread_notifications){if(!U||R.unread_notifications.notification_count===0){var $;T.setUnreadNotificationCount(Jt.Total,($=R.unread_notifications.notification_count)!==null&&$!==void 0?$:0)}if(!U||T.getUnreadNotificationCount(Jt.Highlight)<=0){var K;T.setUnreadNotificationCount(Jt.Highlight,(K=R.unread_notifications.highlight_count)!==null&&K!==void 0?K:0)}}var Y=(x=R[ub.name])!==null&&x!==void 0?x:R[ub.altName];if(Y){T.resetThreadUnreadNotificationCountFromSync(Object.keys(Y));for(var[G,F]of Object.entries(Y)){if(!U||F.notification_count===0){var q;T.setThreadUnreadNotificationCount(G,Jt.Total,(q=F.notification_count)!==null&&q!==void 0?q:0)}var z=T.getThreadUnreadNotificationCount(G,Jt.Highlight)<=0;if(!U||U&&z){var W;T.setThreadUnreadNotificationCount(G,Jt.Highlight,(W=F.highlight_count)!==null&&W!==void 0?W:0)}}}else T.resetThreadUnreadNotificationCountFromSync();if(R.timeline=R.timeline||{},R.isBrandNewRoom)R.timeline.prev_batch!==null&&T.getLiveTimeline().setPaginationToken(R.timeline.prev_batch,Me.BACKWARDS);else if(R.timeline.limited){for(var V=!0,X=A.length-1;X>=0;X--){var ne=A[X].getId();if(T.getTimelineForEvent(ne)){r.syncOpts.logger.debug("Already have event ".concat(ne," in limited sync - not resetting")),V=!1,A.splice(0,X);break}}if(V){var fe;T.resetLiveTimeline(R.timeline.prev_batch,r.syncOpts.canResetEntireTimeline(T.roomId)?null:(fe=e.oldSyncToken)!==null&&fe!==void 0?fe:null),c.resetNotifTimelineSet()}}if(r.syncOpts.cryptoCallbacks)for(var ye of N)ye.isState()&&ye.getType()===Z.RoomEncryption&&ye.getStateKey()===""&&(yield r.syncOpts.cryptoCallbacks.onCryptoEvent(T,ye));for(var Ae of A.filter(_e=>_e.isState()))yield r.client.decryptEventIfNeeded(Ae);try{"org.matrix.msc4222.state_after"in R?yield r.injectRoomEvents(T,void 0,k,A,e.fromCache):yield r.injectRoomEvents(T,I,void 0,A,e.fromCache)}catch(_e){r.syncOpts.logger.error("Failed to process events on room ".concat(T.roomId,":"),_e)}R.summary&&T.setSummary(R.summary),T.addEphemeralEvents(O),T.addAccountData(D),T.recalculate(),R.isBrandNewRoom&&(c.store.storeRoom(T),c.emit(Le.Room,T)),r.processEventsForNotifs(T,A);var be=_e=>c.emit(Le.Event,_e);I.forEach(be),A.forEach(be),O.forEach(be),D.forEach(be),T.decryptCriticalEvents()});return function(R){return S.apply(this,arguments)}}()),yield og(v,function(){var S=B(function*(R){var x=R.room,{timelineEvents:T,stateEvents:I,stateAfterEvents:k}=yield r.mapAndInjectRoomEvents(R),A=r.mapSyncEventsFormat(R.account_data);x.addAccountData(A),x.recalculate(),R.isBrandNewRoom&&(c.store.storeRoom(x),c.emit(Le.Room,x)),r.processEventsForNotifs(x,T),I?.forEach(function(O){c.emit(Le.Event,O)}),k?.forEach(function(O){c.emit(Le.Event,O)}),T.forEach(function(O){c.emit(Le.Event,O)}),A.forEach(function(O){c.emit(Le.Event,O)})});return function(R){return S.apply(this,arguments)}}()),yield og(w,function(){var S=B(function*(R){var x=R.room,T=r.mapSyncEventsFormat(R.knock_state,x);yield r.injectRoomEvents(x,T,void 0),R.isBrandNewRoom?(x.recalculate(),c.store.storeRoom(x),c.emit(Le.Room,x)):x.recalculate(),T.forEach(function(I){c.emit(Le.Event,I)})});return function(R){return S.apply(this,arguments)}}()),e.oldSyncToken&&r.notifEvents.length&&(r.notifEvents.sort(function(S,R){return S.getTs()-R.getTs()}),r.notifEvents.forEach(function(S){var R;(R=c.getNotifTimelineSet())===null||R===void 0||R.addLiveEvent(S,{addToState:!0})})),n.device_lists&&r.syncOpts.cryptoCallbacks&&(yield r.syncOpts.cryptoCallbacks.processDeviceLists(n.device_lists)),yield(o=r.syncOpts.cryptoCallbacks)===null||o===void 0?void 0:o.processKeyCounts(n.device_one_time_keys_count,(a=n.device_unused_fallback_key_types)!==null&&a!==void 0?a:n["org.matrix.msc2732.device_unused_fallback_key_types"])})()}startKeepAlives(e){return e===void 0&&(e=2e3+Math.floor(Math.random()*5e3)),this.keepAliveTimer!==null&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedResolvers||(this.connectionReturnedResolvers=Promise.withResolvers()),this.connectionReturnedResolvers.promise}pokeKeepAlive(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.running){clearTimeout(this.keepAliveTimer),this.connectionReturnedResolvers&&(this.connectionReturnedResolvers.reject("SyncApi.stop() was called"),this.connectionReturnedResolvers=void 0);return}var r=()=>{clearTimeout(this.keepAliveTimer),this.connectionReturnedResolvers&&(this.connectionReturnedResolvers.resolve(n),this.connectionReturnedResolvers=void 0)};this.client.http.request(de.Get,"/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15*1e3,abortSignal:(e=this.abortController)===null||e===void 0?void 0:e.signal}).then(()=>{r()},i=>{i.httpStatus==400||i.httpStatus==404?this.keepAliveTimer=setTimeout(r,2e3):(n=!0,this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this,n),5e3+Math.floor(Math.random()*5e3)),this.updateSyncState(Gt.Error,{error:i}))})}mapSyncResponseToRoomArray(e){var n=this.client;return Object.keys(e).filter(r=>!Ey(r)).map(r=>{var i=n.store.getRoom(r),s=!1;return i||(i=this.createRoom(r),s=!0),uC(uC({},e[r]),{},{room:i,isBrandNewRoom:s})})}mapSyncEventsFormat(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!Array.isArray(e.events))return[];var i=this.client.getEventMapper({decrypt:r});return e.events.filter(Ka).map(function(s){return n&&(s.room_id=n.roomId),i(s)})}resolveInvites(e){if(!(!e||!this.opts.resolveInvitesToProfiles)){var n=this.client;e.getMembersWithMembership(Be.Invite).forEach(function(r){if(!r.requestedProfileInfo){r.requestedProfileInfo=!0;var i=n.getUser(r.userId),s;i?s=Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):s=n.getProfileInfo(r.userId),s.then(function(o){var a=r.events.member;a?.getContent().membership===Be.Invite&&(a.getContent().avatar_url=o.avatar_url,a.getContent().displayname=o.displayname,r.setMembershipEvent(a,e.currentState))},function(o){})}})}}findEncryptionEvent(e){return e?.find(n=>n.getType()===Z.RoomEncryption&&n.getStateKey()==="")}isRoomEncrypted(e,n){return e.hasEncryptionStateEvent()||!!this.findEncryptionEvent(n)}mapAndInjectRoomEvents(e){var n=this;return B(function*(){var r=n.mapSyncEventsFormat(e.state,e.room),i=n.mapSyncEventsFormat(e["org.matrix.msc4222.state_after"],e.room),s=n.mapSyncEventsFormat(e.timeline,e.room);return"org.matrix.msc4222.state_after"in e?yield n.injectRoomEvents(e.room,void 0,i,s):yield n.injectRoomEvents(e.room,r,void 0,s),{timelineEvents:s,stateEvents:r,stateAfterEvents:i}})()}injectRoomEvents(e,n,r,i){var s=arguments,o=this;return B(function*(){var a=s.length>4&&s[4]!==void 0?s[4]:!1,c=r??n,l=e.getLiveTimeline(),d=l.getEvents().length==0;if(d){for(var h of c)o.client.getPushActionsForEvent(h);l.initialiseState(c,{timelineWasEmpty:d})}o.resolveInvites(e),e.recalculate(),d||(e.oldState.setStateEvents(c),e.currentState.setStateEvents(c)),yield e.addLiveEvents(i||[],{fromCache:a,timelineWasEmpty:d,addToState:r===void 0}),o.client.processBeaconEvents(e,i)})()}processEventsForNotifs(e,n){if(this.client.getNotifTimelineSet())for(var r of n){var i,s=this.client.getPushActionsForEvent(r);s!=null&&s.notify&&(i=s.tweaks)!==null&&i!==void 0&&i.highlight&&this.notifEvents.push(r)}}getGuestFilter(){return"{}"}updateSyncState(e,n){var r=this.syncState;this.syncState=e,this.syncStateData=n,this.client.emit(Le.Sync,this.syncState,r,n)}}function jJ(t,e,n){var{timelineSupport:r}=t,i=new Q3(e,t,t.getUserId(),{lazyLoadMembers:n.lazyLoadMembers,pendingEventOrdering:n.pendingEventOrdering,timelineSupport:r});return t.reEmitter.reEmit(i,[ke.Name,ke.Redaction,ke.RedactionCancelled,ke.Receipt,ke.Tags,ke.LocalEchoUpdated,ke.AccountData,ke.MyMembership,ke.Timeline,ke.TimelineReset,pt.Events,pt.Members,pt.NewMember,pt.Update,qn.New,qn.Update,qn.Destroy,qn.LivenessChange]),i.on(pt.NewMember,(s,o,a)=>{var c;a.user=(c=t.getUser(a.userId))!==null&&c!==void 0?c:void 0,t.reEmitter.reEmit(a,[Vs.Name,Vs.Typing,Vs.PowerLevel,Vs.Membership])}),i}function FJ(t,e){var n=[];t.map(r=>{if(r.message.type==="m.key.verification.cancel"){var i=r.message.content.transaction_id;i&&n.push(i)}return r}).forEach(function(r){{var i=r.message,s=i.content,o=new $i(Object.assign({},i));if(i.type==="m.key.verification.start"||i.type==="m.key.verification.request"){var a=s.transaction_id;n.includes(a)&&o.flagCancelled()}r.encryptionInfo&&o.makeEncrypted(Z.RoomMessageEncrypted,{ciphertext:""},r.encryptionInfo.senderCurve25519KeyBase64,""),e.emit(Le.ToDeviceEvent,o)}e.emit(Le.ReceivedToDeviceMessage,r)})}class N0e{constructor(){L(this,"accountData",new Map),L(this,"fromToken",null)}isNewlyCreated(){return Promise.resolve(!0)}getSyncToken(){return this.fromToken}setSyncToken(e){this.fromToken=e}storeRoom(e){}getRoom(e){return null}getRooms(){return[]}removeRoom(e){}getRoomSummaries(){return[]}storeUser(e){}getUser(e){return null}getUsers(){return[]}scrollback(e,n){return[]}setUserCreator(e){}storeEvents(e,n,r,i){}storeFilter(e){}getFilter(e,n){return null}getFilterIdByName(e){return null}setFilterIdByName(e,n){}storeAccountDataEvents(e){}getAccountData(e){}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return Promise.resolve()}getOutOfBandMembers(){return Promise.resolve(null)}setOutOfBandMembers(e,n){return Promise.resolve()}clearOutOfBandMembers(){return Promise.resolve()}getClientOptions(){return Promise.resolve(void 0)}storeClientOptions(e){return Promise.resolve()}getPendingEvents(e){return B(function*(){return[]})()}setPendingEvents(e,n){return Promise.resolve()}saveToDeviceBatches(e){return B(function*(){return Promise.resolve()})()}getOldestToDeviceBatch(){return Promise.resolve(null)}removeToDeviceBatch(e){return B(function*(){return Promise.resolve()})()}destroy(){return B(function*(){})()}}const Di=[];for(let t=0;t<256;++t)Di.push((t+256).toString(16).slice(1));function U0e(t,e=0){return(Di[t[e+0]]+Di[t[e+1]]+Di[t[e+2]]+Di[t[e+3]]+"-"+Di[t[e+4]]+Di[t[e+5]]+"-"+Di[t[e+6]]+Di[t[e+7]]+"-"+Di[t[e+8]]+Di[t[e+9]]+"-"+Di[t[e+10]]+Di[t[e+11]]+Di[t[e+12]]+Di[t[e+13]]+Di[t[e+14]]+Di[t[e+15]]).toLowerCase()}let Ik;const j0e=new Uint8Array(16);function F0e(){if(!Ik){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ik=crypto.getRandomValues.bind(crypto)}return Ik(j0e)}const $0e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),T$={randomUUID:$0e};function B0e(t,e,n){t=t||{};const r=t.random??t.rng?.()??F0e();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,U0e(r)}function H0e(t,e,n){return T$.randomUUID&&!t?T$.randomUUID():B0e(t)}var Na={},kk={},xk={exports:{}},R$;function zO(){if(R$)return xk.exports;R$=1;var t=xk.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),xk.exports}var I$;function V0e(){return I$||(I$=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,d){if(d&&!l)c[d]=e(a[1]);else for(var h=0;h<l.length;h+=1)a[h+1]!=null&&(c[l[h]]=e(a[h+1]))},r=function(a,c,l){var d=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:d&&!c[a.name]&&(c[a.name]={});var h=a.push?{}:d?c[a.name]:c;n(l.match(a.reg),h,a.names,a.name),a.push&&c[a.push].push(h)},i=zO(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],d=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(h){var m=h[0],g=h.slice(2);m==="m"&&(l.push({rtp:[],fmtp:[]}),d=l[l.length-1]);for(var y=0;y<(i[m]||[]).length;y+=1){var v=i[m][y];if(v.reg.test(g))return r(v,d,g)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),d=0;d<l.length;d+=3)c.push({component:l[d],ip:l[d+1],port:l[d+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var d,h=!1;return l[0]!=="~"?d=e(l):(d=e(l.substring(1,l.length)),h=!0),{scid:d,paused:h}})})}}(kk)),kk}var Ak,k$;function q0e(){if(k$)return Ak;k$=1;var t=zO(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(d){if(a>=l)return d;var h=c[a];switch(a+=1,d){case"%%":return"%";case"%s":return String(h);case"%d":return Number(h);case"%v":return""}})},r=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,d=[o+"="+l];if(a.names)for(var h=0;h<a.names.length;h+=1){var m=a.names[h];a.name?d.push(c[a.name][m]):d.push(c[a.names[h]])}else d.push(c[a.name]);return n.apply(null,d)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return Ak=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(h){h.payloads==null&&(h.payloads="")});var c=a.outerOrder||i,l=a.innerOrder||s,d=[];return c.forEach(function(h){t[h].forEach(function(m){m.name in o&&o[m.name]!=null?d.push(r(h,m,o)):m.push in o&&o[m.push]!=null&&o[m.push].forEach(function(g){d.push(r(h,m,g))})})}),o.media.forEach(function(h){d.push(r("m",t.m[0],h)),l.forEach(function(m){t[m].forEach(function(g){g.name in h&&h[g.name]!=null?d.push(r(m,g,h)):g.push in h&&h[g.push]!=null&&h[g.push].forEach(function(y){d.push(r(m,g,y))})})})}),d.join(`\r
`)+`\r
`},Ak}var x$;function G0e(){if(x$)return Na;x$=1;var t=V0e(),e=q0e(),n=zO();return Na.grammar=n,Na.write=e,Na.parse=t.parse,Na.parseParams=t.parseParams,Na.parseFmtpConfig=t.parseFmtpConfig,Na.parsePayloads=t.parsePayloads,Na.parseRemoteCandidates=t.parseRemoteCandidates,Na.parseImageAttributes=t.parseImageAttributes,Na.parseSimulcastStreamList=t.parseSimulcastStreamList,Na}var sA=G0e();function WO(t,e){if(typeof t.toBase64=="function")return t.toBase64(e);var n=btoa(t.reduce((r,i)=>r+String.fromCharCode(i),""));return e.omitPadding&&(n=n.replace(/={1,2}$/,"")),e.alphabet==="base64url"&&(n=n.replace(/\+/g,"-").replace(/\//g,"_")),n}function Cy(t){return WO(t,{alphabet:"base64",omitPadding:!1})}function $J(t){return WO(t,{alphabet:"base64",omitPadding:!0})}function Z3(t){return WO(t,{alphabet:"base64url",omitPadding:!0})}function K0e(t,e){return typeof Uint8Array.fromBase64=="function"?Uint8Array.fromBase64(t,e):Uint8Array.from(atob(t),n=>n.charCodeAt(0))}function Bh(t){return K0e(t.replace(/-/g,"+").replace(/_/g,"/"),{alphabet:"base64",lastChunkHandling:"loose"})}var z0e="abcdefghijklmnopqrstuvwxyz",W0e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Y0e="0123456789";function BJ(t){var e=new Uint8Array(t);return globalThis.crypto.getRandomValues(e),Z3(e)}function To(t){return X0e(t,W0e+z0e+Y0e)}function X0e(t,e){if(e.length<2||e.length>256)throw new Error("Character set must be between 2 and 256 characters long");if(t<1||t>32768)throw new Error("Requested random string length must be between 1 and 32768");for(var n=256-256%e.length,r=new Uint8Array(Math.floor(t*1.3)),i=r.length,s=[];s.length<t;){i===r.length&&(globalThis.crypto.getRandomValues(r),i=0);var o=r[i++];o<n&&s.push(e[o%e.length])}return s.join("")}var _d="org.matrix.msc3077.sdp_stream_metadata",xn=function(t){return t.Usermedia="m.usermedia",t.Screenshare="m.screenshare",t}({}),Ty=null,oA=0,J0e=()=>(Ty===null&&(Ty=new AudioContext),oA++,Ty),Q0e=()=>{if(oA--,oA===0){var t;(t=Ty)===null||t===void 0||t.close(),Ty=null}},Z0e=200,aA=-60,e1e=8,Lc=function(t){return t.NewStream="new_stream",t.MuteStateChanged="mute_state_changed",t.LocalVolumeChanged="local_volume_changed",t.VolumeChanged="volume_changed",t.ConnectedChanged="connected_changed",t.Speaking="speaking",t.Disposed="disposed",t}({});class iu extends On{constructor(e){super(),L(this,"stream",void 0),L(this,"sdpMetadataStreamId",void 0),L(this,"userId",void 0),L(this,"deviceId",void 0),L(this,"purpose",void 0),L(this,"speakingVolumeSamples",void 0),L(this,"client",void 0),L(this,"call",void 0),L(this,"roomId",void 0),L(this,"audioMuted",void 0),L(this,"videoMuted",void 0),L(this,"localVolume",1),L(this,"measuringVolumeActivity",!1),L(this,"audioContext",void 0),L(this,"analyser",void 0),L(this,"frequencyBinCount",void 0),L(this,"speakingThreshold",aA),L(this,"speaking",!1),L(this,"volumeLooperTimeout",void 0),L(this,"_disposed",!1),L(this,"_connected",!1),L(this,"onAddTrack",()=>{this.emit(Lc.NewStream,this.stream)}),L(this,"onCallState",n=>{n===at.Connected?this.connected=!0:n===at.Connecting&&(this.connected=!1)}),L(this,"volumeLooper",()=>{if(this.analyser&&this.measuringVolumeActivity){this.analyser.getFloatFrequencyData(this.frequencyBinCount);var n=-1/0;for(var r of this.frequencyBinCount)r>n&&(n=r);this.speakingVolumeSamples.shift(),this.speakingVolumeSamples.push(n),this.emit(Lc.VolumeChanged,n);var i=!1;for(var s of this.speakingVolumeSamples)if(s>this.speakingThreshold){i=!0;break}this.speaking!==i&&(this.speaking=i,this.emit(Lc.Speaking,this.speaking)),this.volumeLooperTimeout=setTimeout(this.volumeLooper,Z0e)}}),this.client=e.client,this.call=e.call,this.roomId=e.roomId,this.userId=e.userId,this.deviceId=e.deviceId,this.purpose=e.purpose,this.audioMuted=e.audioMuted,this.videoMuted=e.videoMuted,this.speakingVolumeSamples=new Array(e1e).fill(-1/0),this.sdpMetadataStreamId=e.stream.id,this.updateStream(null,e.stream),this.stream=e.stream,this.hasAudioTrack&&this.initVolumeMeasuring(),e.call&&(e.call.addListener(gt.State,this.onCallState),this.onCallState(e.call.state))}get connected(){return this.isLocal()||this._connected}set connected(e){this._connected=e,this.emit(Lc.ConnectedChanged,this.connected)}get hasAudioTrack(){return this.stream.getAudioTracks().length>0}updateStream(e,n){if(n!==e){var r=this.measuringVolumeActivity;e&&(e.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),this.stream=n,n.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?(this.initVolumeMeasuring(),r&&this.measureVolumeActivity(!0)):this.measureVolumeActivity(!1),this.emit(Lc.NewStream,this.stream)}}initVolumeMeasuring(){if(this.hasAudioTrack){this.audioContext||(this.audioContext=J0e()),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1;var e=this.audioContext.createMediaStreamSource(this.stream);e.connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount)}}getMember(){var e,n=this.client.getRoom(this.roomId);return(e=n?.getMember(this.userId))!==null&&e!==void 0?e:null}isLocal(){return this.userId===this.client.getUserId()&&(this.deviceId===void 0||this.deviceId===this.client.getDeviceId())}isAudioMuted(){return this.stream.getAudioTracks().length===0||this.audioMuted}isVideoMuted(){return this.stream.getVideoTracks().length===0||this.videoMuted}isSpeaking(){return this.speaking}setNewStream(e){this.updateStream(this.stream,e)}setAudioVideoMuted(e,n){e!==null&&(this.audioMuted!==e&&this.speakingVolumeSamples.fill(-1/0),this.audioMuted=e),n!==null&&(this.videoMuted=n),this.emit(Lc.MuteStateChanged,this.audioMuted,this.videoMuted)}measureVolumeActivity(e){if(e){if(!this.analyser||!this.frequencyBinCount||!this.hasAudioTrack)return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.speakingVolumeSamples.fill(-1/0),this.emit(Lc.VolumeChanged,-1/0)}setSpeakingThreshold(e){this.speakingThreshold=e}clone(){var e=this.client.getMediaHandler(),n=this.stream.clone();return M.log("CallFeed clone() cloning stream (originalStreamId=".concat(this.stream.id,", newStreamId").concat(n.id,")")),this.purpose===xn.Usermedia?e.userMediaStreams.push(n):e.screensharingStreams.push(n),new iu({client:this.client,roomId:this.roomId,userId:this.userId,deviceId:this.deviceId,stream:n,purpose:this.purpose,audioMuted:this.audioMuted,videoMuted:this.videoMuted})}dispose(){var e,n;clearTimeout(this.volumeLooperTimeout),(e=this.stream)===null||e===void 0||e.removeEventListener("addtrack",this.onAddTrack),(n=this.call)===null||n===void 0||n.removeListener(gt.State,this.onCallState),this.audioContext&&(this.audioContext=void 0,this.analyser=void 0,Q0e()),this._disposed=!0,this.emit(Lc.Disposed)}get disposed(){return this._disposed}set disposed(e){this._disposed=e}getLocalVolume(){return this.localVolume}setLocalVolume(e){this.localVolume=e,this.emit(Lc.LocalVolumeChanged,e)}}var t1e=3e3,cA=function(t){return t.Incoming="Call.incoming",t}({});class n1e{constructor(e){L(this,"calls",void 0),L(this,"callEventBuffer",void 0),L(this,"nextSeqByCall",new Map),L(this,"toDeviceEventBuffers",new Map),L(this,"client",void 0),L(this,"candidateEventsByCall",void 0),L(this,"eventBufferPromiseChain",void 0),L(this,"onSync",()=>{var n=this.callEventBuffer;this.callEventBuffer=[],this.eventBufferPromiseChain?this.eventBufferPromiseChain=this.eventBufferPromiseChain.then(()=>this.evaluateEventBuffer(n)):this.eventBufferPromiseChain=this.evaluateEventBuffer(n)}),L(this,"onRoomTimeline",n=>{this.callEventBuffer.push(n)}),L(this,"onToDeviceEvent",n=>{var r=n.getContent();if(!r.call_id){this.callEventBuffer.push(n);return}if(this.nextSeqByCall.has(r.call_id)||this.nextSeqByCall.set(r.call_id,0),r.seq===void 0){this.callEventBuffer.push(n);return}var i=this.nextSeqByCall.get(r.call_id)||0;if(r.seq!==i){this.toDeviceEventBuffers.has(r.call_id)||this.toDeviceEventBuffers.set(r.call_id,[]);var s=this.toDeviceEventBuffers.get(r.call_id),o=s.findIndex(d=>d.getContent().seq>r.seq);o===-1?s.push(n):s.splice(o,0,n)}else{var a=r.call_id;this.callEventBuffer.push(n),this.nextSeqByCall.set(a,r.seq+1);for(var c=this.toDeviceEventBuffers.get(a),l=c&&c.shift();l&&l.getContent().seq===this.nextSeqByCall.get(a);)this.callEventBuffer.push(l),this.nextSeqByCall.set(a,l.getContent().seq+1),l=c.shift()}}),this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on(Le.Sync,this.onSync),this.client.on(ke.Timeline,this.onRoomTimeline),this.client.on(Le.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.removeListener(Le.Sync,this.onSync),this.client.removeListener(ke.Timeline,this.onRoomTimeline),this.client.removeListener(Le.ToDeviceEvent,this.onToDeviceEvent)}evaluateEventBuffer(e){var n=this;return B(function*(){yield Promise.all(e.map(d=>n.client.decryptEventIfNeeded(d)));var r=e.filter(d=>{var h=d.getType();return h.startsWith("m.call.")||h.startsWith("org.matrix.call.")}),i=new Set;for(var s of r){var o=s.getType();(o===Z.CallAnswer||o===Z.CallHangup)&&i.add(s.getContent().call_id)}for(var a of r){var c=a.getType(),l=a.getContent().call_id;if(!(c===Z.CallInvite&&i.has(l)))try{yield n.handleCallEvent(a)}catch(d){M.error("CallEventHandler evaluateEventBuffer() caught exception handling call event",d)}}})()}handleCallEvent(e){var n=this;return B(function*(){var r;n.client.emit(Le.ReceivedVoipEvent,e);var i=e.getContent(),s=e.getRoomId()||((r=n.client.groupCallEventHandler.getGroupCallById(i.conf_id))===null||r===void 0||(r=r.room)===null||r===void 0?void 0:r.roomId),o=i.conf_id,a=e.getType(),c=e.getSender(),l=i.call_id?n.calls.get(i.call_id):void 0,d,h;if(o){if(h=n.client.groupCallEventHandler.getGroupCallById(o),!h){M.warn("CallEventHandler handleCallEvent() could not find a group call - ignoring event (groupCallId=".concat(o,", type=").concat(a,")"));return}if(d=i.device_id,!d){M.warn("CallEventHandler handleCallEvent() could not find a device id - ignoring event (senderId=".concat(c,")")),h.emit(kn.Error,new qJ(c));return}if(i.dest_session_id!==n.client.getSessionId()){M.warn("CallEventHandler handleCallEvent() call event does not match current session id - ignoring");return}}var m=c===n.client.credentials.userId&&(d===void 0||d===n.client.getDeviceId());if(s){if(a===Z.CallInvite){var g,y,v;if(m||e.getLocalAge()>i.lifetime-t1e||l&&l.state===at.Ended||(l&&M.warn("CallEventHandler handleCallEvent() already has a call but got an invite - clobbering (callId=".concat(i.call_id,")")),i.invitee&&i.invitee!==n.client.getUserId()))return;var w=((g=n.client.getTurnServersExpiry())!==null&&g!==void 0?g:0)-Date.now();if(M.info("CallEventHandler handleCallEvent() current turn creds expire in "+w+" ms"),l=(y=fb(n.client,s,{forceTURN:n.client.forceTURN,opponentDeviceId:d,groupCallId:o,opponentSessionId:i.sender_session_id}))!==null&&y!==void 0?y:void 0,!l){M.log("CallEventHandler handleCallEvent() this client does not support WebRTC (callId=".concat(i.call_id,")"));return}l.callId=i.call_id;var S=(v=h)===null||v===void 0?void 0:v.getGroupCallStats();S&&l.initStats(S);try{yield l.initWithInvite(e)}catch(D){if(D instanceof Gl)if(D.code===Iy.UnknownDevice){var R;(R=h)===null||R===void 0||R.emit(kn.Error,D)}else M.error(D)}if(n.calls.set(l.callId,l),n.candidateEventsByCall.get(l.callId))for(var x of n.candidateEventsByCall.get(l.callId))l.onRemoteIceCandidatesReceived(x);var T;for(var I of n.calls.values()){var k,A=[at.WaitLocalMedia,at.CreateOffer,at.InviteSent].includes(I.state);if(l.roomId===I.roomId&&I.direction===xd.Outbound&&((k=l.getOpponentMember())===null||k===void 0?void 0:k.userId)===I.invitee&&A){T=I;break}}T?T.callId>l.callId?(M.log("CallEventHandler handleCallEvent() detected glare - answering incoming call and canceling outgoing call (incomingId=".concat(l.callId,", outgoingId=").concat(T.callId,")")),T.replacedBy(l)):(M.log("CallEventHandler handleCallEvent() detected glare - hanging up incoming call (incomingId=".concat(l.callId,", outgoingId=").concat(T.callId,")")),l.hangup(ft.Replaced,!0)):n.client.emit(cA.Incoming,l);return}else if(a===Z.CallCandidates){if(m)return;l?l.onRemoteIceCandidatesReceived(e):(n.candidateEventsByCall.has(i.call_id)||n.candidateEventsByCall.set(i.call_id,[]),n.candidateEventsByCall.get(i.call_id).push(e));return}else if([Z.CallHangup,Z.CallReject].includes(a)){if(l)l.state!==at.Ended&&(a===Z.CallHangup?l.onHangupReceived(i):l.onRejectReceived(i),l.state===at.Ended&&n.calls.delete(i.call_id));else{var O;l=(O=fb(n.client,s,{opponentDeviceId:d,opponentSessionId:i.sender_session_id}))!==null&&O!==void 0?O:void 0,l&&(l.callId=i.call_id,l.initWithHangup(e),n.calls.set(i.call_id,l))}return}if(!l||!l.hasPeerConnection){M.info("CallEventHandler handleCallEvent() discarding possible call event as we don't have a call (type=".concat(a,")"));return}if(e.getContent().party_id!==l.ourPartyId)switch(a){case Z.CallAnswer:m?l.state===at.Ringing&&l.onAnsweredElsewhere(i):l.onAnswerReceived(e);break;case Z.CallSelectAnswer:l.onSelectAnswerReceived(e);break;case Z.CallNegotiate:l.onNegotiateReceived(e);break;case Z.CallAssertedIdentity:case Z.CallAssertedIdentityPrefix:l.onAssertedIdentityReceived(e);break;case Z.CallSDPStreamMetadataChanged:case Z.CallSDPStreamMetadataChangedPrefix:l.onSDPStreamMetadataChangedReceived(e);break}}})()}}var lA=function(t){return t.Incoming="GroupCall.incoming",t.Outgoing="GroupCall.outgoing",t.Ended="GroupCall.ended",t.Participants="GroupCall.participants",t}({});class r1e{constructor(e){this.client=e,L(this,"groupCalls",new Map),L(this,"roomDeferreds",new Map),L(this,"onRoomsChanged",n=>{this.createGroupCallForRoom(n)}),L(this,"onRoomStateChanged",(n,r)=>{var i=n.getType();if(i===Z.GroupCallPrefix){var s=n.getStateKey(),o=n.getContent(),a=this.groupCalls.get(r.roomId);!a&&!o["m.terminated"]&&!n.isRedacted()?this.createGroupCallFromRoomStateEvent(n):a&&a.groupCallId===s?o["m.terminated"]||n.isRedacted()?a.terminate(!1):o["m.type"]!==a.type&&M.warn("GroupCallEventHandler onRoomStateChanged() currently does not support changing type (roomId=".concat(r.roomId,")")):a&&a.groupCallId!==s&&M.warn("GroupCallEventHandler onRoomStateChanged() currently does not support multiple calls (roomId=".concat(r.roomId,")"))}})}start(){var e=this;return B(function*(){e.client.getSyncState()!==Gt.Syncing&&(M.debug("GroupCallEventHandler start() waiting for client to start syncing"),yield new Promise(i=>{var s=()=>{if(e.client.getSyncState()===Gt.Syncing)return e.client.off(Le.Sync,s),i()};e.client.on(Le.Sync,s)}));var n=e.client.getRooms();for(var r of n)e.createGroupCallForRoom(r);e.client.on(Le.Room,e.onRoomsChanged),e.client.on(pt.Events,e.onRoomStateChanged)})()}stop(){this.client.removeListener(Le.Room,this.onRoomsChanged),this.client.removeListener(pt.Events,this.onRoomStateChanged)}getRoomDeferred(e){var n=this.roomDeferreds.get(e);if(n===void 0){var r;n={prom:new Promise(i=>{r=i})},n.resolve=r,this.roomDeferreds.set(e,n)}return n}waitUntilRoomReadyForGroupCalls(e){return this.getRoomDeferred(e).prom}getGroupCallById(e){return[...this.groupCalls.values()].find(n=>n.groupCallId===e)}createGroupCallForRoom(e){var n=e.currentState.getStateEvents(Z.GroupCallPrefix),r=n.sort((o,a)=>a.getTs()-o.getTs());for(var i of r){var s=i.getContent();if(!(s["m.terminated"]||i.isRedacted())){M.debug("GroupCallEventHandler createGroupCallForRoom() choosing group call from possible calls (stateKey=".concat(i.getStateKey(),", ts=").concat(i.getTs(),", roomId=").concat(e.roomId,", numOfPossibleCalls=").concat(n.length,")")),this.createGroupCallFromRoomStateEvent(i);break}}this.getRoomDeferred(e.roomId).resolve()}createGroupCallFromRoomStateEvent(e){var n=e.getRoomId(),r=e.getContent(),i=this.client.getRoom(n);if(!i){M.warn("GroupCallEventHandler createGroupCallFromRoomStateEvent() couldn't find room for call (roomId=".concat(n,")"));return}var s=e.getStateKey(),o=r["m.type"];if(!Object.values(eT).includes(o)){M.warn("GroupCallEventHandler createGroupCallFromRoomStateEvent() received invalid call type (type=".concat(o,", roomId=").concat(n,")"));return}var a=r["m.intent"];if(!Object.values(VJ).includes(a)){M.warn("Received invalid group call intent (type=".concat(o,", roomId=").concat(n,")"));return}var c=!!r["io.element.ptt"],l;if(r!=null&&r.dataChannelsEnabled&&r!==null&&r!==void 0&&r.dataChannelOptions){var{ordered:d,maxPacketLifeTime:h,maxRetransmits:m,protocol:g}=r.dataChannelOptions;l={ordered:d,maxPacketLifeTime:h,maxRetransmits:m,protocol:g}}var y=new YO(this.client,i,o,c,a,s,r?.dataChannelsEnabled||this.client.isVoipWithNoMediaAllowed,l,this.client.isVoipWithNoMediaAllowed,this.client.useLivekitForGroupCalls,r["io.element.livekit_service_url"]);return this.groupCalls.set(i.roomId,y),this.client.emit(lA.Incoming,y),y}}class i1e{constructor(){L(this,"bandwidth",{}),L(this,"bitrate",{}),L(this,"packetLoss",{}),L(this,"transport",[])}}class s1e{static buildBandwidthReport(e){var n=e.availableIncomingBitrate,r=e.availableOutgoingBitrate;return{download:n?Math.round(n/1e3):0,upload:r?Math.round(r/1e3):0}}}class o1e{static buildReport(e,n,r,i){var s=e?.get(n.localCandidateId),o=e?.get(n.remoteCandidateId);if(o&&s){var a=o.ip!==void 0?o.ip:o.address,c=o.port,l="".concat(a,":").concat(c),d=s.ip!==void 0?s.ip:s.address,h=s.port,m="".concat(d,":").concat(h),g=o.protocol;r.some(y=>y.ip===l&&y.type===g&&y.localIp===m)||r.push({ip:l,type:g,localIp:m,isFocus:i,localCandidateType:s.candidateType,remoteCandidateType:o.candidateType,networkType:s.networkType,rtt:n.currentRoundTripTime?n.currentRoundTripTime*1e3:NaN})}return r}}class a1e{constructor(){L(this,"ssrcToMid",{local:new Map,remote:new Map})}findMidBySsrc(e,n){var r;return this.ssrcToMid[n].forEach((i,s)=>{if(i.find(o=>o==e)){r=s;return}}),r}parse(e,n){var r=sA.parse(e),i=new Map;r.media.forEach(s=>{if(s.mid&&s.type==="video"||s.type==="audio"){var o,a=[];(o=s.ssrcs)===null||o===void 0||o.forEach(c=>{c.attribute==="cname"&&a.push("".concat(c.id))}),i.set("".concat(s.mid),a)}}),this.ssrcToMid[n]=i}getSsrcToMidMap(e){return this.ssrcToMid[e]}}class c1e{constructor(e){this.pc=e}getLocalTracks(e){var n=r=>r!==null&&r.kind===e;return this.pc.getTransceivers().filter(r=>r.currentDirection==="sendonly"||r.currentDirection==="sendrecv").filter(r=>r.sender!==null).map(r=>r.sender).map(r=>r.track).filter(n)}getTackById(e){return this.pc.getTransceivers().map(n=>{if(n?.sender.track!==null&&n.sender.track.id===e)return n.sender.track;if(n?.receiver.track!==null&&n.receiver.track.id===e)return n.receiver.track}).find(n=>n!==void 0)}getLocalTrackIdByMid(e){var n,r=this.pc.getTransceivers().find(i=>i.mid===e);return r==null||(n=r.sender)===null||n===void 0||(n=n.track)===null||n===void 0?void 0:n.id}getRemoteTrackIdByMid(e){var n,r=this.pc.getTransceivers().find(i=>i.mid===e);return r==null||(n=r.receiver)===null||n===void 0||(n=n.track)===null||n===void 0?void 0:n.id}getActiveSimulcastStreams(){return 3}getTransceiverByTrackId(e){return this.pc.getTransceivers().find(n=>n.receiver.track.id===e||n.sender.track!==null&&n.sender.track.id===e)}}class l1e{constructor(e,n,r){this.trackId=e,this.type=n,this.kind=r,L(this,"loss",{packetsTotal:0,packetsLost:0,isDownloadStream:!1}),L(this,"bitrate",{download:0,upload:0}),L(this,"resolution",{width:-1,height:-1}),L(this,"audioConcealment",{concealedAudio:0,totalAudioDuration:0}),L(this,"framerate",0),L(this,"jitter",0),L(this,"codec",""),L(this,"isAlive",!0),L(this,"isMuted",!1),L(this,"isEnabled",!0)}getType(){return this.type}setLoss(e){this.loss=e}getLoss(){return this.loss}setResolution(e){this.resolution=e}getResolution(){return this.resolution}setFramerate(e){this.framerate=e}getFramerate(){return this.framerate}setBitrate(e){this.bitrate=e}getBitrate(){return this.bitrate}setCodec(e){return this.codec=e,!0}getCodec(){return this.codec}resetBitrate(){this.bitrate={download:0,upload:0}}set alive(e){this.isAlive=e}get alive(){return this.isAlive}set muted(e){this.isMuted=e}get muted(){return this.isMuted}set enabled(e){this.isEnabled=e}get enabled(){return this.isEnabled}setJitter(e){this.jitter=e}getJitter(){return this.jitter}setAudioConcealment(e,n){this.audioConcealment.concealedAudio=e,this.audioConcealment.totalAudioDuration=n}getAudioConcealment(){return this.audioConcealment}}class u1e{constructor(e,n){this.mediaSsrcHandler=e,this.mediaTrackHandler=n,L(this,"track2stats",new Map)}findTrack2Stats(e,n){var r;if(e.trackIdentifier)r=e.trackIdentifier;else if(e.mid)r=n==="remote"?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid);else if(e.ssrc){var i=this.mediaSsrcHandler.findMidBySsrc(e.ssrc,n);if(!i)return;r=n==="remote"?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid)}if(r){var s=this.track2stats.get(r);if(!s){var o=this.mediaTrackHandler.getTackById(r);if(o!==void 0){var a=o.kind==="audio"?o.kind:"video";s=new l1e(r,n,a),this.track2stats.set(r,s)}else return}return s}}findLocalVideoTrackStats(e){var n=this.mediaTrackHandler.getLocalTracks("video");if(n.length!==0)return this.findTrack2Stats(e,"local")}getTrack2stats(){return this.track2stats}findTransceiverByTrackId(e){return this.mediaTrackHandler.getTransceiverByTrackId(e)}}class Ch{static getNonNegativeValue(e){var n=e;return typeof n!="number"&&(n=Number(n)),isNaN(n)?0:Math.max(0,n)}}class bo{static buildFramerateResolution(e,n){var r={height:n.frameHeight,width:n.frameWidth},i=n.framesPerSecond;r.height&&r.width&&e.setResolution(r),e.setFramerate(Math.round(i||0))}static calculateSimulcastFramerate(e,n,r,i){var s=e.getFramerate();if(!s){if(r){var o=n.timestamp-r.timestamp;if(o>0&&n.framesSent){var a=n.framesSent-r.framesSent;s=a/o*1e3}}if(!s)return}s=i?Math.round(s/i):0,e.setFramerate(s)}static buildCodec(e,n,r){var i=e?.get(r.codecId);if(i){var s=i.mimeType.split("/")[1];s&&n.setCodec(s)}}static buildBitrateReceived(e,n,r){e.setBitrate({download:bo.calculateBitrate(n.bytesReceived,r.bytesReceived,n.timestamp,r.timestamp),upload:0})}static buildBitrateSend(e,n,r){e.setBitrate({download:0,upload:this.calculateBitrate(n.bytesSent,r.bytesSent,n.timestamp,r.timestamp)})}static buildPacketsLost(e,n,r){var i=n.type==="outbound-rtp"?"packetsSent":"packetsReceived",s=n[i];(!s||s<0)&&(s=0);var o=Ch.getNonNegativeValue(r[i]),a=Math.max(0,s-o),c=Ch.getNonNegativeValue(n.packetsLost),l=Ch.getNonNegativeValue(r.packetsLost),d=Math.max(0,c-l);e.setLoss({packetsTotal:a+d,packetsLost:d,isDownloadStream:n.type!=="outbound-rtp"})}static calculateBitrate(e,n,r,i){var s=Ch.getNonNegativeValue(e),o=Ch.getNonNegativeValue(n),a=Math.max(0,s-o),c=r-i,l=0;return c>0&&(l=Math.round(a*8/c)),l}static setTrackStatsState(e,n){var r;if(n===void 0){e.alive=!1;return}var i=e.getType()==="remote"?n.receiver.track:n==null||(r=n.sender)===null||r===void 0?void 0:r.track;if(i==null){e.alive=!1;return}if(i.readyState==="ended"){e.alive=!1;return}e.muted=i.muted,e.enabled=i.enabled,e.alive=!0}static buildTrackSummary(e){var n={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},r={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},i=e.filter(o=>o.getType()==="remote"),s=i.filter(o=>o.kind==="audio");return i.forEach(o=>{var a=o.kind==="video"?n:r;if(a.count++,o.alive&&o.muted&&a.muted++,a.maxJitter<o.getJitter()&&(a.maxJitter=o.getJitter()),a.maxPacketLoss<o.getLoss().packetsLost&&(a.maxPacketLoss=o.getLoss().packetsLost),s.length>0){var c,l;a.concealedAudio+=(c=o.getAudioConcealment())===null||c===void 0?void 0:c.concealedAudio,a.totalAudio+=(l=o.getAudioConcealment())===null||l===void 0?void 0:l.totalAudioDuration}}),{audioTrackSummary:r,videoTrackSummary:n}}static buildJitter(e,n){if(n.type==="inbound-rtp"){var r=n?.jitter;if(r!==void 0){var i=Ch.getNonNegativeValue(r);e.setJitter(Math.round(i*1e3))}else e.setJitter(-1)}}static buildAudioConcealment(e,n){if(n.type==="inbound-rtp"){var r=1e3*n?.totalSamplesDuration/n?.totalSamplesReceived,i=r*n?.concealedSamples,s=1e3*n?.totalSamplesDuration;e.setAudioConcealment(i,s)}}}class Ry{static build(e){var n={},r={download:0,upload:0},i={download:0,upload:0},s=0,o=0,a={local:new Map,remote:new Map},c={local:new Map,remote:new Map},l={local:new Map,remote:new Map},d=new Map,h=new Map,m=0,g=0,y=0,v=0,w=0,S=0;for(var[R,x]of e){var T=x.getLoss(),I=T.isDownloadStream?"download":"upload";if(r[I]+=T.packetsTotal,i[I]+=T.packetsLost,s+=x.getBitrate().download,o+=x.getBitrate().upload,x.kind==="audio"){var k=x.getAudioConcealment();w+=k.concealedAudio,S+=k.totalAudioDuration,m+=x.getBitrate().download,g+=x.getBitrate().upload}else y+=x.getBitrate().download,v+=x.getBitrate().upload;a[x.getType()].set(R,x.getResolution()),c[x.getType()].set(R,x.getFramerate()),l[x.getType()].set(R,x.getCodec()),x.getType()==="remote"&&(d.set(R,x.getJitter()),x.kind==="audio"&&h.set(R,x.getAudioConcealment())),x.resetBitrate()}return n.bitrate={upload:o,download:s},n.bitrate.audio={upload:g,download:m},n.bitrate.video={upload:v,download:y},n.packetLoss={total:Ry.calculatePacketLoss(i.download+i.upload,r.download+r.upload),download:Ry.calculatePacketLoss(i.download,r.download),upload:Ry.calculatePacketLoss(i.upload,r.upload)},n.audioConcealment=h,n.totalAudioConcealment={concealedAudio:w,totalAudioDuration:S},n.framerate=c,n.resolution=a,n.codec=l,n.jitter=d,n}static calculatePacketLoss(e,n){return!n||n<=0||!e||e<=0?0:Math.round(e/n*100)}}class qd{static buildCallFeedReport(e,n,r){var i=r.getTransceivers(),s=[],o=[];return i.forEach(a=>{var c,l=(c=a.sender)!==null&&c!==void 0&&c.track?qd.buildTrackStats(a.sender.track,"sender"):null,d=qd.buildTrackStats(a.receiver.track,"receiver");s.push({mid:a.mid==null?"null":a.mid,direction:a.direction,currentDirection:a.currentDirection==null?"null":a.currentDirection,sender:l,receiver:d})}),{callId:e,opponentMemberId:n,transceiver:s,callFeeds:o}}static buildTrackStats(e){var n,r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"--",s=(n=e.getSettings())===null||n===void 0?void 0:n.deviceId,o=(r=e.getConstraints())===null||r===void 0?void 0:r.deviceId;return{id:e.id,kind:e.kind,settingDeviceId:s??"unknown",constrainDeviceId:o??"unknown",muted:e.muted,enabled:e.enabled,readyState:e.readyState,label:i}}static expandCallFeedReport(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unknown";return n.forEach(i=>{var s=i.stream.getAudioTracks(),o=i.stream.getVideoTracks(),a=s.length>0?qd.buildTrackStats(i.stream.getAudioTracks()[0],i.purpose):null,c=o.length>0?qd.buildTrackStats(i.stream.getVideoTracks()[0],i.purpose):null,l={stream:i.stream.id,type:i.isLocal()?"local":"remote",audio:a,video:c,purpose:i.purpose,prefix:r,isVideoMuted:i.isVideoMuted(),isAudioMuted:i.isAudioMuted()};e.callFeeds.push(l)}),e}}function A$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function R2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?A$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class d1e{constructor(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.callId=e,this.opponentMemberId=n,this.pc=r,this.emitter=i,this.isFocus=s,L(this,"isActive",!0),L(this,"previousStatsReport",void 0),L(this,"currentStatsReport",void 0),L(this,"connectionStats",new i1e),L(this,"trackStats",void 0),r.addEventListener("signalingstatechange",this.onSignalStateChange.bind(this)),this.trackStats=new u1e(new a1e,new c1e(r))}processStats(e,n){var r=this;return B(function*(){var i={isFirstCollection:r.previousStatsReport===void 0,receivedMedia:0,receivedAudioMedia:0,receivedVideoMedia:0,audioTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0},videoTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0}};if(r.isActive){var s=r.pc.getStats();if(typeof s?.then=="function")return s.then(o=>{var a,c;r.currentStatsReport=typeof o?.result=="function"?o.result():o;try{r.processStatsReport(e,n)}catch(d){return r.handleError(d),i}r.previousStatsReport=r.currentStatsReport,i.receivedMedia=r.connectionStats.bitrate.download,i.receivedAudioMedia=((a=r.connectionStats.bitrate.audio)===null||a===void 0?void 0:a.download)||0,i.receivedVideoMedia=((c=r.connectionStats.bitrate.video)===null||c===void 0?void 0:c.download)||0;var l=bo.buildTrackSummary(Array.from(r.trackStats.getTrack2stats().values()));return R2(R2({},i),{},{audioTrackSummary:l.audioTrackSummary,videoTrackSummary:l.videoTrackSummary})}).catch(o=>(r.handleError(o),i));r.isActive=!1}return Promise.resolve(i)})()}processStatsReport(e,n){var r,i=new Map;i.callId=this.callId,i.opponentMemberId=this.opponentMemberId,(r=this.currentStatsReport)===null||r===void 0||r.forEach(s=>{var o=this.previousStatsReport?this.previousStatsReport.get(s.id):null;if(s.type==="candidate-pair"&&s.nominated&&s.state==="succeeded")this.connectionStats.bandwidth=s1e.buildBandwidthReport(s),this.connectionStats.transport=o1e.buildReport(this.currentStatsReport,s,this.connectionStats.transport,this.isFocus);else if(s.type==="inbound-rtp"||s.type==="outbound-rtp"){var a=this.trackStats.findTrack2Stats(s,s.type==="inbound-rtp"?"remote":"local");if(!a)return;if(o&&bo.buildPacketsLost(a,s,o),s.type==="inbound-rtp"){bo.buildFramerateResolution(a,s),o&&bo.buildBitrateReceived(a,s,o);var c=this.trackStats.findTransceiverByTrackId(a.trackId);bo.setTrackStatsState(a,c),bo.buildJitter(a,s),bo.buildAudioConcealment(a,s)}else o&&(i.set(a.trackId,Ch.getNonNegativeValue(s.bytesSent)),bo.buildBitrateSend(a,s,o));bo.buildCodec(this.currentStatsReport,a,s)}else if(s.type==="track"&&s.kind==="video"&&!s.remoteSource){var l=this.trackStats.findLocalVideoTrackStats(s);if(!l)return;bo.buildFramerateResolution(l,s),bo.calculateSimulcastFramerate(l,s,o,this.trackStats.mediaTrackHandler.getActiveSimulcastStreams())}}),this.emitter.emitByteSendReport(i),this.emitter.emitCallFeedReport(qd.buildCallFeedReport(this.callId,this.opponentMemberId,this.pc)),this.processAndEmitConnectionStatsReport()}setActive(e){this.isActive=e}getActive(){return this.isActive}handleError(e){this.isActive=!1,M.warn("CallStatsReportGatherer ".concat(this.callId," processStatsReport fails and set to inactive ").concat(e))}processAndEmitConnectionStatsReport(){var e=Ry.build(this.trackStats.getTrack2stats());e.callId=this.callId,e.opponentMemberId=this.opponentMemberId,this.connectionStats.bandwidth=e.bandwidth,this.connectionStats.bitrate=e.bitrate,this.connectionStats.packetLoss=e.packetLoss,this.emitter.emitConnectionStatsReport(R2(R2({},e),{},{transport:this.connectionStats.transport})),this.connectionStats.transport=[]}stopProcessingStats(){}onSignalStateChange(){this.pc.signalingState==="stable"&&(this.pc.currentRemoteDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentRemoteDescription.sdp,"remote"),this.pc.currentLocalDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentLocalDescription.sdp,"local"))}setOpponentMemberId(e){this.opponentMemberId=e}}var pu=function(t){return t.CONNECTION_STATS="StatsReport.connection_stats",t.CALL_FEED_REPORT="StatsReport.call_feed_report",t.BYTE_SENT_STATS="StatsReport.byte_sent_stats",t.SUMMARY_STATS="StatsReport.summary_stats",t}({});class f1e extends On{emitByteSendReport(e){this.emit(pu.BYTE_SENT_STATS,e)}emitConnectionStatsReport(e){this.emit(pu.CONNECTION_STATS,e)}emitCallFeedReport(e){this.emit(pu.CALL_FEED_REPORT,e)}emitSummaryStatsReport(e){this.emit(pu.SUMMARY_STATS,e)}}class HJ{constructor(e){this.emitter=e}build(e){var n=e.filter(d=>!d.isFirstCollection),r=n.length,i=e.length;if(r!==0){var s={receivedAudio:0,receivedVideo:0,receivedMedia:0,concealedAudio:0,totalAudio:0},o=0,a=0;n.forEach(d=>{this.countTrackListReceivedMedia(s,d),this.countConcealedAudio(s,d),o=this.buildMaxJitter(o,d),a=this.buildMaxPacketLoss(a,d)});var c=5,l={percentageReceivedMedia:Number((s.receivedMedia/r).toFixed(c)),percentageReceivedVideoMedia:Number((s.receivedVideo/r).toFixed(c)),percentageReceivedAudioMedia:Number((s.receivedAudio/r).toFixed(c)),maxJitter:o,maxPacketLoss:a,percentageConcealedAudio:Number(s.totalAudio>0?(s.concealedAudio/s.totalAudio).toFixed(c):0),peerConnections:i};this.emitter.emitSummaryStatsReport(l)}}static extendSummaryReport(e,n){var r=[],i=[];for(var s of n){i.push(s);for(var o of s[1])r.push(o)}e.opponentDevicesInCall=Math.max(0,r.length-1),e.opponentUsersInCall=Math.max(0,i.length-1),e.diffDevicesToPeerConnections=Math.max(0,r.length-1)-e.peerConnections,e.ratioPeerConnectionToDevices=Math.max(0,r.length-1)==0?0:e.peerConnections/(r.length-1)}countTrackListReceivedMedia(e,n){var r=!1,i=!1;(n.receivedAudioMedia>0||n.audioTrackSummary.count===0)&&(e.receivedAudio++,r=!0),(n.receivedVideoMedia>0||n.videoTrackSummary.count===0||n.videoTrackSummary.muted>0&&n.videoTrackSummary.muted===n.videoTrackSummary.count)&&(e.receivedVideo++,i=!0),i&&r&&e.receivedMedia++}buildMaxJitter(e,n){return e<n.videoTrackSummary.maxJitter&&(e=n.videoTrackSummary.maxJitter),e<n.audioTrackSummary.maxJitter&&(e=n.audioTrackSummary.maxJitter),e}buildMaxPacketLoss(e,n){return e<n.videoTrackSummary.maxPacketLoss&&(e=n.videoTrackSummary.maxPacketLoss),e<n.audioTrackSummary.maxPacketLoss&&(e=n.audioTrackSummary.maxPacketLoss),e}countConcealedAudio(e,n){e.concealedAudio+=n.audioTrackSummary.concealedAudio,e.totalAudio+=n.audioTrackSummary.totalAudio}}class h1e{constructor(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e4;this.groupCallId=e,this.userId=n,this.interval=r,L(this,"timer",void 0),L(this,"gatherers",new Map),L(this,"reports",new f1e),L(this,"summaryStatsReportGatherer",new HJ(this.reports))}start(){this.timer===void 0&&this.interval>0&&(this.timer=setInterval(()=>{this.processStats()},this.interval))}stop(){this.timer!==void 0&&(clearInterval(this.timer),this.gatherers.forEach(e=>e.stopProcessingStats()))}hasStatsReportGatherer(e){return this.gatherers.has(e)}addStatsReportGatherer(e,n,r){return this.hasStatsReportGatherer(e)?!1:(this.gatherers.set(e,new d1e(e,n,r,this.reports)),!0)}removeStatsReportGatherer(e){return this.gatherers.delete(e)}getStatsReportGatherer(e){return this.hasStatsReportGatherer(e)?this.gatherers.get(e):void 0}updateOpponentMember(e,n){var r;(r=this.getStatsReportGatherer(e))===null||r===void 0||r.setOpponentMemberId(n)}processStats(){var e=[];this.gatherers.forEach(n=>{e.push(n.processStats(this.groupCallId,this.userId))}),Promise.all(e).then(n=>this.summaryStatsReportGatherer.build(n)).catch(n=>{M.error("Could not build summary stats report",n)})}setInterval(e){this.interval=e}}function P$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function I2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?P$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var VJ=function(t){return t.Ring="m.ring",t.Prompt="m.prompt",t.Room="m.room",t}({}),eT=function(t){return t.Video="m.video",t.Voice="m.voice",t}({}),p1e=function(t){return t.CallEnded="call_ended",t}({}),kn=function(t){return t.GroupCallStateChanged="group_call_state_changed",t.ActiveSpeakerChanged="active_speaker_changed",t.CallsChanged="calls_changed",t.UserMediaFeedsChanged="user_media_feeds_changed",t.ScreenshareFeedsChanged="screenshare_feeds_changed",t.LocalScreenshareStateChanged="local_screenshare_state_changed",t.LocalMuteStateChanged="local_mute_state_changed",t.ParticipantsChanged="participants_changed",t.Error="group_call_error",t}({}),uy=function(t){return t.ConnectionStats="GroupCall.connection_stats",t.ByteSentStats="GroupCall.byte_sent_stats",t.SummaryStats="GroupCall.summary_stats",t.CallFeedStats="GroupCall.call_feed_stats",t}({}),Iy=function(t){return t.NoUserMedia="no_user_media",t.UnknownDevice="unknown_device",t.PlaceCallFailed="place_call_failed",t}({});class uA extends Error{constructor(e,n,r){r?(super(n+": "+r),L(this,"code",void 0)):(super(n),L(this,"code",void 0)),this.code=e}}class qJ extends uA{constructor(e){super(Iy.UnknownDevice,"No device found for "+e),this.userId=e}}var sr=function(t){return t.LocalCallFeedUninitialized="local_call_feed_uninitialized",t.InitializingLocalCallFeed="initializing_local_call_feed",t.LocalCallFeedInitialized="local_call_feed_initialized",t.Entered="entered",t.Ended="ended",t}({}),L$=1e3*60*60;function k2(t){var e;return((e=t.getOpponentMember())===null||e===void 0?void 0:e.userId)||t.invitee||null}class YO extends On{constructor(e,n,r,i,s,o,a,c,l){var d,h,m=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,g=arguments.length>10?arguments[10]:void 0;super(),this.client=e,this.room=n,this.type=r,this.isPtt=i,this.intent=s,this.dataChannelsEnabled=a,this.dataChannelOptions=c,this.useLivekit=m,L(this,"activeSpeakerInterval",1e3),L(this,"retryCallInterval",5e3),L(this,"participantTimeout",1e3*15),L(this,"pttMaxTransmitTime",1e3*20),L(this,"activeSpeaker",void 0),L(this,"localCallFeed",void 0),L(this,"localScreenshareFeed",void 0),L(this,"localDesktopCapturerSourceId",void 0),L(this,"userMediaFeeds",[]),L(this,"screenshareFeeds",[]),L(this,"groupCallId",void 0),L(this,"allowCallWithoutVideoAndAudio",void 0),L(this,"calls",new Map),L(this,"callHandlers",new Map),L(this,"activeSpeakerLoopInterval",void 0),L(this,"retryCallLoopInterval",void 0),L(this,"retryCallCounts",new Map),L(this,"reEmitter",void 0),L(this,"transmitTimer",null),L(this,"participantsExpirationTimer",null),L(this,"resendMemberStateTimer",null),L(this,"initWithAudioMuted",!1),L(this,"initWithVideoMuted",!1),L(this,"initCallFeedPromise",void 0),L(this,"_livekitServiceURL",void 0),L(this,"stats",void 0),L(this,"statsCollectIntervalTime",0),L(this,"onConnectionStats",y=>{this.emit(uy.ConnectionStats,{report:y})}),L(this,"onByteSentStats",y=>{this.emit(uy.ByteSentStats,{report:y})}),L(this,"onSummaryStats",y=>{HJ.extendSummaryReport(y,this.participants),this.emit(uy.SummaryStats,{report:y})}),L(this,"onCallFeedReport",y=>{this.localCallFeed&&(y=qd.expandCallFeedReport(y,[this.localCallFeed],"from-local-feed"));var v=[];this.forEachCall(w=>{w.callId===y.callId&&w.getFeeds().forEach(S=>v.push(S))}),y=qd.expandCallFeedReport(y,v,"from-call-feed"),this.emit(uy.CallFeedStats,{report:y})}),L(this,"_state",sr.LocalCallFeedUninitialized),L(this,"_participants",new Map),L(this,"_creationTs",null),L(this,"_enteredViaAnotherSession",!1),L(this,"onIncomingCall",y=>{var v,w;if(y.roomId===this.room.roomId){if(y.state!==at.Ringing){M.warn("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call no longer in ringing state - ignoring"));return}if(!y.groupCallId||y.groupCallId!==this.groupCallId){M.log("GroupCall ".concat(this.groupCallId," onIncomingCall() ignored because it doesn't match the current group call")),y.reject();return}var S=(v=y.getOpponentMember())===null||v===void 0?void 0:v.userId;if(S===void 0){M.warn("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call with no member - ignoring"));return}if(this.useLivekit){M.info("Received incoming call whilst in signaling-only mode! Ignoring.");return}var R=(w=this.calls.get(S))!==null&&w!==void 0?w:new Map,x=R.get(y.getOpponentDeviceId());if(x?.callId!==y.callId){M.log("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call (userId=").concat(S,", callId=").concat(y.callId,")")),x&&x.hangup(ft.Replaced,!1),R.set(y.getOpponentDeviceId(),y),this.calls.set(S,R),this.initCall(y);var T=this.getLocalFeeds().map(k=>k.clone());if(!this.callExpected(y))for(var I of T)Nr(I.stream.getAudioTracks(),!1),Nr(I.stream.getVideoTracks(),!1);y.answerWithCallFeeds(T),this.emit(kn.CallsChanged,this.calls)}}}),L(this,"onRetryCallLoop",()=>{var y=!1;for(var[{userId:v},w]of this.participants){var S=this.calls.get(v),R=this.retryCallCounts.get(v);for(var[x,T]of w){var I,k,A=S?.get(x),O=(I=(k=R)===null||k===void 0?void 0:k.get(x))!==null&&I!==void 0?I:0;A?.getOpponentSessionId()!==T.sessionId&&this.wantsOutgoingCall(v,x)&&O<3&&(R===void 0&&(R=new Map,this.retryCallCounts.set(v,R)),R.set(x,O+1),y=!0)}}y&&this.placeOutgoingCalls()}),L(this,"onCallFeedsChanged",y=>{var v=k2(y),w=y.getOpponentDeviceId();if(!v)throw new Error("Cannot change call feeds without user id");var S=this.getUserMediaFeed(v,w),R=y.remoteUsermediaFeed,x=R!==S,T=this.calls.get(v),I=T?.get(w);if(I?.callId===y.callId){x&&(!S&&R?this.addUserMediaFeed(R):S&&R?this.replaceUserMediaFeed(S,R):S&&!R&&this.removeUserMediaFeed(S));var k=this.getScreenshareFeed(v,w),A=y.remoteScreensharingFeed,O=A!==k;O&&(!k&&A?this.addScreenshareFeed(A):k&&A?this.replaceScreenshareFeed(k,A):k&&!A&&this.removeScreenshareFeed(k))}}),L(this,"onCallStateChanged",(y,v,w)=>{var S;if(v!==at.Ended){var R=this.localCallFeed.isAudioMuted();y.localUsermediaStream&&y.isMicrophoneMuted()!==R&&y.setMicrophoneMuted(R);var x=this.localCallFeed.isVideoMuted();y.localUsermediaStream&&y.isLocalVideoMuted()!==x&&y.setLocalVideoMuted(x);var T=(S=y.getOpponentMember())===null||S===void 0?void 0:S.userId;if(v===at.Connected&&T){var I=this.retryCallCounts.get(T);I?.delete(y.getOpponentDeviceId()),I?.size===0&&this.retryCallCounts.delete(T)}}}),L(this,"onCallHangup",y=>{var v,w;if(y.hangupReason!==ft.Replaced){var S=(v=(w=y.getOpponentMember())===null||w===void 0?void 0:w.userId)!==null&&v!==void 0?v:this.room.getMember(y.invitee).userId,R=this.calls.get(S);R?.get(y.getOpponentDeviceId())===y&&(this.disposeCall(y,y.hangupReason),R.delete(y.getOpponentDeviceId()),R.size===0&&this.calls.delete(S),this.emit(kn.CallsChanged,this.calls))}}),L(this,"onCallReplaced",(y,v)=>{var w=y.getOpponentMember().userId,S=this.calls.get(w);S===void 0&&(S=new Map,this.calls.set(w,S)),y.hangup(ft.Replaced,!1),this.initCall(v),S.set(y.getOpponentDeviceId(),v),this.emit(kn.CallsChanged,this.calls)}),L(this,"onActiveSpeakerLoop",()=>{var y=void 0,v=void 0;for(var w of this.userMediaFeeds)if(!(w.isLocal()&&this.userMediaFeeds.length>1)){var S=w.speakingVolumeSamples.reduce((x,T)=>x+Math.max(T,aA)),R=S/w.speakingVolumeSamples.length;(!y||R>y)&&(y=R,v=w)}v&&this.activeSpeaker!==v&&y&&y>aA&&(this.activeSpeaker=v,this.emit(kn.ActiveSpeakerChanged,this.activeSpeaker))}),L(this,"onRoomState",()=>this.updateParticipants()),L(this,"onParticipantsChanged",()=>{this.forEachCall(y=>{var v=this.callExpected(y);for(var w of y.getLocalFeeds())Nr(w.stream.getAudioTracks(),!w.isAudioMuted()&&v),Nr(w.stream.getVideoTracks(),!w.isVideoMuted()&&v)}),this.state===sr.Entered&&!this.useLivekit&&this.placeOutgoingCalls()}),L(this,"onStateChanged",(y,v)=>{(y===sr.Entered||v===sr.Entered||y===sr.Ended)&&(this.updateParticipants(),this.updateMemberState().catch(w=>M.error("GroupCall ".concat(this.groupCallId,' onStateChanged() failed to update member state devices"'),w)))}),L(this,"onLocalFeedsChanged",()=>{this.state===sr.Entered&&this.updateMemberState().catch(y=>M.error("GroupCall ".concat(this.groupCallId," onLocalFeedsChanged() failed to update member state feeds"),y))}),this.reEmitter=new uJ(this),this.groupCallId=o??Th(),this._livekitServiceURL=g,this.creationTs=(d=(h=n.currentState.getStateEvents(Z.GroupCallPrefix,this.groupCallId))===null||h===void 0?void 0:h.getTs())!==null&&d!==void 0?d:null,this.updateParticipants(),n.on(pt.Update,this.onRoomState),this.on(kn.ParticipantsChanged,this.onParticipantsChanged),this.on(kn.GroupCallStateChanged,this.onStateChanged),this.on(kn.LocalScreenshareStateChanged,this.onLocalFeedsChanged),this.allowCallWithoutVideoAndAudio=!!l}create(){var e=this;return B(function*(){return e.creationTs=Date.now(),e.client.groupCallEventHandler.groupCalls.set(e.room.roomId,e),e.client.emit(lA.Outgoing,e),yield e.sendCallStateEvent(),e})()}sendCallStateEvent(){var e=this;return B(function*(){var n={"m.intent":e.intent,"m.type":e.type,"io.element.ptt":e.isPtt,dataChannelsEnabled:e.dataChannelsEnabled,dataChannelOptions:e.dataChannelsEnabled?e.dataChannelOptions:void 0};e.livekitServiceURL&&(n["io.element.livekit_service_url"]=e.livekitServiceURL),yield e.client.sendStateEvent(e.room.roomId,Z.GroupCallPrefix,n,e.groupCallId)})()}get livekitServiceURL(){return this._livekitServiceURL}updateLivekitServiceURL(e){return this._livekitServiceURL=e,this.sendCallStateEvent()}get state(){return this._state}set state(e){var n=this._state;e!==n&&(this._state=e,this.emit(kn.GroupCallStateChanged,e,n))}get participants(){return this._participants}set participants(e){var n=this._participants,r=(s,o)=>s.sessionId===o.sessionId&&s.screensharing===o.screensharing,i=(s,o)=>MF(s,o,r);MF(e,n,i)||(this._participants=e,this.emit(kn.ParticipantsChanged,e))}get creationTs(){return this._creationTs}set creationTs(e){this._creationTs=e}get enteredViaAnotherSession(){return this._enteredViaAnotherSession}set enteredViaAnotherSession(e){this._enteredViaAnotherSession=e,this.updateParticipants()}forEachCall(e){for(var n of this.calls.values())for(var r of n.values())e(r)}getLocalFeeds(){var e=[];return this.localCallFeed&&e.push(this.localCallFeed),this.localScreenshareFeed&&e.push(this.localScreenshareFeed),e}hasLocalParticipant(){var e,n;return(e=(n=this.participants.get(this.room.getMember(this.client.getUserId())))===null||n===void 0?void 0:n.has(this.client.getDeviceId()))!==null&&e!==void 0?e:!1}callExpected(e){var n,r=k2(e),i=r===null?null:this.room.getMember(r),s=e.getOpponentDeviceId();return i!==null&&s!==void 0&&((n=this.participants.get(i))===null||n===void 0?void 0:n.get(s))!==void 0}initLocalCallFeed(){var e=this;return B(function*(){if(e.useLivekit){M.info("Livekit group call: not starting local call feed.");return}if(e.state!==sr.LocalCallFeedUninitialized)throw new Error('Cannot initialize local call feed in the "'.concat(e.state,'" state.'));if(e.state=sr.InitializingLocalCallFeed,e.initCallFeedPromise)return e.initCallFeedPromise;try{e.initCallFeedPromise=e.initLocalCallFeedInternal(),yield e.initCallFeedPromise}finally{e.initCallFeedPromise=void 0}})()}initLocalCallFeedInternal(){var e=this;return B(function*(){M.log("GroupCall ".concat(e.groupCallId," initLocalCallFeedInternal() running"));var n;try{n=yield e.client.getMediaHandler().getUserMediaStream(!0,e.type===eT.Video)}catch(i){if(e.allowCallWithoutVideoAndAudio)n=new MediaStream;else throw e.state=sr.LocalCallFeedUninitialized,i}if(e._state!==sr.InitializingLocalCallFeed)throw e.client.getMediaHandler().stopUserMediaStream(n),new Error("Group call disposed while gathering media stream");var r=new iu({client:e.client,roomId:e.room.roomId,userId:e.client.getUserId(),deviceId:e.client.getDeviceId(),stream:n,purpose:xn.Usermedia,audioMuted:e.initWithAudioMuted||n.getAudioTracks().length===0||e.isPtt,videoMuted:e.initWithVideoMuted||n.getVideoTracks().length===0});Nr(n.getAudioTracks(),!r.isAudioMuted()),Nr(n.getVideoTracks(),!r.isVideoMuted()),e.localCallFeed=r,e.addUserMediaFeed(r),e.state=sr.LocalCallFeedInitialized})()}updateLocalUsermediaStream(e){var n=this;return B(function*(){if(n.localCallFeed){var r=n.localCallFeed.stream;n.localCallFeed.setNewStream(e);var i=n.localCallFeed.isAudioMuted(),s=n.localCallFeed.isVideoMuted();M.log("GroupCall ".concat(n.groupCallId," updateLocalUsermediaStream() (oldStreamId=").concat(r.id,", newStreamId=").concat(e.id,", micShouldBeMuted=").concat(i,", vidShouldBeMuted=").concat(s,")")),Nr(e.getAudioTracks(),!i),Nr(e.getVideoTracks(),!s),n.client.getMediaHandler().stopUserMediaStream(r)}})()}enter(){var e=this;return B(function*(){if(e.state===sr.LocalCallFeedUninitialized)yield e.initLocalCallFeed();else if(e.state!==sr.LocalCallFeedInitialized)throw new Error('Cannot enter call in the "'.concat(e.state,'" state'));M.log("GroupCall ".concat(e.groupCallId," enter() running")),e.state=sr.Entered,e.client.on(cA.Incoming,e.onIncomingCall);for(var n of e.client.callEventHandler.calls.values())e.onIncomingCall(n);e.useLivekit||(e.retryCallLoopInterval=setInterval(e.onRetryCallLoop,e.retryCallInterval),e.activeSpeaker=void 0,e.onActiveSpeakerLoop(),e.activeSpeakerLoopInterval=setInterval(e.onActiveSpeakerLoop,e.activeSpeakerInterval))})()}dispose(){var e;this.localCallFeed&&(this.removeUserMediaFeed(this.localCallFeed),this.localCallFeed=void 0),this.localScreenshareFeed&&(this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0),this.client.getMediaHandler().stopAllStreams(),this.transmitTimer!==null&&(clearTimeout(this.transmitTimer),this.transmitTimer=null),this.retryCallLoopInterval!==void 0&&(clearInterval(this.retryCallLoopInterval),this.retryCallLoopInterval=void 0),this.participantsExpirationTimer!==null&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state===sr.Entered&&(this.forEachCall(n=>n.hangup(ft.UserHangup,!1)),this.activeSpeaker=void 0,clearInterval(this.activeSpeakerLoopInterval),this.retryCallCounts.clear(),clearInterval(this.retryCallLoopInterval),this.client.removeListener(cA.Incoming,this.onIncomingCall),(e=this.stats)===null||e===void 0||e.stop())}leave(){this.dispose(),this.state=sr.LocalCallFeedUninitialized}terminate(){var e=arguments,n=this;return B(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:!0;if(n.dispose(),n.room.off(pt.Update,n.onRoomState),n.client.groupCallEventHandler.groupCalls.delete(n.room.roomId),n.client.emit(lA.Ended,n),n.state=sr.Ended,r){var i=n.room.currentState.getStateEvents(Z.GroupCallPrefix,n.groupCallId);yield n.client.sendStateEvent(n.room.roomId,Z.GroupCallPrefix,I2(I2({},i.getContent()),{},{"m.terminated":p1e.CallEnded}),n.groupCallId)}})()}isLocalVideoMuted(){return this.localCallFeed?this.localCallFeed.isVideoMuted():!0}isMicrophoneMuted(){return this.localCallFeed?this.localCallFeed.isAudioMuted():!0}setMicrophoneMuted(e){var n=this;return B(function*(){if(!e&&!(yield n.client.getMediaHandler().hasAudioDevice()))return!1;var r=!e&&n.isPtt;n.isPtt&&(!e&&n.isMicrophoneMuted()?n.transmitTimer=setTimeout(()=>{n.setMicrophoneMuted(!0)},n.pttMaxTransmitTime):e&&!n.isMicrophoneMuted()&&(n.transmitTimer!==null&&clearTimeout(n.transmitTimer),n.transmitTimer=null)),n.forEachCall(o=>{var a;return(a=o.localUsermediaFeed)===null||a===void 0?void 0:a.setAudioVideoMuted(e,null)});var i=function(){var o=B(function*(){var a=[];n.forEachCall(c=>a.push(c.sendMetadataUpdate())),yield Promise.all(a).catch(c=>M.info("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() failed to send some metadata updates"),c))});return function(){return o.apply(this,arguments)}}();if(r&&(yield i()),n.localCallFeed){M.log("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() (streamId=").concat(n.localCallFeed.stream.id,", muted=").concat(e,")"));var s=yield n.checkAudioPermissionIfNecessary(e);if(!s)return!1;n.localCallFeed.setAudioVideoMuted(e,null),Nr(n.localCallFeed.stream.getAudioTracks(),!e)}else M.log("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() no stream muted (muted=").concat(e,")")),n.initWithAudioMuted=e;return n.forEachCall(o=>Nr(o.localUsermediaFeed.stream.getAudioTracks(),!e&&n.callExpected(o))),n.emit(kn.LocalMuteStateChanged,e,n.isLocalVideoMuted()),r||(yield i()),!0})()}checkAudioPermissionIfNecessary(e){var n=this;return B(function*(){try{if(!e&&n.localCallFeed&&!n.localCallFeed.hasAudioTrack){var r=yield n.client.getMediaHandler().getUserMediaStream(!0,!n.localCallFeed.isVideoMuted());if(r?.getTracks().length===0)return M.log("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() no device to receive local stream, muted=").concat(e)),!1}}catch{return M.log("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() no device or permission to receive local stream, muted=").concat(e)),!1}return!0})()}setLocalVideoMuted(e){var n=this;return B(function*(){if(!e&&!(yield n.client.getMediaHandler().hasVideoDevice()))return!1;if(n.localCallFeed){M.log("GroupCall ".concat(n.groupCallId," setLocalVideoMuted() (stream=").concat(n.localCallFeed.stream.id,", muted=").concat(e,")"));try{var r=yield n.client.getMediaHandler().getUserMediaStream(!0,!e);yield n.updateLocalUsermediaStream(r),n.localCallFeed.setAudioVideoMuted(null,e),Nr(n.localCallFeed.stream.getVideoTracks(),!e)}catch{return M.log("GroupCall ".concat(n.groupCallId," setLocalVideoMuted() no device or permission to receive local stream, muted=").concat(e)),!1}}else M.log("GroupCall ".concat(n.groupCallId," setLocalVideoMuted() no stream muted (muted=").concat(e,")")),n.initWithVideoMuted=e;var i=[];return n.forEachCall(s=>i.push(s.setLocalVideoMuted(e))),yield Promise.all(i),n.forEachCall(s=>Nr(s.localUsermediaFeed.stream.getVideoTracks(),!e&&n.callExpected(s))),n.emit(kn.LocalMuteStateChanged,n.isMicrophoneMuted(),e),!0})()}setScreensharingEnabled(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:{};if(e===r.isScreensharing())return e;if(e)try{M.log("GroupCall ".concat(r.groupCallId," setScreensharingEnabled() is asking for screensharing permissions"));var s=yield r.client.getMediaHandler().getScreensharingStream(i),o=function*(l){var d=()=>{r.setScreensharingEnabled(!1),l.removeEventListener("ended",d)};l.addEventListener("ended",d)};for(var a of s.getTracks())yield*o(a);return M.log("GroupCall ".concat(r.groupCallId," setScreensharingEnabled() granted screensharing permissions. Setting screensharing enabled on all calls")),r.localDesktopCapturerSourceId=i.desktopCapturerSourceId,r.localScreenshareFeed=new iu({client:r.client,roomId:r.room.roomId,userId:r.client.getUserId(),deviceId:r.client.getDeviceId(),stream:s,purpose:xn.Screenshare,audioMuted:!1,videoMuted:!1}),r.addScreenshareFeed(r.localScreenshareFeed),r.emit(kn.LocalScreenshareStateChanged,!0,r.localScreenshareFeed,r.localDesktopCapturerSourceId),r.forEachCall(c=>c.pushLocalFeed(r.localScreenshareFeed.clone())),!0}catch(c){if(i.throwOnFail)throw c;return M.error("GroupCall ".concat(r.groupCallId," setScreensharingEnabled() enabling screensharing error"),c),r.emit(kn.Error,new uA(Iy.NoUserMedia,"Failed to get screen-sharing stream: ",c)),!1}else return r.forEachCall(c=>{c.localScreensharingFeed&&c.removeLocalFeed(c.localScreensharingFeed)}),r.client.getMediaHandler().stopScreensharingStream(r.localScreenshareFeed.stream),r.removeScreenshareFeed(r.localScreenshareFeed),r.localScreenshareFeed=void 0,r.localDesktopCapturerSourceId=void 0,r.emit(kn.LocalScreenshareStateChanged,!1,void 0,void 0),!1})()}isScreensharing(){return!!this.localScreenshareFeed}wantsOutgoingCall(e,n){var r=this.client.getUserId(),i=this.client.getDeviceId();return e>=r&&(e!==r||n>i)}placeOutgoingCalls(){var e=this,n=!1,r=function(a){var c,l=(c=e.calls.get(a))!==null&&c!==void 0?c:new Map,d=function(y){var v=l.get(y);if(v?.getOpponentSessionId()!==m.sessionId&&e.wantsOutgoingCall(a,y)){n=!0,v!==void 0&&(M.debug("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() replacing call (userId=").concat(a,", deviceId=").concat(y,", callId=").concat(v.callId,")")),v.hangup(ft.NewSession,!1));var w=fb(e.client,e.room.roomId,{invitee:a,opponentDeviceId:y,opponentSessionId:m.sessionId,groupCallId:e.groupCallId});w===null?(M.error("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() failed to create call (userId=").concat(a,", device=").concat(y,")")),l.delete(y)):(e.initCall(w),l.set(y,w),M.debug("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() placing call (userId=").concat(a,", deviceId=").concat(y,", sessionId=").concat(m.sessionId,")")),w.placeCallWithCallFeeds(e.getLocalFeeds().map(S=>S.clone()),m.screensharing).then(()=>{e.dataChannelsEnabled&&w.createDataChannel("datachannel",e.dataChannelOptions)}).catch(S=>{M.warn("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() failed to place call (userId=").concat(a,")"),S),S instanceof Gl&&S.code===Iy.UnknownDevice?e.emit(kn.Error,S):e.emit(kn.Error,new uA(Iy.PlaceCallFailed,"Failed to place call to ".concat(a))),w.hangup(ft.SignallingFailed,!1),l.get(y)===w&&l.delete(y)}))}};for(var[h,m]of s)d(h);l.size>0?e.calls.set(a,l):e.calls.delete(a)};for(var[{userId:i},s]of this.participants)r(i);n&&this.emit(kn.CallsChanged,this.calls)}getMemberStateEvents(e){return e===void 0?this.room.currentState.getStateEvents(Z.GroupCallMemberPrefix):this.room.currentState.getStateEvents(Z.GroupCallMemberPrefix,e)}initCall(e){var n=k2(e);if(!n)throw new Error("Cannot init call without user id");var r=()=>this.onCallFeedsChanged(e),i=(c,l)=>this.onCallStateChanged(e,c,l),s=this.onCallHangup,o=c=>this.onCallReplaced(e,c),a=this.callHandlers.get(n);a===void 0&&(a=new Map,this.callHandlers.set(n,a)),a.set(e.getOpponentDeviceId(),{onCallFeedsChanged:r,onCallStateChanged:i,onCallHangup:s,onCallReplaced:o}),e.on(gt.FeedsChanged,r),e.on(gt.State,i),e.on(gt.Hangup,s),e.on(gt.Replaced,o),e.isPtt=this.isPtt,this.reEmitter.reEmit(e,Object.values(gt)),e.initStats(this.getGroupCallStats()),r()}disposeCall(e,n){var r=k2(e),i=e.getOpponentDeviceId();if(!r)throw new Error("Cannot dispose call without user id");var s=this.callHandlers.get(r),{onCallFeedsChanged:o,onCallStateChanged:a,onCallHangup:c,onCallReplaced:l}=s.get(i);if(e.removeListener(gt.FeedsChanged,o),e.removeListener(gt.State,a),e.removeListener(gt.Hangup,c),e.removeListener(gt.Replaced,l),s.delete(r),s.size===0&&this.callHandlers.delete(r),e.hangupReason!==ft.Replaced){var d=this.getUserMediaFeed(r,i);d&&this.removeUserMediaFeed(d);var h=this.getScreenshareFeed(r,i);h&&this.removeScreenshareFeed(h)}}getUserMediaFeed(e,n){return this.userMediaFeeds.find(r=>r.userId===e&&r.deviceId===n)}addUserMediaFeed(e){this.userMediaFeeds.push(e),e.measureVolumeActivity(!0),this.emit(kn.UserMediaFeedsChanged,this.userMediaFeeds)}replaceUserMediaFeed(e,n){var r=this.userMediaFeeds.findIndex(i=>i.userId===e.userId&&i.deviceId===e.deviceId);if(r===-1)throw new Error("Couldn't find user media feed to replace");this.userMediaFeeds.splice(r,1,n),e.dispose(),n.measureVolumeActivity(!0),this.emit(kn.UserMediaFeedsChanged,this.userMediaFeeds)}removeUserMediaFeed(e){var n=this.userMediaFeeds.findIndex(r=>r.userId===e.userId&&r.deviceId===e.deviceId);if(n===-1)throw new Error("Couldn't find user media feed to remove");this.userMediaFeeds.splice(n,1),e.dispose(),this.emit(kn.UserMediaFeedsChanged,this.userMediaFeeds),this.activeSpeaker===e&&(this.activeSpeaker=this.userMediaFeeds[0],this.emit(kn.ActiveSpeakerChanged,this.activeSpeaker))}getScreenshareFeed(e,n){return this.screenshareFeeds.find(r=>r.userId===e&&r.deviceId===n)}addScreenshareFeed(e){this.screenshareFeeds.push(e),this.emit(kn.ScreenshareFeedsChanged,this.screenshareFeeds)}replaceScreenshareFeed(e,n){var r=this.screenshareFeeds.findIndex(i=>i.userId===e.userId&&i.deviceId===e.deviceId);if(r===-1)throw new Error("Couldn't find screenshare feed to replace");this.screenshareFeeds.splice(r,1,n),e.dispose(),this.emit(kn.ScreenshareFeedsChanged,this.screenshareFeeds)}removeScreenshareFeed(e){var n=this.screenshareFeeds.findIndex(r=>r.userId===e.userId&&r.deviceId===e.deviceId);if(n===-1)throw new Error("Couldn't find screenshare feed to remove");this.screenshareFeeds.splice(n,1),e.dispose(),this.emit(kn.ScreenshareFeedsChanged,this.screenshareFeeds)}updateParticipants(){var e=this.room.getMember(this.client.getSafeUserId());if(!e){M.warn("GroupCall ".concat(this.groupCallId," updateParticipants() tried to update participants before local room member is available"));return}if(this.participantsExpirationTimer!==null&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state===sr.Ended){this.participants=new Map;return}var n=new Map,r=Date.now(),i=this.state===sr.Entered||this.enteredViaAnotherSession,s=1/0;for(var o of this.getMemberStateEvents()){var a=this.room.getMember(o.getStateKey()),c=o.getContent(),l=Array.isArray(c["m.calls"])?c["m.calls"]:[],d=l.find(w=>w["m.call_id"]===this.groupCallId),h=Array.isArray(d?.["m.devices"])?d["m.devices"]:[],m=h.filter(w=>typeof w.device_id=="string"&&typeof w.session_id=="string"&&typeof w.expires_ts=="number"&&w.expires_ts>r&&Array.isArray(w.feeds));if(!i&&a?.userId===this.client.getUserId()&&(m=m.filter(w=>w.device_id!==this.client.getDeviceId())),m.length>0&&a?.membership===Be.Join){var g=new Map;n.set(a,g);for(var y of m)g.set(y.device_id,{sessionId:y.session_id,screensharing:y.feeds.some(w=>w.purpose===xn.Screenshare)}),y.expires_ts<s&&(s=y.expires_ts)}}if(i){var v=n.get(e);v===void 0&&(v=new Map,n.set(e,v)),v.has(this.client.getDeviceId())||v.set(this.client.getDeviceId(),{sessionId:this.client.getSessionId(),screensharing:this.getLocalFeeds().some(w=>w.purpose===xn.Screenshare)})}this.participants=n,s<1/0&&(this.participantsExpirationTimer=setTimeout(()=>this.updateParticipants(),s-r))}updateDevices(e){var n=arguments,r=this;return B(function*(){var i,s=n.length>1&&n[1]!==void 0?n[1]:!1,o=Date.now(),a=r.client.getUserId(),c=r.getMemberStateEvents(a),l=(i=c?.getContent())!==null&&i!==void 0?i:{},d=Array.isArray(l["m.calls"])?l["m.calls"]:[],h=null,m=[];for(var g of d)g["m.call_id"]===r.groupCallId?h=g:m.push(g);h===null&&(h={});var y=Array.isArray(h["m.devices"])?h["m.devices"]:[],v=y.filter(x=>typeof x.device_id=="string"&&typeof x.session_id=="string"&&typeof x.expires_ts=="number"&&x.expires_ts>o&&Array.isArray(x.feeds)),w=e(v);if(w!==null){var S=[...m];w.length>0&&S.push(I2(I2({},h),{},{"m.call_id":r.groupCallId,"m.devices":w}));var R={"m.calls":S};yield r.client.sendStateEvent(r.room.roomId,Z.GroupCallMemberPrefix,R,a,{keepAlive:s})}})()}addDeviceToMemberState(){var e=this;return B(function*(){yield e.updateDevices(n=>[...n.filter(r=>r.device_id!==e.client.getDeviceId()),{device_id:e.client.getDeviceId(),session_id:e.client.getSessionId(),expires_ts:Date.now()+L$,feeds:e.getLocalFeeds().map(r=>({purpose:r.purpose}))}])})()}updateMemberState(){var e=this;return B(function*(){e.resendMemberStateTimer!==null&&(clearInterval(e.resendMemberStateTimer),e.resendMemberStateTimer=null),e.state===sr.Entered?(yield e.addDeviceToMemberState(),e.resendMemberStateTimer=setInterval(B(function*(){M.log("GroupCall ".concat(e.groupCallId,' updateMemberState() resending call member state"'));try{yield e.addDeviceToMemberState()}catch(n){M.error("GroupCall ".concat(e.groupCallId," updateMemberState() failed to resend call member state"),n)}}),L$*3/4)):yield e.updateDevices(n=>n.filter(r=>r.device_id!==e.client.getDeviceId()),!0)})()}cleanMemberState(){var e=this;return B(function*(){var{devices:n}=yield e.client.getDevices(),r=new Map(n.map(i=>[i.device_id,i]));yield e.updateDevices(i=>{var s=i.filter(o=>{var a=r.get(o.device_id);return a?.last_seen_ts!==void 0&&!(o.device_id===e.client.getDeviceId()&&e.state!==sr.Entered&&!e.enteredViaAnotherSession)});return s.length===i.length?null:s})})()}getGroupCallStats(){if(this.stats===void 0){var e=this.client.getUserId()||"unknown";this.stats=new h1e(this.groupCallId,e,this.statsCollectIntervalTime),this.stats.reports.on(pu.CONNECTION_STATS,this.onConnectionStats),this.stats.reports.on(pu.BYTE_SENT_STATS,this.onByteSentStats),this.stats.reports.on(pu.SUMMARY_STATS,this.onSummaryStats),this.stats.reports.on(pu.CALL_FEED_REPORT,this.onCallFeedReport)}return this.stats}setGroupCallStatsInterval(e){this.statsCollectIntervalTime=e,this.stats!==void 0&&(this.stats.stop(),this.stats.setInterval(e),e>0&&this.stats.start())}}function O$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function x2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?O$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var at=function(t){return t.Fledgling="fledgling",t.InviteSent="invite_sent",t.WaitLocalMedia="wait_local_media",t.CreateOffer="create_offer",t.CreateAnswer="create_answer",t.Connecting="connecting",t.Connected="connected",t.Ringing="ringing",t.Ended="ended",t}({}),M$=function(t){return t.Voice="voice",t.Video="video",t}({}),xd=function(t){return t.Inbound="inbound",t.Outbound="outbound",t}({}),pr=function(t){return t.Local="local",t.Remote="remote",t}({}),gt=function(t){return t.Hangup="hangup",t.State="state",t.Error="error",t.Replaced="replaced",t.LocalHoldUnhold="local_hold_unhold",t.RemoteHoldUnhold="remote_hold_unhold",t.HoldUnhold="hold_unhold",t.FeedsChanged="feeds_changed",t.AssertedIdentityChanged="asserted_identity_changed",t.LengthChanged="length_changed",t.DataChannel="datachannel",t.SendVoipEvent="send_voip_event",t.PeerConnectionCreated="peer_connection_created",t}({}),ft=function(t){return t.UserHangup="user_hangup",t.LocalOfferFailed="local_offer_failed",t.NoUserMedia="no_user_media",t.UnknownDevices="unknown_devices",t.SendInvite="send_invite",t.CreateAnswer="create_answer",t.CreateOffer="create_offer",t.SendAnswer="send_answer",t.SetRemoteDescription="set_remote_description",t.SetLocalDescription="set_local_description",t.AnsweredElsewhere="answered_elsewhere",t.IceFailed="ice_failed",t.InviteTimeout="invite_timeout",t.Replaced="replaced",t.SignallingFailed="signalling_timeout",t.UserBusy="user_busy",t.Transferred="transferred",t.NewSession="new_session",t}({}),m1e="1",g1e="stun:turn.matrix.org",Pk=60*1e3,v1e=1e3,y1e=30*1e3,b1e=2*1e3;class Gl extends Error{constructor(e,n,r){super(n+": "+r),L(this,"code",void 0),this.code=e}}function Th(){return Date.now().toString()+To(16)}function D$(t){var e=[{mediaType:"audio",codec:"opus",enableDtx:!0,maxAverageBitrate:t?12e3:void 0}];return e}function Ua(t,e){return t+":"+e}class _1e extends On{constructor(e){var n,r;if(super(),n=this,L(this,"roomId",void 0),L(this,"callId",void 0),L(this,"invitee",void 0),L(this,"hangupParty",void 0),L(this,"hangupReason",void 0),L(this,"direction",void 0),L(this,"ourPartyId",void 0),L(this,"peerConn",void 0),L(this,"toDeviceSeq",0),L(this,"isPtt",!1),L(this,"_state",at.Fledgling),L(this,"client",void 0),L(this,"forceTURN",void 0),L(this,"turnServers",void 0),L(this,"candidateSendQueue",[]),L(this,"candidateSendTries",0),L(this,"candidatesEnded",!1),L(this,"feeds",[]),L(this,"transceivers",new Map),L(this,"inviteOrAnswerSent",!1),L(this,"waitForLocalAVStream",!1),L(this,"successor",void 0),L(this,"opponentMember",void 0),L(this,"opponentVersion",void 0),L(this,"opponentPartyId",void 0),L(this,"opponentCaps",void 0),L(this,"iceDisconnectedTimeout",void 0),L(this,"iceReconnectionTimeOut",void 0),L(this,"inviteTimeout",void 0),L(this,"removeTrackListeners",new Map),L(this,"remoteOnHold",!1),L(this,"callStatsAtEnd",void 0),L(this,"makingOffer",!1),L(this,"ignoreOffer",!1),L(this,"isSettingRemoteAnswerPending",!1),L(this,"responsePromiseChain",void 0),L(this,"remoteCandidateBuffer",new Map),L(this,"remoteAssertedIdentity",void 0),L(this,"remoteSDPStreamMetadata",void 0),L(this,"callLengthInterval",void 0),L(this,"callStartTime",void 0),L(this,"opponentDeviceId",void 0),L(this,"hasOpponentDeviceInfo",void 0),L(this,"opponentSessionId",void 0),L(this,"groupCallId",void 0),L(this,"stopVideoTrackTimer",void 0),L(this,"isOnlyDataChannelAllowed",void 0),L(this,"stats",void 0),L(this,"gotLocalIceCandidate",s=>{if(s.candidate){if(this.candidatesEnded&&M.warn("Call ".concat(this.callId," gotLocalIceCandidate() got candidate after candidates have ended!")),M.debug("Call ".concat(this.callId," got local ICE ").concat(s.candidate.sdpMid," ").concat(s.candidate.candidate)),this.callHasEnded())return;s.candidate.candidate===""?this.queueCandidate(null):this.queueCandidate(s.candidate)}}),L(this,"onIceGatheringStateChange",s=>{var o;M.debug("Call ".concat(this.callId," onIceGatheringStateChange() ice gathering state changed to ").concat(this.peerConn.iceGatheringState)),((o=this.peerConn)===null||o===void 0?void 0:o.iceGatheringState)==="complete"&&(this.queueCandidate(null),M.debug("Call ".concat(this.callId," onIceGatheringStateChange() ice gathering state complete, set candidates have ended")))}),L(this,"getLocalOfferFailed",s=>{M.error("Call ".concat(this.callId," getLocalOfferFailed() running"),s),this.emit(gt.Error,new Gl(ft.LocalOfferFailed,"Failed to get local offer!",s),this),this.terminate(pr.Local,ft.LocalOfferFailed,!1)}),L(this,"getUserMediaFailed",s=>{if(this.successor){this.successor.getUserMediaFailed(s);return}M.warn("Call ".concat(this.callId," getUserMediaFailed() failed to get user media - ending call"),s),this.emit(gt.Error,new Gl(ft.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",s),this),this.terminate(pr.Local,ft.NoUserMedia,!1)}),L(this,"placeCallFailed",s=>{if(this.successor){this.successor.placeCallFailed(s);return}M.warn("Call ".concat(this.callId," placeCallWithCallFeeds() failed - ending call"),s),this.emit(gt.Error,new Gl(ft.IceFailed,"Couldn't start call! Invalid ICE server configuration.",s),this),this.terminate(pr.Local,ft.IceFailed,!1)}),L(this,"onIceConnectionStateChanged",()=>{var s,o,a,c,l,d;if(!this.callHasEnded()){if(M.debug("Call ".concat(this.callId," onIceConnectionStateChanged() running (state=").concat((s=this.peerConn)===null||s===void 0?void 0:s.iceConnectionState,", conn=").concat((o=this.peerConn)===null||o===void 0?void 0:o.connectionState,")")),["connected","completed"].includes((a=(c=this.peerConn)===null||c===void 0?void 0:c.iceConnectionState)!==null&&a!==void 0?a:""))clearTimeout(this.iceDisconnectedTimeout),this.iceDisconnectedTimeout=void 0,this.iceReconnectionTimeOut&&clearTimeout(this.iceReconnectionTimeOut),this.state=at.Connected,!this.callLengthInterval&&!this.callStartTime&&(this.callStartTime=Date.now(),this.callLengthInterval=setInterval(()=>{this.emit(gt.LengthChanged,Math.round((Date.now()-this.callStartTime)/1e3),this)},v1e));else if(((l=this.peerConn)===null||l===void 0?void 0:l.iceConnectionState)=="failed"){var h;if(this.candidatesEnded=!1,(h=this.peerConn)!==null&&h!==void 0&&h.restartIce){var m;this.candidatesEnded=!1,M.debug("Call ".concat(this.callId," onIceConnectionStateChanged() ice restart (state=").concat((m=this.peerConn)===null||m===void 0?void 0:m.iceConnectionState,")")),this.peerConn.restartIce()}else M.info("Call ".concat(this.callId," onIceConnectionStateChanged() hanging up call (ICE failed and no ICE restart method)")),this.hangup(ft.IceFailed,!1)}else((d=this.peerConn)===null||d===void 0?void 0:d.iceConnectionState)=="disconnected"&&(this.candidatesEnded=!1,this.iceReconnectionTimeOut=setTimeout(()=>{var y,v,w;M.info("Call ".concat(this.callId," onIceConnectionStateChanged() ICE restarting because of ICE disconnected, (state=").concat((y=this.peerConn)===null||y===void 0?void 0:y.iceConnectionState,", conn=").concat((v=this.peerConn)===null||v===void 0?void 0:v.connectionState,")")),(w=this.peerConn)!==null&&w!==void 0&&w.restartIce&&(this.candidatesEnded=!1,this.peerConn.restartIce()),this.iceReconnectionTimeOut=void 0},b1e),this.iceDisconnectedTimeout=setTimeout(()=>{M.info("Call ".concat(this.callId," onIceConnectionStateChanged() hanging up call (ICE disconnected for too long)")),this.hangup(ft.IceFailed,!1)},y1e),this.state=at.Connecting);if(this.isPtt&&["failed","disconnected"].includes(this.peerConn.iceConnectionState))for(var g of this.getRemoteFeeds())g.setAudioVideoMuted(!0,!0)}}),L(this,"onSignallingStateChanged",()=>{var s;M.debug("Call ".concat(this.callId," onSignallingStateChanged() running (state=").concat((s=this.peerConn)===null||s===void 0?void 0:s.signalingState,")"))}),L(this,"onTrack",s=>{if(s.streams.length===0){M.warn("Call ".concat(this.callId," onTrack() called with streamless track streamless (kind=").concat(s.track.kind,")"));return}var o=s.streams[0];if(this.pushRemoteFeed(o),!this.removeTrackListeners.has(o)){var a=()=>{o.getTracks().length===0&&(M.info("Call ".concat(this.callId," onTrack() removing track (streamId=").concat(o.id,")")),this.deleteFeedByStream(o),o.removeEventListener("removetrack",a),this.removeTrackListeners.delete(o))};o.addEventListener("removetrack",a),this.removeTrackListeners.set(o,a)}}),L(this,"onDataChannel",s=>{this.emit(gt.DataChannel,s.channel,this)}),L(this,"onNegotiationNeeded",B(function*(){if(M.info("Call ".concat(n.callId," onNegotiationNeeded() negotiation is needed!")),n.state!==at.CreateOffer&&n.opponentVersion===0){M.info("Call ".concat(n.callId," onNegotiationNeeded() opponent does not support renegotiation: ignoring negotiationneeded event"));return}n.queueGotLocalOffer()})),L(this,"onHangupReceived",s=>{M.debug("Call ".concat(this.callId," onHangupReceived() running")),this.partyIdMatches(s)||this.state===at.Ringing?this.terminate(pr.Remote,s.reason||ft.UserHangup,!0):M.info("Call ".concat(this.callId," onHangupReceived() ignoring message from party ID ").concat(s.party_id,": our partner is ").concat(this.opponentPartyId))}),L(this,"onRejectReceived",s=>{M.debug("Call ".concat(this.callId," onRejectReceived() running"));var o=[at.InviteSent,at.Ringing].includes(this.state)||this.state===at.Fledgling&&this.direction===xd.Inbound;o?this.terminate(pr.Remote,s.reason||ft.UserHangup,!0):M.debug("Call ".concat(this.callId," onRejectReceived() called in wrong state (state=").concat(this.state,")"))}),L(this,"onAnsweredElsewhere",s=>{M.debug("Call ".concat(this.callId," onAnsweredElsewhere() running")),this.terminate(pr.Remote,ft.AnsweredElsewhere,!0)}),this.roomId=e.roomId,this.invitee=e.invitee,this.client=e.client,!this.client.deviceId)throw new Error("Client must have a device ID to start calls");this.forceTURN=(r=e.forceTURN)!==null&&r!==void 0?r:!1,this.ourPartyId=this.client.deviceId,this.opponentDeviceId=e.opponentDeviceId,this.opponentSessionId=e.opponentSessionId,this.groupCallId=e.groupCallId,this.turnServers=e.turnServers||[],this.turnServers.length===0&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:[g1e]});for(var i of this.turnServers)$X(i,["urls"]);this.callId=Th(),this.isOnlyDataChannelAllowed=this.client.isVoipWithNoMediaAllowed}placeVoiceCall(){var e=this;return B(function*(){yield e.placeCall(!0,!1)})()}placeVideoCall(){var e=this;return B(function*(){yield e.placeCall(!0,!0)})()}createDataChannel(e,n){var r=this.peerConn.createDataChannel(e,n);return this.emit(gt.DataChannel,r,this),r}getOpponentMember(){return this.opponentMember}getOpponentDeviceId(){return this.opponentDeviceId}getOpponentSessionId(){return this.opponentSessionId}opponentCanBeTransferred(){return!!(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}opponentSupportsDTMF(){return!!(this.opponentCaps&&this.opponentCaps["m.call.dtmf"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}get state(){return this._state}set state(e){var n=this._state;this._state=e,this.emit(gt.State,e,n,this)}get type(){return this.hasUserMediaVideoSender||this.hasRemoteUserMediaVideoTrack?M$.Video:M$.Voice}get hasLocalUserMediaVideoTrack(){var e;return!!((e=this.localUsermediaStream)!==null&&e!==void 0&&e.getVideoTracks().length)}get hasRemoteUserMediaVideoTrack(){return this.getRemoteFeeds().some(e=>{var n;return e.purpose===xn.Usermedia&&((n=e.stream)===null||n===void 0?void 0:n.getVideoTracks().length)})}get hasLocalUserMediaAudioTrack(){var e;return!!((e=this.localUsermediaStream)!==null&&e!==void 0&&e.getAudioTracks().length)}get hasRemoteUserMediaAudioTrack(){return this.getRemoteFeeds().some(e=>{var n;return e.purpose===xn.Usermedia&&!!((n=e.stream)!==null&&n!==void 0&&n.getAudioTracks().length)})}get hasUserMediaAudioSender(){var e;return!!(!((e=this.transceivers.get(Ua(xn.Usermedia,"audio")))===null||e===void 0)&&e.sender)}get hasUserMediaVideoSender(){var e;return!!(!((e=this.transceivers.get(Ua(xn.Usermedia,"video")))===null||e===void 0)&&e.sender)}get localUsermediaFeed(){return this.getLocalFeeds().find(e=>e.purpose===xn.Usermedia)}get localScreensharingFeed(){return this.getLocalFeeds().find(e=>e.purpose===xn.Screenshare)}get localUsermediaStream(){var e;return(e=this.localUsermediaFeed)===null||e===void 0?void 0:e.stream}get localScreensharingStream(){var e;return(e=this.localScreensharingFeed)===null||e===void 0?void 0:e.stream}get remoteUsermediaFeed(){return this.getRemoteFeeds().find(e=>e.purpose===xn.Usermedia)}get remoteScreensharingFeed(){return this.getRemoteFeeds().find(e=>e.purpose===xn.Screenshare)}get remoteUsermediaStream(){var e;return(e=this.remoteUsermediaFeed)===null||e===void 0?void 0:e.stream}get remoteScreensharingStream(){var e;return(e=this.remoteScreensharingFeed)===null||e===void 0?void 0:e.stream}getFeedByStreamId(e){return this.getFeeds().find(n=>n.stream.id===e)}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter(e=>e.isLocal())}getRemoteFeeds(){return this.feeds.filter(e=>!e.isLocal())}initOpponentCrypto(){var e=this;return B(function*(){var n;if(e.opponentDeviceId&&e.client.getUseE2eForGroupCall()){if(!e.client.getCrypto()){e.hasOpponentDeviceInfo=!0;return}var r=e.invitee||((n=e.getOpponentMember())===null||n===void 0?void 0:n.userId);throw r?(e.hasOpponentDeviceInfo=!1,new qJ(r)):new Error("Couldn't find opponent user ID to init crypto")}})()}getLocalSDPStreamMetadata(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n={};for(var r of this.getLocalFeeds())e&&(r.sdpMetadataStreamId=r.stream.id),n[r.sdpMetadataStreamId]={purpose:r.purpose,audio_muted:r.isAudioMuted(),video_muted:r.isVideoMuted()};return n}noIncomingFeeds(){return!this.feeds.some(e=>!e.isLocal())}pushRemoteFeed(e){if(!this.opponentSupportsSDPStreamMetadata()){this.pushRemoteFeedWithoutMetadata(e);return}var n=this.getOpponentMember().userId,r=this.remoteSDPStreamMetadata[e.id].purpose,i=this.remoteSDPStreamMetadata[e.id].audio_muted,s=this.remoteSDPStreamMetadata[e.id].video_muted;if(!r){M.warn("Call ".concat(this.callId," pushRemoteFeed() ignoring stream because we didn't get any metadata about it (streamId=").concat(e.id,")"));return}if(this.getFeedByStreamId(e.id)){M.warn("Call ".concat(this.callId," pushRemoteFeed() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")"));return}this.feeds.push(new iu({client:this.client,call:this,roomId:this.roomId,userId:n,deviceId:this.getOpponentDeviceId(),stream:e,purpose:r,audioMuted:i,videoMuted:s})),this.emit(gt.FeedsChanged,this.feeds,this),M.info("Call ".concat(this.callId," pushRemoteFeed() pushed stream (streamId=").concat(e.id,", active=").concat(e.active,", purpose=").concat(r,")"))}pushRemoteFeedWithoutMetadata(e){var n,r=this.getOpponentMember().userId,i=xn.Usermedia,s=(n=this.feeds.find(o=>!o.isLocal()))===null||n===void 0?void 0:n.stream;if(s&&e.id!==s.id){M.warn("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() ignoring new stream because we already have stream (streamId=").concat(e.id,")"));return}if(this.getFeedByStreamId(e.id)){M.warn("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")"));return}this.feeds.push(new iu({client:this.client,call:this,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:r,deviceId:this.getOpponentDeviceId(),stream:e,purpose:i})),this.emit(gt.FeedsChanged,this.feeds,this),M.info("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() pushed stream (streamId=").concat(e.id,", active=").concat(e.active,")"))}pushNewLocalFeed(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=this.client.getUserId();if(Nr(e.getAudioTracks(),!0),Nr(e.getVideoTracks(),!0),this.getFeedByStreamId(e.id)){M.warn("Call ".concat(this.callId," pushNewLocalFeed() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")"));return}this.pushLocalFeed(new iu({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:i,deviceId:this.getOpponentDeviceId(),stream:e,purpose:n}),r)}pushLocalFeed(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(this.feeds.some(o=>e.stream.id===o.stream.id)){M.info("Call ".concat(this.callId," pushLocalFeed() ignoring duplicate local stream (streamId=").concat(e.stream.id,")"));return}if(this.feeds.push(e),r){var i=function(){M.info("Call ".concat(n.callId," pushLocalFeed() adding track to peer connection (id=").concat(s.id,", kind=").concat(s.kind,", streamId=").concat(e.stream.id,", streamPurpose=").concat(e.purpose,", enabled=").concat(s.enabled,")"));var a=Ua(e.purpose,s.kind);if(n.transceivers.has(a)){var c=n.transceivers.get(a);c.sender.replaceTrack(s),c.direction=c.direction==="inactive"?"sendonly":"sendrecv"}else{var l=n.peerConn.addTrack(s,e.stream),d=n.peerConn.getTransceivers().find(h=>h.sender===l);d?n.transceivers.set(a,d):M.warn("Call ".concat(n.callId," pushLocalFeed() didn't find a matching transceiver after adding track!"))}};for(var s of e.stream.getTracks())i()}M.info("Call ".concat(this.callId," pushLocalFeed() pushed stream (id=").concat(e.stream.id,", active=").concat(e.stream.active,", purpose=").concat(e.purpose,")")),this.emit(gt.FeedsChanged,this.feeds,this)}removeLocalFeed(e){var n=Ua(e.purpose,"audio"),r=Ua(e.purpose,"video");for(var i of[n,r])if(this.transceivers.has(i)){var s=this.transceivers.get(i);s.sender&&this.peerConn.removeTrack(s.sender)}e.purpose===xn.Screenshare&&this.client.getMediaHandler().stopScreensharingStream(e.stream),this.deleteFeed(e)}deleteAllFeeds(){for(var e of this.feeds)(!e.isLocal()||!this.groupCallId)&&e.dispose();this.feeds=[],this.emit(gt.FeedsChanged,this.feeds,this)}deleteFeedByStream(e){var n=this.getFeedByStreamId(e.id);if(!n){M.warn("Call ".concat(this.callId," deleteFeedByStream() didn't find the feed to delete (streamId=").concat(e.id,")"));return}this.deleteFeed(n)}deleteFeed(e){e.dispose(),this.feeds.splice(this.feeds.indexOf(e),1),this.emit(gt.FeedsChanged,this.feeds,this)}getCurrentCallStats(){var e=this;return B(function*(){return e.callHasEnded()?e.callStatsAtEnd:e.collectCallStats()})()}collectCallStats(){var e=this;return B(function*(){if(e.peerConn){var n=yield e.peerConn.getStats(),r=[];return n.forEach(i=>{r.push(i)}),r}})()}initWithInvite(e){var n=this;return B(function*(){var r,i=e.getContent();n.direction=xd.Inbound;var s=yield n.client.checkTurnServers();s||M.warn("Call ".concat(n.callId," initWithInvite() failed to get TURN credentials! Proceeding with call anyway..."));var o=i[_d];o?n.updateRemoteSDPStreamMetadata(o):M.debug("Call ".concat(n.callId," initWithInvite() did not get any SDPStreamMetadata! Can not send/receive multiple streams")),n.peerConn=n.createPeerConnection(),n.emit(gt.PeerConnectionCreated,n.peerConn,n),n.chooseOpponent(e),yield n.initOpponentCrypto();try{yield n.peerConn.setRemoteDescription(i.offer),M.debug("Call ".concat(n.callId," initWithInvite() set remote description: ").concat(i.offer.type)),yield n.addBufferedIceCandidates()}catch(d){M.debug("Call ".concat(n.callId," initWithInvite() failed to set remote description"),d),n.terminate(pr.Local,ft.SetRemoteDescription,!1);return}var a=(r=n.feeds.find(d=>!d.isLocal()))===null||r===void 0?void 0:r.stream;if(!n.isOnlyDataChannelAllowed&&(!a||a.getTracks().length===0)){M.error("Call ".concat(n.callId," initWithInvite() no remote stream or no tracks after setting remote description!")),n.terminate(pr.Local,ft.SetRemoteDescription,!1);return}if(n.state=at.Ringing,e.getLocalAge()){var c=setTimeout(()=>{if(n.state==at.Ringing){var d;M.debug("Call ".concat(n.callId," initWithInvite() invite has expired. Hanging up.")),n.hangupParty=pr.Remote,n.state=at.Ended,n.stopAllMedia(),n.peerConn.signalingState!="closed"&&n.peerConn.close(),(d=n.stats)===null||d===void 0||d.removeStatsReportGatherer(n.callId),n.emit(gt.Hangup,n)}},i.lifetime-e.getLocalAge()),l=d=>{d!==at.Ringing&&(clearTimeout(c),n.off(gt.State,l))};n.on(gt.State,l)}})()}initWithHangup(e){this.state=at.Ended}shouldAnswerWithMediaType(e,n,r){return e&&!n?(M.warn("Call ".concat(this.callId," shouldAnswerWithMediaType() unable to answer with ").concat(r," because the other side isn't sending it either.")),!1):!VX(e)&&e!==n&&!this.opponentSupportsSDPStreamMetadata()?(M.warn("Call ".concat(this.callId," shouldAnswerWithMediaType() unable to answer with ").concat(r,"=").concat(e," because the other side doesn't support it. Answering with ").concat(r,"=").concat(n,".")),n):e??n}answer(e,n){var r=this;return B(function*(){if(!r.inviteOrAnswerSent){if(e===!1&&n===!1)throw new Error("You CANNOT answer a call without media");if(!r.localUsermediaStream&&!r.waitForLocalAVStream){var i=r.state,s=r.shouldAnswerWithMediaType(e,r.hasRemoteUserMediaAudioTrack,"audio"),o=r.shouldAnswerWithMediaType(n,r.hasRemoteUserMediaVideoTrack,"video");r.state=at.WaitLocalMedia,r.waitForLocalAVStream=!0;try{var a,c=yield r.client.getMediaHandler().getUserMediaStream(s,o);r.waitForLocalAVStream=!1;var l=new iu({client:r.client,roomId:r.roomId,userId:r.client.getUserId(),deviceId:(a=r.client.getDeviceId())!==null&&a!==void 0?a:void 0,stream:c,purpose:xn.Usermedia,audioMuted:!1,videoMuted:!1}),d=[l];r.localScreensharingFeed&&d.push(r.localScreensharingFeed),r.answerWithCallFeeds(d)}catch(h){if(o)M.warn("Call ".concat(r.callId," answer() failed to getUserMedia(), trying to getUserMedia() without video")),r.state=i,r.waitForLocalAVStream=!1,yield r.answer(s,!1);else{r.getUserMediaFailed(h);return}}}else r.waitForLocalAVStream&&(r.state=at.WaitLocalMedia)}})()}answerWithCallFeeds(e){this.inviteOrAnswerSent||this.queueGotCallFeedsForAnswer(e)}replacedBy(e){M.debug("Call ".concat(this.callId," replacedBy() running (newCallId=").concat(e.callId,")")),this.state===at.WaitLocalMedia?(M.debug("Call ".concat(this.callId," replacedBy() telling new call to wait for local media (newCallId=").concat(e.callId,")")),e.waitForLocalAVStream=!0):[at.CreateOffer,at.InviteSent].includes(this.state)&&(e.direction===xd.Outbound?e.queueGotCallFeedsForAnswer([]):(M.debug("Call ".concat(this.callId," replacedBy() handing local stream to new call(newCallId=").concat(e.callId,")")),e.queueGotCallFeedsForAnswer(this.getLocalFeeds().map(n=>n.clone())))),this.successor=e,this.emit(gt.Replaced,e,this),this.hangup(ft.Replaced,!0)}hangup(e,n){if(!this.callHasEnded()&&(M.debug("Call ".concat(this.callId," hangup() ending call (reason=").concat(e,")")),this.terminate(pr.Local,e,!n),![at.Fledgling,at.WaitLocalMedia].includes(this.state))){var r={};(this.opponentVersion&&this.opponentVersion!==0||e!==ft.UserHangup)&&(r.reason=e),this.sendVoipEvent(Z.CallHangup,r)}}reject(){if(this.state!==at.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(this.opponentVersion===0){M.info("Call ".concat(this.callId," reject() opponent version is less than 1: sending hangup instead of reject (opponentVersion=").concat(this.opponentVersion,")")),this.hangup(ft.UserHangup,!0);return}M.debug("Rejecting call: "+this.callId),this.terminate(pr.Local,ft.UserHangup,!0),this.sendVoipEvent(Z.CallReject,{})}upgradeCall(e,n){var r=this;return B(function*(){if(!(!e&&!n)&&r.opponentSupportsSDPStreamMetadata())try{M.debug("Call ".concat(r.callId," upgradeCall() upgrading call (audio=").concat(e,", video=").concat(n,")"));var i=e||r.hasLocalUserMediaAudioTrack,s=n||r.hasLocalUserMediaVideoTrack,o=yield r.client.getMediaHandler().getUserMediaStream(i,s,!1);yield r.updateLocalUsermediaStream(o,e,n)}catch(a){M.error("Call ".concat(r.callId," upgradeCall() failed to upgrade the call"),a),r.emit(gt.Error,new Gl(ft.NoUserMedia,"Failed to get camera access: ",a),r)}})()}opponentSupportsSDPStreamMetadata(){return!!this.remoteSDPStreamMetadata}isScreensharing(){return!!this.localScreensharingStream}setScreensharingEnabled(e,n){var r=this;return B(function*(){if(e&&r.isScreensharing())return M.warn("Call ".concat(r.callId," setScreensharingEnabled() there is already a screensharing stream - there is nothing to do!")),!0;if(!e&&!r.isScreensharing())return M.warn("Call ".concat(r.callId," setScreensharingEnabled() there already isn't a screensharing stream - there is nothing to do!")),!1;if(!r.opponentSupportsSDPStreamMetadata())return r.setScreensharingEnabledWithoutMetadataSupport(e,n);if(M.debug("Call ".concat(r.callId," setScreensharingEnabled() running (enabled=").concat(e,")")),e)try{var i=yield r.client.getMediaHandler().getScreensharingStream(n);return i?(r.pushNewLocalFeed(i,xn.Screenshare),!0):!1}catch(c){return M.error("Call ".concat(r.callId," setScreensharingEnabled() failed to get screen-sharing stream:"),c),!1}else{var s=r.transceivers.get(Ua(xn.Screenshare,"audio")),o=r.transceivers.get(Ua(xn.Screenshare,"video"));for(var a of[s,o])a&&a.sender&&r.peerConn.removeTrack(a.sender);return r.client.getMediaHandler().stopScreensharingStream(r.localScreensharingStream),r.deleteFeedByStream(r.localScreensharingStream),!1}})()}setScreensharingEnabledWithoutMetadataSupport(e,n){var r=this;return B(function*(){if(M.debug("Call ".concat(r.callId," setScreensharingEnabledWithoutMetadataSupport() running (enabled=").concat(e,")")),e)try{var i,s=yield r.client.getMediaHandler().getScreensharingStream(n);if(!s)return!1;var o=s.getTracks().find(m=>m.kind==="video"),a=(i=r.transceivers.get(Ua(xn.Usermedia,"video")))===null||i===void 0?void 0:i.sender;return a?.replaceTrack(o??null),r.pushNewLocalFeed(s,xn.Screenshare,!1),!0}catch(m){return M.error("Call ".concat(r.callId," setScreensharingEnabledWithoutMetadataSupport() failed to get screen-sharing stream:"),m),!1}else{var c,l,d=(c=r.localUsermediaStream)===null||c===void 0?void 0:c.getTracks().find(m=>m.kind==="video"),h=(l=r.transceivers.get(Ua(xn.Usermedia,"video")))===null||l===void 0?void 0:l.sender;return h?.replaceTrack(d??null),r.client.getMediaHandler().stopScreensharingStream(r.localScreensharingStream),r.deleteFeedByStream(r.localScreensharingStream),!1}})()}updateLocalUsermediaStream(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!1,s=n.length>2&&n[2]!==void 0?n[2]:!1,o=r.localUsermediaFeed,a=i||!o.isAudioMuted()&&!r.remoteOnHold,c=s||!o.isVideoMuted()&&!r.remoteOnHold;M.log("Call ".concat(r.callId," updateLocalUsermediaStream() running (streamId=").concat(e.id,", audio=").concat(a,", video=").concat(c,")")),Nr(e.getAudioTracks(),a),Nr(e.getVideoTracks(),c);for(var l of r.localUsermediaStream.getTracks())r.localUsermediaStream.removeTrack(l),l.stop();for(var d of e.getTracks())r.localUsermediaStream.addTrack(d);var h=function*(){var y=Ua(xn.Usermedia,m.kind),v=r.transceivers.get(y),w=v?.sender,S=!1;if(w)try{M.info("Call ".concat(r.callId," updateLocalUsermediaStream() replacing track (id=").concat(m.id,", kind=").concat(m.kind,", streamId=").concat(e.id,", streamPurpose=").concat(o.purpose,")")),yield w.replaceTrack(m),v.direction=v.direction==="inactive"?"sendonly":"sendrecv",S=!0}catch(T){M.warn("Call ".concat(r.callId," updateLocalUsermediaStream() replaceTrack failed: adding new transceiver instead"),T)}if(!S){M.info("Call ".concat(r.callId," updateLocalUsermediaStream() adding track to peer connection (id=").concat(m.id,", kind=").concat(m.kind,", streamId=").concat(e.id,", streamPurpose=").concat(o.purpose,")"));var R=r.peerConn.addTrack(m,r.localUsermediaStream),x=r.peerConn.getTransceivers().find(T=>T.sender===R);x?r.transceivers.set(y,x):M.warn("Call ".concat(r.callId," updateLocalUsermediaStream() couldn't find matching transceiver for newly added track!"))}};for(var m of e.getTracks())yield*h()})()}setLocalVideoMuted(e){var n=this;return B(function*(){var r;if(M.log("Call ".concat(n.callId," setLocalVideoMuted() running ").concat(e)),!e&&n.stopVideoTrackTimer!==void 0&&(clearTimeout(n.stopVideoTrackTimer),n.stopVideoTrackTimer=void 0),!(yield n.client.getMediaHandler().hasVideoDevice()))return n.isLocalVideoMuted();if(!n.hasUserMediaVideoSender&&!e){var i;return(i=n.localUsermediaFeed)===null||i===void 0||i.setAudioVideoMuted(null,e),yield n.upgradeCall(!1,!0),n.isLocalVideoMuted()}if(!e&&n.localUsermediaStream.getVideoTracks().length===0){var s=yield n.client.getMediaHandler().getUserMediaStream(!0,!0);yield n.updateLocalUsermediaStream(s)}return(r=n.localUsermediaFeed)===null||r===void 0||r.setAudioVideoMuted(null,e),n.updateMuteStatus(),yield n.sendMetadataUpdate(),e&&(n.stopVideoTrackTimer=setTimeout(()=>{for(var o of n.localUsermediaStream.getVideoTracks())o.stop(),n.localUsermediaStream.removeTrack(o)},120)),n.isLocalVideoMuted()})()}isLocalVideoMuted(){var e,n;return(e=(n=this.localUsermediaFeed)===null||n===void 0?void 0:n.isVideoMuted())!==null&&e!==void 0?e:!1}setMicrophoneMuted(e){var n=this;return B(function*(){var r;return M.log("Call ".concat(n.callId," setMicrophoneMuted() running ").concat(e)),(yield n.client.getMediaHandler().hasAudioDevice())?!e&&(!n.hasUserMediaAudioSender||!n.hasLocalUserMediaAudioTrack)?(yield n.upgradeCall(!0,!1),n.isMicrophoneMuted()):((r=n.localUsermediaFeed)===null||r===void 0||r.setAudioVideoMuted(e,null),n.updateMuteStatus(),yield n.sendMetadataUpdate(),n.isMicrophoneMuted()):n.isMicrophoneMuted()})()}isMicrophoneMuted(){var e,n;return(e=(n=this.localUsermediaFeed)===null||n===void 0?void 0:n.isAudioMuted())!==null&&e!==void 0?e:!1}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e;for(var n of this.peerConn.getTransceivers())n.direction=e?"sendonly":"sendrecv";this.updateMuteStatus(),this.sendMetadataUpdate(),this.emit(gt.RemoteHoldUnhold,this.remoteOnHold,this)}}isLocalOnHold(){if(this.state!==at.Connected)return!1;var e=!0;for(var n of this.peerConn.getTransceivers()){var r=["inactive","recvonly"].includes(n.currentDirection);r||(e=!1)}return e}sendDtmfDigit(e){for(var n of this.peerConn.getSenders()){var r;if(((r=n.track)===null||r===void 0?void 0:r.kind)==="audio"&&n.dtmf){n.dtmf.insertDTMF(e);return}}throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){var e=this.isMicrophoneMuted()||this.remoteOnHold,n=this.isLocalVideoMuted()||this.remoteOnHold;M.log("Call ".concat(this.callId," updateMuteStatus stream ").concat(this.localUsermediaStream.id," micShouldBeMuted ").concat(e," vidShouldBeMuted ").concat(n)),Nr(this.localUsermediaStream.getAudioTracks(),!e),Nr(this.localUsermediaStream.getVideoTracks(),!n)}sendMetadataUpdate(){var e=this;return B(function*(){yield e.sendVoipEvent(Z.CallSDPStreamMetadataChangedPrefix,{[_d]:e.getLocalSDPStreamMetadata()})})()}gotCallFeedsForInvite(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.successor){this.successor.queueGotCallFeedsForAnswer(e);return}if(this.callHasEnded()){this.stopAllMedia();return}for(var r of e)this.pushLocalFeed(r);n&&this.peerConn.addTransceiver("video",{direction:"recvonly"}),this.state=at.CreateOffer,M.debug("Call ".concat(this.callId," gotUserMediaForInvite() run"))}sendAnswer(){var e=this;return B(function*(){var n={answer:{sdp:e.peerConn.localDescription.sdp,type:e.peerConn.localDescription.type},[_d]:e.getLocalSDPStreamMetadata(!0)};n.capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1};var r=e.discardDuplicateCandidates();M.info("Call ".concat(e.callId," sendAnswer() discarding ").concat(r," candidates that will be sent in answer"));try{yield e.sendVoipEvent(Z.CallAnswer,n),e.inviteOrAnswerSent=!0}catch(o){e.state=at.Ringing,o instanceof tr&&o.event&&e.client.cancelPendingEvent(o.event);var i=ft.SendAnswer,s="Failed to send answer";throw o.name=="UnknownDeviceError"&&(i=ft.UnknownDevices,s="Unknown devices present in the room"),e.emit(gt.Error,new Gl(i,s,o),e),o}e.sendCandidateQueue()})()}queueGotCallFeedsForAnswer(e){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then(()=>this.gotCallFeedsForAnswer(e)):this.responsePromiseChain=this.gotCallFeedsForAnswer(e)}mungeSdp(e,n){var r=sA.parse(e.sdp);r.media.forEach(i=>{var s=new Map,o=new Map;for(var a of i.rtp)s.set(a.payload,a.codec),o.set(a.codec,a.payload);for(var c of n)if(c.mediaType===i.type){if(!o.has(c.codec)){M.info("Call ".concat(this.callId," mungeSdp() ignoring SDP modifications for ").concat(c.codec," as it's not present."));continue}var l=[];c.enableDtx!==void 0&&l.push("usedtx=".concat(c.enableDtx?"1":"0")),c.maxAverageBitrate!==void 0&&l.push("maxaveragebitrate=".concat(c.maxAverageBitrate));var d=!1;for(var h of i.fmtp)s.get(h.payload)===c.codec&&(d=!0,h.config+=";"+l.join(";"));d||i.fmtp.push({payload:o.get(c.codec),config:l.join(";")})}}),e.sdp=sA.write(r)}createOffer(){var e=this;return B(function*(){var n=yield e.peerConn.createOffer();return e.mungeSdp(n,D$(e.isPtt)),n})()}createAnswer(){var e=this;return B(function*(){var n=yield e.peerConn.createAnswer();return e.mungeSdp(n,D$(e.isPtt)),n})()}gotCallFeedsForAnswer(e){var n=this;return B(function*(){if(!n.callHasEnded()){n.waitForLocalAVStream=!1;for(var r of e)n.pushLocalFeed(r);n.state=at.CreateAnswer;var i;try{n.getRidOfRTXCodecs(),i=yield n.createAnswer()}catch(s){M.debug("Call ".concat(n.callId," gotCallFeedsForAnswer() failed to create answer: "),s),n.terminate(pr.Local,ft.CreateAnswer,!0);return}try{if(yield n.peerConn.setLocalDescription(i),n.callHasEnded()||(n.state=at.Connecting,yield new Promise(s=>{setTimeout(s,200)}),n.callHasEnded()))return;n.sendAnswer()}catch(s){M.debug("Call ".concat(n.callId," gotCallFeedsForAnswer() error setting local description!"),s),n.terminate(pr.Local,ft.SetLocalDescription,!0);return}}})()}onRemoteIceCandidatesReceived(e){var n=this;return B(function*(){if(!n.callHasEnded()){var r=e.getContent(),i=r.candidates;if(!i){M.info("Call ".concat(n.callId," onRemoteIceCandidatesReceived() ignoring candidates event with no candidates!"));return}var s=r.version===0?null:r.party_id||null;if(n.opponentPartyId===void 0){if(s){M.info("Call ".concat(n.callId," onRemoteIceCandidatesReceived() buffering ").concat(i.length," candidates until we pick an opponent"));var o=n.remoteCandidateBuffer.get(s)||[];o.push(...i),n.remoteCandidateBuffer.set(s,o)}return}if(!n.partyIdMatches(r)){M.info("Call ".concat(n.callId," onRemoteIceCandidatesReceived() ignoring candidates from party ID ").concat(r.party_id,": we have chosen party ID ").concat(n.opponentPartyId));return}yield n.addIceCandidates(i)}})()}onAnswerReceived(e){var n=this;return B(function*(){var r=e.getContent();if(M.debug("Call ".concat(n.callId," onAnswerReceived() running (hangupParty=").concat(r.party_id,")")),n.callHasEnded()){M.debug("Call ".concat(n.callId," onAnswerReceived() ignoring answer because call has ended"));return}if(n.opponentPartyId!==void 0){M.info("Call ".concat(n.callId," onAnswerReceived() ignoring answer from party ID ").concat(r.party_id,": we already have an answer/reject from ").concat(n.opponentPartyId));return}n.chooseOpponent(e),yield n.addBufferedIceCandidates(),n.state=at.Connecting;var i=r[_d];i?n.updateRemoteSDPStreamMetadata(i):M.warn("Call ".concat(n.callId," onAnswerReceived() did not get any SDPStreamMetadata! Can not send/receive multiple streams"));try{n.isSettingRemoteAnswerPending=!0,yield n.peerConn.setRemoteDescription(r.answer),n.isSettingRemoteAnswerPending=!1,M.debug("Call ".concat(n.callId," onAnswerReceived() set remote description: ").concat(r.answer.type))}catch(s){n.isSettingRemoteAnswerPending=!1,M.debug("Call ".concat(n.callId," onAnswerReceived() failed to set remote description"),s),n.terminate(pr.Local,ft.SetRemoteDescription,!1);return}if(n.opponentPartyId!==null)try{yield n.sendVoipEvent(Z.CallSelectAnswer,{selected_party_id:n.opponentPartyId})}catch(s){M.warn("Call ".concat(n.callId," onAnswerReceived() failed to send select_answer event"),s)}})()}onSelectAnswerReceived(e){var n=this;return B(function*(){if(n.direction!==xd.Inbound){M.warn("Call ".concat(n.callId," onSelectAnswerReceived() got select_answer for an outbound call: ignoring"));return}var r=e.getContent().selected_party_id;if(r==null){M.warn("Call ".concat(n.callId," onSelectAnswerReceived() got nonsensical select_answer with null/undefined selected_party_id: ignoring"));return}r!==n.ourPartyId&&(M.info("Call ".concat(n.callId," onSelectAnswerReceived() got select_answer for party ID ").concat(r,": we are party ID ").concat(n.ourPartyId,".")),yield n.terminate(pr.Remote,ft.AnsweredElsewhere,!0))})()}onNegotiateReceived(e){var n=this;return B(function*(){var r=e.getContent(),i=r.description;if(!i||!i.sdp||!i.type){M.info("Call ".concat(n.callId," onNegotiateReceived() ignoring invalid m.call.negotiate event"));return}var s=n.direction===xd.Inbound,o=!n.makingOffer&&(n.peerConn.signalingState==="stable"||n.isSettingRemoteAnswerPending),a=i.type==="offer"&&!o;if(n.ignoreOffer=!s&&a,n.ignoreOffer){M.info("Call ".concat(n.callId," onNegotiateReceived() ignoring colliding negotiate event because we're impolite"));return}var c=n.isLocalOnHold(),l=r[_d];l?n.updateRemoteSDPStreamMetadata(l):M.warn("Call ".concat(n.callId," onNegotiateReceived() received negotiation event without SDPStreamMetadata!"));try{if(n.isSettingRemoteAnswerPending=i.type=="answer",yield n.peerConn.setRemoteDescription(i),n.isSettingRemoteAnswerPending=!1,M.debug("Call ".concat(n.callId," onNegotiateReceived() set remote description: ").concat(i.type)),i.type==="offer"){var d,h;try{n.getRidOfRTXCodecs(),h=yield n.createAnswer()}catch(g){M.debug("Call ".concat(n.callId," onNegotiateReceived() failed to create answer: "),g),n.terminate(pr.Local,ft.CreateAnswer,!0);return}yield n.peerConn.setLocalDescription(h),M.debug("Call ".concat(n.callId," onNegotiateReceived() create an answer")),n.sendVoipEvent(Z.CallNegotiate,{lifetime:Pk,description:(d=n.peerConn.localDescription)===null||d===void 0?void 0:d.toJSON(),[_d]:n.getLocalSDPStreamMetadata(!0)})}}catch(g){n.isSettingRemoteAnswerPending=!1,M.warn("Call ".concat(n.callId," onNegotiateReceived() failed to complete negotiation"),g)}var m=n.isLocalOnHold();c!==m&&(n.emit(gt.LocalHoldUnhold,m,n),n.emit(gt.HoldUnhold,m))})()}updateRemoteSDPStreamMetadata(e){this.remoteSDPStreamMetadata=qX(this.remoteSDPStreamMetadata||{},e,!0);for(var n of this.getRemoteFeeds()){var r,i=n.stream.id,s=this.remoteSDPStreamMetadata[i];n.setAudioVideoMuted(s?.audio_muted,s?.video_muted),n.purpose=(r=this.remoteSDPStreamMetadata[i])===null||r===void 0?void 0:r.purpose}}onSDPStreamMetadataChangedReceived(e){var n=e.getContent(),r=n[_d];this.updateRemoteSDPStreamMetadata(r)}onAssertedIdentityReceived(e){var n=this;return B(function*(){var r=e.getContent();r.asserted_identity&&(n.remoteAssertedIdentity={id:r.asserted_identity.id,displayName:r.asserted_identity.display_name},n.emit(gt.AssertedIdentityChanged,n))})()}callHasEnded(){return this.state===at.Ended}queueGotLocalOffer(){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then(()=>this.wrappedGotLocalOffer()):this.responsePromiseChain=this.wrappedGotLocalOffer()}wrappedGotLocalOffer(){var e=this;return B(function*(){e.makingOffer=!0;try{yield e.gotLocalOffer()}catch(n){e.getLocalOfferFailed(n);return}finally{e.makingOffer=!1}})()}gotLocalOffer(){var e=this;return B(function*(){if(M.debug("Call ".concat(e.callId," gotLocalOffer() running")),e.callHasEnded()){M.debug("Call ".concat(e.callId,' gotLocalOffer() ignoring newly created offer because the call has ended"'));return}var n;try{e.getRidOfRTXCodecs(),n=yield e.createOffer()}catch(d){M.debug("Call ".concat(e.callId," gotLocalOffer() failed to create offer: "),d),e.terminate(pr.Local,ft.CreateOffer,!0);return}try{yield e.peerConn.setLocalDescription(n)}catch(d){M.debug("Call ".concat(e.callId," gotLocalOffer() error setting local description!"),d),e.terminate(pr.Local,ft.SetLocalDescription,!0);return}if(e.peerConn.iceGatheringState==="gathering"&&(yield new Promise(d=>{setTimeout(d,200)})),!e.callHasEnded()){var r=e.state===at.CreateOffer?Z.CallInvite:Z.CallNegotiate,i={lifetime:Pk};if(r===Z.CallInvite&&e.invitee&&(i.invitee=e.invitee),e.state===at.CreateOffer){var s;i.offer=(s=e.peerConn.localDescription)===null||s===void 0?void 0:s.toJSON()}else{var o;i.description=(o=e.peerConn.localDescription)===null||o===void 0?void 0:o.toJSON()}i.capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1},i[_d]=e.getLocalSDPStreamMetadata(!0);var a=e.discardDuplicateCandidates();M.info("Call ".concat(e.callId," gotLocalOffer() discarding ").concat(a," candidates that will be sent in offer"));try{yield e.sendVoipEvent(r,i)}catch(d){M.error("Call ".concat(e.callId," gotLocalOffer() failed to send invite"),d),d instanceof tr&&d.event&&e.client.cancelPendingEvent(d.event);var c=ft.SignallingFailed,l="Signalling failed";e.state===at.CreateOffer&&(c=ft.SendInvite,l="Failed to send invite"),d.name=="UnknownDeviceError"&&(c=ft.UnknownDevices,l="Unknown devices present in the room"),e.emit(gt.Error,new Gl(c,l,d),e),e.terminate(pr.Local,c,!1);return}e.sendCandidateQueue(),e.state===at.CreateOffer&&(e.inviteOrAnswerSent=!0,e.state=at.InviteSent,e.inviteTimeout=setTimeout(()=>{e.inviteTimeout=void 0,e.state===at.InviteSent&&e.hangup(ft.InviteTimeout,!1)},Pk))}})()}getRidOfRTXCodecs(){if(!(!RTCRtpReceiver.getCapabilities||!RTCRtpSender.getCapabilities)){var e=this.transceivers.get(Ua(xn.Screenshare,"video"));if(!(!e||!e.setCodecPreferences)){var n=RTCRtpReceiver.getCapabilities("video").codecs,r=RTCRtpSender.getCapabilities("video").codecs,i=[];for(var s of[...n,...r])if(s.mimeType!=="video/rtx"){i.push(s);try{e.setCodecPreferences(i)}catch(o){M.info("Working around buggy WebRTC impl: claimed to support codec but threw when setting codec preferences",s,o),i.pop()}}}}}sendVoipEvent(e,n){var r=this;return B(function*(){var i=x2(x2({},n),{},{version:m1e,call_id:r.callId,party_id:r.ourPartyId,conf_id:r.groupCallId});if(r.opponentDeviceId){var s,o=r.toDeviceSeq++,a=x2(x2({},i),{},{device_id:r.client.deviceId,sender_session_id:r.client.getSessionId(),dest_session_id:r.opponentSessionId,seq:o,[X3]:H0e()});r.emit(gt.SendVoipEvent,{type:"toDevice",eventType:e,userId:r.invitee||((s=r.getOpponentMember())===null||s===void 0?void 0:s.userId),opponentDeviceId:r.opponentDeviceId,content:a},r);var c=r.invitee||r.getOpponentMember().userId;if(r.client.getUseE2eForGroupCall()){if(!r.hasOpponentDeviceInfo){M.warn("Call ".concat(r.callId," sendVoipEvent() failed: we do not have opponentDeviceInfo"));return}throw new Error("Unimplemented")}else yield r.client.sendToDevice(e,new Map([[c,new Map([[r.opponentDeviceId,a]])]]))}else{var l;r.emit(gt.SendVoipEvent,{type:"sendEvent",eventType:e,roomId:r.roomId,content:i,userId:r.invitee||((l=r.getOpponentMember())===null||l===void 0?void 0:l.userId)},r),yield r.client.sendEvent(r.roomId,e,i)}})()}queueCandidate(e){if(e?this.candidateSendQueue.push(e):this.candidatesEnded=!0,!(this.state===at.Ringing||!this.inviteOrAnswerSent)){var n=this.direction===xd.Inbound?500:2e3;this.candidateSendTries===0&&setTimeout(()=>{this.sendCandidateQueue()},n)}}discardDuplicateCandidates(){for(var e=0,n=[],r=0;r<this.candidateSendQueue.length;r++){var i=this.candidateSendQueue[r];i.candidate===""?n.push(i):e++}return this.candidateSendQueue=n,e}transfer(e){var n=this;return B(function*(){var r=yield n.client.getProfileInfo(e),i=Th(),s={replacement_id:Th(),target_user:{id:e,display_name:r.displayname,avatar_url:r.avatar_url},create_call:i};yield n.sendVoipEvent(Z.CallReplaces,s),yield n.terminate(pr.Local,ft.Transferred,!0)})()}transferToCall(e){var n=this;return B(function*(){var r,i,s=(r=e.getOpponentMember())===null||r===void 0?void 0:r.userId,o=s?yield n.client.getProfileInfo(s):void 0,a=(i=n.getOpponentMember())===null||i===void 0?void 0:i.userId,c=a?yield n.client.getProfileInfo(a):void 0,l=Th(),d={replacement_id:Th(),target_user:{id:a,display_name:c?.displayname,avatar_url:c?.avatar_url},await_call:l};yield e.sendVoipEvent(Z.CallReplaces,d);var h={replacement_id:Th(),target_user:{id:s,display_name:o?.displayname,avatar_url:o?.avatar_url},create_call:l};yield n.sendVoipEvent(Z.CallReplaces,h),yield n.terminate(pr.Local,ft.Transferred,!0),yield e.terminate(pr.Local,ft.Transferred,!0)})()}terminate(e,n,r){var i=this;return B(function*(){var s;if(!i.callHasEnded()){i.hangupParty=e,i.hangupReason=n,i.state=at.Ended,i.inviteTimeout&&(clearTimeout(i.inviteTimeout),i.inviteTimeout=void 0),i.iceDisconnectedTimeout!==void 0&&(clearTimeout(i.iceDisconnectedTimeout),i.iceDisconnectedTimeout=void 0),i.callLengthInterval&&(clearInterval(i.callLengthInterval),i.callLengthInterval=void 0),i.stopVideoTrackTimer!==void 0&&(clearTimeout(i.stopVideoTrackTimer),i.stopVideoTrackTimer=void 0);for(var[o,a]of i.removeTrackListeners)o.removeEventListener("removetrack",a);i.removeTrackListeners.clear(),i.callStatsAtEnd=yield i.collectCallStats(),i.stopAllMedia(),i.deleteAllFeeds(),i.peerConn&&i.peerConn.signalingState!=="closed"&&i.peerConn.close(),(s=i.stats)===null||s===void 0||s.removeStatsReportGatherer(i.callId),r&&i.emit(gt.Hangup,i),i.client.callEventHandler.calls.delete(i.callId)}})()}stopAllMedia(){M.debug("Call ".concat(this.callId," stopAllMedia() running"));for(var e of this.feeds)if(e.isLocal()&&e.purpose===xn.Usermedia)this.client.getMediaHandler().stopUserMediaStream(e.stream);else if(e.isLocal()&&e.purpose===xn.Screenshare)this.client.getMediaHandler().stopScreensharingStream(e.stream);else if(!e.isLocal()){M.debug("Call ".concat(this.callId," stopAllMedia() stopping stream (streamId=").concat(e.stream.id,")"));for(var n of e.stream.getTracks())n.stop()}}checkForErrorListener(){if(this.listeners(WX.Error).length===0)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}sendCandidateQueue(){var e=this;return B(function*(){if(!(e.candidateSendQueue.length===0||e.callHasEnded())){var n=e.candidateSendQueue;e.candidateSendQueue=[],++e.candidateSendTries;var r={candidates:n.map(a=>a.toJSON())};e.candidatesEnded&&r.candidates.push({candidate:""}),M.debug("Call ".concat(e.callId," sendCandidateQueue() attempting to send ").concat(n.length," candidates"));try{yield e.sendVoipEvent(Z.CallCandidates,r),e.candidateSendTries=0,e.sendCandidateQueue()}catch(a){if(a instanceof tr&&a.event&&e.client.cancelPendingEvent(a.event),e.candidateSendQueue.push(...n),e.candidateSendTries>5){M.debug("Call ".concat(e.callId," sendCandidateQueue() failed to send candidates on attempt ").concat(e.candidateSendTries,". Giving up on this call."),a);var i=ft.SignallingFailed,s="Signalling failed";e.emit(gt.Error,new Gl(i,s,a),e),e.hangup(i,!1);return}var o=500*Math.pow(2,e.candidateSendTries);++e.candidateSendTries,M.debug("Call ".concat(e.callId," sendCandidateQueue() failed to send candidates. Retrying in ").concat(o,"ms"),a),setTimeout(()=>{e.sendCandidateQueue()},o)}}})()}placeCall(e,n){var r=this;return B(function*(){if(!e)throw new Error("You CANNOT start a call without audio");r.state=at.WaitLocalMedia;var i;try{var s,o=yield r.client.getMediaHandler().getUserMediaStream(e,n);Nr(o.getAudioTracks(),!0),Nr(o.getVideoTracks(),!0),i=new iu({client:r.client,roomId:r.roomId,userId:r.client.getUserId(),deviceId:(s=r.client.getDeviceId())!==null&&s!==void 0?s:void 0,stream:o,purpose:xn.Usermedia,audioMuted:!1,videoMuted:!1})}catch(a){r.getUserMediaFailed(a);return}try{yield r.placeCallWithCallFeeds([i])}catch(a){r.placeCallFailed(a);return}})()}placeCallWithCallFeeds(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!1;r.checkForErrorListener(),r.direction=xd.Outbound,yield r.initOpponentCrypto(),r.client.callEventHandler.calls.set(r.callId,r);var s=yield r.client.checkTurnServers();s||M.warn("Call ".concat(r.callId," placeCallWithCallFeeds() failed to get TURN credentials! Proceeding with call anyway...")),r.peerConn=r.createPeerConnection(),r.emit(gt.PeerConnectionCreated,r.peerConn,r),r.gotCallFeedsForInvite(e,i)})()}createPeerConnection(){var e,n=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers.length?this.turnServers:void 0,iceCandidatePoolSize:this.client.iceCandidatePoolSize,bundlePolicy:"max-bundle"});n.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),n.addEventListener("signalingstatechange",this.onSignallingStateChanged),n.addEventListener("icecandidate",this.gotLocalIceCandidate),n.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),n.addEventListener("track",this.onTrack),n.addEventListener("negotiationneeded",this.onNegotiationNeeded),n.addEventListener("datachannel",this.onDataChannel);var r=this.getOpponentMember(),i=r?r.userId:"unknown";return(e=this.stats)===null||e===void 0||e.addStatsReportGatherer(this.callId,i,n),n}partyIdMatches(e){var n=e.version===0?null:e.party_id||null;return n===this.opponentPartyId}chooseOpponent(e){var n,r=e.getContent();if(M.debug("Call ".concat(this.callId," chooseOpponent() running (partyId=").concat(r.party_id,")")),this.opponentVersion=r.version,this.opponentVersion===0?this.opponentPartyId=null:this.opponentPartyId=r.party_id||null,this.opponentCaps=r.capabilities||{},this.opponentMember=(n=this.client.getRoom(this.roomId).getMember(e.getSender()))!==null&&n!==void 0?n:void 0,this.opponentMember){var i;(i=this.stats)===null||i===void 0||i.updateOpponentMember(this.callId,this.opponentMember.userId)}}addBufferedIceCandidates(){var e=this;return B(function*(){var n=e.remoteCandidateBuffer.get(e.opponentPartyId);n&&(M.info("Call ".concat(e.callId," addBufferedIceCandidates() adding ").concat(n.length," buffered candidates for opponent ").concat(e.opponentPartyId)),yield e.addIceCandidates(n)),e.remoteCandidateBuffer.clear()})()}addIceCandidates(e){var n=this;return B(function*(){for(var r of e){(r.sdpMid===null||r.sdpMid===void 0)&&(r.sdpMLineIndex===null||r.sdpMLineIndex===void 0)?M.debug("Call ".concat(n.callId," addIceCandidates() got remote ICE end-of-candidates")):M.debug("Call ".concat(n.callId," addIceCandidates() got remote ICE candidate (sdpMid=").concat(r.sdpMid,", candidate=").concat(r.candidate,")"));try{yield n.peerConn.addIceCandidate(r)}catch(i){n.ignoreOffer?M.debug("Call ".concat(n.callId," addIceCandidates() failed to add remote ICE candidate because ignoring offer"),i):M.info("Call ".concat(n.callId," addIceCandidates() failed to add remote ICE candidate"),i)}}})()}get hasPeerConnection(){return!!this.peerConn}initStats(e){this.stats=e,this.stats.start()}}function Nr(t,e){for(var n of t)n.enabled=e}function dA(){if(typeof window>"u"||typeof document>"u")return!1;try{var t,e,n,r=!!((t=(e=(n=window.RTCPeerConnection)!==null&&n!==void 0?n:window.RTCSessionDescription)!==null&&e!==void 0?e:window.RTCIceCandidate)!==null&&t!==void 0?t:navigator.mediaDevices);if(!r)return M.error("WebRTC is not supported in this browser / environment"),!1}catch(i){return M.error("Exception thrown when trying to access WebRTC",i),!1}return!0}function fb(t,e,n){if(!dA())return null;var r=n?n.forceTURN:!1,i={client:t,roomId:e,invitee:n?.invitee,turnServers:t.getTurnServers(),forceTURN:t.forceTURN||r,opponentDeviceId:n?.opponentDeviceId,opponentSessionId:n?.opponentSessionId,groupCallId:n?.groupCallId},s=new _1e(i);return t.reEmitter.reEmit(s,Object.values(gt)),s}var Zd=function(t){return t.DontNotify="dont_notify",t.Notify="notify",t.Coalesce="coalesce",t}({}),XO=function(t){return t.Highlight="highlight",t.Sound="sound",t}({}),S1e=function(t){return t.ExactEquals="==",t.LessThan="<",t.GreaterThan=">",t.GreaterThanOrEqual=">=",t.LessThanOrEqual="<=",t}({}),E1e="2";function w1e(t){return t==="==2"||t==="2"}var Ur=function(t){return t.EventMatch="event_match",t.EventPropertyIs="event_property_is",t.EventPropertyContains="event_property_contains",t.ContainsDisplayName="contains_display_name",t.RoomMemberCount="room_member_count",t.SenderNotificationPermission="sender_notification_permission",t.CallStarted="call_started",t.CallStartedPrefix="org.matrix.msc3914.call_started",t}({}),wi=function(t){return t.Override="override",t.ContentSpecific="content",t.RoomSpecific="room",t.SenderSpecific="sender",t.Underride="underride",t}({}),Ei=function(t){return t.Master=".m.rule.master",t.IsUserMention=".m.rule.is_user_mention",t.IsRoomMention=".m.rule.is_room_mention",t.ContainsDisplayName=".m.rule.contains_display_name",t.ContainsUserName=".m.rule.contains_user_name",t.AtRoomNotification=".m.rule.roomnotif",t.DM=".m.rule.room_one_to_one",t.EncryptedDM=".m.rule.encrypted_room_one_to_one",t.Message=".m.rule.message",t.EncryptedMessage=".m.rule.encrypted",t.InviteToSelf=".m.rule.invite_for_me",t.MemberEvent=".m.rule.member_event",t.IncomingCall=".m.rule.call",t.SuppressNotices=".m.rule.suppress_notices",t.Tombstone=".m.rule.tombstone",t.PollStart=".m.rule.poll_start",t.PollStartUnstable=".org.matrix.msc3930.rule.poll_start",t.PollEnd=".m.rule.poll_end",t.PollEndUnstable=".org.matrix.msc3930.rule.poll_end",t.PollStartOneToOne=".m.rule.poll_start_one_to_one",t.PollStartOneToOneUnstable=".org.matrix.msc3930.rule.poll_start_one_to_one",t.PollEndOneToOne=".m.rule.poll_end_one_to_one",t.PollEndOneToOneUnstable=".org.matrix.msc3930.rule.poll_end_one_to_one",t}({});function N$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function U$(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?N$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):N$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var j$=[wi.Override,wi.ContentSpecific,wi.RoomSpecific,wi.SenderSpecific,wi.Underride],C1e={".m.rule.is_room_mention":{rule_id:".m.rule.is_room_mention",default:!0,enabled:!0,conditions:[{kind:Ur.EventPropertyIs,key:"content.m\\.mentions.room",value:!0},{kind:Ur.SenderNotificationPermission,key:"room"}],actions:[Zd.Notify,{set_tweak:XO.Highlight}]},".m.rule.reaction":{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:Ur.EventMatch,key:"type",pattern:"m.reaction"}],actions:[Zd.DontNotify]},".org.matrix.msc3786.rule.room.server_acl":{rule_id:".org.matrix.msc3786.rule.room.server_acl",default:!0,enabled:!0,conditions:[{kind:Ur.EventMatch,key:"type",pattern:Z.RoomServerAcl},{kind:Ur.EventMatch,key:"state_key",pattern:""}],actions:[]}},JO=Symbol("UserDefinedRules"),T1e=[Ei.Master,JO,Ei.SuppressNotices,Ei.InviteToSelf,Ei.MemberEvent,Ei.IsUserMention,Ei.ContainsDisplayName,Ei.IsRoomMention,Ei.AtRoomNotification,Ei.Tombstone,".m.rule.reaction",".m.rule.room.server_acl",".org.matrix.msc3786.rule.room.server_acl",".m.rule.suppress_edits"],R1e={".org.matrix.msc3914.rule.room.call":{rule_id:".org.matrix.msc3914.rule.room.call",default:!0,enabled:!0,conditions:[{kind:Ur.EventMatch,key:"type",pattern:"org.matrix.msc3401.call"},{kind:Ur.CallStarted}],actions:[Zd.Notify,{set_tweak:XO.Sound,value:"default"}]}},I1e=[JO,Ei.IncomingCall,".org.matrix.msc3914.rule.room.call",Ei.EncryptedDM,Ei.DM,Ei.Message,Ei.EncryptedMessage];function F$(t,e,n,r,i){var s=n.filter(y=>y.default),o=n.filter(y=>!y.default);function a(y){y===JO?l.push(...o):y in r?(t.warn("Adding default global ".concat(e," push rule ").concat(y)),l.push(r[y])):t.warn("Missing default global ".concat(e," push rule ").concat(y))}var c=0,l=[];for(var d of s){var h=i.indexOf(d.rule_id);if(h===-1){l.push(d);continue}for(;h>c;){var m=i[c];a(m),c+=1}l.push(d),c+=1}for(var g of i.slice(c))a(g);return l}class qa{constructor(e){this.client=e,L(this,"parsedKeys",new Map)}static actionListToActionsObject(e){var n={notify:!1,tweaks:{}};for(var r of e)r===Zd.Notify?n.notify=!0:typeof r=="object"&&(r.value===void 0&&(r.value=!0),n.tweaks[r.set_tweak]=r.value);return n}static rewriteDefaultRules(e,n){var r=JSON.parse(JSON.stringify(n));return r||(r={}),r.global||(r.global={}),r.global.override||(r.global.override=[]),r.global.underride||(r.global.underride=[]),r.global.override=F$(e,wi.Override,r.global.override,C1e,T1e),r.global.underride=F$(e,wi.Underride,r.global.underride,R1e,I1e),r}static getPushRuleGlobRegex(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"i",[i,s]=n?["(?<=^|\\W)","(?=\\W|$)"]:["^","$"],o="".concat(n,"-").concat(r,"-").concat(e);return qa.cachedGlobToRegex[o]||(qa.cachedGlobToRegex[o]=new RegExp(i+"("+HX(e)+")"+s,r)),qa.cachedGlobToRegex[o]}updateCachedPushRuleKeys(e){e||(e={}),e.global||(e.global={}),e.global.override||(e.global.override=[]),e.global.room||(e.global.room=[]),e.global.sender||(e.global.sender=[]),e.global.underride||(e.global.underride=[]);var n=new Set(this.parsedKeys.keys());for(var r of[e.global.override,e.global.room,e.global.sender,e.global.underride])for(var i of r)if(i.conditions)for(var s of i.conditions)s.kind===Ur.EventMatch&&(n.delete(s.key),this.parsedKeys.set(s.key,qa.partsForDottedKey(s.key)));n.forEach(o=>this.parsedKeys.delete(o))}matchingRuleFromKindSet(e,n){for(var r of j$){var i=n[r];if(i){for(var s of i)if(s.enabled){var o=this.templateRuleToRaw(r,s);if(o&&this.ruleMatchesEvent(o,e))return U$(U$({},s),{},{kind:r})}}}return null}templateRuleToRaw(e,n){var r={rule_id:n.rule_id,actions:n.actions,conditions:[]};switch(e){case wi.Underride:case wi.Override:r.conditions=n.conditions;break;case wi.RoomSpecific:if(!n.rule_id)return null;r.conditions.push({kind:Ur.EventMatch,key:"room_id",value:n.rule_id});break;case wi.SenderSpecific:if(!n.rule_id)return null;r.conditions.push({kind:Ur.EventMatch,key:"user_id",value:n.rule_id});break;case wi.ContentSpecific:if(!n.pattern)return null;r.conditions.push({kind:Ur.EventMatch,key:"content.body",pattern:n.pattern});break}return r}eventFulfillsCondition(e,n){switch(e.kind){case Ur.EventMatch:return this.eventFulfillsEventMatchCondition(e,n);case Ur.EventPropertyIs:return this.eventFulfillsEventPropertyIsCondition(e,n);case Ur.EventPropertyContains:return this.eventFulfillsEventPropertyContains(e,n);case Ur.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(e,n);case Ur.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(e,n);case Ur.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(e,n);case Ur.CallStarted:case Ur.CallStartedPrefix:return this.eventFulfillsCallStartedCondition(e,n)}return!1}eventFulfillsSenderNotifPermCondition(e,n){var r=e.key;if(!r)return!1;var i=this.client.getRoom(n.getRoomId());return i!=null&&i.currentState?i.currentState.mayTriggerNotifOfType(r,n.getSender()):!1}eventFulfillsRoomMemberCountCondition(e,n){if(!e.is)return!1;var r=this.client.getRoom(n.getRoomId());if(!r||!r.currentState||!r.currentState.members)return!1;var i=r.currentState.getJoinedMemberCount(),s=e.is.match(/^([=<>]*)(\d*)$/);if(!s)return!1;var o=s[1],a=parseInt(s[2]);if(isNaN(a))return!1;switch(o){case"":case"==":return i==a;case"<":return i<a;case">":return i>a;case"<=":return i<=a;case">=":return i>=a;default:return!1}}eventFulfillsDisplayNameCondition(e,n){var r,i=n.getContent();if(n.isEncrypted()&&n.getClearContent()&&(i=n.getClearContent()),!i||!i.body||typeof i.body!="string")return!1;var s=this.client.getRoom(n.getRoomId()),o=s==null||(r=s.currentState)===null||r===void 0?void 0:r.getMember(this.client.credentials.userId);if(!o)return!1;var a=o.name,c=new RegExp("(^|\\W)"+BX(a)+"(\\W|$)","i");return i.body.search(c)>-1}eventFulfillsEventMatchCondition(e,n){if(!e.key)return!1;var r=this.valueForDottedKey(e.key,n);if(typeof r!="string")return!1;if(e.value)return e.value===r;if(typeof e.pattern!="string")return!1;var i=qa.getPushRuleGlobRegex(e.pattern,e.key==="content.body");return!!r.match(i)}eventFulfillsEventPropertyIsCondition(e,n){return!e.key||e.value===void 0?!1:e.value===this.valueForDottedKey(e.key,n)}eventFulfillsEventPropertyContains(e,n){if(!e.key||e.value===void 0)return!1;var r=this.valueForDottedKey(e.key,n);return Array.isArray(r)?r.includes(e.value):!1}eventFulfillsCallStartedCondition(e,n){return["m.ring","m.prompt"].includes(n.getContent()["m.intent"])&&!("m.terminated"in n.getContent())&&(n.getPrevContent()["m.terminated"]!==n.getContent()["m.terminated"]||ff(n.getPrevContent(),{}))}static partsForDottedKey(e){var n=[],r="",i=!1;for(var s of e){if(i){s==="\\"||s==="."?r+=s:r+="\\"+s,i=!1;continue}s=="."?(n.push(r),r=""):s=="\\"?i=!0:r+=s}return i&&(r+="\\"),n.push(r),n}valueForDottedKey(e,n){var r=this.parsedKeys.get(e);r===void 0&&(r=qa.partsForDottedKey(e),this.parsedKeys.set(e,r));var i,s=r[0],o=0;for(s==="content"?(i=n.getContent(),++o):s==="type"?(i=n.getType(),++o):i=n.event;o<r.length;++o){if(VX(i))return;var a=r[o];i=i[a]}return i}matchingRuleForEventWithRulesets(e,n){return!n||e.getSender()===this.client.getSafeUserId()?null:this.matchingRuleFromKindSet(e,n.global)}pushActionsForEventAndRulesets(e,n){var r=this.matchingRuleForEventWithRulesets(e,n);if(!r)return{};var i=qa.actionListToActionsObject(r.actions);return i.tweaks.highlight===void 0&&(i.tweaks.highlight=r.kind==wi.ContentSpecific),{actions:i,rule:r}}ruleMatchesEvent(e,n){var r;return this.client.supportsIntentionalMentions()&&n.getContent()["m.mentions"]!==void 0&&(e.rule_id===Ei.ContainsUserName||e.rule_id===Ei.ContainsDisplayName||e.rule_id===Ei.AtRoomNotification)?!1:!((r=e.conditions)!==null&&r!==void 0&&r.some(i=>!this.eventFulfillsCondition(i,n)))}actionsForEvent(e){var{actions:n}=this.pushActionsForEventAndRulesets(e,this.client.pushRules);return n||{}}actionsAndRuleForEvent(e){return this.pushActionsForEventAndRulesets(e,this.client.pushRules)}getPushRuleById(e){var n,r=this.getPushRuleAndKindById(e);return(n=r?.rule)!==null&&n!==void 0?n:null}getPushRuleAndKindById(e){for(var n of["global"]){var r;if(((r=this.client.pushRules)===null||r===void 0?void 0:r[n])!==void 0){for(var i of j$)if(this.client.pushRules[n][i]!==void 0){for(var s of this.client.pushRules[n][i])if(s.rule_id===e)return{rule:s,kind:i}}}}return null}}L(qa,"cachedGlobToRegex",{});var hb=["v1.1","v1.2","v1.3","v1.4","v1.5","v1.6","v1.7","v1.8","v1.9"],k1e=hb[0],x1e=hb[hb.length-1],So=function(t){return t.SUCCESS="SUCCESS",t.IGNORE="IGNORE",t.PROMPT="PROMPT",t.FAIL_PROMPT="FAIL_PROMPT",t.FAIL_ERROR="FAIL_ERROR",t}({}),Ia=function(t){return t.Invalid="Invalid homeserver discovery response",t.GenericFailure="Failed to get autodiscovery configuration from server",t.InvalidHsBaseUrl="Invalid base_url for m.homeserver",t.InvalidHomeserver="Homeserver URL does not appear to be a valid Matrix homeserver",t.InvalidIsBaseUrl="Invalid base_url for m.identity_server",t.InvalidIdentityServer="Identity server URL does not appear to be a valid identity server",t.InvalidIs="Invalid identity server discovery response",t.MissingWellknown="No .well-known JSON file found",t.InvalidJson="Invalid JSON",t.UnsupportedHomeserverSpecVersion="The homeserver does not meet the version requirements",t}({});class lt{static fromDiscoveryConfig(e){var n=this;return B(function*(){var r,i={"m.homeserver":{state:lt.FAIL_ERROR,error:lt.ERROR_INVALID,base_url:null},"m.identity_server":{state:lt.PROMPT,error:null,base_url:null}};if(!(e!=null&&e["m.homeserver"]))return M.error("No m.homeserver key in config"),i["m.homeserver"].state=lt.FAIL_PROMPT,i["m.homeserver"].error=lt.ERROR_INVALID,Promise.resolve(i);if(!e["m.homeserver"].base_url)return M.error("No m.homeserver base_url in config"),i["m.homeserver"].state=lt.FAIL_PROMPT,i["m.homeserver"].error=lt.ERROR_INVALID_HS_BASE_URL,Promise.resolve(i);var s=n.sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!s)return M.error("Invalid base_url for m.homeserver"),i["m.homeserver"].error=lt.ERROR_INVALID_HS_BASE_URL,Promise.resolve(i);var o=yield n.fetchWellKnownObject("".concat(s,"/_matrix/client/versions"));if(!o||!Array.isArray((r=o.raw)===null||r===void 0?void 0:r.versions))return M.error("Invalid /versions response"),i["m.homeserver"].error=lt.ERROR_INVALID_HOMESERVER,i["m.homeserver"].base_url=s,Promise.resolve(i);var a=new Set(o.raw.versions),c=!1;for(var l of hb)if(a.has(l)){c=!0;break}if(!c)return M.error("Homeserver does not meet version requirements"),i["m.homeserver"].error=lt.ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION,i["m.homeserver"].base_url=s,Promise.resolve(i);i["m.homeserver"]={state:lt.SUCCESS,error:null,base_url:s};var d="";if(e["m.identity_server"]){var h={"m.homeserver":i["m.homeserver"],"m.identity_server":{state:lt.FAIL_PROMPT,error:lt.ERROR_INVALID_IS,base_url:null}};if(d=n.sanitizeWellKnownUrl(e["m.identity_server"].base_url),!d)return M.error("Invalid base_url for m.identity_server"),h["m.identity_server"].error=lt.ERROR_INVALID_IS_BASE_URL,Promise.resolve(h);var m=yield n.fetchWellKnownObject("".concat(d,"/_matrix/identity/v2"));if(!(m!=null&&m.raw)||m.action!==So.SUCCESS)return M.error("Invalid /v2 response"),h["m.identity_server"].error=lt.ERROR_INVALID_IDENTITY_SERVER,h["m.identity_server"].base_url=d,Promise.resolve(h)}return d&&d.toString().length>0&&(i["m.identity_server"]={state:lt.SUCCESS,error:null,base_url:d}),Object.keys(e).forEach(g=>{if(g==="m.homeserver"||g==="m.identity_server"){var y=["error","state","base_url"];for(var v of Object.keys(e[g]))y.includes(v)||(i[g][v]=e[g][v])}else i[g]=e[g]}),Promise.resolve(i)})()}static findClientConfig(e){var n=this;return B(function*(){if(!e||typeof e!="string"||e.length===0)throw new Error("'domain' must be a string of non-zero length");var r={"m.homeserver":{state:lt.FAIL_ERROR,error:lt.ERROR_INVALID,base_url:null},"m.identity_server":{state:lt.PROMPT,error:null,base_url:null}},i=e.includes("://")?e:"https://".concat(e),s=yield n.fetchWellKnownObject("".concat(i,"/.well-known/matrix/client"));return!s||s.action!==So.SUCCESS?(M.error("No response or error when parsing .well-known"),s.reason&&M.error(s.reason),s.action===So.IGNORE?r["m.homeserver"]={state:lt.PROMPT,error:null,base_url:null}:(r["m.homeserver"].state=lt.FAIL_PROMPT,r["m.homeserver"].error=lt.ERROR_INVALID),Promise.resolve(r)):lt.fromDiscoveryConfig(s.raw)})()}static getRawClientConfig(e){var n=this;return B(function*(){var r;if(!e||typeof e!="string"||e.length===0)throw new Error("'domain' must be a string of non-zero length");var i=yield n.fetchWellKnownObject("https://".concat(e,"/.well-known/matrix/client"));return i?(r=i.raw)!==null&&r!==void 0?r:{}:{}})()}static sanitizeWellKnownUrl(e){if(!e)return!1;try{var n,r;try{r=new URL(e)}catch(a){M.error("Could not parse url",a)}if(!((n=r)!==null&&n!==void 0&&n.hostname)||r.protocol!=="http:"&&r.protocol!=="https:")return!1;var i=r.port?":".concat(r.port):"",s=r.pathname?r.pathname:"",o="".concat(r.protocol,"//").concat(r.hostname).concat(i).concat(s);return o.endsWith("/")&&(o=o.substring(0,o.length-1)),o}catch(a){return M.error(a),!1}}static fetch(e,n){return this.fetchFn?this.fetchFn(e,n):globalThis.fetch(e,n)}static setFetchFn(e){lt.fetchFn=e}static fetchWellKnownObject(e){return B(function*(){var n;try{if(n=yield lt.fetch(e,{method:de.Get,signal:J3(5e3)}),n.status===404)return{raw:{},action:So.IGNORE,reason:lt.ERROR_MISSING_WELLKNOWN};if(n.status!==200)return{raw:{},action:So.FAIL_PROMPT,reason:"General failure"}}catch(o){var r=o,i="";return typeof r=="object"&&(i=r?.message),{error:r,raw:{},action:So.FAIL_PROMPT,reason:i||"General failure"}}try{return{raw:yield n.json(),action:So.SUCCESS}}catch(o){var s=o;return{error:s,raw:{},action:So.FAIL_PROMPT,reason:s?.name==="SyntaxError"?lt.ERROR_INVALID_JSON:lt.ERROR_INVALID}}})()}}L(lt,"ERROR_INVALID",Ia.Invalid);L(lt,"ERROR_GENERIC_FAILURE",Ia.GenericFailure);L(lt,"ERROR_INVALID_HS_BASE_URL",Ia.InvalidHsBaseUrl);L(lt,"ERROR_INVALID_HOMESERVER",Ia.InvalidHomeserver);L(lt,"ERROR_INVALID_IS_BASE_URL",Ia.InvalidIsBaseUrl);L(lt,"ERROR_INVALID_IDENTITY_SERVER",Ia.InvalidIdentityServer);L(lt,"ERROR_INVALID_IS",Ia.InvalidIs);L(lt,"ERROR_MISSING_WELLKNOWN",Ia.MissingWellknown);L(lt,"ERROR_INVALID_JSON",Ia.InvalidJson);L(lt,"ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION",Ia.UnsupportedHomeserverSpecVersion);L(lt,"ALL_ERRORS",Object.keys(Ia));L(lt,"FAIL_ERROR",So.FAIL_ERROR);L(lt,"FAIL_PROMPT",So.FAIL_PROMPT);L(lt,"PROMPT",So.PROMPT);L(lt,"SUCCESS",So.SUCCESS);L(lt,"fetchFn",void 0);var fA=function(t){return t.IS="SERVICE_TYPE_IS",t.IM="SERVICE_TYPE_IM",t}({});class A1e{constructor(e){this.ourEvent=e,L(this,"timeline",void 0),L(this,"ourEventIndex",0),L(this,"paginateTokens",{[ht.Backward]:null,[ht.Forward]:null}),this.timeline=[e]}getEvent(){return this.timeline[this.ourEventIndex]}getTimeline(){return this.timeline}getOurEventIndex(){return this.ourEventIndex}getPaginateToken(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.paginateTokens[e?ht.Backward:ht.Forward]}setPaginateToken(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this.paginateTokens[n?ht.Backward:ht.Forward]=e??null}addEvents(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}class tT{static fromJson(e,n){var r=e.context||{},i=(r.events_before||[]).map(n),s=(r.events_after||[]).map(n),o=new A1e(n(e.result)),a=o.ourEvent.threadRootId;return i=i.filter(c=>c.threadRootId===a),s=s.filter(c=>c.threadRootId===a),o.setPaginateToken(r.start,!0),o.addEvents(i,!0),o.addEvents(s,!1),o.setPaginateToken(r.end,!1),new tT(e.rank,o)}constructor(e,n){this.rank=e,this.context=n}}var GJ=function(t){return t.Public="public",t.Private="private",t}({}),nT=function(t){return t.PrivateChat="private_chat",t.TrustedPrivateChat="trusted_private_chat",t.PublicChat="public_chat",t}({}),ef=function(t){return t.Public="public",t.Invite="invite",t.Private="private",t.Knock="knock",t.Restricted="restricted",t}({}),P1e=function(t){return t.RoomMembership="m.room_membership",t}({}),dC=function(t){return t.CanJoin="can_join",t.Forbidden="forbidden",t}({}),QO=function(t){return t.Invited="invited",t.Joined="joined",t.Shared="shared",t.WorldReadable="world_readable",t}({});function $$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function B$(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function L1e(t,e){var n=!!e.preventReEmit,r=e.decrypt!==!1;function i(s){var o=t.getRoom(s.room_id),a;o&&s.state_key===void 0&&(a=o.findEventById(s.event_id)),!a||a.status?a=new $i(s):(a.setUnsigned(B$(B$({},a.getUnsigned()),s.unsigned)),n=!0);var c=a.getServerAggregatedRelation(vn.Replace);if(c!=null&&c.content){var l=i(c);a.makeReplaced(l)}var d=o?.findThreadForEvent(a);return d&&a.setThread(d),a.isEncrypted()&&(n||t.reEmitter.reEmit(a,[Kt.Decrypted]),r&&t.decryptEventIfNeeded(a)),n||(t.reEmitter.reEmit(a,[Kt.Replaced,Kt.VisibilityChange]),o?.reEmitter.reEmit(a,[Kt.BeforeRedaction])),a}return i}function H$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Sd(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?H$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class V${constructor(e,n,r){this.client=e,this.indexEvent=n,this.directory=r}get id(){var e=this.indexEvent.getStateKey();if(!e)throw new Error("State key not found for branch");return e}get isActive(){return this.indexEvent.getContent().active===!0}get version(){var e;return(e=this.indexEvent.getContent().version)!==null&&e!==void 0?e:1}get roomId(){return this.indexEvent.getRoomId()}delete(){var e=this;return B(function*(){yield e.client.sendStateEvent(e.roomId,ru.name,{},e.id),yield e.client.redactEvent(e.roomId,e.id);var n=(yield e.getVersionHistory())[1];n&&(yield n.delete())})()}getName(){return this.indexEvent.getContent().name||"Unnamed File"}setName(e){var n=this;return B(function*(){yield n.client.sendStateEvent(n.roomId,ru.name,Sd(Sd({},n.indexEvent.getContent()),{},{name:e}),n.id)})()}isLocked(){return this.indexEvent.getContent().locked||!1}setLocked(e){var n=this;return B(function*(){yield n.client.sendStateEvent(n.roomId,ru.name,Sd(Sd({},n.indexEvent.getContent()),{},{locked:e}),n.id)})()}getFileInfo(){var e=this;return B(function*(){var n=yield e.getFileEvent(),r=n.getOriginalContent().file,i=e.client.mxcUrlToHttp(r.url);if(!i)throw new Error("No HTTP URL available for ".concat(r.url));return{info:r,httpUrl:i}})()}getFileEvent(){var e=this;return B(function*(){var n=e.client.getRoom(e.roomId);if(!n)throw new Error("Unknown room");for(var r=n.getUnfilteredTimelineSet().findEventById(e.id);!r&&n.getLiveTimeline().getState(Me.BACKWARDS).paginationToken;)yield e.client.scrollback(n,100),r=n.getUnfilteredTimelineSet().findEventById(e.id);if(!r)throw new Error("Failed to find event");return yield e.client.decryptEventIfNeeded(r),r})()}createNewVersion(e,n,r,i){var s=this;return B(function*(){var o=yield s.directory.createFile(e,n,r,Sd(Sd({},i??{}),{},{"m.new_content":!0,"m.relates_to":{rel_type:vn.Replace,event_id:s.id}}));return yield s.client.sendStateEvent(s.roomId,ru.name,{active:!0,name:e,version:s.version+1},o.event_id),yield s.client.sendStateEvent(s.roomId,ru.name,Sd(Sd({},s.indexEvent.getContent()),{},{active:!1}),s.id),o})()}getVersionHistory(){var e=this;return B(function*(){var n=[];n.push(e);var r=e.client.getRoom(e.roomId);if(!r)throw new Error("Invalid or unknown room");var i=[...r.getLiveTimeline().getEvents()].reverse(),s,o=yield e.getFileEvent();do if(s=i.find(c=>c.replacingEventId()===o.getId()),s){var a=e.directory.getFile(s.getId());if(a)n.push(a),o=s;else break}while(s);return n})()}}function q$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ph(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?q$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var O1e={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:{[Z.RoomPowerLevels]:100,[Z.RoomHistoryVisibility]:100,[Z.RoomTombstone]:100,[Z.RoomEncryption]:100,[Z.RoomName]:50,[Z.RoomMessage]:50,[Z.RoomMessageEncrypted]:50,[Z.Sticker]:50},users:{}},Om=function(t){return t.Viewer="viewer",t.Editor="editor",t.Owner="owner",t}({});class G${constructor(e,n){if(this.client=e,this.roomId=n,L(this,"room",void 0),this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}get id(){return this.roomId}get isTopLevel(){var e=this.room.currentState.getStateEvents(Z.SpaceParent);return e!=null&&e.length?e.every(n=>{var r;return!((r=n.getContent())!==null&&r!==void 0&&r.via)}):!0}setName(e){var n=this;return B(function*(){yield n.client.sendStateEvent(n.roomId,Z.RoomName,{name:e},"")})()}invite(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!0,s=[r.retryInvite(e)];i&&s.push(...r.getDirectories().map(o=>o.invite(e,i))),yield Promise.all(s)})()}retryInvite(e){var n=this;return B(function*(){yield vve(()=>n.client.invite(n.roomId,e),r=>!(r instanceof tr&&r.errcode==="M_FORBIDDEN"))})()}setPermissions(e,n){var r=this;return B(function*(){var i,s=r.room.currentState.getStateEvents(Z.RoomPowerLevels,"");if(Array.isArray(s))throw new Error("Unexpected return type for power levels");var o=s?.getContent()||{},a=o.users_default||0,c=o.events_default||50,l=((i=o.events)===null||i===void 0?void 0:i[Z.RoomPowerLevels])||100,d=o.users||{};switch(n){case Om.Viewer:d[e]=a;break;case Om.Editor:d[e]=c;break;case Om.Owner:d[e]=l;break;default:throw new Error("Invalid role: "+n)}o.users=d,yield r.client.sendStateEvent(r.roomId,Z.RoomPowerLevels,o,"")})()}getPermissions(e){var n,r,i=this.room.currentState.getStateEvents(Z.RoomPowerLevels,"");if(Array.isArray(i))throw new Error("Unexpected return type for power levels");var s=i?.getContent()||{},o=s.users_default||0,a=s.events_default||50,c=((n=s.events)===null||n===void 0?void 0:n[Z.RoomPowerLevels])||100,l=((r=s.users)===null||r===void 0?void 0:r[e])||o;return l>=c?Om.Owner:l>=a?Om.Editor:Om.Viewer}createDirectory(e){var n=this;return B(function*(){var r=yield n.client.unstableCreateFileTree(e);return yield n.client.sendStateEvent(n.roomId,Z.SpaceChild,{via:[n.client.getDomain()]},r.roomId),yield n.client.sendStateEvent(r.roomId,Z.SpaceParent,{via:[n.client.getDomain()]},n.roomId),r})()}getDirectories(){var e=[],n=this.room.currentState.getStateEvents(Z.SpaceChild);for(var r of n)try{var i=r.getStateKey();if(i){var s=this.client.unstableGetFileTreeSpace(i);s&&e.push(s)}}catch(o){M.warn("Unable to create tree space instance for listing. Are we joined?",o)}return e}getDirectory(e){return this.getDirectories().find(n=>n.roomId===e)}delete(){var e=this;return B(function*(){var n=e.getDirectories();for(var r of n)yield r.delete();var i=[Be.Invite,Be.Knock,Be.Join],s=e.room.currentState.getStateEvents(Z.RoomMember);for(var o of s){var a=o.getStateKey()!==e.client.getUserId();if(a&&i.includes(o.getContent().membership)){var c=o.getStateKey();if(!c)throw new Error("State key not found for branch");yield e.client.kick(e.roomId,c,"Room deleted")}}yield e.client.leave(e.roomId)})()}getOrderedChildren(e){var n=e.map(r=>({roomId:r.getStateKey(),order:r.getContent().order})).filter(r=>r.roomId);return n.sort((r,i)=>{if(r.order&&!i.order)return-1;if(!r.order&&i.order)return 1;if(!r.order&&!i.order){var s,o,a,c,l=this.client.getRoom(r.roomId),d=this.client.getRoom(i.roomId);if(!l||!d)return qE(r.roomId,i.roomId);var h=(s=(o=l.currentState.getStateEvents(Z.RoomCreate,""))===null||o===void 0?void 0:o.getTs())!==null&&s!==void 0?s:0,m=(a=(c=d.currentState.getStateEvents(Z.RoomCreate,""))===null||c===void 0?void 0:c.getTs())!==null&&a!==void 0?a:0;return h===m?qE(r.roomId,i.roomId):h-m}else return qE(r.order,i.order)}),n}getParentRoom(){var e=this.room.currentState.getStateEvents(Z.SpaceParent),n=e[0];if(!n)throw new Error("Expected to have a parent in a non-top level space");var r=n.getStateKey();if(!r)throw new Error("No state key found for parent");var i=this.client.getRoom(r);if(!i)throw new Error("Unable to locate room for parent");return i}getOrder(){if(this.isTopLevel)return-1;var e=this.getParentRoom(),n=e.currentState.getStateEvents(Z.SpaceChild),r=this.getOrderedChildren(n);return r.findIndex(i=>i.roomId===this.roomId)}setOrder(e){var n=this;return B(function*(){var r;if(n.isTopLevel)throw new Error("Cannot set order of top level spaces currently");var i=n.getParentRoom(),s=i.currentState.getStateEvents(Z.SpaceChild),o=n.getOrderedChildren(s);e=Math.max(Math.min(e,o.length-1),0);var a=n.getOrder(),c=a<e;c&&e===o.length-1?e--:!c&&e===0&&e++;var l=o[c?e:e-1],d=o[c?e+1:e],h=hf[0],m=!1;if(!l)d!=null&&d.order&&(h=LF(d.order));else if(e===o.length-1)d!=null&&d.order&&(h=h1(d.order));else{var g=l?.order,y=d?.order;g&&y?g===y?h=h1(g):h=yve(g,y):g?h=h1(g):y?h=LF(y):m=!0}if(m){for(var v,w=0;w<=e;w++){var S=o[w];if(w===0&&(v=S.order),S.order)v=S.order;else{var R;v=v?h1(v):hf[0];var x=i.currentState.getStateEvents(Z.SpaceChild,S.roomId),T=(R=x?.getContent())!==null&&R!==void 0?R:{via:[n.client.getDomain()]};yield n.client.sendStateEvent(i.roomId,Z.SpaceChild,ph(ph({},T),{},{order:v}),S.roomId)}}v&&(h=h1(v))}var I=i.currentState.getStateEvents(Z.SpaceChild,n.roomId),k=(r=I?.getContent())!==null&&r!==void 0?r:{via:[n.client.getDomain()]};yield n.client.sendStateEvent(i.roomId,Z.SpaceChild,ph(ph({},k),{},{order:h}),n.roomId)})()}createFile(e,n,r,i){var s=this;return B(function*(){var{content_uri:o}=yield s.client.uploadContent(n,{includeFilename:!1});r.url=o;var a={msgtype:ll.File,body:e,url:o,file:r};i=i??{},i["m.new_content"]&&(i["m.new_content"]=a);var c=yield s.client.sendMessage(s.roomId,ph(ph(ph({},i),a),{},{[YX.name]:{}}));return yield s.client.sendStateEvent(s.roomId,ru.name,{active:!0,name:e},c.event_id),c})()}getFile(e){var n=this.room.currentState.getStateEvents(ru.name,e);return n?new V$(this.client,n,this):null}listFiles(){return this.listAllFiles().filter(e=>e.isActive)}listAllFiles(){var e,n=(e=this.room.currentState.getStateEvents(ru.name))!==null&&e!==void 0?e:[];return n.map(r=>new V$(this.client,r,this))}}var KJ=function(t){return t.Recent="recent",t.Rank="rank",t}({}),Rh=function(t){return t.LocalStreamsChanged="local_streams_changed",t}({});class M1e extends On{constructor(e){super(),this.client=e,L(this,"audioInput",void 0),L(this,"audioSettings",void 0),L(this,"videoInput",void 0),L(this,"localUserMediaStream",void 0),L(this,"userMediaStreams",[]),L(this,"screensharingStreams",[]),L(this,"getMediaStreamPromise",void 0)}restoreMediaSettings(e,n){this.audioInput=e,this.videoInput=n}setAudioInput(e){var n=this;return B(function*(){M.info("MediaHandler setAudioInput() running (deviceId=".concat(e,")")),n.audioInput!==e&&(n.audioInput=e,yield n.updateLocalUsermediaStreams())})()}setAudioSettings(e){var n=this;return B(function*(){M.info("MediaHandler setAudioSettings() running (opts=".concat(JSON.stringify(e),")")),n.audioSettings=Object.assign({},e),yield n.updateLocalUsermediaStreams()})()}setVideoInput(e){var n=this;return B(function*(){M.info("MediaHandler setVideoInput() running (deviceId=".concat(e,")")),n.videoInput!==e&&(n.videoInput=e,yield n.updateLocalUsermediaStreams())})()}setMediaInputs(e,n){var r=this;return B(function*(){M.log("MediaHandler setMediaInputs() running (audioInput: ".concat(e," videoInput: ").concat(n,")")),r.audioInput=e,r.videoInput=n,yield r.updateLocalUsermediaStreams()})()}updateLocalUsermediaStreams(){var e=this;return B(function*(){if(e.userMediaStreams.length!==0){var n=new Map;for(var r of e.client.callEventHandler.calls.values())n.set(r.callId,{audio:r.hasLocalUserMediaAudioTrack,video:r.hasLocalUserMediaVideoTrack});for(var i of e.userMediaStreams){M.log("MediaHandler updateLocalUsermediaStreams() stopping all tracks (streamId=".concat(i.id,")"));for(var s of i.getTracks())s.stop()}e.userMediaStreams=[],e.localUserMediaStream=void 0;for(var o of e.client.callEventHandler.calls.values())if(!(o.callHasEnded()||!n.has(o.callId))){var{audio:a,video:c}=n.get(o.callId);M.log("MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (callId=".concat(o.callId,")"));var l=yield e.getUserMediaStream(a,c);o.callHasEnded()||(yield o.updateLocalUsermediaStream(l))}for(var d of e.client.groupCallEventHandler.groupCalls.values())if(d.localCallFeed){M.log("MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (groupCallId=".concat(d.groupCallId,")"));var h=yield e.getUserMediaStream(!0,d.type===eT.Video);d.state!==sr.Ended&&(yield d.updateLocalUsermediaStream(h))}e.emit(Rh.LocalStreamsChanged)}})()}hasAudioDevice(){return B(function*(){try{var e=yield navigator.mediaDevices.enumerateDevices();return e.filter(n=>n.kind==="audioinput").length>0}catch(n){return M.log("MediaHandler hasAudioDevice() calling navigator.mediaDevices.enumerateDevices with error",n),!1}})()}hasVideoDevice(){return B(function*(){try{var e=yield navigator.mediaDevices.enumerateDevices();return e.filter(n=>n.kind==="videoinput").length>0}catch(n){return M.log("MediaHandler hasVideoDevice() calling navigator.mediaDevices.enumerateDevices with error",n),!1}})()}getUserMediaStream(e,n){var r=arguments,i=this;return B(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:!0;return i.getMediaStreamPromise?i.getMediaStreamPromise=i.getMediaStreamPromise.then(()=>i.getUserMediaStreamInternal(e,n,s)):i.getMediaStreamPromise=i.getUserMediaStreamInternal(e,n,s),i.getMediaStreamPromise})()}getUserMediaStreamInternal(e,n,r){var i=this;return B(function*(){var s=e&&(yield i.hasAudioDevice()),o=n&&(yield i.hasVideoDevice()),a,c=!0;if(i.localUserMediaStream){var l,d;s!==i.localUserMediaStream.getAudioTracks().length>0&&(c=!1),o!==i.localUserMediaStream.getVideoTracks().length>0&&(c=!1),s&&((l=i.localUserMediaStream.getAudioTracks()[0])===null||l===void 0||(l=l.getSettings())===null||l===void 0?void 0:l.deviceId)!==i.audioInput&&(c=!1),o&&((d=i.localUserMediaStream.getVideoTracks()[0])===null||d===void 0||(d=d.getSettings())===null||d===void 0?void 0:d.deviceId)!==i.videoInput&&(c=!1)}else c=!1;if(c){var y;if(a=i.localUserMediaStream.clone(),M.log("MediaHandler getUserMediaStreamInternal() cloning (oldStreamId=".concat((y=i.localUserMediaStream)===null||y===void 0?void 0:y.id," newStreamId=").concat(a.id," shouldRequestAudio=").concat(s," shouldRequestVideo=").concat(o,")")),!s)for(var v of a.getAudioTracks())a.removeTrack(v);if(!o)for(var w of a.getVideoTracks())a.removeTrack(w)}else{var h=i.getUserMediaContraints(s,o);a=yield navigator.mediaDevices.getUserMedia(h),M.log("MediaHandler getUserMediaStreamInternal() calling getUserMediaStream (streamId=".concat(a.id,", shouldRequestAudio=").concat(s,", shouldRequestVideo=").concat(o,", constraints=").concat(JSON.stringify(h),")"));for(var m of a.getTracks()){var g=m.getSettings();m.kind==="audio"?i.audioInput=g.deviceId:m.kind==="video"&&(i.videoInput=g.deviceId)}r&&(i.localUserMediaStream=a)}return r&&i.userMediaStreams.push(a),i.emit(Rh.LocalStreamsChanged),a})()}stopUserMediaStream(e){M.log("MediaHandler stopUserMediaStream() stopping (streamId=".concat(e.id,")"));for(var n of e.getTracks())n.stop();var r=this.userMediaStreams.indexOf(e);if(r!==-1&&(M.debug("MediaHandler stopUserMediaStream() splicing usermedia stream out stream array (streamId=".concat(e.id,")"),e.id),this.userMediaStreams.splice(r,1)),this.emit(Rh.LocalStreamsChanged),this.localUserMediaStream===e)this.localUserMediaStream=void 0;else for(var i of e.getTracks()){var s;if((s=this.localUserMediaStream)!==null&&s!==void 0&&s.getTrackById(i.id)){this.stopUserMediaStream(this.localUserMediaStream);break}}}getScreensharingStream(){var e=arguments,n=this;return B(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{},i=e.length>1&&e[1]!==void 0?e[1]:!0,s;if(n.screensharingStreams.length===0){var o=n.getScreenshareContraints(r);r.desktopCapturerSourceId?(M.debug("MediaHandler getScreensharingStream() calling getUserMedia() (opts=".concat(JSON.stringify(r),")")),s=yield navigator.mediaDevices.getUserMedia(o)):(M.debug("MediaHandler getScreensharingStream() calling getDisplayMedia() (opts=".concat(JSON.stringify(r),")")),s=yield navigator.mediaDevices.getDisplayMedia(o))}else{var a=n.screensharingStreams[n.screensharingStreams.length-1];M.log("MediaHandler getScreensharingStream() cloning (streamId=".concat(a.id,")")),s=a.clone()}return i&&n.screensharingStreams.push(s),n.emit(Rh.LocalStreamsChanged),s})()}stopScreensharingStream(e){M.debug("MediaHandler stopScreensharingStream() stopping stream (streamId=".concat(e.id,")"));for(var n of e.getTracks())n.stop();var r=this.screensharingStreams.indexOf(e);r!==-1&&(M.debug("MediaHandler stopScreensharingStream() splicing stream out (streamId=".concat(e.id,")")),this.screensharingStreams.splice(r,1)),this.emit(Rh.LocalStreamsChanged)}stopAllStreams(){for(var e of this.userMediaStreams){M.log("MediaHandler stopAllStreams() stopping (streamId=".concat(e.id,")"));for(var n of e.getTracks())n.stop()}for(var r of this.screensharingStreams)for(var i of r.getTracks())i.stop();this.userMediaStreams=[],this.screensharingStreams=[],this.localUserMediaStream=void 0,this.emit(Rh.LocalStreamsChanged)}getUserMediaContraints(e,n){var r=!!navigator.webkitGetUserMedia;return{audio:e?{deviceId:this.audioInput?{ideal:this.audioInput}:void 0,autoGainControl:this.audioSettings?{ideal:this.audioSettings.autoGainControl}:void 0,echoCancellation:this.audioSettings?{ideal:this.audioSettings.echoCancellation}:void 0,noiseSuppression:this.audioSettings?{ideal:this.audioSettings.noiseSuppression}:void 0}:!1,video:n?{deviceId:this.videoInput?{ideal:this.videoInput}:void 0,width:r?{exact:640}:{ideal:640},height:r?{exact:360}:{ideal:360}}:!1}}getScreenshareContraints(e){var{desktopCapturerSourceId:n,audio:r}=e;return n?{audio:r??!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n}}}:{audio:r??!1,video:!0}}}var K$=function(t){return t.RequestFinished="FINISHED",t.Complete="COMPLETE",t}({}),h_=function(t){return t.PreProcess="ExtState.PreProcess",t.PostProcess="ExtState.PostProcess",t}({}),hA=function(t){return t.RoomData="SlidingSync.RoomData",t.Lifecycle="SlidingSync.Lifecycle",t}({}),D1e=3;class N1e{constructor(e){this.crypto=e}name(){return"e2ee"}when(){return h_.PreProcess}onRequest(e){var n=this;return B(function*(){return e&&(M.log("ExtensionE2EE: invalidating all device lists due to missing 'pos'"),yield n.crypto.markAllTrackedUsersAsDirty()),{enabled:!0}})()}onResponse(e){var n=this;return B(function*(){e.device_lists&&(yield n.crypto.processDeviceLists(e.device_lists)),yield n.crypto.processKeyCounts(e.device_one_time_keys_count,e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"]),n.crypto.onSyncCompleted({})})()}}class U1e{constructor(e,n){this.client=e,this.cryptoCallbacks=n,L(this,"nextBatch",null)}name(){return"to_device"}when(){return h_.PreProcess}onRequest(e){var n=this;return B(function*(){return{since:n.nextBatch!==null?n.nextBatch:void 0,limit:100,enabled:!0}})()}onResponse(e){var n=this;return B(function*(){var r=e.events||[],i;n.cryptoCallbacks?i=yield n.cryptoCallbacks.preprocessToDeviceMessages(r):i=r.map(s=>({message:s,encryptionInfo:null})),FJ(i,n.client),n.nextBatch=e.next_batch})()}}class j1e{constructor(e){this.client=e}name(){return"account_data"}when(){return h_.PostProcess}onRequest(e){return B(function*(){return{enabled:!0}})()}onResponse(e){var n=this;return B(function*(){e.global&&e.global.length>0&&n.processGlobalAccountData(e.global);for(var r in e.rooms){var i=Tg(n.client,r,e.rooms[r]),s=n.client.getRoom(r);if(!s){M.warn("got account data for room but room doesn't exist on client:",r);continue}s.addAccountData(i),i.forEach(o=>{n.client.emit(Le.Event,o)})}})()}processGlobalAccountData(e){var n=Tg(this.client,void 0,e),r=n.reduce((i,s)=>(i[s.getType()]=this.client.store.getAccountData(s.getType()),i),{});this.client.store.storeAccountDataEvents(n),n.forEach(i=>{if(i.getType()===Z.PushRules){var s=i.getContent();this.client.setPushRules(s)}var o=r[i.getType()];return this.client.emit(Le.AccountData,i,o),i})}}class F1e{constructor(e){this.client=e}name(){return"typing"}when(){return h_.PostProcess}onRequest(e){return B(function*(){return{enabled:!0}})()}onResponse(e){var n=this;return B(function*(){if(e!=null&&e.rooms)for(var r in e.rooms)WJ(n.client,r,[e.rooms[r]])})()}}class $1e{constructor(e){this.client=e}name(){return"receipts"}when(){return h_.PostProcess}onRequest(e){return B(function*(){return{enabled:!0}})()}onResponse(e){var n=this;return B(function*(){if(e!=null&&e.rooms)for(var r in e.rooms)WJ(n.client,r,[e.rooms[r]])})()}}class zJ{constructor(e,n,r,i){this.slidingSync=e,this.client=n,L(this,"opts",void 0),L(this,"syncOpts",void 0),L(this,"syncState",null),L(this,"syncStateData",void 0),L(this,"lastPos",null),L(this,"failCount",0),L(this,"notifEvents",[]),this.opts=NJ(r),this.syncOpts=UJ(i),n.getNotifTimelineSet()&&n.reEmitter.reEmit(n.getNotifTimelineSet(),[ke.Timeline,ke.TimelineReset]),this.slidingSync.on(hA.Lifecycle,this.onLifecycle.bind(this)),this.slidingSync.on(hA.RoomData,this.onRoomData.bind(this));var s=[new U1e(this.client,this.syncOpts.cryptoCallbacks),new j1e(this.client),new F1e(this.client),new $1e(this.client)];this.syncOpts.cryptoCallbacks&&s.push(new N1e(this.syncOpts.cryptoCallbacks)),s.forEach(o=>{this.slidingSync.registerExtension(o)})}onRoomData(e,n){var r=this;return B(function*(){var i=r.client.store.getRoom(e);if(!i){if(!n.initial){r.syncOpts.logger.debug("initial flag not set but no stored room exists for room ",e,n);return}i=jJ(r.client,e,r.opts)}yield r.processRoomData(r.client,i,n)})()}onLifecycle(e,n,r){switch(r&&this.syncOpts.logger.debug("onLifecycle",e,r),e){case K$.Complete:if(this.purgeNotifications(),!n)break;this.lastPos||this.updateSyncState(Gt.Prepared,{oldSyncToken:void 0,nextSyncToken:n.pos,catchingUp:!1,fromCache:!1}),this.updateSyncState(Gt.Syncing,{oldSyncToken:this.lastPos,nextSyncToken:n.pos,catchingUp:!1,fromCache:!1}),this.lastPos=n.pos;break;case K$.RequestFinished:if(r){if(this.failCount+=1,this.updateSyncState(this.failCount>D1e?Gt.Error:Gt.Reconnecting,{error:new tr(r)}),this.shouldAbortSync(new tr(r)))return}else this.failCount=0,this.syncOpts.logger.debug("SlidingSyncState.RequestFinished with ".concat(Object.keys(n?.rooms||[]).length," rooms"));break}}syncLeftRooms(){return B(function*(){return[]})()}peek(e){return B(function*(){return null})()}stopPeeking(){}setPresence(e){}getSyncState(){return this.syncState}getSyncStateData(){var e;return(e=this.syncStateData)!==null&&e!==void 0?e:null}createRoom(e){var{timelineSupport:n}=this.client,r=new Q3(e,this.client,this.client.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:n});return this.client.reEmitter.reEmit(r,[ke.Name,ke.Redaction,ke.RedactionCancelled,ke.Receipt,ke.Tags,ke.LocalEchoUpdated,ke.AccountData,ke.MyMembership,ke.Timeline,ke.TimelineReset]),this.registerStateListeners(r),r}registerStateListeners(e){this.client.reEmitter.reEmit(e.currentState,[pt.Events,pt.Members,pt.NewMember,pt.Update]),e.currentState.on(pt.NewMember,(n,r,i)=>{var s;i.user=(s=this.client.getUser(i.userId))!==null&&s!==void 0?s:void 0,this.client.reEmitter.reEmit(i,[Vs.Name,Vs.Typing,Vs.PowerLevel,Vs.Membership])})}shouldAbortSync(e){return e.errcode==="M_UNKNOWN_TOKEN"?(this.syncOpts.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(Gt.Error,{error:e}),!0):!1}processRoomData(e,n,r){var i=this;return B(function*(){r=B1e(e,n.roomId,r);var s=Tg(i.client,n.roomId,r.required_state),o=Tg(i.client,n.roomId,r.timeline,!1),a=[];if(r.limited||r.initial){var c=new Set;n.getLiveTimeline().getEvents().forEach(R=>{c.add(R.getId())});for(var l=[],d=[],h=!1,m=o.length-1;m>=0;m--){var g=o[m];if(c.has(g.getId())){h=!0;continue}h?l.push(g):d.unshift(g)}o=d,l.length>0&&n.addEventsToTimeline(l,!0,!1,n.getLiveTimeline(),r.prev_batch)}var y=n.hasEncryptionStateEvent();if(r.notification_count!=null&&n.setUnreadNotificationCount(Jt.Total,r.notification_count),r.highlight_count!=null&&(!y||y&&n.getUnreadNotificationCount(Jt.Highlight)<=0)&&n.setUnreadNotificationCount(Jt.Highlight,r.highlight_count),r.bump_stamp&&n.setBumpStamp(r.bump_stamp),Number.isInteger(r.invited_count)&&n.currentState.setInvitedMemberCount(r.invited_count),Number.isInteger(r.joined_count)&&n.currentState.setJoinedMemberCount(r.joined_count),r.invite_state){var v=Tg(i.client,n.roomId,r.invite_state);yield i.injectRoomEvents(n,v),r.initial&&(n.recalculate(),i.client.store.storeRoom(n),i.client.emit(Le.Room,n)),v.forEach(R=>{i.client.emit(Le.Event,R)});return}if(r.limited){var w;n.getLiveTimeline().setPaginationToken((w=r.prev_batch)!==null&&w!==void 0?w:null,Me.BACKWARDS)}yield i.injectRoomEvents(n,s,o,r.num_live),n.addEphemeralEvents(a),n.updateMyMembership(Be.Join),n.setMSC4186SummaryData(r.heroes,r.joined_count,r.invited_count),n.recalculate(),r.initial&&(e.store.storeRoom(n),e.emit(Le.Room,n)),i.addNotifications(o);var S=function(){var R=B(function*(x){e.emit(Le.Event,x),x.isState()&&x.getType()==Z.RoomEncryption&&i.syncOpts.cryptoCallbacks&&(yield i.syncOpts.cryptoCallbacks.onCryptoEvent(n,x))});return function(T){return R.apply(this,arguments)}}();yield og(s,S),yield og(o,S),a.forEach(function(R){e.emit(Le.Event,R)}),n.decryptCriticalEvents()})()}injectRoomEvents(e,n){var r=arguments,i=this;return B(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:[],o=r.length>3&&r[3]!==void 0?r[3]:0,a=e.getLiveTimeline(),c=a.getEvents().length==0;if(c){for(var l of n)i.client.getPushActionsForEvent(l);a.initialiseState(n)}c||(e.oldState.setStateEvents(n),e.currentState.setStateEvents(n));var d=[];o>0&&(d=s.slice(-1*o),s=s.slice(0,-1*d.length)),yield e.addLiveEvents(s,{fromCache:!0,addToState:!1}),d.length>0&&(yield e.addLiveEvents(d,{fromCache:!1,addToState:!1})),e.recalculate(),i.resolveInvites(e)})()}resolveInvites(e){if(!(!e||!this.opts.resolveInvitesToProfiles)){var n=this.client;e.getMembersWithMembership(Be.Invite).forEach(function(r){if(!r.requestedProfileInfo){r.requestedProfileInfo=!0;var i=n.getUser(r.userId),s;i?s=Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):s=n.getProfileInfo(r.userId),s.then(function(o){var a=r.events.member;a.getContent().membership===Be.Invite&&(a.getContent().avatar_url=o.avatar_url,a.getContent().displayname=o.displayname,r.setMembershipEvent(a,e.currentState))},function(o){})}})}}retryImmediately(){return!0}sync(){var e=this;return B(function*(){for(e.syncOpts.logger.debug("Sliding sync init loop");!e.client.isGuest();)try{e.syncOpts.logger.debug("Getting push rules...");var n=yield e.client.getPushRules();e.syncOpts.logger.debug("Got push rules"),e.client.pushRules=n;break}catch(r){if(e.syncOpts.logger.error("Getting push rules failed",r),e.shouldAbortSync(r))return}yield e.slidingSync.start()})()}stop(){this.syncOpts.logger.debug("SyncApi.stop"),this.slidingSync.stop()}updateSyncState(e,n){var r=this.syncState;this.syncState=e,this.syncStateData=n,this.client.emit(Le.Sync,this.syncState,r,n)}addNotifications(e){if(this.client.getNotifTimelineSet())for(var n of e){var r=this.client.getPushActionsForEvent(n);r&&r.notify&&r.tweaks&&r.tweaks.highlight&&this.notifEvents.push(n)}}purgeNotifications(){this.notifEvents.sort(function(e,n){return e.getTs()-n.getTs()}),this.notifEvents.forEach(e=>{var n;(n=this.client.getNotifTimelineSet())===null||n===void 0||n.addLiveEvent(e,{addToState:!1})}),this.notifEvents=[]}}function B1e(t,e,n){if(!n.name)return n;for(var r of n.required_state)if(r.type===Z.RoomName&&r.state_key==="")return r.content={name:n.name},n;return n.required_state.push({event_id:"$fake-sliding-sync-name-event-"+e,state_key:"",type:Z.RoomName,content:{name:n.name},sender:t.getUserId(),origin_server_ts:new Date().getTime()}),n}function Tg(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=t.getEventMapper({decrypt:r});return n.map(function(s){return s.room_id=e,i(s)})}function WJ(t,e,n){var r=Tg(t,e,n),i=t.getRoom(e);if(!i){M.warn("got ephemeral events for room but room doesn't exist on client:",e);return}i.addEphemeralEvents(r),r.forEach(s=>{t.emit(Le.Event,s)})}var ZO=new Ar("m.beacon_info","org.matrix.msc3672.beacon_info"),pA=new Ar("m.beacon","org.matrix.msc3672.beacon");class rv{static RETRY_BACKOFF_RATELIMIT(e,n,r){return GO(r,n,!1)}static QUEUE_MESSAGES(e){return e.getType()===Z.RoomMessage||e.hasAssociation()?"message":null}constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:rv.RETRY_BACKOFF_RATELIMIT,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:rv.QUEUE_MESSAGES;this.retryAlgorithm=e,this.queueAlgorithm=n,L(this,"queues",{}),L(this,"activeQueues",[]),L(this,"procFn",null),L(this,"processQueue",r=>{var i=this.peekNextEvent(r);if(!i){this.disableQueue(r);return}this.queues[r].length,Promise.resolve().then(()=>this.procFn(i.event)).then(s=>{this.removeNextEvent(r),i.event.getId(),i.resolvers.resolve(s),this.processQueue(r)},s=>{i.attempts+=1;var o=this.retryAlgorithm(i.event,i.attempts,s);i.attempts,i.event.getId(),o===-1?(M.info("Queue '%s' giving up on event %s",r,i.event.getId()),this.clearQueue(r,s)):setTimeout(this.processQueue,o,r)})})}getQueueForEvent(e){var n=this.queueAlgorithm(e);return!n||!this.queues[n]?null:this.queues[n].map(function(r){return r.event})}removeEventFromQueue(e){var n=this.queueAlgorithm(e);if(!n||!this.queues[n])return!1;var r=!1;return tC(this.queues[n],i=>i.event.getId()===e.getId()?(r=!0,!0):!1),r}setProcessFunction(e){this.procFn=e,this.startProcessingQueues()}queueEvent(e){var n=this.queueAlgorithm(e);if(!n)return null;this.queues[n]||(this.queues[n]=[]);var r=Promise.withResolvers();return this.queues[n].push({event:e,resolvers:r,attempts:0}),e.getId(),this.startProcessingQueues(),r.promise}startProcessingQueues(){this.procFn&&Object.keys(this.queues).filter(e=>this.activeQueues.indexOf(e)===-1&&this.queues[e].length>0).forEach(e=>{this.activeQueues.push(e),this.processQueue(e)})}disableQueue(e){var n=this.activeQueues.indexOf(e);n>=0&&this.activeQueues.splice(n,1),M.info("Stopping queue '%s' as it is now empty",e)}clearQueue(e,n){M.info("clearing queue '%s'",e);for(var r;r=this.removeNextEvent(e);)r.resolvers.reject(n);this.disableQueue(e)}peekNextEvent(e){var n=this.queues[e];if(Array.isArray(n))return n[0]}removeNextEvent(e){var n=this.queues[e];if(Array.isArray(n))return n.shift()}}var z$=20;class H1e{constructor(e,n){var r=this;this.client=e,this.logger=n,L(this,"sending",!1),L(this,"running",!0),L(this,"retryTimeout",null),L(this,"retryAttempts",0),L(this,"sendQueue",B(function*(){if(r.retryTimeout!==null&&clearTimeout(r.retryTimeout),r.retryTimeout=null,!(r.sending||!r.running)){r.logger.debug("Attempting to send queued to-device messages"),r.sending=!0;var i;try{for(;r.running&&(i=yield r.client.store.getOldestToDeviceBatch(),i!==null);)yield r.sendBatch(i),yield r.client.store.removeToDeviceBatch(i.id),r.retryAttempts=0;if(!r.running)return;r.logger.debug("All queued to-device messages sent")}catch(o){++r.retryAttempts;var s=rv.RETRY_BACKOFF_RATELIMIT(null,r.retryAttempts,o);if(s===-1){Math.floor(o.httpStatus/100)===4?(r.logger.error("Fatal error when sending to-device message - dropping to-device batch!",o),yield r.client.store.removeToDeviceBatch(i.id)):r.logger.info("Automatic retry limit reached for to-device messages.");return}r.logger.info("Failed to send batch of to-device messages. Will retry in ".concat(s,"ms"),o),r.retryTimeout=setTimeout(r.sendQueue,s)}finally{r.sending=!1}}})),L(this,"onResumedSync",(i,s)=>{i===Gt.Syncing&&s!==Gt.Syncing&&(this.logger.info("Resuming queue after resumed sync"),this.sendQueue())})}start(){this.running=!0,this.sendQueue(),this.client.on(Le.Sync,this.onResumedSync)}stop(){this.running=!1,this.retryTimeout!==null&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.client.removeListener(Le.Sync,this.onResumedSync)}queueBatch(e){var n=this;return B(function*(){for(var r=[],i=0;i<e.batch.length;i+=z$){var s={eventType:e.eventType,batch:e.batch.slice(i,i+z$),txnId:n.client.makeTxnId()};r.push(s);var o=s.batch.map(a=>"".concat(a.userId,"/").concat(a.deviceId," (msgid ").concat(a.payload[X3],")"));n.logger.info("Enqueuing batch of to-device messages. type=".concat(e.eventType," txnid=").concat(s.txnId),o)}yield n.client.store.saveToDeviceBatches(r),n.sendQueue()})()}sendBatch(e){var n=this;return B(function*(){var r=new vu(()=>new Map);for(var i of e.batch)r.getOrCreate(i.userId).set(i.deviceId,i.payload);n.logger.info("Sending batch of ".concat(e.batch.length," to-device messages with ID ").concat(e.id," and txnId ").concat(e.txnId)),yield n.client.sendToDevice(e.eventType,r,e.txnId)})()}}var Lk=new to.UnstableValue("m.policies","org.matrix.msc3847.policies"),A2=new to.UnstableValue("m.ignore.invites","org.matrix.msc3847.ignore.invites"),W$=function(t){return t.Ban="m.ban",t}({}),Rg=function(t){return t.User="m.policy.user",t.Room="m.policy.room",t.Server="m.policy.server",t}({}),Y$={[Rg.User]:Z.PolicyRuleUser,[Rg.Room]:Z.PolicyRuleRoom,[Rg.Server]:Z.PolicyRuleServer};class V1e{constructor(e){this.client=e}addRule(e,n,r){var i=this;return B(function*(){var s=yield i.getOrCreateTargetRoom(),o=yield i.client.sendStateEvent(s.roomId,Y$[e],{entity:n,reason:r,recommendation:W$.Ban});return o.event_id})()}removeRule(e){var n=this;return B(function*(){yield n.client.redactEvent(e.getRoomId(),e.getId())})()}addSource(e){var n=this;return B(function*(){yield n.client.joinRoom(e);var r=(yield n.getOrCreateSourceRooms()).map(i=>i.roomId);return r.includes(e)?!1:(r.push(e),yield n.withIgnoreInvitesPolicies(i=>{i.sources=r}),!0)})()}getRuleForInvite(e){var n=this;return B(function*(){var{sender:r,roomId:i}=e,s=yield n.getOrCreateSourceRooms(),o=r.split(":")[1],a=i.split(":")[1];for(var c of s){var l=c.getUnfilteredTimelineSet().getLiveTimeline().getState(Me.FORWARDS);for(var{scope:d,entities:h}of[{scope:Rg.Room,entities:[i]},{scope:Rg.User,entities:[r]},{scope:Rg.Server,entities:[o,a]}]){var m=l.getStateEvents(Y$[d]);for(var g of m){var y=g.getContent();if(y?.recommendation==W$.Ban){var v=y?.entity;if(v){var w=void 0;try{w=new RegExp(HX(v))}catch{continue}for(var S of h)if(S&&w.test(S))return g}}}}}return null})()}getOrCreateTargetRoom(){var e=this;return B(function*(){var n=e.getIgnoreInvitesPolicies(),r=n.target;if(typeof r!="string"&&(r=null),r){var i=e.client.getRoom(r);if(i)return i;r=null}return r=(yield e.client.createRoom({name:"Individual Policy Room",preset:nT.PrivateChat})).room_id,yield e.withIgnoreInvitesPolicies(s=>{s.target=r}),e.client.getRoom(r)})()}getOrCreateSourceRooms(){var e=this;return B(function*(){var n=e.getIgnoreInvitesPolicies(),r=n.sources,i=!1;Array.isArray(r)||(i=!0,r=[]);var s=r.filter(a=>typeof a=="string").map(a=>e.client.getRoom(a)).filter(a=>!!a);if(s.length!=r.length&&(i=!0),s.length==0){var o=yield e.getOrCreateTargetRoom();i=!0,s=[o]}return i&&(yield e.withIgnoreInvitesPolicies(a=>{a.sources=r})),s})()}getIgnoreInvitesPolicies(){return this.getPoliciesAndIgnoreInvitesPolicies().ignoreInvitesPolicies}withIgnoreInvitesPolicies(e){var n=this;return B(function*(){var{policies:r,ignoreInvitesPolicies:i}=n.getPoliciesAndIgnoreInvitesPolicies();e(i),r[A2.name]=i,yield n.client.setAccountData(Lk.name,r)})()}getPoliciesAndIgnoreInvitesPolicies(){var e={};for(var n of[Lk.name,Lk.altName]){var r;if(n){var i=(r=this.client.getAccountData(n))===null||r===void 0?void 0:r.getContent();if(i){e=i;break}}}var s={},o=!1;for(var a of[A2.name,A2.altName])if(a){var c=e[a];if(c&&typeof c=="object"){s=c,o=!0;break}}return o||(e[A2.name]=s),{policies:e,ignoreInvitesPolicies:s}}}var Ok="matrix-js-sdk";function q1e(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const d=t.charAt(l),h=d.charCodeAt(0);if(e[h]!==255)throw new TypeError(d+" is ambiguous");e[h]=l}const n=t.length,r=t.charAt(0),i=Math.log(n)/Math.log(256),s=Math.log(256)/Math.log(n);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let d=0,h=0,m=0;const g=l.length;for(;m!==g&&l[m]===0;)m++,d++;const y=(g-m)*s+1>>>0,v=new Uint8Array(y);for(;m!==g;){let R=l[m],x=0;for(let T=y-1;(R!==0||x<h)&&T!==-1;T--,x++)R+=256*v[T]>>>0,v[T]=R%n>>>0,R=R/n>>>0;if(R!==0)throw new Error("Non-zero carry");h=x,m++}let w=y-h;for(;w!==y&&v[w]===0;)w++;let S=r.repeat(d);for(;w<y;++w)S+=t.charAt(v[w]);return S}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let d=0,h=0,m=0;for(;l[d]===r;)h++,d++;const g=(l.length-d)*i+1>>>0,y=new Uint8Array(g);for(;d<l.length;){const R=l.charCodeAt(d);if(R>255)return;let x=e[R];if(x===255)return;let T=0;for(let I=g-1;(x!==0||T<m)&&I!==-1;I--,T++)x+=n*y[I]>>>0,y[I]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");m=T,d++}let v=g-m;for(;v!==g&&y[v]===0;)v++;const w=new Uint8Array(h+(g-v));let S=h;for(;v!==g;)w[S++]=y[v++];return w}function c(l){const d=a(l);if(d)return d;throw new Error("Non-base"+n+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var G1e="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const kat=q1e(G1e);var gi=function(t){return t.UserTrustStatusChanged="userTrustStatusChanged",t.KeyBackupStatus="crypto.keyBackupStatus",t.KeyBackupFailed="crypto.keyBackupFailed",t.KeyBackupSessionsRemaining="crypto.keyBackupSessionsRemaining",t.KeyBackupDecryptionKeyCached="crypto.keyBackupDecryptionKeyCached",t.VerificationRequestReceived="crypto.verificationRequestReceived",t.WillUpdateDevices="crypto.willUpdateDevices",t.DevicesUpdated="crypto.devicesUpdated",t.KeysChanged="crossSigning.keysChanged",t.LegacyCryptoStoreMigrationProgress="crypto.legacyCryptoStoreMigrationProgress",t.DehydratedDeviceCreated="dehydration.DehydratedDeviceCreated",t.DehydratedDeviceUploaded="dehydration.DehydratedDeviceUploaded",t.RehydrationStarted="dehydration.RehydrationStarted",t.RehydrationProgress="dehydration.RehydrationProgress",t.RehydrationCompleted="dehydration.RehydrationCompleted",t.RehydrationError="dehydration.RehydrationError",t.DehydrationKeyCached="dehydration.DehydrationKeyCached",t.DehydratedDeviceRotationError="dehydration.DehydratedDeviceRotationError",t}({}),K1e=function(t){return t.MEGOLM_UNKNOWN_INBOUND_SESSION_ID="MEGOLM_UNKNOWN_INBOUND_SESSION_ID",t.MEGOLM_KEY_WITHHELD="MEGOLM_KEY_WITHHELD",t.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE="MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE",t.OLM_UNKNOWN_MESSAGE_INDEX="OLM_UNKNOWN_MESSAGE_INDEX",t.HISTORICAL_MESSAGE_NO_KEY_BACKUP="HISTORICAL_MESSAGE_NO_KEY_BACKUP",t.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED="HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED",t.HISTORICAL_MESSAGE_WORKING_BACKUP="HISTORICAL_MESSAGE_WORKING_BACKUP",t.HISTORICAL_MESSAGE_USER_NOT_JOINED="HISTORICAL_MESSAGE_USER_NOT_JOINED",t.SENDER_IDENTITY_PREVIOUSLY_VERIFIED="SENDER_IDENTITY_PREVIOUSLY_VERIFIED",t.UNSIGNED_SENDER_DEVICE="UNSIGNED_SENDER_DEVICE",t.UNKNOWN_SENDER_DEVICE="UNKNOWN_SENDER_DEVICE",t.UNKNOWN_ERROR="UNKNOWN_ERROR",t}({}),z1e=function(t){return t[t.AllDevicesIsolationMode=0]="AllDevicesIsolationMode",t[t.OnlySignedDevicesIsolationMode=1]="OnlySignedDevicesIsolationMode",t}({});class xat{constructor(e){this.errorOnVerifiedUserProblems=e,L(this,"kind",z1e.AllDevicesIsolationMode)}}class Aat{constructor(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;this.crossSigningVerified=e,this.crossSigningVerifiedBefore=n,this.tofu=r,L(this,"needsUserApproval",void 0),this.needsUserApproval=i}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this.crossSigningVerified}wasCrossSigningVerified(){return this.crossSigningVerifiedBefore}isTofu(){return this.tofu}}class Pat{constructor(e){var n,r,i,s,o;L(this,"signedByOwner",void 0),L(this,"crossSigningVerified",void 0),L(this,"tofu",void 0),L(this,"localVerified",void 0),L(this,"trustCrossSignedDevices",void 0),this.signedByOwner=(n=e.signedByOwner)!==null&&n!==void 0?n:!1,this.crossSigningVerified=(r=e.crossSigningVerified)!==null&&r!==void 0?r:!1,this.tofu=(i=e.tofu)!==null&&i!==void 0?i:!1,this.localVerified=(s=e.localVerified)!==null&&s!==void 0?s:!1,this.trustCrossSignedDevices=(o=e.trustCrossSignedDevices)!==null&&o!==void 0?o:!1}isVerified(){return this.localVerified||this.trustCrossSignedDevices&&this.crossSigningVerified}}var Lat=function(t){return t.Fetch="fetch",t.LoadKeys="load_keys",t}({}),Oat=function(t){return t.Master="master",t.SelfSigning="self_signing",t.UserSigning="user_signing",t}({}),Mat=function(t){return t[t.NONE=0]="NONE",t[t.GREY=1]="GREY",t[t.RED=2]="RED",t}({}),Dat=function(t){return t[t.UNKNOWN=0]="UNKNOWN",t[t.UNVERIFIED_IDENTITY=1]="UNVERIFIED_IDENTITY",t[t.UNSIGNED_DEVICE=2]="UNSIGNED_DEVICE",t[t.UNKNOWN_DEVICE=3]="UNKNOWN_DEVICE",t[t.AUTHENTICITY_NOT_GUARANTEED=4]="AUTHENTICITY_NOT_GUARANTEED",t[t.MISMATCHED_SENDER_KEY=5]="MISMATCHED_SENDER_KEY",t[t.SENT_IN_CLEAR=6]="SENT_IN_CLEAR",t[t.VERIFICATION_VIOLATION=7]="VERIFICATION_VIOLATION",t[t.MISMATCHED_SENDER=8]="MISMATCHED_SENDER",t}({}),W1e=new Uint8Array(8);function YJ(t,e){return mA.apply(this,arguments)}function mA(){return mA=B(function*(t,e){var n=yield globalThis.crypto.subtle.importKey("raw",t,{name:"HKDF"},!1,["deriveBits"]),r=yield globalThis.crypto.subtle.deriveBits({name:"HKDF",salt:W1e,info:new TextEncoder().encode(e),hash:"SHA-256"},n,512),i=r.slice(0,32),s=r.slice(32),o=globalThis.crypto.subtle.importKey("raw",i,{name:"AES-CTR"},!1,["encrypt","decrypt"]),a=globalThis.crypto.subtle.importKey("raw",s,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return Promise.all([o,a])}),mA.apply(this,arguments)}function XJ(t,e,n,r){return gA.apply(this,arguments)}function gA(){return gA=B(function*(t,e,n,r){var i;r?i=Bh(r):(i=new Uint8Array(16),globalThis.crypto.getRandomValues(i),i[8]&=127);var[s,o]=yield YJ(e,n),a=new TextEncoder().encode(t),c=yield globalThis.crypto.subtle.encrypt({name:"AES-CTR",counter:i,length:64},s,a),l=yield globalThis.crypto.subtle.sign({name:"HMAC"},o,c);return{iv:Cy(i),ciphertext:Cy(new Uint8Array(c)),mac:Cy(new Uint8Array(l))}}),gA.apply(this,arguments)}function Y1e(t,e,n){return vA.apply(this,arguments)}function vA(){return vA=B(function*(t,e,n){var[r,i]=yield YJ(e,n),s=Bh(t.ciphertext);if(!(yield globalThis.crypto.subtle.verify({name:"HMAC"},i,Bh(t.mac),s)))throw new Error("Error decrypting secret ".concat(n,": bad MAC"));var o=yield globalThis.crypto.subtle.decrypt({name:"AES-CTR",counter:Bh(t.iv),length:64},r,s);return new TextDecoder().decode(new Uint8Array(o))}),vA.apply(this,arguments)}var Ih="m.secret_storage.v1.aes-hmac-sha2";class JJ{constructor(e,n){this.accountDataAdapter=e,this.callbacks=n}getDefaultKeyId(){var e=this;return B(function*(){var n,r=yield e.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");return r&&(n=r.key)!==null&&n!==void 0?n:null})()}setDefaultKeyId(e){return new Promise((n,r)=>{var i=o=>{if(o.getType()==="m.secret_storage.default_key"){var a=o.getContent(),c=e===null?Object.keys(a).length===0:a.key===e;c&&(this.accountDataAdapter.removeListener(Le.AccountData,i),n())}};this.accountDataAdapter.on(Le.AccountData,i);var s=e===null?{}:{key:e};this.accountDataAdapter.setAccountData("m.secret_storage.default_key",s).catch(o=>{this.accountDataAdapter.removeListener(Le.AccountData,i),r(o)})})}addKey(e,n,r){var i=this;return B(function*(){if(e!==Ih)throw new Error("Unknown key algorithm ".concat(e));var s={algorithm:e};n.name&&(s.name=n.name),n.passphrase&&(s.passphrase=n.passphrase);var{iv:o,mac:a}=yield bA(n.key);if(s.iv=o,s.mac=a,!r)do r=To(32);while(yield i.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(r)));return yield i.accountDataAdapter.setAccountData("m.secret_storage.key.".concat(r),s),{keyId:r,keyInfo:s}})()}getKey(e){var n=this;return B(function*(){if(e||(e=yield n.getDefaultKeyId()),!e)return null;var r=yield n.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(e));return r?[e,r]:null})()}hasKey(e){var n=this;return B(function*(){var r=yield n.getKey(e);return!!r})()}checkKey(e,n){return B(function*(){if(n.algorithm===Ih)if(n.mac){var{mac:r}=yield bA(e,n.iv);return yA(n.mac)===yA(r)}else return!0;else throw new Error("Unknown algorithm")})()}store(e,n,r){var i=this;return B(function*(){if(n===null){yield i.accountDataAdapter.setAccountData(e,{});return}var s={};if(!r){var o=yield i.getDefaultKeyId();if(!o)throw new Error("No keys specified and no default key present");r=[o]}if(r.length===0)throw new Error("Zero keys given to encrypt with!");for(var a of r){var c=yield i.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(a));if(!c)throw new Error("Unknown key: "+a);if(c.algorithm===Ih){var l={[a]:c},[,d]=yield i.getSecretStorageKey(l,e);s[a]=yield d.encrypt(n)}else M.warn("unknown algorithm for secret storage key "+a+": "+c.algorithm)}yield i.accountDataAdapter.setAccountData(e,{encrypted:s})})()}get(e){var n=this;return B(function*(){var r=yield n.accountDataAdapter.getAccountDataFromServer(e);if(r){if(!r.encrypted)throw new Error("Content is not encrypted!");var i={};for(var s of Object.keys(r.encrypted)){var o=yield n.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(s)),a=r.encrypted[s];o?.algorithm===Ih&&a.iv&&a.ciphertext&&a.mac&&(i[s]=o)}if(Object.keys(i).length===0)throw new Error("Could not decrypt ".concat(e," because none of ")+"the keys it is encrypted with are for a supported algorithm");var[c,l]=yield n.getSecretStorageKey(i,e),d=r.encrypted[c];return l.decrypt(d)}})()}isStored(e){var n=this;return B(function*(){var r=yield n.accountDataAdapter.getAccountDataFromServer(e);if(!(r!=null&&r.encrypted))return null;var i={};for(var s of Object.keys(r.encrypted)){var o=yield n.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(s));if(o){var a=r.encrypted[s];o.algorithm===Ih&&a.iv&&a.ciphertext&&a.mac&&(i[s]=o)}}return Object.keys(i).length?i:null})()}getSecretStorageKey(e,n){var r=this;return B(function*(){if(!r.callbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");var i=yield r.callbacks.getSecretStorageKey({keys:e},n);if(!i)throw new Error("getSecretStorageKey callback returned falsey");if(i.length<2)throw new Error("getSecretStorageKey callback returned invalid data");var[s,o]=i;if(!e[s])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[s].algorithm===Ih){var a={encrypt:function(l){return XJ(l,o,n)},decrypt:function(l){return Y1e(l,o,n)}};return[s,a]}else throw new Error("Unknown key type: "+e[s].algorithm)})()}}function yA(t){for(var e=t.length;e>=1&&t.charCodeAt(e-1)==61;)e--;return e<t.length?t.substring(0,e):t}var X1e="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0";function bA(t,e){return XJ(X1e,t,"",e)}const J1e=Object.freeze(Object.defineProperty({__proto__:null,SECRET_STORAGE_ALGORITHM_V1_AES:Ih,ServerSideSecretStorageImpl:JJ,calculateKeyCheck:bA,trimTrailingEquals:yA},Symbol.toStringTag,{value:"Module"}));var QJ=t=>t.type==="livekit"&&"livekit_service_url"in t,ZJ=t=>QJ(t)&&"livekit_alias"in t,eQ=t=>t.type==="livekit"&&"focus_selection"in t,tQ=1e3*60*60*4,Q1e=(t,e)=>{var n,r="Malformed session membership event: ";return typeof t.device_id!="string"&&e.push(r+"device_id must be string"),typeof t.call_id!="string"&&e.push(r+"call_id must be string"),typeof t.application!="string"&&e.push(r+"application must be a string"),typeof((n=t.focus_active)===null||n===void 0?void 0:n.type)!="string"&&e.push(r+"focus_active.type must be a string"),Array.isArray(t.foci_preferred)||e.push(r+"foci_preferred must be an array"),t.created_ts!==void 0&&typeof t.created_ts!="number"&&e.push(r+"created_ts must be number"),t.scope!==void 0&&typeof t.scope!="string"&&e.push(r+"scope must be string"),t["m.call.intent"]!==void 0&&typeof t["m.call.intent"]!="string"&&e.push(r+"m.call.intent must be a string"),e.length===0};class X${static equal(e,n){return ff(e.membershipData,n.membershipData)}constructor(e,n){this.parentEvent=e,L(this,"membershipData",void 0);var r=[];if(Q1e(n,r))this.membershipData=n;else throw Error("unknown CallMembership data. Does not match MSC4143 call.member (".concat(r.join(" & "),") events this could be a legacy membership event: (").concat(n,")"))}get sender(){return this.parentEvent.getSender()}get eventId(){return this.parentEvent.getId()}get callId(){return this.membershipData.call_id}get deviceId(){return this.membershipData.device_id}get callIntent(){return this.membershipData["m.call.intent"]}get sessionDescription(){return{application:this.membershipData.application,id:this.membershipData.call_id}}get application(){return this.membershipData.application}get scope(){return this.membershipData.scope}get membershipID(){return this.createdTs().toString()}createdTs(){var e;return(e=this.membershipData.created_ts)!==null&&e!==void 0?e:this.parentEvent.getTs()}getAbsoluteExpiry(){var e;return this.createdTs()+((e=this.membershipData.expires)!==null&&e!==void 0?e:tQ)}getMsUntilExpiry(){return this.getAbsoluteExpiry()-Date.now()}isExpired(){return this.getMsUntilExpiry()<=0}getPreferredFoci(){return this.membershipData.foci_preferred}getFocusSelection(){var e=this.membershipData.focus_active;if(eQ(e))return e.focus_selection}}var zE=function(t){return t.Cancel="cancel",t.Restart="restart",t.Send="send",t}({}),e7=function(t){return t.TooNew="TOO_NEW",t}({});class t7 extends Error{constructor(e){var n="Crypto store is invalid because ".concat(e,", ")+"please stop the client, delete all data and start the client again";super(n),this.reason=e,this.name="InvalidCryptoStoreError"}}L(t7,"TOO_NEW",e7.TooNew);class Z1e extends Error{constructor(e,n){super(e),this.value=n}}class eye extends Error{constructor(){super("MatrixClient has been stopped")}}class Gd extends Error{constructor(e,n){super(e),this.clientEndpoint=n,this.name="UnsupportedDelayedEventsEndpointError"}}var Ad=function(t){return t.Disconnected="Disconnected",t.Connecting="Connecting",t.ConnectingFailed="ConnectingFailed",t.Connected="Connected",t.Reconnecting="Reconnecting",t.Disconnecting="Disconnecting",t.Stuck="Stuck",t.Unknown="Unknown",t}({}),WE=(t,e,n)=>t.sender===e&&t.deviceId===n;class tye{constructor(e,n){this.membershipLoopHandler=e,L(this,"logger",void 0),L(this,"running",!1),L(this,"wakeup",r=>{this.logger.error("Cannot call wakeup before calling `startWithJoin()`")}),L(this,"_actions",[]),this.logger=(n??M).getChild("[NewMembershipActionScheduler]")}get actions(){return this._actions}startWithJoin(){var e=this;return B(function*(){if(e.running){e.logger.error("Cannot call startWithJoin() on NewMembershipActionScheduler while already running");return}e.running=!0,e._actions=[{ts:Date.now(),type:ot.SendDelayedEvent}];try{for(var n=function*(){e._actions.sort((l,d)=>l.ts-d.ts);var i=e._actions[0],s=void 0,o=new Promise(l=>{e.wakeup=d=>{s=d,l()}});i.ts>Date.now()&&(yield Promise.race([o,_p(i.ts-Date.now())]));var a={};if(!s){e.logger.debug("Current MembershipManager processing: ".concat(i.type,`
Queue:`),e._actions,`
Date.now: "`.concat(Date.now()));try{a=yield e.membershipLoopHandler(i.type)}catch(l){throw Error("The MembershipManager shut down because of the end condition: ".concat(l))}}e._actions.splice(0,1);var c=s??a;"replace"in c?e._actions=c.replace:"insert"in c&&e._actions.push(...c.insert)};e._actions.length>0;)yield*n()}finally{e.running=!1}e.logger.debug("Leave MembershipManager ActionScheduler loop (no more actions)")})()}initiateJoin(){var e;(e=this.wakeup)===null||e===void 0||e.call(this,{replace:[{ts:Date.now(),type:ot.SendDelayedEvent}]})}initiateLeave(){var e;(e=this.wakeup)===null||e===void 0||e.call(this,{replace:[{ts:Date.now(),type:ot.SendScheduledDelayedLeaveEvent}]})}}var Hh=function(t){return t.StatusChanged="StatusChanged",t.ProbablyLeft="ProbablyLeft",t}({});function J$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function nye(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?J$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var ot=function(t){return t.SendDelayedEvent="SendDelayedEvent",t.SendJoinEvent="SendJoinEvent",t.RestartDelayedEvent="RestartDelayedEvent",t.UpdateExpiry="UpdateExpiry",t.SendScheduledDelayedLeaveEvent="SendScheduledDelayedLeaveEvent",t.SendLeaveEvent="SendLeaveEvent",t}({});class fC extends On{isActivated(){return this.activated}isJoined(){return this.isActivated()}join(e,n,r){if(this.scheduler.running){this.logger.error("MembershipManager is already running. Ignoring join request.");return}this.fociPreferred=e,this.focusActive=n,this.leavePromiseResolvers=void 0,this.activated=!0,this.oldStatus=this.status,this.state=fC.defaultState,this.scheduler.startWithJoin().catch(i=>{this.logger.error("MembershipManager stopped because: ",i),r?.(i)}).finally(()=>{if(this.activated=!1,this.oldStatus&&this.oldStatus!==this.status&&this.emit(Hh.StatusChanged,this.oldStatus,this.status),!this.scheduler.running){var i;(i=this.leavePromiseResolvers)===null||i===void 0||i.resolve(!0),this.leavePromiseResolvers=void 0}})}leave(e){return this.scheduler.running?(this.leavePromiseResolvers||(this.leavePromiseResolvers=Promise.withResolvers(),this.activated=!1,this.scheduler.initiateLeave(),e&&setTimeout(()=>{var n;return(n=this.leavePromiseResolvers)===null||n===void 0?void 0:n.resolve(!1)},e)),this.leavePromiseResolvers.promise):(this.logger.warn("Called MembershipManager.leave() even though the MembershipManager is not running"),Promise.resolve(!0))}onRTCSessionMemberUpdate(e){if(!this.isActivated())return Promise.resolve();var n=this.client.getUserId(),r=this.client.getDeviceId();if(!n||!r)return this.logger.error("MembershipManager.onRTCSessionMemberUpdate called without user or device id"),Promise.resolve();if(this._ownMembership=e.find(s=>WE(s,n,r)),!this._ownMembership){var i=[ot.SendDelayedEvent,ot.SendJoinEvent];this.logger.warn("Missing own membership: force re-join"),this.state.hasMemberStateEvent=!1,this.scheduler.actions.some(s=>i.includes(s.type))?this.logger.error("tried adding another `SendDelayedEvent` actions even though we already have one in the Queue\nActionQueueOnMemberUpdate:",this.scheduler.actions):this.scheduler.initiateJoin()}return Promise.resolve()}getActiveFocus(){if(this.focusActive)if(eQ(this.focusActive)){if(this.focusActive.focus_selection==="oldest_membership"){var e=this.getOldestMembership();return e?.getPreferredFoci()[0]}}else this.logger.warn("Unknown own ActiveFocus type. This makes it impossible to connect to an SFU.");else{var n=this.getOldestMembership();return n?.getPreferredFoci()[0]}}updateCallIntent(e){var n=this;return B(function*(){if(!n.activated||!n.ownMembership)throw Error("You cannot update your intent before joining the call");n.ownMembership.callIntent!==e&&(n.callIntent=e,yield n.sendJoinEvent())})()}constructor(e,n,r,i,s,o){super(),this.joinConfig=e,this.room=n,this.client=r,this.getOldestMembership=i,this.sessionDescription=s,L(this,"activated",!1),L(this,"logger",void 0),L(this,"callIntent",void 0),L(this,"leavePromiseResolvers",void 0),L(this,"_ownMembership",void 0),L(this,"oldStatus",void 0),L(this,"scheduler",void 0),L(this,"state",void 0),L(this,"deviceId",void 0),L(this,"stateKey",void 0),L(this,"fociPreferred",void 0),L(this,"focusActive",void 0),L(this,"delayedLeaveEventDelayMsOverride",void 0),this.logger=(o??M).getChild("[MembershipManager]");var[a,c]=[this.client.getUserId(),this.client.getDeviceId()];if(a===null)throw Error("Missing userId in client");if(c===null)throw Error("Missing deviceId in client");this.deviceId=c,this.stateKey=this.makeMembershipStateKey(a,c),this.state=fC.defaultState,this.callIntent=e?.callIntent,this.scheduler=new tye(l=>(this.oldStatus&&(this.logger.debug("MembershipManager applied action changes. Status: ".concat(this.oldStatus," -> ").concat(this.status)),this.oldStatus!==this.status&&this.emit(Hh.StatusChanged,this.oldStatus,this.status)),this.oldStatus=this.status,this.logger.debug("MembershipManager before processing action. status=".concat(this.oldStatus)),this.membershipLoopHandler(l)),this.logger)}get ownMembership(){return this._ownMembership}static get defaultState(){return{hasMemberStateEvent:!1,delayId:void 0,startTime:0,rateLimitRetries:new Map,networkErrorRetries:new Map,expireUpdateIterations:1,probablyLeft:!1}}get networkErrorRetryMs(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.networkErrorRetryMs)!==null&&e!==void 0?e:3e3}get membershipEventExpiryMs(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.membershipEventExpiryMs)!==null&&e!==void 0?e:tQ}get membershipEventExpiryHeadroomMs(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.membershipEventExpiryHeadroomMs)!==null&&e!==void 0?e:5e3}computeNextExpiryActionTs(e){return this.state.startTime+this.membershipEventExpiryMs*e-this.membershipEventExpiryHeadroomMs}get delayedLeaveEventDelayMs(){var e,n,r;return(e=(n=this.delayedLeaveEventDelayMsOverride)!==null&&n!==void 0?n:(r=this.joinConfig)===null||r===void 0?void 0:r.delayedLeaveEventDelayMs)!==null&&e!==void 0?e:8e3}get delayedLeaveEventRestartMs(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.delayedLeaveEventRestartMs)!==null&&e!==void 0?e:5e3}get maximumRateLimitRetryCount(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.maximumRateLimitRetryCount)!==null&&e!==void 0?e:10}get maximumNetworkErrorRetryCount(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.maximumNetworkErrorRetryCount)!==null&&e!==void 0?e:10}get delayedLeaveEventRestartLocalTimeoutMs(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.delayedLeaveEventRestartLocalTimeoutMs)!==null&&e!==void 0?e:2e3}membershipLoopHandler(e){var n=this;return B(function*(){switch(e){case ot.SendDelayedEvent:return n.state.delayId?n.cancelKnownDelayIdBeforeSendDelayedEvent(n.state.delayId):n.sendOrResendDelayedLeaveEvent();case ot.RestartDelayedEvent:return n.state.delayId?n.restartDelayedEvent(n.state.delayId):Go(ot.SendDelayedEvent);case ot.SendScheduledDelayedLeaveEvent:return n.state.hasMemberStateEvent?n.state.delayId?n.sendScheduledDelayedLeaveEventOrFallbackToSendLeaveEvent(n.state.delayId):Go(ot.SendLeaveEvent):{replace:[]};case ot.SendJoinEvent:return n.sendJoinEvent();case ot.UpdateExpiry:return n.updateExpiryOnJoinedEvent();case ot.SendLeaveEvent:return n.state.hasMemberStateEvent?n.sendFallbackLeaveEvent():{replace:[]}}})()}sendOrResendDelayedLeaveEvent(){var e=this;return B(function*(){return yield e.client._unstable_sendDelayedStateEvent(e.room.roomId,{delay:e.delayedLeaveEventDelayMs},Z.GroupCallMemberPrefix,{},e.stateKey).then(n=>(e.state.expectedServerDelayLeaveTs=Date.now()+e.delayedLeaveEventDelayMs,e.setAndEmitProbablyLeft(!1),e.resetRateLimitCounter(ot.SendDelayedEvent),e.state.delayId=n.delay_id,e.state.hasMemberStateEvent?Go(ot.RestartDelayedEvent,e.delayedLeaveEventRestartMs):Go(ot.SendJoinEvent))).catch(n=>{var r=ot.SendDelayedEvent;if(e.manageMaxDelayExceededSituation(n))return Go(r);var i=e.actionUpdateFromErrors(n,r,"sendDelayedStateEvent");if(i)return i;if(e.state.hasMemberStateEvent){if(e.isUnsupportedDelayedEndpoint(n))return{};throw Error("Could not send delayed event, even though delayed events are supported. "+n)}else return e.isUnsupportedDelayedEndpoint(n)?e.logger.info("Not using delayed event because the endpoint is not supported"):e.logger.info("Not using delayed event because: "+n),Go(ot.SendJoinEvent)})})()}cancelKnownDelayIdBeforeSendDelayedEvent(e){var n=this;return B(function*(){return yield n.client._unstable_updateDelayedEvent(e,zE.Cancel).then(()=>(n.state.delayId=void 0,n.resetRateLimitCounter(ot.SendDelayedEvent),Mk(ot.SendDelayedEvent))).catch(r=>{var i=ot.SendDelayedEvent,s=n.actionUpdateFromErrors(r,i,"updateDelayedEvent");if(s)return s;if(n.isNotFoundError(r))return n.state.delayId=void 0,Mk(i);if(n.isUnsupportedDelayedEndpoint(r))return Mk(ot.SendJoinEvent);throw Error("We failed to cancel a delayed event where we already had a delay id with an error we cannot automatically handle")})})()}setAndEmitProbablyLeft(e){this.state.probablyLeft!==e&&(this.state.probablyLeft=e,this.emit(Hh.ProbablyLeft,this.state.probablyLeft))}restartDelayedEvent(e){var n=this;return B(function*(){var r=n.state.expectedServerDelayLeaveTs?n.state.expectedServerDelayLeaveTs-Date.now():void 0,i=new Promise((s,o)=>{setTimeout(()=>{o(new FX("Restart delayed event timed out before the HS responded"))},r!==void 0&&!n.state.probablyLeft?Math.min(n.delayedLeaveEventRestartLocalTimeoutMs,r):n.delayedLeaveEventRestartLocalTimeoutMs)});return yield Promise.race([n.client._unstable_updateDelayedEvent(e,zE.Restart),i]).then(()=>(n.state.expectedServerDelayLeaveTs=Date.now()+n.delayedLeaveEventDelayMs,n.resetRateLimitCounter(ot.RestartDelayedEvent),n.setAndEmitProbablyLeft(!1),Go(ot.RestartDelayedEvent,n.delayedLeaveEventRestartMs))).catch(s=>{n.state.expectedServerDelayLeaveTs&&n.state.expectedServerDelayLeaveTs<=Date.now()&&n.setAndEmitProbablyLeft(!0);var o=ot.RestartDelayedEvent;if(n.isNotFoundError(s))return n.state.delayId=void 0,Go(ot.SendDelayedEvent);if(n.isUnsupportedDelayedEndpoint(s))return{};var a=n.actionUpdateFromErrors(s,o,"updateDelayedEvent");if(a)return a;throw Error("Could not restart delayed event, even though delayed events are supported. "+s)})})()}sendScheduledDelayedLeaveEventOrFallbackToSendLeaveEvent(e){var n=this;return B(function*(){return yield n.client._unstable_updateDelayedEvent(e,zE.Send).then(()=>(n.state.hasMemberStateEvent=!1,n.resetRateLimitCounter(ot.SendScheduledDelayedLeaveEvent),{replace:[]})).catch(r=>{var i=ot.SendLeaveEvent;if(n.isUnsupportedDelayedEndpoint(r))return{};if(n.isNotFoundError(r))return n.state.delayId=void 0,Go(i);var s=n.actionUpdateFromErrors(r,i,"updateDelayedEvent");return s||(n.logger.warn("Encountered unexpected error during SendScheduledDelayedLeaveEvent. Falling back to SendLeaveEvent",r),Go(i))})})()}sendJoinEvent(){var e=this;return B(function*(){return yield e.client.sendStateEvent(e.room.roomId,Z.GroupCallMemberPrefix,e.makeMyMembership(e.membershipEventExpiryMs),e.stateKey).then(()=>{e.setAndEmitProbablyLeft(!1),e.state.startTime=Date.now(),e.state.expireUpdateIterations=1,e.state.hasMemberStateEvent=!0,e.resetRateLimitCounter(ot.SendJoinEvent);var n=e.scheduler.actions.filter(r=>r.type!==ot.UpdateExpiry&&r.type!==ot.SendJoinEvent);return{replace:[...n,{ts:Date.now(),type:ot.RestartDelayedEvent},{ts:e.computeNextExpiryActionTs(e.state.expireUpdateIterations),type:ot.UpdateExpiry}]}}).catch(n=>{var r=e.actionUpdateFromErrors(n,ot.SendJoinEvent,"sendStateEvent");if(r)return r;throw n})})()}updateExpiryOnJoinedEvent(){var e=this;return B(function*(){var n=e.state.expireUpdateIterations+1;return yield e.client.sendStateEvent(e.room.roomId,Z.GroupCallMemberPrefix,e.makeMyMembership(e.membershipEventExpiryMs*n),e.stateKey).then(()=>(e.resetRateLimitCounter(ot.UpdateExpiry),e.state.expireUpdateIterations=n,{insert:[{ts:e.computeNextExpiryActionTs(n),type:ot.UpdateExpiry}]})).catch(r=>{var i=e.actionUpdateFromErrors(r,ot.UpdateExpiry,"sendStateEvent");if(i)return i;throw r})})()}sendFallbackLeaveEvent(){var e=this;return B(function*(){return yield e.client.sendStateEvent(e.room.roomId,Z.GroupCallMemberPrefix,{},e.stateKey).then(()=>(e.resetRateLimitCounter(ot.SendLeaveEvent),e.state.hasMemberStateEvent=!1,{replace:[]})).catch(n=>{var r=e.actionUpdateFromErrors(n,ot.SendLeaveEvent,"sendStateEvent");if(r)return r;throw n})})()}makeMembershipStateKey(e,n){var r="".concat(e,"_").concat(n,"_").concat(this.sessionDescription.application).concat(this.sessionDescription.id);return/^org\.matrix\.msc(3757|3779)\b/.exec(this.room.getVersion())?r:"_".concat(r)}makeMyMembership(e){var n,r,i=!!this.ownMembership;return nye({application:this.sessionDescription.application,call_id:this.sessionDescription.id,scope:"m.room",device_id:this.deviceId,expires:e,focus_active:{type:"livekit",focus_selection:"oldest_membership"},foci_preferred:(n=this.fociPreferred)!==null&&n!==void 0?n:[],"m.call.intent":this.callIntent},i?{created_ts:(r=this.ownMembership)===null||r===void 0?void 0:r.createdTs()}:void 0)}isNotFoundError(e){return e instanceof tr&&e.errcode==="M_NOT_FOUND"}manageMaxDelayExceededSituation(e){if(e instanceof tr&&e.errcode==="M_UNKNOWN"&&e.data["org.matrix.msc4140.errcode"]==="M_MAX_DELAY_EXCEEDED"){var n=e.data["org.matrix.msc4140.max_delay"];return typeof n=="number"&&this.delayedLeaveEventDelayMs>n&&(this.delayedLeaveEventDelayMsOverride=n),this.logger.warn("Retry sending delayed disconnection event due to server timeout limitations:",e),!0}return!1}actionUpdateFromErrors(e,n,r){var i=this.actionUpdateFromRateLimitError(e,r,n);if(i)return i;var s=this.actionUpdateFromNetworkErrorRetry(e,n);if(s)return s}actionUpdateFromRateLimitError(e,n,r){var i;if((e instanceof ep||e instanceof tr)&&e.isRateLimitError()){var s=(i=this.state.rateLimitRetries.get(r))!==null&&i!==void 0?i:0;if(s<this.maximumRateLimitRetryCount){var o,a=5e3;try{var c;o=(c=e.getRetryAfterMs())!==null&&c!==void 0?c:a,this.logger.info("Rate limited by server, retrying in ".concat(o,"ms"))}catch(l){this.logger.warn("Error while retrieving a rate-limit retry delay, retrying after default delay of ".concat(a),l),o=a}return this.state.rateLimitRetries.set(r,s+1),Go(r,o)}throw Error("Exceeded maximum retries for "+r+" attempts (client."+n+"): "+e)}}actionUpdateFromNetworkErrorRetry(e,n){var r,i=(r=this.state.networkErrorRetries.get(n))!==null&&r!==void 0?r:0,s=this.networkErrorRetryMs/1e3+"s",o="("+i+"/"+this.maximumNetworkErrorRetryCount+")",a=this.networkErrorRetryMs;if(e instanceof Error&&e.name==="AbortError")a=0,this.logger.warn("Network local timeout error while sending event, immediate retry ("+o+")",e);else if(e instanceof Error&&e.message.includes("updating delayed event"))this.logger.warn("delayed event update timeout error, retrying in "+s+" "+o,e);else if(e instanceof wp)this.logger.warn("Network connection error while sending event, retrying in "+s+" "+o,e);else if((e instanceof ep||e instanceof tr)&&typeof e.httpStatus=="number"&&e.httpStatus>=500&&e.httpStatus<600)this.logger.warn("Server error while sending event, retrying in "+s+" "+o,e);else return;if(i<this.maximumNetworkErrorRetryCount)return this.state.networkErrorRetries.set(n,i+1),Go(n,a);throw Error("Reached maximum ("+this.maximumNetworkErrorRetryCount+") retries cause by: "+e)}isUnsupportedDelayedEndpoint(e){return e instanceof Gd}resetRateLimitCounter(e){this.state.rateLimitRetries.set(e,0),this.state.networkErrorRetries.set(e,0)}get status(){var e=this.scheduler.actions;if(e.length===1){var{type:n}=e[0];switch(n){case ot.SendDelayedEvent:case ot.SendJoinEvent:return Ad.Connecting;case ot.UpdateExpiry:return Ad.Connected;case ot.SendScheduledDelayedLeaveEvent:case ot.SendLeaveEvent:return Ad.Disconnecting}}else if(e.length===2){var r=e.map(s=>s.type);if((r.includes(ot.RestartDelayedEvent)||r.includes(ot.SendDelayedEvent)&&this.state.hasMemberStateEvent)&&r.includes(ot.UpdateExpiry))return Ad.Connected}else if(e.length===3){var i=e.map(s=>s.type);if(i.filter(s=>s===ot.RestartDelayedEvent).length===2&&i.includes(ot.UpdateExpiry))return Ad.Connected}return this.scheduler.running?(this.logger.error("MembershipManager has an unknown state. Actions: ",e),Ad.Unknown):Ad.Disconnected}get probablyLeft(){return this.state.probablyLeft}}function Go(t,e){return{insert:[{ts:Date.now()+(e??0),type:t}]}}function Mk(t,e){return{replace:[{ts:Date.now()+0,type:t}]}}var Wc=function(t){return t.ReceivedKeys="received_keys",t.NotSupportedError="not_supported_error",t}({});class rye{constructor(){L(this,"tsBuffer",new Map)}isOutdated(e,n){var r;this.tsBuffer.has(e)||this.tsBuffer.set(e,new Map);var i=(r=this.tsBuffer.get(e))===null||r===void 0?void 0:r.get(n.keyIndex);return i&&i>n.creationTS?!0:(this.tsBuffer.get(e).set(n.keyIndex,n.creationTS),!1)}}function Vh(t,e){return"".concat(t,":").concat(e)}class nQ extends Error{constructor(e){super(e)}get name(){return"NotSupportedError"}}class iye extends On{setParentLogger(e){this.logger=e.getChild("[ToDeviceKeyTransport]")}constructor(e,n,r,i,s,o){super(),this.userId=e,this.deviceId=n,this.roomId=r,this.client=i,this.statistics=s,L(this,"logger",M),L(this,"onToDeviceEvent",a=>{if(a.getType()===Z.CallEncryptionKeysPrefix){var c=this.getValidEventContent(a);c&&a.getSender()&&this.receiveCallKeyEvent(a.getSender(),c)}}),this.setParentLogger(o??M)}start(){this.client.on(Le.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.off(Le.ToDeviceEvent,this.onToDeviceEvent)}sendKey(e,n,r){var i=this;return B(function*(){var s={keys:{index:n,key:e},room_id:i.roomId,member:{claimed_device_id:i.deviceId},session:{call_id:"",application:"m.call",scope:"m.room"},sent_ts:Date.now()},o=r.map(a=>({userId:a.userId,deviceId:a.deviceId})).filter(a=>!(a.userId==i.userId&&a.deviceId==i.deviceId));o.length>0?(yield i.client.encryptAndSendToDevice(Z.CallEncryptionKeysPrefix,o,s).catch(a=>{var c=a.message;if(c.includes("unknown variant")&&c.includes("send_to_device")||c.includes("not supported"))throw new nQ("The widget driver does not support to-device encryption")}),i.statistics.counters.roomEventEncryptionKeysSent+=1):i.logger.warn("No targets found for sending key")})()}receiveCallKeyEvent(e,n){this.statistics.counters.roomEventEncryptionKeysReceived+=1;var r=Date.now(),i=r-(typeof n.sent_ts=="number"?n.sent_ts:r);this.statistics.totals.roomEventEncryptionKeysReceivedTotalAge+=i,this.emit(Wc.ReceivedKeys,e,n.member.claimed_device_id,n.keys.key,n.keys.index,r)}getValidEventContent(e){var n=e.getContent(),r=n.room_id;if(!r){this.logger.warn("Malformed Event: invalid call encryption keys event, no roomId");return}if(r!==this.roomId){this.logger.warn("Malformed Event: Mismatch roomId");return}if(!n.keys||!n.keys.key||typeof n.keys.index!="number"){this.logger.warn("Malformed Event: Missing keys field");return}if(!n.member||!n.member.claimed_device_id){this.logger.warn("Malformed Event: Missing claimed_device_id");return}return n}}var p_=function(t){return t.EnabledTransportsChanged="enabled_transports_changed",t}({});class n7 extends On{constructor(e,n,r){var i;super(),i=this,this.toDeviceTransport=e,this.roomKeyTransport=n,L(this,"logger",void 0),L(this,"_enabled",{toDevice:!0,room:!1}),this.logger=(r??M).getChild("[RoomAndToDeviceTransport]"),this.toDeviceTransport.setParentLogger(this.logger),this.roomKeyTransport.setParentLogger(this.logger),this.roomKeyTransport.on(Wc.ReceivedKeys,function(){i._enabled.room||(i.logger.debug("Received room key, enabling room key transport, disabling toDevice transport"),i.setEnabled({toDevice:!1,room:!0}));for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];i.emit(Wc.ReceivedKeys,...o)}),this.toDeviceTransport.on(Wc.ReceivedKeys,function(){if(i._enabled.toDevice){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];i.emit(Wc.ReceivedKeys,...o)}else i.logger.debug("To Device transport is disabled, ignoring received keys")})}setEnabled(e){(this.enabled.toDevice!==e.toDevice||this.enabled.room!==e.room)&&(this._enabled=e,this.emit(p_.EnabledTransportsChanged,e))}get enabled(){return this._enabled}start(){this.roomKeyTransport.start(),this.toDeviceTransport.start()}stop(){this.roomKeyTransport.stop(),this.toDeviceTransport.stop()}sendKey(e,n,r){var i=this;return B(function*(){if(i.logger.debug("Sending key with index ".concat(n," to call members (count=").concat(r.length,") via:")+(i._enabled.room?"room transport":"")+(i._enabled.room&&i._enabled.toDevice?"and":"")+(i._enabled.toDevice?"to device transport":"")),i._enabled.room&&(yield i.roomKeyTransport.sendKey(e,n,r)),i._enabled.toDevice)try{yield i.toDeviceTransport.sendKey(e,n,r)}catch(s){s instanceof nQ&&!i._enabled.room&&(i.logger.warn("To device is not supported enabling room key transport, disabling toDevice transport"),i.setEnabled({toDevice:!1,room:!0}),yield i.sendKey(e,n,r))}})()}}class sye{get updateEncryptionKeyThrottle(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.updateEncryptionKeyThrottle)!==null&&e!==void 0?e:3e3}get makeKeyDelay(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.makeKeyDelay)!==null&&e!==void 0?e:3e3}get useKeyDelay(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.useKeyDelay)!==null&&e!==void 0?e:5e3}constructor(e,n,r,i,s,o,a){var c=this;this.userId=e,this.deviceId=n,this.getMemberships=r,this.transport=i,this.statistics=s,this.onEncryptionKeysChanged=o,L(this,"manageMediaKeys",!1),L(this,"keysEventUpdateTimeout",void 0),L(this,"makeNewKeyTimeout",void 0),L(this,"setNewKeyTimeouts",new Set),L(this,"encryptionKeys",new Map),L(this,"lastEncryptionKeyUpdateRequest",void 0),L(this,"lastMembershipFingerprints",void 0),L(this,"latestGeneratedKeyIndex",-1),L(this,"joinConfig",void 0),L(this,"logger",void 0),L(this,"joined",!1),L(this,"sendEncryptionKeysEvent",function(){var l=B(function*(d){if(c.keysEventUpdateTimeout!==void 0&&(clearTimeout(c.keysEventUpdateTimeout),c.keysEventUpdateTimeout=void 0),c.lastEncryptionKeyUpdateRequest=Date.now(),!!c.joined){var h=c.getKeysForParticipant(c.userId,c.deviceId);if(!h){c.logger.warn("Tried to send encryption keys event but no keys found!");return}if(typeof d!="number"&&c.latestGeneratedKeyIndex===-1){c.logger.warn("Tried to send encryption keys event but no current key index found!");return}var m=d??c.latestGeneratedKeyIndex;c.logger.info("Try sending encryption keys event. keyIndexToSend=".concat(m," (method parameter: ").concat(d,")"));var g=h[m];try{c.statistics.counters.roomEventEncryptionKeysSent+=1;var y=c.getMemberships().filter(w=>w.sender!=null).map(w=>({userId:w.sender,deviceId:w.deviceId,membershipTs:w.createdTs()}));yield c.transport.sendKey($J(g),m,y),c.logger.debug("sendEncryptionKeysEvent participantId=".concat(c.userId,":").concat(c.deviceId," numKeys=").concat(h.length," currentKeyIndex=").concat(c.latestGeneratedKeyIndex," keyIndexToSend=").concat(m))}catch(w){if(c.keysEventUpdateTimeout===void 0){var v=HO(w,5e3);c.logger.warn("Failed to send m.call.encryption_key, retrying in ".concat(v),w),c.keysEventUpdateTimeout=setTimeout(()=>void c.sendEncryptionKeysEvent(),v)}else c.logger.info("Not scheduling key resend as another re-send is already pending")}}});return function(d){return l.apply(this,arguments)}}()),L(this,"onTransportChanged",()=>{this.requestSendCurrentKey()}),L(this,"onNewKeyReceived",(l,d,h,m,g)=>{this.logger.debug("Received key over key transport ".concat(l,":").concat(d," at index ").concat(m)),this.setEncryptionKey(l,d,m,h,g)}),L(this,"onRotateKeyTimeout",()=>{if(this.manageMediaKeys){this.makeNewKeyTimeout=void 0,this.logger.info("Making new sender key for key rotation");var l=this.makeNewSenderKey(!0);this.sendEncryptionKeysEvent(l)}}),this.logger=(a??M).getChild("[EncryptionManager]")}getEncryptionKeys(){var e=new Map;for(var[n,r]of this.encryptionKeys){var i=r.map((s,o)=>({key:s.key,keyIndex:o}));e.set(n,i)}return e}join(e){var n,r,i;this.joinConfig=e,this.joined=!0,this.manageMediaKeys=(n=(r=this.joinConfig)===null||r===void 0?void 0:r.manageMediaKeys)!==null&&n!==void 0?n:this.manageMediaKeys,this.transport.on(Wc.ReceivedKeys,this.onNewKeyReceived),this.transport instanceof n7&&this.transport.on(p_.EnabledTransportsChanged,this.onTransportChanged),this.transport.start(),(i=this.joinConfig)!==null&&i!==void 0&&i.manageMediaKeys&&(this.makeNewSenderKey(),this.requestSendCurrentKey())}leave(){this.encryptionKeys.set(Vh(this.userId,this.deviceId),[]),this.transport.off(Wc.ReceivedKeys,this.onNewKeyReceived),this.transport.stop(),this.makeNewKeyTimeout!==void 0&&(clearTimeout(this.makeNewKeyTimeout),this.makeNewKeyTimeout=void 0);for(var e of this.setNewKeyTimeouts)clearTimeout(e);this.setNewKeyTimeouts.clear(),this.manageMediaKeys=!1,this.joined=!1}onMembershipsUpdate(e){if(this.manageMediaKeys&&this.joined){var n=new Set(e.filter(l=>!WE(l,this.userId,this.deviceId)).map(Dk)),r=new Set(this.getMemberships().filter(l=>!WE(l,this.userId,this.deviceId)).map(Dk)),i=Array.from(n).some(l=>!r.has(l)),s=Array.from(r).some(l=>!n.has(l)),o=this.lastMembershipFingerprints;if(this.storeLastMembershipFingerprints(),i)this.makeNewKeyTimeout||(this.logger.debug("Member(s) have left: queueing sender key rotation"),this.makeNewKeyTimeout=setTimeout(this.onRotateKeyTimeout,this.makeKeyDelay));else if(s)this.logger.debug("New member(s) have joined: re-sending keys"),this.requestSendCurrentKey();else if(o){var a=this.lastMembershipFingerprints,c=Array.from(o).some(l=>!a.has(l))||Array.from(a).some(l=>!o.has(l));c&&(this.logger.debug("Member(s) have updated/reconnected: re-sending keys to everyone"),this.requestSendCurrentKey())}}}makeNewSenderKey(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=BJ(16),r=this.getNewEncryptionKeyIndex();return this.logger.info("Generated new key at index "+r),this.setEncryptionKey(this.userId,this.deviceId,r,n,Date.now(),e),r}requestSendCurrentKey(){if(this.manageMediaKeys){if(this.lastEncryptionKeyUpdateRequest&&this.lastEncryptionKeyUpdateRequest+this.updateEncryptionKeyThrottle>Date.now()){this.logger.info("Last encryption key event sent too recently: postponing"),this.keysEventUpdateTimeout===void 0&&(this.keysEventUpdateTimeout=setTimeout(()=>void this.sendEncryptionKeysEvent(),this.updateEncryptionKeyThrottle));return}this.sendEncryptionKeysEvent()}}getKeysForParticipant(e,n){var r;return(r=this.encryptionKeys.get(Vh(e,n)))===null||r===void 0?void 0:r.map(i=>i.key)}storeLastMembershipFingerprints(){this.lastMembershipFingerprints=new Set(this.getMemberships().filter(e=>!WE(e,this.userId,this.deviceId)).map(e=>"".concat(Dk(e),":").concat(e.createdTs())))}getNewEncryptionKeyIndex(){return this.latestGeneratedKeyIndex===-1?0:(this.latestGeneratedKeyIndex+1)%256}setEncryptionKey(e,n,r,i,s){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;this.logger.debug("Setting encryption key for ".concat(e,":").concat(n," at index ").concat(r));var a=Bh(i),c=Vh(e,n);this.encryptionKeys.has(c)||this.encryptionKeys.set(c,[]);var l=this.encryptionKeys.get(c),d=l[r];if(d){if(d.timestamp>s){this.logger.info("Ignoring new key at index ".concat(r," for ").concat(c," as it is older than existing known key"));return}if(oye(d.key,a)){d.timestamp=s;return}}if(e===this.userId&&n===this.deviceId&&(this.latestGeneratedKeyIndex=r),l[r]={key:a,timestamp:s},o){var h=setTimeout(()=>{this.setNewKeyTimeouts.delete(h),this.logger.info("Delayed-emitting key changed event for ".concat(c," index ").concat(r)),this.onEncryptionKeysChanged(a,r,c)},this.useKeyDelay);this.setNewKeyTimeouts.add(h)}else this.onEncryptionKeysChanged(a,r,c)}}function oye(t,e){return t===e?!0:!!t&&!!e&&t.length===e.length&&t.every((n,r)=>n===e[r])}var Dk=t=>Vh(t.sender,t.deviceId);class Q$ extends On{setParentLogger(e){this.logger=e.getChild("[RoomKeyTransport]")}constructor(e,n,r,i){super(),this.room=e,this.client=n,this.statistics=r,L(this,"logger",M),this.setParentLogger(i??M)}start(){this.room.on(ke.Timeline,e=>void this.consumeCallEncryptionEvent(e))}stop(){this.room.off(ke.Timeline,e=>void this.consumeCallEncryptionEvent(e))}consumeCallEncryptionEvent(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!1;if(yield r.client.decryptEventIfNeeded(e),e.isDecryptionFailure()){i?r.logger.warn("Decryption failed for event ".concat(e.getId(),": ").concat(e.decryptionFailureReason)):(r.logger.warn("Decryption failed for event ".concat(e.getId(),": ").concat(e.decryptionFailureReason," will retry once only")),setTimeout(()=>void r.consumeCallEncryptionEvent(e,!0),1e3));return}else i&&r.logger.info("Decryption succeeded for event ".concat(e.getId()," after retry"));if(e.getType()!==Z.CallEncryptionKeysPrefix)return Promise.resolve();if(!r.room)return r.logger.error("Got room state event for unknown room ".concat(e.getRoomId(),"!")),Promise.resolve();r.onEncryptionEvent(e)})()}sendKey(e,n,r){var i=this;return B(function*(){var s={keys:[{index:n,key:e}],device_id:i.client.getDeviceId(),call_id:"",sent_ts:Date.now()};try{yield i.client.sendEvent(i.room.roomId,Z.CallEncryptionKeysPrefix,s)}catch(a){i.logger.error("Failed to send call encryption keys",a);var o=a;throw o.event&&i.client.cancelPendingEvent(o.event),a}})()}onEncryptionEvent(e){var n=e.getSender(),r=e.getContent(),i=r.device_id,s=r.call_id;if(!n){this.logger.warn("Received m.call.encryption_keys with no userId: callId=".concat(s));return}if(s!==""){this.logger.warn("Received m.call.encryption_keys with unsupported callId: userId=".concat(n,", deviceId=").concat(i,", callId=").concat(s));return}if(!Array.isArray(r.keys)){this.logger.warn("Received m.call.encryption_keys where keys wasn't an array: callId=".concat(s));return}if(n===this.client.getUserId()&&i===this.client.getDeviceId()){this.logger.info("Ignoring our own keys event");return}this.statistics.counters.roomEventEncryptionKeysReceived+=1;var o=Date.now()-(typeof r.sent_ts=="number"?r.sent_ts:e.getTs());this.statistics.totals.roomEventEncryptionKeysReceivedTotalAge+=o;for(var a of r.keys){if(!a){this.logger.info("Ignoring false-y key in keys event");continue}var c=a.key,l=a.index;!c||l===void 0||l===null||s===void 0||s===null||typeof i!="string"||typeof s!="string"||typeof c!="string"||typeof l!="number"?this.logger.warn("Malformed call encryption_key: userId=".concat(n,", deviceId=").concat(i,", encryptionKeyIndex=").concat(l," callId=").concat(s)):(this.logger.debug("onCallEncryption userId=".concat(n,":").concat(i," encryptionKeyIndex=").concat(l," age=").concat(o,"ms")),this.emit(Wc.ReceivedKeys,n,i,c,l,e.getTs()))}}}class aye{constructor(e,n,r,i,s,o,a){this.userId=e,this.deviceId=n,this.getMemberships=r,this.transport=i,this.statistics=s,this.onEncryptionKeysChanged=o,L(this,"manageMediaKeys",!1),L(this,"participantKeyRings",new Map),L(this,"outboundSession",null),L(this,"currentKeyDistributionPromise",null),L(this,"useKeyDelay",5e3),L(this,"keyRotationGracePeriodMs",1e4),L(this,"needToEnsureKeyAgain",!1),L(this,"keyBuffer",new rye),L(this,"logger",void 0),L(this,"onTransportChanged",()=>{var c;(c=this.logger)===null||c===void 0||c.info("Transport change detected, restarting key distribution"),this.currentKeyDistributionPromise?this.currentKeyDistributionPromise.then(()=>{this.outboundSession&&(this.outboundSession.sharedWith=[],this.ensureKeyDistribution())}).catch(l=>{var d;(d=this.logger)===null||d===void 0||d.error("Failed to restart key distribution",l)}):this.outboundSession&&(this.outboundSession.sharedWith=[],this.ensureKeyDistribution())}),L(this,"onNewKeyReceived",(c,l,d,h,m)=>{var g;if(!this.manageMediaKeys){var y;(y=this.logger)===null||y===void 0||y.warn("Received key over transport ".concat(c,":").concat(l," at index ").concat(h," but media keys are disabled"));return}(g=this.logger)===null||g===void 0||g.debug("Received key over transport ".concat(c,":").concat(l," at index ").concat(h));var v=Vh(c,l),w=Bh(d),S={key:w,participantId:v,keyIndex:h,creationTS:m},R=this.keyBuffer.isOutdated(v,S);if(!R)this.addKeyToParticipant(S.key,S.keyIndex,S.participantId),this.statistics.counters.roomEventEncryptionKeysReceived+=1;else{var x;(x=this.logger)===null||x===void 0||x.info("Received an out of order key for ".concat(c,":").concat(l,", dropping it"))}}),this.logger=a?.getChild("[EncryptionManager]")}getEncryptionKeys(){return new Map(this.participantKeyRings)}addKeyToParticipant(e,n,r){this.participantKeyRings.has(r)||this.participantKeyRings.set(r,[]),this.participantKeyRings.get(r).push({key:e,keyIndex:n}),this.onEncryptionKeysChanged(e,n,r)}join(e){var n,r,i,s;this.manageMediaKeys=(n=e?.manageMediaKeys)!==null&&n!==void 0?n:!0,(r=this.logger)===null||r===void 0||r.info("Joining room"),this.useKeyDelay=(i=e?.useKeyDelay)!==null&&i!==void 0?i:1e3,this.keyRotationGracePeriodMs=(s=e?.keyRotationGracePeriodMs)!==null&&s!==void 0?s:1e4,this.transport.on(Wc.ReceivedKeys,this.onNewKeyReceived),this.transport instanceof n7&&this.transport.on(p_.EnabledTransportsChanged,this.onTransportChanged),this.transport.start()}leave(){this.transport.off(Wc.ReceivedKeys,this.onNewKeyReceived),this.transport.stop(),this.participantKeyRings.clear()}ensureKeyDistribution(){if(this.manageMediaKeys)if(this.currentKeyDistributionPromise==null){var e;(e=this.logger)===null||e===void 0||e.debug("No active rollout, start a new one"),this.currentKeyDistributionPromise=this.rolloutOutboundKey().then(()=>{var r;if((r=this.logger)===null||r===void 0||r.debug("Rollout completed"),this.currentKeyDistributionPromise=null,this.needToEnsureKeyAgain){var i;(i=this.logger)===null||i===void 0||i.debug("New Rollout needed"),this.needToEnsureKeyAgain=!1,this.ensureKeyDistribution()}})}else{var n;(n=this.logger)===null||n===void 0||n.debug("Rollout in progress, a new rollout will be started after the current one"),this.needToEnsureKeyAgain=!0}}onMembershipsUpdate(){var e;(e=this.logger)===null||e===void 0||e.trace("onMembershipsUpdate"),this.ensureKeyDistribution()}rolloutOutboundKey(){var e=this;return B(function*(){var n,r,i=e.outboundSession==null;i&&(e.outboundSession={key:e.generateRandomKey(),creationTS:Date.now(),sharedWith:[],keyId:0},e.addKeyToParticipant(e.outboundSession.key,e.outboundSession.keyId,Vh(e.userId,e.deviceId)));var s=e.getMemberships().filter(A=>A.sender!=null).map(A=>({userId:A.sender,deviceId:A.deviceId,membershipTs:A.createdTs()})),o=(n=(r=e.outboundSession)===null||r===void 0?void 0:r.sharedWith)!==null&&n!==void 0?n:[];o=o.filter(A=>!s.some(O=>A.userId==O.userId&&A.deviceId==O.deviceId&&A.membershipTs!=O.membershipTs));var a=o.filter(A=>!s.some(O=>A.userId==O.userId&&A.deviceId==O.deviceId&&A.membershipTs==O.membershipTs)),c=s.filter(A=>!o.some(O=>A.userId==O.userId&&A.deviceId==O.deviceId&&A.membershipTs==O.membershipTs)),l=[],d,h=!1;if(a.length>0){var m=e.createNewOutboundSession();h=!0,l=s,d=m}else if(c.length>0){var g=Date.now(),y=g-e.outboundSession.creationTS;if(y<e.keyRotationGracePeriodMs){var v;(v=e.logger)===null||v===void 0||v.debug("New joiners detected, but the key is recent enough (age:".concat(y,"), keeping it")),l=c,d=e.outboundSession}else{var w;(w=e.logger)===null||w===void 0||w.debug("New joiners detected, rotating the key");var S=e.createNewOutboundSession();h=!0,l=s,d=S}}else return;try{var R,x;if((R=e.logger)===null||R===void 0||R.trace("Sending key..."),yield e.transport.sendKey(Cy(d.key),d.keyId,l),e.statistics.counters.roomEventEncryptionKeysSent+=1,d.sharedWith.push(...l),(x=e.logger)===null||x===void 0||x.trace("key index:".concat(d.keyId," sent to ").concat(d.sharedWith.map(A=>"".concat(A.userId,":").concat(A.deviceId)).join(","))),h){var T,I;(T=e.logger)===null||T===void 0||T.trace("Delay Rollout for key:".concat(d.keyId,"...")),yield _p(e.useKeyDelay),(I=e.logger)===null||I===void 0||I.trace("...Delayed rollout of index:".concat(d.keyId," ")),e.addKeyToParticipant(d.key,d.keyId,Vh(e.userId,e.deviceId))}}catch(A){var k;(k=e.logger)===null||k===void 0||k.error("Failed to rollout key",A)}})()}createNewOutboundSession(){var e,n={key:this.generateRandomKey(),creationTS:Date.now(),sharedWith:[],keyId:this.nextKeyIndex()};return(e=this.logger)===null||e===void 0||e.info("creating new outbound key index:".concat(n.keyId)),this.outboundSession=n,n}nextKeyIndex(){return this.outboundSession?(this.outboundSession.keyId+1)%256:0}generateRandomKey(){var e=new Uint8Array(16);return globalThis.crypto.getRandomValues(e),e}}function Z$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function P2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Z$(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Z$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var ei=function(t){return t.MembershipsChanged="memberships_changed",t.JoinStateChanged="join_state_changed",t.EncryptionKeyChanged="encryption_key_changed",t.MembershipManagerError="membership_manager_error",t.DidSendCallNotification="did_send_call_notification",t}({});class Zl extends On{get membershipStatus(){var e;return(e=this.membershipManager)===null||e===void 0?void 0:e.status}get probablyLeft(){var e;return(e=this.membershipManager)===null||e===void 0?void 0:e.probablyLeft}get callId(){return this._callId}static callMembershipsForRoom(e){return Zl.sessionMembershipsForRoom(e,{id:"",application:"m.call"})}static sessionMembershipsForRoom(e,n){var r=M.getChild("[MatrixRTCSession ".concat(e.roomId,"]")),i=e.getLiveTimeline().getState(Me.FORWARDS);if(!i)throw r.warn("Couldn't get state for room "+e.roomId),new Error("Could't get state for room "+e.roomId);var s=i.getStateEvents(Z.GroupCallMemberPrefix),o=[];for(var a of s){var c=a.getContent(),l=Object.keys(c).length;if(l!==0){var d=[];if(l>1&&"focus_active"in c?d.push(c):l===1&&"memberships"in c&&r.warn("Legacy event found. Those are ignored, they do not contribute to the MatrixRTC session"),d.length!==0)for(var h of d)try{var m,g=new X$(a,h);if(!ff(g.sessionDescription,n)){r.info("Ignoring membership of user ".concat(g.sender," for a different session:  ").concat(JSON.stringify(g.sessionDescription)));continue}if(g.isExpired()){r.info("Ignoring expired device membership ".concat(g.sender,"/").concat(g.deviceId));continue}if(!e.hasMembershipState((m=g.sender)!==null&&m!==void 0?m:"",Be.Join)){r.info("Ignoring membership of user ".concat(g.sender," who is not in the room."));continue}o.push(g)}catch(y){r.warn("Couldn't construct call membership: ",y)}}}return o.sort((y,v)=>y.createdTs()-v.createdTs()),o.length>1&&r.debug("Call memberships in room ".concat(e.roomId,", in order: "),o.map(y=>[y.createdTs(),y.sender])),o}static roomSessionForRoom(e,n){var r=Zl.sessionMembershipsForRoom(n,{id:"",application:"m.call"});return new Zl(e,n,r,{id:"",application:"m.call"})}static sessionForRoom(e,n,r){var i=Zl.sessionMembershipsForRoom(n,r);return new Zl(e,n,i,r)}get room(){return this.roomSubset}constructor(e,n,r,i){var s;super(),this.client=e,this.roomSubset=n,this.memberships=r,this.sessionDescription=i,L(this,"membershipManager",void 0),L(this,"encryptionManager",void 0),L(this,"_callId",void 0),L(this,"joinConfig",void 0),L(this,"logger",void 0),L(this,"pendingNotificationToSend",void 0),L(this,"expiryTimeout",void 0),L(this,"statistics",{counters:{roomEventEncryptionKeysSent:0,roomEventEncryptionKeysReceived:0},totals:{roomEventEncryptionKeysReceivedTotalAge:0}}),L(this,"reEmitter",new $v(this)),L(this,"onRoomMemberUpdate",()=>{this.recalculateSessionMembers()}),L(this,"onRTCSessionMemberUpdate",()=>{this.recalculateSessionMembers()}),L(this,"recalculateSessionMembers",()=>{var a,c,l,d=this.memberships;this.memberships=Zl.sessionMembershipsForRoom(this.room,this.sessionDescription),this._callId=(a=this._callId)!==null&&a!==void 0?a:(c=this.memberships[0])===null||c===void 0?void 0:c.sessionDescription.id;var h=d.length!=this.memberships.length||d.some((w,S)=>!X$.equal(w,this.memberships[S]));if(h){var m,g;this.logger.info("Memberships for call in room ".concat(this.roomSubset.roomId," have changed: emitting (").concat(this.memberships.length," members)")),gve(this.logger,"emit MatrixRTCSessionEvent.MembershipsChanged",()=>{this.emit(ei.MembershipsChanged,d,this.memberships)}),(m=this.membershipManager)===null||m===void 0||m.onRTCSessionMemberUpdate(this.memberships);var y=(g=this.membershipManager)===null||g===void 0?void 0:g.ownMembership;if(this.pendingNotificationToSend&&y&&d.length===0){var v;y.eventId&&(v=this.joinConfig)!==null&&v!==void 0&&v.notificationType?this.sendCallNotify(y.eventId,this.joinConfig.notificationType,y.callIntent):this.logger.warn("Own membership eventId is undefined, cannot send call notification")}this.memberships.length>0&&(this.pendingNotificationToSend=void 0)}(l=this.encryptionManager)===null||l===void 0||l.onMembershipsUpdate(d),this.setExpiryTimer()}),this.logger=M.getChild("[MatrixRTCSession ".concat(n.roomId,"]")),this._callId=(s=r[0])===null||s===void 0?void 0:s.sessionDescription.id;var o=this.roomSubset.getLiveTimeline().getState(Me.FORWARDS);o?.on(pt.Members,this.onRoomMemberUpdate),this.setExpiryTimer()}isJoined(){var e,n;return(e=(n=this.membershipManager)===null||n===void 0?void 0:n.isJoined())!==null&&e!==void 0?e:!1}stop(){var e=this;return B(function*(){var n;yield(n=e.membershipManager)===null||n===void 0?void 0:n.leave(1e3),e.expiryTimeout&&(clearTimeout(e.expiryTimeout),e.expiryTimeout=void 0);var r=e.roomSubset.getLiveTimeline().getState(Me.FORWARDS);r?.off(pt.Members,e.onRoomMemberUpdate)})()}joinRoomSession(e,n,r){var i;if(this.isJoined()){this.logger.info("Already joined to session in room ".concat(this.roomSubset.roomId,": ignoring join call"));return}else{this.membershipManager=new fC(r,this.roomSubset,this.client,()=>this.getOldestMembership(),this.sessionDescription,this.logger),this.reEmitter.reEmit(this.membershipManager,[Hh.ProbablyLeft,Hh.StatusChanged]);var s;if(r!=null&&r.useExperimentalToDeviceTransport){this.logger.info("Using experimental to-device transport for encryption keys"),this.logger.info("Using to-device with room fallback transport for encryption keys");var[o,a]=[this.client.getUserId(),this.client.getDeviceId()],[c,l,d]=[this.roomSubset,this.client,this.statistics],h=new Q$(c,l,d),m=new iye(o,a,c.roomId,l,d);s=new n7(m,h,this.logger),this.reEmitter.reEmit(s,[p_.EnabledTransportsChanged]),this.encryptionManager=new aye(this.client.getUserId(),this.client.getDeviceId(),()=>this.memberships,s,this.statistics,(g,y,v)=>{this.emit(ei.EncryptionKeyChanged,g,y,v)},this.logger)}else s=new Q$(this.roomSubset,this.client,this.statistics),this.encryptionManager=new sye(this.client.getUserId(),this.client.getDeviceId(),()=>this.memberships,s,this.statistics,(g,y,v)=>{this.emit(ei.EncryptionKeyChanged,g,y,v)})}this.joinConfig=r,this.pendingNotificationToSend=(i=this.joinConfig)===null||i===void 0?void 0:i.notificationType,this.membershipManager.join(e,n,g=>{this.logger.error("MembershipManager encountered an unrecoverable error: ",g),this.emit(ei.MembershipManagerError,g),this.emit(ei.JoinStateChanged,this.isJoined())}),this.encryptionManager.join(r),this.emit(ei.JoinStateChanged,!0)}leaveRoomSession(){var e=arguments,n=this;return B(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:void 0;if(!n.isJoined())return n.logger.info("Not joined to session in room ".concat(n.roomSubset.roomId,": ignoring leave call")),!1;n.logger.info("Leaving call session in room ".concat(n.roomSubset.roomId)),n.encryptionManager.leave();var i=n.membershipManager.leave(r);return n.emit(ei.JoinStateChanged,!1),yield i})()}getActiveFocus(){var e;return(e=this.membershipManager)===null||e===void 0?void 0:e.getActiveFocus()}getOldestMembership(){return this.memberships[0]}getConsensusCallIntent(){var e,n=(e=this.memberships.find(r=>!!r.callIntent))===null||e===void 0?void 0:e.callIntent;if(n&&this.memberships.every(r=>!r.callIntent||r.callIntent===n))return n}updateCallIntent(e){var n=this;return B(function*(){var r,i,s=(r=n.membershipManager)===null||r===void 0?void 0:r.ownMembership;if(!s)throw Error("Not connected yet");yield(i=n.membershipManager)===null||i===void 0?void 0:i.updateCallIntent(e)})()}getFocusInUse(){var e=this.getOldestMembership();if(e?.getFocusSelection()==="oldest_membership")return e.getPreferredFoci()[0]}reemitEncryptionKeys(){var e;(e=this.encryptionManager)===null||e===void 0||e.getEncryptionKeys().forEach((n,r)=>{n.forEach(i=>{this.emit(ei.EncryptionKeyChanged,i.key,i.keyIndex,r)})})}setExpiryTimer(){this.expiryTimeout&&(clearTimeout(this.expiryTimeout),this.expiryTimeout=void 0);var e;for(var n of this.memberships){var r=n.getMsUntilExpiry();r!==void 0&&(e===void 0||r<e)&&(e=r)}e!=null&&(this.expiryTimeout=setTimeout(this.onRTCSessionMemberUpdate,e))}sendCallNotify(e,n,r){var i=this,s=function(){var a=B(function*(){var c={application:"m.call","m.mentions":{user_ids:[],room:!0},notify_type:n==="notification"?"notify":n,call_id:i.callId},l=yield i.client.sendEvent(i.roomSubset.roomId,Z.CallNotify,c);return{response:l,content:c}});return function(){return a.apply(this,arguments)}}(),o=function(){var a=B(function*(){var c={"m.mentions":{user_ids:[],room:!0},notification_type:n,"m.relates_to":{event_id:e,rel_type:vn.Reference},sender_ts:Date.now(),lifetime:3e4};r&&(c["m.call.intent"]=r);var l=yield i.client.sendEvent(i.roomSubset.roomId,Z.RTCNotification,c);return{response:l,content:c}});return function(){return a.apply(this,arguments)}}();Promise.all([s(),o()]).then(a=>{var[c,l]=a,d=P2(P2({},c.response),c.content),h=P2(P2({},l.response),l.content);this.emit(ei.DidSendCallNotification,h,d)}).catch(a=>{var[c,l]=a;return this.logger.error("Failed to send call notification",c,l)})}}var hC=function(t){return t.SessionStarted="session_started",t.SessionEnded="session_ended",t}({});class cye extends On{constructor(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{id:"",application:"m.call"};super(),this.client=n,this.sessionDescription=r,L(this,"roomSessions",new Map),L(this,"logger",void 0),L(this,"onRoom",i=>{this.refreshRoom(i)}),L(this,"onRoomState",(i,s)=>{var o=this.client.getRoom(i.getRoomId());if(!o){this.logger.error("Got room state event for unknown room ".concat(i.getRoomId(),"!"));return}i.getType()==Z.GroupCallMemberPrefix&&this.refreshRoom(o)}),this.logger=e.getChild("[MatrixRTCSessionManager]")}start(){for(var e of(n=this.client.getRooms())!==null&&n!==void 0?n:[]){var n,r=Zl.sessionForRoom(this.client,e,this.sessionDescription);r.memberships.length>0&&this.roomSessions.set(e.roomId,r)}this.client.on(Le.Room,this.onRoom),this.client.on(pt.Events,this.onRoomState)}stop(){for(var e of this.roomSessions.values())e.stop();this.roomSessions.clear(),this.client.off(Le.Room,this.onRoom),this.client.off(pt.Events,this.onRoomState)}getActiveRoomSession(e){return this.roomSessions.get(e.roomId)}getRoomSession(e){return this.roomSessions.has(e.roomId)||this.roomSessions.set(e.roomId,Zl.sessionForRoom(this.client,e,this.sessionDescription)),this.roomSessions.get(e.roomId)}refreshRoom(e){var n=!this.roomSessions.has(e.roomId),r=this.getRoomSession(e),i=r.memberships.length>0&&!n;r.onRTCSessionMemberUpdate();var s=r.memberships.length>0;i&&!s?(this.logger.trace("Session ended for ".concat(e.roomId," (").concat(r.memberships.length," members)")),this.emit(hC.SessionEnded,e.roomId,this.roomSessions.get(e.roomId))):!i&&s&&(this.logger.trace("Session started for ".concat(e.roomId," (").concat(r.memberships.length," members)")),this.emit(hC.SessionStarted,e.roomId,this.roomSessions.get(e.roomId)))}}function Nk(t){return e=>{var n,r;return((n=e.content)===null||n===void 0||(n=n["m.relates_to"])===null||n===void 0?void 0:n.event_id)!==t||((r=e.content)===null||r===void 0||(r=r["m.relates_to"])===null||r===void 0?void 0:r.rel_type)===wn.name}}function rQ(t){return _A.apply(this,arguments)}function _A(){return _A=B(function*(t){if(!globalThis.crypto.subtle)throw new Error("Crypto.subtle is not available: insecure context?");var e=new TextEncoder().encode(t),n=yield globalThis.crypto.subtle.digest("SHA-256",e);return new Uint8Array(n)}),_A.apply(this,arguments)}class dy extends Error{}dy.prototype.name="InvalidTokenError";function lye(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,n)=>{let r=n.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function uye(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return lye(e)}catch{return atob(e)}}function iQ(t,e){if(typeof t!="string")throw new dy("Invalid token specified: must be a string");e||(e={});const n=e.header===!0?0:1,r=t.split(".")[n];if(typeof r!="string")throw new dy(`Invalid token specified: missing part #${n+1}`);let i;try{i=uye(r)}catch(s){throw new dy(`Invalid token specified: invalid base64 for part #${n+1} (${s.message})`)}try{return JSON.parse(i)}catch(s){throw new dy(`Invalid token specified: invalid json for part #${n+1} (${s.message})`)}}var dye={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},Uc,jc,pb=(t=>(t[t.NONE=0]="NONE",t[t.ERROR=1]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG",t))(pb||{});(t=>{function e(){Uc=3,jc=dye}t.reset=e;function n(i){if(!(0<=i&&i<=4))throw new Error("Invalid log level");Uc=i}t.setLevel=n;function r(i){jc=i}t.setLogger=r})(pb||(pb={}));var kr=class Oc{constructor(e){this._name=e}debug(...e){Uc>=4&&jc.debug(Oc._format(this._name,this._method),...e)}info(...e){Uc>=3&&jc.info(Oc._format(this._name,this._method),...e)}warn(...e){Uc>=2&&jc.warn(Oc._format(this._name,this._method),...e)}error(...e){Uc>=1&&jc.error(Oc._format(this._name,this._method),...e)}throw(e){throw this.error(e),e}create(e){const n=Object.create(this);return n._method=e,n.debug("begin"),n}static createStatic(e,n){const r=new Oc(`${e}.${n}`);return r.debug("begin"),r}static _format(e,n){const r=`[${e}]`;return n?`${r} ${n}:`:r}static debug(e,...n){Uc>=4&&jc.debug(Oc._format(e),...n)}static info(e,...n){Uc>=3&&jc.info(Oc._format(e),...n)}static warn(e,...n){Uc>=2&&jc.warn(Oc._format(e),...n)}static error(e,...n){Uc>=1&&jc.error(Oc._format(e),...n)}};pb.reset();var pC=class{static decode(t){try{return iQ(t)}catch(e){throw kr.error("JwtUtils.decode",e),e}}static async generateSignedJwt(t,e,n){const r=nc.encodeBase64Url(new TextEncoder().encode(JSON.stringify(t))),i=nc.encodeBase64Url(new TextEncoder().encode(JSON.stringify(e))),s=`${r}.${i}`,o=await window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,new TextEncoder().encode(s)),a=nc.encodeBase64Url(new Uint8Array(o));return`${s}.${a}`}},fye="10000000-1000-4000-8000-100000000000",SA=t=>btoa([...new Uint8Array(t)].map(e=>String.fromCharCode(e)).join("")),sQ=class Mc{static _randomWord(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}static generateUUIDv4(){return fye.replace(/[018]/g,n=>(+n^Mc._randomWord()&15>>+n/4).toString(16)).replace(/-/g,"")}static generateCodeVerifier(){return Mc.generateUUIDv4()+Mc.generateUUIDv4()+Mc.generateUUIDv4()}static async generateCodeChallenge(e){if(!crypto.subtle)throw new Error("Crypto.subtle is available only in secure contexts (HTTPS).");try{const r=new TextEncoder().encode(e),i=await crypto.subtle.digest("SHA-256",r);return SA(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(n){throw kr.error("CryptoUtils.generateCodeChallenge",n),n}}static generateBasicAuth(e,n){const i=new TextEncoder().encode([e,n].join(":"));return SA(i)}static async hash(e,n){const r=new TextEncoder().encode(n),i=await crypto.subtle.digest(e,r);return new Uint8Array(i)}static async customCalculateJwkThumbprint(e){let n;switch(e.kty){case"RSA":n={e:e.e,kty:e.kty,n:e.n};break;case"EC":n={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":n={crv:e.crv,kty:e.kty,x:e.x};break;case"oct":n={crv:e.k,kty:e.kty};break;default:throw new Error("Unknown jwk type")}const r=await Mc.hash("SHA-256",JSON.stringify(n));return Mc.encodeBase64Url(r)}static async generateDPoPProof({url:e,accessToken:n,httpMethod:r,keyPair:i,nonce:s}){let o,a;const c={jti:window.crypto.randomUUID(),htm:r??"GET",htu:e,iat:Math.floor(Date.now()/1e3)};n&&(o=await Mc.hash("SHA-256",n),a=Mc.encodeBase64Url(o),c.ath=a),s&&(c.nonce=s);try{const l=await crypto.subtle.exportKey("jwk",i.publicKey),d={alg:"ES256",typ:"dpop+jwt",jwk:{crv:l.crv,kty:l.kty,x:l.x,y:l.y}};return await pC.generateSignedJwt(d,c,i.privateKey)}catch(l){throw l instanceof TypeError?new Error(`Error exporting dpop public key: ${l.message}`):l}}static async generateDPoPJkt(e){try{const n=await crypto.subtle.exportKey("jwk",e.publicKey);return await Mc.customCalculateJwkThumbprint(n)}catch(n){throw n instanceof TypeError?new Error(`Could not retrieve dpop keys from storage: ${n.message}`):n}}static async generateDPoPKeys(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign","verify"])}};sQ.encodeBase64Url=t=>SA(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var nc=sQ,hye=class{constructor(e){this._name=e,this._callbacks=[],this._logger=new kr(`Event('${this._name}')`)}addHandler(e){return this._callbacks.push(e),()=>this.removeHandler(e)}removeHandler(e){const n=this._callbacks.lastIndexOf(e);n>=0&&this._callbacks.splice(n,1)}async raise(...e){this._logger.debug("raise:",...e);for(const n of this._callbacks)await n(...e)}},mC=class YE extends hye{constructor(){super(...arguments),this._logger=new kr(`Timer('${this._name}')`),this._timerHandle=null,this._expiration=0,this._callback=()=>{const e=this._expiration-YE.getEpochTime();this._logger.debug("timer completes in",e),this._expiration<=YE.getEpochTime()&&(this.cancel(),super.raise())}}static getEpochTime(){return Math.floor(Date.now()/1e3)}init(e){const n=this._logger.create("init");e=Math.max(Math.floor(e),1);const r=YE.getEpochTime()+e;if(this.expiration===r&&this._timerHandle){n.debug("skipping since already initialized for expiration at",this.expiration);return}this.cancel(),n.debug("using duration",e),this._expiration=r;const i=Math.min(e,5);this._timerHandle=setInterval(this._callback,i*1e3)}get expiration(){return this._expiration}cancel(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}},eB=class{static readParams(t,e="query"){if(!t)throw new TypeError("Invalid URL");const r=new URL(t,"http://127.0.0.1")[e==="fragment"?"hash":"search"];return new URLSearchParams(r.slice(1))}},EA=";",iv=class extends Error{constructor(t,e){var n,r,i;if(super(t.error_description||t.error||""),this.form=e,this.name="ErrorResponse",!t.error)throw kr.error("ErrorResponse","No error passed"),new Error("No error passed");this.error=t.error,this.error_description=(n=t.error_description)!=null?n:null,this.error_uri=(r=t.error_uri)!=null?r:null,this.state=t.userState,this.session_state=(i=t.session_state)!=null?i:null,this.url_state=t.url_state}},pye=class extends Error{constructor(t){super(t),this.name="ErrorTimeout"}},mye=class{constructor(){this._logger=new kr("InMemoryWebStorage"),this._data={}}clear(){this._logger.create("clear"),this._data={}}getItem(t){return this._logger.create(`getItem('${t}')`),this._data[t]}setItem(t,e){this._logger.create(`setItem('${t}')`),this._data[t]=e}removeItem(t){this._logger.create(`removeItem('${t}')`),delete this._data[t]}get length(){return Object.getOwnPropertyNames(this._data).length}key(t){return Object.getOwnPropertyNames(this._data)[t]}},wA=class extends Error{constructor(t,e){super(e),this.name="ErrorDPoPNonce",this.nonce=t}},r7=class{constructor(t=[],e=null,n={}){this._jwtHandler=e,this._extraHeaders=n,this._logger=new kr("JsonService"),this._contentTypes=[],this._contentTypes.push(...t,"application/json"),e&&this._contentTypes.push("application/jwt")}async fetchWithTimeout(t,e={}){const{timeoutInSeconds:n,...r}=e;if(!n)return await fetch(t,r);const i=new AbortController,s=setTimeout(()=>i.abort(),n*1e3);try{return await fetch(t,{...e,signal:i.signal})}catch(o){throw o instanceof DOMException&&o.name==="AbortError"?new pye("Network timed out"):o}finally{clearTimeout(s)}}async getJson(t,{token:e,credentials:n,timeoutInSeconds:r}={}){const i=this._logger.create("getJson"),s={Accept:this._contentTypes.join(", ")};e&&(i.debug("token passed, setting Authorization header"),s.Authorization="Bearer "+e),this.appendExtraHeaders(s);let o;try{i.debug("url:",t),o=await this.fetchWithTimeout(t,{method:"GET",headers:s,timeoutInSeconds:r,credentials:n})}catch(l){throw i.error("Network Error"),l}i.debug("HTTP response received, status",o.status);const a=o.headers.get("Content-Type");if(a&&!this._contentTypes.find(l=>a.startsWith(l))&&i.throw(new Error(`Invalid response Content-Type: ${a??"undefined"}, from URL: ${t}`)),o.ok&&this._jwtHandler&&a?.startsWith("application/jwt"))return await this._jwtHandler(await o.text());let c;try{c=await o.json()}catch(l){throw i.error("Error parsing JSON response",l),o.ok?l:new Error(`${o.statusText} (${o.status})`)}if(!o.ok)throw i.error("Error from server:",c),c.error?new iv(c):new Error(`${o.statusText} (${o.status}): ${JSON.stringify(c)}`);return c}async postForm(t,{body:e,basicAuth:n,timeoutInSeconds:r,initCredentials:i,extraHeaders:s}){const o=this._logger.create("postForm"),a={Accept:this._contentTypes.join(", "),"Content-Type":"application/x-www-form-urlencoded",...s};n!==void 0&&(a.Authorization="Basic "+n),this.appendExtraHeaders(a);let c;try{o.debug("url:",t),c=await this.fetchWithTimeout(t,{method:"POST",headers:a,body:e,timeoutInSeconds:r,credentials:i})}catch(m){throw o.error("Network error"),m}o.debug("HTTP response received, status",c.status);const l=c.headers.get("Content-Type");if(l&&!this._contentTypes.find(m=>l.startsWith(m)))throw new Error(`Invalid response Content-Type: ${l??"undefined"}, from URL: ${t}`);const d=await c.text();let h={};if(d)try{h=JSON.parse(d)}catch(m){throw o.error("Error parsing JSON response",m),c.ok?m:new Error(`${c.statusText} (${c.status})`)}if(!c.ok){if(o.error("Error from server:",h),c.headers.has("dpop-nonce")){const m=c.headers.get("dpop-nonce");throw new wA(m,`${JSON.stringify(h)}`)}throw h.error?new iv(h,e):new Error(`${c.statusText} (${c.status}): ${JSON.stringify(h)}`)}return h}appendExtraHeaders(t){const e=this._logger.create("appendExtraHeaders"),n=Object.keys(this._extraHeaders),r=["authorization","accept","content-type"];n.length!==0&&n.forEach(i=>{if(r.includes(i.toLocaleLowerCase())){e.warn("Protected header could not be overridden",i,r);return}const s=typeof this._extraHeaders[i]=="function"?this._extraHeaders[i]():this._extraHeaders[i];s&&s!==""&&(t[i]=s)})}},oQ=class{constructor(t){this._settings=t,this._logger=new kr("MetadataService"),this._signingKeys=null,this._metadata=null,this._metadataUrl=this._settings.metadataUrl,this._jsonService=new r7(["application/jwk-set+json"],null,this._settings.extraHeaders),this._settings.signingKeys&&(this._logger.debug("using signingKeys from settings"),this._signingKeys=this._settings.signingKeys),this._settings.metadata&&(this._logger.debug("using metadata from settings"),this._metadata=this._settings.metadata),this._settings.fetchRequestCredentials&&(this._logger.debug("using fetchRequestCredentials from settings"),this._fetchRequestCredentials=this._settings.fetchRequestCredentials)}resetSigningKeys(){this._signingKeys=null}async getMetadata(){const t=this._logger.create("getMetadata");if(this._metadata)return t.debug("using cached values"),this._metadata;if(!this._metadataUrl)throw t.throw(new Error("No authority or metadataUrl configured on settings")),null;t.debug("getting metadata from",this._metadataUrl);const e=await this._jsonService.getJson(this._metadataUrl,{credentials:this._fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return t.debug("merging remote JSON with seed metadata"),this._metadata=Object.assign({},this._settings.metadataSeed,e),this._metadata}getIssuer(){return this._getMetadataProperty("issuer")}getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")}getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")}getTokenEndpoint(t=!0){return this._getMetadataProperty("token_endpoint",t)}getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)}getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)}getRevocationEndpoint(t=!0){return this._getMetadataProperty("revocation_endpoint",t)}getKeysEndpoint(t=!0){return this._getMetadataProperty("jwks_uri",t)}async _getMetadataProperty(t,e=!1){const n=this._logger.create(`_getMetadataProperty('${t}')`),r=await this.getMetadata();if(n.debug("resolved"),r[t]===void 0){if(e===!0){n.warn("Metadata does not contain optional property");return}n.throw(new Error("Metadata does not contain property "+t))}return r[t]}async getSigningKeys(){const t=this._logger.create("getSigningKeys");if(this._signingKeys)return t.debug("returning signingKeys from cache"),this._signingKeys;const e=await this.getKeysEndpoint(!1);t.debug("got jwks_uri",e);const n=await this._jsonService.getJson(e,{timeoutInSeconds:this._settings.requestTimeoutInSeconds});if(t.debug("got key set",n),!Array.isArray(n.keys))throw t.throw(new Error("Missing keys on keyset")),null;return this._signingKeys=n.keys,this._signingKeys}},rT=class{constructor({prefix:t="oidc.",store:e=localStorage}={}){this._logger=new kr("WebStorageStateStore"),this._store=e,this._prefix=t}async set(t,e){this._logger.create(`set('${t}')`),t=this._prefix+t,await this._store.setItem(t,e)}async get(t){return this._logger.create(`get('${t}')`),t=this._prefix+t,await this._store.getItem(t)}async remove(t){this._logger.create(`remove('${t}')`),t=this._prefix+t;const e=await this._store.getItem(t);return await this._store.removeItem(t),e}async getAllKeys(){this._logger.create("getAllKeys");const t=await this._store.length,e=[];for(let n=0;n<t;n++){const r=await this._store.key(n);r&&r.indexOf(this._prefix)===0&&e.push(r.substr(this._prefix.length))}return e}},gye="code",vye="openid",yye="client_secret_post",bye=60*15,CA=class{constructor({authority:t,metadataUrl:e,metadata:n,signingKeys:r,metadataSeed:i,client_id:s,client_secret:o,response_type:a=gye,scope:c=vye,redirect_uri:l,post_logout_redirect_uri:d,client_authentication:h=yye,prompt:m,display:g,max_age:y,ui_locales:v,acr_values:w,resource:S,response_mode:R,filterProtocolClaims:x=!0,loadUserInfo:T=!1,requestTimeoutInSeconds:I,staleStateAgeInSeconds:k=bye,mergeClaimsStrategy:A={array:"replace"},disablePKCE:O=!1,stateStore:D,revokeTokenAdditionalContentTypes:N,fetchRequestCredentials:U,refreshTokenAllowedScope:$,extraQueryParams:K={},extraTokenParams:Y={},extraHeaders:G={},dpop:F,omitScopeWhenRequesting:q=!1}){var z;if(this.authority=t,e?this.metadataUrl=e:(this.metadataUrl=t,t&&(this.metadataUrl.endsWith("/")||(this.metadataUrl+="/"),this.metadataUrl+=".well-known/openid-configuration")),this.metadata=n,this.metadataSeed=i,this.signingKeys=r,this.client_id=s,this.client_secret=o,this.response_type=a,this.scope=c,this.redirect_uri=l,this.post_logout_redirect_uri=d,this.client_authentication=h,this.prompt=m,this.display=g,this.max_age=y,this.ui_locales=v,this.acr_values=w,this.resource=S,this.response_mode=R,this.filterProtocolClaims=x??!0,this.loadUserInfo=!!T,this.staleStateAgeInSeconds=k,this.mergeClaimsStrategy=A,this.omitScopeWhenRequesting=q,this.disablePKCE=!!O,this.revokeTokenAdditionalContentTypes=N,this.fetchRequestCredentials=U||"same-origin",this.requestTimeoutInSeconds=I,D)this.stateStore=D;else{const W=typeof window<"u"?window.localStorage:new mye;this.stateStore=new rT({store:W})}if(this.refreshTokenAllowedScope=$,this.extraQueryParams=K,this.extraTokenParams=Y,this.extraHeaders=G,this.dpop=F,this.dpop&&!((z=this.dpop)!=null&&z.store))throw new Error("A DPoPStore is required when dpop is enabled")}},_ye=class{constructor(t,e){this._settings=t,this._metadataService=e,this._logger=new kr("UserInfoService"),this._getClaimsFromJwt=async n=>{const r=this._logger.create("_getClaimsFromJwt");try{const i=pC.decode(n);return r.debug("JWT decoding successful"),i}catch(i){throw r.error("Error parsing JWT response"),i}},this._jsonService=new r7(void 0,this._getClaimsFromJwt,this._settings.extraHeaders)}async getClaims(t){const e=this._logger.create("getClaims");t||this._logger.throw(new Error("No token passed"));const n=await this._metadataService.getUserInfoEndpoint();e.debug("got userinfo url",n);const r=await this._jsonService.getJson(n,{token:t,credentials:this._settings.fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return e.debug("got claims",r),r}},aQ=class{constructor(t,e){this._settings=t,this._metadataService=e,this._logger=new kr("TokenClient"),this._jsonService=new r7(this._settings.revokeTokenAdditionalContentTypes,null,this._settings.extraHeaders)}async exchangeCode({grant_type:t="authorization_code",redirect_uri:e=this._settings.redirect_uri,client_id:n=this._settings.client_id,client_secret:r=this._settings.client_secret,extraHeaders:i,...s}){const o=this._logger.create("exchangeCode");n||o.throw(new Error("A client_id is required")),e||o.throw(new Error("A redirect_uri is required")),s.code||o.throw(new Error("A code is required"));const a=new URLSearchParams({grant_type:t,redirect_uri:e});for(const[h,m]of Object.entries(s))m!=null&&a.set(h,m);let c;switch(this._settings.client_authentication){case"client_secret_basic":if(!r)throw o.throw(new Error("A client_secret is required")),null;c=nc.generateBasicAuth(n,r);break;case"client_secret_post":a.append("client_id",n),r&&a.append("client_secret",r);break}const l=await this._metadataService.getTokenEndpoint(!1);o.debug("got token endpoint");const d=await this._jsonService.postForm(l,{body:a,basicAuth:c,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return o.debug("got response"),d}async exchangeCredentials({grant_type:t="password",client_id:e=this._settings.client_id,client_secret:n=this._settings.client_secret,scope:r=this._settings.scope,...i}){const s=this._logger.create("exchangeCredentials");e||s.throw(new Error("A client_id is required"));const o=new URLSearchParams({grant_type:t});this._settings.omitScopeWhenRequesting||o.set("scope",r);for(const[d,h]of Object.entries(i))h!=null&&o.set(d,h);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw s.throw(new Error("A client_secret is required")),null;a=nc.generateBasicAuth(e,n);break;case"client_secret_post":o.append("client_id",e),n&&o.append("client_secret",n);break}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const l=await this._jsonService.postForm(c,{body:o,basicAuth:a,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials});return s.debug("got response"),l}async exchangeRefreshToken({grant_type:t="refresh_token",client_id:e=this._settings.client_id,client_secret:n=this._settings.client_secret,timeoutInSeconds:r,extraHeaders:i,...s}){const o=this._logger.create("exchangeRefreshToken");e||o.throw(new Error("A client_id is required")),s.refresh_token||o.throw(new Error("A refresh_token is required"));const a=new URLSearchParams({grant_type:t});for(const[h,m]of Object.entries(s))Array.isArray(m)?m.forEach(g=>a.append(h,g)):m!=null&&a.set(h,m);let c;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw o.throw(new Error("A client_secret is required")),null;c=nc.generateBasicAuth(e,n);break;case"client_secret_post":a.append("client_id",e),n&&a.append("client_secret",n);break}const l=await this._metadataService.getTokenEndpoint(!1);o.debug("got token endpoint");const d=await this._jsonService.postForm(l,{body:a,basicAuth:c,timeoutInSeconds:r,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return o.debug("got response"),d}async revoke(t){var e;const n=this._logger.create("revoke");t.token||n.throw(new Error("A token is required"));const r=await this._metadataService.getRevocationEndpoint(!1);n.debug(`got revocation endpoint, revoking ${(e=t.token_type_hint)!=null?e:"default token type"}`);const i=new URLSearchParams;for(const[s,o]of Object.entries(t))o!=null&&i.set(s,o);i.set("client_id",this._settings.client_id),this._settings.client_secret&&i.set("client_secret",this._settings.client_secret),await this._jsonService.postForm(r,{body:i,timeoutInSeconds:this._settings.requestTimeoutInSeconds}),n.debug("got response")}},Sye=class{constructor(t,e,n){this._settings=t,this._metadataService=e,this._claimsService=n,this._logger=new kr("ResponseValidator"),this._userInfoService=new _ye(this._settings,this._metadataService),this._tokenClient=new aQ(this._settings,this._metadataService)}async validateSigninResponse(t,e,n){const r=this._logger.create("validateSigninResponse");this._processSigninState(t,e),r.debug("state processed"),await this._processCode(t,e,n),r.debug("code processed"),t.isOpenId&&this._validateIdTokenAttributes(t),r.debug("tokens validated"),await this._processClaims(t,e?.skipUserInfo,t.isOpenId),r.debug("claims processed")}async validateCredentialsResponse(t,e){const n=this._logger.create("validateCredentialsResponse");t.isOpenId&&t.id_token&&this._validateIdTokenAttributes(t),n.debug("tokens validated"),await this._processClaims(t,e,t.isOpenId),n.debug("claims processed")}async validateRefreshResponse(t,e){var n,r;const i=this._logger.create("validateRefreshResponse");t.userState=e.data,(n=t.session_state)!=null||(t.session_state=e.session_state),(r=t.scope)!=null||(t.scope=e.scope),t.isOpenId&&t.id_token&&(this._validateIdTokenAttributes(t,e.id_token),i.debug("ID Token validated")),t.id_token||(t.id_token=e.id_token,t.profile=e.profile);const s=t.isOpenId&&!!t.id_token;await this._processClaims(t,!1,s),i.debug("claims processed")}validateSignoutResponse(t,e){const n=this._logger.create("validateSignoutResponse");if(e.id!==t.state&&n.throw(new Error("State does not match")),n.debug("state validated"),t.userState=e.data,t.error)throw n.warn("Response was error",t.error),new iv(t)}_processSigninState(t,e){var n;const r=this._logger.create("_processSigninState");if(e.id!==t.state&&r.throw(new Error("State does not match")),e.client_id||r.throw(new Error("No client_id on state")),e.authority||r.throw(new Error("No authority on state")),this._settings.authority!==e.authority&&r.throw(new Error("authority mismatch on settings vs. signin state")),this._settings.client_id&&this._settings.client_id!==e.client_id&&r.throw(new Error("client_id mismatch on settings vs. signin state")),r.debug("state validated"),t.userState=e.data,t.url_state=e.url_state,(n=t.scope)!=null||(t.scope=e.scope),t.error)throw r.warn("Response was error",t.error),new iv(t);e.code_verifier&&!t.code&&r.throw(new Error("Expected code in response"))}async _processClaims(t,e=!1,n=!0){const r=this._logger.create("_processClaims");if(t.profile=this._claimsService.filterProtocolClaims(t.profile),e||!this._settings.loadUserInfo||!t.access_token){r.debug("not loading user info");return}r.debug("loading user info");const i=await this._userInfoService.getClaims(t.access_token);r.debug("user info claims received from user info endpoint"),n&&i.sub!==t.profile.sub&&r.throw(new Error("subject from UserInfo response does not match subject in ID Token")),t.profile=this._claimsService.mergeClaims(t.profile,this._claimsService.filterProtocolClaims(i)),r.debug("user info claims received, updated profile:",t.profile)}async _processCode(t,e,n){const r=this._logger.create("_processCode");if(t.code){r.debug("Validating code");const i=await this._tokenClient.exchangeCode({client_id:e.client_id,client_secret:e.client_secret,code:t.code,redirect_uri:e.redirect_uri,code_verifier:e.code_verifier,extraHeaders:n,...e.extraTokenParams});Object.assign(t,i)}else r.debug("No code to process")}_validateIdTokenAttributes(t,e){var n;const r=this._logger.create("_validateIdTokenAttributes");r.debug("decoding ID Token JWT");const i=pC.decode((n=t.id_token)!=null?n:"");if(i.sub||r.throw(new Error("ID Token is missing a subject claim")),e){const s=pC.decode(e);i.sub!==s.sub&&r.throw(new Error("sub in id_token does not match current sub")),i.auth_time&&i.auth_time!==s.auth_time&&r.throw(new Error("auth_time in id_token does not match original auth_time")),i.azp&&i.azp!==s.azp&&r.throw(new Error("azp in id_token does not match original azp")),!i.azp&&s.azp&&r.throw(new Error("azp not in id_token, but present in original id_token"))}t.profile=i}},gC=class TA{constructor(e){this.id=e.id||nc.generateUUIDv4(),this.data=e.data,e.created&&e.created>0?this.created=e.created:this.created=mC.getEpochTime(),this.request_type=e.request_type,this.url_state=e.url_state}toStorageString(){return new kr("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state})}static fromStorageString(e){return kr.createStatic("State","fromStorageString"),Promise.resolve(new TA(JSON.parse(e)))}static async clearStaleState(e,n){const r=kr.createStatic("State","clearStaleState"),i=mC.getEpochTime()-n,s=await e.getAllKeys();r.debug("got keys",s);for(let o=0;o<s.length;o++){const a=s[o],c=await e.get(a);let l=!1;if(c)try{const d=await TA.fromStorageString(c);r.debug("got item from key:",a,d.created),d.created<=i&&(l=!0)}catch(d){r.error("Error parsing state for key:",a,d),l=!0}else r.debug("no item in storage for key:",a),l=!0;l&&(r.debug("removed item for key:",a),e.remove(a))}}},i7=class RA extends gC{constructor(e){super(e),this.code_verifier=e.code_verifier,this.code_challenge=e.code_challenge,this.authority=e.authority,this.client_id=e.client_id,this.redirect_uri=e.redirect_uri,this.scope=e.scope,this.client_secret=e.client_secret,this.extraTokenParams=e.extraTokenParams,this.response_mode=e.response_mode,this.skipUserInfo=e.skipUserInfo}static async create(e){const n=e.code_verifier===!0?nc.generateCodeVerifier():e.code_verifier||void 0,r=n?await nc.generateCodeChallenge(n):void 0;return new RA({...e,code_verifier:n,code_challenge:r})}toStorageString(){return new kr("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}static fromStorageString(e){kr.createStatic("SigninState","fromStorageString");const n=JSON.parse(e);return RA.create(n)}},cQ=class lQ{constructor(e){this.url=e.url,this.state=e.state}static async create({url:e,authority:n,client_id:r,redirect_uri:i,response_type:s,scope:o,state_data:a,response_mode:c,request_type:l,client_secret:d,nonce:h,url_state:m,resource:g,skipUserInfo:y,extraQueryParams:v,extraTokenParams:w,disablePKCE:S,dpopJkt:R,omitScopeWhenRequesting:x,...T}){if(!e)throw this._logger.error("create: No url passed"),new Error("url");if(!r)throw this._logger.error("create: No client_id passed"),new Error("client_id");if(!i)throw this._logger.error("create: No redirect_uri passed"),new Error("redirect_uri");if(!s)throw this._logger.error("create: No response_type passed"),new Error("response_type");if(!o)throw this._logger.error("create: No scope passed"),new Error("scope");if(!n)throw this._logger.error("create: No authority passed"),new Error("authority");const I=await i7.create({data:a,request_type:l,url_state:m,code_verifier:!S,client_id:r,authority:n,redirect_uri:i,response_mode:c,client_secret:d,scope:o,extraTokenParams:w,skipUserInfo:y}),k=new URL(e);k.searchParams.append("client_id",r),k.searchParams.append("redirect_uri",i),k.searchParams.append("response_type",s),x||k.searchParams.append("scope",o),h&&k.searchParams.append("nonce",h),R&&k.searchParams.append("dpop_jkt",R);let A=I.id;m&&(A=`${A}${EA}${m}`),k.searchParams.append("state",A),I.code_challenge&&(k.searchParams.append("code_challenge",I.code_challenge),k.searchParams.append("code_challenge_method","S256")),g&&(Array.isArray(g)?g:[g]).forEach(D=>k.searchParams.append("resource",D));for(const[O,D]of Object.entries({response_mode:c,...T,...v}))D!=null&&k.searchParams.append(O,D.toString());return new lQ({url:k.href,state:I})}};cQ._logger=new kr("SigninRequest");var Eye=cQ,wye="openid",XE=class{constructor(t){if(this.access_token="",this.token_type="",this.profile={},this.state=t.get("state"),this.session_state=t.get("session_state"),this.state){const e=decodeURIComponent(this.state).split(EA);this.state=e[0],e.length>1&&(this.url_state=e.slice(1).join(EA))}this.error=t.get("error"),this.error_description=t.get("error_description"),this.error_uri=t.get("error_uri"),this.code=t.get("code")}get expires_in(){if(this.expires_at!==void 0)return this.expires_at-mC.getEpochTime()}set expires_in(t){typeof t=="string"&&(t=Number(t)),t!==void 0&&t>=0&&(this.expires_at=Math.floor(t)+mC.getEpochTime())}get isOpenId(){var t;return((t=this.scope)==null?void 0:t.split(" ").includes(wye))||!!this.id_token}},Cye=class{constructor({url:t,state_data:e,id_token_hint:n,post_logout_redirect_uri:r,extraQueryParams:i,request_type:s,client_id:o}){if(this._logger=new kr("SignoutRequest"),!t)throw this._logger.error("ctor: No url passed"),new Error("url");const a=new URL(t);n&&a.searchParams.append("id_token_hint",n),o&&a.searchParams.append("client_id",o),r&&(a.searchParams.append("post_logout_redirect_uri",r),e&&(this.state=new gC({data:e,request_type:s}),a.searchParams.append("state",this.state.id)));for(const[c,l]of Object.entries({...i}))l!=null&&a.searchParams.append(c,l.toString());this.url=a.href}},Tye=class{constructor(t){this.state=t.get("state"),this.error=t.get("error"),this.error_description=t.get("error_description"),this.error_uri=t.get("error_uri")}},Rye=["nbf","jti","auth_time","nonce","acr","amr","azp","at_hash"],Iye=["sub","iss","aud","exp","iat"],kye=class{constructor(t){this._settings=t,this._logger=new kr("ClaimsService")}filterProtocolClaims(t){const e={...t};if(this._settings.filterProtocolClaims){let n;Array.isArray(this._settings.filterProtocolClaims)?n=this._settings.filterProtocolClaims:n=Rye;for(const r of n)Iye.includes(r)||delete e[r]}return e}mergeClaims(t,e){const n={...t};for(const[r,i]of Object.entries(e))if(n[r]!==i)if(Array.isArray(n[r])||Array.isArray(i))if(this._settings.mergeClaimsStrategy.array=="replace")n[r]=i;else{const s=Array.isArray(n[r])?n[r]:[n[r]];for(const o of Array.isArray(i)?i:[i])s.includes(o)||s.push(o);n[r]=s}else typeof n[r]=="object"&&typeof i=="object"?n[r]=this.mergeClaims(n[r],i):n[r]=i;return n}},xye=class{constructor(t,e){this.keys=t,this.nonce=e}},s7=class{constructor(t,e){this._logger=new kr("OidcClient"),this.settings=t instanceof CA?t:new CA(t),this.metadataService=e??new oQ(this.settings),this._claimsService=new kye(this.settings),this._validator=new Sye(this.settings,this.metadataService,this._claimsService),this._tokenClient=new aQ(this.settings,this.metadataService)}async createSigninRequest({state:t,request:e,request_uri:n,request_type:r,id_token_hint:i,login_hint:s,skipUserInfo:o,nonce:a,url_state:c,response_type:l=this.settings.response_type,scope:d=this.settings.scope,redirect_uri:h=this.settings.redirect_uri,prompt:m=this.settings.prompt,display:g=this.settings.display,max_age:y=this.settings.max_age,ui_locales:v=this.settings.ui_locales,acr_values:w=this.settings.acr_values,resource:S=this.settings.resource,response_mode:R=this.settings.response_mode,extraQueryParams:x=this.settings.extraQueryParams,extraTokenParams:T=this.settings.extraTokenParams,dpopJkt:I,omitScopeWhenRequesting:k=this.settings.omitScopeWhenRequesting}){const A=this._logger.create("createSigninRequest");if(l!=="code")throw new Error("Only the Authorization Code flow (with PKCE) is supported");const O=await this.metadataService.getAuthorizationEndpoint();A.debug("Received authorization endpoint",O);const D=await Eye.create({url:O,authority:this.settings.authority,client_id:this.settings.client_id,redirect_uri:h,response_type:l,scope:d,state_data:t,url_state:c,prompt:m,display:g,max_age:y,ui_locales:v,id_token_hint:i,login_hint:s,acr_values:w,dpopJkt:I,resource:S,request:e,request_uri:n,extraQueryParams:x,extraTokenParams:T,request_type:r,response_mode:R,client_secret:this.settings.client_secret,skipUserInfo:o,nonce:a,disablePKCE:this.settings.disablePKCE,omitScopeWhenRequesting:k});await this.clearStaleState();const N=D.state;return await this.settings.stateStore.set(N.id,N.toStorageString()),D}async readSigninResponseState(t,e=!1){const n=this._logger.create("readSigninResponseState"),r=new XE(eB.readParams(t,this.settings.response_mode));if(!r.state)throw n.throw(new Error("No state in response")),null;const i=await this.settings.stateStore[e?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await i7.fromStorageString(i),response:r}}async processSigninResponse(t,e){const n=this._logger.create("processSigninResponse"),{state:r,response:i}=await this.readSigninResponseState(t,!0);if(n.debug("received state from storage; validating response"),this.settings.dpop&&this.settings.dpop.store){const s=await this.getDpopProof(this.settings.dpop.store);e={...e,DPoP:s}}try{await this._validator.validateSigninResponse(i,r,e)}catch(s){if(s instanceof wA&&this.settings.dpop){const o=await this.getDpopProof(this.settings.dpop.store,s.nonce);e.DPoP=o,await this._validator.validateSigninResponse(i,r,e)}else throw s}return i}async getDpopProof(t,e){let n,r;return(await t.getAllKeys()).includes(this.settings.client_id)?(r=await t.get(this.settings.client_id),r.nonce!==e&&e&&(r.nonce=e,await t.set(this.settings.client_id,r))):(n=await nc.generateDPoPKeys(),r=new xye(n,e),await t.set(this.settings.client_id,r)),await nc.generateDPoPProof({url:await this.metadataService.getTokenEndpoint(!1),httpMethod:"POST",keyPair:r.keys,nonce:r.nonce})}async processResourceOwnerPasswordCredentials({username:t,password:e,skipUserInfo:n=!1,extraTokenParams:r={}}){const i=await this._tokenClient.exchangeCredentials({username:t,password:e,...r}),s=new XE(new URLSearchParams);return Object.assign(s,i),await this._validator.validateCredentialsResponse(s,n),s}async useRefreshToken({state:t,redirect_uri:e,resource:n,timeoutInSeconds:r,extraHeaders:i,extraTokenParams:s}){var o;const a=this._logger.create("useRefreshToken");let c;if(this.settings.refreshTokenAllowedScope===void 0)c=t.scope;else{const h=this.settings.refreshTokenAllowedScope.split(" ");c=(((o=t.scope)==null?void 0:o.split(" "))||[]).filter(g=>h.includes(g)).join(" ")}if(this.settings.dpop&&this.settings.dpop.store){const h=await this.getDpopProof(this.settings.dpop.store);i={...i,DPoP:h}}let l;try{l=await this._tokenClient.exchangeRefreshToken({refresh_token:t.refresh_token,scope:c,redirect_uri:e,resource:n,timeoutInSeconds:r,extraHeaders:i,...s})}catch(h){if(h instanceof wA&&this.settings.dpop)i.DPoP=await this.getDpopProof(this.settings.dpop.store,h.nonce),l=await this._tokenClient.exchangeRefreshToken({refresh_token:t.refresh_token,scope:c,redirect_uri:e,resource:n,timeoutInSeconds:r,extraHeaders:i,...s});else throw h}const d=new XE(new URLSearchParams);return Object.assign(d,l),a.debug("validating response",d),await this._validator.validateRefreshResponse(d,{...t,scope:c}),d}async createSignoutRequest({state:t,id_token_hint:e,client_id:n,request_type:r,post_logout_redirect_uri:i=this.settings.post_logout_redirect_uri,extraQueryParams:s=this.settings.extraQueryParams}={}){const o=this._logger.create("createSignoutRequest"),a=await this.metadataService.getEndSessionEndpoint();if(!a)throw o.throw(new Error("No end session endpoint")),null;o.debug("Received end session endpoint",a),!n&&i&&!e&&(n=this.settings.client_id);const c=new Cye({url:a,id_token_hint:e,client_id:n,post_logout_redirect_uri:i,state_data:t,extraQueryParams:s,request_type:r});await this.clearStaleState();const l=c.state;return l&&(o.debug("Signout request has state to persist"),await this.settings.stateStore.set(l.id,l.toStorageString())),c}async readSignoutResponseState(t,e=!1){const n=this._logger.create("readSignoutResponseState"),r=new Tye(eB.readParams(t,this.settings.response_mode));if(!r.state){if(n.debug("No state in response"),r.error)throw n.warn("Response was error:",r.error),new iv(r);return{state:void 0,response:r}}const i=await this.settings.stateStore[e?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await gC.fromStorageString(i),response:r}}async processSignoutResponse(t){const e=this._logger.create("processSignoutResponse"),{state:n,response:r}=await this.readSignoutResponseState(t,!0);return n?(e.debug("Received state from storage; validating response"),this._validator.validateSignoutResponse(r,n)):e.debug("No state from storage; skipping response validation"),r}clearStaleState(){return this._logger.create("clearStaleState"),gC.clearStaleState(this.settings.stateStore,this.settings.staleStateAgeInSeconds)}async revokeToken(t,e){return this._logger.create("revokeToken"),await this._tokenClient.revoke({token:t,token_type_hint:e})}},ts=function(t){return t.NotSupported="OIDC authentication not supported",t.Misconfigured="OIDC is misconfigured",t.General="Something went wrong with OIDC discovery",t.OpSupport="Configured OIDC OP does not support required functions",t.DynamicRegistrationNotSupported="Dynamic registration not supported",t.DynamicRegistrationFailed="Dynamic registration failed",t.DynamicRegistrationInvalid="Dynamic registration invalid response",t.CodeExchangeFailed="Failed to exchange code for token",t.InvalidBearerTokenResponse="Invalid bearer token response",t.InvalidIdToken="Invalid ID token",t.MissingOrInvalidStoredState="State required to finish logging in is not found in storage.",t}({}),o7=t=>!!t&&typeof t=="object"&&!Array.isArray(t),mu=(t,e)=>!t[e]||!ky(t,e)?(M.error("Missing or invalid property: ".concat(e)),!1):!0,ky=(t,e)=>t[e]&&typeof t[e]!="string"?(M.error("Invalid property: ".concat(e)),!1):!0,tB=(t,e)=>t[e]&&(!Array.isArray(t[e])||!t[e].every(n=>typeof n=="string"))?(M.error("Invalid property: ".concat(e)),!1):!0,Uk=(t,e,n)=>{var r=t[e];return!r||!Array.isArray(r)||!r.includes(n)?(M.error("Invalid property: ".concat(e,". ").concat(n," is required.")),!1):!0},uQ=t=>{if(!o7(t))throw M.error("Issuer configuration not found or malformed"),new Error(ts.OpSupport);var e=[mu(t,"issuer"),mu(t,"authorization_endpoint"),mu(t,"token_endpoint"),mu(t,"revocation_endpoint"),ky(t,"registration_endpoint"),ky(t,"account_management_uri"),ky(t,"device_authorization_endpoint"),tB(t,"account_management_actions_supported"),Uk(t,"response_types_supported","code"),Uk(t,"grant_types_supported","authorization_code"),Uk(t,"code_challenge_methods_supported","S256"),tB(t,"prompt_values_supported")].some(n=>!n);if(!e)return t;throw M.error("Issuer configuration not valid"),new Error(ts.OpSupport)},dQ=t=>{try{return iQ(t)}catch(e){throw M.error("Could not decode id_token",e),e}},fQ=(t,e,n,r)=>{try{if(!t)throw new Error("No ID token");var i=dQ(t);if(i.iss!==e)throw new Error("Invalid issuer");var s=typeof i.aud=="string"?[i.aud]:i.aud;if(!s.includes(n))throw new Error("Invalid audience");if(r!==void 0&&i.nonce!==r)throw new Error("Invalid nonce");if(!i.exp||Date.now()>i.exp*1e3)throw new Error("Invalid expiry")}catch(o){throw M.error("Invalid ID token",o),new Error(ts.InvalidIdToken)}};function hQ(t){if(!o7(t))throw M.error("Stored user state not found"),new Error(ts.MissingOrInvalidStoredState);var e=[mu(t,"homeserverUrl"),mu(t,"nonce"),ky(t,"identityServerUrl")].some(n=>!n);if(e)throw new Error(ts.MissingOrInvalidStoredState)}var Aye=t=>o7(t)&&mu(t,"token_type")&&t.token_type.toLowerCase()==="bearer"&&mu(t,"access_token")&&mu(t,"refresh_token")&&(!("expires_in"in t)||typeof t.expires_in=="number");function pQ(t){if(!Aye(t))throw new Error(ts.InvalidBearerTokenResponse)}function nB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function vC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?nB(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):nB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var iT=t=>{var e=t??To(10);return"openid urn:matrix:org.matrix.msc2967.client:api:* urn:matrix:org.matrix.msc2967.client:device:".concat(e)},Pye=function(){var t=B(function*(e){if(!globalThis.crypto.subtle)return M.warn("A secure context is required to generate code challenge. Using plain text code challenge"),e;var n=yield rQ(e);return Z3(n)});return function(n){return t.apply(this,arguments)}}(),Lye=t=>{var{redirectUri:e}=t;return{scope:iT(),redirectUri:e,state:To(8),nonce:To(8),codeVerifier:To(64)}},Oye=function(){var t=B(function*(e,n,r){var{scope:i,redirectUri:s,state:o,nonce:a,codeVerifier:c}=r,l=new URL(e);return l.searchParams.append("response_mode","query"),l.searchParams.append("response_type","code"),l.searchParams.append("redirect_uri",s),l.searchParams.append("client_id",n),l.searchParams.append("state",o),l.searchParams.append("scope",i),l.searchParams.append("nonce",a),l.searchParams.append("code_challenge_method","S256"),l.searchParams.append("code_challenge",yield Pye(c)),l.toString()});return function(n,r,i){return t.apply(this,arguments)}}(),Mye=function(){var t=B(function*(e){var{metadata:n,redirectUri:r,clientId:i,homeserverUrl:s,identityServerUrl:o,nonce:a,prompt:c,urlState:l,loginHint:d}=e,h=iT(),m=new s7(vC(vC({},n),{},{client_id:i,redirect_uri:r,authority:n.issuer,response_mode:"query",response_type:"code",scope:h,stateStore:new rT({prefix:"mx_oidc_",store:window.sessionStorage})})),g={homeserverUrl:s,nonce:a,identityServerUrl:o},y=yield m.createSigninRequest({state:g,nonce:a,prompt:c,url_state:l,login_hint:d});return y.url});return function(n){return t.apply(this,arguments)}}(),Dye=t=>({id_token:t.id_token,scope:t.scope,expires_at:t.expires_at,refresh_token:t.refresh_token,access_token:t.access_token,token_type:"Bearer"}),Nye=function(){var t=B(function*(e,n){var r=new URL(window.location.origin);r.searchParams.append("code",e),r.searchParams.append("state",n),pb.setLogger(M);try{var i=new XE(r.searchParams),s=new rT({prefix:"mx_oidc_",store:window.sessionStorage}),o=yield s.get(i.state);if(!o)throw new Error(ts.MissingOrInvalidStoredState);var a=yield i7.fromStorageString(o),c=new s7(vC(vC({},a),{},{stateStore:s})),l=yield c.processSigninResponse(r.href),d=l.userState;hQ(d),pQ(l),fQ(l.id_token,c.settings.authority,c.settings.client_id,d.nonce);var h=Dye(l);return{oidcClientSettings:{clientId:c.settings.client_id,issuer:c.settings.authority},tokenResponse:h,homeserverUrl:d.homeserverUrl,identityServerUrl:d.identityServerUrl,idTokenClaims:l.profile}}catch(g){M.error("Oidc login failed",g);var m=g.message;throw Object.values(ts).includes(m)?g:new Error(ts.CodeExchangeFailed)}});return function(n,r){return t.apply(this,arguments)}}();function rB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function iB(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rB(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var a7=function(){var t=B(function*(e){var n=new URL(".well-known/openid-configuration",e),r=yield fetch(n,{method:de.Get,signal:J3(5e3)}),i=yield r.json();return c7(i)});return function(n){return t.apply(this,arguments)}}(),c7=function(){var t=B(function*(e){var n=uQ(e),r=new CA({authority:n.issuer,metadata:n,redirect_uri:"",client_id:""}),i=new oQ(r);return iB(iB({},n),{},{signingKeys:yield i.getSigningKeys()})});return function(n){return t.apply(this,arguments)}}(),Uye="urn:ietf:params:oauth:grant-type:device_code",jk=(t,e)=>{if(!e)return!1;var n=new URL(e);return!(n.protocol!==t.protocol||n.hostname!==t.hostname&&!n.hostname.endsWith(".".concat(t.hostname)))},jye=function(){var t=B(function*(e,n){if(!e.registration_endpoint)throw new Error(ts.DynamicRegistrationNotSupported);var r=["authorization_code","refresh_token"];if(r.some(d=>!e.grant_types_supported.includes(d)))throw new Error(ts.DynamicRegistrationNotSupported);var i=new URL(n.clientUri),s={client_name:n.clientName,client_uri:n.clientUri,response_types:["code"],grant_types:r,redirect_uris:n.redirectUris,id_token_signed_response_alg:"RS256",token_endpoint_auth_method:"none",application_type:n.applicationType,contacts:n.contacts,logo_uri:jk(i,n.logoUri)?n.logoUri:void 0,policy_uri:jk(i,n.policyUri)?n.policyUri:void 0,tos_uri:jk(i,n.tosUri)?n.tosUri:void 0},o={Accept:"application/json","Content-Type":"application/json"};try{var a=yield fetch(e.registration_endpoint,{method:de.Post,headers:o,body:JSON.stringify(s)});if(a.status>=400)throw new Error(ts.DynamicRegistrationFailed);var c=yield a.json(),l=c.client_id;if(!l||typeof l!="string")throw new Error(ts.DynamicRegistrationInvalid);return l}catch(d){throw Object.values(ts).includes(d.message)?d:(M.error("Dynamic registration request failed",d),new Error(ts.DynamicRegistrationFailed))}});return function(n,r){return t.apply(this,arguments)}}();class Fye{constructor(e,n,r,i,s){this.idTokenClaims=s,L(this,"oidcClientReady",void 0),L(this,"oidcClient",void 0),L(this,"inflightRefreshRequest",void 0),this.oidcClientReady=this.initialiseOidcClient(e,n,i,r)}initialiseOidcClient(e,n,r,i){var s=this;return B(function*(){try{var o,a=yield a7(e),c=iT(r);s.oidcClient=new s7({metadata:a,signingKeys:(o=a.signingKeys)!==null&&o!==void 0?o:void 0,client_id:n,scope:c,redirect_uri:i,authority:a.issuer,stateStore:new rT({prefix:"mx_oidc_",store:window.sessionStorage})})}catch(l){throw M.error("Failed to initialise OIDC client.",l),new Error("Failed to initialise OIDC client.")}})()}doRefreshAccessToken(e){var n=this;return B(function*(){n.inflightRefreshRequest||(n.inflightRefreshRequest=n.getNewTokens(e));try{var r=yield n.inflightRefreshRequest;return r}catch(i){throw i instanceof iv?new VO(i):i}finally{n.inflightRefreshRequest=void 0}})()}persistTokens(e){return B(function*(){})()}getNewTokens(e){var n=this;return B(function*(){if(!n.oidcClient)throw new Error("Cannot get new token before OIDC client is initialised.");var r={refresh_token:e,session_state:"test",data:void 0,profile:n.idTokenClaims},i=Date.now(),s=yield n.oidcClient.useRefreshToken({state:r,timeoutInSeconds:300}),o={accessToken:s.access_token,refreshToken:s.refresh_token,expiry:s.expires_in?new Date(i+s.expires_in*1e3):void 0};return yield n.persistTokens(o),o})()}}var $ye=["server","limit","since"];function sB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Yr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?sB(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):sB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Bye=3e3,oB=10*60*1e3,Hye=new Ar("last_seen_user_agent","org.matrix.msc3852.last_seen_user_agent"),sv=function(t){return t.Chronological="chronological",t.Detached="detached",t}({}),Vye=new a_("m.get_login_token","org.matrix.msc3882.get_login_token"),mQ="uk.half-shot.msc2666",gQ="uk.half-shot.msc2666.mutual_rooms",vQ="uk.half-shot.msc2666.query_mutual_rooms",Vc="org.matrix.msc4140",yQ="uk.tcpip.msc4133",bQ="uk.tcpip.msc4133.stable",Cc="$",Le=function(t){return t.Sync="sync",t.Event="event",t.ToDeviceEvent="toDeviceEvent",t.ReceivedToDeviceMessage="receivedToDeviceMessage",t.AccountData="accountData",t.Room="Room",t.DeleteRoom="deleteRoom",t.SyncUnexpectedError="sync.unexpectedError",t.ClientWellKnown="WellKnown.client",t.ReceivedVoipEvent="received_voip_event",t.TurnServers="turnServers",t.TurnServersError="turnServers.error",t}({}),qye=new Ar("action","org.matrix.msc3824.action");class sT extends On{constructor(e){var n,r,i,s,o;super(),i=this,L(this,"logger",void 0),L(this,"reEmitter",new $v(this)),L(this,"olmVersion",null),L(this,"usingExternalCrypto",!1),L(this,"_store",void 0),L(this,"deviceId",void 0),L(this,"credentials",void 0),L(this,"legacyPickleKey",void 0),L(this,"scheduler",void 0),L(this,"clientRunning",!1),L(this,"timelineSupport",!1),L(this,"urlPreviewCache",{}),L(this,"identityServer",void 0),L(this,"http",void 0),L(this,"cryptoBackend",void 0),L(this,"enableEncryptedStateEvents",void 0),L(this,"cryptoCallbacks",void 0),L(this,"callEventHandler",void 0),L(this,"groupCallEventHandler",void 0),L(this,"supportsCallTransfer",!1),L(this,"forceTURN",!1),L(this,"iceCandidatePoolSize",0),L(this,"idBaseUrl",void 0),L(this,"baseUrl",void 0),L(this,"isVoipWithNoMediaAllowed",void 0),L(this,"useLivekitForGroupCalls",void 0),L(this,"canSupportVoip",!1),L(this,"peekSync",null),L(this,"isGuestAccount",!1),L(this,"ongoingScrollbacks",{}),L(this,"notifTimelineSet",null),L(this,"legacyCryptoStore",void 0),L(this,"verificationMethods",void 0),L(this,"fallbackICEServerAllowed",!1),L(this,"syncApi",void 0),L(this,"roomNameGenerator",void 0),L(this,"pushRules",void 0),L(this,"syncLeftRoomsPromise",void 0),L(this,"syncedLeftRooms",!1),L(this,"clientOpts",void 0),L(this,"clientWellKnownIntervalID",void 0),L(this,"canResetTimelineCallback",void 0),L(this,"canSupport",new Map),L(this,"pushProcessor",new qa(this)),L(this,"serverVersionsPromise",void 0),L(this,"clientWellKnown",void 0),L(this,"clientWellKnownPromise",void 0),L(this,"turnServers",[]),L(this,"turnServersExpiry",0),L(this,"checkTurnServersIntervalID",void 0),L(this,"txnCtr",0),L(this,"mediaHandler",new M1e(this)),L(this,"sessionId",void 0),L(this,"eventsBeingEncrypted",new Set),L(this,"useE2eForGroupCall",!0),L(this,"toDeviceMessageQueue",void 0),L(this,"livekitServiceURL",void 0),L(this,"_secretStorage",void 0),L(this,"ignoredInvites",void 0),L(this,"matrixRTC",void 0),L(this,"serverCapabilitiesService",void 0),L(this,"startCallEventHandler",()=>{this.isInitialSyncComplete()&&(dA()&&(this.callEventHandler.start(),this.groupCallEventHandler.start()),this.off(Le.Sync,this.startCallEventHandler))}),L(this,"startMatrixRTC",()=>{this.isInitialSyncComplete()&&(this.matrixRTC.start(),this.off(Le.Sync,this.startMatrixRTC))}),L(this,"fixupRoomNotifications",()=>{if(this.isInitialSyncComplete()){var c,l=((c=this.getRooms())!==null&&c!==void 0?c:[]).filter(m=>m.getUnreadNotificationCount(Jt.Total)>0);for(var d of l){var h=this.getSafeUserId();d.fixupNotifications(h)}this.off(Le.Sync,this.fixupRoomNotifications)}}),this.logger=(n=e.logger)!==null&&n!==void 0?n:M,e.baseUrl=Ek(e.baseUrl),e.idBaseUrl=Ek(e.idBaseUrl),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer,this.usingExternalCrypto=(r=e.usingExternalCrypto)!==null&&r!==void 0?r:!1,this.store=e.store||new N0e,this.deviceId=e.deviceId||null,this.sessionId=To(10);var a=e.userId||null;this.credentials={userId:a},this.http=new PJ(this,{fetchFn:e.fetchFn,baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,refreshToken:e.refreshToken,tokenRefreshFunction:e.tokenRefreshFunction,prefix:Xr.V3,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader,logger:this.logger}),e.pickleKey&&(this.legacyPickleKey=e.pickleKey),this.useLivekitForGroupCalls=!!e.useLivekitForGroupCalls,this.scheduler=e.scheduler,this.scheduler&&this.scheduler.setProcessFunction(function(){var c=B(function*(l){var d=i.getRoom(l.getRoomId());l.status!==rt.SENDING&&i.updatePendingEventStatus(d,l,rt.SENDING);var h=yield i.sendEventHttpRequest(l);return d&&d.updatePendingEvent(l,rt.SENT,h.event_id),h});return function(l){return c.apply(this,arguments)}}()),dA()&&(this.callEventHandler=new n1e(this),this.groupCallEventHandler=new r1e(this),this.canSupportVoip=!0,this.on(Le.Sync,this.startCallEventHandler)),this.matrixRTC=new cye(this.logger,this),this.serverCapabilitiesService=new OJ(this.logger,this.http),this.on(Le.Sync,this.fixupRoomNotifications),this.timelineSupport=!!e.timelineSupport,this.legacyCryptoStore=e.cryptoStore,this.verificationMethods=e.verificationMethods,this.cryptoCallbacks=e.cryptoCallbacks||{},this.enableEncryptedStateEvents=(s=e.enableEncryptedStateEvents)!==null&&s!==void 0?s:!1,this.forceTURN=e.forceTURN||!1,this.iceCandidatePoolSize=e.iceCandidatePoolSize===void 0?0:e.iceCandidatePoolSize,this.supportsCallTransfer=e.supportsCallTransfer||!1,this.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this.isVoipWithNoMediaAllowed=e.isVoipWithNoMediaAllowed||!1,e.useE2eForGroupCall!==void 0&&(this.useE2eForGroupCall=e.useE2eForGroupCall),this.livekitServiceURL=e.livekitServiceURL,this.roomNameGenerator=e.roomNameGenerator,this.toDeviceMessageQueue=new H1e(this,this.logger),this.on(Kt.Decrypted,c=>{_Q(this,c)}),this.ignoredInvites=new V1e(this),this._secretStorage=new JJ(this,(o=e.cryptoCallbacks)!==null&&o!==void 0?o:{}),this.setMaxListeners(0)}set store(e){this._store=e,this._store.setUserCreator(n=>yu.createUser(n,this))}get store(){return this._store}startClient(e){var n=this;return B(function*(){if(!n.clientRunning){n.clientRunning=!0,n.on(Le.Sync,n.startMatrixRTC);var r=n.getUserId();r&&n.store.storeUser(new yu(r)),n.canSupportVoip&&(n.checkTurnServersIntervalID=setInterval(()=>{n.checkTurnServers()},oB),n.checkTurnServers()),n.syncApi&&(n.logger.error("Still have sync object whilst not running: stopping old one"),n.syncApi.stop());try{yield n.getVersions();var{threads:i,list:s,fwdPagination:o}=yield n.doesServerSupportThread();Un.setServerSideSupport(i),Un.setServerSideListSupport(s),Un.setServerSideFwdPaginationSupport(o)}catch(a){n.logger.error("Can't fetch server versions, continuing to initialise sync, this will be retried later",a)}n.clientOpts=e??{},n.clientOpts.slidingSync?n.syncApi=new zJ(n.clientOpts.slidingSync,n,n.clientOpts,n.buildSyncApiOptions()):n.syncApi=new Vd(n,n.clientOpts,n.buildSyncApiOptions()),n.syncApi.sync().catch(a=>n.logger.info("Sync startup aborted with an error:",a)),n.clientOpts.clientWellKnownPollPeriod!==void 0&&(n.clientWellKnownIntervalID=setInterval(()=>{n.fetchClientWellKnown()},1e3*n.clientOpts.clientWellKnownPollPeriod),n.fetchClientWellKnown()),n.toDeviceMessageQueue.start(),n.serverCapabilitiesService.start()}})()}buildSyncApiOptions(){return{cryptoCallbacks:this.cryptoBackend,canResetEntireTimeline:e=>this.canResetTimelineCallback?this.canResetTimelineCallback(e):!1,logger:this.logger.getChild("sync")}}stopClient(){var e,n,r,i,s;(e=this.cryptoBackend)===null||e===void 0||e.stop(),this.off(Le.Sync,this.startMatrixRTC),this.clientRunning&&(this.logger.debug("stopping MatrixClient"),this.clientRunning=!1,(n=this.syncApi)===null||n===void 0||n.stop(),this.syncApi=void 0,(r=this.peekSync)===null||r===void 0||r.stopPeeking(),(i=this.callEventHandler)===null||i===void 0||i.stop(),(s=this.groupCallEventHandler)===null||s===void 0||s.stop(),this.callEventHandler=void 0,this.groupCallEventHandler=void 0,globalThis.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,this.clientWellKnownIntervalID!==void 0&&globalThis.clearInterval(this.clientWellKnownIntervalID),this.toDeviceMessageQueue.stop(),this.matrixRTC.stop(),this.serverCapabilitiesService.stop())}clearStores(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.clientRunning)throw new Error("Cannot clear stores while client is running");var r=[];r.push(this.store.deleteAllData()),this.legacyCryptoStore&&r.push(this.legacyCryptoStore.deleteAllData());var i=function(){var s=B(function*(){var o;try{if(o=globalThis.indexedDB,!o)return}catch{return}var a=function*(m){var g=new Promise((y,v)=>{e.logger.info("Removing IndexedDB instance ".concat(m));var w=o.deleteDatabase(m);w.onsuccess=S=>{e.logger.info("Removed IndexedDB instance ".concat(m)),y(0)},w.onerror=S=>{e.logger.warn("Failed to remove IndexedDB instance ".concat(m,":"),S),y(0)},w.onblocked=S=>{e.logger.info("cannot yet remove IndexedDB instance ".concat(m))}});yield g};for(var c of["".concat((l=n.cryptoDatabasePrefix)!==null&&l!==void 0?l:Ok,"::matrix-sdk-crypto"),"".concat((d=n.cryptoDatabasePrefix)!==null&&d!==void 0?d:Ok,"::matrix-sdk-crypto-meta")]){var l,d;yield*a(c)}});return function(){return s.apply(this,arguments)}}();return r.push(i()),Promise.all(r).then()}getUserId(){var e,n;return(e=(n=this.credentials)===null||n===void 0?void 0:n.userId)!==null&&e!==void 0?e:null}getSafeUserId(){var e=this.getUserId();if(!e)throw new Error("Expected logged in user but found none.");return e}getDomain(){var e;return(e=this.credentials)!==null&&e!==void 0&&e.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){var e,n;return(e=(n=this.credentials)===null||n===void 0||(n=n.userId)===null||n===void 0?void 0:n.split(":")[0].substring(1))!==null&&e!==void 0?e:null}getDeviceId(){return this.deviceId}getSessionId(){return this.sessionId}supportsVoip(){return this.canSupportVoip}getMediaHandler(){return this.mediaHandler}setForceTURN(e){this.forceTURN=e}setSupportsCallTransfer(e){this.supportsCallTransfer=e}getUseE2eForGroupCall(){return this.useE2eForGroupCall}createCall(e){return fb(this,e)}createGroupCall(e,n,r,i,s,o){var a=this;return B(function*(){if(a.getGroupCallForRoom(e))throw new Error("".concat(e," already has an existing group call"));var c=a.getRoom(e);if(!c)throw new Error("Cannot find room ".concat(e));return new YO(a,c,n,r,i,void 0,s||a.isVoipWithNoMediaAllowed,o,a.isVoipWithNoMediaAllowed,a.useLivekitForGroupCalls,a.livekitServiceURL).create()})()}getLivekitServiceURL(){return this.livekitServiceURL}setLivekitServiceURL(e){this.livekitServiceURL=e}waitUntilRoomReadyForGroupCalls(e){return this.groupCallEventHandler.waitUntilRoomReadyForGroupCalls(e)}getGroupCallForRoom(e){return this.groupCallEventHandler.groupCalls.get(e)||null}getSyncState(){var e,n;return(e=(n=this.syncApi)===null||n===void 0?void 0:n.getSyncState())!==null&&e!==void 0?e:null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){var e=this.getSyncState();return e?e===Gt.Prepared||e===Gt.Syncing:!1}isGuest(){return this.isGuestAccount}setGuest(e){this.isGuestAccount=e}getScheduler(){return this.scheduler}retryImmediately(){var e,n;return this.toDeviceMessageQueue.sendQueue(),(e=(n=this.syncApi)===null||n===void 0?void 0:n.retryImmediately())!==null&&e!==void 0?e:!1}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(e){this.notifTimelineSet=e}getCapabilities(){var e=this;return B(function*(){var n=e.serverCapabilitiesService.getCachedCapabilities();return n||e.serverCapabilitiesService.fetchCapabilities()})()}getCachedCapabilities(){return this.serverCapabilitiesService.getCachedCapabilities()}fetchCapabilities(){return this.serverCapabilitiesService.fetchCapabilities()}initRustCrypto(){var e=arguments,n=this;return B(function*(){var r,i,s=e.length>0&&e[0]!==void 0?e[0]:{};if(n.cryptoBackend){n.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");return}var o=n.getUserId();if(o===null)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");var a=n.getDeviceId();if(a===null)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");n.logger.debug("Downloading Rust crypto library");var c=yield lb(()=>import("./index-DG_IYqWk.js"),__vite__mapDeps([0,1]),import.meta.url),l=yield c.initRustCrypto({logger:n.logger,http:n.http,userId:o,deviceId:a,secretStorage:n.secretStorage,cryptoCallbacks:n.cryptoCallbacks,storePrefix:s.useIndexedDB===!1?null:(r=s.cryptoDatabasePrefix)!==null&&r!==void 0?r:Ok,storeKey:s.storageKey,storePassphrase:s.storagePassword,legacyCryptoStore:n.legacyCryptoStore,legacyPickleKey:(i=n.legacyPickleKey)!==null&&i!==void 0?i:"DEFAULT_KEY",legacyMigrationProgressListener:(d,h)=>{n.emit(gi.LegacyCryptoStoreMigrationProgress,d,h)},enableEncryptedStateEvents:n.enableEncryptedStateEvents});l.setSupportedVerificationMethods(n.verificationMethods),n.cryptoBackend=l,n.on(Vs.Membership,l.onRoomMembership.bind(l)),n.on(Le.Event,d=>{l.onLiveEventFromSync(d)}),n.reEmitter.reEmit(l,[gi.VerificationRequestReceived,gi.UserTrustStatusChanged,gi.KeyBackupStatus,gi.KeyBackupSessionsRemaining,gi.KeyBackupFailed,gi.KeyBackupDecryptionKeyCached,gi.KeysChanged,gi.DevicesUpdated,gi.WillUpdateDevices,gi.DehydratedDeviceCreated,gi.DehydratedDeviceUploaded,gi.RehydrationStarted,gi.RehydrationProgress,gi.RehydrationCompleted,gi.RehydrationError,gi.DehydrationKeyCached,gi.DehydratedDeviceRotationError])})()}get secretStorage(){return this._secretStorage}getCrypto(){return this.cryptoBackend}isRoomEncrypted(e){var n=this.getRoom(e);return n?n.hasEncryptionStateEvent():!1}isKeyBackupKeyStored(){return Promise.resolve(this.secretStorage.isStored("m.megolm_backup.v1"))}makeKeyBackupPath(e,n,r){var i;n!==void 0?i=xe("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:n}):e!==void 0?i=xe("/room_keys/keys/$roomId",{$roomId:e}):i="/room_keys/keys";var s=r===void 0?void 0:{version:r};return{path:i,queryData:s}}deleteKeysFromBackup(e,n,r){var i=this;return B(function*(){var s=i.makeKeyBackupPath(e,n,r);yield i.http.authedRequest(de.Delete,s.path,s.queryData,void 0,{prefix:Xr.V3})})()}getMediaConfig(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=e?"/media/config":"/config";return this.http.authedRequest(de.Get,n,void 0,void 0,{prefix:e?Xr.V1:Cg.V3})}getRoom(e){return e?this.store.getRoom(e):null}getRooms(){return this.store.getRooms()}getVisibleRooms(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=this.store.getRooms(),r=new Set(n);for(var i of r){var s=this.findPredecessorRooms(i,!0,e);for(var o of s)r.delete(o)}return Array.from(r)}getUser(e){return this.store.getUser(e)}getUsers(){return this.store.getUsers()}setAccountData(e,n){var r=this;return B(function*(){if(!r.clientRunning)return r.logger.warn("Calling `setAccountData` before the client is started: `getAccountData` may return inconsistent results."),yield nA(5,()=>r.setAccountDataRaw(e,n));var i=r.store.getAccountData(e);if(i&&ff(i.event.content,n))return{};var s=Promise.withResolvers();function o(c){c.getType()===e&&s.resolve()}r.addListener(Le.AccountData,o);try{var a=yield nA(5,()=>r.setAccountDataRaw(e,n));return yield s.promise,a}finally{r.removeListener(Le.AccountData,o)}})()}setAccountDataRaw(e,n){var r=xe("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});return this.http.authedRequest(de.Put,r,void 0,n)}getAccountData(e){return this.store.getAccountData(e)}getAccountDataFromServer(e){var n=this;return B(function*(){if(n.isInitialSyncComplete()){var r=n.store.getAccountData(e);return r?r.getContent():null}var i=xe("/user/$userId/account_data/$type",{$userId:n.credentials.userId,$type:e});try{return yield n.http.authedRequest(de.Get,i)}catch(o){var s;if(((s=o.data)===null||s===void 0?void 0:s.errcode)==="M_NOT_FOUND")return null;throw o}})()}deleteAccountData(e){var n=this;return B(function*(){var r=n.canSupport.get(ti.AccountDataDeletion);if(r===Zr.Unsupported){yield n.setAccountData(e,{});return}var i=xe("/user/$userId/account_data/$type",{$userId:n.getSafeUserId(),$type:e}),s=r===Zr.Unstable?{prefix:"/_matrix/client/unstable/org.matrix.msc3391"}:void 0;return yield n.http.authedRequest(de.Delete,i,void 0,void 0,s)})()}getIgnoredUsers(){var e=this.getAccountData(Z.IgnoredUserList);return e!=null&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}setIgnoredUsers(e){var n={ignored_users:{}};return e.forEach(r=>{n.ignored_users[r]={}}),this.setAccountData(Z.IgnoredUserList,n)}isUserIgnored(e){return this.getIgnoredUsers().includes(e)}joinRoom(e){var n=arguments,r=this;return B(function*(){var i,s,o=n.length>1&&n[1]!==void 0?n[1]:{},a=r.getRoom(e),c=a?.getMember(r.getSafeUserId()),l=c?.membership,d=l==Be.Invite&&(i=c==null||(s=c.events.member)===null||s===void 0?void 0:s.getSender())!==null&&i!==void 0?i:null;if(r.logger.debug("joinRoom[".concat(e,"]: preJoinMembership=").concat(l,", inviter=").concat(d,", opts=").concat(JSON.stringify(o))),l==Be.Join)return a;var h=Promise.resolve();if(o.inviteSignUrl){var m=new URL(o.inviteSignUrl);m.searchParams.set("mxid",r.credentials.userId),h=r.http.requestOtherUrl(de.Post,m)}var g={};o.viaServers&&(g.server_name=o.viaServers,g.via=o.viaServers);var y={},v=yield h;v&&(y.third_party_signed=v);var w=xe("/join/$roomid",{$roomid:e}),S=yield r.http.authedRequest(de.Post,w,g,y),R=S.room_id;o.acceptSharedHistory&&d&&r.cryptoBackend&&(yield r.cryptoBackend.maybeAcceptKeyBundle(R,d));var x=r.getRoom(R);if(x!=null&&x.hasMembershipState(r.credentials.userId,Be.Join))return x;var T=new Vd(r,r.clientOpts,r.buildSyncApiOptions());return T.createRoom(R)})()}knockRoom(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.getRoom(e);if(r!=null&&r.hasMembershipState(this.credentials.userId,Be.Knock))return Promise.resolve({room_id:r.roomId});var i=xe("/knock/$roomIdOrAlias",{$roomIdOrAlias:e}),s={};n.viaServers&&(s.server_name=n.viaServers,s.via=n.viaServers);var o={};return n.reason&&(o.reason=n.reason),this.http.authedRequest(de.Post,i,s,o)}resendEvent(e,n){return this.toDeviceMessageQueue.sendQueue(),this.updatePendingEventStatus(n,e,rt.SENDING),this.encryptAndSendEvent(n,e)}cancelPendingEvent(e){if(![rt.QUEUED,rt.NOT_SENT,rt.ENCRYPTING].includes(e.status))throw new Error("cannot cancel an event with status "+e.status);e.status===rt.ENCRYPTING?this.eventsBeingEncrypted.delete(e.getId()):this.scheduler&&e.status===rt.QUEUED&&this.scheduler.removeEventFromQueue(e);var n=this.getRoom(e.getRoomId());this.updatePendingEventStatus(n,e,rt.CANCELLED)}setRoomName(e,n){return this.sendStateEvent(e,Z.RoomName,{name:n})}setRoomTopic(e,n,r){var i=_J(n,r);return this.sendStateEvent(e,Z.RoomTopic,i)}getRoomTags(e){var n=xe("/user/$userId/rooms/$roomId/tags",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(de.Get,n)}setRoomTag(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=xe("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:n});return this.http.authedRequest(de.Put,i,void 0,r)}deleteRoomTag(e,n){var r=xe("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:n});return this.http.authedRequest(de.Delete,r)}setRoomAccountData(e,n,r){var i=xe("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:n});return this.http.authedRequest(de.Put,i,void 0,r)}setPowerLevel(e,n,r){var i=this;return B(function*(){var s,o;if(i.clientRunning&&i.isInitialSyncComplete()){var a;o=(a=i.getRoom(e))===null||a===void 0||(a=a.currentState)===null||a===void 0||(a=a.getStateEvents(Z.RoomPowerLevels,""))===null||a===void 0?void 0:a.getContent()}if(!o)try{o=yield i.getStateEvent(e,Z.RoomPowerLevels,"")}catch(d){if(d instanceof tr&&d.errcode==="M_NOT_FOUND")o={};else throw d}o=d_(o),(s=o)!==null&&s!==void 0&&s.users||(o.users={});var c=Array.isArray(n)?n:[n];for(var l of c)r==null?delete o.users[l]:o.users[l]=r;return i.sendStateEvent(e,Z.RoomPowerLevels,o,"")})()}unstable_createLiveBeacon(e,n){var r=this;return B(function*(){return r.unstable_setLiveBeacon(e,n)})()}unstable_setLiveBeacon(e,n){var r=this;return B(function*(){return r.sendStateEvent(e,ZO.name,n,r.getUserId())})()}sendEvent(e,n,r,i,s){var o,a,c,l;return!(n!=null&&n.startsWith(Cc))&&n!==null?(l=i,c=r,a=n,o=null):(l=s,c=i,a=r,o=n),this.addThreadRelationIfNeeded(c,o,e),this.sendCompleteEvent(e,o,{type:a,content:c},l)}addThreadRelationIfNeeded(e,n,r){var i;if(n&&!((i=e["m.relates_to"])!==null&&i!==void 0&&i.rel_type)){var s,o,a=!!((s=e["m.relates_to"])!==null&&s!==void 0&&s["m.in_reply_to"]);e["m.relates_to"]=Yr(Yr({},e["m.relates_to"]),{},{rel_type:wn.name,event_id:n,is_falling_back:!a});var c=(o=this.getRoom(r))===null||o===void 0?void 0:o.getThread(n);if(c&&!a){var l,d;e["m.relates_to"]["m.in_reply_to"]={event_id:(l=(d=c.lastReply(h=>h.isRelation(wn.name)&&!h.status))===null||d===void 0?void 0:d.getId())!==null&&l!==void 0?l:n}}}}sendCompleteEvent(e,n,r,i,s){var o,a;typeof i=="string"?a=i:(o=i,a=s),a||(a=this.makeTxnId());var c=new $i(Object.assign(r,{event_id:"~"+e+":"+a,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:new Date().getTime()})),l=this.getRoom(e),d=n?l?.getThread(n):void 0;d&&c.setThread(d),o||(this.reEmitter.reEmit(c,[Kt.Replaced,Kt.VisibilityChange]),l?.reEmitter.reEmit(c,[Kt.BeforeRedaction]));var h=c.getAssociatedId();if(h!=null&&h.startsWith("~")){var m=l?.getPendingEvents().find(y=>y.getId()===h);m?.once(Kt.LocalEventIdReplaced,()=>{c.updateAssociatedId(m.getId())})}var g=c.getType();return this.logger.debug("sendEvent of type ".concat(g," in ").concat(e," with txnId ").concat(a).concat(o?" (delayed event)":"")),c.setTxnId(a),c.setStatus(rt.SENDING),o?this.encryptAndSendEvent(l,c,o):(l?.addPendingEvent(c,a),c.status===rt.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(l,c))}encryptAndSendEvent(e,n,r){var i=this;return B(function*(){if(r)return i.sendEventHttpRequest(n,r);try{var s;i.eventsBeingEncrypted.add(n.getId());try{yield i.encryptEventIfNeeded(n,e??void 0)}finally{s=!i.eventsBeingEncrypted.delete(n.getId())}if(s)return{};n.status===rt.ENCRYPTING&&i.updatePendingEventStatus(e,n,rt.SENDING);var o=null;return i.scheduler&&(o=i.scheduler.queueEvent(n),o&&i.scheduler.getQueueForEvent(n).length>1&&i.updatePendingEventStatus(e,n,rt.QUEUED)),o||(o=i.sendEventHttpRequest(n),e&&(o=o.then(a=>(e.updatePendingEvent(n,rt.SENT,a.event_id),a)))),yield o}catch(a){i.logger.error("Error sending event",a);try{n.error=a,i.updatePendingEventStatus(e,n,rt.NOT_SENT)}catch(c){i.logger.error("Exception in error handler!",c)}throw a instanceof tr&&(a.event=n),a}})()}encryptEventIfNeeded(e,n){var r=this;return B(function*(){if(n&&(yield r.shouldEncryptEventForRoom(e,n))&&!(!r.cryptoBackend&&r.usingExternalCrypto)){if(!r.cryptoBackend)throw new Error("This room is configured to use encryption, but your client does not support encryption.");r.updatePendingEventStatus(n,e,rt.ENCRYPTING),yield r.cryptoBackend.encryptEvent(e,n)}})()}shouldEncryptEventForRoom(e,n){var r=this;return B(function*(){var i;return e.isEncrypted()||e.getType()===Z.Reaction||e.isRedaction()?!1:!!(n.hasEncryptionStateEvent()||(yield(i=r.cryptoBackend)===null||i===void 0?void 0:i.isEncryptionEnabledInRoom(n.roomId)))})()}getEncryptedIfNeededEventType(e,n){var r;return n===Z.Reaction?n:(r=this.getRoom(e))!==null&&r!==void 0&&r.hasEncryptionStateEvent()?Z.RoomMessageEncrypted:n}updatePendingEventStatus(e,n,r){e?e.updatePendingEvent(n,r):n.setStatus(r)}sendEventHttpRequest(e,n){var r=e.getTxnId();r||(r=this.makeTxnId(),e.setTxnId(r));var i={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:r},s;if(e.isState()){var o="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(o="/rooms/$roomId/state/$eventType/$stateKey"),s=xe(o,i)}else if(e.isRedaction()&&e.event.redacts){var a="/rooms/$roomId/redact/$redactsEventId/$txnId";s=xe(a,Yr({$redactsEventId:e.event.redacts},i))}else s=xe("/rooms/$roomId/send/$eventType/$txnId",i);var c=e.getWireContent();return n?this.http.authedRequest(de.Put,s,aB(n),c):this.http.authedRequest(de.Put,s,void 0,c).then(l=>(this.logger.debug("Event sent to ".concat(e.getRoomId()," with event id ").concat(l.event_id)),l))}redactEvent(e,n,r,i,s){var o,a,c;(o=r)!==null&&o!==void 0&&o.startsWith(Cc)||(s=i,i=r,r=n,n=null);var l=(a=s)===null||a===void 0?void 0:a.reason,d={reason:l};if(((c=s)===null||c===void 0?void 0:c.with_rel_types)!==void 0){if(this.canSupport.get(ti.RelationBasedRedactions)===Zr.Unsupported)throw new Error("Server does not support relation based redactions "+"roomId ".concat(e," eventId ").concat(r," txnId: ").concat(i," threadId ").concat(n));var h=this.canSupport.get(ti.RelationBasedRedactions)===Zr.Stable?X5.stable:X5.unstable;d[h]=s.with_rel_types}return this.sendCompleteEvent(e,n,{type:Z.RoomRedaction,content:d,redacts:r},i)}sendMessage(e,n,r,i){typeof n!="string"&&n!==null&&(i=r,r=n,n=null);var s=Z.RoomMessage,o=r;return this.sendEvent(e,n,s,o,i)}sendTextMessage(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(Cc))&&n!==null&&(i=r,r=n,n=null);var o=mJ(r);return this.sendMessage(e,n,o,i)}sendNotice(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(Cc))&&n!==null&&(i=r,r=n,n=null);var o=gJ(r);return this.sendMessage(e,n,o,i)}sendEmoteMessage(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(Cc))&&n!==null&&(i=r,r=n,n=null);var o=vJ(r);return this.sendMessage(e,n,o,i)}sendImageMessage(e,n,r,i){var s,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"Image";!((s=n)!==null&&s!==void 0&&s.startsWith(Cc))&&n!==null&&(o=i||"Image",i=r,r=n,n=null);var a={msgtype:ll.Image,url:r,info:i,body:o};return this.sendMessage(e,n,a)}sendStickerMessage(e,n,r,i){var s,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"Sticker";!((s=n)!==null&&s!==void 0&&s.startsWith(Cc))&&n!==null&&(o=i||"Sticker",i=r,r=n,n=null);var a={url:r,info:i,body:o};return this.sendEvent(e,n,Z.Sticker,a)}sendHtmlMessage(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(Cc))&&n!==null&&(i=r,r=n,n=null);var o=fJ(r,i);return this.sendMessage(e,n,o)}sendHtmlNotice(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(Cc))&&n!==null&&(i=r,r=n,n=null);var o=hJ(r,i);return this.sendMessage(e,n,o)}sendHtmlEmote(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(Cc))&&n!==null&&(i=r,r=n,n=null);var o=pJ(r,i);return this.sendMessage(e,n,o)}_unstable_sendDelayedEvent(e,n,r,i,s,o){var a=this;return B(function*(){if(!(yield a.doesServerSupportUnstableFeature(Vc)))throw new Gd("Server does not support the delayed events API","sendDelayedEvent");return a.addThreadRelationIfNeeded(s,r,e),a.sendCompleteEvent(e,r,{type:i,content:s},n,o)})()}_unstable_sendDelayedStateEvent(e,n,r,i){var s=arguments,o=this;return B(function*(){var a=s.length>4&&s[4]!==void 0?s[4]:"",c=s.length>5&&s[5]!==void 0?s[5]:{};if(!(yield o.doesServerSupportUnstableFeature(Vc)))throw new Gd("Server does not support the delayed events API","sendDelayedStateEvent");var l={$roomId:e,$eventType:r,$stateKey:a},d=xe("/rooms/$roomId/state/$eventType",l);return a!==void 0&&(d=xe(d+"/$stateKey",l)),o.http.authedRequest(de.Put,d,aB(n),i,c)})()}_unstable_getDelayedEvents(e){var n=this;return B(function*(){if(!(yield n.doesServerSupportUnstableFeature(Vc)))throw new Gd("Server does not support the delayed events API","getDelayedEvents");var r=e?{from:e}:void 0;return yield n.http.authedRequest(de.Get,"/delayed_events",r,void 0,{prefix:"".concat(Xr.Unstable,"/").concat(Vc)})})()}_unstable_updateDelayedEvent(e,n){var r=arguments,i=this;return B(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:{};if(!(yield i.doesServerSupportUnstableFeature(Vc)))throw new Gd("Server does not support the delayed events API","updateDelayedEvent");var o=xe("/delayed_events/$delayId",{$delayId:e}),a={action:n};return yield i.http.authedRequest(de.Post,o,void 0,a,Yr(Yr({},s),{},{prefix:"".concat(Xr.Unstable,"/").concat(Vc)}))})()}sendReceipt(e,n,r){var i=arguments,s=this;return B(function*(){var o=i.length>3&&i[3]!==void 0?i[3]:!1;if(s.isGuest())return Promise.resolve({});var a=xe("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:n,$eventId:e.getId()}),c=!o&&s.supportsThreads(),l=c?Yr(Yr({},r),{},{thread_id:ov(e)}):r,d=s.http.authedRequest(de.Post,a,void 0,l||{}),h=s.getRoom(e.getRoomId());return h&&s.credentials.userId&&h.addLocalEchoReceipt(s.credentials.userId,e,n,o),d})()}sendReadReceipt(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:ls.Read,s=n.length>2&&n[2]!==void 0?n[2]:!1;if(e){var o=e.getId(),a=r.getRoom(e.getRoomId());if(a!=null&&a.hasPendingEvent(o))throw new Error("Cannot set read receipt to a pending event (".concat(o,")"));return r.sendReceipt(e,i,{},s)}})()}setRoomReadMarkers(e,n,r,i){var s=this;return B(function*(){var o=s.getRoom(e);if(o!=null&&o.hasPendingEvent(n))throw new Error("Cannot set read marker to a pending event (".concat(n,")"));var a;if(r){if(a=r.getId(),o!=null&&o.hasPendingEvent(a))throw new Error("Cannot set read receipt to a pending event (".concat(a,")"));o?.addLocalEchoReceipt(s.credentials.userId,r,ls.Read)}var c;if(i){if(c=i.getId(),o!=null&&o.hasPendingEvent(c))throw new Error("Cannot set read receipt to a pending event (".concat(c,")"));o?.addLocalEchoReceipt(s.credentials.userId,i,ls.ReadPrivate)}return yield s.setRoomReadMarkersHttpRequest(e,n,a,c)})()}sendRtcDecline(e,n){return this.sendEvent(e,Z.RTCDecline,{"m.relates_to":{event_id:n,rel_type:vn.Reference}})}getUrlPreview(e,n){n=Math.floor(n/6e4)*6e4;var r=new URL(e);r.hash="",e=r.toString();var i=n+"_"+e;if(i in this.urlPreviewCache)return this.urlPreviewCache[i];var s=this.http.authedRequest(de.Get,"/preview_url",{url:e,ts:n.toString()},void 0,{prefix:Cg.V3,priority:"low"});return this.urlPreviewCache[i]=s,s}sendTyping(e,n,r){if(this.isGuest())return Promise.resolve({});var i=xe("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.getUserId()}),s={typing:n};return n&&(s.timeout=r||2e4),this.http.authedRequest(de.Put,i,void 0,s)}getRoomUpgradeHistory(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.getRoom(e);if(!i)return[];var s=this.findPredecessorRooms(i,n,r),o=this.findSuccessorRooms(i,n,r);return[...s,i,...o]}findPredecessorRooms(e,n,r){for(var i,s=[],o=new Set([e.roomId]),a=(i=e.findPredecessor(r))===null||i===void 0?void 0:i.roomId;a!==null;){var c;if(a){if(o.has(a))break;o.add(a)}var l=this.getRoom(a);if(l===null)break;if(n){var d=l.currentState.getStateEvents(Z.RoomTombstone,"");if(!d||d.getContent().replacement_room!==e.roomId)break}s.splice(0,0,l),e=l,a=(c=e.findPredecessor(r))===null||c===void 0?void 0:c.roomId}return s}findSuccessorRooms(e,n,r){for(var i=[],s=e.currentState.getStateEvents(Z.RoomTombstone,"");s;){var o=this.getRoom(s.getContent().replacement_room);if(!o||o.roomId===e.roomId)break;if(n){var a,c=(a=o.findPredecessor(r))===null||a===void 0?void 0:a.roomId;if(!c||c!==e.roomId)break}i.push(o);var l=new Set(i.map(d=>d.roomId));if(l.size<i.length)return i.slice(0,i.length-1);e=o,s=e.currentState.getStateEvents(Z.RoomTombstone,"")}return i}invite(e,n){var r=arguments,i=this;return B(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:{};if(typeof s!="object"&&(s={reason:s}),s.shareEncryptedHistory){var o;yield(o=i.cryptoBackend)===null||o===void 0?void 0:o.shareRoomHistoryWithUser(e,n)}return yield i.membershipChange(e,n,Be.Invite,s.reason)})()}inviteByEmail(e,n){return this.inviteByThreePid(e,"email",n)}inviteByThreePid(e,n,r){var i=this;return B(function*(){var s,o=xe("/rooms/$roomId/invite",{$roomId:e}),a=i.getIdentityServerUrl(!0);if(!a)return Promise.reject(new tr({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));var c={id_server:a,medium:n,address:r};if((s=i.identityServer)!==null&&s!==void 0&&s.getAccessToken){var l=yield i.identityServer.getAccessToken();l&&(c.id_access_token=l)}return i.http.authedRequest(de.Post,o,void 0,c)})()}leave(e){return this.membershipChange(e,void 0,Be.Leave)}leaveRoomChain(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this.getRoomUpgradeHistory(e,!0),i=r;if(!n){i=[];for(var s of r)if(i.push(s),s.roomId===e)break}var o={},a=[],c=d=>this.leave(d).then(()=>{delete o[d]}).catch(h=>{o[d]=h});for(var l of i)a.push(c(l.roomId));return Promise.all(a).then(()=>o)}ban(e,n,r){return this.membershipChange(e,n,Be.Ban,r)}forget(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!0,s=xe("/rooms/$room_id/forget",{$room_id:e}),o=yield r.http.authedRequest(de.Post,s);return i&&(r.store.removeRoom(e),r.emit(Le.DeleteRoom,e)),o})()}unban(e,n){var r=xe("/rooms/$roomId/unban",{$roomId:e}),i={user_id:n};return this.http.authedRequest(de.Post,r,void 0,i)}kick(e,n,r){var i=xe("/rooms/$roomId/kick",{$roomId:e}),s={user_id:n,reason:r};return this.http.authedRequest(de.Post,i,void 0,s)}membershipChange(e,n,r,i){var s=xe("/rooms/$room_id/$membership",{$room_id:e,$membership:r});return this.http.authedRequest(de.Post,s,void 0,{user_id:n,reason:i})}getPushActionsForEvent(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!e.getPushActions()||n){var{actions:r,rule:i}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(r,i)}return e.getPushActions()}getPushDetailsForEvent(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!e.getPushDetails()||n){var{actions:r,rule:i}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(r,i)}return e.getPushDetails()}setProfileInfo(e,n){var r=xe("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(de.Put,r,void 0,n)}setDisplayName(e){var n=this;return B(function*(){var r=yield n.setProfileInfo("displayname",{displayname:e}),i=n.getUser(n.getUserId());return i&&(i.displayName=e,i.emit(Ui.DisplayName,i.events.presence,i)),r})()}setAvatarUrl(e){var n=this;return B(function*(){var r=yield n.setProfileInfo("avatar_url",{avatar_url:e}),i=n.getUser(n.getUserId());return i&&(i.avatarUrl=e,i.emit(Ui.AvatarUrl,i.events.presence,i)),r})()}mxcUrlToHttp(e,n,r,i,s,o,a){return W3(this.baseUrl,e,n,r,i,s,o,a)}setSyncPresence(e){var n=this;return B(function*(){var r;(r=n.syncApi)===null||r===void 0||r.setPresence(e)})()}setPresence(e){var n=this;return B(function*(){var r=xe("/presence/$userId/status",{$userId:n.credentials.userId}),i=["offline","online","unavailable"];if(i.indexOf(e.presence)===-1)throw new Error("Bad presence value: "+e.presence);yield n.http.authedRequest(de.Put,r,void 0,e)})()}getPresence(e){var n=xe("/presence/$userId/status",{$userId:e});return this.http.authedRequest(de.Get,n)}scrollback(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:30,r=0,i=this.ongoingScrollbacks[e.roomId]||{};if(i.promise)return i.promise;if(i.errorTs){var s=Date.now()-i.errorTs;r=Math.max(Bye-s,0)}if(e.oldState.paginationToken===null)return Promise.resolve(e);var o=this.store.scrollback(e,n).length;if(o===n)return Promise.resolve(e);n=n-o;var a=new Promise((c,l)=>{_p(r).then(()=>this.createMessagesRequest(e.roomId,e.oldState.paginationToken,n,ht.Backward)).then(d=>{var h,m,g=d.chunk.map(this.getEventMapper());if(d.state){var y=d.state.map(this.getEventMapper());e.currentState.setUnknownStateEvents(y)}var[v,w,S]=e.partitionThreadedEvents(g);this.processAggregatedTimelineEvents(e,v),e.addEventsToTimeline(v,!0,!0,e.getLiveTimeline()),this.processThreadEvents(e,w,!0),S.forEach(R=>e.relations.aggregateChildEvent(R)),e.oldState.paginationToken=(h=d.end)!==null&&h!==void 0?h:null,d.chunk.length===0&&(e.oldState.paginationToken=null),this.store.storeEvents(e,g,(m=d.end)!==null&&m!==void 0?m:null,!0),delete this.ongoingScrollbacks[e.roomId],c(e)}).catch(d=>{this.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},l(d)})});return i={promise:a},this.ongoingScrollbacks[e.roomId]=i,a}getEventMapper(e){return L1e(this,e||{})}getEventTimeline(e,n){var r=this;return B(function*(){var i,s,o,a;if(!r.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!(e!=null&&e.room))throw new Error("getEventTimeline only supports room timelines");if(e.getTimelineForEvent(n))return e.getTimelineForEvent(n);if(e.thread&&r.supportsThreads())return r.getThreadTimeline(e,n);var c=xe("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:n}),l=void 0;(i=r.clientOpts)!==null&&i!==void 0&&i.lazyLoadMembers&&(l={filter:JSON.stringify(Us.LAZY_LOADING_MESSAGES_FILTER)});var d=yield r.http.authedRequest(de.Get,c,l);if(!d.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(n))return e.getTimelineForEvent(n);var h=r.getEventMapper(),m=h(d.event);if(m.isRelation(wn.name)){r.logger.warn("Tried loading a regular timeline at the position of a thread event");return}var g=[...d.events_after.reverse().map(h),m,...d.events_before.map(h)],y=e.getTimelineForEvent(g[0].getId());y?y.getState(Me.BACKWARDS).setUnknownStateEvents(d.state.map(h)):(y=e.addTimeline(),y.initialiseState(d.state.map(h)),y.getState(Me.FORWARDS).paginationToken=d.end);var[v,w,S]=e.room.partitionThreadedEvents(g);return e.addEventsToTimeline(v,!0,!1,y,d.start),r.processThreadEvents(e.room,w,!0),r.processAggregatedTimelineEvents(e.room,v),S.forEach(R=>e.relations.aggregateChildEvent(R)),(s=(o=e.getTimelineForEvent(n))!==null&&o!==void 0?o:(a=e.room.findThreadForEvent(m))===null||a===void 0?void 0:a.liveTimeline)!==null&&s!==void 0?s:y})()}getThreadTimeline(e,n){var r=this;return B(function*(){var i;if(!r.supportsThreads())throw new Error("could not get thread timeline: no client support");if(!e.room)throw new Error("could not get thread timeline: not a room timeline");if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");var s=xe("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:n}),o={limit:"0"};(i=r.clientOpts)!==null&&i!==void 0&&i.lazyLoadMembers&&(o.filter=JSON.stringify(Us.LAZY_LOADING_MESSAGES_FILTER));var a=yield r.http.authedRequest(de.Get,s,o),c=r.getEventMapper(),l=c(a.event);if(e.canContain(l)){var d=r.canSupport.get(ti.RelationsRecursion)!==Zr.Unsupported;if(Un.hasServerSideSupport)if(Un.hasServerSideFwdPaginationSupport){var h,m,g;if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");var y=e.thread,v=yield r.fetchRelations(e.room.roomId,y.id,null,null,{dir:ht.Backward,from:a.start,recurse:d||void 0}),w=yield r.fetchRelations(e.room.roomId,y.id,null,null,{dir:ht.Forward,from:a.end,recurse:d||void 0}),S=[...w.chunk.reverse().filter(Nk(y.id)).map(c),l,...v.chunk.filter(Nk(y.id)).map(c)];for(var R of S){var x;yield(x=e.thread)===null||x===void 0?void 0:x.processEvent(R)}var T=e.getTimelineForEvent(l.getId());if(T?T.getState(Me.BACKWARDS).setUnknownStateEvents(a.state.map(c)):(T=e.addTimeline(),T.initialiseState(a.state.map(c))),e.addEventsToTimeline(S,!0,!1,T,w.next_batch),!v.next_batch){var I=yield r.fetchRoomEvent(e.room.roomId,y.id);e.addEventsToTimeline([c(I)],!0,!1,T,null)}return T.setPaginationToken((h=v.next_batch)!==null&&h!==void 0?h:null,ht.Backward),T.setPaginationToken((m=w.next_batch)!==null&&m!==void 0?m:null,ht.Forward),r.processAggregatedTimelineEvents(e.room,S),(g=e.getTimelineForEvent(n))!==null&&g!==void 0?g:T}else{for(var k,A=e.thread,O=yield r.fetchRelations(e.room.roomId,A.id,wn.name,null,{dir:ht.Backward,from:a.start,recurse:d||void 0}),D=[],N=a.end;N;){var U,$=yield r.fetchRelations(e.room.roomId,A.id,wn.name,null,{dir:ht.Forward,from:N,recurse:d||void 0});N=(U=$.next_batch)!==null&&U!==void 0?U:null,D.push(...$.chunk)}var K=[...D.reverse().map(c),l,...O.chunk.map(c)];for(var Y of K){var G;yield(G=e.thread)===null||G===void 0?void 0:G.processEvent(Y)}var F=e.getLiveTimeline();if(F.getState(Me.BACKWARDS).setUnknownStateEvents(a.state.map(c)),e.addEventsToTimeline(K,!0,!1,F,null),!O.next_batch){var q=yield r.fetchRoomEvent(e.room.roomId,A.id);e.addEventsToTimeline([c(q)],!0,!1,F,null)}return F.setPaginationToken((k=O.next_batch)!==null&&k!==void 0?k:null,ht.Backward),F.setPaginationToken(null,ht.Forward),r.processAggregatedTimelineEvents(e.room,K),F}}})()}getLatestTimeline(e){var n=this;return B(function*(){if(!n.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!e.room)throw new Error("getLatestTimeline only supports room timelines");var r;if(e.threadListType!==null){var i,s=yield n.createThreadListMessagesRequest(e.room.roomId,null,1,ht.Backward,e.threadListType,e.getFilter());r=(i=s.chunk)===null||i===void 0?void 0:i[0]}else if(e.thread&&Un.hasServerSideSupport){var o,a=n.canSupport.get(ti.RelationsRecursion)!==Zr.Unsupported,c=yield n.fetchRelations(e.room.roomId,e.thread.id,wn.name,null,{dir:ht.Backward,limit:1,recurse:a||void 0});r=(o=c.chunk)===null||o===void 0?void 0:o[0]}else{var l,d,h=xe("/rooms/$roomId/messages",{$roomId:e.room.roomId}),m={dir:"b"};(l=n.clientOpts)!==null&&l!==void 0&&l.lazyLoadMembers&&(m.filter=JSON.stringify(Us.LAZY_LOADING_MESSAGES_FILTER));var g=yield n.http.authedRequest(de.Get,h,m);r=(d=g.chunk)===null||d===void 0?void 0:d[0]}if(!r)throw new Error("No message returned when trying to construct getLatestTimeline");return n.getEventTimeline(e,r.event_id)})()}createMessagesRequest(e,n){var r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:30,s=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=xe("/rooms/$roomId/messages",{$roomId:e}),c={limit:i.toString(),dir:s};n&&(c.from=n);var l=null;if((r=this.clientOpts)!==null&&r!==void 0&&r.lazyLoadMembers&&(l=Object.assign({},Us.LAZY_LOADING_MESSAGES_FILTER)),o){var d;l=l||{},Object.assign(l,(d=o.getRoomTimelineFilterComponent())===null||d===void 0?void 0:d.toJSON())}return l&&(c.filter=JSON.stringify(l)),this.http.authedRequest(de.Get,a,c)}createThreadListMessagesRequest(e,n){var r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:30,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ht.Backward,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Ba.All,a=arguments.length>5?arguments[5]:void 0,c=xe("/rooms/$roomId/threads",{$roomId:e}),l={limit:i.toString(),dir:s,include:SQ(o)};n&&(l.from=n);var d={};if((r=this.clientOpts)!==null&&r!==void 0&&r.lazyLoadMembers&&(d=Yr({},Us.LAZY_LOADING_MESSAGES_FILTER)),a){var h;d=Yr(Yr({},d),(h=a.getRoomTimelineFilterComponent())===null||h===void 0?void 0:h.toJSON())}Object.keys(d).length&&(l.filter=JSON.stringify(d));var m={prefix:Un.hasServerSideListSupport===Zi.Stable?Xr.V1:"/_matrix/client/unstable/org.matrix.msc3856"};return this.http.authedRequest(de.Get,c,l,void 0,m).then(g=>{var y;return Yr(Yr({},g),{},{chunk:(y=g.chunk)===null||y===void 0?void 0:y.reverse(),start:g.prev_batch,end:g.next_batch})})}paginateEventTimeline(e,n){var r=this,i=e.getTimelineSet()===this.notifTimelineSet,s=this.getRoom(e.getRoomId()),o=e.getTimelineSet().threadListType,a=e.getTimelineSet().thread;n=n||{};var c=n.backwards||!1;if(i&&!c)throw new Error("paginateNotifTimeline can only paginate backwards");var l=c?Me.BACKWARDS:Me.FORWARDS,d=e.getPaginationToken(l),h=e.paginationRequests[l];if(h)return h;var m,g,y;if(i){var v;m="/notifications",g={limit:((v=n.limit)!==null&&v!==void 0?v:30).toString(),only:"highlight"},d&&d!=="end"&&(g.from=d),y=this.http.authedRequest(de.Get,m,g).then(function(){var T=B(function*(I){var k=I.next_token,A=[];I.notifications=I.notifications.filter(Ka);for(var O=0;O<I.notifications.length;O++){var D=I.notifications[O],N=r.getEventMapper()(D.event);r.getPushDetailsForEvent(N,!0),N.event.room_id=D.room_id,A[O]=N}var U=e.getTimelineSet();return U.addEventsToTimeline(A,c,!1,e,k),r.processAggregatedTimelineEvents(U.room,A),c&&!I.next_token&&e.setPaginationToken(null,l),!!I.next_token});return function(I){return T.apply(this,arguments)}}()).finally(()=>{e.paginationRequests[l]=null}),e.paginationRequests[l]=y}else if(o!==null){if(!s)throw new Error("Unknown room "+e.getRoomId());if(!Un.hasServerSideFwdPaginationSupport&&l===ht.Forward)throw new Error("Cannot paginate threads forwards without server-side support for MSC 3715");y=this.createThreadListMessagesRequest(e.getRoomId(),d,n.limit,l,o,e.getFilter()).then(T=>{if(T.state){var I=e.getState(l),k=T.state.filter(Ka).map(this.getEventMapper());I.setUnknownStateEvents(k)}var A=T.end,O=T.chunk.filter(Ka).map(this.getEventMapper()),D=e.getTimelineSet();return D.addEventsToTimeline(O,c,!1,e,A),this.processAggregatedTimelineEvents(s,O),this.processThreadRoots(s,O,c),c&&T.end==T.start&&e.setPaginationToken(null,l),T.end!==T.start}).finally(()=>{e.paginationRequests[l]=null}),e.paginationRequests[l]=y}else if(a){var w,S,R=this.getRoom((w=e.getRoomId())!==null&&w!==void 0?w:void 0);if(!R)throw new Error("Unknown room "+e.getRoomId());var x=this.canSupport.get(ti.RelationsRecursion)!==Zr.Unsupported;y=this.fetchRelations((S=e.getRoomId())!==null&&S!==void 0?S:"",a.id,null,null,{dir:l,limit:n.limit,from:d??void 0,recurse:x||void 0}).then(function(){var T=B(function*(I){var k=r.getEventMapper(),A=I.chunk.filter(Ka).filter(Nk(a.id)).map(k);for(var O of A.slice().reverse()){yield a?.processEvent(O);var D=O.getSender();(!c||a?.getEventReadUpTo(D)===null)&&R.addLocalEchoReceipt(D,O,ls.Read)}var N=I.next_batch,U=e.getTimelineSet();if(U.addEventsToTimeline(A,c,!1,e,N??null),!N&&c){var $,K,Y=($=a.rootEvent)!==null&&$!==void 0?$:k(yield r.fetchRoomEvent((K=e.getRoomId())!==null&&K!==void 0?K:"",a.id));U.addEventsToTimeline([Y],!0,!1,e,null)}return r.processAggregatedTimelineEvents(U.room,A),c&&!N&&e.setPaginationToken(null,l),!!N});return function(I){return T.apply(this,arguments)}}()).finally(()=>{e.paginationRequests[l]=null}),e.paginationRequests[l]=y}else{if(!s)throw new Error("Unknown room "+e.getRoomId());y=this.createMessagesRequest(e.getRoomId(),d,n.limit,l,e.getFilter()).then(T=>{if(T.state){var I=e.getState(l),k=T.state.filter(Ka).map(this.getEventMapper());I.setUnknownStateEvents(k)}var A=T.end,O=T.chunk.filter(Ka).map(this.getEventMapper()),D=e.getTimelineSet(),[N,,U]=s.partitionThreadedEvents(O);D.addEventsToTimeline(N,c,!1,e,A),this.processAggregatedTimelineEvents(s,N),this.processThreadRoots(s,N.filter(K=>K.getServerAggregatedRelation(wn.name)),!1),U.forEach(K=>s.relations.aggregateChildEvent(K));var $=T.end===void 0||T.end===T.start;return c&&$&&e.setPaginationToken(null,l),!$}).finally(()=>{e.paginationRequests[l]=null}),e.paginationRequests[l]=y}return y}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end")}peekInRoom(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:20;return(n=this.peekSync)===null||n===void 0||n.stopPeeking(),this.peekSync=new Vd(this,this.clientOpts,this.buildSyncApiOptions()),this.peekSync.peek(e,r)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(e,n){var r=this.sendStateEvent(e,Z.RoomGuestAccess,{guest_access:n.allowJoin?dC.CanJoin:dC.Forbidden},""),i=Promise.resolve();return n.allowRead&&(i=this.sendStateEvent(e,Z.RoomHistoryVisibility,{history_visibility:QO.WorldReadable},"")),Promise.all([i,r]).then()}requestRegisterEmailToken(e,n,r,i){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:n,send_attempt:r,next_link:i})}requestRegisterMsisdnToken(e,n,r,i,s){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:n,client_secret:r,send_attempt:i,next_link:s})}requestAdd3pidEmailToken(e,n,r,i){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:n,send_attempt:r,next_link:i})}requestAdd3pidMsisdnToken(e,n,r,i,s){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:n,client_secret:r,send_attempt:i,next_link:s})}requestPasswordEmailToken(e,n,r,i){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:n,send_attempt:r,next_link:i})}requestPasswordMsisdnToken(e,n,r,i,s){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:n,client_secret:r,send_attempt:i,next_link:s})}requestTokenFromEndpoint(e,n){var r=this;return B(function*(){var i=Object.assign({},n);return r.http.request(de.Post,e,void 0,i)})()}getRoomPushRule(e,n){if(this.pushRules){var r;return(r=this.pushRules[e])===null||r===void 0||(r=r.room)===null||r===void 0?void 0:r.find(i=>i.rule_id===n)}else throw new Error("SyncApi.sync() must be done before accessing to push rules.")}setRoomMutePushRule(e,n,r){var i,s=!1,o=this.getRoomPushRule(e,n);if(o!=null&&o.actions.includes(Zd.DontNotify)&&(s=!0),!r)s&&(i=this.deletePushRule(e,wi.RoomSpecific,o.rule_id));else if(!o)i=this.addPushRule(e,wi.RoomSpecific,n,{actions:[Zd.DontNotify]});else if(!s){var a=Promise.withResolvers();this.deletePushRule(e,wi.RoomSpecific,o.rule_id).then(()=>{this.addPushRule(e,wi.RoomSpecific,n,{actions:[Zd.DontNotify]}).then(()=>{a.resolve()}).catch(c=>{a.reject(c)})}).catch(c=>{a.reject(c)}),i=a.promise}if(i)return new Promise((c,l)=>{i.then(()=>{this.getPushRules().then(d=>{this.pushRules=d,c()}).catch(d=>{l(d)})}).catch(d=>{this.getPushRules().then(h=>{this.pushRules=h,l(d)}).catch(h=>{l(d)})})})}searchMessageText(e){var n={search_term:e.query};return"keys"in e&&(n.keys=e.keys),this.search({body:{search_categories:{room_events:n}}})}searchRoomEvents(e){var n={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:KJ.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},r={_query:n,results:[],highlights:[]};return this.search({body:n}).then(i=>this.processRoomEventsSearch(r,i))}backPaginateRoomEventsSearch(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;var n={body:e._query,next_batch:e.next_batch},r=this.search(n,e.abortSignal).then(i=>this.processRoomEventsSearch(e,i)).finally(()=>{e.pendingRequest=void 0});return e.pendingRequest=r,r}processRoomEventsSearch(e,n){var r,i,s=n.search_categories.room_events;e.count=s.count,e.next_batch=s.next_batch;var o=new Set(s.highlights);e.highlights.forEach(g=>{o.add(g)}),e.highlights=Array.from(o);for(var a=this.getEventMapper(),c=(r=(i=s.results)===null||i===void 0?void 0:i.length)!==null&&r!==void 0?r:0,l=0;l<c;l++){var d=tT.fromJson(s.results[l],a),h=this.getRoom(d.context.getEvent().getRoomId());if(h)for(var m of d.context.getTimeline())m.setMetadata(h.currentState,!1);e.results.push(d)}return e}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;var e=new Vd(this,this.clientOpts,this.buildSyncApiOptions());return this.syncLeftRoomsPromise=e.syncLeftRooms(),this.syncLeftRoomsPromise.then(()=>{this.logger.debug("Marking success of sync left room request"),this.syncedLeftRooms=!0}).finally(()=>{this.syncLeftRoomsPromise=void 0}),this.syncLeftRoomsPromise}createFilter(e){var n=xe("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(de.Post,n,void 0,e).then(r=>{var i=Us.fromJson(this.credentials.userId,r.filter_id,e);return this.store.storeFilter(i),i})}getFilter(e,n,r){if(r){var i=this.store.getFilter(e,n);if(i)return Promise.resolve(i)}var s=xe("/user/$userId/filter/$filterId",{$userId:e,$filterId:n});return this.http.authedRequest(de.Get,s).then(o=>{var a=Us.fromJson(e,n,o);return this.store.storeFilter(a),a})}getOrCreateFilter(e,n){var r=this;return B(function*(){var i=r.store.getFilterIdByName(e),s;if(i){try{var o=yield r.getFilter(r.credentials.userId,i,!0);if(o){var a=o.getDefinition(),c=n.getDefinition();ff(a,c)&&(s=i)}}catch(d){if(d.errcode!=="M_UNKNOWN"&&d.errcode!=="M_NOT_FOUND")throw d}s||r.store.setFilterIdByName(e,void 0)}if(s)return s;var l=yield r.createFilter(n.getDefinition());return r.store.setFilterIdByName(e,l.filterId),l.filterId})()}getOpenIdToken(){var e=xe("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(de.Post,e,void 0,{})}turnServer(){return this.http.authedRequest(de.Get,"/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}get pollingTurnServers(){return this.checkTurnServersIntervalID!==void 0}checkTurnServers(){var e=this;return B(function*(){if(e.canSupportVoip){var n=!1,r=e.turnServersExpiry-Date.now();if(r>oB)e.logger.debug("TURN creds are valid for another "+r+" ms: not fetching new ones."),n=!0;else{e.logger.debug("Fetching new TURN credentials");try{var i=yield e.turnServer();if(i.uris){e.logger.debug("Got TURN URIs: "+i.uris+" refresh in "+i.ttl+" secs");var s={urls:i.uris,username:i.username,credential:i.password};e.turnServers=[s],e.turnServersExpiry=Date.now()+i.ttl*1e3,n=!0,e.emit(Le.TurnServers,e.turnServers)}}catch(o){e.logger.error("Failed to get TURN URIs",o),o.httpStatus===403?(e.logger.info("TURN access unavailable for this account: stopping credentials checks"),e.checkTurnServersIntervalID!==null&&globalThis.clearInterval(e.checkTurnServersIntervalID),e.checkTurnServersIntervalID=void 0,e.emit(Le.TurnServersError,o,!0)):e.emit(Le.TurnServersError,o,!1)}}return n}})()}setFallbackICEServerAllowed(e){this.fallbackICEServerAllowed=e}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){var e=xe("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(de.Get,e,void 0,void 0,{prefix:""}).then(n=>n.admin)}whoisSynapseUser(e){var n=xe("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(de.Get,n,void 0,void 0,{prefix:""})}deactivateSynapseUser(e){var n=xe("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(de.Post,n,void 0,void 0,{prefix:""})}fetchClientWellKnown(){var e=this;return B(function*(){var n;e.clientWellKnownPromise=lt.getRawClientConfig((n=e.getDomain())!==null&&n!==void 0?n:void 0),e.clientWellKnown=yield e.clientWellKnownPromise,e.emit(Le.ClientWellKnown,e.clientWellKnown)})()}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){if(!this.clientRunning)throw new Error("Client is not running");return this.clientWellKnownPromise}storeClientOptions(){var e=["boolean","string","number"],n=Object.entries(this.clientOpts).filter(r=>{var[i,s]=r;return e.includes(typeof s)}).reduce((r,i)=>{var[s,o]=i;return r[s]=o,r},{});return this.store.storeClientOptions(n)}_unstable_getSharedRooms(e){var n=this;return B(function*(){var r=yield n.doesServerSupportUnstableFeature(mQ),i=yield n.doesServerSupportUnstableFeature(gQ),s=yield n.doesServerSupportUnstableFeature(vQ);if(!r&&!i&&!s)throw Error("Server does not support the Mutual Rooms API");var o,a;s?(o="/uk.half-shot.msc2666/user/mutual_rooms",a={user_id:e}):(o=xe("/uk.half-shot.msc2666/user/".concat(i?"mutual_rooms":"shared_rooms","/$userId"),{$userId:e}),a={});var c=[],l=null;do{var d={};l!=null&&s&&(d.batch_token=l);var h=yield n.http.authedRequest(de.Get,o,Yr(Yr({},a),d),void 0,{prefix:Xr.Unstable});c.push(...h.joined),h.next_batch_token!==void 0?l=h.next_batch_token:l=null}while(l!=null);return c})()}getVersions(){var e=this;return B(function*(){if(e.serverVersionsPromise)return e.serverVersionsPromise;e.serverVersionsPromise=e.http.authedRequest(de.Get,"/_matrix/client/versions",void 0,void 0,{prefix:""}).catch(r=>{throw e.serverVersionsPromise=void 0,r});var n=yield e.serverVersionsPromise;return e.canSupport=yield O0e(n),e.serverVersionsPromise})()}isVersionSupported(e){var n=this;return B(function*(){var{versions:r}=yield n.getVersions();return r&&r.includes(e)})()}doesServerSupportUnstableFeature(e){var n=this;return B(function*(){var r=yield n.getVersions();if(!r)return!1;var i=r.unstable_features;return i&&!!i[e]})()}doesServerForceEncryptionForPreset(e){var n=this;return B(function*(){var r=yield n.getVersions();if(!r)return!1;var i=r.unstable_features,s=e.includes("_chat")?e.substring(0,e.indexOf("_chat")):e;return i&&!!i["io.element.e2ee_forced.".concat(s)]})()}doesServerSupportThread(){var e=this;return B(function*(){if(yield e.isVersionSupported("v1.4"))return{threads:Zi.Stable,list:Zi.Stable,fwdPagination:Zi.Stable};try{var[n,r,i,s,o,a]=yield Promise.all([e.doesServerSupportUnstableFeature("org.matrix.msc3440"),e.doesServerSupportUnstableFeature("org.matrix.msc3440.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3856"),e.doesServerSupportUnstableFeature("org.matrix.msc3856.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3715"),e.doesServerSupportUnstableFeature("org.matrix.msc3715.stable")]);return{threads:JE(r,n),list:JE(s,i),fwdPagination:JE(a,o)}}catch{return{threads:Zi.None,list:Zi.None,fwdPagination:Zi.None}}})()}hasLazyLoadMembersEnabled(){var e;return!!((e=this.clientOpts)!==null&&e!==void 0&&e.lazyLoadMembers)}setCanResetTimelineCallback(e){this.canResetTimelineCallback=e}getCanResetTimelineCallback(){return this.canResetTimelineCallback}relations(e,n,r,i){var s=arguments,o=this;return B(function*(){var a,c,l=s.length>4&&s[4]!==void 0?s[4]:{dir:ht.Backward},d=i?o.getEncryptedIfNeededEventType(e,i):null,[h,m]=yield Promise.all([o.fetchRoomEvent(e,n),o.fetchRelations(e,n,r,d,l)]),g=o.getEventMapper(),y=h?g(h):void 0,v=m.chunk.map(g);if(d===Z.RoomMessageEncrypted){var w=y?v.concat(y):v;yield Promise.all(w.map(S=>o.decryptEventIfNeeded(S))),i!==null&&(v=v.filter(S=>S.getType()===i))}return y&&r===vn.Replace&&(v=v.filter(S=>S.getSender()===y.getSender())),{originalEvent:y??null,events:v,nextBatch:(a=m.next_batch)!==null&&a!==void 0?a:null,prevBatch:(c=m.prev_batch)!==null&&c!==void 0?c:null}})()}generateClientSecret(){return To(32)}decryptEventIfNeeded(e,n){return e.isState()&&!this.enableEncryptedStateEvents?Promise.resolve():(e.shouldAttemptDecryption()&&this.getCrypto()&&e.attemptDecryption(this.cryptoBackend,n),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve())}termsUrlForService(e,n){switch(e){case fA.IS:return this.http.getUrl("/terms",void 0,$l.V2,n);case fA.IM:return this.http.getUrl("/terms",void 0,"/_matrix/integrations/v1",n);default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(){var e,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return r&&((e=this.idBaseUrl)!==null&&e!==void 0&&e.startsWith("http://")||(n=this.idBaseUrl)!==null&&n!==void 0&&n.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(e){this.idBaseUrl=Ek(e),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}getRefreshToken(){var e;return(e=this.http.opts.refreshToken)!==null&&e!==void 0?e:null}setAccessToken(e){this.http.opts.accessToken=e,this.serverVersionsPromise=void 0}isLoggedIn(){return this.http.opts.accessToken!==void 0}makeTxnId(){return"m"+new Date().getTime()+"."+this.txnCtr++}isUsernameAvailable(e){return this.http.authedRequest(de.Get,"/register/available",{username:e}).then(n=>n.available).catch(n=>n.errcode==="M_USER_IN_USE"?!1:Promise.reject(n))}register(e,n,r,i,s,o,a){r&&(i.session=r);var c={auth:i,refresh_token:!0};return e!=null&&(c.username=e),n!=null&&(c.password=n),o!=null&&(c.guest_access_token=o),a!=null&&(c.inhibit_login=a),this.registerRequest(c)}registerGuest(){var{body:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.registerRequest(e||{},"guest")}registerRequest(e,n){var r={};return n&&(r.kind=n),this.http.request(de.Post,"/register",r,e)}refreshToken(e){var n=r=>this.http.authedRequest(de.Post,"/refresh",void 0,{refresh_token:e},{prefix:r,inhibitLogoutEmit:!0});return n(Xr.V3).catch(r=>{if(r.errcode==="M_UNRECOGNIZED")return n(Xr.V1);throw r})}loginFlows(){return this.http.request(de.Get,"/login")}login(e,n){return this.loginRequest(Yr(Yr({},n),{},{type:e})).then(r=>(r.access_token&&r.user_id&&(this.http.opts.accessToken=r.access_token,this.credentials={userId:r.user_id}),r))}loginWithPassword(e,n){return this.login("m.login.password",{user:e,password:n})}getCasLoginUrl(e){return this.getSsoLoginUrl(e,"cas")}getSsoLoginUrl(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"sso",r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,s="/login/"+n+"/redirect";r&&(s+="/"+r);var o={redirectUrl:e,[qye.unstable]:i};return this.http.getUrl(s,o).href}loginWithToken(e){return this.login("m.login.token",{token:e})}loginRequest(e){var n=this;return B(function*(){return yield n.http.authedRequest(de.Post,"/login",void 0,e)})()}logout(){var e=arguments,n=this;return B(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:!1;return r&&(n.stopClient(),n.http.abort()),n.http.authedRequest(de.Post,"/logout")})()}deactivateAccount(e,n){var r={};return e&&(r.auth=e),n!==void 0&&(r.erase=n),this.http.authedRequest(de.Post,"/account/deactivate",void 0,r)}requestLoginToken(e){var n=this;return B(function*(){var r={auth:e};return n.http.authedRequest(de.Post,"/login/get_token",void 0,r,{prefix:Xr.V1})})()}getFallbackAuthUrl(e,n){var r=xe("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(r,{session:n}).href}createRoom(e){var n=this;return B(function*(){var r,i=(e.invite_3pid||[]).filter(a=>!a.id_access_token);if(i.length>0&&(r=n.identityServer)!==null&&r!==void 0&&r.getAccessToken){var s=yield n.identityServer.getAccessToken();if(s)for(var o of i)o.id_access_token=s}return n.http.authedRequest(de.Post,"/createRoom",void 0,e)})()}fetchRelations(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{dir:ht.Backward},o=s;Un.hasServerSideFwdPaginationSupport===Zi.Experimental&&(o=xF("dir","org.matrix.msc3715.dir",o)),this.canSupport.get(ti.RelationsRecursion)===Zr.Unstable&&(o=xF("recurse","org.matrix.msc3981.recurse",o));var a=B5(o),c="/rooms/$roomId/relations/$eventId";r!==null?(c+="/$relationType",i!==null&&(c+="/$eventType")):i!==null&&(this.logger.warn("eventType: ".concat(i,` ignored when fetching
            relations as relationType is null`)),i=null);var l=xe(c+"?"+a,{$roomId:e,$eventId:n,$relationType:r,$eventType:i});return this.http.authedRequest(de.Get,l,void 0,void 0,{prefix:Xr.V1})}roomState(e){var n=xe("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(de.Get,n)}fetchRoomEvent(e,n){var r=xe("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:n});return this.http.authedRequest(de.Get,r)}members(e,n,r,i){var s={};n&&(s.membership=n),r&&(s.not_membership=r),i&&(s.at=i);var o=B5(s),a=xe("/rooms/$roomId/members?"+o,{$roomId:e});return this.http.authedRequest(de.Get,a)}upgradeRoom(e,n){var r=xe("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(de.Post,r,void 0,{new_version:n})}getStateEvent(e,n,r){var i={$roomId:e,$eventType:n,$stateKey:r},s=xe("/rooms/$roomId/state/$eventType",i);return r!==void 0&&(s=xe(s+"/$stateKey",i)),this.http.authedRequest(de.Get,s)}sendStateEvent(e,n,r){var i=arguments,s=this;return B(function*(){var o=i.length>3&&i[3]!==void 0?i[3]:"",a=i.length>4&&i[4]!==void 0?i[4]:{},c=s.getRoom(e),l=new $i({room_id:e,type:n,state_key:o,content:r});yield s.encryptStateEventIfNeeded(l,c??void 0);var d={$roomId:e,$eventType:l.getWireType(),$stateKey:l.getWireStateKey()},h=xe("/rooms/$roomId/state/$eventType",d);return o!==void 0&&(h=xe(h+"/$stateKey",d)),s.http.authedRequest(de.Put,h,void 0,l.getWireContent(),a)})()}encryptStateEventIfNeeded(e,n){var r=this;return B(function*(){if(r.enableEncryptedStateEvents&&n&&!(!r.cryptoBackend&&r.usingExternalCrypto)){if(!r.cryptoBackend)throw new Error("This room is configured to use encryption, but your client does not support encryption.");(yield r.shouldEncryptEventForRoom(e,n))&&(yield r.cryptoBackend.isStateEncryptionEnabledInRoom(n.roomId))&&(["m.room.create","m.room.member","m.room.join_rules","m.room.power_levels","m.room.third_party_invite","m.room.history_visibility","m.room.guest_access","m.room.encryption"].includes(e.getType())||(yield r.cryptoBackend.encryptEvent(e,n)))}})()}roomInitialSync(e,n){var r,i=xe("/rooms/$roomId/initialSync",{$roomId:e});return this.http.authedRequest(de.Get,i,{limit:(r=n?.toString())!==null&&r!==void 0?r:"30"})}setRoomReadMarkersHttpRequest(e,n,r,i){var s=this;return B(function*(){var o=xe("/rooms/$roomId/read_markers",{$roomId:e}),a={[ls.FullyRead]:n,[ls.Read]:r};return((yield s.doesServerSupportUnstableFeature("org.matrix.msc2285.stable"))||(yield s.isVersionSupported("v1.4")))&&(a[ls.ReadPrivate]=i),s.http.authedRequest(de.Post,o,void 0,a)})()}getJoinedRooms(){var e=xe("/joined_rooms",{});return this.http.authedRequest(de.Get,e)}getJoinedRoomMembers(e){var n=xe("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(de.Get,n)}publicRooms(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{server:n,limit:r,since:i}=e,s=Hve(e,$ye);if(Object.keys(s).length===0){var o={server:n,limit:r,since:i};return this.http.authedRequest(de.Get,"/publicRooms",o)}else{var a={server:n},c=Yr({limit:r,since:i},s);return this.http.authedRequest(de.Post,"/publicRooms",a,c)}}createAlias(e,n){var r=xe("/directory/room/$alias",{$alias:e}),i={room_id:n};return this.http.authedRequest(de.Put,r,void 0,i)}deleteAlias(e){var n=xe("/directory/room/$alias",{$alias:e});return this.http.authedRequest(de.Delete,n)}getLocalAliases(e){var n=xe("/rooms/$roomId/aliases",{$roomId:e}),r=Xr.V3;return this.http.authedRequest(de.Get,n,void 0,void 0,{prefix:r})}getRoomIdForAlias(e){var n=xe("/directory/room/$alias",{$alias:e});return this.http.authedRequest(de.Get,n)}getRoomDirectoryVisibility(e){var n=xe("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(de.Get,n)}setRoomDirectoryVisibility(e,n){var r=xe("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(de.Put,r,void 0,{visibility:n})}searchUserDirectory(e){var{term:n,limit:r}=e,i={search_term:n};return r!==void 0&&(i.limit=r),this.http.authedRequest(de.Post,"/user_directory/search",void 0,i)}uploadContent(e,n){return this.http.uploadContent(e,n)}cancelUpload(e){return this.http.cancelUpload(e)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(e,n){var r=n?xe("/profile/$userId/$info",{$userId:e,$info:n}):xe("/profile/$userId",{$userId:e});return this.http.authedRequest(de.Get,r)}doesServerSupportExtendedProfiles(){var e=this;return B(function*(){return(yield e.doesServerSupportUnstableFeature(yQ))||(yield e.doesServerSupportUnstableFeature(bQ))})()}getExtendedProfileRequestPrefix(){var e=this;return B(function*(){return(yield e.doesServerSupportUnstableFeature("uk.tcpip.msc4133.stable"))?Xr.V3:"/_matrix/client/unstable/uk.tcpip.msc4133"})()}getExtendedProfile(e){var n=this;return B(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");return n.http.authedRequest(de.Get,xe("/profile/$userId",{$userId:e}),void 0,void 0,{prefix:yield n.getExtendedProfileRequestPrefix()})})()}getExtendedProfileProperty(e,n){var r=this;return B(function*(){if(!(yield r.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var i=yield r.http.authedRequest(de.Get,xe("/profile/$userId/$key",{$userId:e,$key:n}),void 0,void 0,{prefix:yield r.getExtendedProfileRequestPrefix()});return i[n]})()}setExtendedProfileProperty(e,n){var r=this;return B(function*(){if(!(yield r.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var i=r.getUserId();yield r.http.authedRequest(de.Put,xe("/profile/$userId/$key",{$userId:i,$key:e}),void 0,{[e]:n},{prefix:yield r.getExtendedProfileRequestPrefix()})})()}deleteExtendedProfileProperty(e){var n=this;return B(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var r=n.getUserId();yield n.http.authedRequest(de.Delete,xe("/profile/$userId/$key",{$userId:r,$key:e}),void 0,void 0,{prefix:yield n.getExtendedProfileRequestPrefix()})})()}patchExtendedProfile(e){var n=this;return B(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var r=n.getUserId();return n.http.authedRequest(de.Patch,xe("/profile/$userId",{$userId:r}),{},e,{prefix:yield n.getExtendedProfileRequestPrefix()})})()}setExtendedProfile(e){var n=this;return B(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var r=n.getUserId();yield n.http.authedRequest(de.Put,xe("/profile/$userId",{$userId:r}),{},e,{prefix:yield n.getExtendedProfileRequestPrefix()})})()}getThreePids(){return this.http.authedRequest(de.Get,"/account/3pid")}addThreePidOnly(e){var n=this;return B(function*(){var r="/account/3pid/add";return n.http.authedRequest(de.Post,r,void 0,e)})()}bindThreePid(e){var n=this;return B(function*(){var r="/account/3pid/bind";return n.http.authedRequest(de.Post,r,void 0,e)})()}unbindThreePid(e,n){var r=this;return B(function*(){var i="/account/3pid/unbind",s={medium:e,address:n,id_server:r.getIdentityServerUrl(!0)};return r.http.authedRequest(de.Post,i,void 0,s)})()}deleteThreePid(e,n){var r="/account/3pid/delete";return this.http.authedRequest(de.Post,r,void 0,{medium:e,address:n})}setPassword(e,n,r){var i="/account/password",s={auth:e,new_password:n,logout_devices:r};return this.http.authedRequest(de.Post,i,void 0,s)}getDevices(){return this.http.authedRequest(de.Get,"/devices")}getDevice(e){var n=xe("/devices/$device_id",{$device_id:e});return this.http.authedRequest(de.Get,n)}setDeviceDetails(e,n){var r=xe("/devices/$device_id",{$device_id:e});return this.http.authedRequest(de.Put,r,void 0,n)}deleteDevice(e,n){var r=xe("/devices/$device_id",{$device_id:e}),i={};return n&&(i.auth=n),this.http.authedRequest(de.Delete,r,void 0,i)}deleteMultipleDevices(e,n){var r={devices:e};n&&(r.auth=n);var i="/delete_devices";return this.http.authedRequest(de.Post,i,void 0,r)}getPushers(){var e=this;return B(function*(){var n=yield e.http.authedRequest(de.Get,"/pushers");return(yield e.doesServerSupportUnstableFeature("org.matrix.msc3881"))||(n.pushers=n.pushers.map(r=>(r.hasOwnProperty(J5.name)||(r[J5.name]=!0),r))),n})()}setPusher(e){var n="/pushers/set";return this.http.authedRequest(de.Post,n,void 0,e)}removePusher(e,n){var r="/pushers/set",i={pushkey:e,app_id:n,kind:null};return this.http.authedRequest(de.Post,r,void 0,i)}setLocalNotificationSettings(e,n){var r="".concat(QX.name,".").concat(e);return this.setAccountData(r,n)}getPushRules(){return this.http.authedRequest(de.Get,"/pushrules/").then(e=>(this.setPushRules(e),this.pushRules))}setPushRules(e){this.pushRules=qa.rewriteDefaultRules(this.logger,e,this.getUserId()),this.pushProcessor.updateCachedPushRuleKeys(this.pushRules)}addPushRule(e,n,r,i){var s=xe("/pushrules/"+e+"/$kind/$ruleId",{$kind:n,$ruleId:r});return this.http.authedRequest(de.Put,s,void 0,i)}deletePushRule(e,n,r){var i=xe("/pushrules/"+e+"/$kind/$ruleId",{$kind:n,$ruleId:r});return this.http.authedRequest(de.Delete,i)}setPushRuleEnabled(e,n,r,i){var s=xe("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:n,$ruleId:r});return this.http.authedRequest(de.Put,s,void 0,{enabled:i})}setPushRuleActions(e,n,r,i){var s=xe("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:n,$ruleId:r});return this.http.authedRequest(de.Put,s,void 0,{actions:i})}search(e,n){var{body:r,next_batch:i}=e,s={};return i&&(s.next_batch=i),this.http.authedRequest(de.Post,"/search",s,r,{abortSignal:n})}uploadKeysRequest(e,n){return this.http.authedRequest(de.Post,"/keys/upload",void 0,e)}uploadKeySignatures(e){return this.http.authedRequest(de.Post,"/keys/signatures/upload",void 0,e)}downloadKeysForUsers(e){var{token:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={device_keys:{}};return n!==void 0&&(r.token=n),e.forEach(i=>{r.device_keys[i]=[]}),this.http.authedRequest(de.Post,"/keys/query",void 0,r)}claimOneTimeKeys(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"signed_curve25519",r=arguments.length>2?arguments[2]:void 0,i={};n===void 0&&(n="signed_curve25519");for(var[s,o]of e){var a=i[s]||{};iC(i,s,a),iC(a,o,n)}var c={one_time_keys:i};r&&(c.timeout=r);var l="/keys/claim";return this.http.authedRequest(de.Post,l,void 0,c)}getKeyChanges(e,n){var r={from:e,to:n};return this.http.authedRequest(de.Get,"/keys/changes",r)}uploadDeviceSigningKeys(e,n){var r=Object.assign({},n);return e&&Object.assign(r,{auth:e}),this.http.authedRequest(de.Post,"/keys/device_signing/upload",void 0,r,{prefix:Xr.Unstable})}registerWithIdentityServer(e){if(!this.idBaseUrl)throw new Error("No identity server base URL set");var n=this.http.getUrl("/account/register",void 0,$l.V2,this.idBaseUrl);return this.http.requestOtherUrl(de.Post,n,e)}requestEmailToken(e,n,r,i,s){var o={client_secret:n,email:e,send_attempt:r?.toString()};return i&&(o.next_link=i),this.http.idServerRequest(de.Post,"/validate/email/requestToken",o,$l.V2,s)}requestMsisdnToken(e,n,r,i,s,o){var a={client_secret:r,country:e,phone_number:n,send_attempt:i?.toString()};return s&&(a.next_link=s),this.http.idServerRequest(de.Post,"/validate/msisdn/requestToken",a,$l.V2,o)}submitMsisdnToken(e,n,r,i){var s={sid:e,client_secret:n,token:r};return this.http.idServerRequest(de.Post,"/validate/msisdn/submitToken",s,$l.V2,i??void 0)}submitMsisdnTokenOtherUrl(e,n,r,i){var s={sid:n,client_secret:r,token:i};return this.http.requestOtherUrl(de.Post,e,s)}getIdentityHashDetails(e){return this.http.idServerRequest(de.Get,"/hash_details",void 0,$l.V2,e)}identityHashedLookup(e,n){var r=this;return B(function*(){var i={},s=yield r.getIdentityHashDetails(n);if(!s||!s.lookup_pepper||!s.algorithms)throw new Error("Unsupported identity server: bad response");i.pepper=s.lookup_pepper;var o={};if(s.algorithms.includes("sha256"))i.addresses=yield Promise.all(e.map(function(){var m=B(function*(g){var y=g[0].toLowerCase(),v=g[1].toLowerCase(),w=yield rQ("".concat(y," ").concat(v," ").concat(i.pepper)),S=Z3(w);return o[S]=g[0],S});return function(g){return m.apply(this,arguments)}}())),i.algorithm="sha256";else if(s.algorithms.includes("none"))i.addresses=e.map(m=>{var g=m[0].toLowerCase(),y=m[1].toLowerCase(),v="".concat(g," ").concat(y);return o[v]=m[0],v}),i.algorithm="none";else throw new Error("Unsupported identity server: unknown hash algorithm");var a=yield r.http.idServerRequest(de.Post,"/lookup",i,$l.V2,n);if(!(a!=null&&a.mappings))return[];var c=[];for(var l of Object.keys(a.mappings)){var d=a.mappings[l],h=o[l];if(!h)throw new Error("Identity server returned more results than expected");c.push({address:h,mxid:d})}return c})()}lookupThreePid(e,n,r){var i=this;return B(function*(){var s=yield i.identityHashedLookup([[n,e]],r),o=s.find(c=>c.address===n);if(!o)return{};var a={address:n,medium:e,mxid:o.mxid};return a})()}bulkLookupThreePids(e,n){var r=this;return B(function*(){var i=yield r.identityHashedLookup(e.map(c=>[c[1],c[0]]),n),s=[],o=function*(l){var d=e.find(h=>h[1]===l.address);if(!d)throw new Error("Identity sever returned unexpected results");s.push([d[0],l.address,l.mxid])};for(var a of i)yield*o(a);return{threepids:s}})()}getIdentityAccount(e){return this.http.idServerRequest(de.Get,"/account",void 0,$l.V2,e)}sendToDevice(e,n,r){var i=xe("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:r||this.makeTxnId()}),s={messages:Mh(n)},o=new Map;for(var[a,c]of n)o.set(a,Array.from(c.keys()));return this.logger.debug("PUT ".concat(i),o),this.http.authedRequest(de.Put,i,void 0,s)}encryptAndSendToDevice(e,n,r){var i=this;return B(function*(){if(!i.cryptoBackend)throw new Error("Cannot encrypt to device event, your client does not support encryption.");var s=yield i.cryptoBackend.encryptToDeviceMessages(e,n,r);yield i.queueToDevice(s)})()}queueToDevice(e){return this.toDeviceMessageQueue.queueBatch(e)}getThirdpartyProtocols(){return this.http.authedRequest(de.Get,"/thirdparty/protocols").then(e=>{if(!e||typeof e!="object")throw new Error("/thirdparty/protocols did not return an object: ".concat(e));return e})}getThirdpartyLocation(e,n){var r=xe("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(de.Get,r,n)}getThirdpartyUser(e,n){var r=xe("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(de.Get,r,n)}getTerms(e,n){var r=this.termsUrlForService(e,n);return this.http.requestOtherUrl(de.Get,r)}agreeToTerms(e,n,r,i){var s=this.termsUrlForService(e,n),o={Authorization:"Bearer "+r};return this.http.requestOtherUrl(de.Post,s,{user_accepts:i},{headers:o})}reportEvent(e,n,r,i){var s=xe("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:n});return this.http.authedRequest(de.Post,s,void 0,{score:r,reason:i})}reportRoom(e,n){var r=xe("/rooms/$roomId/report",{$roomId:e});return this.http.authedRequest(de.Post,r,void 0,{reason:n})}getRoomHierarchy(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0,o=xe("/rooms/$roomId/hierarchy",{$roomId:e}),a={suggested_only:String(i),max_depth:r?.toString(),from:s,limit:n?.toString()};return this.http.authedRequest(de.Get,o,a,void 0,{prefix:Xr.V1}).catch(c=>{if(c.errcode==="M_UNRECOGNIZED")return this.http.authedRequest(de.Get,o,a,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"});throw c})}unstableCreateFileTree(e){var n=this;return B(function*(){var{room_id:r}=yield n.createRoom({name:e,preset:nT.PrivateChat,power_level_content_override:Yr(Yr({},O1e),{},{users:{[n.getUserId()]:100}}),creation_content:{[sC]:wg.Space},initial_state:[{type:z5.name,state_key:Y5.name,content:{[W5.name]:!0}},{type:Z.RoomEncryption,state_key:"",content:{algorithm:"m.megolm.v1.aes-sha2"}}]});return new G$(n,r)})()}unstableGetFileTreeSpace(e){var n,r,i=this.getRoom(e);if(i?.getMyMembership()!==Be.Join)return null;var s=i.currentState.getStateEvents(Z.RoomCreate,""),o=i.currentState.getStateEvents(z5.name,Y5.name);if(!s)throw new Error("Expected single room create event");return!(o!=null&&(n=o.getContent())!==null&&n!==void 0&&n[W5.name])||((r=s.getContent())===null||r===void 0?void 0:r[sC])!==wg.Space?null:new G$(this,e)}slidingSync(e,n,r){var i={};e.pos&&(i.pos=e.pos,delete e.pos),e.timeout&&(i.timeout=e.timeout,delete e.timeout);var s=e.clientTimeout;return delete e.clientTimeout,this.http.authedRequest(de.Post,"/sync",i,e,{prefix:"/_matrix/client/unstable/org.matrix.simplified_msc3575",baseUrl:n,localTimeoutMs:s,abortSignal:r})}supportsThreads(){var e;return((e=this.clientOpts)===null||e===void 0?void 0:e.threadSupport)||!1}supportsIntentionalMentions(){return this.canSupport.get(ti.IntentionalMentions)!==Zr.Unsupported}getRoomSummary(e,n){var r=this;return B(function*(){var i={prefix:"/_matrix/client/unstable/im.nheko.summary"};try{var s=xe("/summary/$roomid",{$roomid:e});return yield r.http.authedRequest(de.Get,s,{via:n},void 0,i)}catch(a){if(a instanceof tr&&a.errcode==="M_UNRECOGNIZED"){var o=xe("/rooms/$roomid/summary",{$roomid:e});return yield r.http.authedRequest(de.Get,o,{via:n},void 0,i)}else throw a}})()}processThreadEvents(e,n,r){e.processThreadedEvents(n,r)}processThreadRoots(e,n,r){this.supportsThreads()&&e.processThreadRoots(n,r)}processBeaconEvents(e,n){this.processAggregatedTimelineEvents(e,n)}processAggregatedTimelineEvents(e,n){n!=null&&n.length&&e&&(e.currentState.processBeaconEvents(n,this),e.processPollEvents(n))}whoami(){var e=this;return B(function*(){return e.http.authedRequest(de.Get,"/account/whoami")})()}timestampToEvent(e,n,r){var i=this;return B(function*(){var s=xe("/rooms/$roomId/timestamp_to_event",{$roomId:e}),o={ts:n.toString(),dir:r};try{return yield i.http.authedRequest(de.Get,s,o,void 0,{prefix:Xr.V1})}catch(a){if(a.errcode==="M_UNRECOGNIZED"&&(a.httpStatus===400||a.httpStatus===404||a.httpStatus===405))return yield i.http.authedRequest(de.Get,s,o,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc3030"});throw a}})()}getAuthMetadata(){var e=this;return B(function*(){var n;try{n=yield e.http.request(de.Get,"/auth_metadata",void 0,void 0,{prefix:Xr.Unstable+"/org.matrix.msc2965"})}catch(i){if(i instanceof tr&&i.errcode==="M_UNRECOGNIZED"){var{issuer:r}=yield e.http.request(de.Get,"/auth_issuer",void 0,void 0,{prefix:Xr.Unstable+"/org.matrix.msc2965"});return a7(r)}throw i}return c7(n)})()}}L(sT,"RESTORE_BACKUP_ERROR_BAD_KEY","RESTORE_BACKUP_ERROR_BAD_KEY");function aB(t){return Object.fromEntries(Object.entries(t).map(e=>{var[n,r]=e;return["".concat(Vc,".").concat(n),r]}))}function _Q(t,e){var n,r=t.getUserId(),i=e.getId(),s=t.getRoom(e.getRoomId());if(!(!s||!r||!i)){if(!s.findEventById(i)){M.info("Decrypted event ".concat(e.getId()," is not in room ").concat(s.roomId,": ignoring"));return}var o=!!e.threadRootId&&!e.isThreadRoot,a;if(o){var c=s.getThread(e.threadRootId);a=c?c.hasUserReadEvent(r,i):!0}else a=s.hasUserReadEvent(r,i);if(!a){var l=t.getPushActionsForEvent(e,!0),d=!!(l!=null&&(n=l.tweaks)!==null&&n!==void 0&&n.highlight);if(d){var h=s.getUnreadCountForEventContext(Jt.Highlight,e)+1;o?s.setThreadUnreadNotificationCount(e.threadRootId,Jt.Highlight,h):s.setUnreadNotificationCount(Jt.Highlight,h)}var m=!!(l!=null&&l.notify);if(m){var g=s.getUnreadCountForEventContext(Jt.Total,e)+1;o?s.setThreadUnreadNotificationCount(e.threadRootId,Jt.Total,g):s.setUnreadNotificationCount(Jt.Total,g)}}}}function ov(t){return mb(t)?u_:t.threadRootId}function mb(t){if(!t.threadRootId||t.isThreadRoot)return!0;if(!t.isRelation())return M.warn("Event is not a relation or a thread root, but still has a threadRootId! id=".concat(t.getId())),!0;if(t.isRelation(wn.name))return!1;var e=t.relationEventId===t.threadRootId;return e}function cB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function lB(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?cB(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):cB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var us=function(t){return t.New="Thread.new",t.Update="Thread.update",t.NewReply="Thread.newReply",t.ViewThread="Thread.viewThread",t.Delete="Thread.delete",t}({}),Zi=function(t){return t[t.None=0]="None",t[t.Experimental=1]="Experimental",t[t.Stable=2]="Stable",t}({});function JE(t,e){return t?Zi.Stable:e?Zi.Experimental:Zi.None}class Un extends CJ{constructor(e,n,r){var i,s;if(super(),i=this,this.id=e,this.rootEvent=n,L(this,"timelineSet",void 0),L(this,"_currentUserParticipated",!1),L(this,"reEmitter",void 0),L(this,"lastEvent",void 0),L(this,"replyCount",0),L(this,"lastPendingEvent",void 0),L(this,"pendingReplyCount",0),L(this,"room",void 0),L(this,"client",void 0),L(this,"pendingEventOrdering",void 0),L(this,"processRootEventPromise",void 0),L(this,"initialEventsFetched",!Un.hasServerSideSupport),L(this,"initalEventFetchProm",void 0),L(this,"replayEvents",[]),L(this,"onTimelineReset",B(function*(){yield i.processRootEventPromise,i.processRootEventPromise=void 0})),L(this,"onBeforeRedaction",(o,a)=>{o!=null&&o.isRelation(wn.name)&&this.room.eventShouldLiveIn(o).threadId===this.id&&o.getId()!==this.id&&!a.status&&(this.replyCount--,this.updatePendingReplyCount(),this.emit(us.Update,this))}),L(this,"onRedaction",function(){var o=B(function*(a,c,l){if(l===i.id)if(i.replyCount<=0){for(var d of i.timeline)i.clearEventMetadata(d);i.lastEvent=i.rootEvent,i._currentUserParticipated=!1,i.emit(us.Delete,i)}else{var h;((h=i.lastEvent)===null||h===void 0?void 0:h.getId())===a.getAssociatedId()&&(yield i.processRootEventPromise,i.processRootEventPromise=void 0),yield i.updateThreadMetadata()}});return function(a,c,l){return o.apply(this,arguments)}}()),L(this,"onTimelineEvent",(o,a,c)=>{if(!c){var l=o.getSender();l&&a&&this.shouldSendLocalEchoReceipt(l,o)&&a.addLocalEchoReceipt(l,o,ls.Read),o.getId()!==this.id&&o.isRelation(wn.name)&&this.replyCount++}this.onEcho(o,c??!1)}),L(this,"onLocalEcho",o=>{this.onEcho(o,!1)}),L(this,"onEcho",function(){var o=B(function*(a,c){a.threadRootId===i.id&&i.lastEvent!==a&&(yield i.updateThreadMetadata(),a.isRelation(wn.name)&&(c||(i.lastEvent=void 0,i.emit(us.NewReply,i,a))))});return function(a,c){return o.apply(this,arguments)}}()),this.setMaxListeners(1e3),!(r!=null&&r.room))throw new Error("element-web#22141: A thread requires a room in order to function");this.room=r.room,this.client=r.client,this.pendingEventOrdering=(s=r.pendingEventOrdering)!==null&&s!==void 0?s:sv.Chronological,this.timelineSet=new ag(this.room,{timelineSupport:!0,pendingEvents:!0},this.client,this),this.reEmitter=new $v(this),this.reEmitter.reEmit(this.timelineSet,[ke.Timeline,ke.TimelineReset]),this.room.on(Kt.BeforeRedaction,this.onBeforeRedaction),this.room.on(ke.Redaction,this.onRedaction),this.room.on(ke.LocalEchoUpdated,this.onLocalEcho),this.room.on(ke.TimelineReset,this.onTimelineReset),this.timelineSet.on(ke.Timeline,this.onTimelineEvent),this.processReceipts(r.receipts),this.updateThreadMetadata(),this.setEventMetadata(this.rootEvent)}fetchRootEvent(){var e=this;return B(function*(){try{var n=yield e.client.fetchRoomEvent(e.roomId,e.id),r=e.client.getEventMapper();e.rootEvent=r(n)}catch(i){M.error("Failed to fetch thread root to construct thread with",i)}yield e.processEvent(e.rootEvent)})()}static setServerSideSupport(e){Un.hasServerSideSupport=e,e!==Zi.Stable&&(Ig.setPreferUnstable(!0),kg.setPreferUnstable(!0),wn.setPreferUnstable(!0))}static setServerSideListSupport(e){Un.hasServerSideListSupport=e}static setServerSideFwdPaginationSupport(e){Un.hasServerSideFwdPaginationSupport=e}shouldSendLocalEchoReceipt(e,n){var r,i=(r=this.client.canSupport.get(ti.RelationsRecursion))!==null&&r!==void 0?r:Zr.Unsupported;if(i===Zr.Unsupported){var s,o=(s=this.getReadReceiptForUserId(e))===null||s===void 0?void 0:s.eventId;if(o){var a=this.findEventById(o);if(a&&a.getTs()>n.getTs())return!1}}return!0}get roomState(){return this.room.getLiveTimeline().getState(Me.FORWARDS)}addEventToTimeline(e,n){this.findEventById(e.getId())||this.timelineSet.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:n,fromCache:!1,roomState:this.roomState,addToState:!1})}insertEventIntoTimeline(e){var n=e.getId();n&&(this.findEventById(n)||this.timelineSet.insertEventIntoTimeline(e,this.liveTimeline,this.roomState,!1))}addEvents(e,n){e.forEach(r=>this.addEvent(r,n,!1)),this.updateThreadMetadata()}addEvent(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this.setEventMetadata(e);var i=this.lastReply(),s=!i||e.localTimestamp>=i.localTimestamp;if(!Un.hasServerSideSupport)this.addEventToTimeline(e,n),this.client.decryptEventIfNeeded(e);else if(e.isRelation(vn.Annotation)||e.isRelation(vn.Replace)){this.addRelatedThreadEvent(e,n);return}else!n&&s?(this.addEventToTimeline(e,!1),this.fetchEditsWhereNeeded(e)):n?this.addEventToTimeline(e,n):this.insertEventIntoTimeline(e);e.getId()!==this.id&&e.isRelation(wn.name)&&!n&&s&&(this.lastEvent=void 0),r&&(this.emit(us.NewReply,this,e),this.updateThreadMetadata())}addRelatedThreadEvent(e,n){if(this.initialEventsFetched){var s,o=(s=this.client.canSupport.get(ti.RelationsRecursion))!==null&&s!==void 0?s:Zr.Unsupported;o===Zr.Unsupported?this.insertEventIntoTimeline(e):this.addEventToTimeline(e,n)}else{var r;if((r=this.replayEvents)===null||r===void 0||r.push(e),e.isRelation(vn.Annotation)){var i;(i=this.timelineSet.relations)===null||i===void 0||i.aggregateChildEvent(e,this.timelineSet)}}}processEvent(e){var n=this;return B(function*(){e&&(n.setEventMetadata(e),yield n.fetchEditsWhereNeeded(e))})()}processReceipts(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];for(var{eventId:n,receiptType:r,userId:i,receipt:s,synthetic:o}of e)this.addReceiptToStructure(n,r,i,s,o)}getRootEventBundledRelationship(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.rootEvent;return e?.getServerAggregatedRelation(wn.name)}processRootEvent(){var e=this;return B(function*(){var n=e.getRootEventBundledRelationship();if(Un.hasServerSideSupport&&n){e.replyCount=n.count,e._currentUserParticipated=!!n.current_user_participated;var r=e.client.getEventMapper();e.lastEvent=r(lB(lB({},n.latest_event),{},{room_id:e.roomId})),e.updatePendingReplyCount(),yield e.processEvent(e.lastEvent)}})()}updatePendingReplyCount(){var e=this.pendingEventOrdering===sv.Detached?this.room.getPendingEvents():this.events,n=e.filter(r=>{var i;return r.threadRootId===this.id&&r.isRelation(wn.name)&&r.status!==null&&r.getId()!==((i=this.lastEvent)===null||i===void 0?void 0:i.getId())});this.lastPendingEvent=n.length?n[n.length-1]:void 0,this.pendingReplyCount=n.length}resetLiveTimeline(e,n){var r=this;return B(function*(){var i=r.liveTimeline;r.timelineSet.resetLiveTimeline(e??void 0,n??void 0);var s=r.liveTimeline,o,a;if(e){var c=yield r.client.createMessagesRequest(r.roomId,e,1,ht.Forward);o=c.end}if(n){var l=yield r.client.createMessagesRequest(r.roomId,n,1,ht.Backward);a=l.start}n&&i.getPaginationToken(ht.Forward)===n&&i.setPaginationToken(a??null,ht.Forward),e&&s.getPaginationToken(ht.Backward)===e&&s.setPaginationToken(o??null,ht.Backward)})()}updateThreadFromRootEvent(){var e=this;return B(function*(){Un.hasServerSideSupport&&(!e.initialEventsFetched&&!e.lastEvent&&(yield e.processRootEvent()),yield e.fetchRootEvent()),yield e.processRootEvent()})()}updateThreadMetadata(){var e=this;return B(function*(){if(e.updatePendingReplyCount(),e.processRootEventPromise||(e.processRootEventPromise=e.updateThreadFromRootEvent()),yield e.processRootEventPromise,!e.initialEventsFetched)if(e.initalEventFetchProm)yield e.initalEventFetchProm;else try{e.timelineSet.resetLiveTimeline(),e.replyCount===0&&e.rootEvent?(e.timelineSet.addEventsToTimeline([e.rootEvent],!0,!1,e.liveTimeline,null),e.liveTimeline.setPaginationToken(null,ht.Backward)):(e.initalEventFetchProm=e.client.paginateEventTimeline(e.liveTimeline,{backwards:!0}),yield e.initalEventFetchProm),e.initialEventsFetched=!0;for(var n of e.replayEvents)e.addEvent(n,!1);e.replayEvents=null,e.emit(ke.TimelineReset,e.room,e.timelineSet,!0)}catch(r){M.error("Failed to load start of newly created thread: ",r),e.initialEventsFetched=!1}e.emit(us.Update,e)})()}fetchEditsWhereNeeded(){var e=arguments,n=this;return B(function*(){var r,i=(r=n.client.canSupport.get(ti.RelationsRecursion))!==null&&r!==void 0?r:Zr.Unsupported;if(i===Zr.Unsupported){for(var s=e.length,o=new Array(s),a=0;a<s;a++)o[a]=e[a];return Promise.all(o.filter(Gye).map(function(){var c=B(function*(l){try{var d=yield n.client.relations(n.roomId,l.getId(),vn.Replace,l.getType(),{limit:1});if(d.events.length){var h=d.events[0];l.makeReplaced(h),n.insertEventIntoTimeline(h)}}catch(m){M.error("Failed to load edits for encrypted thread event",m)}});return function(l){return c.apply(this,arguments)}}()))}})()}setEventMetadata(e){e&&(Me.setEventMetadata(e,this.roomState,!1),e.setThread(this))}clearEventMetadata(e){if(e){var n;e.setThread(void 0),(n=e.event)===null||n===void 0||(n=n.unsigned)===null||n===void 0||(n=n["m.relations"])===null||n===void 0||delete n[wn.name]}}findEventById(e){return this.timelineSet.findEventById(e)}lastReply(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i=>i.isRelation(wn.name),n=this.timeline.length-1;n>=0;n--){var r=this.timeline[n];if(e(r))return r}return null}get roomId(){return this.room.roomId}get length(){return this.replyCount+this.pendingReplyCount}get replyToEvent(){var e,n;return(e=(n=this.lastPendingEvent)!==null&&n!==void 0?n:this.lastEvent)!==null&&e!==void 0?e:this.lastReply()}get timeline(){return this.events}get events(){return this.liveTimeline.getEvents()}has(e){return this.timelineSet.findEventById(e)instanceof $i}get hasCurrentUserParticipated(){return this._currentUserParticipated}get liveTimeline(){return this.timelineSet.getLiveTimeline()}getUnfilteredTimelineSet(){return this.timelineSet}addReceipt(e,n){throw new Error("Unsupported function on the thread model")}getEventReadUpTo(e,n){var r=e===this.client.getUserId(),i=this.timeline[this.timeline.length-1];if(r&&i){var s=i.getTs()<this.room.getOldestThreadedReceiptTs(),o=i.getId();if(s&&o)return o}var a=super.getEventReadUpTo(e,n);if(i){var c=this.room.getLastUnthreadedReceiptFor(e);if(!c)return a;for(var l=((d=this.timeline)===null||d===void 0?void 0:d.length)-1;l>=0;--l){var d,h,m=this.timeline[l];if(m.getId()===a)return a;if(m.getTs()<c.ts)return(h=m.getId())!==null&&h!==void 0?h:a}}return a}hasUserReadEvent(e,n){if(e===this.client.getUserId()){var r,i,s,o,a,c,l=((r=(i=this.lastReply())===null||i===void 0?void 0:i.getTs())!==null&&r!==void 0?r:0)<this.room.getOldestThreadedReceiptTs(),d=(s=(o=this.room.getLastUnthreadedReceiptFor(e))===null||o===void 0?void 0:o.ts)!==null&&s!==void 0?s:0,h=((a=this===null||this===void 0||(c=this.lastReply())===null||c===void 0?void 0:c.getTs())!==null&&a!==void 0?a:0)<d;if(l||h)return!0}return this.room.hasUserReadEvent(e,n)}setUnread(e,n){return this.room.setThreadUnreadNotificationCount(this.id,e,n)}getLastUnthreadedReceiptFor(e){return this.room.getLastUnthreadedReceiptFor(e)}}L(Un,"hasServerSideSupport",Zi.None);L(Un,"hasServerSideListSupport",Zi.None);L(Un,"hasServerSideFwdPaginationSupport",Zi.None);function Gye(t){return t.isEncrypted()&&(t.isRelation(wn.name)||t.isThreadRoot)}var Ig=new K3("related_by_senders","io.element.relation_senders"),kg=new K3("related_by_rel_types","io.element.relation_types"),wn=new K3("m.thread","io.element.thread"),Ba=function(t){return t[t.My=0]="My",t[t.All=1]="All",t}({});function SQ(t){switch(t){case Ba.My:return"participated";default:return"all"}}class uB extends Error{constructor(e,n,r){super(n),this.code=e,L(this,"detailedString",void 0),this.name="DecryptionError",this.detailedString=Kye(this,r)}}function Kye(t,e){var n=t.name+"[msg: "+t.message;return e&&(n+=", "+Object.keys(e).map(r=>r+": "+e[r]).join(", ")),n+="]",n}var dB=Object.freeze({visible:!0}),Kt=function(t){return t.Decrypted="Event.decrypted",t.BeforeRedaction="Event.beforeRedaction",t.VisibilityChange="Event.visibilityChange",t.LocalEventIdReplaced="Event.localEventIdReplaced",t.Status="Event.status",t.Replaced="Event.replaced",t.RelationsCreated="Event.relationsCreated",t.SentinelUpdated="Event.sentinelUpdated",t}({});class $i extends On{setMetadata(e,n){var r,i,s=this.isState()&&this.getType()===Z.RoomMember&&this.getSender()===this.getStateKey(),o=!1;if(s||!((r=this.sender)!==null&&r!==void 0&&(r=r.events)!==null&&r!==void 0&&r.member)){var a=e.getSentinelMember(this.getSender());a!==this.sender&&(o=!0),this.sender=a}if(s||!((i=this.target)!==null&&i!==void 0&&(i=i.events)!==null&&i!==void 0&&i.member)&&this.getType()===Z.RoomMember){var c=e.getSentinelMember(this.getStateKey());c!==this.target&&(o=!0),this.target=c}this.isState()&&n&&(this.forwardLooking=!1),o&&this.emit(Kt.SentinelUpdated)}constructor(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.event=n,L(this,"pushDetails",{}),L(this,"_replacingEvent",null),L(this,"_localRedactionEvent",null),L(this,"_isCancelled",!1),L(this,"clearEvent",void 0),L(this,"visibility",dB),L(this,"_hasCachedExtEv",!1),L(this,"_cachedExtEv",void 0),L(this,"_decryptionFailureReason",null),L(this,"senderCurve25519Key",null),L(this,"claimedEd25519Key",null),L(this,"forwardingCurve25519KeyChain",[]),L(this,"untrusted",null),L(this,"decryptionPromise",null),L(this,"retryDecryption",!1),L(this,"txnId",void 0),L(this,"thread",void 0),L(this,"threadId",void 0),L(this,"localTimestamp",void 0),L(this,"sender",null),L(this,"target",null),L(this,"status",null),L(this,"error",null),L(this,"forwardLooking",!0),L(this,"reEmitter",void 0),["state_key","type","sender","room_id","membership"].forEach(i=>{typeof n[i]=="string"&&(n[i]=Sk(n[i]))}),["membership","avatar_url","displayname"].forEach(i=>{var s;typeof((s=n.content)===null||s===void 0?void 0:s[i])=="string"&&(n.content[i]=Sk(n.content[i]))}),["rel_type"].forEach(i=>{var s;typeof((s=n.content)===null||s===void 0||(s=s["m.relates_to"])===null||s===void 0?void 0:s[i])=="string"&&(n.content["m.relates_to"][i]=Sk(n.content["m.relates_to"][i]))}),this.txnId=n.txn_id;var r=this.getAge();this.localTimestamp=r!==void 0?Date.now()-r:(e=this.getTs())!==null&&e!==void 0?e:Date.now(),this.reEmitter=new $v(this)}get unstableExtensibleEvent(){return this._hasCachedExtEv||(this._cachedExtEv=to.ExtensibleEvents.parse(this.getEffectiveEvent())),this._cachedExtEv}invalidateExtensibleEvent(){this._hasCachedExtEv=!1}getEffectiveEvent(){var e=Object.assign({},this.getContent());if(this.getWireType()===Z.RoomMessageEncrypted)for(var[n,r]of Object.entries(this.getWireContent()))["algorithm","ciphertext","device_id","sender_key","session_id"].includes(n)||e[n]===void 0&&(e[n]=r);return Object.assign({},this.event,this.clearEvent,{content:e})}getId(){return this.event.event_id}getSender(){return this.event.sender}getType(){return this.clearEvent?this.clearEvent.type:this.event.type}getWireType(){return this.event.type}getRoomId(){return this.event.room_id}getTs(){return this.event.origin_server_ts}getDate(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}getDetails(){var e=this.getRoomId();if(e){var n;return"id=".concat(this.getId()," type=").concat(this.getWireType()," sender=").concat(this.getSender()," room=").concat(e," ts=").concat((n=this.getDate())===null||n===void 0?void 0:n.toISOString())}else{var r=this.getContent()[X3];return"msgid=".concat(r," type=").concat(this.getWireType()," sender=").concat(this.getSender())}}getOriginalContent(){var e;if(this._localRedactionEvent)return{};if(this.clearEvent){var n;return(n=this.clearEvent.content)!==null&&n!==void 0?n:{}}return(e=this.event.content)!==null&&e!==void 0?e:{}}getContent(){if(this._localRedactionEvent)return{};if(this._replacingEvent){var e;return(e=this._replacingEvent.getContent()["m.new_content"])!==null&&e!==void 0?e:{}}else return this.getOriginalContent()}getWireContent(){return this.event.content||{}}get threadRootId(){var e;if(!this.isState()){var n=(e=this.getWireContent())===null||e===void 0?void 0:e["m.relates_to"];if(n?.rel_type===wn.name)return n.event_id;if(this.thread)return this.thread.id;if(this.threadId!==void 0)return this.threadId;var r=this.getUnsigned();if(typeof r[oC.name]=="string")return r[oC.name]}}get isThreadRoot(){if(this.isState())return!1;var e=this.getServerAggregatedRelation(wn.name);return!!e||this.threadRootId===this.getId()}get replyEventId(){var e;return(e=this.getWireContent()["m.relates_to"])===null||e===void 0||(e=e["m.in_reply_to"])===null||e===void 0?void 0:e.event_id}get relationEventId(){var e;return(e=this.getWireContent())===null||e===void 0||(e=e["m.relates_to"])===null||e===void 0?void 0:e.event_id}getPrevContent(){return this.getUnsigned().prev_content||{}}getDirectionalContent(){return this.forwardLooking?this.getContent():this.getPrevContent()}getAge(){return this.getUnsigned().age}getLocalAge(){return Date.now()-this.localTimestamp}getStateKey(){return this.clearEvent?this.clearEvent.state_key:this.event.state_key}getWireStateKey(){return this.event.state_key}isState(){return this.event.state_key!==void 0}getMembershipAtEvent(){var e=this.getUnsigned();return ZX.findIn(e)}makeEncrypted(e,n,r,i){this.clearEvent={type:this.event.type,content:this.event.content,state_key:this.event.state_key},this.event.type=e,this.event.content=n,this.senderCurve25519Key=r,this.claimedEd25519Key=i,this.isState()&&(this.event.state_key="".concat(this.clearEvent.type,":").concat(this.clearEvent.state_key))}isBeingDecrypted(){return this.decryptionPromise!=null}getDecryptionPromise(){return this.decryptionPromise}isDecryptionFailure(){return this._decryptionFailureReason!==null}get decryptionFailureReason(){return this._decryptionFailureReason}shouldAttemptDecryption(){return!(this.isRedacted()||this.isBeingDecrypted()||this.clearEvent||!this.isEncrypted())}attemptDecryption(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:{};if(!r.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");var s=r.clearEvent&&!r.isDecryptionFailure(),o=i.forceRedecryptIfUntrusted&&r.isKeySourceUntrusted();if(s&&!o)throw new Error("Attempt to decrypt event which has already been decrypted");return r.decryptionPromise?(M.log("Event ".concat(r.getId()," already being decrypted; queueing a retry")),r.retryDecryption=!0,r.decryptionPromise):(r.decryptionPromise=r.decryptionLoop(e,i),r.decryptionPromise)})()}getKeyRequestRecipients(e){var n=[{userId:e,deviceId:"*"}];return n}decryptionLoop(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:{};for(yield Promise.resolve();;){r.retryDecryption=!1;var s=void 0;try{var o=yield e.decryptEvent(r);i.isRetry===!0&&M.info("Decrypted event on retry (".concat(r.getDetails(),")")),r.setClearData(o),r._decryptionFailureReason=null}catch(c){var a=c instanceof uB?c.detailedString:String(c);if(s=c,r.retryDecryption){M.log("Error decrypting event (".concat(r.getDetails(),"), but retrying: ").concat(a));continue}M.warn("Error decrypting event (".concat(r.getDetails(),"): ").concat(a)),r.setClearDataForDecryptionFailure(String(c)),r._decryptionFailureReason=c instanceof uB?c.code:K1e.UNKNOWN_ERROR}r.decryptionPromise=null,r.retryDecryption=!1,r.setPushDetails(),i.emit!==!1&&r.emit(Kt.Decrypted,r,s);return}})()}setClearData(e){var n,r;this.clearEvent=e.clearEvent,this.senderCurve25519Key=(n=e.senderCurve25519Key)!==null&&n!==void 0?n:null,this.claimedEd25519Key=(r=e.claimedEd25519Key)!==null&&r!==void 0?r:null,this.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this.untrusted=e.untrusted||!1,this.invalidateExtensibleEvent()}setClearDataForDecryptionFailure(e){this.clearEvent={type:Z.RoomMessage,content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: ".concat(e," **")}},this.senderCurve25519Key=null,this.claimedEd25519Key=null,this.forwardingCurve25519KeyChain=[],this.untrusted=!1,this.invalidateExtensibleEvent()}getClearContent(){return this.clearEvent?this.clearEvent.content:null}isEncrypted(){return this.event.type===Z.RoomMessageEncrypted}getSenderKey(){return this.senderCurve25519Key}getKeysClaimed(){return this.claimedEd25519Key?{ed25519:this.claimedEd25519Key}:{}}getClaimedEd25519Key(){return this.claimedEd25519Key}getForwardingCurve25519KeyChain(){return this.forwardingCurve25519KeyChain}isKeySourceUntrusted(){return!!this.untrusted}getUnsigned(){return this.event.unsigned||{}}setUnsigned(e){this.event.unsigned=e}unmarkLocallyRedacted(){var e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=void 0),!!e}markLocallyRedacted(e){this._localRedactionEvent||(this.emit(Kt.BeforeRedaction,this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}applyVisibilityEvent(e){var n,r,i=(n=e?.visible)!==null&&n!==void 0?n:!0,s=(r=e?.reason)!==null&&r!==void 0?r:null,o=!1;(this.visibility.visible!==i||!this.visibility.visible&&this.visibility.reason!==s)&&(o=!0),o&&(i?this.visibility=dB:this.visibility=Object.freeze({visible:!1,reason:s}),this.emit(Kt.VisibilityChange,this,i))}messageVisibility(){return this.visibility}makeRedacted(e,n){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");this._localRedactionEvent=null,this.emit(Kt.BeforeRedaction,this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event;for(var r in this.event)this.event.hasOwnProperty(r)&&!zye.has(r)&&delete this.event[r];this.isEncrypted()&&(this.clearEvent=void 0);var i=this.getType()in fB?fB[this.getType()]:{},s=this.getContent();for(var o in s)s.hasOwnProperty(o)&&!i[o]&&delete s[o];!this.isThreadRoot&&this.threadRootId&&this.threadRootId!==this.getId()&&(this.moveAllRelatedToMainTimeline(n),e.moveToMainTimeline(n)),this.invalidateExtensibleEvent()}moveAllRelatedToMainTimeline(e){var n=this.thread;if(this.moveToMainTimeline(e),n)for(var r of n.events){var i;((i=r.getRelation())===null||i===void 0?void 0:i.event_id)===this.getId()&&r.moveAllRelatedToMainTimeline(e)}}moveToMainTimeline(e){var n;(n=this.thread)===null||n===void 0||n.timelineSet.removeEvent(this.getId()),this.setThread(void 0);var r=e.getLiveTimeline();r.getTimelineSet().insertEventIntoTimeline(this,r,r.getState(Me.FORWARDS),!1)}isRedacted(){return!!this.getUnsigned().redacted_because}isRedaction(){return this.getType()===Z.RoomRedaction}asVisibilityChange(){if(!Dh.matches(this.getType()))return null;var e=this.getRelation();if(!e||e.rel_type!="m.reference")return null;var n=e.event_id;if(!n)return null;var r=this.getWireContent(),i=!!r.visible,s=r.reason;return s&&typeof s!="string"?null:{visible:i,reason:s,eventId:n}}isVisibilityEvent(){return Dh.matches(this.getType())}getRedactionEvent(){var e,n;if(!this.isRedacted())return null;if((e=this.clearEvent)!==null&&e!==void 0&&e.unsigned){var r,i;return(r=(i=this.clearEvent)===null||i===void 0?void 0:i.unsigned.redacted_because)!==null&&r!==void 0?r:null}else return(n=this.event.unsigned)!==null&&n!==void 0&&n.redacted_because?this.event.unsigned.redacted_because:{}}getPushActions(){return this.pushDetails.actions||null}getPushDetails(){return this.pushDetails}setPushDetails(e,n){this.pushDetails={actions:e,rule:n}}handleRemoteEcho(e){var n,r=this.getUnsigned(),i=this.getId();this.event=e,r.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=r.redacted_because),this.setStatus(null),this.getId()!==i&&this.emit(Kt.LocalEventIdReplaced,this),this.localTimestamp=Date.now()-((n=this.getAge())!==null&&n!==void 0?n:0)}isSending(){return!!this.status}setStatus(e){this.status=e,this.emit(Kt.Status,this,e)}replaceLocalEventId(e){this.event.event_id=e,this.emit(Kt.LocalEventIdReplaced,this)}isRelation(e){var n,r=(n=this.getWireContent())===null||n===void 0?void 0:n["m.relates_to"];return this.isState()&&(r!=null&&r.rel_type)&&[vn.Replace,vn.Thread].includes(r.rel_type)?!1:!!(r!=null&&r.rel_type&&r.event_id&&(!e||r.rel_type===e))}getRelation(){var e;return this.isRelation()&&(e=this.getWireContent()["m.relates_to"])!==null&&e!==void 0?e:null}makeReplaced(e){this.isRedacted()&&e||this.isState()||this._replacingEvent!==e&&(this._replacingEvent=e??null,this.emit(Kt.Replaced,this),this.invalidateExtensibleEvent())}getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}getServerAggregatedRelation(e){var n;return(n=this.getUnsigned()["m.relations"])===null||n===void 0?void 0:n[e]}replacingEventId(){var e=this.getServerAggregatedRelation(vn.Replace);if(e)return e.event_id;if(this._replacingEvent)return this._replacingEvent.getId()}replacingEvent(){return this._replacingEvent}replacingEventDate(){var e=this.getServerAggregatedRelation(vn.Replace);if(e){var n=e.origin_server_ts;if(Number.isFinite(n))return new Date(n)}else if(this._replacingEvent){var r;return(r=this._replacingEvent.getDate())!==null&&r!==void 0?r:void 0}}localRedactionEvent(){return this._localRedactionEvent}getAssociatedId(){var e=this.getRelation();if(this.replyEventId)return this.replyEventId;if(e)return e.event_id;if(this.isRedaction())return this.event.redacts}hasAssociation(){return!!this.getAssociatedId()}updateAssociatedId(e){var n=this.getRelation();n?n.event_id=e:this.isRedaction()&&(this.event.redacts=e)}flagCancelled(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._isCancelled=e}isCancelled(){return this._isCancelled}toSnapshot(){var e=new $i(JSON.parse(JSON.stringify(this.event)));for(var[n,r]of Object.entries(this))n!=="event"&&(e[n]=r);return e}isEquivalentTo(e){if(!e)return!1;if(e===this)return!0;var n=H5(this.event),r=H5(e.event);return JSON.stringify(n)===JSON.stringify(r)}toJSON(){var e=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}setTxnId(e){this.txnId=e}getTxnId(){return this.txnId}setThread(e){this.isState()||(this.thread&&this.reEmitter.stopReEmitting(this.thread,[us.Update]),this.thread=e,this.setThreadId(e?.id),e&&this.reEmitter.reEmit(e,[us.Update]))}getThread(){return this.thread}setThreadId(e){this.threadId=e}}var zye=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),fB={[Z.RoomMember]:{membership:1},[Z.RoomJoinRules]:{join_rule:1},[Z.RoomPowerLevels]:{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1}},Wye=["1","2","3","4","5","6","7","8","9","10","11"];function Yye(t){return!Wye.includes(t)}var yo=function(t){return t[t.NotStarted=0]="NotStarted",t[t.InProgress=1]="InProgress",t[t.Finished=2]="Finished",t}(yo||{}),pt=function(t){return t.Events="RoomState.events",t.Members="RoomState.members",t.NewMember="RoomState.newMember",t.Update="RoomState.update",t.BeaconLiveness="RoomState.BeaconLiveness",t.Marker="RoomState.Marker",t}({});class gb extends On{constructor(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{status:yo.NotStarted};super(),this.roomId=e,this.oobMemberFlags=n,L(this,"reEmitter",new $v(this)),L(this,"sentinels",{}),L(this,"displayNameToUserIds",new Map),L(this,"userIdsToDisplayNames",{}),L(this,"tokenToInvite",{}),L(this,"joinedMemberCount",null),L(this,"summaryJoinedMemberCount",null),L(this,"invitedMemberCount",null),L(this,"summaryInvitedMemberCount",null),L(this,"modified",-1),L(this,"members",{}),L(this,"events",new Map),L(this,"paginationToken",null),L(this,"beacons",new Map),L(this,"_liveBeaconIds",[]),L(this,"getVersionWarning",!1),this.updateModifiedTime()}getRoomVersion(){var e,n=this.getStateEvents(Z.RoomCreate,"");return n?(e=n.getContent().room_version)!==null&&e!==void 0?e:"1":(this.getVersionWarning||(M.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1")}getJoinedMemberCount(){return this.summaryJoinedMemberCount!==null?this.summaryJoinedMemberCount:(this.joinedMemberCount===null&&(this.joinedMemberCount=this.getMembers().reduce((e,n)=>n.membership===Be.Join?e+1:e,0)),this.joinedMemberCount)}setJoinedMemberCount(e){this.summaryJoinedMemberCount=e}getInvitedMemberCount(){return this.summaryInvitedMemberCount!==null?this.summaryInvitedMemberCount:(this.invitedMemberCount===null&&(this.invitedMemberCount=this.getMembers().reduce((e,n)=>n.membership===Be.Invite?e+1:e,0)),this.invitedMemberCount)}setInvitedMemberCount(e){this.summaryInvitedMemberCount=e}getMembers(){return Object.values(this.members)}getMembersExcept(e){return this.getMembers().filter(n=>!e.includes(n.userId))}getMember(e){return this.members[e]||null}getSentinelMember(e){if(!e)return null;var n=this.sentinels[e];if(n===void 0){n=new cb(this.roomId,e);var r=this.members[e];r!=null&&r.events.member&&n.setMembershipEvent(r.events.member,this),this.sentinels[e]=n}return n}getStateEvents(e,n){if(!this.events.has(e))return n===void 0?[]:null;if(n===void 0)return Array.from(this.events.get(e).values());var r=this.events.get(e).get(n);return r||null}get hasLiveBeacons(){var e;return!!((e=this.liveBeaconIds)!==null&&e!==void 0&&e.length)}get liveBeaconIds(){return this._liveBeaconIds}clone(){var e=new gb(this.roomId,this.oobMemberFlags),n=this.oobMemberFlags.status;return this.oobMemberFlags.status=yo.NotStarted,Array.from(this.events.values()).forEach(r=>{e.setStateEvents(Array.from(r.values()))}),this.oobMemberFlags.status=n,this.summaryInvitedMemberCount!==null&&e.setInvitedMemberCount(this.getInvitedMemberCount()),this.summaryJoinedMemberCount!==null&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==yo.Finished&&this.getMembers().forEach(r=>{if(r.isOutOfBand()){var i;(i=e.getMember(r.userId))===null||i===void 0||i.markOutOfBand()}}),e}setUnknownStateEvents(e){var n=e.filter(r=>!this.events.has(r.getType())||!this.events.get(r.getType()).has(r.getStateKey()));this.setStateEvents(n)}setStateEvents(e,n){this.updateModifiedTime(),e.forEach(r=>{if(!(r.getRoomId()!==this.roomId||!r.isState())){ZO.matches(r.getType())&&this.setBeacon(r);var i=this.getStateEventMatching(r);if(this.setStateEvent(r),r.getType()===Z.RoomMember){var s;this.updateDisplayNameCache(r.getStateKey(),(s=r.getContent().displayname)!==null&&s!==void 0?s:""),this.updateThirdPartyTokenCache(r)}this.emit(pt.Events,r,this,i)}}),this.onBeaconLivenessChange(),e.forEach(r=>{if(!(r.getRoomId()!==this.roomId||!r.isState()))if(r.getType()===Z.RoomMember){var i=r.getStateKey();(r.getContent().membership===Be.Leave||r.getContent().membership===Be.Ban)&&(r.getContent().avatar_url=r.getContent().avatar_url||r.getPrevContent().avatar_url,r.getContent().displayname=r.getContent().displayname||r.getPrevContent().displayname);var s=this.getOrCreateMember(i,r);s.setMembershipEvent(r,this),this.updateMember(s),this.emit(pt.Members,r,this,s)}else if(r.getType()===Z.RoomPowerLevels){if(r.getStateKey()!=="")return;var o=Object.values(this.members),a=this.getStateEvents(Z.RoomCreate,""),c=hB(this.getRoomVersion(),a);o.forEach(l=>{var d=l.getLastModifiedTime();if(a){var h=pB(l.userId,r,c);l.setPowerLevel(h,r)}d!==l.getLastModifiedTime()&&this.emit(pt.Members,r,this,l)}),this.sentinels={}}else XX.matches(r.getType())&&this.emit(pt.Marker,r,n)}),this.emit(pt.Update,this)}processBeaconEvents(e,n){var r=this;return B(function*(){if(!(!e.length||!r.beacons.size)){var i=[...r.beacons.values()].reduce((l,d)=>(l[d.beaconInfoId]=d,l),{}),s=(l,d)=>{if(pA.matches(d.getType())){var h=i[l];h&&h.addLocations([d])}},o=function*(d){var h,m=(h=d.getRelation())===null||h===void 0?void 0:h.event_id;if(!m||!i[m])return{v:void 0};if(!pA.matches(d.getType())&&!d.isEncrypted())return{v:void 0};try{yield n.decryptEventIfNeeded(d),s(m,d)}catch{d.isDecryptionFailure()&&d.once(Kt.Decrypted,B(function*(){s(m,d)}))}},a;for(var c of e)if(a=yield*o(c),a)return a.v}})()}getOrCreateMember(e,n){var r=this.members[e];return r||(r=new cb(this.roomId,e),this.members[e]=r,this.emit(pt.NewMember,n,this,r)),r}setStateEvent(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}setBeacon(e){var n=cC(e);if(this.beacons.has(n)){var r=this.beacons.get(n);if(e.isRedacted()){var i;r.beaconInfoId===((i=e.getRedactionEvent())===null||i===void 0?void 0:i.redacts)&&(r.destroy(),this.beacons.delete(n));return}return r.update(e)}if(!e.isRedacted()){var s=new EJ(e);this.reEmitter.reEmit(s,[qn.New,qn.Update,qn.Destroy,qn.LivenessChange]),this.emit(qn.New,e,s),s.on(qn.LivenessChange,this.onBeaconLivenessChange.bind(this)),s.on(qn.Destroy,this.onBeaconLivenessChange.bind(this)),this.beacons.set(s.identifier,s)}}onBeaconLivenessChange(){this._liveBeaconIds=Array.from(this.beacons.values()).filter(e=>e.isLive).map(e=>e.identifier),this.emit(pt.BeaconLiveness,this,this.hasLiveBeacons)}getStateEventMatching(e){var n,r;return(n=(r=this.events.get(e.getType()))===null||r===void 0?void 0:r.get(e.getStateKey()))!==null&&n!==void 0?n:null}updateMember(e){var n=this.getStateEvents(Z.RoomCreate,""),r=this.getStateEvents(Z.RoomPowerLevels,"");if(r&&n){var i=pB(e.userId,r,hB(this.getRoomVersion(),n));e.setPowerLevel(i,r)}delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}needsOutOfBandMembers(){return this.oobMemberFlags.status===yo.NotStarted}outOfBandMembersReady(){return this.oobMemberFlags.status===yo.Finished}markOutOfBandMembersStarted(){this.oobMemberFlags.status===yo.NotStarted&&(this.oobMemberFlags.status=yo.InProgress)}markOutOfBandMembersFailed(){this.oobMemberFlags.status===yo.InProgress&&(this.oobMemberFlags.status=yo.NotStarted)}clearOutOfBandMembers(){var e=0;Object.keys(this.members).forEach(n=>{var r=this.members[n];r.isOutOfBand()&&(++e,delete this.members[n])}),M.log("LL: RoomState removed ".concat(e," members...")),this.oobMemberFlags.status=yo.NotStarted}setOutOfBandMembers(e){M.log("LL: RoomState about to set ".concat(e.length," OOB members ...")),this.oobMemberFlags.status===yo.InProgress&&(M.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=yo.Finished,e.forEach(n=>this.setOutOfBandMember(n)),this.emit(pt.Update,this))}setOutOfBandMember(e){if(e.getType()===Z.RoomMember){var n=e.getStateKey(),r=this.getMember(n);if(!(r&&!r.isOutOfBand())){var i=this.getOrCreateMember(n,e);i.setMembershipEvent(e,this),i.markOutOfBand(),this.updateDisplayNameCache(i.userId,i.name),this.setStateEvent(e),this.updateMember(i),this.emit(pt.Members,e,this,i)}}}setTypingEvent(e){Object.values(this.members).forEach(function(n){n.setTypingEvent(e)})}getInviteForThreePidToken(e){return this.tokenToInvite[e]||null}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getUserIdsWithDisplayName(e){var n;return(n=this.displayNameToUserIds.get(Qd(e)))!==null&&n!==void 0?n:[]}maySendRedactionForEvent(e,n){var r=this.getMember(n);if(!r||r.membership===Be.Leave||e.status||e.isRedacted())return!1;var i=this.maySendEvent(Z.RoomRedaction,n);return i?e.getSender()===n?!0:this.hasSufficientPowerLevelFor("redact",r.powerLevel):!1}hasSufficientPowerLevelFor(e,n){var r=this.getStateEvents(Z.RoomPowerLevels,""),i={};r&&(i=r.getContent());var s=50;return AF(i[e])&&(s=i[e]),n>=s}maySendMessage(e){return this.maySendEventOfType(Z.RoomMessage,e,!1)}maySendEvent(e,n){return this.maySendEventOfType(e,n,!1)}mayClientSendStateEvent(e,n){return n.isGuest()||!n.credentials.userId?!1:this.maySendStateEvent(e,n.credentials.userId)}maySendStateEvent(e,n){return this.maySendEventOfType(e,n,!0)}maySendEventOfType(e,n,r){var i,s=this.getStateEvents(Z.RoomPowerLevels,""),o,a={},c=0,l=0;s&&(o=s.getContent(),a=o.events||{},Number.isSafeInteger(o.state_default)?c=o.state_default:c=50,Number.isSafeInteger(o.events_default)&&(l=o.events_default));var d=r?c:l;Number.isSafeInteger(a[e])&&(d=a[e]);var h=this.getMember(n),m=(i=h?.powerLevel)!==null&&i!==void 0?i:0;return m>=d}mayTriggerNotifOfType(e,n){var r=this.getMember(n);if(!r)return!1;var i=this.getStateEvents(Z.RoomPowerLevels,""),s=50;return i&&i.getContent()&&i.getContent().notifications&&AF(i.getContent().notifications[e])&&(s=i.getContent().notifications[e]),r.powerLevel>=s}getJoinRule(){var e,n=this.getStateEvents(Z.RoomJoinRules,""),r=(e=n?.getContent())!==null&&e!==void 0?e:{};return r.join_rule||ef.Invite}getHistoryVisibility(){var e,n=this.getStateEvents(Z.RoomHistoryVisibility,""),r=(e=n?.getContent())!==null&&e!==void 0?e:{};return r.history_visibility||QO.Shared}getGuestAccess(){var e,n=this.getStateEvents(Z.RoomGuestAccess,""),r=(e=n?.getContent())!==null&&e!==void 0?e:{};return r.guest_access||dC.Forbidden}findPredecessor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(e){var n=this.getStateEvents(Z.RoomPredecessor,"");if(n){var r=n.getContent(),i=r.predecessor_room_id,s=r.last_known_event_id;typeof s!="string"&&(s=void 0);var o=r.via_servers;if(Array.isArray(o)||(o=void 0),typeof i=="string")return{roomId:i,eventId:s,viaServers:o}}}var a=this.getStateEvents(Z.RoomCreate,"");if(a){var c=a.getContent().predecessor;if(c){var l=c.room_id;if(typeof l=="string"){var d=c.event_id;return(typeof d!="string"||d==="")&&(d=void 0),{roomId:l,eventId:d}}}}return null}updateThirdPartyTokenCache(e){if(e.getContent().third_party_invite){var n=(e.getContent().third_party_invite.signed||{}).token;if(n){var r=this.getStateEvents(Z.RoomThirdPartyInvite,n);r&&(this.tokenToInvite[n]=e)}}}updateDisplayNameCache(e,n){var r=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],r){var i=Qd(r),s=this.displayNameToUserIds.get(i);if(s){var o=s.filter(d=>d!==e);this.displayNameToUserIds.set(i,o)}}this.userIdsToDisplayNames[e]=n;var a=n&&Qd(n);if(a){var c,l=(c=this.displayNameToUserIds.get(a))!==null&&c!==void 0?c:[];l.push(e),this.displayNameToUserIds.set(a,l)}}}function hB(t,e){var n=new Set;if(Yye(t)&&e){var r=e.getSender();r&&n.add(r);var i=e.getDirectionalContent().additional_creators;Array.isArray(i)&&i.forEach(s=>n.add(s))}return n}function pB(t,e,n){if(n.has(t))return 1/0;var r=e.getDirectionalContent(),i=r.users||{};return i[t]!==void 0&&Number.isInteger(i[t])?i[t]:r.users_default!==void 0?r.users_default:0}function mB(t){var e=typeof t=="string"&&!!t&&t!=="undefined"&&t!=="null";return e||typeof t=="number"}class vb{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};L(this,"rooms",{}),L(this,"users",{}),L(this,"syncToken",null),L(this,"filters",new vu(()=>new Map)),L(this,"accountData",new Map),L(this,"localStorage",void 0),L(this,"oobMembers",new Map),L(this,"pendingEvents",{}),L(this,"clientOptions",void 0),L(this,"pendingToDeviceBatches",[]),L(this,"nextToDeviceBatchId",0),L(this,"createUser",void 0),L(this,"onRoomMember",(n,r,i)=>{var s;if(i.membership!==Be.Invite){var o=this.users[i.userId]||((s=this.createUser)===null||s===void 0?void 0:s.call(this,i.userId));i.name&&(o.setDisplayName(i.name),i.events.member&&o.setRawDisplayName(i.events.member.getDirectionalContent().displayname)),i.events.member&&i.events.member.getContent().avatar_url&&o.setAvatarUrl(i.events.member.getContent().avatar_url),this.users[o.userId]=o}}),this.localStorage=e.localStorage}getSyncToken(){return this.syncToken}isNewlyCreated(){return Promise.resolve(!0)}setSyncToken(e){this.syncToken=e}storeRoom(e){this.rooms[e.roomId]=e,e.currentState.on(pt.Members,this.onRoomMember),e.currentState.getMembers().forEach(n=>{this.onRoomMember(null,e.currentState,n)})}setUserCreator(e){this.createUser=e}getRoom(e){return this.rooms[e]||null}getRooms(){return Object.values(this.rooms)}removeRoom(e){this.rooms[e]&&this.rooms[e].currentState.removeListener(pt.Members,this.onRoomMember),delete this.rooms[e]}getRoomSummaries(){return Object.values(this.rooms).map(function(e){return e.summary})}storeUser(e){this.users[e.userId]=e}getUser(e){return this.users[e]||null}getUsers(){return Object.values(this.users)}scrollback(e,n){return[]}storeEvents(e,n,r,i){}storeFilter(e){!(e!=null&&e.userId)||!(e!=null&&e.filterId)||this.filters.getOrCreate(e.userId).set(e.filterId,e)}getFilter(e,n){var r;return((r=this.filters.get(e))===null||r===void 0?void 0:r.get(n))||null}getFilterIdByName(e){if(!this.localStorage)return null;var n="mxjssdk_memory_filter_"+e;try{var r=this.localStorage.getItem(n);if(mB(r))return r}catch{}return null}setFilterIdByName(e,n){if(this.localStorage){var r="mxjssdk_memory_filter_"+e;try{mB(n)?this.localStorage.setItem(r,n):this.localStorage.removeItem(r)}catch{}}}storeAccountDataEvents(e){e.forEach(n=>{var r=!Object.keys(n.getContent()).length;r?this.accountData.delete(n.getType()):this.accountData.set(n.getType(),n)})}getAccountData(e){return this.accountData.get(e)}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(e){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return this.rooms={},this.users={},this.syncToken=null,this.filters=new vu(()=>new Map),this.accountData=new Map,Promise.resolve()}getOutOfBandMembers(e){return Promise.resolve(this.oobMembers.get(e)||null)}setOutOfBandMembers(e,n){return this.oobMembers.set(e,n),Promise.resolve()}clearOutOfBandMembers(e){return this.oobMembers.delete(e),Promise.resolve()}getClientOptions(){return Promise.resolve(this.clientOptions)}storeClientOptions(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}getPendingEvents(e){var n=this;return B(function*(){var r;return(r=n.pendingEvents[e])!==null&&r!==void 0?r:[]})()}setPendingEvents(e,n){var r=this;return B(function*(){r.pendingEvents[e]=n})()}saveToDeviceBatches(e){for(var n of e)this.pendingToDeviceBatches.push({id:this.nextToDeviceBatchId++,eventType:n.eventType,txnId:n.txnId,batch:n.batch});return Promise.resolve()}getOldestToDeviceBatch(){var e=this;return B(function*(){return e.pendingToDeviceBatches.length===0?null:e.pendingToDeviceBatches[0]})()}removeToDeviceBatch(e){return this.pendingToDeviceBatches=this.pendingToDeviceBatches.filter(n=>n.id!==e),Promise.resolve()}destroy(){return B(function*(){})()}}var EQ=(t=>(t.ToWidget="toWidget",t.FromWidget="fromWidget",t))(EQ||{});function Xye(t){if(t==="toWidget")return"fromWidget";if(t==="fromWidget")return"toWidget";throw new Error("Invalid direction")}var Kl=(t=>(t.MSC2762="org.matrix.msc2762",t.MSC2762_UPDATE_STATE="org.matrix.msc2762_update_state",t.MSC2871="org.matrix.msc2871",t.MSC2873="org.matrix.msc2873",t.MSC2931="org.matrix.msc2931",t.MSC2974="org.matrix.msc2974",t.MSC2876="org.matrix.msc2876",t.MSC3819="org.matrix.msc3819",t.MSC3846="town.robin.msc3846",t.MSC3869="org.matrix.msc3869",t.MSC3973="org.matrix.msc3973",t.MSC4039="org.matrix.msc4039",t))(Kl||{});const Jye=["0.0.1","0.0.2","org.matrix.msc2762","org.matrix.msc2762_update_state","org.matrix.msc2871","org.matrix.msc2873","org.matrix.msc2931","org.matrix.msc2974","org.matrix.msc2876","org.matrix.msc3819","town.robin.msc3846","org.matrix.msc3869","org.matrix.msc3973","org.matrix.msc4039"];class Qye extends Y3.EventEmitter{constructor(e,n,r,i){super(),this.sendDirection=e,this.initialWidgetId=n,this.transportWindow=r,this.inboundWindow=i,this.strictOriginCheck=!1,this.targetOrigin="*",this.timeoutSeconds=10,this._ready=!1,this._widgetId=null,this.outboundRequests=new Map,this.stopController=new AbortController,this._widgetId=n}get ready(){return this._ready}get widgetId(){return this._widgetId||null}get nextRequestId(){const e=`widgetapi-${Date.now()}`;let n=0,r=e;for(;this.outboundRequests.has(r);)r=`${e}-${n++}`;return this.outboundRequests.set(r,null),r}sendInternal(e){console.log(`[PostmessageTransport] Sending object to ${this.targetOrigin}: `,e),this.transportWindow.postMessage(e,this.targetOrigin)}reply(e,n){return this.sendInternal({...e,response:n})}send(e,n){return this.sendComplete(e,n).then(r=>r.response)}sendComplete(e,n){if(!this.ready||!this.widgetId)return Promise.reject(new Error("Not ready or unknown widget ID"));const r={api:this.sendDirection,widgetId:this.widgetId,requestId:this.nextRequestId,action:e,data:n};return e===vr.UpdateVisibility&&(r.visible=n.visible),new Promise((i,s)=>{const o=h=>{d(),i(h)},a=h=>{d(),s(h)},c=setTimeout(()=>a(new Error("Request timed out")),(this.timeoutSeconds||1)*1e3),l=()=>a(new Error("Transport stopped"));this.stopController.signal.addEventListener("abort",l);const d=()=>{this.outboundRequests.delete(r.requestId),clearTimeout(c),this.stopController.signal.removeEventListener("abort",l)};this.outboundRequests.set(r.requestId,{request:r,resolve:o,reject:a}),this.sendInternal(r)})}start(){this.inboundWindow.addEventListener("message",e=>{this.handleMessage(e)}),this._ready=!0}stop(){this._ready=!1,this.stopController.abort()}handleMessage(e){if(this.stopController.signal.aborted||!e.data||this.strictOriginCheck&&e.origin!==window.origin)return;const n=e.data;if(!(!n.action||!n.requestId||!n.widgetId))if(n.response){if(n.api!==this.sendDirection)return;this.handleResponse(n)}else{const r=n;if(r.api!==Xye(this.sendDirection))return;this.handleRequest(r)}}handleRequest(e){if(this.widgetId){if(this.widgetId!==e.widgetId)return}else this._widgetId=e.widgetId;this.emit("message",new CustomEvent("message",{detail:e}))}handleResponse(e){if(e.widgetId!==this.widgetId)return;const n=this.outboundRequests.get(e.requestId);if(n)if(ebe(e.response)){const{message:r,...i}=e.response.error;n.reject(new yC(r,i))}else n.resolve(e)}}var vr=(t=>(t.SupportedApiVersions="supported_api_versions",t.Capabilities="capabilities",t.NotifyCapabilities="notify_capabilities",t.ThemeChange="theme_change",t.LanguageChange="language_change",t.TakeScreenshot="screenshot",t.UpdateVisibility="visibility",t.OpenIDCredentials="openid_credentials",t.WidgetConfig="widget_config",t.CloseModalWidget="close_modal",t.ButtonClicked="button_clicked",t.SendEvent="send_event",t.SendToDevice="send_to_device",t.UpdateState="update_state",t.UpdateTurnServers="update_turn_servers",t))(vr||{}),Qn=(t=>(t.SupportedApiVersions="supported_api_versions",t.ContentLoaded="content_loaded",t.SendSticker="m.sticker",t.UpdateAlwaysOnScreen="set_always_on_screen",t.GetOpenIDCredentials="get_openid",t.CloseModalWidget="close_modal",t.OpenModalWidget="open_modal",t.SetModalButtonEnabled="set_button_enabled",t.SendEvent="send_event",t.SendToDevice="send_to_device",t.WatchTurnServers="watch_turn_servers",t.UnwatchTurnServers="unwatch_turn_servers",t.BeeperReadRoomAccountData="com.beeper.read_room_account_data",t.MSC2876ReadEvents="org.matrix.msc2876.read_events",t.MSC2931Navigate="org.matrix.msc2931.navigate",t.MSC2974RenegotiateCapabilities="org.matrix.msc2974.request_capabilities",t.MSC3869ReadRelations="org.matrix.msc3869.read_relations",t.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",t.MSC4039GetMediaConfigAction="org.matrix.msc4039.get_media_config",t.MSC4039UploadFileAction="org.matrix.msc4039.upload_file",t.MSC4039DownloadFileAction="org.matrix.msc4039.download_file",t.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",t))(Qn||{}),eg=(t=>(t.Allowed="allowed",t.Blocked="blocked",t.PendingUserConfirmation="request",t))(eg||{}),wQ=(t=>(t.Custom="m.custom",t.JitsiMeet="m.jitsi",t.Stickerpicker="m.stickerpicker",t))(wQ||{}),CQ=(t=>(t.Close="m.close",t))(CQ||{}),Dc=(t=>(t.Send="send",t.Receive="receive",t))(Dc||{});class Ji{constructor(e,n,r,i,s){this.direction=e,this.eventType=n,this.kind=r,this.keyStr=i,this.raw=s}matchesAsStateEvent(e,n,r){return this.kind!=="state_event"||this.direction!==e||this.eventType!==n?!1:this.keyStr===null||this.keyStr===r}matchesAsToDeviceEvent(e,n){return!(this.kind!=="to_device"||this.direction!==e||this.eventType!==n)}matchesAsRoomEvent(e,n,r=null){if(this.kind!=="event"||this.direction!==e||this.eventType!==n)return!1;if(this.eventType==="m.room.message"){if(this.keyStr===null||this.keyStr===r)return!0}else return!0;return!1}matchesAsRoomAccountData(e,n){return!(this.kind!=="room_account"||this.direction!==e||this.eventType!==n)}static forStateEvent(e,n,r){n=n.replace(/#/g,"\\#"),r=r!=null?`#${r}`:"";const i=`org.matrix.msc2762.${e}.state_event:${n}${r}`;return Ji.findEventCapabilities([i])[0]}static forToDeviceEvent(e,n){const r=`org.matrix.msc3819.${e}.to_device:${n}`;return Ji.findEventCapabilities([r])[0]}static forRoomEvent(e,n){const r=`org.matrix.msc2762.${e}.event:${n}`;return Ji.findEventCapabilities([r])[0]}static forRoomMessageEvent(e,n){n=n??"";const r=`org.matrix.msc2762.${e}.event:m.room.message#${n}`;return Ji.findEventCapabilities([r])[0]}static forRoomAccountData(e,n){const r=`com.beeper.capabilities.${e}.room_account_data:${n}`;return Ji.findEventCapabilities([r])[0]}static findEventCapabilities(e){const n=[];for(const r of e){let i=null,s,o=null;if(r.startsWith("org.matrix.msc2762.send.event:")?(i="send",o="event",s=r.substring(30)):r.startsWith("org.matrix.msc2762.send.state_event:")?(i="send",o="state_event",s=r.substring(36)):r.startsWith("org.matrix.msc3819.send.to_device:")?(i="send",o="to_device",s=r.substring(34)):r.startsWith("org.matrix.msc2762.receive.event:")?(i="receive",o="event",s=r.substring(33)):r.startsWith("org.matrix.msc2762.receive.state_event:")?(i="receive",o="state_event",s=r.substring(39)):r.startsWith("org.matrix.msc3819.receive.to_device:")?(i="receive",o="to_device",s=r.substring(37)):r.startsWith("com.beeper.capabilities.receive.room_account_data:")&&(i="receive",o="room_account",s=r.substring(50)),i===null||o===null||s===void 0)continue;const a=s.startsWith("m.room.message#")||o==="state_event";let c=null;if(s.includes("#")&&a){const l=s.split("#"),d=l.findIndex(h=>!h.endsWith("\\"));s=l.slice(0,d+1).map(h=>h.endsWith("\\")?h.substring(0,h.length-1):h).join("#"),c=l.slice(d+1).join("#")}n.push(new Ji(i,s,o,c,r))}return n}}var kh=(t=>(t.AnyRoom="*",t))(kh||{});const G3=class G3 extends Error{constructor(e,n){super(e),this.data=n}};G3.prototype.name=G3.name;let yC=G3;class Zye extends Y3.EventEmitter{constructor(e=null,n=null){if(super(),this.clientOrigin=n,this.capabilitiesFinished=!1,this.supportsMSC2974Renegotiate=!1,this.requestedCapabilities=[],this.turnServerWatchers=0,!window.parent)throw new Error("No parent window. This widget doesn't appear to be embedded properly.");this.transport=new Qye(EQ.FromWidget,e,window.parent,window),this.transport.targetOrigin=n,this.transport.on("message",this.handleMessage.bind(this))}hasCapability(e){return Array.isArray(this.approvedCapabilities)?this.approvedCapabilities.includes(e):this.requestedCapabilities.includes(e)}requestCapability(e){if(this.capabilitiesFinished&&!this.supportsMSC2974Renegotiate)throw new Error("Capabilities have already been negotiated");this.requestedCapabilities.push(e)}requestCapabilities(e){e.forEach(n=>this.requestCapability(n))}requestCapabilityForRoomTimeline(e){this.requestCapability(`org.matrix.msc2762.timeline:${e}`)}requestCapabilityToSendState(e,n){this.requestCapability(Ji.forStateEvent(Dc.Send,e,n).raw)}requestCapabilityToReceiveState(e,n){this.requestCapability(Ji.forStateEvent(Dc.Receive,e,n).raw)}requestCapabilityToSendToDevice(e){this.requestCapability(Ji.forToDeviceEvent(Dc.Send,e).raw)}requestCapabilityToReceiveToDevice(e){this.requestCapability(Ji.forToDeviceEvent(Dc.Receive,e).raw)}requestCapabilityToSendEvent(e){this.requestCapability(Ji.forRoomEvent(Dc.Send,e).raw)}requestCapabilityToReceiveEvent(e){this.requestCapability(Ji.forRoomEvent(Dc.Receive,e).raw)}requestCapabilityToSendMessage(e){this.requestCapability(Ji.forRoomMessageEvent(Dc.Send,e).raw)}requestCapabilityToReceiveMessage(e){this.requestCapability(Ji.forRoomMessageEvent(Dc.Receive,e).raw)}requestCapabilityToReceiveRoomAccountData(e){this.requestCapability(Ji.forRoomAccountData(Dc.Receive,e).raw)}requestOpenIDConnectToken(){return new Promise((e,n)=>{this.transport.sendComplete(Qn.GetOpenIDCredentials,{}).then(r=>{const i=r.response;if(i.state===eg.Allowed)e(i);else if(i.state===eg.Blocked)n(new Error("User declined to verify their identity"));else if(i.state===eg.PendingUserConfirmation){const s=o=>{o.preventDefault();const a=o.detail;a.data.original_request_id===r.requestId&&(a.data.state===eg.Allowed?(e(a.data),this.transport.reply(a,{})):a.data.state===eg.Blocked?(n(new Error("User declined to verify their identity")),this.transport.reply(a,{})):(n(new Error("Invalid state on reply: "+i.state)),this.transport.reply(a,{error:{message:"Invalid state"}})),this.off(`action:${vr.OpenIDCredentials}`,s))};this.on(`action:${vr.OpenIDCredentials}`,s)}else n(new Error("Invalid state: "+i.state))}).catch(n)})}updateRequestedCapabilities(){return this.transport.send(Qn.MSC2974RenegotiateCapabilities,{capabilities:this.requestedCapabilities}).then()}sendContentLoaded(){return this.transport.send(Qn.ContentLoaded,{}).then()}sendSticker(e){return this.transport.send(Qn.SendSticker,e).then()}setAlwaysOnScreen(e){return this.transport.send(Qn.UpdateAlwaysOnScreen,{value:e}).then(n=>n.success)}openModalWidget(e,n,r=[],i={},s=wQ.Custom){return this.transport.send(Qn.OpenModalWidget,{type:s,url:e,name:n,buttons:r,data:i}).then()}closeModalWidget(e={}){return this.transport.send(Qn.CloseModalWidget,e).then()}sendRoomEvent(e,n,r,i,s){return this.sendEvent(e,void 0,n,r,i,s)}sendStateEvent(e,n,r,i,s,o){return this.sendEvent(e,n,r,i,s,o)}sendEvent(e,n,r,i,s,o){return this.transport.send(Qn.SendEvent,{type:e,content:r,...n!==void 0&&{state_key:n},...i!==void 0&&{room_id:i},...s!==void 0&&{delay:s},...o!==void 0&&{parent_delay_id:o}})}updateDelayedEvent(e,n){return this.transport.send(Qn.MSC4157UpdateDelayedEvent,{delay_id:e,action:n})}sendToDevice(e,n,r){return this.transport.send(Qn.SendToDevice,{type:e,encrypted:n,messages:r})}readRoomAccountData(e,n){const r={type:e};return n&&(n.includes(kh.AnyRoom)?r.room_ids=kh.AnyRoom:r.room_ids=n),this.transport.send(Qn.BeeperReadRoomAccountData,r).then(i=>i.events)}readRoomEvents(e,n,r,i,s){const o={type:e,msgtype:r};return n!==void 0&&(o.limit=n),i&&(i.includes(kh.AnyRoom)?o.room_ids=kh.AnyRoom:o.room_ids=i),s&&(o.since=s),this.transport.send(Qn.MSC2876ReadEvents,o).then(a=>a.events)}async readEventRelations(e,n,r,i,s,o,a,c){if(!(await this.getClientVersions()).includes(Kl.MSC3869))throw new Error("The read_relations action is not supported by the client.");const d={event_id:e,rel_type:r,event_type:i,room_id:n,to:a,from:o,limit:s,direction:c};return this.transport.send(Qn.MSC3869ReadRelations,d)}readStateEvents(e,n,r,i){const s={type:e,state_key:r===void 0?!0:r};return n!==void 0&&(s.limit=n),i&&(i.includes(kh.AnyRoom)?s.room_ids=kh.AnyRoom:s.room_ids=i),this.transport.send(Qn.MSC2876ReadEvents,s).then(o=>o.events)}setModalButtonEnabled(e,n){if(e===CQ.Close)throw new Error("The close button cannot be disabled");return this.transport.send(Qn.SetModalButtonEnabled,{button:e,enabled:n}).then()}navigateTo(e){if(!e||!e.startsWith("https://matrix.to/#"))throw new Error("Invalid matrix.to URI");return this.transport.send(Qn.MSC2931Navigate,{uri:e}).then()}async*getTurnServers(){let e;const n=async r=>{r.preventDefault(),e(r.detail.data),await this.transport.reply(r.detail,{})};if(this.on(`action:${vr.UpdateTurnServers}`,n),this.turnServerWatchers===0)try{await this.transport.send(Qn.WatchTurnServers,{})}catch(r){throw this.off(`action:${vr.UpdateTurnServers}`,n),r}this.turnServerWatchers++;try{for(;;)yield await new Promise(r=>e=r)}finally{this.off(`action:${vr.UpdateTurnServers}`,n),this.turnServerWatchers--,this.turnServerWatchers===0&&await this.transport.send(Qn.UnwatchTurnServers,{})}}async searchUserDirectory(e,n){if(!(await this.getClientVersions()).includes(Kl.MSC3973))throw new Error("The user_directory_search action is not supported by the client.");const i={search_term:e,limit:n};return this.transport.send(Qn.MSC3973UserDirectorySearch,i)}async getMediaConfig(){if(!(await this.getClientVersions()).includes(Kl.MSC4039))throw new Error("The get_media_config action is not supported by the client.");const n={};return this.transport.send(Qn.MSC4039GetMediaConfigAction,n)}async uploadFile(e){if(!(await this.getClientVersions()).includes(Kl.MSC4039))throw new Error("The upload_file action is not supported by the client.");const r={file:e};return this.transport.send(Qn.MSC4039UploadFileAction,r)}async downloadFile(e){if(!(await this.getClientVersions()).includes(Kl.MSC4039))throw new Error("The download_file action is not supported by the client.");const r={content_uri:e};return this.transport.send(Qn.MSC4039DownloadFileAction,r)}start(){this.transport.start(),this.getClientVersions().then(e=>{e.includes(Kl.MSC2974)&&(this.supportsMSC2974Renegotiate=!0)})}handleMessage(e){const n=new CustomEvent(`action:${e.detail.action}`,{detail:e.detail,cancelable:!0});if(this.emit(`action:${e.detail.action}`,n),!n.defaultPrevented)switch(e.detail.action){case vr.SupportedApiVersions:return this.replyVersions(e.detail);case vr.Capabilities:return this.handleCapabilities(e.detail);case vr.UpdateVisibility:return this.transport.reply(e.detail,{});case vr.NotifyCapabilities:return this.transport.reply(e.detail,{});default:return this.transport.reply(e.detail,{error:{message:"Unknown or unsupported action: "+e.detail.action}})}}replyVersions(e){this.transport.reply(e,{supported_versions:Jye})}getClientVersions(){return Array.isArray(this.cachedClientVersions)?Promise.resolve(this.cachedClientVersions):this.transport.send(Qn.SupportedApiVersions,{}).then(e=>(this.cachedClientVersions=e.supported_versions,e.supported_versions)).catch(e=>(console.warn("non-fatal error getting supported client versions: ",e),[]))}handleCapabilities(e){return this.capabilitiesFinished?this.transport.reply(e,{error:{message:"Capability negotiation already completed"}}):this.getClientVersions().then(n=>(n.includes(Kl.MSC2871)?this.once(`action:${vr.NotifyCapabilities}`,r=>{this.approvedCapabilities=r.detail.data.approved,this.emit("ready")}):this.emit("ready"),this.capabilitiesFinished=!0,this.transport.reply(e,{capabilities:this.requestedCapabilities})))}}var xy=(t=>(t.Screenshots="m.capability.screenshot",t.StickerSending="m.sticker",t.AlwaysOnScreen="m.always_on_screen",t.RequiresClient="io.element.requires_client",t.MSC2931Navigate="org.matrix.msc2931.navigate",t.MSC3846TurnServers="town.robin.msc3846.turn_servers",t.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",t.MSC4039UploadFile="org.matrix.msc4039.upload_file",t.MSC4039DownloadFile="org.matrix.msc4039.download_file",t.MSC4157SendDelayedEvent="org.matrix.msc4157.send.delayed_event",t.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",t))(xy||{});function ebe(t){const e=t.error;return typeof e=="object"&&e!==null&&"message"in e&&typeof e.message=="string"}function gB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function L2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?gB(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function tbe(t){var e,n,r,i=2;for(typeof Symbol<"u"&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&(e=t[n])!=null)return e.call(t);if(r&&(e=t[r])!=null)return new QE(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function QE(t){function e(n){if(Object(n)!==n)return Promise.reject(new TypeError(n+" is not an object."));var r=n.done;return Promise.resolve(n.value).then(function(i){return{value:i,done:r}})}return QE=function(r){this.s=r,this.n=r.next},QE.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(r){var i=this.s.return;return i===void 0?Promise.resolve({value:r,done:!0}):e(i.apply(this.s,arguments))},throw:function(r){var i=this.s.return;return i===void 0?Promise.reject(r):e(i.apply(this.s,arguments))}},new QE(t)}var ZE=function(t){return t.PendingEventsChanged="PendingEvent.pendingEventsChanged",t}({});class TQ extends sT{constructor(e,n,r,i,s){var o,a,c,l,d,h,m,g,y,v,w,S,R,x;super(i),o=this,this.widgetApi=e,this.capabilities=n,this.roomId=r,L(this,"room",void 0),L(this,"widgetApiReady",void 0),L(this,"roomStateSynced",void 0),L(this,"lifecycle",void 0),L(this,"syncState",null),L(this,"pendingSendingEventsTxId",[]),L(this,"eventEmitter",new On),L(this,"updateTxId",function(){var k=B(function*(A){if(A.getSender()===o.getUserId()&&o.pendingSendingEventsTxId.some(U=>A.getType()===U.type)){for(var O,D=(O=o.pendingSendingEventsTxId.find(U=>U.id===A.getId()))===null||O===void 0?void 0:O.txId;!D&&o.pendingSendingEventsTxId.length>0;){var N;yield new Promise(U=>o.eventEmitter.once(ZE.PendingEventsChanged,()=>U())),D=(N=o.pendingSendingEventsTxId.find(U=>U.id===A.getId()))===null||N===void 0?void 0:N.txId}D&&(A.setTxnId(D),A.setUnsigned(L2(L2({},A.getUnsigned()),{},{transaction_id:D}))),o.pendingSendingEventsTxId=o.pendingSendingEventsTxId.filter(U=>U.id!==A.getId()),o.pendingSendingEventsTxId.length===0&&o.eventEmitter.emit(ZE.PendingEventsChanged)}});return function(A){return k.apply(this,arguments)}}()),L(this,"onEvent",function(){var k=B(function*(A){if(A.preventDefault(),A.detail.data.room_id===o.roomId){var O=new $i(A.detail.data);yield o.updateTxId(O),o.syncApi instanceof Vd?(yield o.supportUpdateState())?yield o.syncApi.injectRoomEvents(o.room,void 0,[],[O]):yield o.syncApi.injectRoomEvents(o.room,[],void 0,[O]):(yield o.supportUpdateState())?yield o.syncApi.injectRoomEvents(o.room,[],[O]):M.error("slididng sync cannot be used in widget mode if the client widget driver does not support the version: 'org.matrix.msc2762_update_state'"),o.emit(Le.Event,O),o.setSyncState(Gt.Syncing),M.info("Received event ".concat(O.getId()," ").concat(O.getType()))}else{var{event_id:D,room_id:N}=A.detail.data;M.info("Received event ".concat(D," for a different room ").concat(N,"; discarding"))}yield o.ack(A)});return function(A){return k.apply(this,arguments)}}()),L(this,"onToDevice",function(){var k=B(function*(A){A.preventDefault();var O=new $i({type:A.detail.data.type,sender:A.detail.data.sender,content:A.detail.data.content});A.detail.data.encrypted&&O.makeEncrypted(Z.RoomMessageEncrypted,{},"",""),o.emit(Le.ToDeviceEvent,O),o.setSyncState(Gt.Syncing),yield o.ack(A)});return function(A){return k.apply(this,arguments)}}()),L(this,"onStateUpdate",function(){var k=B(function*(A){A.preventDefault(),(yield o.supportUpdateState())||M.warn("received update_state widget action but the widget driver did not claim to support 'org.matrix.msc2762_update_state'");for(var O of A.detail.data.state)if(O.room_id===o.roomId){var D=new $i(O);o.syncApi instanceof Vd?yield o.syncApi.injectRoomEvents(o.room,void 0,[D]):yield o.syncApi.injectRoomEvents(o.room,[D]),M.info("Updated state entry ".concat(D.getType()," ").concat(D.getStateKey()," to ").concat(D.getId()))}else{var{event_id:N,room_id:U}=A.detail.data;M.info("Received state entry ".concat(N," for a different room ").concat(U,"; discarding"))}yield o.ack(A)});return function(A){return k.apply(this,arguments)}}());var T=this.widgetApi.transport.send.bind(this.widgetApi.transport);this.widgetApi.transport.send=function(){var k=B(function*(A,O){try{return yield T(A,O)}catch(D){vB(D)}});return function(A,O){return k.apply(this,arguments)}}();var I=this.widgetApi.transport.sendComplete.bind(this.widgetApi.transport);this.widgetApi.transport.sendComplete=function(){var k=B(function*(A,O){try{return yield I(A,O)}catch(D){vB(D)}});return function(A,O){return k.apply(this,arguments)}}(),this.widgetApiReady=new Promise(k=>this.widgetApi.once("ready",k)),this.roomStateSynced=(a=n.receiveState)!==null&&a!==void 0&&a.length?new Promise(k=>this.widgetApi.once("action:".concat(vr.UpdateState),k)):Promise.resolve(),((c=n.sendEvent)!==null&&c!==void 0&&c.length||(l=n.receiveEvent)!==null&&l!==void 0&&l.length||n.sendMessage===!0||Array.isArray(n.sendMessage)&&n.sendMessage.length||n.receiveMessage===!0||Array.isArray(n.receiveMessage)&&n.receiveMessage.length||(d=n.sendState)!==null&&d!==void 0&&d.length||(h=n.receiveState)!==null&&h!==void 0&&h.length)&&e.requestCapabilityForRoomTimeline(r),(m=n.sendEvent)===null||m===void 0||m.forEach(k=>e.requestCapabilityToSendEvent(k)),(g=n.receiveEvent)===null||g===void 0||g.forEach(k=>e.requestCapabilityToReceiveEvent(k)),n.sendMessage===!0?e.requestCapabilityToSendMessage():Array.isArray(n.sendMessage)&&n.sendMessage.forEach(k=>e.requestCapabilityToSendMessage(k)),n.receiveMessage===!0?e.requestCapabilityToReceiveMessage():Array.isArray(n.receiveMessage)&&n.receiveMessage.forEach(k=>e.requestCapabilityToReceiveMessage(k)),(y=n.sendState)===null||y===void 0||y.forEach(k=>{var{eventType:A,stateKey:O}=k;return e.requestCapabilityToSendState(A,O)}),(v=n.receiveState)===null||v===void 0||v.forEach(k=>{var{eventType:A,stateKey:O}=k;return e.requestCapabilityToReceiveState(A,O)}),(w=n.sendToDevice)===null||w===void 0||w.forEach(k=>e.requestCapabilityToSendToDevice(k)),(S=n.receiveToDevice)===null||S===void 0||S.forEach(k=>e.requestCapabilityToReceiveToDevice(k)),n.sendDelayedEvents&&((R=n.sendEvent)!==null&&R!==void 0&&R.length||n.sendMessage===!0||Array.isArray(n.sendMessage)&&n.sendMessage.length||(x=n.sendState)!==null&&x!==void 0&&x.length)&&e.requestCapability(xy.MSC4157SendDelayedEvent),n.updateDelayedEvents&&e.requestCapability(xy.MSC4157UpdateDelayedEvent),n.turnServers&&e.requestCapability(xy.MSC3846TurnServers),e.on("action:".concat(vr.SendEvent),this.onEvent),e.on("action:".concat(vr.SendToDevice),this.onToDevice),e.on("action:".concat(vr.UpdateState),this.onStateUpdate),e.start(),s&&e.sendContentLoaded()}supportUpdateState(){var e=this;return B(function*(){return(yield e.widgetApi.getClientVersions()).includes(Kl.MSC2762_UPDATE_STATE)})()}startClient(){var e=arguments,n=this;return B(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{};n.lifecycle=new AbortController;var i=n.getUserId();if(i&&n.store.storeUser(new yu(i)),r.slidingSync?n.syncApi=new zJ(r.slidingSync,n,r,n.buildSyncApiOptions()):n.syncApi=new Vd(n,r,n.buildSyncApiOptions()),n.room=n.syncApi.createRoom(n.roomId),n.store.storeRoom(n.room),yield n.widgetApiReady,yield n.supportUpdateState())yield n.roomStateSynced;else{var s,o;yield Promise.all((s=(o=n.capabilities.receiveState)===null||o===void 0?void 0:o.map(function(){var a=B(function*(c){var{eventType:l,stateKey:d}=c,h=yield n.widgetApi.readStateEvents(l,void 0,d,[n.roomId]),m=h.map(g=>new $i(g));n.syncApi instanceof Vd?yield n.syncApi.injectRoomEvents(n.room,void 0,m):yield n.syncApi.injectRoomEvents(n.room,m),m.forEach(g=>{n.emit(Le.Event,g),M.info("Backfilled event ".concat(g.getId()," ").concat(g.getType()," ").concat(g.getStateKey()))})});return function(c){return a.apply(this,arguments)}}()))!==null&&s!==void 0?s:[])}r.clientWellKnownPollPeriod!==void 0&&(n.clientWellKnownIntervalID=setInterval(()=>{n.fetchClientWellKnown()},1e3*r.clientWellKnownPollPeriod),n.fetchClientWellKnown()),n.setSyncState(Gt.Syncing),M.info("Finished initial sync"),n.matrixRTC.start(),n.capabilities.turnServers&&n.watchTurnServers()})()}stopClient(){this.widgetApi.off("action:".concat(vr.SendEvent),this.onEvent),this.widgetApi.off("action:".concat(vr.SendToDevice),this.onToDevice),this.widgetApi.off("action:".concat(vr.UpdateState),this.onStateUpdate),super.stopClient(),this.lifecycle.abort()}joinRoom(e){var n=this;return B(function*(){if(e===n.roomId)return n.room;throw new Error("Unknown room: ".concat(e))})()}encryptAndSendEvent(e,n,r){var i=this;return B(function*(){var s=n.event.redacts?L2(L2({},n.getContent()),{},{redacts:n.event.redacts}):n.getContent();if(r){var o=yield i.widgetApi.sendRoomEvent(n.getType(),s,e.roomId,"delay"in r?r.delay:void 0,"parent_delay_id"in r?r.parent_delay_id:void 0).catch(Tc);return i.validateSendDelayedEventResponse(o)}var a=n.getTxnId();a&&i.pendingSendingEventsTxId.push({type:n.getType(),id:void 0,txId:a});var c;try{c=yield i.widgetApi.sendRoomEvent(n.getType(),s,e.roomId).catch(Tc)}catch(l){throw i.updatePendingEventStatus(e,n,rt.NOT_SENT),l}return e.updatePendingEvent(n,rt.SENT,c.event_id),i.pendingSendingEventsTxId.forEach(l=>{l.txId===a&&(l.id=c.event_id)}),i.eventEmitter.emit(ZE.PendingEventsChanged),{event_id:c.event_id}})()}sendStateEvent(e,n,r){var i=arguments,s=this;return B(function*(){var o=i.length>3&&i[3]!==void 0?i[3]:"",a=yield s.widgetApi.sendStateEvent(n,o,r,e).catch(Tc);if(a.event_id===void 0)throw new Error("'event_id' absent from response to an event request");return{event_id:a.event_id}})()}_unstable_sendDelayedStateEvent(e,n,r,i){var s=arguments,o=this;return B(function*(){var a=s.length>4&&s[4]!==void 0?s[4]:"";if(!(yield o.doesServerSupportUnstableFeature(Vc)))throw new Gd("Server does not support the delayed events API","sendDelayedStateEvent");var c=yield o.widgetApi.sendStateEvent(r,a,i,e,"delay"in n?n.delay:void 0,"parent_delay_id"in n?n.parent_delay_id:void 0).catch(Tc);return o.validateSendDelayedEventResponse(c)})()}validateSendDelayedEventResponse(e){if(e.delay_id===void 0)throw new Error("'delay_id' absent from response to a delayed event request");return{delay_id:e.delay_id}}_unstable_updateDelayedEvent(e,n){var r=this;return B(function*(){if(!(yield r.doesServerSupportUnstableFeature(Vc)))throw new Gd("Server does not support the delayed events API","updateDelayedEvent");return yield r.widgetApi.updateDelayedEvent(e,n).catch(Tc),{}})()}encryptAndSendToDevice(e,n,r){var i=this;return B(function*(){var s=new vu(()=>new Map);for(var{userId:o,deviceId:a}of n)s.getOrCreate(o).set(a,r);yield i.widgetApi.sendToDevice(e,!0,Mh(s)).catch(Tc)})()}sendToDevice(e,n){var r=this;return B(function*(){return yield r.widgetApi.sendToDevice(e,!1,Mh(n)).catch(Tc),{}})()}getOpenIdToken(){var e=this;return B(function*(){var n=yield e.widgetApi.requestOpenIDConnectToken().catch(Tc);return{access_token:n.access_token,expires_in:n.expires_in,matrix_server_name:n.matrix_server_name,token_type:n.token_type}})()}queueToDevice(e){var n=this;return B(function*(){var{eventType:r,batch:i}=e,s=new vu(()=>new Map);for(var{userId:o,deviceId:a,payload:c}of i)s.getOrCreate(o).set(a,c);yield n.widgetApi.sendToDevice(r,!1,Mh(s)).catch(Tc)})()}sendToDeviceViaWidgetApi(e,n,r){var i=this;return B(function*(){yield i.widgetApi.sendToDevice(e,n,Mh(r)).catch(Tc)})()}checkTurnServers(){var e=this;return B(function*(){return e.turnServers.length>0})()}getSyncState(){return this.syncState}setSyncState(e){var n=this.syncState;this.syncState=e,this.emit(Le.Sync,e,n)}ack(e){var n=this;return B(function*(){yield n.widgetApi.transport.reply(e.detail,{})})()}watchTurnServers(){var e=this;return B(function*(){var n=e.widgetApi.getTurnServers(),r=()=>{n.return(void 0)};e.lifecycle.signal.addEventListener("abort",r);try{var i=!1,s=!1,o;try{for(var a=tbe(n),c;i=!(c=yield a.next()).done;i=!1){var l=c.value;e.turnServers=[{urls:l.uris,username:l.username,credential:l.password}],e.emit(Le.TurnServers,e.turnServers),M.log("Received TURN server: ".concat(l.uris))}}catch(d){s=!0,o=d}finally{try{i&&a.return!=null&&(yield a.return())}finally{if(s)throw o}}}catch(d){M.warn("Error watching TURN servers",d)}finally{e.lifecycle.signal.removeEventListener("abort",r)}})()}}function vB(t){throw t instanceof yC&&t.data.matrix_api_error?tr.fromWidgetApiErrorData(t.data.matrix_api_error):t}function Tc(t){throw t instanceof Error&&t.message==="Request timed out"?new wp("widget api timeout"):t}class nbe{constructor(){L(this,"unthreadedReadReceipts",new Map),L(this,"threadedReadReceipts",new vu(()=>new Map))}setUnthreaded(e,n){this.unthreadedReadReceipts.set(e,n)}setThreaded(e,n,r){this.threadedReadReceipts.getOrCreate(e).set(n,r)}allUnthreaded(){return this.unthreadedReadReceipts.entries()}*allThreaded(){for(var e of this.threadedReadReceipts.values())for(var n of e.entries())yield n}consumeEphemeralEvents(e){e?.forEach(n=>{n.type!==Z.Receipt||!n.content||Object.keys(n.content).forEach(r=>{Object.entries(n.content[r]).forEach(i=>{var[s,o]=i;if(OO(s))for(var a of Object.keys(o)){var c=n.content[r][s][a],l={data:n.content[r][s][a],type:s,eventId:r};c.thread_id?this.setThreaded(c.thread_id,a,l):this.setUnthreaded(a,l)}})})})}buildAccumulatedReceiptEvent(e){var n={type:Z.Receipt,room_id:e,content:{}},r=new vu(()=>new vu(()=>new Map));for(var[i,s]of this.allUnthreaded())r.getOrCreate(s.eventId).getOrCreate(s.type).set(i,s.data);for(var[o,a]of this.allThreaded())r.getOrCreate(a.eventId).getOrCreate(a.type).set(o,a.data);return n.content=Mh(r),r.size>0?n:null}}var Bl=function(t){return t.Invite="invite",t.Leave="leave",t.Join="join",t.Knock="knock",t}({});function rbe(t){return"_localTs"in t&&t._localTs!==void 0}class RQ{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.opts=e,L(this,"accountData",{}),L(this,"inviteRooms",{}),L(this,"knockRooms",{}),L(this,"joinRooms",{}),L(this,"nextBatch",null),this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}accumulate(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this.accumulateRooms(e,n),this.accumulateAccountData(e),this.nextBatch=e.next_batch}accumulateAccountData(e){!e.account_data||!e.account_data.events||e.account_data.events.forEach(n=>{this.accountData[n.type]=n})}accumulateRooms(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach(r=>{this.accumulateRoom(r,Bl.Invite,e.rooms.invite[r],n)}),e.rooms.join&&Object.keys(e.rooms.join).forEach(r=>{this.accumulateRoom(r,Bl.Join,e.rooms.join[r],n)}),e.rooms.leave&&Object.keys(e.rooms.leave).forEach(r=>{this.accumulateRoom(r,Bl.Leave,e.rooms.leave[r],n)}),e.rooms.knock&&Object.keys(e.rooms.knock).forEach(r=>{this.accumulateRoom(r,Bl.Knock,e.rooms.knock[r],n)}))}accumulateRoom(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;switch(n){case Bl.Invite:this.knockRooms[e]&&delete this.knockRooms[e],this.accumulateInviteState(e,r);break;case Bl.Knock:this.accumulateKnockState(e,r);break;case Bl.Join:this.knockRooms[e]?delete this.knockRooms[e]:this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,r,i);break;case Bl.Leave:this.knockRooms[e]?delete this.knockRooms[e]:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:M.error("Unknown cateogory: ",n)}}accumulateInviteState(e,n){if(!(!n.invite_state||!n.invite_state.events)){if(!this.inviteRooms[e]){this.inviteRooms[e]={invite_state:n.invite_state};return}var r=this.inviteRooms[e];n.invite_state.events.forEach(i=>{for(var s=!1,o=0;o<r.invite_state.events.length;o++){var a=r.invite_state.events[o];a.type===i.type&&a.state_key==i.state_key&&(r.invite_state.events[o]=i,s=!0)}s||r.invite_state.events.push(i)})}}accumulateKnockState(e,n){if(!(!n.knock_state||!n.knock_state.events)){if(!this.knockRooms[e]){this.knockRooms[e]={knock_state:n.knock_state};return}var r=this.knockRooms[e];n.knock_state.events.forEach(i=>{for(var s=!1,o=0;o<r.knock_state.events.length;o++){var a=r.knock_state.events[o];a.type===i.type&&a.state_key==i.state_key&&(r.knock_state.events[o]=i,s=!0)}s||r.knock_state.events.push(i)})}}accumulateJoinState(e,n){var r,i,s,o,a,c,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_unreadThreadNotifications:{},_summary:{},_receipts:new nbe});var d=this.joinRooms[e];if(n.account_data&&n.account_data.events&&n.account_data.events.forEach(I=>{d._accountData[I.type]=I}),n.unread_notifications&&(d._unreadNotifications=n.unread_notifications),d._unreadThreadNotifications=(r=(i=n[ub.stable])!==null&&i!==void 0?i:n[ub.unstable])!==null&&r!==void 0?r:void 0,n.summary){var h,m,g,y="m.heroes",v="m.invited_member_count",w="m.joined_member_count",S=d._summary,R=n.summary;S[y]=(h=R[y])!==null&&h!==void 0?h:S[y],S[w]=(m=R[w])!==null&&m!==void 0?m:S[w],S[v]=(g=R[v])!==null&&g!==void 0?g:S[v]}if(d._receipts.consumeEphemeralEvents((s=n.ephemeral)===null||s===void 0?void 0:s.events),n.timeline&&n.timeline.limited&&(d._timeline=[]),(o=n.state)===null||o===void 0||(o=o.events)===null||o===void 0||o.forEach(I=>{O2(d._currentState,I)}),(a=n["org.matrix.msc4222.state_after"])===null||a===void 0||(a=a.events)===null||a===void 0||a.forEach(I=>{O2(d._currentState,I)}),(c=n.timeline)===null||c===void 0||(c=c.events)===null||c===void 0||c.forEach((I,k)=>{var A;n["org.matrix.msc4222.state_after"]||O2(d._currentState,I);var O;if(l)O=I;else{var D;O=Object.assign({},I),O.unsigned!==void 0&&(O.unsigned=Object.assign({},O.unsigned));var N=(D=I.unsigned)===null||D===void 0?void 0:D.age;N!==void 0&&(O._localTs=Date.now()-N)}d._timeline.push({event:O,token:k===0&&(A=n.timeline.prev_batch)!==null&&A!==void 0?A:null})}),d._timeline.length>this.opts.maxTimelineEntries){for(var x=d._timeline.length-this.opts.maxTimelineEntries,T=x;T<d._timeline.length;T++)if(d._timeline[T].token){d._timeline=d._timeline.slice(T,d._timeline.length);break}}}getJSON(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n={join:{},invite:{},knock:{},leave:{}};Object.keys(this.inviteRooms).forEach(i=>{n.invite[i]=this.inviteRooms[i]}),Object.keys(this.knockRooms).forEach(i=>{n.knock[i]=this.knockRooms[i]}),Object.keys(this.joinRooms).forEach(i=>{var s=this.joinRooms[i],o={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},"org.matrix.msc4222.state_after":{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:s._unreadNotifications,unread_thread_notifications:s._unreadThreadNotifications,summary:s._summary};Object.keys(s._accountData).forEach(m=>{o.account_data.events.push(s._accountData[m])});var a=s._receipts.buildAccumulatedReceiptEvent(i);a&&o.ephemeral.events.push(a),s._timeline.forEach(m=>{if(!o.timeline.prev_batch){if(!m.token)return;o.timeline.prev_batch=m.token}var g;!e&&rbe(m.event)?(g=Object.assign({},m.event),g.unsigned!==void 0&&(g.unsigned=Object.assign({},g.unsigned)),delete g._localTs,g.unsigned=g.unsigned||{},g.unsigned.age=Date.now()-m.event._localTs):g=m.event,o.timeline.events.push(g)});for(var c=Object.create(null),l=o.timeline.events.length-1;l>=0;l--){var d=o.timeline.events[l];if(!(d.state_key===null||d.state_key===void 0)){var h=d_(d);h.unsigned&&(h.unsigned.prev_content&&(h.content=h.unsigned.prev_content),h.unsigned.prev_sender&&(h.sender=h.unsigned.prev_sender)),O2(c,h)}}Object.keys(s._currentState).forEach(m=>{Object.keys(s._currentState[m]).forEach(g=>{var y=s._currentState[m][g];o["org.matrix.msc4222.state_after"].events.push(y),c[m]&&c[m][g]&&(y=c[m][g]),o.state.events.push(y)})}),n.join[i]=o});var r=[];return Object.keys(this.accountData).forEach(i=>{r.push(this.accountData[i])}),{nextBatch:this.nextBatch,roomsData:n,accountData:r}}getNextBatchToken(){return this.nextBatch}}function O2(t,e){e.state_key===null||e.state_key===void 0||!e.type||(t[e.type]||(t[e.type]=Object.create(null)),t[e.type][e.state_key]=e)}var IQ=function(t){return t[t.Blocked=-1]="Blocked",t[t.Unverified=0]="Unverified",t[t.Verified=1]="Verified",t}({});class ibe{constructor(e){L(this,"deviceId",void 0),L(this,"userId",void 0),L(this,"algorithms",void 0),L(this,"keys",void 0),L(this,"verified",void 0),L(this,"signatures",void 0),L(this,"displayName",void 0),L(this,"dehydrated",!1),this.deviceId=e.deviceId,this.userId=e.userId,this.algorithms=e.algorithms,this.keys=e.keys,this.verified=e.verified||IQ.Unverified,this.signatures=e.signatures||new Map,this.displayName=e.displayName,this.dehydrated=!!e.dehydrated}getFingerprint(){return this.keys.get("ed25519:".concat(this.deviceId))}getIdentityKey(){return this.keys.get("curve25519:".concat(this.deviceId))}}var yB=function(){},sbe=10;class obe{constructor(e,n){var r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.client=e,this.timelineSet=n,L(this,"windowLimit",void 0),L(this,"start",void 0),L(this,"end",void 0),L(this,"eventCount",0),this.windowLimit=i.windowLimit||1e3,(r=n.room)===null||r===void 0||r.on(ke.Timeline,this.onTimelineEvent.bind(this))}load(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:20,r=i=>{if(!i)throw new Error("No timeline given to initFields");var s,o=i.getEvents();if(!e)s=o.length;else if(s=o.findIndex(l=>l.getId()===e),s<0)throw new Error("getEventTimeline result didn't include requested event");var a=Math.min(o.length,s+Math.ceil(n/2)),c=Math.max(0,a-n);this.start=new IA(i,c-i.getBaseIndex()),this.end=new IA(i,a-i.getBaseIndex()),this.eventCount=a-c};return this.timelineSet.getTimelineForEvent(e)?(r(this.timelineSet.getTimelineForEvent(e)),Promise.resolve()):e?this.client.getEventTimeline(this.timelineSet,e).then(r):(r(this.timelineSet.getLiveTimeline()),Promise.resolve())}getTimelineIndex(e){if(e==Me.BACKWARDS){var n;return(n=this.start)!==null&&n!==void 0?n:null}else if(e==Me.FORWARDS){var r;return(r=this.end)!==null&&r!==void 0?r:null}else throw new Error("Invalid direction '"+e+"'")}extend(e,n){var r=this.getTimelineIndex(e);if(!r)return!1;var i=e==Me.BACKWARDS?r.retreat(n):r.advance(n);if(i){this.eventCount+=i,yB("TimelineWindow: increased cap by "+i+" (now "+this.eventCount+")");var s=this.eventCount-this.windowLimit;return s>0&&this.unpaginate(s,e!=Me.BACKWARDS),!0}return!1}onTimelineEvent(e,n,r,i){i&&this.onEventRemoved()}onEventRemoved(){var e=this.getEvents();e.length>0&&e[e.length-1]===void 0&&this.end&&this.end.index--}canPaginate(e){var n=this.getTimelineIndex(e);if(!n)return!1;if(e==Me.BACKWARDS){if(n.index>n.minIndex())return!0}else if(n.index<n.maxIndex())return!0;var r=n.timeline.getNeighbouringTimeline(e),i=n.timeline.getPaginationToken(e);return!!r||!!i}paginate(e,n){var r=arguments,i=this;return B(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:!0,o=r.length>3&&r[3]!==void 0?r[3]:sbe,a=i.getTimelineIndex(e);if(!a)return!1;if(a.pendingPaginate)return a.pendingPaginate;if(i.extend(e,n))return!0;if(!s||o===0)return!1;var c=a.timeline.getPaginationToken(e);if(!c)return!1;var l=i.client.paginateEventTimeline(a.timeline,{backwards:e==Me.BACKWARDS,limit:n}).finally(function(){a.pendingPaginate=void 0}).then(d=>d?i.paginate(e,n,!0,o-1):i.paginate(e,n,!1,0));return a.pendingPaginate=l,l})()}unpaginate(e,n){var r=n?this.start:this.end;if(!r)throw new Error("Attempting to unpaginate startOfTimeline=".concat(n," but don't have this direction"));if(e>this.eventCount||e<0)throw new Error("Attemting to unpaginate ".concat(e," events, but only have ").concat(this.eventCount," in the timeline"));for(;e>0;){var i=n?r.advance(e):r.retreat(e);if(i<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=i,this.eventCount-=i,yB("TimelineWindow.unpaginate: dropped "+i+" (now "+this.eventCount+")")}}getEvents(){if(!this.start)return[];for(var e=[],n=this.start.timeline;n;){var r,i,s=n.getEvents(),o=0,a=s.length;n===this.start.timeline&&(o=this.start.index+n.getBaseIndex()),n===((r=this.end)===null||r===void 0?void 0:r.timeline)&&(a=this.end.index+n.getBaseIndex());for(var c=o;c<a;c++)e.push(s[c]);if(n===((i=this.end)===null||i===void 0?void 0:i.timeline))break;n=n.getNeighbouringTimeline(Me.FORWARDS)}return e}}class IA{constructor(e,n){this.timeline=e,this.index=n,L(this,"pendingPaginate",void 0)}minIndex(){return this.timeline.getBaseIndex()*-1}maxIndex(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}advance(e){if(!e)return 0;var n;if(e<0){if(n=Math.max(e,this.minIndex()-this.index),n<0)return this.index+=n,n}else if(n=Math.min(e,this.maxIndex()-this.index),n>0)return this.index+=n,n;var r=this.timeline.getNeighbouringTimeline(e<0?Me.BACKWARDS:Me.FORWARDS);return r?(this.timeline=r,e<0?this.index=this.maxIndex():this.index=this.minIndex(),this.advance(e)):0}retreat(e){return this.advance(e*-1)*-1}}var R1="m.login.email.identity",bB="m.login.msisdn",kA=function(t){return t.Password="m.login.password",t.Recaptcha="m.login.recaptcha",t.Terms="m.login.terms",t.Email="m.login.email.identity",t.Msisdn="m.login.msisdn",t.Sso="m.login.sso",t.SsoUnstable="org.matrix.login.sso",t.Dummy="m.login.dummy",t.RegistrationToken="m.login.registration_token",t.UnstableRegistrationToken="org.matrix.msc3231.login.registration_token",t}({});class kQ extends Error{constructor(e,n,r){super(e),this.required_stages=n,this.flows=r,L(this,"name","NoAuthFlowFoundError")}}class l7{constructor(e){var n=this;L(this,"matrixClient",void 0),L(this,"inputs",void 0),L(this,"clientSecret",void 0),L(this,"requestCallback",void 0),L(this,"busyChangedCallback",void 0),L(this,"stateUpdatedCallback",void 0),L(this,"requestEmailTokenCallback",void 0),L(this,"supportedStages",void 0),L(this,"data",void 0),L(this,"emailSid",void 0),L(this,"requestingEmailToken",!1),L(this,"attemptAuthDeferred",null),L(this,"chosenFlow",null),L(this,"currentStage",null),L(this,"emailAttempt",1),L(this,"submitPromise",null),L(this,"requestEmailToken",B(function*(){if(n.requestingEmailToken)M.warn("Could not request email token: Already requesting");else{M.trace("Requesting email token. Attempt: "+n.emailAttempt),n.requestingEmailToken=!0;try{var r=yield n.requestEmailTokenCallback(n.inputs.emailAddress,n.clientSecret,n.emailAttempt++,n.data.session);n.emailSid=r.sid,M.trace("Email token request succeeded")}finally{n.requestingEmailToken=!1}}})),this.matrixClient=e.matrixClient,this.data=e.authData||{flows:[]},this.requestCallback=e.doRequest,this.busyChangedCallback=e.busyChanged,this.stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this.requestEmailTokenCallback=e.requestEmailToken,this.inputs=e.inputs||{},e.sessionId&&(this.data.session=e.sessionId),this.clientSecret=e.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=e.emailSid,e.supportedStages!==void 0&&(this.supportedStages=new Set(e.supportedStages))}attemptAuth(){var e=this;return B(function*(){var n;e.attemptAuthDeferred=Promise.withResolvers();var r=e.attemptAuthDeferred.promise;if((n=e.data)!==null&&n!==void 0&&(n=n.flows)!==null&&n!==void 0&&n.length)e.startNextAuthStage();else{var i;(i=e.busyChangedCallback)===null||i===void 0||i.call(e,!0);var s=e.data.session?{session:e.data.session}:null;e.doRequest(s).finally(()=>{var o;(o=e.busyChangedCallback)===null||o===void 0||o.call(e,!1)})}return r})()}poll(){var e=this;return B(function*(){if(e.data.session&&e.attemptAuthDeferred&&!e.submitPromise){var n={};if(e.currentStage==R1&&e.emailSid){var r={sid:e.emailSid,client_secret:e.clientSecret},i=e.matrixClient.getIdentityServerUrl();i&&(r.id_server=new URL(i).host),n={type:R1,threepid_creds:r}}e.submitAuthDict(n,!0)}})()}getSessionId(){var e;return(e=this.data)===null||e===void 0?void 0:e.session}getClientSecret(){return this.clientSecret}getStageParams(e){var n;return(n=this.data)===null||n===void 0||(n=n.params)===null||n===void 0?void 0:n[e]}getChosenFlow(){return this.chosenFlow}submitAuthDict(e){var n=arguments,r=this;return B(function*(){var i,s=n.length>1&&n[1]!==void 0?n[1]:!1;if(!r.attemptAuthDeferred)throw new Error("submitAuthDict() called before attemptAuth()");if(!s){var o;(o=r.busyChangedCallback)===null||o===void 0||o.call(r,!0)}for(;r.submitPromise;)try{yield r.submitPromise}catch{}var a;(i=r.data)!==null&&i!==void 0&&i.session?a=Object.assign({session:r.data.session},e):a=e;try{r.submitPromise=r.doRequest(a,s),yield r.submitPromise}finally{if(r.submitPromise=null,!s){var c;(c=r.busyChangedCallback)===null||c===void 0||c.call(r,!1)}}})()}getEmailSid(){return this.emailSid}setEmailSid(e){this.emailSid=e}doRequest(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!1;try{var s=yield r.requestCallback(e,i);r.attemptAuthDeferred.resolve(s),r.attemptAuthDeferred=null}catch(y){var o,a,c,l,d=y instanceof tr?y:null,h=(o=d==null||(a=d.data)===null||a===void 0?void 0:a.flows)!==null&&o!==void 0?o:null,m=((c=r.data)===null||c===void 0?void 0:c.flows)||!!h;if(!d||d.httpStatus!==401||!d.data||!m)if(i)M.log("Background poll request failed doing UI auth: ignoring",y);else{var g;(g=r.attemptAuthDeferred)===null||g===void 0||g.reject(y)}d&&!d.data&&(d.data={}),d&&!d.data.flows&&!d.data.completed&&!d.data.session&&(d.data.flows=r.data.flows,d.data.completed=r.data.completed,d.data.session=r.data.session),d&&(r.data=d.data);try{r.startNextAuthStage()}catch(v){r.attemptAuthDeferred.reject(v),r.attemptAuthDeferred=null;return}if(!r.emailSid&&(l=r.chosenFlow)!==null&&l!==void 0&&l.stages.includes(kA.Email))try{yield r.requestEmailToken()}catch(v){r.attemptAuthDeferred.reject(v),r.attemptAuthDeferred=null}}})()}startNextAuthStage(){var e,n,r=this.chooseStage();if(!r)throw new Error("No incomplete flows from the server");if(this.currentStage=r,r===kA.Dummy){this.submitAuthDict({type:"m.login.dummy"});return}if((e=this.data)!==null&&e!==void 0&&e.errcode||(n=this.data)!==null&&n!==void 0&&n.error){var i,s;this.stateUpdatedCallback(r,{errcode:((i=this.data)===null||i===void 0?void 0:i.errcode)||"",error:((s=this.data)===null||s===void 0?void 0:s.error)||""});return}this.stateUpdatedCallback(r,r===R1?{emailSid:this.emailSid}:{})}chooseStage(){this.chosenFlow===null&&(this.chosenFlow=this.chooseFlow()),M.log("Active flow => %s",JSON.stringify(this.chosenFlow));var e=this.firstUncompletedStage(this.chosenFlow);return M.log("Next stage: %s",e),e}scoreFlow(e){var n=e.stages.length;return this.supportedStages!==void 0&&(n+=e.stages.filter(r=>!this.supportedStages.has(r)).length*10),n}chooseFlow(){var e,n=((e=this.data)===null||e===void 0?void 0:e.flows)||[],r=!!this.inputs.emailAddress||!!this.emailSid,i=!!this.inputs.phoneCountry&&!!this.inputs.phoneNumber;n.sort((d,h)=>this.scoreFlow(d)-this.scoreFlow(h));for(var s of n){var o=!1,a=!1;for(var c of s.stages)c===R1?o=!0:c==bB&&(a=!0);if(o==r&&a==i)return s}var l=[];throw r&&l.push(R1),i&&l.push(bB),new kQ("No appropriate authentication flow found",l,n)}firstUncompletedStage(e){var n,r=((n=this.data)===null||n===void 0?void 0:n.completed)||[];return e.stages.find(i=>!r.includes(i))}}function xQ(t,e){return new Promise((n,r)=>{var i=!0,s=t.open(e);s.onupgradeneeded=()=>{i=!1},s.onblocked=()=>r(s.error),s.onsuccess=()=>{var o=s.result;o.close(),i||t.deleteDatabase(e),n(i)},s.onerror=()=>r(s.error)})}var AQ=[t=>{t.createObjectStore("users",{keyPath:["userId"]}),t.createObjectStore("accountData",{keyPath:["type"]}),t.createObjectStore("sync",{keyPath:["clobber"]})},t=>{var e=t.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]});e.createIndex("room","room_id")},t=>{t.createObjectStore("client_options",{keyPath:["clobber"]})},t=>{t.createObjectStore("to_device_queue",{autoIncrement:!0})}],abe=AQ.length;function M2(t,e,n){var r=t.openCursor(e);return new Promise((i,s)=>{var o=[];r.onerror=()=>{var a;s(new Error("Query failed: "+((a=r.error)===null||a===void 0?void 0:a.name)))},r.onsuccess=()=>{var a=r.result;if(!a){i(o);return}o.push(n(a)),a.continue()}})}function mh(t){return new Promise((e,n)=>{t.oncomplete=function(r){e(r)},t.onerror=function(){n(t.error)}})}function PQ(t){return new Promise((e,n)=>{t.onsuccess=function(r){e(r)},t.onerror=function(){n(t.error)}})}function cbe(t){return new Promise((e,n)=>{t.onsuccess=()=>e(t),t.onerror=r=>n(r)})}function Fk(t){return PQ(t).then(e=>t.result)}class _B{static exists(e,n){return n="matrix-js-sdk:"+(n||"default"),xQ(e,n)}constructor(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"default";this.indexedDB=e,L(this,"dbName",void 0),L(this,"syncAccumulator",void 0),L(this,"db",void 0),L(this,"disconnected",!0),L(this,"_isNewlyCreated",!1),L(this,"syncToDatabasePromise",void 0),L(this,"pendingUserPresenceData",[]),this.dbName="matrix-js-sdk:"+n,this.syncAccumulator=new RQ}connect(e){var n=this;if(!this.disconnected)return M.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,M.log("LocalIndexedDBStoreBackend.connect: connecting...");var r=this.indexedDB.open(this.dbName,abe);return r.onupgradeneeded=i=>{var s=r.result,o=i.oldVersion;M.log("LocalIndexedDBStoreBackend.connect: upgrading from ".concat(o)),o<1&&(this._isNewlyCreated=!0),AQ.forEach((a,c)=>{o<=c&&a(s)})},r.onblocked=()=>{M.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},M.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),PQ(r).then(B(function*(){M.log("LocalIndexedDBStoreBackend.connect: connected"),n.db=r.result,n.db.onversionchange=()=>{var i;(i=n.db)===null||i===void 0||i.close(),n.disconnected=!0,n.db=void 0},n.db.onclose=()=>{n.disconnected=!0,n.db=void 0,e?.()},yield n.init()}))}isNewlyCreated(){return Promise.resolve(this._isNewlyCreated)}init(){return Promise.all([this.loadAccountData(),this.loadSyncData()]).then(e=>{var[n,r]=e;M.log("LocalIndexedDBStoreBackend: loaded initial data"),this.syncAccumulator.accumulate({next_batch:r.nextBatch,rooms:r.roomsData,account_data:{events:n}},!0)})}getOutOfBandMembers(e){return new Promise((n,r)=>{var i=this.db.transaction(["oob_membership_events"],"readonly"),s=i.objectStore("oob_membership_events"),o=s.index("room"),a=IDBKeyRange.only(e),c=o.openCursor(a),l=[],d=!1;c.onsuccess=()=>{var h=c.result;if(!h)return!l.length&&!d?n(null):n(l);var m=h.value;m.oob_written?d=!0:l.push(m),h.continue()},c.onerror=h=>{r(h)}}).then(n=>(M.log("LL: got ".concat(n?.length," membershipEvents from storage for room ").concat(e," ...")),n))}setOutOfBandMembers(e,n){var r=this;return B(function*(){M.log("LL: backend about to store ".concat(n.length)+" members for ".concat(e));var i=r.db.transaction(["oob_membership_events"],"readwrite"),s=i.objectStore("oob_membership_events");n.forEach(a=>{s.put(a)});var o={room_id:e,oob_written:!0,state_key:0};s.put(o),yield mh(i),M.log("LL: backend done storing for ".concat(e,"!"))})()}clearOutOfBandMembers(e){var n=this;return B(function*(){var r=n.db.transaction(["oob_membership_events"],"readonly"),i=r.objectStore("oob_membership_events"),s=i.index("room"),o=IDBKeyRange.only(e),a=Fk(s.openKeyCursor(o,"next")).then(y=>(y?.primaryKey)[1]),c=Fk(s.openKeyCursor(o,"prev")).then(y=>(y?.primaryKey)[1]),[l,d]=yield Promise.all([a,c]),h=n.db.transaction(["oob_membership_events"],"readwrite"),m=h.objectStore("oob_membership_events"),g=IDBKeyRange.bound([e,l],[e,d]);M.log("LL: Deleting all users + marker in storage for room ".concat(e,", with key range:"),[e,l],[e,d]),yield cbe(m.delete(g))})()}clearDatabase(){return new Promise(e=>{var n;M.log("Removing indexeddb instance: ".concat(this.dbName)),(n=this.db)===null||n===void 0||n.close();var r=this.indexedDB.deleteDatabase(this.dbName);r.onblocked=()=>{M.log("can't yet delete indexeddb ".concat(this.dbName," because it is open elsewhere"))},r.onerror=()=>{var i;M.warn("unable to delete js-sdk store indexeddb: ".concat((i=r.error)===null||i===void 0?void 0:i.name)),e()},r.onsuccess=()=>{M.log("Removed indexeddb instance: ".concat(this.dbName)),e()}})}getSavedSync(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=this.syncAccumulator.getJSON();return n.nextBatch?e?Promise.resolve(d_(n)):Promise.resolve(n):Promise.resolve(null)}getNextBatchToken(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}setSyncData(e){return Promise.resolve().then(()=>{this.syncAccumulator.accumulate(e)})}syncToDatabase(e){var n=this;return B(function*(){return n.syncToDatabasePromise?(M.warn("Skipping syncToDatabase() as persist already in flight"),n.pendingUserPresenceData.push(...e),n.syncToDatabasePromise):(e.unshift(...n.pendingUserPresenceData),n.syncToDatabasePromise=n.doSyncToDatabase(e),n.syncToDatabasePromise)})()}doSyncToDatabase(e){var n=this;return B(function*(){try{var r=n.syncAccumulator.getJSON(!0);yield Promise.all([n.persistUserPresenceEvents(e),n.persistAccountData(r.accountData),n.persistSyncData(r.nextBatch,r.roomsData)])}finally{n.syncToDatabasePromise=void 0}})()}persistSyncData(e,n){return M.log("Persisting sync data up to",e),km(()=>{var r=this.db.transaction(["sync"],"readwrite"),i=r.objectStore("sync");return i.put({clobber:"-",nextBatch:e,roomsData:n}),mh(r).then(()=>{M.log("Persisted sync data up to",e)})})}persistAccountData(e){return km(()=>{var n=this.db.transaction(["accountData"],"readwrite"),r=n.objectStore("accountData");for(var i of e)r.put(i);return mh(n).then()})}persistUserPresenceEvents(e){return km(()=>{var n=this.db.transaction(["users"],"readwrite"),r=n.objectStore("users");for(var i of e)r.put({userId:i[0],event:i[1]});return mh(n).then()})}getUserPresenceEvents(){return km(()=>{var e=this.db.transaction(["users"],"readonly"),n=e.objectStore("users");return M2(n,void 0,r=>[r.value.userId,r.value.event])})}loadAccountData(){return M.log("LocalIndexedDBStoreBackend: loading account data..."),km(()=>{var e=this.db.transaction(["accountData"],"readonly"),n=e.objectStore("accountData");return M2(n,void 0,r=>r.value).then(r=>(M.log("LocalIndexedDBStoreBackend: loaded account data"),r))})}loadSyncData(){return M.log("LocalIndexedDBStoreBackend: loading sync data..."),km(()=>{var e=this.db.transaction(["sync"],"readonly"),n=e.objectStore("sync");return M2(n,void 0,r=>r.value).then(r=>(M.log("LocalIndexedDBStoreBackend: loaded sync data"),r.length>1&&M.warn("loadSyncData: More than 1 sync row found."),r.length>0?r[0]:{}))})}getClientOptions(){return Promise.resolve().then(()=>{var e=this.db.transaction(["client_options"],"readonly"),n=e.objectStore("client_options");return M2(n,void 0,r=>{var i;return(i=r.value)===null||i===void 0?void 0:i.options}).then(r=>r[0])})}storeClientOptions(e){var n=this;return B(function*(){var r=n.db.transaction(["client_options"],"readwrite"),i=r.objectStore("client_options");i.put({clobber:"-",options:e}),yield mh(r)})()}saveToDeviceBatches(e){var n=this;return B(function*(){var r=n.db.transaction(["to_device_queue"],"readwrite"),i=r.objectStore("to_device_queue");for(var s of e)i.add(s);yield mh(r)})()}getOldestToDeviceBatch(){var e=this;return B(function*(){var n=e.db.transaction(["to_device_queue"],"readonly"),r=n.objectStore("to_device_queue"),i=yield Fk(r.openCursor());if(!i)return null;var s=i.value;return{id:i.key,txnId:s.txnId,eventType:s.eventType,batch:s.batch}})()}removeToDeviceBatch(e){var n=this;return B(function*(){var r=n.db.transaction(["to_device_queue"],"readwrite"),i=r.objectStore("to_device_queue");i.delete(e),yield mh(r)})()}destroy(){var e=this;return B(function*(){var n;(n=e.db)===null||n===void 0||n.close()})()}}class lbe{constructor(e,n){this.workerFactory=e,this.dbName=n,L(this,"worker",void 0),L(this,"nextSeq",0),L(this,"inFlight",{}),L(this,"startPromise",void 0),L(this,"onWorkerMessage",r=>{var i=r.data;if(i.command=="closed"){var s;(s=this.onClose)===null||s===void 0||s.call(this)}else if(i.command=="cmd_success"||i.command=="cmd_fail"){if(i.seq===void 0){M.error("Got reply from worker with no seq");return}var o=this.inFlight[i.seq];if(o===void 0){M.error("Got reply for unknown seq "+i.seq);return}if(delete this.inFlight[i.seq],i.command=="cmd_success")o.resolve(i.result);else{var a=new Error(i.error.message);a.name=i.error.name,o.reject(a)}}else M.warn("Unrecognised message from worker: ",i)})}connect(e){return this.onClose=e,this.ensureStarted().then(()=>this.doCmd("connect"))}clearDatabase(){return this.ensureStarted().then(()=>this.doCmd("clearDatabase"))}isNewlyCreated(){return this.doCmd("isNewlyCreated")}getSavedSync(){return this.doCmd("getSavedSync")}getNextBatchToken(){return this.doCmd("getNextBatchToken")}setSyncData(e){return this.doCmd("setSyncData",[e])}syncToDatabase(e){return this.doCmd("syncToDatabase",[e])}getOutOfBandMembers(e){return this.doCmd("getOutOfBandMembers",[e])}setOutOfBandMembers(e,n){return this.doCmd("setOutOfBandMembers",[e,n])}clearOutOfBandMembers(e){return this.doCmd("clearOutOfBandMembers",[e])}getClientOptions(){return this.doCmd("getClientOptions")}storeClientOptions(e){return this.doCmd("storeClientOptions",[e])}getUserPresenceEvents(){return this.doCmd("getUserPresenceEvents")}saveToDeviceBatches(e){var n=this;return B(function*(){return n.doCmd("saveToDeviceBatches",[e])})()}getOldestToDeviceBatch(){var e=this;return B(function*(){return e.doCmd("getOldestToDeviceBatch")})()}removeToDeviceBatch(e){var n=this;return B(function*(){return n.doCmd("removeToDeviceBatch",[e])})()}ensureStarted(){return this.startPromise||(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("setupWorker",[this.dbName]).then(()=>{M.log("IndexedDB worker is ready")})),this.startPromise}doCmd(e,n){return Promise.resolve().then(()=>{var r,i=this.nextSeq++,s=Promise.withResolvers();return this.inFlight[i]=s,(r=this.worker)===null||r===void 0||r.postMessage({command:e,seq:i,args:n}),s.promise})}destroy(){var e=this;return B(function*(){var n;(n=e.worker)===null||n===void 0||n.terminate()})()}}var ube=1e3*60*5;class LQ extends vb{static exists(e,n){return _B.exists(e,n)}constructor(e){if(super(e),L(this,"backend",void 0),L(this,"startedUp",!1),L(this,"syncTs",0),L(this,"userModifiedMap",{}),L(this,"emitter",new On),L(this,"onClose",()=>{this.emitter.emit("closed")}),L(this,"getSavedSync",this.degradable(()=>this.backend.getSavedSync(),"getSavedSync")),L(this,"isNewlyCreated",this.degradable(()=>this.backend.isNewlyCreated(),"isNewlyCreated")),L(this,"getSavedSyncToken",this.degradable(()=>this.backend.getNextBatchToken(),"getSavedSyncToken")),L(this,"deleteAllData",this.degradable(()=>(super.deleteAllData(),this.backend.clearDatabase().then(()=>{M.log("Deleted indexeddb data.")},n=>{throw M.error("Failed to delete indexeddb data: ".concat(n)),n})),null)),L(this,"reallySave",this.degradable(()=>{this.syncTs=Date.now();var n=[];for(var r of this.getUsers())this.userModifiedMap[r.userId]!==r.getLastModifiedTime()&&r.events.presence&&(n.push([r.userId,r.events.presence.event]),this.userModifiedMap[r.userId]=r.getLastModifiedTime());return this.backend.syncToDatabase(n)},null)),L(this,"setSyncData",this.degradable(n=>this.backend.setSyncData(n),"setSyncData")),L(this,"getOutOfBandMembers",this.degradable(n=>this.backend.getOutOfBandMembers(n),"getOutOfBandMembers")),L(this,"setOutOfBandMembers",this.degradable((n,r)=>(super.setOutOfBandMembers(n,r),this.backend.setOutOfBandMembers(n,r)),"setOutOfBandMembers")),L(this,"clearOutOfBandMembers",this.degradable(n=>(super.clearOutOfBandMembers(n),this.backend.clearOutOfBandMembers(n)),"clearOutOfBandMembers")),L(this,"getClientOptions",this.degradable(()=>this.backend.getClientOptions(),"getClientOptions")),L(this,"storeClientOptions",this.degradable(n=>(super.storeClientOptions(n),this.backend.storeClientOptions(n)),"storeClientOptions")),!e.indexedDB)throw new Error("Missing required option: indexedDB");e.workerFactory?this.backend=new lbe(e.workerFactory,e.dbName):this.backend=new _B(e.indexedDB,e.dbName)}on(e,n){this.emitter.on(e,n)}startup(){return this.startedUp?(M.log("IndexedDBStore.startup: already started"),Promise.resolve()):(M.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect(this.onClose).then(()=>(M.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents())).then(e=>{M.log("IndexedDBStore.startup: processing presence events"),e.forEach(n=>{var[r,i]=n;if(!this.createUser)throw new Error("`IndexedDBStore.startup` must be called after assigning it to the client, not before!");var s=this.createUser(r);i&&s.setPresenceEvent(new $i(i)),this.userModifiedMap[s.userId]=s.getLastModifiedTime(),this.storeUser(s)}),this.startedUp=!0}))}destroy(){return this.backend.destroy()}wantsSave(){var e=Date.now();return e-this.syncTs>ube}save(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return e||this.wantsSave()?this.reallySave():Promise.resolve()}degradable(e,n){var r=this,i=n?super[n]:null;return B(function*(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];try{return yield e.call(r,...o)}catch(c){M.error("IndexedDBStore failure, degrading to MemoryStore",c),r.emitter.emit("degraded",c);try{M.log("IndexedDBStore trying to delete degraded data"),yield r.backend.clearDatabase(),M.log("IndexedDBStore delete after degrading succeeded")}catch(l){M.warn("IndexedDBStore delete after degrading failed",l)}if(i)return i.call(r,...o)}})}getPendingEvents(e){var n=()=>super.getPendingEvents,r=this;return B(function*(){if(!r.localStorage)return n().call(r,e);var i=r.localStorage.getItem($k(e));if(i)try{return JSON.parse(i)}catch(s){M.error("Could not parse persisted pending events",s)}return[]})()}setPendingEvents(e,n){var r=()=>super.setPendingEvents,i=this;return B(function*(){if(!i.localStorage)return r().call(i,e,n);n.length>0?i.localStorage.setItem($k(e),JSON.stringify(n)):i.localStorage.removeItem($k(e))})()}saveToDeviceBatches(e){return this.backend.saveToDeviceBatches(e)}getOldestToDeviceBatch(){return this.backend.getOldestToDeviceBatch()}removeToDeviceBatch(e){return this.backend.removeToDeviceBatch(e)}}function $k(t){return"mx_pending_events_".concat(t)}var rc="crypto.",SB=rc+"migration",Bk=rc+"account",dbe=rc+"cross_signing_keys",ew=rc+"inboundgroupsessions/",fbe=rc+"inboundgroupsessions.withheld/",hbe=rc+"rooms/",Hk=rc+"sessionsneedingbackup";function Mm(t){return rc+"sessions/"+t}function Vk(t,e){return ew+t+"/"+e}function pbe(t,e){return fbe+t+"/"+e}function mbe(t){return hbe+t}class oT extends z3{static exists(e){for(var n=e.length,r=0;r<n;r++){var i;if((i=e.key(r))!==null&&i!==void 0&&i.startsWith(rc))return!0}return!1}constructor(e){super(),this.store=e}containsData(){var e=this;return B(function*(){return oT.exists(e.store)})()}getMigrationState(){var e=this;return B(function*(){var n;return(n=Ko(e.store,SB))!==null&&n!==void 0?n:tv.NOT_STARTED})()}setMigrationState(e){var n=this;return B(function*(){gh(n.store,SB,e)})()}countEndToEndSessions(e,n){for(var r=0,i=0;i<this.store.length;++i){var s=this.store.key(i);if(s!=null&&s.startsWith(Mm(""))){var o=Ko(this.store,s);r+=Object.keys(o??{}).length}}n(r)}_getEndToEndSessions(e){var n=Ko(this.store,Mm(e)),r={};for(var[i,s]of Object.entries(n||{}))typeof s=="string"?r[i]={session:s}:r[i]=s;return r}getEndToEndSession(e,n,r,i){var s,o=this._getEndToEndSessions(e);i((s=o[n])!==null&&s!==void 0?s:{})}getEndToEndSessions(e,n,r){var i;r((i=this._getEndToEndSessions(e))!==null&&i!==void 0?i:{})}storeEndToEndSession(e,n,r,i){var s=this._getEndToEndSessions(e)||{};s[n]=r,gh(this.store,Mm(e),s)}getEndToEndSessionsBatch(){var e=this;return B(function*(){for(var n=[],r=0;r<e.store.length;++r){var i;if((i=e.store.key(r))!==null&&i!==void 0&&i.startsWith(Mm(""))){var s=e.store.key(r).split("/")[1];for(var o of Object.values(e._getEndToEndSessions(s)))if(n.push(o),n.length>=nv)return n}}return n.length===0?null:n})()}deleteEndToEndSessionsBatch(e){var n=this;return B(function*(){for(var{deviceKey:r,sessionId:i}of e){var s=n._getEndToEndSessions(r)||{};delete s[i],Object.keys(s).length===0?n.store.removeItem(Mm(r)):gh(n.store,Mm(r),s)}})()}getEndToEndInboundGroupSession(e,n,r,i){i(Ko(this.store,Vk(e,n)),Ko(this.store,pbe(e,n)))}storeEndToEndInboundGroupSession(e,n,r,i){gh(this.store,Vk(e,n),r)}countEndToEndInboundGroupSessions(){var e=this;return B(function*(){for(var n=0,r=0;r<e.store.length;++r){var i=e.store.key(r);i!=null&&i.startsWith(ew)&&(n+=1)}return n})()}getEndToEndInboundGroupSessionsBatch(){var e=this;return B(function*(){for(var n=Ko(e.store,Hk)||{},r=[],i=0;i<e.store.length;++i){var s=e.store.key(i);if(s!=null&&s.startsWith(ew)){var o=s.slice(ew.length);if(r.push({senderKey:o.slice(0,43),sessionId:o.slice(44),sessionData:Ko(e.store,s),needsBackup:o in n}),r.length>=nv)return r}}return r.length===0?null:r})()}deleteEndToEndInboundGroupSessionsBatch(e){var n=this;return B(function*(){for(var{senderKey:r,sessionId:i}of e){var s=Vk(r,i);n.store.removeItem(s)}})()}getEndToEndRooms(e,n){for(var r={},i=mbe(""),s=0;s<this.store.length;++s){var o=this.store.key(s);if(o!=null&&o.startsWith(i)){var a=o.slice(i.length);r[a]=Ko(this.store,o)}}n(r)}markSessionsNeedingBackup(e){var n=Ko(this.store,Hk)||{};for(var r of e)n[r.senderKey+"/"+r.sessionId]=!0;return gh(this.store,Hk,n),Promise.resolve()}deleteAllData(){return this.store.removeItem(Bk),Promise.resolve()}getAccount(e,n){var r=Ko(this.store,Bk);n(r)}storeAccount(e,n){gh(this.store,Bk,n)}getCrossSigningKeys(e,n){var r=Ko(this.store,dbe);n(r)}getSecretStorePrivateKey(e,n,r){var i=Ko(this.store,rc+"ssss_cache.".concat(r));n(i)}storeSecretStorePrivateKey(e,n,r){gh(this.store,rc+"ssss_cache.".concat(n),r)}doTxn(e,n,r){return Promise.resolve(r(null))}}function Ko(t,e){try{return JSON.parse(t.getItem(e))}catch(n){M.log("Error: Failed to get key %s: %s",e,n.message),M.log(n.stack)}return null}function gh(t,e,n){t.setItem(e,JSON.stringify(n))}let gbe=class{constructor(e){this.db=e,L(this,"nextTxnId",0),e.onversionchange=()=>{M.log("versionchange for indexeddb ".concat(this.db.name,": closing")),e.close()}}containsData(){return B(function*(){throw Error("Not implemented for Backend")})()}startup(){var e=this;return B(function*(){return e})()}deleteAllData(){return B(function*(){throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.")})()}getMigrationState(){var e=this;return B(function*(){var n=tv.NOT_STARTED;return yield e.doTxn("readonly",[qt.STORE_ACCOUNT],r=>{var i=r.objectStore(qt.STORE_ACCOUNT),s=i.get(G5);s.onsuccess=()=>{var o;n=(o=s.result)!==null&&o!==void 0?o:tv.NOT_STARTED}}),n})()}setMigrationState(e){var n=this;return B(function*(){yield n.doTxn("readwrite",[qt.STORE_ACCOUNT],r=>{var i=r.objectStore(qt.STORE_ACCOUNT);i.put(e,G5)})})()}getAccount(e,n){var r=e.objectStore("account"),i=r.get("-");i.onsuccess=function(){try{n(i.result||null)}catch(s){Os(e,s)}}}storeAccount(e,n){var r=e.objectStore("account");r.put(n,"-")}getCrossSigningKeys(e,n){var r=e.objectStore("account"),i=r.get("crossSigningKeys");i.onsuccess=function(){try{n(i.result||null)}catch(s){Os(e,s)}}}getSecretStorePrivateKey(e,n,r){var i=e.objectStore("account"),s=i.get("ssss_cache:".concat(r));s.onsuccess=function(){try{n(s.result||null)}catch(o){Os(e,o)}}}storeSecretStorePrivateKey(e,n,r){var i=e.objectStore("account");i.put(r,"ssss_cache:".concat(n))}countEndToEndSessions(e,n){var r=e.objectStore("sessions"),i=r.count();i.onsuccess=function(){try{n(i.result)}catch(s){Os(e,s)}}}getEndToEndSessions(e,n,r){var i=n.objectStore("sessions"),s=i.index("deviceKey"),o=s.openCursor(e),a={};o.onsuccess=function(){var c=o.result;if(c)a[c.value.sessionId]={session:c.value.session,lastReceivedMessageTs:c.value.lastReceivedMessageTs},c.continue();else try{r(a)}catch(l){Os(n,l)}}}getEndToEndSession(e,n,r,i){var s=r.objectStore("sessions"),o=s.get([e,n]);o.onsuccess=function(){try{o.result?i({session:o.result.session,lastReceivedMessageTs:o.result.lastReceivedMessageTs}):i(null)}catch(a){Os(r,a)}}}storeEndToEndSession(e,n,r,i){var s=i.objectStore("sessions");s.put({deviceKey:e,sessionId:n,session:r.session,lastReceivedMessageTs:r.lastReceivedMessageTs})}getEndToEndSessionsBatch(){var e=this;return B(function*(){var n=[];return yield e.doTxn("readonly",[qt.STORE_SESSIONS],r=>{var i=r.objectStore(qt.STORE_SESSIONS),s=i.openCursor();s.onsuccess=function(){try{var o=s.result;o&&(n.push(o.value),n.length<nv&&o.continue())}catch(a){Os(r,a)}}}),n.length===0?null:n})()}deleteEndToEndSessionsBatch(e){var n=this;return B(function*(){yield n.doTxn("readwrite",[qt.STORE_SESSIONS],function(){var r=B(function*(i){try{var s=i.objectStore(qt.STORE_SESSIONS),o=function*(){var d=s.delete([a,c]);yield new Promise(h=>{d.onsuccess=h})};for(var{deviceKey:a,sessionId:c}of e)yield*o()}catch(l){Os(i,l)}});return function(i){return r.apply(this,arguments)}}())})()}getEndToEndInboundGroupSession(e,n,r,i){var s=!1,o=!1,a=r.objectStore("inbound_group_sessions"),c=a.get([e,n]);c.onsuccess=function(){try{c.result?s=c.result.session:s=null,o!==!1&&i(s,o)}catch(h){Os(r,h)}};var l=r.objectStore("inbound_group_sessions_withheld"),d=l.get([e,n]);d.onsuccess=function(){try{d.result?o=d.result.session:o=null,s!==!1&&i(s,o)}catch(h){Os(r,h)}}}storeEndToEndInboundGroupSession(e,n,r,i){var s=i.objectStore("inbound_group_sessions");s.put({senderCurve25519Key:e,sessionId:n,session:r})}countEndToEndInboundGroupSessions(){var e=this;return B(function*(){var n=0;return yield e.doTxn("readonly",[qt.STORE_INBOUND_GROUP_SESSIONS],r=>{var i=r.objectStore(qt.STORE_INBOUND_GROUP_SESSIONS),s=i.count();s.onsuccess=()=>{n=s.result}}),n})()}getEndToEndInboundGroupSessionsBatch(){var e=this;return B(function*(){var n=[];return yield e.doTxn("readonly",[qt.STORE_INBOUND_GROUP_SESSIONS,qt.STORE_BACKUP],r=>{var i=r.objectStore(qt.STORE_INBOUND_GROUP_SESSIONS),s=r.objectStore(qt.STORE_BACKUP),o=i.openCursor();o.onsuccess=function(){try{var a=o.result;if(a){var c=s.get(a.key);c.onsuccess=()=>{n.push({senderKey:a.value.senderCurve25519Key,sessionId:a.value.sessionId,sessionData:a.value.session,needsBackup:c.result!==void 0}),n.length<nv&&a.continue()}}}catch(l){Os(r,l)}}}),n.length===0?null:n})()}deleteEndToEndInboundGroupSessionsBatch(e){var n=this;return B(function*(){yield n.doTxn("readwrite",[qt.STORE_INBOUND_GROUP_SESSIONS],function(){var r=B(function*(i){try{var s=i.objectStore(qt.STORE_INBOUND_GROUP_SESSIONS),o=function*(){var d=s.delete([a,c]);yield new Promise(h=>{d.onsuccess=h})};for(var{senderKey:a,sessionId:c}of e)yield*o()}catch(l){Os(i,l)}});return function(i){return r.apply(this,arguments)}}())})()}getEndToEndDeviceData(e,n){var r=e.objectStore("device_data"),i=r.get("-");i.onsuccess=function(){try{n(i.result||null)}catch(s){Os(e,s)}}}getEndToEndRooms(e,n){var r={},i=e.objectStore("rooms"),s=i.openCursor();s.onsuccess=function(){var o=s.result;if(o)r[o.key]=o.value,o.continue();else try{n(r)}catch(a){Os(e,a)}}}markSessionsNeedingBackup(e,n){var r=this;return B(function*(){n||(n=r.db.transaction("sessions_needing_backup","readwrite"));var i=n.objectStore("sessions_needing_backup");yield Promise.all(e.map(s=>new Promise((o,a)=>{var c=i.put({senderCurve25519Key:s.senderKey,sessionId:s.sessionId});c.onsuccess=o,c.onerror=a})))})()}doTxn(e,n,r){var i=this.db.transaction(n,e),s=bbe(i),o=r(i);return s.then(()=>o)}};var OQ=[t=>{ybe(t)},t=>{t.createObjectStore("account")},t=>{var e=t.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]});e.createIndex("deviceKey","deviceKey")},t=>{t.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{t.createObjectStore("device_data")},t=>{t.createObjectStore("rooms")},t=>{t.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{t.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{var e=t.createObjectStore("session_problems",{keyPath:["deviceKey","time"]});e.createIndex("deviceKey","deviceKey"),t.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})},t=>{t.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},t=>{t.createObjectStore("parked_shared_history",{keyPath:["roomId"]})}],MQ=OQ.length;function vbe(t,e){M.log("Upgrading IndexedDBCryptoStore from version ".concat(e)+" to ".concat(MQ)),OQ.forEach((n,r)=>{e<=r&&n(t)})}function ybe(t){var e=t.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});e.createIndex("session",["requestBody.room_id","requestBody.session_id"]),e.createIndex("state","state")}function Os(t,e){t._mx_abortexception=e;try{t.abort()}catch{}}function bbe(t){return new Promise((e,n)=>{t.oncomplete=()=>{t._mx_abortexception!==void 0&&n(t._mx_abortexception),e(null)},t.onerror=r=>{t._mx_abortexception!==void 0?n(t._mx_abortexception):(M.log("Error performing indexeddb txn",r),n(t.error))},t.onabort=r=>{t._mx_abortexception!==void 0?n(t._mx_abortexception):(M.log("Error performing indexeddb txn",r),n(t.error))}})}class qt{static exists(e,n){return xQ(e,n)}static existsAndIsNotMigrated(e,n){return new Promise((r,i)=>{var s=!0,o=e.open(n);o.onupgradeneeded=()=>{s=!1},o.onblocked=()=>i(o.error),o.onsuccess=()=>{var a=o.result;if(!s)a.close(),e.deleteDatabase(n),r(!1);else{var c=a.transaction([qt.STORE_ACCOUNT],"readonly"),l=c.objectStore(qt.STORE_ACCOUNT),d=l.get(G5);d.onsuccess=()=>{var h,m=(h=d.result)!==null&&h!==void 0?h:tv.NOT_STARTED;r(m===tv.NOT_STARTED)},d.onerror=()=>{i(d.error)},a.close()}},o.onerror=()=>i(o.error)})}constructor(e,n){this.indexedDB=e,this.dbName=n,L(this,"backendPromise",void 0),L(this,"backend",void 0)}containsData(){var e=this;return B(function*(){return qt.exists(e.indexedDB,e.dbName)})()}startup(){return this.backendPromise?this.backendPromise:(this.backendPromise=new Promise((e,n)=>{if(!this.indexedDB){n(new Error("no indexeddb support available"));return}M.log("connecting to indexeddb ".concat(this.dbName));var r=this.indexedDB.open(this.dbName,MQ);r.onupgradeneeded=i=>{var s=r.result,o=i.oldVersion;vbe(s,o)},r.onblocked=()=>{M.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},r.onerror=i=>{M.log("Error connecting to indexeddb",i),n(r.error)},r.onsuccess=()=>{var i=r.result;M.log("connected to indexeddb ".concat(this.dbName)),e(new gbe(i))}}).then(e=>e.doTxn("readonly",[qt.STORE_INBOUND_GROUP_SESSIONS,qt.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],n=>{e.getEndToEndInboundGroupSession("","",n,()=>{})}).then(()=>e)).catch(e=>{if(e.name==="VersionError")throw M.warn("Crypto DB is too new for us to use!",e),new t7(e7.TooNew);M.warn("unable to connect to indexeddb ".concat(this.dbName)+": falling back to localStorage store: ".concat(e));try{if(!(globalThis.localStorage instanceof Storage))throw new Error("localStorage is not available");return new oT(globalThis.localStorage)}catch(n){return M.warn("Unable to open localStorage: falling back to in-memory store: ".concat(n)),new z3}}).then(e=>(this.backend=e,e)),this.backendPromise)}deleteAllData(){return new Promise((e,n)=>{if(!this.indexedDB){n(new Error("no indexeddb support available"));return}M.log("Removing indexeddb instance: ".concat(this.dbName));var r=this.indexedDB.deleteDatabase(this.dbName);r.onblocked=()=>{M.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},r.onerror=i=>{M.log("Error deleting data from indexeddb",i),n(r.error)},r.onsuccess=()=>{M.log("Removed indexeddb instance: ".concat(this.dbName)),e()}}).catch(e=>{M.warn("unable to delete IndexedDBCryptoStore: ".concat(e))})}getMigrationState(){return this.backend.getMigrationState()}setMigrationState(e){return this.backend.setMigrationState(e)}getAccount(e,n){this.backend.getAccount(e,n)}storeAccount(e,n){this.backend.storeAccount(e,n)}getCrossSigningKeys(e,n){this.backend.getCrossSigningKeys(e,n)}getSecretStorePrivateKey(e,n,r){this.backend.getSecretStorePrivateKey(e,n,r)}storeSecretStorePrivateKey(e,n,r){this.backend.storeSecretStorePrivateKey(e,n,r)}countEndToEndSessions(e,n){this.backend.countEndToEndSessions(e,n)}getEndToEndSession(e,n,r,i){this.backend.getEndToEndSession(e,n,r,i)}getEndToEndSessions(e,n,r){this.backend.getEndToEndSessions(e,n,r)}storeEndToEndSession(e,n,r,i){this.backend.storeEndToEndSession(e,n,r,i)}countEndToEndInboundGroupSessions(){return this.backend.countEndToEndInboundGroupSessions()}getEndToEndSessionsBatch(){return this.backend.getEndToEndSessionsBatch()}deleteEndToEndSessionsBatch(e){return this.backend.deleteEndToEndSessionsBatch(e)}getEndToEndInboundGroupSession(e,n,r,i){this.backend.getEndToEndInboundGroupSession(e,n,r,i)}storeEndToEndInboundGroupSession(e,n,r,i){this.backend.storeEndToEndInboundGroupSession(e,n,r,i)}getEndToEndInboundGroupSessionsBatch(){return this.backend.getEndToEndInboundGroupSessionsBatch()}deleteEndToEndInboundGroupSessionsBatch(e){return this.backend.deleteEndToEndInboundGroupSessionsBatch(e)}getEndToEndRooms(e,n){this.backend.getEndToEndRooms(e,n)}markSessionsNeedingBackup(e,n){return this.backend.markSessionsNeedingBackup(e,n)}doTxn(e,n,r,i){return this.backend.doTxn(e,n,r,i)}}L(qt,"STORE_ACCOUNT","account");L(qt,"STORE_SESSIONS","sessions");L(qt,"STORE_INBOUND_GROUP_SESSIONS","inbound_group_sessions");L(qt,"STORE_INBOUND_GROUP_SESSIONS_WITHHELD","inbound_group_sessions_withheld");L(qt,"STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS","shared_history_inbound_group_sessions");L(qt,"STORE_PARKED_SHARED_HISTORY","parked_shared_history");L(qt,"STORE_DEVICE_DATA","device_data");L(qt,"STORE_ROOMS","rooms");L(qt,"STORE_BACKUP","sessions_needing_backup");var _be=function(t){return t.Email="email",t.Phone="msisdn",t}({}),Sbe=new Ar("delegated_oidc_compatibility","org.matrix.msc3824.delegated_oidc_compatibility"),Ebe=function(t){return t.Gitlab="gitlab",t.Github="github",t.Apple="apple",t.Google="google",t.Facebook="facebook",t.Twitter="twitter",t}({}),wbe=function(t){return t.LOGIN="login",t.REGISTER="register",t}({}),Cbe="us.cloke.msc4175.tz";class Tbe{constructor(e){L(this,"relations",void 0),this.relations=e.filter(n=>!!n)}getRelations(){return this.relations.reduce((e,n)=>[...e,...n.getRelations()],[])}on(e,n){this.relations.forEach(r=>r.on(e,n))}off(e,n){this.relations.forEach(r=>r.off(e,n))}}var Rbe=function(t){return t.Global="Global",t.SetItemError="setItem",t.GetItemError="getItem",t.RemoveItemError="removeItem",t.ClearError="clear",t.QuotaExceededError="QuotaExceededError",t}({});class Ibe extends On{}var kbe=new Ibe,DQ=()=>new z3;function NQ(t){DQ=t}function UQ(t){var e,n,r;return t.store=(e=t.store)!==null&&e!==void 0?e:new vb({localStorage:globalThis.localStorage}),t.scheduler=(n=t.scheduler)!==null&&n!==void 0?n:new rv,t.cryptoStore=(r=t.cryptoStore)!==null&&r!==void 0?r:DQ(),t}function aT(t){return new sT(UQ(t))}function jQ(t,e,n,r){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;return new TQ(t,e,n,UQ(r),i)}const xbe=Object.freeze(Object.defineProperty({__proto__:null,AuthType:kA,AutoDiscovery:lt,AutoDiscoveryAction:So,AutoDiscoveryError:Ia,Beacon:EJ,BeaconEvent:qn,CallEvent:gt,CallFeedEvent:Lc,Category:Bl,ClientEvent:Le,ClientPrefix:Xr,ClientStoppedError:eye,ConditionKind:Ur,ConditionOperator:S1e,ConnectionError:wp,ContentHelpers:Zve,DELEGATED_OIDC_COMPATIBILITY:Sbe,DEVICE_CODE_SCOPE:Uye,DMMemberCountCondition:E1e,DebugLogger:MO,Device:ibe,DeviceVerification:IQ,Direction:ht,DuplicateStrategy:wy,EVENT_VISIBILITY_CHANGE_TYPE:Dh,EventEmitterEvents:WX,EventStatus:rt,EventTimeline:Me,EventTimelineSet:ag,EventType:Z,FILTER_RELATED_BY_REL_TYPES:kg,FILTER_RELATED_BY_SENDERS:Ig,FeatureSupport:Zi,Filter:Us,GET_LOGIN_TOKEN_CAPABILITY:Vye,GroupCall:YO,GroupCallEvent:kn,GroupCallIntent:VJ,GroupCallState:sr,GroupCallStatsReportEvent:uy,GroupCallType:eT,GuestAccess:dC,HTTPError:ep,HistoryVisibility:QO,HttpApiEvent:tA,IdentityPrefix:$l,IdentityProviderBrand:Ebe,IndexedDBCryptoStore:qt,IndexedDBStore:LQ,InteractiveAuth:l7,InvalidCryptoStoreError:t7,InvalidCryptoStoreState:e7,JoinRule:ef,KNOWN_SAFE_ROOM_VERSION:MJ,KeySignatureUploadError:Z1e,KnownMembership:Be,LOCAL_NOTIFICATION_SETTINGS_PREFIX:QX,LocalStorageCryptoStore:oT,LocalStorageErrors:Rbe,LocationAssetType:ev,MAIN_ROOM_TIMELINE:u_,MAXIMUM_MATRIX_VERSION:x1e,MINIMUM_MATRIX_VERSION:k1e,MSC3912_RELATION_BASED_REDACTIONS_PROP:X5,M_ASSET:c_,M_BEACON:pA,M_BEACON_INFO:ZO,M_HTML:Kve,M_LOCATION:l_,M_MESSAGE:Gve,M_POLL_END:lC,M_POLL_KIND_DISCLOSED:t0e,M_POLL_KIND_UNDISCLOSED:n0e,M_POLL_RESPONSE:db,M_POLL_START:r0e,M_TEXT:FO,M_TIMESTAMP:Lf,M_TOPIC:$O,MatrixClient:sT,MatrixError:tr,MatrixEvent:$i,MatrixEventEvent:Kt,MatrixHttpApi:PJ,MatrixScheduler:rv,MediaHandlerEvent:Rh,MediaPrefix:Cg,MemoryCryptoStore:z3,MemoryStore:vb,Method:de,MsgType:ll,NoAuthFlowFoundError:kQ,NotificationCountType:Jt,OidcError:ts,OidcTokenRefresher:Fye,PUSHER_DEVICE_ID:Ave,PUSHER_ENABLED:J5,PendingEventOrdering:sv,Poll:TJ,PollEvent:Md,Preset:nT,ProfileKeyMSC4175Timezone:Cbe,PushRuleActionName:Zd,PushRuleKind:wi,REFERENCE_RELATION:dJ,ReceiptType:ls,RelatedRelations:Tbe,RelationType:vn,Relations:jO,RelationsEvent:KE,RestrictedAllowType:P1e,Room:Q3,RoomCreateTypeField:sC,RoomEvent:ke,RoomMember:cb,RoomMemberEvent:Vs,RoomNameType:Pc,RoomState:gb,RoomStateEvent:pt,RoomSummary:lJ,RoomType:wg,RoomVersionStability:LJ,RoomWidgetClient:TQ,RoomWidgetClientEvent:ZE,RuleId:Ei,SERVICE_TYPES:fA,SSOAction:wbe,STABLE_MSC4133_EXTENDED_PROFILES:bQ,SUPPORTED_MATRIX_VERSIONS:hb,SearchOrderBy:KJ,SearchResult:tT,SecretStorage:J1e,ServerCapabilities:OJ,SetPresence:DJ,SlidingSyncEvent:hA,StatsReport:pu,SyncAccumulator:RQ,SyncState:Gt,THREAD_RELATION_TYPE:wn,Thread:Un,ThreadEvent:us,ThreadFilterType:Ba,ThreepidMedium:_be,TimelineIndex:IA,TimelineWindow:obe,ToDeviceMessageId:X3,TokenRefreshError:xJ,TokenRefreshLogoutError:VO,TweakName:XO,TypedEventEmitter:On,UNSIGNED_MEMBERSHIP_FIELD:ZX,UNSIGNED_THREAD_ID_FIELD:oC,UNSTABLE_ELEMENT_FUNCTIONAL_USERS:JX,UNSTABLE_MSC2666_MUTUAL_ROOMS:gQ,UNSTABLE_MSC2666_QUERY_MUTUAL_ROOMS:vQ,UNSTABLE_MSC2666_SHARED_ROOMS:mQ,UNSTABLE_MSC2716_MARKER:XX,UNSTABLE_MSC3088_ENABLED:W5,UNSTABLE_MSC3088_PURPOSE:z5,UNSTABLE_MSC3089_BRANCH:ru,UNSTABLE_MSC3089_LEAF:YX,UNSTABLE_MSC3089_TREE_SUBTYPE:Y5,UNSTABLE_MSC3852_LAST_SEEN_UA:Hye,UNSTABLE_MSC4133_EXTENDED_PROFILES:yQ,UNSTABLE_MSC4140_DELAYED_EVENTS:Vc,UnsupportedDelayedEventsEndpointError:Gd,UpdateDelayedEventAction:zE,User:yu,UserEvent:Ui,Visibility:GJ,anySignal:AJ,calculateRetryBackoff:GO,completeAuthorizationCodeGrant:Nye,createClient:aT,createNewMatrixCall:fb,createRoomWidgetClient:jQ,decodeBase64:Bh,decodeIdToken:dQ,determineFeatureSupport:JE,discoverAndValidateOIDCIssuerWellKnown:a7,encodeBase64:Cy,encodeUnpaddedBase64:$J,encodeUnpaddedBase64Url:Z3,fixNotificationCountOnDecryption:_Q,generateAuthorizationParams:Lye,generateAuthorizationUrl:Oye,generateOidcAuthorizationUrl:Mye,generateScope:iT,getBeaconInfoIdentifier:cC,getHttpUriForMxc:W3,inMainTimelineForReceipt:mb,isDmMemberCountCondition:w1e,isEventTypeSame:zve,isPollEvent:RJ,isTimestampInDuration:Z5,localStorageErrorsEventsEmitter:kbe,parseErrorResponse:qO,registerOidcClient:jye,retryNetworkOperation:nA,safeGetRetryAfterMs:HO,setCryptoStoreFactory:NQ,threadFilterTypeToFilter:SQ,threadIdForReceipt:ov,timeoutSignal:J3,validateAuthMetadata:uQ,validateAuthMetadataAndKeys:c7,validateBearerTokenResponse:pQ,validateIdToken:fQ,validateStoredUserState:hQ},Symbol.toStringTag,{value:"Module"}));if(globalThis.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");globalThis.__js_sdk_entrypoint=!0;var xA;try{xA=globalThis.indexedDB}catch{}xA&&NQ(()=>new qt(xA,"matrix-js-sdk:crypto"));globalThis.matrixcs=xbe;var qk={exports:{}},bt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EB;function Abe(){if(EB)return bt;EB=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),h=Symbol.iterator;function m(V){return V===null||typeof V!="object"?null:(V=h&&V[h]||V["@@iterator"],typeof V=="function"?V:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,v={};function w(V,X,ne){this.props=V,this.context=X,this.refs=v,this.updater=ne||g}w.prototype.isReactComponent={},w.prototype.setState=function(V,X){if(typeof V!="object"&&typeof V!="function"&&V!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,V,X,"setState")},w.prototype.forceUpdate=function(V){this.updater.enqueueForceUpdate(this,V,"forceUpdate")};function S(){}S.prototype=w.prototype;function R(V,X,ne){this.props=V,this.context=X,this.refs=v,this.updater=ne||g}var x=R.prototype=new S;x.constructor=R,y(x,w.prototype),x.isPureReactComponent=!0;var T=Array.isArray,I={H:null,A:null,T:null,S:null,V:null},k=Object.prototype.hasOwnProperty;function A(V,X,ne,fe,ye,Ae){return ne=Ae.ref,{$$typeof:t,type:V,key:X,ref:ne!==void 0?ne:null,props:Ae}}function O(V,X){return A(V.type,X,void 0,void 0,void 0,V.props)}function D(V){return typeof V=="object"&&V!==null&&V.$$typeof===t}function N(V){var X={"=":"=0",":":"=2"};return"$"+V.replace(/[=:]/g,function(ne){return X[ne]})}var U=/\/+/g;function $(V,X){return typeof V=="object"&&V!==null&&V.key!=null?N(""+V.key):X.toString(36)}function K(){}function Y(V){switch(V.status){case"fulfilled":return V.value;case"rejected":throw V.reason;default:switch(typeof V.status=="string"?V.then(K,K):(V.status="pending",V.then(function(X){V.status==="pending"&&(V.status="fulfilled",V.value=X)},function(X){V.status==="pending"&&(V.status="rejected",V.reason=X)})),V.status){case"fulfilled":return V.value;case"rejected":throw V.reason}}throw V}function G(V,X,ne,fe,ye){var Ae=typeof V;(Ae==="undefined"||Ae==="boolean")&&(V=null);var be=!1;if(V===null)be=!0;else switch(Ae){case"bigint":case"string":case"number":be=!0;break;case"object":switch(V.$$typeof){case t:case e:be=!0;break;case d:return be=V._init,G(be(V._payload),X,ne,fe,ye)}}if(be)return ye=ye(V),be=fe===""?"."+$(V,0):fe,T(ye)?(ne="",be!=null&&(ne=be.replace(U,"$&/")+"/"),G(ye,X,ne,"",function(Ue){return Ue})):ye!=null&&(D(ye)&&(ye=O(ye,ne+(ye.key==null||V&&V.key===ye.key?"":(""+ye.key).replace(U,"$&/")+"/")+be)),X.push(ye)),1;be=0;var _e=fe===""?".":fe+":";if(T(V))for(var Ie=0;Ie<V.length;Ie++)fe=V[Ie],Ae=_e+$(fe,Ie),be+=G(fe,X,ne,Ae,ye);else if(Ie=m(V),typeof Ie=="function")for(V=Ie.call(V),Ie=0;!(fe=V.next()).done;)fe=fe.value,Ae=_e+$(fe,Ie++),be+=G(fe,X,ne,Ae,ye);else if(Ae==="object"){if(typeof V.then=="function")return G(Y(V),X,ne,fe,ye);throw X=String(V),Error("Objects are not valid as a React child (found: "+(X==="[object Object]"?"object with keys {"+Object.keys(V).join(", ")+"}":X)+"). If you meant to render a collection of children, use an array instead.")}return be}function F(V,X,ne){if(V==null)return V;var fe=[],ye=0;return G(V,fe,"","",function(Ae){return X.call(ne,Ae,ye++)}),fe}function q(V){if(V._status===-1){var X=V._result;X=X(),X.then(function(ne){(V._status===0||V._status===-1)&&(V._status=1,V._result=ne)},function(ne){(V._status===0||V._status===-1)&&(V._status=2,V._result=ne)}),V._status===-1&&(V._status=0,V._result=X)}if(V._status===1)return V._result.default;throw V._result}var z=typeof reportError=="function"?reportError:function(V){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var X=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof V=="object"&&V!==null&&typeof V.message=="string"?String(V.message):String(V),error:V});if(!window.dispatchEvent(X))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",V);return}console.error(V)};function W(){}return bt.Children={map:F,forEach:function(V,X,ne){F(V,function(){X.apply(this,arguments)},ne)},count:function(V){var X=0;return F(V,function(){X++}),X},toArray:function(V){return F(V,function(X){return X})||[]},only:function(V){if(!D(V))throw Error("React.Children.only expected to receive a single React element child.");return V}},bt.Component=w,bt.Fragment=n,bt.Profiler=i,bt.PureComponent=R,bt.StrictMode=r,bt.Suspense=c,bt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,bt.__COMPILER_RUNTIME={__proto__:null,c:function(V){return I.H.useMemoCache(V)}},bt.cache=function(V){return function(){return V.apply(null,arguments)}},bt.cloneElement=function(V,X,ne){if(V==null)throw Error("The argument must be a React element, but you passed "+V+".");var fe=y({},V.props),ye=V.key,Ae=void 0;if(X!=null)for(be in X.ref!==void 0&&(Ae=void 0),X.key!==void 0&&(ye=""+X.key),X)!k.call(X,be)||be==="key"||be==="__self"||be==="__source"||be==="ref"&&X.ref===void 0||(fe[be]=X[be]);var be=arguments.length-2;if(be===1)fe.children=ne;else if(1<be){for(var _e=Array(be),Ie=0;Ie<be;Ie++)_e[Ie]=arguments[Ie+2];fe.children=_e}return A(V.type,ye,void 0,void 0,Ae,fe)},bt.createContext=function(V){return V={$$typeof:o,_currentValue:V,_currentValue2:V,_threadCount:0,Provider:null,Consumer:null},V.Provider=V,V.Consumer={$$typeof:s,_context:V},V},bt.createElement=function(V,X,ne){var fe,ye={},Ae=null;if(X!=null)for(fe in X.key!==void 0&&(Ae=""+X.key),X)k.call(X,fe)&&fe!=="key"&&fe!=="__self"&&fe!=="__source"&&(ye[fe]=X[fe]);var be=arguments.length-2;if(be===1)ye.children=ne;else if(1<be){for(var _e=Array(be),Ie=0;Ie<be;Ie++)_e[Ie]=arguments[Ie+2];ye.children=_e}if(V&&V.defaultProps)for(fe in be=V.defaultProps,be)ye[fe]===void 0&&(ye[fe]=be[fe]);return A(V,Ae,void 0,void 0,null,ye)},bt.createRef=function(){return{current:null}},bt.forwardRef=function(V){return{$$typeof:a,render:V}},bt.isValidElement=D,bt.lazy=function(V){return{$$typeof:d,_payload:{_status:-1,_result:V},_init:q}},bt.memo=function(V,X){return{$$typeof:l,type:V,compare:X===void 0?null:X}},bt.startTransition=function(V){var X=I.T,ne={};I.T=ne;try{var fe=V(),ye=I.S;ye!==null&&ye(ne,fe),typeof fe=="object"&&fe!==null&&typeof fe.then=="function"&&fe.then(W,z)}catch(Ae){z(Ae)}finally{I.T=X}},bt.unstable_useCacheRefresh=function(){return I.H.useCacheRefresh()},bt.use=function(V){return I.H.use(V)},bt.useActionState=function(V,X,ne){return I.H.useActionState(V,X,ne)},bt.useCallback=function(V,X){return I.H.useCallback(V,X)},bt.useContext=function(V){return I.H.useContext(V)},bt.useDebugValue=function(){},bt.useDeferredValue=function(V,X){return I.H.useDeferredValue(V,X)},bt.useEffect=function(V,X,ne){var fe=I.H;if(typeof ne=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return fe.useEffect(V,X)},bt.useId=function(){return I.H.useId()},bt.useImperativeHandle=function(V,X,ne){return I.H.useImperativeHandle(V,X,ne)},bt.useInsertionEffect=function(V,X){return I.H.useInsertionEffect(V,X)},bt.useLayoutEffect=function(V,X){return I.H.useLayoutEffect(V,X)},bt.useMemo=function(V,X){return I.H.useMemo(V,X)},bt.useOptimistic=function(V,X){return I.H.useOptimistic(V,X)},bt.useReducer=function(V,X,ne){return I.H.useReducer(V,X,ne)},bt.useRef=function(V){return I.H.useRef(V)},bt.useState=function(V){return I.H.useState(V)},bt.useSyncExternalStore=function(V,X,ne){return I.H.useSyncExternalStore(V,X,ne)},bt.useTransition=function(){return I.H.useTransition()},bt.version="19.1.0",bt}var wB;function u7(){return wB||(wB=1,qk.exports=Abe()),qk.exports}var _=u7();const Ce=cl(_),m_=Wge({__proto__:null,default:Ce},[_]);var Gk={exports:{}},I1={},Kk={exports:{}},zk={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CB;function Pbe(){return CB||(CB=1,function(t){function e(F,q){var z=F.length;F.push(q);e:for(;0<z;){var W=z-1>>>1,V=F[W];if(0<i(V,q))F[W]=q,F[z]=V,z=W;else break e}}function n(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var q=F[0],z=F.pop();if(z!==q){F[0]=z;e:for(var W=0,V=F.length,X=V>>>1;W<X;){var ne=2*(W+1)-1,fe=F[ne],ye=ne+1,Ae=F[ye];if(0>i(fe,z))ye<V&&0>i(Ae,fe)?(F[W]=Ae,F[ye]=z,W=ye):(F[W]=fe,F[ne]=z,W=ne);else if(ye<V&&0>i(Ae,z))F[W]=Ae,F[ye]=z,W=ye;else break e}}return q}function i(F,q){var z=F.sortIndex-q.sortIndex;return z!==0?z:F.id-q.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],d=1,h=null,m=3,g=!1,y=!1,v=!1,w=!1,S=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;function T(F){for(var q=n(l);q!==null;){if(q.callback===null)r(l);else if(q.startTime<=F)r(l),q.sortIndex=q.expirationTime,e(c,q);else break;q=n(l)}}function I(F){if(v=!1,T(F),!y)if(n(c)!==null)y=!0,k||(k=!0,$());else{var q=n(l);q!==null&&G(I,q.startTime-F)}}var k=!1,A=-1,O=5,D=-1;function N(){return w?!0:!(t.unstable_now()-D<O)}function U(){if(w=!1,k){var F=t.unstable_now();D=F;var q=!0;try{e:{y=!1,v&&(v=!1,R(A),A=-1),g=!0;var z=m;try{t:{for(T(F),h=n(c);h!==null&&!(h.expirationTime>F&&N());){var W=h.callback;if(typeof W=="function"){h.callback=null,m=h.priorityLevel;var V=W(h.expirationTime<=F);if(F=t.unstable_now(),typeof V=="function"){h.callback=V,T(F),q=!0;break t}h===n(c)&&r(c),T(F)}else r(c);h=n(c)}if(h!==null)q=!0;else{var X=n(l);X!==null&&G(I,X.startTime-F),q=!1}}break e}finally{h=null,m=z,g=!1}q=void 0}}finally{q?$():k=!1}}}var $;if(typeof x=="function")$=function(){x(U)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,Y=K.port2;K.port1.onmessage=U,$=function(){Y.postMessage(null)}}else $=function(){S(U,0)};function G(F,q){A=S(function(){F(t.unstable_now())},q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(F){F.callback=null},t.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<F?Math.floor(1e3/F):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_next=function(F){switch(m){case 1:case 2:case 3:var q=3;break;default:q=m}var z=m;m=q;try{return F()}finally{m=z}},t.unstable_requestPaint=function(){w=!0},t.unstable_runWithPriority=function(F,q){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var z=m;m=F;try{return q()}finally{m=z}},t.unstable_scheduleCallback=function(F,q,z){var W=t.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?W+z:W):z=W,F){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=z+V,F={id:d++,callback:q,priorityLevel:F,startTime:z,expirationTime:V,sortIndex:-1},z>W?(F.sortIndex=z,e(l,F),n(c)===null&&F===n(l)&&(v?(R(A),A=-1):v=!0,G(I,z-W))):(F.sortIndex=V,e(c,F),y||g||(y=!0,k||(k=!0,$()))),F},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(F){var q=m;return function(){var z=m;m=q;try{return F.apply(this,arguments)}finally{m=z}}}}(zk)),zk}var TB;function Lbe(){return TB||(TB=1,Kk.exports=Pbe()),Kk.exports}var Wk={exports:{}},Yi={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RB;function Obe(){if(RB)return Yi;RB=1;var t=u7();function e(c){var l="https://react.dev/errors/"+c;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)l+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+c+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(c,l,d){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:h==null?null:""+h,children:c,containerInfo:l,implementation:d}}var o=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(c,l){if(c==="font")return"";if(typeof l=="string")return l==="use-credentials"?l:""}return Yi.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Yi.createPortal=function(c,l){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)throw Error(e(299));return s(c,l,null,d)},Yi.flushSync=function(c){var l=o.T,d=r.p;try{if(o.T=null,r.p=2,c)return c()}finally{o.T=l,r.p=d,r.d.f()}},Yi.preconnect=function(c,l){typeof c=="string"&&(l?(l=l.crossOrigin,l=typeof l=="string"?l==="use-credentials"?l:"":void 0):l=null,r.d.C(c,l))},Yi.prefetchDNS=function(c){typeof c=="string"&&r.d.D(c)},Yi.preinit=function(c,l){if(typeof c=="string"&&l&&typeof l.as=="string"){var d=l.as,h=a(d,l.crossOrigin),m=typeof l.integrity=="string"?l.integrity:void 0,g=typeof l.fetchPriority=="string"?l.fetchPriority:void 0;d==="style"?r.d.S(c,typeof l.precedence=="string"?l.precedence:void 0,{crossOrigin:h,integrity:m,fetchPriority:g}):d==="script"&&r.d.X(c,{crossOrigin:h,integrity:m,fetchPriority:g,nonce:typeof l.nonce=="string"?l.nonce:void 0})}},Yi.preinitModule=function(c,l){if(typeof c=="string")if(typeof l=="object"&&l!==null){if(l.as==null||l.as==="script"){var d=a(l.as,l.crossOrigin);r.d.M(c,{crossOrigin:d,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0})}}else l==null&&r.d.M(c)},Yi.preload=function(c,l){if(typeof c=="string"&&typeof l=="object"&&l!==null&&typeof l.as=="string"){var d=l.as,h=a(d,l.crossOrigin);r.d.L(c,d,{crossOrigin:h,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0,type:typeof l.type=="string"?l.type:void 0,fetchPriority:typeof l.fetchPriority=="string"?l.fetchPriority:void 0,referrerPolicy:typeof l.referrerPolicy=="string"?l.referrerPolicy:void 0,imageSrcSet:typeof l.imageSrcSet=="string"?l.imageSrcSet:void 0,imageSizes:typeof l.imageSizes=="string"?l.imageSizes:void 0,media:typeof l.media=="string"?l.media:void 0})}},Yi.preloadModule=function(c,l){if(typeof c=="string")if(l){var d=a(l.as,l.crossOrigin);r.d.m(c,{as:typeof l.as=="string"&&l.as!=="script"?l.as:void 0,crossOrigin:d,integrity:typeof l.integrity=="string"?l.integrity:void 0})}else r.d.m(c)},Yi.requestFormReset=function(c){r.d.r(c)},Yi.unstable_batchedUpdates=function(c,l){return c(l)},Yi.useFormState=function(c,l,d){return o.H.useFormState(c,l,d)},Yi.useFormStatus=function(){return o.H.useHostTransitionStatus()},Yi.version="19.1.0",Yi}var IB;function FQ(){if(IB)return Wk.exports;IB=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Wk.exports=Obe(),Wk.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kB;function Mbe(){if(kB)return I1;kB=1;var t=Lbe(),e=u7(),n=FQ();function r(u){var f="https://react.dev/errors/"+u;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+u+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function s(u){var f=u,p=u;if(u.alternate)for(;f.return;)f=f.return;else{u=f;do f=u,(f.flags&4098)!==0&&(p=f.return),u=f.return;while(u)}return f.tag===3?p:null}function o(u){if(u.tag===13){var f=u.memoizedState;if(f===null&&(u=u.alternate,u!==null&&(f=u.memoizedState)),f!==null)return f.dehydrated}return null}function a(u){if(s(u)!==u)throw Error(r(188))}function c(u){var f=u.alternate;if(!f){if(f=s(u),f===null)throw Error(r(188));return f!==u?null:u}for(var p=u,b=f;;){var C=p.return;if(C===null)break;var P=C.alternate;if(P===null){if(b=C.return,b!==null){p=b;continue}break}if(C.child===P.child){for(P=C.child;P;){if(P===p)return a(C),u;if(P===b)return a(C),f;P=P.sibling}throw Error(r(188))}if(p.return!==b.return)p=C,b=P;else{for(var j=!1,H=C.child;H;){if(H===p){j=!0,p=C,b=P;break}if(H===b){j=!0,b=C,p=P;break}H=H.sibling}if(!j){for(H=P.child;H;){if(H===p){j=!0,p=P,b=C;break}if(H===b){j=!0,b=P,p=C;break}H=H.sibling}if(!j)throw Error(r(189))}}if(p.alternate!==b)throw Error(r(190))}if(p.tag!==3)throw Error(r(188));return p.stateNode.current===p?u:f}function l(u){var f=u.tag;if(f===5||f===26||f===27||f===6)return u;for(u=u.child;u!==null;){if(f=l(u),f!==null)return f;u=u.sibling}return null}var d=Object.assign,h=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),R=Symbol.for("react.consumer"),x=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),D=Symbol.for("react.activity"),N=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function $(u){return u===null||typeof u!="object"?null:(u=U&&u[U]||u["@@iterator"],typeof u=="function"?u:null)}var K=Symbol.for("react.client.reference");function Y(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===K?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case y:return"Fragment";case w:return"Profiler";case v:return"StrictMode";case I:return"Suspense";case k:return"SuspenseList";case D:return"Activity"}if(typeof u=="object")switch(u.$$typeof){case g:return"Portal";case x:return(u.displayName||"Context")+".Provider";case R:return(u._context.displayName||"Context")+".Consumer";case T:var f=u.render;return u=u.displayName,u||(u=f.displayName||f.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case A:return f=u.displayName||null,f!==null?f:Y(u.type)||"Memo";case O:f=u._payload,u=u._init;try{return Y(u(f))}catch{}}return null}var G=Array.isArray,F=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,z={pending:!1,data:null,method:null,action:null},W=[],V=-1;function X(u){return{current:u}}function ne(u){0>V||(u.current=W[V],W[V]=null,V--)}function fe(u,f){V++,W[V]=u.current,u.current=f}var ye=X(null),Ae=X(null),be=X(null),_e=X(null);function Ie(u,f){switch(fe(be,f),fe(Ae,u),fe(ye,null),f.nodeType){case 9:case 11:u=(u=f.documentElement)&&(u=u.namespaceURI)?Jj(u):0;break;default:if(u=f.tagName,f=f.namespaceURI)f=Jj(f),u=Qj(f,u);else switch(u){case"svg":u=1;break;case"math":u=2;break;default:u=0}}ne(ye),fe(ye,u)}function Ue(){ne(ye),ne(Ae),ne(be)}function et(u){u.memoizedState!==null&&fe(_e,u);var f=ye.current,p=Qj(f,u.type);f!==p&&(fe(Ae,u),fe(ye,p))}function ln(u){Ae.current===u&&(ne(ye),ne(Ae)),_e.current===u&&(ne(_e),a1._currentValue=z)}var Bn=Object.prototype.hasOwnProperty,Mn=t.unstable_scheduleCallback,tt=t.unstable_cancelCallback,Aa=t.unstable_shouldYield,bl=t.unstable_requestPaint,Dn=t.unstable_now,m0=t.unstable_getCurrentPriorityLevel,Hp=t.unstable_ImmediatePriority,Pa=t.unstable_UserBlockingPriority,Is=t.unstable_NormalPriority,g0=t.unstable_LowPriority,Do=t.unstable_IdlePriority,v0=t.log,Vp=t.unstable_setDisableYieldValue,mc=null,ui=null;function di(u){if(typeof v0=="function"&&Vp(u),ui&&typeof ui.setStrictMode=="function")try{ui.setStrictMode(mc,u)}catch{}}var xi=Math.clz32?Math.clz32:gc,Gf=Math.log,Ju=Math.LN2;function gc(u){return u>>>=0,u===0?32:31-(Gf(u)/Ju|0)|0}var vc=256,_l=4194304;function ks(u){var f=u&42;if(f!==0)return f;switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return u&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return u}}function yc(u,f,p){var b=u.pendingLanes;if(b===0)return 0;var C=0,P=u.suspendedLanes,j=u.pingedLanes;u=u.warmLanes;var H=b&134217727;return H!==0?(b=H&~P,b!==0?C=ks(b):(j&=H,j!==0?C=ks(j):p||(p=H&~u,p!==0&&(C=ks(p))))):(H=b&~P,H!==0?C=ks(H):j!==0?C=ks(j):p||(p=b&~u,p!==0&&(C=ks(p)))),C===0?0:f!==0&&f!==C&&(f&P)===0&&(P=C&-C,p=f&-f,P>=p||P===32&&(p&4194048)!==0)?f:C}function Sl(u,f){return(u.pendingLanes&~(u.suspendedLanes&~u.pingedLanes)&f)===0}function y0(u,f){switch(u){case 1:case 2:case 4:case 8:case 64:return f+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Je(){var u=vc;return vc<<=1,(vc&4194048)===0&&(vc=256),u}function Et(){var u=_l;return _l<<=1,(_l&62914560)===0&&(_l=4194304),u}function Vt(u){for(var f=[],p=0;31>p;p++)f.push(u);return f}function wt(u,f){u.pendingLanes|=f,f!==268435456&&(u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0)}function Hn(u,f,p,b,C,P){var j=u.pendingLanes;u.pendingLanes=p,u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0,u.expiredLanes&=p,u.entangledLanes&=p,u.errorRecoveryDisabledLanes&=p,u.shellSuspendCounter=0;var H=u.entanglements,Q=u.expirationTimes,ie=u.hiddenUpdates;for(p=j&~p;0<p;){var me=31-xi(p),ve=1<<me;H[me]=0,Q[me]=-1;var ae=ie[me];if(ae!==null)for(ie[me]=null,me=0;me<ae.length;me++){var le=ae[me];le!==null&&(le.lane&=-536870913)}p&=~ve}b!==0&&Gr(u,b,0),P!==0&&C===0&&u.tag!==0&&(u.suspendedLanes|=P&~(j&~f))}function Gr(u,f,p){u.pendingLanes|=f,u.suspendedLanes&=~f;var b=31-xi(f);u.entangledLanes|=f,u.entanglements[b]=u.entanglements[b]|1073741824|p&4194090}function Or(u,f){var p=u.entangledLanes|=f;for(u=u.entanglements;p;){var b=31-xi(p),C=1<<b;C&f|u[b]&f&&(u[b]|=f),p&=~C}}function Kr(u){switch(u){case 2:u=1;break;case 8:u=4;break;case 32:u=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:u=128;break;case 268435456:u=134217728;break;default:u=0}return u}function Ai(u){return u&=-u,2<u?8<u?(u&134217727)!==0?32:268435456:8:2}function qe(){var u=q.p;return u!==0?u:(u=window.event,u===void 0?32:vF(u.type))}function Wt(u,f){var p=q.p;try{return q.p=u,f()}finally{q.p=p}}var Dt=Math.random().toString(36).slice(2),yn="__reactFiber$"+Dt,dr="__reactProps$"+Dt,La="__reactContainer$"+Dt,Kf="__reactEvents$"+Dt,l4="__reactListeners$"+Dt,u4="__reactHandles$"+Dt,cS="__reactResources$"+Dt,zf="__reactMarker$"+Dt;function d4(u){delete u[yn],delete u[dr],delete u[Kf],delete u[l4],delete u[u4]}function qp(u){var f=u[yn];if(f)return f;for(var p=u.parentNode;p;){if(f=p[La]||p[yn]){if(p=f.alternate,f.child!==null||p!==null&&p.child!==null)for(u=nF(u);u!==null;){if(p=u[yn])return p;u=nF(u)}return f}u=p,p=u.parentNode}return null}function Gp(u){if(u=u[yn]||u[La]){var f=u.tag;if(f===5||f===6||f===13||f===26||f===27||f===3)return u}return null}function b0(u){var f=u.tag;if(f===5||f===26||f===27||f===6)return u.stateNode;throw Error(r(33))}function Kp(u){var f=u[cS];return f||(f=u[cS]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function fi(u){u[zf]=!0}var $D=new Set,BD={};function Wf(u,f){zp(u,f),zp(u+"Capture",f)}function zp(u,f){for(BD[u]=f,u=0;u<f.length;u++)$D.add(f[u])}var $pe=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),HD={},VD={};function Bpe(u){return Bn.call(VD,u)?!0:Bn.call(HD,u)?!1:$pe.test(u)?VD[u]=!0:(HD[u]=!0,!1)}function lS(u,f,p){if(Bpe(f))if(p===null)u.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":u.removeAttribute(f);return;case"boolean":var b=f.toLowerCase().slice(0,5);if(b!=="data-"&&b!=="aria-"){u.removeAttribute(f);return}}u.setAttribute(f,""+p)}}function uS(u,f,p){if(p===null)u.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(f);return}u.setAttribute(f,""+p)}}function El(u,f,p,b){if(b===null)u.removeAttribute(p);else{switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(p);return}u.setAttributeNS(f,p,""+b)}}var f4,qD;function Wp(u){if(f4===void 0)try{throw Error()}catch(p){var f=p.stack.trim().match(/\n( *(at )?)/);f4=f&&f[1]||"",qD=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+f4+u+qD}var h4=!1;function p4(u,f){if(!u||h4)return"";h4=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var b={DetermineComponentFrameRoot:function(){try{if(f){var ve=function(){throw Error()};if(Object.defineProperty(ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ve,[])}catch(le){var ae=le}Reflect.construct(u,[],ve)}else{try{ve.call()}catch(le){ae=le}u.call(ve.prototype)}}else{try{throw Error()}catch(le){ae=le}(ve=u())&&typeof ve.catch=="function"&&ve.catch(function(){})}}catch(le){if(le&&ae&&typeof le.stack=="string")return[le.stack,ae.stack]}return[null,null]}};b.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var C=Object.getOwnPropertyDescriptor(b.DetermineComponentFrameRoot,"name");C&&C.configurable&&Object.defineProperty(b.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var P=b.DetermineComponentFrameRoot(),j=P[0],H=P[1];if(j&&H){var Q=j.split(`
`),ie=H.split(`
`);for(C=b=0;b<Q.length&&!Q[b].includes("DetermineComponentFrameRoot");)b++;for(;C<ie.length&&!ie[C].includes("DetermineComponentFrameRoot");)C++;if(b===Q.length||C===ie.length)for(b=Q.length-1,C=ie.length-1;1<=b&&0<=C&&Q[b]!==ie[C];)C--;for(;1<=b&&0<=C;b--,C--)if(Q[b]!==ie[C]){if(b!==1||C!==1)do if(b--,C--,0>C||Q[b]!==ie[C]){var me=`
`+Q[b].replace(" at new "," at ");return u.displayName&&me.includes("<anonymous>")&&(me=me.replace("<anonymous>",u.displayName)),me}while(1<=b&&0<=C);break}}}finally{h4=!1,Error.prepareStackTrace=p}return(p=u?u.displayName||u.name:"")?Wp(p):""}function Hpe(u){switch(u.tag){case 26:case 27:case 5:return Wp(u.type);case 16:return Wp("Lazy");case 13:return Wp("Suspense");case 19:return Wp("SuspenseList");case 0:case 15:return p4(u.type,!1);case 11:return p4(u.type.render,!1);case 1:return p4(u.type,!0);case 31:return Wp("Activity");default:return""}}function GD(u){try{var f="";do f+=Hpe(u),u=u.return;while(u);return f}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}function No(u){switch(typeof u){case"bigint":case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function KD(u){var f=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function Vpe(u){var f=KD(u)?"checked":"value",p=Object.getOwnPropertyDescriptor(u.constructor.prototype,f),b=""+u[f];if(!u.hasOwnProperty(f)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var C=p.get,P=p.set;return Object.defineProperty(u,f,{configurable:!0,get:function(){return C.call(this)},set:function(j){b=""+j,P.call(this,j)}}),Object.defineProperty(u,f,{enumerable:p.enumerable}),{getValue:function(){return b},setValue:function(j){b=""+j},stopTracking:function(){u._valueTracker=null,delete u[f]}}}}function dS(u){u._valueTracker||(u._valueTracker=Vpe(u))}function zD(u){if(!u)return!1;var f=u._valueTracker;if(!f)return!0;var p=f.getValue(),b="";return u&&(b=KD(u)?u.checked?"true":"false":u.value),u=b,u!==p?(f.setValue(u),!0):!1}function fS(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}var qpe=/[\n"\\]/g;function Uo(u){return u.replace(qpe,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function m4(u,f,p,b,C,P,j,H){u.name="",j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?u.type=j:u.removeAttribute("type"),f!=null?j==="number"?(f===0&&u.value===""||u.value!=f)&&(u.value=""+No(f)):u.value!==""+No(f)&&(u.value=""+No(f)):j!=="submit"&&j!=="reset"||u.removeAttribute("value"),f!=null?g4(u,j,No(f)):p!=null?g4(u,j,No(p)):b!=null&&u.removeAttribute("value"),C==null&&P!=null&&(u.defaultChecked=!!P),C!=null&&(u.checked=C&&typeof C!="function"&&typeof C!="symbol"),H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"?u.name=""+No(H):u.removeAttribute("name")}function WD(u,f,p,b,C,P,j,H){if(P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(u.type=P),f!=null||p!=null){if(!(P!=="submit"&&P!=="reset"||f!=null))return;p=p!=null?""+No(p):"",f=f!=null?""+No(f):p,H||f===u.value||(u.value=f),u.defaultValue=f}b=b??C,b=typeof b!="function"&&typeof b!="symbol"&&!!b,u.checked=H?u.checked:!!b,u.defaultChecked=!!b,j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"&&(u.name=j)}function g4(u,f,p){f==="number"&&fS(u.ownerDocument)===u||u.defaultValue===""+p||(u.defaultValue=""+p)}function Yp(u,f,p,b){if(u=u.options,f){f={};for(var C=0;C<p.length;C++)f["$"+p[C]]=!0;for(p=0;p<u.length;p++)C=f.hasOwnProperty("$"+u[p].value),u[p].selected!==C&&(u[p].selected=C),C&&b&&(u[p].defaultSelected=!0)}else{for(p=""+No(p),f=null,C=0;C<u.length;C++){if(u[C].value===p){u[C].selected=!0,b&&(u[C].defaultSelected=!0);return}f!==null||u[C].disabled||(f=u[C])}f!==null&&(f.selected=!0)}}function YD(u,f,p){if(f!=null&&(f=""+No(f),f!==u.value&&(u.value=f),p==null)){u.defaultValue!==f&&(u.defaultValue=f);return}u.defaultValue=p!=null?""+No(p):""}function XD(u,f,p,b){if(f==null){if(b!=null){if(p!=null)throw Error(r(92));if(G(b)){if(1<b.length)throw Error(r(93));b=b[0]}p=b}p==null&&(p=""),f=p}p=No(f),u.defaultValue=p,b=u.textContent,b===p&&b!==""&&b!==null&&(u.value=b)}function Xp(u,f){if(f){var p=u.firstChild;if(p&&p===u.lastChild&&p.nodeType===3){p.nodeValue=f;return}}u.textContent=f}var Gpe=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function JD(u,f,p){var b=f.indexOf("--")===0;p==null||typeof p=="boolean"||p===""?b?u.setProperty(f,""):f==="float"?u.cssFloat="":u[f]="":b?u.setProperty(f,p):typeof p!="number"||p===0||Gpe.has(f)?f==="float"?u.cssFloat=p:u[f]=(""+p).trim():u[f]=p+"px"}function QD(u,f,p){if(f!=null&&typeof f!="object")throw Error(r(62));if(u=u.style,p!=null){for(var b in p)!p.hasOwnProperty(b)||f!=null&&f.hasOwnProperty(b)||(b.indexOf("--")===0?u.setProperty(b,""):b==="float"?u.cssFloat="":u[b]="");for(var C in f)b=f[C],f.hasOwnProperty(C)&&p[C]!==b&&JD(u,C,b)}else for(var P in f)f.hasOwnProperty(P)&&JD(u,P,f[P])}function v4(u){if(u.indexOf("-")===-1)return!1;switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kpe=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),zpe=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function hS(u){return zpe.test(""+u)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":u}var y4=null;function b4(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var Jp=null,Qp=null;function ZD(u){var f=Gp(u);if(f&&(u=f.stateNode)){var p=u[dr]||null;e:switch(u=f.stateNode,f.type){case"input":if(m4(u,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),f=p.name,p.type==="radio"&&f!=null){for(p=u;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll('input[name="'+Uo(""+f)+'"][type="radio"]'),f=0;f<p.length;f++){var b=p[f];if(b!==u&&b.form===u.form){var C=b[dr]||null;if(!C)throw Error(r(90));m4(b,C.value,C.defaultValue,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name)}}for(f=0;f<p.length;f++)b=p[f],b.form===u.form&&zD(b)}break e;case"textarea":YD(u,p.value,p.defaultValue);break e;case"select":f=p.value,f!=null&&Yp(u,!!p.multiple,f,!1)}}}var _4=!1;function eN(u,f,p){if(_4)return u(f,p);_4=!0;try{var b=u(f);return b}finally{if(_4=!1,(Jp!==null||Qp!==null)&&(QS(),Jp&&(f=Jp,u=Qp,Qp=Jp=null,ZD(f),u)))for(f=0;f<u.length;f++)ZD(u[f])}}function _0(u,f){var p=u.stateNode;if(p===null)return null;var b=p[dr]||null;if(b===null)return null;p=b[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(u=u.type,b=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!b;break e;default:u=!1}if(u)return null;if(p&&typeof p!="function")throw Error(r(231,f,typeof p));return p}var wl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),S4=!1;if(wl)try{var S0={};Object.defineProperty(S0,"passive",{get:function(){S4=!0}}),window.addEventListener("test",S0,S0),window.removeEventListener("test",S0,S0)}catch{S4=!1}var Qu=null,E4=null,pS=null;function tN(){if(pS)return pS;var u,f=E4,p=f.length,b,C="value"in Qu?Qu.value:Qu.textContent,P=C.length;for(u=0;u<p&&f[u]===C[u];u++);var j=p-u;for(b=1;b<=j&&f[p-b]===C[P-b];b++);return pS=C.slice(u,1<b?1-b:void 0)}function mS(u){var f=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&f===13&&(u=13)):u=f,u===10&&(u=13),32<=u||u===13?u:0}function gS(){return!0}function nN(){return!1}function xs(u){function f(p,b,C,P,j){this._reactName=p,this._targetInst=C,this.type=b,this.nativeEvent=P,this.target=j,this.currentTarget=null;for(var H in u)u.hasOwnProperty(H)&&(p=u[H],this[H]=p?p(P):P[H]);return this.isDefaultPrevented=(P.defaultPrevented!=null?P.defaultPrevented:P.returnValue===!1)?gS:nN,this.isPropagationStopped=nN,this}return d(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=gS)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=gS)},persist:function(){},isPersistent:gS}),f}var Yf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vS=xs(Yf),E0=d({},Yf,{view:0,detail:0}),Wpe=xs(E0),w4,C4,w0,yS=d({},E0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:R4,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==w0&&(w0&&u.type==="mousemove"?(w4=u.screenX-w0.screenX,C4=u.screenY-w0.screenY):C4=w4=0,w0=u),w4)},movementY:function(u){return"movementY"in u?u.movementY:C4}}),rN=xs(yS),Ype=d({},yS,{dataTransfer:0}),Xpe=xs(Ype),Jpe=d({},E0,{relatedTarget:0}),T4=xs(Jpe),Qpe=d({},Yf,{animationName:0,elapsedTime:0,pseudoElement:0}),Zpe=xs(Qpe),eme=d({},Yf,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),tme=xs(eme),nme=d({},Yf,{data:0}),iN=xs(nme),rme={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ime={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sme={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ome(u){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(u):(u=sme[u])?!!f[u]:!1}function R4(){return ome}var ame=d({},E0,{key:function(u){if(u.key){var f=rme[u.key]||u.key;if(f!=="Unidentified")return f}return u.type==="keypress"?(u=mS(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?ime[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:R4,charCode:function(u){return u.type==="keypress"?mS(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?mS(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),cme=xs(ame),lme=d({},yS,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sN=xs(lme),ume=d({},E0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:R4}),dme=xs(ume),fme=d({},Yf,{propertyName:0,elapsedTime:0,pseudoElement:0}),hme=xs(fme),pme=d({},yS,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),mme=xs(pme),gme=d({},Yf,{newState:0,oldState:0}),vme=xs(gme),yme=[9,13,27,32],I4=wl&&"CompositionEvent"in window,C0=null;wl&&"documentMode"in document&&(C0=document.documentMode);var bme=wl&&"TextEvent"in window&&!C0,oN=wl&&(!I4||C0&&8<C0&&11>=C0),aN=" ",cN=!1;function lN(u,f){switch(u){case"keyup":return yme.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function uN(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var Zp=!1;function _me(u,f){switch(u){case"compositionend":return uN(f);case"keypress":return f.which!==32?null:(cN=!0,aN);case"textInput":return u=f.data,u===aN&&cN?null:u;default:return null}}function Sme(u,f){if(Zp)return u==="compositionend"||!I4&&lN(u,f)?(u=tN(),pS=E4=Qu=null,Zp=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return oN&&f.locale!=="ko"?null:f.data;default:return null}}var Eme={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function dN(u){var f=u&&u.nodeName&&u.nodeName.toLowerCase();return f==="input"?!!Eme[u.type]:f==="textarea"}function fN(u,f,p,b){Jp?Qp?Qp.push(b):Qp=[b]:Jp=b,f=i2(f,"onChange"),0<f.length&&(p=new vS("onChange","change",null,p,b),u.push({event:p,listeners:f}))}var T0=null,R0=null;function wme(u){Kj(u,0)}function bS(u){var f=b0(u);if(zD(f))return u}function hN(u,f){if(u==="change")return f}var pN=!1;if(wl){var k4;if(wl){var x4="oninput"in document;if(!x4){var mN=document.createElement("div");mN.setAttribute("oninput","return;"),x4=typeof mN.oninput=="function"}k4=x4}else k4=!1;pN=k4&&(!document.documentMode||9<document.documentMode)}function gN(){T0&&(T0.detachEvent("onpropertychange",vN),R0=T0=null)}function vN(u){if(u.propertyName==="value"&&bS(R0)){var f=[];fN(f,R0,u,b4(u)),eN(wme,f)}}function Cme(u,f,p){u==="focusin"?(gN(),T0=f,R0=p,T0.attachEvent("onpropertychange",vN)):u==="focusout"&&gN()}function Tme(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return bS(R0)}function Rme(u,f){if(u==="click")return bS(f)}function Ime(u,f){if(u==="input"||u==="change")return bS(f)}function kme(u,f){return u===f&&(u!==0||1/u===1/f)||u!==u&&f!==f}var io=typeof Object.is=="function"?Object.is:kme;function I0(u,f){if(io(u,f))return!0;if(typeof u!="object"||u===null||typeof f!="object"||f===null)return!1;var p=Object.keys(u),b=Object.keys(f);if(p.length!==b.length)return!1;for(b=0;b<p.length;b++){var C=p[b];if(!Bn.call(f,C)||!io(u[C],f[C]))return!1}return!0}function yN(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function bN(u,f){var p=yN(u);u=0;for(var b;p;){if(p.nodeType===3){if(b=u+p.textContent.length,u<=f&&b>=f)return{node:p,offset:f-u};u=b}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=yN(p)}}function _N(u,f){return u&&f?u===f?!0:u&&u.nodeType===3?!1:f&&f.nodeType===3?_N(u,f.parentNode):"contains"in u?u.contains(f):u.compareDocumentPosition?!!(u.compareDocumentPosition(f)&16):!1:!1}function SN(u){u=u!=null&&u.ownerDocument!=null&&u.ownerDocument.defaultView!=null?u.ownerDocument.defaultView:window;for(var f=fS(u.document);f instanceof u.HTMLIFrameElement;){try{var p=typeof f.contentWindow.location.href=="string"}catch{p=!1}if(p)u=f.contentWindow;else break;f=fS(u.document)}return f}function A4(u){var f=u&&u.nodeName&&u.nodeName.toLowerCase();return f&&(f==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||f==="textarea"||u.contentEditable==="true")}var xme=wl&&"documentMode"in document&&11>=document.documentMode,em=null,P4=null,k0=null,L4=!1;function EN(u,f,p){var b=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;L4||em==null||em!==fS(b)||(b=em,"selectionStart"in b&&A4(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),k0&&I0(k0,b)||(k0=b,b=i2(P4,"onSelect"),0<b.length&&(f=new vS("onSelect","select",null,f,p),u.push({event:f,listeners:b}),f.target=em)))}function Xf(u,f){var p={};return p[u.toLowerCase()]=f.toLowerCase(),p["Webkit"+u]="webkit"+f,p["Moz"+u]="moz"+f,p}var tm={animationend:Xf("Animation","AnimationEnd"),animationiteration:Xf("Animation","AnimationIteration"),animationstart:Xf("Animation","AnimationStart"),transitionrun:Xf("Transition","TransitionRun"),transitionstart:Xf("Transition","TransitionStart"),transitioncancel:Xf("Transition","TransitionCancel"),transitionend:Xf("Transition","TransitionEnd")},O4={},wN={};wl&&(wN=document.createElement("div").style,"AnimationEvent"in window||(delete tm.animationend.animation,delete tm.animationiteration.animation,delete tm.animationstart.animation),"TransitionEvent"in window||delete tm.transitionend.transition);function Jf(u){if(O4[u])return O4[u];if(!tm[u])return u;var f=tm[u],p;for(p in f)if(f.hasOwnProperty(p)&&p in wN)return O4[u]=f[p];return u}var CN=Jf("animationend"),TN=Jf("animationiteration"),RN=Jf("animationstart"),Ame=Jf("transitionrun"),Pme=Jf("transitionstart"),Lme=Jf("transitioncancel"),IN=Jf("transitionend"),kN=new Map,M4="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");M4.push("scrollEnd");function Oa(u,f){kN.set(u,f),Wf(f,[u])}var xN=new WeakMap;function jo(u,f){if(typeof u=="object"&&u!==null){var p=xN.get(u);return p!==void 0?p:(f={value:u,source:f,stack:GD(f)},xN.set(u,f),f)}return{value:u,source:f,stack:GD(f)}}var Fo=[],nm=0,D4=0;function _S(){for(var u=nm,f=D4=nm=0;f<u;){var p=Fo[f];Fo[f++]=null;var b=Fo[f];Fo[f++]=null;var C=Fo[f];Fo[f++]=null;var P=Fo[f];if(Fo[f++]=null,b!==null&&C!==null){var j=b.pending;j===null?C.next=C:(C.next=j.next,j.next=C),b.pending=C}P!==0&&AN(p,C,P)}}function SS(u,f,p,b){Fo[nm++]=u,Fo[nm++]=f,Fo[nm++]=p,Fo[nm++]=b,D4|=b,u.lanes|=b,u=u.alternate,u!==null&&(u.lanes|=b)}function N4(u,f,p,b){return SS(u,f,p,b),ES(u)}function rm(u,f){return SS(u,null,null,f),ES(u)}function AN(u,f,p){u.lanes|=p;var b=u.alternate;b!==null&&(b.lanes|=p);for(var C=!1,P=u.return;P!==null;)P.childLanes|=p,b=P.alternate,b!==null&&(b.childLanes|=p),P.tag===22&&(u=P.stateNode,u===null||u._visibility&1||(C=!0)),u=P,P=P.return;return u.tag===3?(P=u.stateNode,C&&f!==null&&(C=31-xi(p),u=P.hiddenUpdates,b=u[C],b===null?u[C]=[f]:b.push(f),f.lane=p|536870912),P):null}function ES(u){if(50<Z0)throw Z0=0,HI=null,Error(r(185));for(var f=u.return;f!==null;)u=f,f=u.return;return u.tag===3?u.stateNode:null}var im={};function Ome(u,f,p,b){this.tag=u,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function so(u,f,p,b){return new Ome(u,f,p,b)}function U4(u){return u=u.prototype,!(!u||!u.isReactComponent)}function Cl(u,f){var p=u.alternate;return p===null?(p=so(u.tag,f,u.key,u.mode),p.elementType=u.elementType,p.type=u.type,p.stateNode=u.stateNode,p.alternate=u,u.alternate=p):(p.pendingProps=f,p.type=u.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=u.flags&65011712,p.childLanes=u.childLanes,p.lanes=u.lanes,p.child=u.child,p.memoizedProps=u.memoizedProps,p.memoizedState=u.memoizedState,p.updateQueue=u.updateQueue,f=u.dependencies,p.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},p.sibling=u.sibling,p.index=u.index,p.ref=u.ref,p.refCleanup=u.refCleanup,p}function PN(u,f){u.flags&=65011714;var p=u.alternate;return p===null?(u.childLanes=0,u.lanes=f,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=p.childLanes,u.lanes=p.lanes,u.child=p.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=p.memoizedProps,u.memoizedState=p.memoizedState,u.updateQueue=p.updateQueue,u.type=p.type,f=p.dependencies,u.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),u}function wS(u,f,p,b,C,P){var j=0;if(b=u,typeof u=="function")U4(u)&&(j=1);else if(typeof u=="string")j=Dge(u,p,ye.current)?26:u==="html"||u==="head"||u==="body"?27:5;else e:switch(u){case D:return u=so(31,p,f,C),u.elementType=D,u.lanes=P,u;case y:return Qf(p.children,C,P,f);case v:j=8,C|=24;break;case w:return u=so(12,p,f,C|2),u.elementType=w,u.lanes=P,u;case I:return u=so(13,p,f,C),u.elementType=I,u.lanes=P,u;case k:return u=so(19,p,f,C),u.elementType=k,u.lanes=P,u;default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case S:case x:j=10;break e;case R:j=9;break e;case T:j=11;break e;case A:j=14;break e;case O:j=16,b=null;break e}j=29,p=Error(r(130,u===null?"null":typeof u,"")),b=null}return f=so(j,p,f,C),f.elementType=u,f.type=b,f.lanes=P,f}function Qf(u,f,p,b){return u=so(7,u,b,f),u.lanes=p,u}function j4(u,f,p){return u=so(6,u,null,f),u.lanes=p,u}function F4(u,f,p){return f=so(4,u.children!==null?u.children:[],u.key,f),f.lanes=p,f.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},f}var sm=[],om=0,CS=null,TS=0,$o=[],Bo=0,Zf=null,Tl=1,Rl="";function eh(u,f){sm[om++]=TS,sm[om++]=CS,CS=u,TS=f}function LN(u,f,p){$o[Bo++]=Tl,$o[Bo++]=Rl,$o[Bo++]=Zf,Zf=u;var b=Tl;u=Rl;var C=32-xi(b)-1;b&=~(1<<C),p+=1;var P=32-xi(f)+C;if(30<P){var j=C-C%5;P=(b&(1<<j)-1).toString(32),b>>=j,C-=j,Tl=1<<32-xi(f)+C|p<<C|b,Rl=P+u}else Tl=1<<P|p<<C|b,Rl=u}function $4(u){u.return!==null&&(eh(u,1),LN(u,1,0))}function B4(u){for(;u===CS;)CS=sm[--om],sm[om]=null,TS=sm[--om],sm[om]=null;for(;u===Zf;)Zf=$o[--Bo],$o[Bo]=null,Rl=$o[--Bo],$o[Bo]=null,Tl=$o[--Bo],$o[Bo]=null}var is=null,fr=null,rn=!1,th=null,bc=!1,H4=Error(r(519));function nh(u){var f=Error(r(418,""));throw P0(jo(f,u)),H4}function ON(u){var f=u.stateNode,p=u.type,b=u.memoizedProps;switch(f[yn]=u,f[dr]=b,p){case"dialog":Pt("cancel",f),Pt("close",f);break;case"iframe":case"object":case"embed":Pt("load",f);break;case"video":case"audio":for(p=0;p<t1.length;p++)Pt(t1[p],f);break;case"source":Pt("error",f);break;case"img":case"image":case"link":Pt("error",f),Pt("load",f);break;case"details":Pt("toggle",f);break;case"input":Pt("invalid",f),WD(f,b.value,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name,!0),dS(f);break;case"select":Pt("invalid",f);break;case"textarea":Pt("invalid",f),XD(f,b.value,b.defaultValue,b.children),dS(f)}p=b.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||f.textContent===""+p||b.suppressHydrationWarning===!0||Xj(f.textContent,p)?(b.popover!=null&&(Pt("beforetoggle",f),Pt("toggle",f)),b.onScroll!=null&&Pt("scroll",f),b.onScrollEnd!=null&&Pt("scrollend",f),b.onClick!=null&&(f.onclick=s2),f=!0):f=!1,f||nh(u)}function MN(u){for(is=u.return;is;)switch(is.tag){case 5:case 13:bc=!1;return;case 27:case 3:bc=!0;return;default:is=is.return}}function x0(u){if(u!==is)return!1;if(!rn)return MN(u),rn=!0,!1;var f=u.tag,p;if((p=f!==3&&f!==27)&&((p=f===5)&&(p=u.type,p=!(p!=="form"&&p!=="button")||ik(u.type,u.memoizedProps)),p=!p),p&&fr&&nh(u),MN(u),f===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(r(317));e:{for(u=u.nextSibling,f=0;u;){if(u.nodeType===8)if(p=u.data,p==="/$"){if(f===0){fr=Da(u.nextSibling);break e}f--}else p!=="$"&&p!=="$!"&&p!=="$?"||f++;u=u.nextSibling}fr=null}}else f===27?(f=fr,pd(u.type)?(u=ck,ck=null,fr=u):fr=f):fr=is?Da(u.stateNode.nextSibling):null;return!0}function A0(){fr=is=null,rn=!1}function DN(){var u=th;return u!==null&&(Ls===null?Ls=u:Ls.push.apply(Ls,u),th=null),u}function P0(u){th===null?th=[u]:th.push(u)}var V4=X(null),rh=null,Il=null;function Zu(u,f,p){fe(V4,f._currentValue),f._currentValue=p}function kl(u){u._currentValue=V4.current,ne(V4)}function q4(u,f,p){for(;u!==null;){var b=u.alternate;if((u.childLanes&f)!==f?(u.childLanes|=f,b!==null&&(b.childLanes|=f)):b!==null&&(b.childLanes&f)!==f&&(b.childLanes|=f),u===p)break;u=u.return}}function G4(u,f,p,b){var C=u.child;for(C!==null&&(C.return=u);C!==null;){var P=C.dependencies;if(P!==null){var j=C.child;P=P.firstContext;e:for(;P!==null;){var H=P;P=C;for(var Q=0;Q<f.length;Q++)if(H.context===f[Q]){P.lanes|=p,H=P.alternate,H!==null&&(H.lanes|=p),q4(P.return,p,u),b||(j=null);break e}P=H.next}}else if(C.tag===18){if(j=C.return,j===null)throw Error(r(341));j.lanes|=p,P=j.alternate,P!==null&&(P.lanes|=p),q4(j,p,u),j=null}else j=C.child;if(j!==null)j.return=C;else for(j=C;j!==null;){if(j===u){j=null;break}if(C=j.sibling,C!==null){C.return=j.return,j=C;break}j=j.return}C=j}}function L0(u,f,p,b){u=null;for(var C=f,P=!1;C!==null;){if(!P){if((C.flags&524288)!==0)P=!0;else if((C.flags&262144)!==0)break}if(C.tag===10){var j=C.alternate;if(j===null)throw Error(r(387));if(j=j.memoizedProps,j!==null){var H=C.type;io(C.pendingProps.value,j.value)||(u!==null?u.push(H):u=[H])}}else if(C===_e.current){if(j=C.alternate,j===null)throw Error(r(387));j.memoizedState.memoizedState!==C.memoizedState.memoizedState&&(u!==null?u.push(a1):u=[a1])}C=C.return}u!==null&&G4(f,u,p,b),f.flags|=262144}function RS(u){for(u=u.firstContext;u!==null;){if(!io(u.context._currentValue,u.memoizedValue))return!0;u=u.next}return!1}function ih(u){rh=u,Il=null,u=u.dependencies,u!==null&&(u.firstContext=null)}function Wi(u){return NN(rh,u)}function IS(u,f){return rh===null&&ih(u),NN(u,f)}function NN(u,f){var p=f._currentValue;if(f={context:f,memoizedValue:p,next:null},Il===null){if(u===null)throw Error(r(308));Il=f,u.dependencies={lanes:0,firstContext:f},u.flags|=524288}else Il=Il.next=f;return p}var Mme=typeof AbortController<"u"?AbortController:function(){var u=[],f=this.signal={aborted:!1,addEventListener:function(p,b){u.push(b)}};this.abort=function(){f.aborted=!0,u.forEach(function(p){return p()})}},Dme=t.unstable_scheduleCallback,Nme=t.unstable_NormalPriority,zr={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function K4(){return{controller:new Mme,data:new Map,refCount:0}}function O0(u){u.refCount--,u.refCount===0&&Dme(Nme,function(){u.controller.abort()})}var M0=null,z4=0,am=0,cm=null;function Ume(u,f){if(M0===null){var p=M0=[];z4=0,am=YI(),cm={status:"pending",value:void 0,then:function(b){p.push(b)}}}return z4++,f.then(UN,UN),f}function UN(){if(--z4===0&&M0!==null){cm!==null&&(cm.status="fulfilled");var u=M0;M0=null,am=0,cm=null;for(var f=0;f<u.length;f++)(0,u[f])()}}function jme(u,f){var p=[],b={status:"pending",value:null,reason:null,then:function(C){p.push(C)}};return u.then(function(){b.status="fulfilled",b.value=f;for(var C=0;C<p.length;C++)(0,p[C])(f)},function(C){for(b.status="rejected",b.reason=C,C=0;C<p.length;C++)(0,p[C])(void 0)}),b}var jN=F.S;F.S=function(u,f){typeof f=="object"&&f!==null&&typeof f.then=="function"&&Ume(u,f),jN!==null&&jN(u,f)};var sh=X(null);function W4(){var u=sh.current;return u!==null?u:Nn.pooledCache}function kS(u,f){f===null?fe(sh,sh.current):fe(sh,f.pool)}function FN(){var u=W4();return u===null?null:{parent:zr._currentValue,pool:u}}var D0=Error(r(460)),$N=Error(r(474)),xS=Error(r(542)),Y4={then:function(){}};function BN(u){return u=u.status,u==="fulfilled"||u==="rejected"}function AS(){}function HN(u,f,p){switch(p=u[p],p===void 0?u.push(f):p!==f&&(f.then(AS,AS),f=p),f.status){case"fulfilled":return f.value;case"rejected":throw u=f.reason,qN(u),u;default:if(typeof f.status=="string")f.then(AS,AS);else{if(u=Nn,u!==null&&100<u.shellSuspendCounter)throw Error(r(482));u=f,u.status="pending",u.then(function(b){if(f.status==="pending"){var C=f;C.status="fulfilled",C.value=b}},function(b){if(f.status==="pending"){var C=f;C.status="rejected",C.reason=b}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw u=f.reason,qN(u),u}throw N0=f,D0}}var N0=null;function VN(){if(N0===null)throw Error(r(459));var u=N0;return N0=null,u}function qN(u){if(u===D0||u===xS)throw Error(r(483))}var ed=!1;function X4(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function J4(u,f){u=u.updateQueue,f.updateQueue===u&&(f.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,callbacks:null})}function td(u){return{lane:u,tag:0,payload:null,callback:null,next:null}}function nd(u,f,p){var b=u.updateQueue;if(b===null)return null;if(b=b.shared,(pn&2)!==0){var C=b.pending;return C===null?f.next=f:(f.next=C.next,C.next=f),b.pending=f,f=ES(u),AN(u,null,p),f}return SS(u,b,f,p),ES(u)}function U0(u,f,p){if(f=f.updateQueue,f!==null&&(f=f.shared,(p&4194048)!==0)){var b=f.lanes;b&=u.pendingLanes,p|=b,f.lanes=p,Or(u,p)}}function Q4(u,f){var p=u.updateQueue,b=u.alternate;if(b!==null&&(b=b.updateQueue,p===b)){var C=null,P=null;if(p=p.firstBaseUpdate,p!==null){do{var j={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};P===null?C=P=j:P=P.next=j,p=p.next}while(p!==null);P===null?C=P=f:P=P.next=f}else C=P=f;p={baseState:b.baseState,firstBaseUpdate:C,lastBaseUpdate:P,shared:b.shared,callbacks:b.callbacks},u.updateQueue=p;return}u=p.lastBaseUpdate,u===null?p.firstBaseUpdate=f:u.next=f,p.lastBaseUpdate=f}var Z4=!1;function j0(){if(Z4){var u=cm;if(u!==null)throw u}}function F0(u,f,p,b){Z4=!1;var C=u.updateQueue;ed=!1;var P=C.firstBaseUpdate,j=C.lastBaseUpdate,H=C.shared.pending;if(H!==null){C.shared.pending=null;var Q=H,ie=Q.next;Q.next=null,j===null?P=ie:j.next=ie,j=Q;var me=u.alternate;me!==null&&(me=me.updateQueue,H=me.lastBaseUpdate,H!==j&&(H===null?me.firstBaseUpdate=ie:H.next=ie,me.lastBaseUpdate=Q))}if(P!==null){var ve=C.baseState;j=0,me=ie=Q=null,H=P;do{var ae=H.lane&-536870913,le=ae!==H.lane;if(le?(Ht&ae)===ae:(b&ae)===ae){ae!==0&&ae===am&&(Z4=!0),me!==null&&(me=me.next={lane:0,tag:H.tag,payload:H.payload,callback:null,next:null});e:{var ct=u,nt=H;ae=f;var Sn=p;switch(nt.tag){case 1:if(ct=nt.payload,typeof ct=="function"){ve=ct.call(Sn,ve,ae);break e}ve=ct;break e;case 3:ct.flags=ct.flags&-65537|128;case 0:if(ct=nt.payload,ae=typeof ct=="function"?ct.call(Sn,ve,ae):ct,ae==null)break e;ve=d({},ve,ae);break e;case 2:ed=!0}}ae=H.callback,ae!==null&&(u.flags|=64,le&&(u.flags|=8192),le=C.callbacks,le===null?C.callbacks=[ae]:le.push(ae))}else le={lane:ae,tag:H.tag,payload:H.payload,callback:H.callback,next:null},me===null?(ie=me=le,Q=ve):me=me.next=le,j|=ae;if(H=H.next,H===null){if(H=C.shared.pending,H===null)break;le=H,H=le.next,le.next=null,C.lastBaseUpdate=le,C.shared.pending=null}}while(!0);me===null&&(Q=ve),C.baseState=Q,C.firstBaseUpdate=ie,C.lastBaseUpdate=me,P===null&&(C.shared.lanes=0),ud|=j,u.lanes=j,u.memoizedState=ve}}function GN(u,f){if(typeof u!="function")throw Error(r(191,u));u.call(f)}function KN(u,f){var p=u.callbacks;if(p!==null)for(u.callbacks=null,u=0;u<p.length;u++)GN(p[u],f)}var lm=X(null),PS=X(0);function zN(u,f){u=Dl,fe(PS,u),fe(lm,f),Dl=u|f.baseLanes}function eI(){fe(PS,Dl),fe(lm,lm.current)}function tI(){Dl=PS.current,ne(lm),ne(PS)}var rd=0,Rt=null,bn=null,Mr=null,LS=!1,um=!1,oh=!1,OS=0,$0=0,dm=null,Fme=0;function wr(){throw Error(r(321))}function nI(u,f){if(f===null)return!1;for(var p=0;p<f.length&&p<u.length;p++)if(!io(u[p],f[p]))return!1;return!0}function rI(u,f,p,b,C,P){return rd=P,Rt=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,F.H=u===null||u.memoizedState===null?AU:PU,oh=!1,P=p(b,C),oh=!1,um&&(P=YN(f,p,b,C)),WN(u),P}function WN(u){F.H=FS;var f=bn!==null&&bn.next!==null;if(rd=0,Mr=bn=Rt=null,LS=!1,$0=0,dm=null,f)throw Error(r(300));u===null||hi||(u=u.dependencies,u!==null&&RS(u)&&(hi=!0))}function YN(u,f,p,b){Rt=u;var C=0;do{if(um&&(dm=null),$0=0,um=!1,25<=C)throw Error(r(301));if(C+=1,Mr=bn=null,u.updateQueue!=null){var P=u.updateQueue;P.lastEffect=null,P.events=null,P.stores=null,P.memoCache!=null&&(P.memoCache.index=0)}F.H=Kme,P=f(p,b)}while(um);return P}function $me(){var u=F.H,f=u.useState()[0];return f=typeof f.then=="function"?B0(f):f,u=u.useState()[0],(bn!==null?bn.memoizedState:null)!==u&&(Rt.flags|=1024),f}function iI(){var u=OS!==0;return OS=0,u}function sI(u,f,p){f.updateQueue=u.updateQueue,f.flags&=-2053,u.lanes&=~p}function oI(u){if(LS){for(u=u.memoizedState;u!==null;){var f=u.queue;f!==null&&(f.pending=null),u=u.next}LS=!1}rd=0,Mr=bn=Rt=null,um=!1,$0=OS=0,dm=null}function As(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mr===null?Rt.memoizedState=Mr=u:Mr=Mr.next=u,Mr}function Dr(){if(bn===null){var u=Rt.alternate;u=u!==null?u.memoizedState:null}else u=bn.next;var f=Mr===null?Rt.memoizedState:Mr.next;if(f!==null)Mr=f,bn=u;else{if(u===null)throw Rt.alternate===null?Error(r(467)):Error(r(310));bn=u,u={memoizedState:bn.memoizedState,baseState:bn.baseState,baseQueue:bn.baseQueue,queue:bn.queue,next:null},Mr===null?Rt.memoizedState=Mr=u:Mr=Mr.next=u}return Mr}function aI(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function B0(u){var f=$0;return $0+=1,dm===null&&(dm=[]),u=HN(dm,u,f),f=Rt,(Mr===null?f.memoizedState:Mr.next)===null&&(f=f.alternate,F.H=f===null||f.memoizedState===null?AU:PU),u}function MS(u){if(u!==null&&typeof u=="object"){if(typeof u.then=="function")return B0(u);if(u.$$typeof===x)return Wi(u)}throw Error(r(438,String(u)))}function cI(u){var f=null,p=Rt.updateQueue;if(p!==null&&(f=p.memoCache),f==null){var b=Rt.alternate;b!==null&&(b=b.updateQueue,b!==null&&(b=b.memoCache,b!=null&&(f={data:b.data.map(function(C){return C.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),p===null&&(p=aI(),Rt.updateQueue=p),p.memoCache=f,p=f.data[f.index],p===void 0)for(p=f.data[f.index]=Array(u),b=0;b<u;b++)p[b]=N;return f.index++,p}function xl(u,f){return typeof f=="function"?f(u):f}function DS(u){var f=Dr();return lI(f,bn,u)}function lI(u,f,p){var b=u.queue;if(b===null)throw Error(r(311));b.lastRenderedReducer=p;var C=u.baseQueue,P=b.pending;if(P!==null){if(C!==null){var j=C.next;C.next=P.next,P.next=j}f.baseQueue=C=P,b.pending=null}if(P=u.baseState,C===null)u.memoizedState=P;else{f=C.next;var H=j=null,Q=null,ie=f,me=!1;do{var ve=ie.lane&-536870913;if(ve!==ie.lane?(Ht&ve)===ve:(rd&ve)===ve){var ae=ie.revertLane;if(ae===0)Q!==null&&(Q=Q.next={lane:0,revertLane:0,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null}),ve===am&&(me=!0);else if((rd&ae)===ae){ie=ie.next,ae===am&&(me=!0);continue}else ve={lane:0,revertLane:ie.revertLane,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},Q===null?(H=Q=ve,j=P):Q=Q.next=ve,Rt.lanes|=ae,ud|=ae;ve=ie.action,oh&&p(P,ve),P=ie.hasEagerState?ie.eagerState:p(P,ve)}else ae={lane:ve,revertLane:ie.revertLane,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},Q===null?(H=Q=ae,j=P):Q=Q.next=ae,Rt.lanes|=ve,ud|=ve;ie=ie.next}while(ie!==null&&ie!==f);if(Q===null?j=P:Q.next=H,!io(P,u.memoizedState)&&(hi=!0,me&&(p=cm,p!==null)))throw p;u.memoizedState=P,u.baseState=j,u.baseQueue=Q,b.lastRenderedState=P}return C===null&&(b.lanes=0),[u.memoizedState,b.dispatch]}function uI(u){var f=Dr(),p=f.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=u;var b=p.dispatch,C=p.pending,P=f.memoizedState;if(C!==null){p.pending=null;var j=C=C.next;do P=u(P,j.action),j=j.next;while(j!==C);io(P,f.memoizedState)||(hi=!0),f.memoizedState=P,f.baseQueue===null&&(f.baseState=P),p.lastRenderedState=P}return[P,b]}function XN(u,f,p){var b=Rt,C=Dr(),P=rn;if(P){if(p===void 0)throw Error(r(407));p=p()}else p=f();var j=!io((bn||C).memoizedState,p);j&&(C.memoizedState=p,hi=!0),C=C.queue;var H=ZN.bind(null,b,C,u);if(H0(2048,8,H,[u]),C.getSnapshot!==f||j||Mr!==null&&Mr.memoizedState.tag&1){if(b.flags|=2048,fm(9,NS(),QN.bind(null,b,C,p,f),null),Nn===null)throw Error(r(349));P||(rd&124)!==0||JN(b,f,p)}return p}function JN(u,f,p){u.flags|=16384,u={getSnapshot:f,value:p},f=Rt.updateQueue,f===null?(f=aI(),Rt.updateQueue=f,f.stores=[u]):(p=f.stores,p===null?f.stores=[u]:p.push(u))}function QN(u,f,p,b){f.value=p,f.getSnapshot=b,eU(f)&&tU(u)}function ZN(u,f,p){return p(function(){eU(f)&&tU(u)})}function eU(u){var f=u.getSnapshot;u=u.value;try{var p=f();return!io(u,p)}catch{return!0}}function tU(u){var f=rm(u,2);f!==null&&uo(f,u,2)}function dI(u){var f=As();if(typeof u=="function"){var p=u;if(u=p(),oh){di(!0);try{p()}finally{di(!1)}}}return f.memoizedState=f.baseState=u,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xl,lastRenderedState:u},f}function nU(u,f,p,b){return u.baseState=p,lI(u,bn,typeof b=="function"?b:xl)}function Bme(u,f,p,b,C){if(jS(u))throw Error(r(485));if(u=f.action,u!==null){var P={payload:C,action:u,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(j){P.listeners.push(j)}};F.T!==null?p(!0):P.isTransition=!1,b(P),p=f.pending,p===null?(P.next=f.pending=P,rU(f,P)):(P.next=p.next,f.pending=p.next=P)}}function rU(u,f){var p=f.action,b=f.payload,C=u.state;if(f.isTransition){var P=F.T,j={};F.T=j;try{var H=p(C,b),Q=F.S;Q!==null&&Q(j,H),iU(u,f,H)}catch(ie){fI(u,f,ie)}finally{F.T=P}}else try{P=p(C,b),iU(u,f,P)}catch(ie){fI(u,f,ie)}}function iU(u,f,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?p.then(function(b){sU(u,f,b)},function(b){return fI(u,f,b)}):sU(u,f,p)}function sU(u,f,p){f.status="fulfilled",f.value=p,oU(f),u.state=p,f=u.pending,f!==null&&(p=f.next,p===f?u.pending=null:(p=p.next,f.next=p,rU(u,p)))}function fI(u,f,p){var b=u.pending;if(u.pending=null,b!==null){b=b.next;do f.status="rejected",f.reason=p,oU(f),f=f.next;while(f!==b)}u.action=null}function oU(u){u=u.listeners;for(var f=0;f<u.length;f++)(0,u[f])()}function aU(u,f){return f}function cU(u,f){if(rn){var p=Nn.formState;if(p!==null){e:{var b=Rt;if(rn){if(fr){t:{for(var C=fr,P=bc;C.nodeType!==8;){if(!P){C=null;break t}if(C=Da(C.nextSibling),C===null){C=null;break t}}P=C.data,C=P==="F!"||P==="F"?C:null}if(C){fr=Da(C.nextSibling),b=C.data==="F!";break e}}nh(b)}b=!1}b&&(f=p[0])}}return p=As(),p.memoizedState=p.baseState=f,b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:aU,lastRenderedState:f},p.queue=b,p=IU.bind(null,Rt,b),b.dispatch=p,b=dI(!1),P=vI.bind(null,Rt,!1,b.queue),b=As(),C={state:f,dispatch:null,action:u,pending:null},b.queue=C,p=Bme.bind(null,Rt,C,P,p),C.dispatch=p,b.memoizedState=u,[f,p,!1]}function lU(u){var f=Dr();return uU(f,bn,u)}function uU(u,f,p){if(f=lI(u,f,aU)[0],u=DS(xl)[0],typeof f=="object"&&f!==null&&typeof f.then=="function")try{var b=B0(f)}catch(j){throw j===D0?xS:j}else b=f;f=Dr();var C=f.queue,P=C.dispatch;return p!==f.memoizedState&&(Rt.flags|=2048,fm(9,NS(),Hme.bind(null,C,p),null)),[b,P,u]}function Hme(u,f){u.action=f}function dU(u){var f=Dr(),p=bn;if(p!==null)return uU(f,p,u);Dr(),f=f.memoizedState,p=Dr();var b=p.queue.dispatch;return p.memoizedState=u,[f,b,!1]}function fm(u,f,p,b){return u={tag:u,create:p,deps:b,inst:f,next:null},f=Rt.updateQueue,f===null&&(f=aI(),Rt.updateQueue=f),p=f.lastEffect,p===null?f.lastEffect=u.next=u:(b=p.next,p.next=u,u.next=b,f.lastEffect=u),u}function NS(){return{destroy:void 0,resource:void 0}}function fU(){return Dr().memoizedState}function US(u,f,p,b){var C=As();b=b===void 0?null:b,Rt.flags|=u,C.memoizedState=fm(1|f,NS(),p,b)}function H0(u,f,p,b){var C=Dr();b=b===void 0?null:b;var P=C.memoizedState.inst;bn!==null&&b!==null&&nI(b,bn.memoizedState.deps)?C.memoizedState=fm(f,P,p,b):(Rt.flags|=u,C.memoizedState=fm(1|f,P,p,b))}function hU(u,f){US(8390656,8,u,f)}function pU(u,f){H0(2048,8,u,f)}function mU(u,f){return H0(4,2,u,f)}function gU(u,f){return H0(4,4,u,f)}function vU(u,f){if(typeof f=="function"){u=u();var p=f(u);return function(){typeof p=="function"?p():f(null)}}if(f!=null)return u=u(),f.current=u,function(){f.current=null}}function yU(u,f,p){p=p!=null?p.concat([u]):null,H0(4,4,vU.bind(null,f,u),p)}function hI(){}function bU(u,f){var p=Dr();f=f===void 0?null:f;var b=p.memoizedState;return f!==null&&nI(f,b[1])?b[0]:(p.memoizedState=[u,f],u)}function _U(u,f){var p=Dr();f=f===void 0?null:f;var b=p.memoizedState;if(f!==null&&nI(f,b[1]))return b[0];if(b=u(),oh){di(!0);try{u()}finally{di(!1)}}return p.memoizedState=[b,f],b}function pI(u,f,p){return p===void 0||(rd&1073741824)!==0?u.memoizedState=f:(u.memoizedState=p,u=wj(),Rt.lanes|=u,ud|=u,p)}function SU(u,f,p,b){return io(p,f)?p:lm.current!==null?(u=pI(u,p,b),io(u,f)||(hi=!0),u):(rd&42)===0?(hi=!0,u.memoizedState=p):(u=wj(),Rt.lanes|=u,ud|=u,f)}function EU(u,f,p,b,C){var P=q.p;q.p=P!==0&&8>P?P:8;var j=F.T,H={};F.T=H,vI(u,!1,f,p);try{var Q=C(),ie=F.S;if(ie!==null&&ie(H,Q),Q!==null&&typeof Q=="object"&&typeof Q.then=="function"){var me=jme(Q,b);V0(u,f,me,lo(u))}else V0(u,f,b,lo(u))}catch(ve){V0(u,f,{then:function(){},status:"rejected",reason:ve},lo())}finally{q.p=P,F.T=j}}function Vme(){}function mI(u,f,p,b){if(u.tag!==5)throw Error(r(476));var C=wU(u).queue;EU(u,C,f,z,p===null?Vme:function(){return CU(u),p(b)})}function wU(u){var f=u.memoizedState;if(f!==null)return f;f={memoizedState:z,baseState:z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xl,lastRenderedState:z},next:null};var p={};return f.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xl,lastRenderedState:p},next:null},u.memoizedState=f,u=u.alternate,u!==null&&(u.memoizedState=f),f}function CU(u){var f=wU(u).next.queue;V0(u,f,{},lo())}function gI(){return Wi(a1)}function TU(){return Dr().memoizedState}function RU(){return Dr().memoizedState}function qme(u){for(var f=u.return;f!==null;){switch(f.tag){case 24:case 3:var p=lo();u=td(p);var b=nd(f,u,p);b!==null&&(uo(b,f,p),U0(b,f,p)),f={cache:K4()},u.payload=f;return}f=f.return}}function Gme(u,f,p){var b=lo();p={lane:b,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null},jS(u)?kU(f,p):(p=N4(u,f,p,b),p!==null&&(uo(p,u,b),xU(p,f,b)))}function IU(u,f,p){var b=lo();V0(u,f,p,b)}function V0(u,f,p,b){var C={lane:b,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null};if(jS(u))kU(f,C);else{var P=u.alternate;if(u.lanes===0&&(P===null||P.lanes===0)&&(P=f.lastRenderedReducer,P!==null))try{var j=f.lastRenderedState,H=P(j,p);if(C.hasEagerState=!0,C.eagerState=H,io(H,j))return SS(u,f,C,0),Nn===null&&_S(),!1}catch{}finally{}if(p=N4(u,f,C,b),p!==null)return uo(p,u,b),xU(p,f,b),!0}return!1}function vI(u,f,p,b){if(b={lane:2,revertLane:YI(),action:b,hasEagerState:!1,eagerState:null,next:null},jS(u)){if(f)throw Error(r(479))}else f=N4(u,p,b,2),f!==null&&uo(f,u,2)}function jS(u){var f=u.alternate;return u===Rt||f!==null&&f===Rt}function kU(u,f){um=LS=!0;var p=u.pending;p===null?f.next=f:(f.next=p.next,p.next=f),u.pending=f}function xU(u,f,p){if((p&4194048)!==0){var b=f.lanes;b&=u.pendingLanes,p|=b,f.lanes=p,Or(u,p)}}var FS={readContext:Wi,use:MS,useCallback:wr,useContext:wr,useEffect:wr,useImperativeHandle:wr,useLayoutEffect:wr,useInsertionEffect:wr,useMemo:wr,useReducer:wr,useRef:wr,useState:wr,useDebugValue:wr,useDeferredValue:wr,useTransition:wr,useSyncExternalStore:wr,useId:wr,useHostTransitionStatus:wr,useFormState:wr,useActionState:wr,useOptimistic:wr,useMemoCache:wr,useCacheRefresh:wr},AU={readContext:Wi,use:MS,useCallback:function(u,f){return As().memoizedState=[u,f===void 0?null:f],u},useContext:Wi,useEffect:hU,useImperativeHandle:function(u,f,p){p=p!=null?p.concat([u]):null,US(4194308,4,vU.bind(null,f,u),p)},useLayoutEffect:function(u,f){return US(4194308,4,u,f)},useInsertionEffect:function(u,f){US(4,2,u,f)},useMemo:function(u,f){var p=As();f=f===void 0?null:f;var b=u();if(oh){di(!0);try{u()}finally{di(!1)}}return p.memoizedState=[b,f],b},useReducer:function(u,f,p){var b=As();if(p!==void 0){var C=p(f);if(oh){di(!0);try{p(f)}finally{di(!1)}}}else C=f;return b.memoizedState=b.baseState=C,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:C},b.queue=u,u=u.dispatch=Gme.bind(null,Rt,u),[b.memoizedState,u]},useRef:function(u){var f=As();return u={current:u},f.memoizedState=u},useState:function(u){u=dI(u);var f=u.queue,p=IU.bind(null,Rt,f);return f.dispatch=p,[u.memoizedState,p]},useDebugValue:hI,useDeferredValue:function(u,f){var p=As();return pI(p,u,f)},useTransition:function(){var u=dI(!1);return u=EU.bind(null,Rt,u.queue,!0,!1),As().memoizedState=u,[!1,u]},useSyncExternalStore:function(u,f,p){var b=Rt,C=As();if(rn){if(p===void 0)throw Error(r(407));p=p()}else{if(p=f(),Nn===null)throw Error(r(349));(Ht&124)!==0||JN(b,f,p)}C.memoizedState=p;var P={value:p,getSnapshot:f};return C.queue=P,hU(ZN.bind(null,b,P,u),[u]),b.flags|=2048,fm(9,NS(),QN.bind(null,b,P,p,f),null),p},useId:function(){var u=As(),f=Nn.identifierPrefix;if(rn){var p=Rl,b=Tl;p=(b&~(1<<32-xi(b)-1)).toString(32)+p,f="«"+f+"R"+p,p=OS++,0<p&&(f+="H"+p.toString(32)),f+="»"}else p=Fme++,f="«"+f+"r"+p.toString(32)+"»";return u.memoizedState=f},useHostTransitionStatus:gI,useFormState:cU,useActionState:cU,useOptimistic:function(u){var f=As();f.memoizedState=f.baseState=u;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=p,f=vI.bind(null,Rt,!0,p),p.dispatch=f,[u,f]},useMemoCache:cI,useCacheRefresh:function(){return As().memoizedState=qme.bind(null,Rt)}},PU={readContext:Wi,use:MS,useCallback:bU,useContext:Wi,useEffect:pU,useImperativeHandle:yU,useInsertionEffect:mU,useLayoutEffect:gU,useMemo:_U,useReducer:DS,useRef:fU,useState:function(){return DS(xl)},useDebugValue:hI,useDeferredValue:function(u,f){var p=Dr();return SU(p,bn.memoizedState,u,f)},useTransition:function(){var u=DS(xl)[0],f=Dr().memoizedState;return[typeof u=="boolean"?u:B0(u),f]},useSyncExternalStore:XN,useId:TU,useHostTransitionStatus:gI,useFormState:lU,useActionState:lU,useOptimistic:function(u,f){var p=Dr();return nU(p,bn,u,f)},useMemoCache:cI,useCacheRefresh:RU},Kme={readContext:Wi,use:MS,useCallback:bU,useContext:Wi,useEffect:pU,useImperativeHandle:yU,useInsertionEffect:mU,useLayoutEffect:gU,useMemo:_U,useReducer:uI,useRef:fU,useState:function(){return uI(xl)},useDebugValue:hI,useDeferredValue:function(u,f){var p=Dr();return bn===null?pI(p,u,f):SU(p,bn.memoizedState,u,f)},useTransition:function(){var u=uI(xl)[0],f=Dr().memoizedState;return[typeof u=="boolean"?u:B0(u),f]},useSyncExternalStore:XN,useId:TU,useHostTransitionStatus:gI,useFormState:dU,useActionState:dU,useOptimistic:function(u,f){var p=Dr();return bn!==null?nU(p,bn,u,f):(p.baseState=u,[u,p.queue.dispatch])},useMemoCache:cI,useCacheRefresh:RU},hm=null,q0=0;function $S(u){var f=q0;return q0+=1,hm===null&&(hm=[]),HN(hm,u,f)}function G0(u,f){f=f.props.ref,u.ref=f!==void 0?f:null}function BS(u,f){throw f.$$typeof===h?Error(r(525)):(u=Object.prototype.toString.call(f),Error(r(31,u==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":u)))}function LU(u){var f=u._init;return f(u._payload)}function OU(u){function f(te,ee){if(u){var re=te.deletions;re===null?(te.deletions=[ee],te.flags|=16):re.push(ee)}}function p(te,ee){if(!u)return null;for(;ee!==null;)f(te,ee),ee=ee.sibling;return null}function b(te){for(var ee=new Map;te!==null;)te.key!==null?ee.set(te.key,te):ee.set(te.index,te),te=te.sibling;return ee}function C(te,ee){return te=Cl(te,ee),te.index=0,te.sibling=null,te}function P(te,ee,re){return te.index=re,u?(re=te.alternate,re!==null?(re=re.index,re<ee?(te.flags|=67108866,ee):re):(te.flags|=67108866,ee)):(te.flags|=1048576,ee)}function j(te){return u&&te.alternate===null&&(te.flags|=67108866),te}function H(te,ee,re,ge){return ee===null||ee.tag!==6?(ee=j4(re,te.mode,ge),ee.return=te,ee):(ee=C(ee,re),ee.return=te,ee)}function Q(te,ee,re,ge){var Fe=re.type;return Fe===y?me(te,ee,re.props.children,ge,re.key):ee!==null&&(ee.elementType===Fe||typeof Fe=="object"&&Fe!==null&&Fe.$$typeof===O&&LU(Fe)===ee.type)?(ee=C(ee,re.props),G0(ee,re),ee.return=te,ee):(ee=wS(re.type,re.key,re.props,null,te.mode,ge),G0(ee,re),ee.return=te,ee)}function ie(te,ee,re,ge){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==re.containerInfo||ee.stateNode.implementation!==re.implementation?(ee=F4(re,te.mode,ge),ee.return=te,ee):(ee=C(ee,re.children||[]),ee.return=te,ee)}function me(te,ee,re,ge,Fe){return ee===null||ee.tag!==7?(ee=Qf(re,te.mode,ge,Fe),ee.return=te,ee):(ee=C(ee,re),ee.return=te,ee)}function ve(te,ee,re){if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return ee=j4(""+ee,te.mode,re),ee.return=te,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case m:return re=wS(ee.type,ee.key,ee.props,null,te.mode,re),G0(re,ee),re.return=te,re;case g:return ee=F4(ee,te.mode,re),ee.return=te,ee;case O:var ge=ee._init;return ee=ge(ee._payload),ve(te,ee,re)}if(G(ee)||$(ee))return ee=Qf(ee,te.mode,re,null),ee.return=te,ee;if(typeof ee.then=="function")return ve(te,$S(ee),re);if(ee.$$typeof===x)return ve(te,IS(te,ee),re);BS(te,ee)}return null}function ae(te,ee,re,ge){var Fe=ee!==null?ee.key:null;if(typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint")return Fe!==null?null:H(te,ee,""+re,ge);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case m:return re.key===Fe?Q(te,ee,re,ge):null;case g:return re.key===Fe?ie(te,ee,re,ge):null;case O:return Fe=re._init,re=Fe(re._payload),ae(te,ee,re,ge)}if(G(re)||$(re))return Fe!==null?null:me(te,ee,re,ge,null);if(typeof re.then=="function")return ae(te,ee,$S(re),ge);if(re.$$typeof===x)return ae(te,ee,IS(te,re),ge);BS(te,re)}return null}function le(te,ee,re,ge,Fe){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return te=te.get(re)||null,H(ee,te,""+ge,Fe);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case m:return te=te.get(ge.key===null?re:ge.key)||null,Q(ee,te,ge,Fe);case g:return te=te.get(ge.key===null?re:ge.key)||null,ie(ee,te,ge,Fe);case O:var kt=ge._init;return ge=kt(ge._payload),le(te,ee,re,ge,Fe)}if(G(ge)||$(ge))return te=te.get(re)||null,me(ee,te,ge,Fe,null);if(typeof ge.then=="function")return le(te,ee,re,$S(ge),Fe);if(ge.$$typeof===x)return le(te,ee,re,IS(ee,ge),Fe);BS(ee,ge)}return null}function ct(te,ee,re,ge){for(var Fe=null,kt=null,Ge=ee,it=ee=0,mi=null;Ge!==null&&it<re.length;it++){Ge.index>it?(mi=Ge,Ge=null):mi=Ge.sibling;var Yt=ae(te,Ge,re[it],ge);if(Yt===null){Ge===null&&(Ge=mi);break}u&&Ge&&Yt.alternate===null&&f(te,Ge),ee=P(Yt,ee,it),kt===null?Fe=Yt:kt.sibling=Yt,kt=Yt,Ge=mi}if(it===re.length)return p(te,Ge),rn&&eh(te,it),Fe;if(Ge===null){for(;it<re.length;it++)Ge=ve(te,re[it],ge),Ge!==null&&(ee=P(Ge,ee,it),kt===null?Fe=Ge:kt.sibling=Ge,kt=Ge);return rn&&eh(te,it),Fe}for(Ge=b(Ge);it<re.length;it++)mi=le(Ge,te,it,re[it],ge),mi!==null&&(u&&mi.alternate!==null&&Ge.delete(mi.key===null?it:mi.key),ee=P(mi,ee,it),kt===null?Fe=mi:kt.sibling=mi,kt=mi);return u&&Ge.forEach(function(bd){return f(te,bd)}),rn&&eh(te,it),Fe}function nt(te,ee,re,ge){if(re==null)throw Error(r(151));for(var Fe=null,kt=null,Ge=ee,it=ee=0,mi=null,Yt=re.next();Ge!==null&&!Yt.done;it++,Yt=re.next()){Ge.index>it?(mi=Ge,Ge=null):mi=Ge.sibling;var bd=ae(te,Ge,Yt.value,ge);if(bd===null){Ge===null&&(Ge=mi);break}u&&Ge&&bd.alternate===null&&f(te,Ge),ee=P(bd,ee,it),kt===null?Fe=bd:kt.sibling=bd,kt=bd,Ge=mi}if(Yt.done)return p(te,Ge),rn&&eh(te,it),Fe;if(Ge===null){for(;!Yt.done;it++,Yt=re.next())Yt=ve(te,Yt.value,ge),Yt!==null&&(ee=P(Yt,ee,it),kt===null?Fe=Yt:kt.sibling=Yt,kt=Yt);return rn&&eh(te,it),Fe}for(Ge=b(Ge);!Yt.done;it++,Yt=re.next())Yt=le(Ge,te,it,Yt.value,ge),Yt!==null&&(u&&Yt.alternate!==null&&Ge.delete(Yt.key===null?it:Yt.key),ee=P(Yt,ee,it),kt===null?Fe=Yt:kt.sibling=Yt,kt=Yt);return u&&Ge.forEach(function(zge){return f(te,zge)}),rn&&eh(te,it),Fe}function Sn(te,ee,re,ge){if(typeof re=="object"&&re!==null&&re.type===y&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case m:e:{for(var Fe=re.key;ee!==null;){if(ee.key===Fe){if(Fe=re.type,Fe===y){if(ee.tag===7){p(te,ee.sibling),ge=C(ee,re.props.children),ge.return=te,te=ge;break e}}else if(ee.elementType===Fe||typeof Fe=="object"&&Fe!==null&&Fe.$$typeof===O&&LU(Fe)===ee.type){p(te,ee.sibling),ge=C(ee,re.props),G0(ge,re),ge.return=te,te=ge;break e}p(te,ee);break}else f(te,ee);ee=ee.sibling}re.type===y?(ge=Qf(re.props.children,te.mode,ge,re.key),ge.return=te,te=ge):(ge=wS(re.type,re.key,re.props,null,te.mode,ge),G0(ge,re),ge.return=te,te=ge)}return j(te);case g:e:{for(Fe=re.key;ee!==null;){if(ee.key===Fe)if(ee.tag===4&&ee.stateNode.containerInfo===re.containerInfo&&ee.stateNode.implementation===re.implementation){p(te,ee.sibling),ge=C(ee,re.children||[]),ge.return=te,te=ge;break e}else{p(te,ee);break}else f(te,ee);ee=ee.sibling}ge=F4(re,te.mode,ge),ge.return=te,te=ge}return j(te);case O:return Fe=re._init,re=Fe(re._payload),Sn(te,ee,re,ge)}if(G(re))return ct(te,ee,re,ge);if($(re)){if(Fe=$(re),typeof Fe!="function")throw Error(r(150));return re=Fe.call(re),nt(te,ee,re,ge)}if(typeof re.then=="function")return Sn(te,ee,$S(re),ge);if(re.$$typeof===x)return Sn(te,ee,IS(te,re),ge);BS(te,re)}return typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint"?(re=""+re,ee!==null&&ee.tag===6?(p(te,ee.sibling),ge=C(ee,re),ge.return=te,te=ge):(p(te,ee),ge=j4(re,te.mode,ge),ge.return=te,te=ge),j(te)):p(te,ee)}return function(te,ee,re,ge){try{q0=0;var Fe=Sn(te,ee,re,ge);return hm=null,Fe}catch(Ge){if(Ge===D0||Ge===xS)throw Ge;var kt=so(29,Ge,null,te.mode);return kt.lanes=ge,kt.return=te,kt}finally{}}}var pm=OU(!0),MU=OU(!1),Ho=X(null),_c=null;function id(u){var f=u.alternate;fe(Wr,Wr.current&1),fe(Ho,u),_c===null&&(f===null||lm.current!==null||f.memoizedState!==null)&&(_c=u)}function DU(u){if(u.tag===22){if(fe(Wr,Wr.current),fe(Ho,u),_c===null){var f=u.alternate;f!==null&&f.memoizedState!==null&&(_c=u)}}else sd()}function sd(){fe(Wr,Wr.current),fe(Ho,Ho.current)}function Al(u){ne(Ho),_c===u&&(_c=null),ne(Wr)}var Wr=X(0);function HS(u){for(var f=u;f!==null;){if(f.tag===13){var p=f.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||p.data==="$?"||ak(p)))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===u)break;for(;f.sibling===null;){if(f.return===null||f.return===u)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}function yI(u,f,p,b){f=u.memoizedState,p=p(b,f),p=p==null?f:d({},f,p),u.memoizedState=p,u.lanes===0&&(u.updateQueue.baseState=p)}var bI={enqueueSetState:function(u,f,p){u=u._reactInternals;var b=lo(),C=td(b);C.payload=f,p!=null&&(C.callback=p),f=nd(u,C,b),f!==null&&(uo(f,u,b),U0(f,u,b))},enqueueReplaceState:function(u,f,p){u=u._reactInternals;var b=lo(),C=td(b);C.tag=1,C.payload=f,p!=null&&(C.callback=p),f=nd(u,C,b),f!==null&&(uo(f,u,b),U0(f,u,b))},enqueueForceUpdate:function(u,f){u=u._reactInternals;var p=lo(),b=td(p);b.tag=2,f!=null&&(b.callback=f),f=nd(u,b,p),f!==null&&(uo(f,u,p),U0(f,u,p))}};function NU(u,f,p,b,C,P,j){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(b,P,j):f.prototype&&f.prototype.isPureReactComponent?!I0(p,b)||!I0(C,P):!0}function UU(u,f,p,b){u=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(p,b),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(p,b),f.state!==u&&bI.enqueueReplaceState(f,f.state,null)}function ah(u,f){var p=f;if("ref"in f){p={};for(var b in f)b!=="ref"&&(p[b]=f[b])}if(u=u.defaultProps){p===f&&(p=d({},p));for(var C in u)p[C]===void 0&&(p[C]=u[C])}return p}var VS=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)};function jU(u){VS(u)}function FU(u){console.error(u)}function $U(u){VS(u)}function qS(u,f){try{var p=u.onUncaughtError;p(f.value,{componentStack:f.stack})}catch(b){setTimeout(function(){throw b})}}function BU(u,f,p){try{var b=u.onCaughtError;b(p.value,{componentStack:p.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(C){setTimeout(function(){throw C})}}function _I(u,f,p){return p=td(p),p.tag=3,p.payload={element:null},p.callback=function(){qS(u,f)},p}function HU(u){return u=td(u),u.tag=3,u}function VU(u,f,p,b){var C=p.type.getDerivedStateFromError;if(typeof C=="function"){var P=b.value;u.payload=function(){return C(P)},u.callback=function(){BU(f,p,b)}}var j=p.stateNode;j!==null&&typeof j.componentDidCatch=="function"&&(u.callback=function(){BU(f,p,b),typeof C!="function"&&(dd===null?dd=new Set([this]):dd.add(this));var H=b.stack;this.componentDidCatch(b.value,{componentStack:H!==null?H:""})})}function zme(u,f,p,b,C){if(p.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){if(f=p.alternate,f!==null&&L0(f,p,C,!0),p=Ho.current,p!==null){switch(p.tag){case 13:return _c===null?qI():p.alternate===null&&hr===0&&(hr=3),p.flags&=-257,p.flags|=65536,p.lanes=C,b===Y4?p.flags|=16384:(f=p.updateQueue,f===null?p.updateQueue=new Set([b]):f.add(b),KI(u,b,C)),!1;case 22:return p.flags|=65536,b===Y4?p.flags|=16384:(f=p.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([b])},p.updateQueue=f):(p=f.retryQueue,p===null?f.retryQueue=new Set([b]):p.add(b)),KI(u,b,C)),!1}throw Error(r(435,p.tag))}return KI(u,b,C),qI(),!1}if(rn)return f=Ho.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=C,b!==H4&&(u=Error(r(422),{cause:b}),P0(jo(u,p)))):(b!==H4&&(f=Error(r(423),{cause:b}),P0(jo(f,p))),u=u.current.alternate,u.flags|=65536,C&=-C,u.lanes|=C,b=jo(b,p),C=_I(u.stateNode,b,C),Q4(u,C),hr!==4&&(hr=2)),!1;var P=Error(r(520),{cause:b});if(P=jo(P,p),Q0===null?Q0=[P]:Q0.push(P),hr!==4&&(hr=2),f===null)return!0;b=jo(b,p),p=f;do{switch(p.tag){case 3:return p.flags|=65536,u=C&-C,p.lanes|=u,u=_I(p.stateNode,b,u),Q4(p,u),!1;case 1:if(f=p.type,P=p.stateNode,(p.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||P!==null&&typeof P.componentDidCatch=="function"&&(dd===null||!dd.has(P))))return p.flags|=65536,C&=-C,p.lanes|=C,C=HU(C),VU(C,u,p,b),Q4(p,C),!1}p=p.return}while(p!==null);return!1}var qU=Error(r(461)),hi=!1;function Pi(u,f,p,b){f.child=u===null?MU(f,null,p,b):pm(f,u.child,p,b)}function GU(u,f,p,b,C){p=p.render;var P=f.ref;if("ref"in b){var j={};for(var H in b)H!=="ref"&&(j[H]=b[H])}else j=b;return ih(f),b=rI(u,f,p,j,P,C),H=iI(),u!==null&&!hi?(sI(u,f,C),Pl(u,f,C)):(rn&&H&&$4(f),f.flags|=1,Pi(u,f,b,C),f.child)}function KU(u,f,p,b,C){if(u===null){var P=p.type;return typeof P=="function"&&!U4(P)&&P.defaultProps===void 0&&p.compare===null?(f.tag=15,f.type=P,zU(u,f,P,b,C)):(u=wS(p.type,null,b,f,f.mode,C),u.ref=f.ref,u.return=f,f.child=u)}if(P=u.child,!kI(u,C)){var j=P.memoizedProps;if(p=p.compare,p=p!==null?p:I0,p(j,b)&&u.ref===f.ref)return Pl(u,f,C)}return f.flags|=1,u=Cl(P,b),u.ref=f.ref,u.return=f,f.child=u}function zU(u,f,p,b,C){if(u!==null){var P=u.memoizedProps;if(I0(P,b)&&u.ref===f.ref)if(hi=!1,f.pendingProps=b=P,kI(u,C))(u.flags&131072)!==0&&(hi=!0);else return f.lanes=u.lanes,Pl(u,f,C)}return SI(u,f,p,b,C)}function WU(u,f,p){var b=f.pendingProps,C=b.children,P=u!==null?u.memoizedState:null;if(b.mode==="hidden"){if((f.flags&128)!==0){if(b=P!==null?P.baseLanes|p:p,u!==null){for(C=f.child=u.child,P=0;C!==null;)P=P|C.lanes|C.childLanes,C=C.sibling;f.childLanes=P&~b}else f.childLanes=0,f.child=null;return YU(u,f,b,p)}if((p&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},u!==null&&kS(f,P!==null?P.cachePool:null),P!==null?zN(f,P):eI(),DU(f);else return f.lanes=f.childLanes=536870912,YU(u,f,P!==null?P.baseLanes|p:p,p)}else P!==null?(kS(f,P.cachePool),zN(f,P),sd(),f.memoizedState=null):(u!==null&&kS(f,null),eI(),sd());return Pi(u,f,C,p),f.child}function YU(u,f,p,b){var C=W4();return C=C===null?null:{parent:zr._currentValue,pool:C},f.memoizedState={baseLanes:p,cachePool:C},u!==null&&kS(f,null),eI(),DU(f),u!==null&&L0(u,f,b,!0),null}function GS(u,f){var p=f.ref;if(p===null)u!==null&&u.ref!==null&&(f.flags|=4194816);else{if(typeof p!="function"&&typeof p!="object")throw Error(r(284));(u===null||u.ref!==p)&&(f.flags|=4194816)}}function SI(u,f,p,b,C){return ih(f),p=rI(u,f,p,b,void 0,C),b=iI(),u!==null&&!hi?(sI(u,f,C),Pl(u,f,C)):(rn&&b&&$4(f),f.flags|=1,Pi(u,f,p,C),f.child)}function XU(u,f,p,b,C,P){return ih(f),f.updateQueue=null,p=YN(f,b,p,C),WN(u),b=iI(),u!==null&&!hi?(sI(u,f,P),Pl(u,f,P)):(rn&&b&&$4(f),f.flags|=1,Pi(u,f,p,P),f.child)}function JU(u,f,p,b,C){if(ih(f),f.stateNode===null){var P=im,j=p.contextType;typeof j=="object"&&j!==null&&(P=Wi(j)),P=new p(b,P),f.memoizedState=P.state!==null&&P.state!==void 0?P.state:null,P.updater=bI,f.stateNode=P,P._reactInternals=f,P=f.stateNode,P.props=b,P.state=f.memoizedState,P.refs={},X4(f),j=p.contextType,P.context=typeof j=="object"&&j!==null?Wi(j):im,P.state=f.memoizedState,j=p.getDerivedStateFromProps,typeof j=="function"&&(yI(f,p,j,b),P.state=f.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof P.getSnapshotBeforeUpdate=="function"||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(j=P.state,typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount(),j!==P.state&&bI.enqueueReplaceState(P,P.state,null),F0(f,b,P,C),j0(),P.state=f.memoizedState),typeof P.componentDidMount=="function"&&(f.flags|=4194308),b=!0}else if(u===null){P=f.stateNode;var H=f.memoizedProps,Q=ah(p,H);P.props=Q;var ie=P.context,me=p.contextType;j=im,typeof me=="object"&&me!==null&&(j=Wi(me));var ve=p.getDerivedStateFromProps;me=typeof ve=="function"||typeof P.getSnapshotBeforeUpdate=="function",H=f.pendingProps!==H,me||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(H||ie!==j)&&UU(f,P,b,j),ed=!1;var ae=f.memoizedState;P.state=ae,F0(f,b,P,C),j0(),ie=f.memoizedState,H||ae!==ie||ed?(typeof ve=="function"&&(yI(f,p,ve,b),ie=f.memoizedState),(Q=ed||NU(f,p,Q,b,ae,ie,j))?(me||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(f.flags|=4194308)):(typeof P.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=b,f.memoizedState=ie),P.props=b,P.state=ie,P.context=j,b=Q):(typeof P.componentDidMount=="function"&&(f.flags|=4194308),b=!1)}else{P=f.stateNode,J4(u,f),j=f.memoizedProps,me=ah(p,j),P.props=me,ve=f.pendingProps,ae=P.context,ie=p.contextType,Q=im,typeof ie=="object"&&ie!==null&&(Q=Wi(ie)),H=p.getDerivedStateFromProps,(ie=typeof H=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(j!==ve||ae!==Q)&&UU(f,P,b,Q),ed=!1,ae=f.memoizedState,P.state=ae,F0(f,b,P,C),j0();var le=f.memoizedState;j!==ve||ae!==le||ed||u!==null&&u.dependencies!==null&&RS(u.dependencies)?(typeof H=="function"&&(yI(f,p,H,b),le=f.memoizedState),(me=ed||NU(f,p,me,b,ae,le,Q)||u!==null&&u.dependencies!==null&&RS(u.dependencies))?(ie||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(b,le,Q),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(b,le,Q)),typeof P.componentDidUpdate=="function"&&(f.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof P.componentDidUpdate!="function"||j===u.memoizedProps&&ae===u.memoizedState||(f.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||j===u.memoizedProps&&ae===u.memoizedState||(f.flags|=1024),f.memoizedProps=b,f.memoizedState=le),P.props=b,P.state=le,P.context=Q,b=me):(typeof P.componentDidUpdate!="function"||j===u.memoizedProps&&ae===u.memoizedState||(f.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||j===u.memoizedProps&&ae===u.memoizedState||(f.flags|=1024),b=!1)}return P=b,GS(u,f),b=(f.flags&128)!==0,P||b?(P=f.stateNode,p=b&&typeof p.getDerivedStateFromError!="function"?null:P.render(),f.flags|=1,u!==null&&b?(f.child=pm(f,u.child,null,C),f.child=pm(f,null,p,C)):Pi(u,f,p,C),f.memoizedState=P.state,u=f.child):u=Pl(u,f,C),u}function QU(u,f,p,b){return A0(),f.flags|=256,Pi(u,f,p,b),f.child}var EI={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function wI(u){return{baseLanes:u,cachePool:FN()}}function CI(u,f,p){return u=u!==null?u.childLanes&~p:0,f&&(u|=Vo),u}function ZU(u,f,p){var b=f.pendingProps,C=!1,P=(f.flags&128)!==0,j;if((j=P)||(j=u!==null&&u.memoizedState===null?!1:(Wr.current&2)!==0),j&&(C=!0,f.flags&=-129),j=(f.flags&32)!==0,f.flags&=-33,u===null){if(rn){if(C?id(f):sd(),rn){var H=fr,Q;if(Q=H){e:{for(Q=H,H=bc;Q.nodeType!==8;){if(!H){H=null;break e}if(Q=Da(Q.nextSibling),Q===null){H=null;break e}}H=Q}H!==null?(f.memoizedState={dehydrated:H,treeContext:Zf!==null?{id:Tl,overflow:Rl}:null,retryLane:536870912,hydrationErrors:null},Q=so(18,null,null,0),Q.stateNode=H,Q.return=f,f.child=Q,is=f,fr=null,Q=!0):Q=!1}Q||nh(f)}if(H=f.memoizedState,H!==null&&(H=H.dehydrated,H!==null))return ak(H)?f.lanes=32:f.lanes=536870912,null;Al(f)}return H=b.children,b=b.fallback,C?(sd(),C=f.mode,H=KS({mode:"hidden",children:H},C),b=Qf(b,C,p,null),H.return=f,b.return=f,H.sibling=b,f.child=H,C=f.child,C.memoizedState=wI(p),C.childLanes=CI(u,j,p),f.memoizedState=EI,b):(id(f),TI(f,H))}if(Q=u.memoizedState,Q!==null&&(H=Q.dehydrated,H!==null)){if(P)f.flags&256?(id(f),f.flags&=-257,f=RI(u,f,p)):f.memoizedState!==null?(sd(),f.child=u.child,f.flags|=128,f=null):(sd(),C=b.fallback,H=f.mode,b=KS({mode:"visible",children:b.children},H),C=Qf(C,H,p,null),C.flags|=2,b.return=f,C.return=f,b.sibling=C,f.child=b,pm(f,u.child,null,p),b=f.child,b.memoizedState=wI(p),b.childLanes=CI(u,j,p),f.memoizedState=EI,f=C);else if(id(f),ak(H)){if(j=H.nextSibling&&H.nextSibling.dataset,j)var ie=j.dgst;j=ie,b=Error(r(419)),b.stack="",b.digest=j,P0({value:b,source:null,stack:null}),f=RI(u,f,p)}else if(hi||L0(u,f,p,!1),j=(p&u.childLanes)!==0,hi||j){if(j=Nn,j!==null&&(b=p&-p,b=(b&42)!==0?1:Kr(b),b=(b&(j.suspendedLanes|p))!==0?0:b,b!==0&&b!==Q.retryLane))throw Q.retryLane=b,rm(u,b),uo(j,u,b),qU;H.data==="$?"||qI(),f=RI(u,f,p)}else H.data==="$?"?(f.flags|=192,f.child=u.child,f=null):(u=Q.treeContext,fr=Da(H.nextSibling),is=f,rn=!0,th=null,bc=!1,u!==null&&($o[Bo++]=Tl,$o[Bo++]=Rl,$o[Bo++]=Zf,Tl=u.id,Rl=u.overflow,Zf=f),f=TI(f,b.children),f.flags|=4096);return f}return C?(sd(),C=b.fallback,H=f.mode,Q=u.child,ie=Q.sibling,b=Cl(Q,{mode:"hidden",children:b.children}),b.subtreeFlags=Q.subtreeFlags&65011712,ie!==null?C=Cl(ie,C):(C=Qf(C,H,p,null),C.flags|=2),C.return=f,b.return=f,b.sibling=C,f.child=b,b=C,C=f.child,H=u.child.memoizedState,H===null?H=wI(p):(Q=H.cachePool,Q!==null?(ie=zr._currentValue,Q=Q.parent!==ie?{parent:ie,pool:ie}:Q):Q=FN(),H={baseLanes:H.baseLanes|p,cachePool:Q}),C.memoizedState=H,C.childLanes=CI(u,j,p),f.memoizedState=EI,b):(id(f),p=u.child,u=p.sibling,p=Cl(p,{mode:"visible",children:b.children}),p.return=f,p.sibling=null,u!==null&&(j=f.deletions,j===null?(f.deletions=[u],f.flags|=16):j.push(u)),f.child=p,f.memoizedState=null,p)}function TI(u,f){return f=KS({mode:"visible",children:f},u.mode),f.return=u,u.child=f}function KS(u,f){return u=so(22,u,null,f),u.lanes=0,u.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},u}function RI(u,f,p){return pm(f,u.child,null,p),u=TI(f,f.pendingProps.children),u.flags|=2,f.memoizedState=null,u}function ej(u,f,p){u.lanes|=f;var b=u.alternate;b!==null&&(b.lanes|=f),q4(u.return,f,p)}function II(u,f,p,b,C){var P=u.memoizedState;P===null?u.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:b,tail:p,tailMode:C}:(P.isBackwards=f,P.rendering=null,P.renderingStartTime=0,P.last=b,P.tail=p,P.tailMode=C)}function tj(u,f,p){var b=f.pendingProps,C=b.revealOrder,P=b.tail;if(Pi(u,f,b.children,p),b=Wr.current,(b&2)!==0)b=b&1|2,f.flags|=128;else{if(u!==null&&(u.flags&128)!==0)e:for(u=f.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&ej(u,p,f);else if(u.tag===19)ej(u,p,f);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===f)break e;for(;u.sibling===null;){if(u.return===null||u.return===f)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}b&=1}switch(fe(Wr,b),C){case"forwards":for(p=f.child,C=null;p!==null;)u=p.alternate,u!==null&&HS(u)===null&&(C=p),p=p.sibling;p=C,p===null?(C=f.child,f.child=null):(C=p.sibling,p.sibling=null),II(f,!1,C,p,P);break;case"backwards":for(p=null,C=f.child,f.child=null;C!==null;){if(u=C.alternate,u!==null&&HS(u)===null){f.child=C;break}u=C.sibling,C.sibling=p,p=C,C=u}II(f,!0,p,null,P);break;case"together":II(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function Pl(u,f,p){if(u!==null&&(f.dependencies=u.dependencies),ud|=f.lanes,(p&f.childLanes)===0)if(u!==null){if(L0(u,f,p,!1),(p&f.childLanes)===0)return null}else return null;if(u!==null&&f.child!==u.child)throw Error(r(153));if(f.child!==null){for(u=f.child,p=Cl(u,u.pendingProps),f.child=p,p.return=f;u.sibling!==null;)u=u.sibling,p=p.sibling=Cl(u,u.pendingProps),p.return=f;p.sibling=null}return f.child}function kI(u,f){return(u.lanes&f)!==0?!0:(u=u.dependencies,!!(u!==null&&RS(u)))}function Wme(u,f,p){switch(f.tag){case 3:Ie(f,f.stateNode.containerInfo),Zu(f,zr,u.memoizedState.cache),A0();break;case 27:case 5:et(f);break;case 4:Ie(f,f.stateNode.containerInfo);break;case 10:Zu(f,f.type,f.memoizedProps.value);break;case 13:var b=f.memoizedState;if(b!==null)return b.dehydrated!==null?(id(f),f.flags|=128,null):(p&f.child.childLanes)!==0?ZU(u,f,p):(id(f),u=Pl(u,f,p),u!==null?u.sibling:null);id(f);break;case 19:var C=(u.flags&128)!==0;if(b=(p&f.childLanes)!==0,b||(L0(u,f,p,!1),b=(p&f.childLanes)!==0),C){if(b)return tj(u,f,p);f.flags|=128}if(C=f.memoizedState,C!==null&&(C.rendering=null,C.tail=null,C.lastEffect=null),fe(Wr,Wr.current),b)break;return null;case 22:case 23:return f.lanes=0,WU(u,f,p);case 24:Zu(f,zr,u.memoizedState.cache)}return Pl(u,f,p)}function nj(u,f,p){if(u!==null)if(u.memoizedProps!==f.pendingProps)hi=!0;else{if(!kI(u,p)&&(f.flags&128)===0)return hi=!1,Wme(u,f,p);hi=(u.flags&131072)!==0}else hi=!1,rn&&(f.flags&1048576)!==0&&LN(f,TS,f.index);switch(f.lanes=0,f.tag){case 16:e:{u=f.pendingProps;var b=f.elementType,C=b._init;if(b=C(b._payload),f.type=b,typeof b=="function")U4(b)?(u=ah(b,u),f.tag=1,f=JU(null,f,b,u,p)):(f.tag=0,f=SI(null,f,b,u,p));else{if(b!=null){if(C=b.$$typeof,C===T){f.tag=11,f=GU(null,f,b,u,p);break e}else if(C===A){f.tag=14,f=KU(null,f,b,u,p);break e}}throw f=Y(b)||b,Error(r(306,f,""))}}return f;case 0:return SI(u,f,f.type,f.pendingProps,p);case 1:return b=f.type,C=ah(b,f.pendingProps),JU(u,f,b,C,p);case 3:e:{if(Ie(f,f.stateNode.containerInfo),u===null)throw Error(r(387));b=f.pendingProps;var P=f.memoizedState;C=P.element,J4(u,f),F0(f,b,null,p);var j=f.memoizedState;if(b=j.cache,Zu(f,zr,b),b!==P.cache&&G4(f,[zr],p,!0),j0(),b=j.element,P.isDehydrated)if(P={element:b,isDehydrated:!1,cache:j.cache},f.updateQueue.baseState=P,f.memoizedState=P,f.flags&256){f=QU(u,f,b,p);break e}else if(b!==C){C=jo(Error(r(424)),f),P0(C),f=QU(u,f,b,p);break e}else{switch(u=f.stateNode.containerInfo,u.nodeType){case 9:u=u.body;break;default:u=u.nodeName==="HTML"?u.ownerDocument.body:u}for(fr=Da(u.firstChild),is=f,rn=!0,th=null,bc=!0,p=MU(f,null,b,p),f.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling}else{if(A0(),b===C){f=Pl(u,f,p);break e}Pi(u,f,b,p)}f=f.child}return f;case 26:return GS(u,f),u===null?(p=oF(f.type,null,f.pendingProps,null))?f.memoizedState=p:rn||(p=f.type,u=f.pendingProps,b=o2(be.current).createElement(p),b[yn]=f,b[dr]=u,Oi(b,p,u),fi(b),f.stateNode=b):f.memoizedState=oF(f.type,u.memoizedProps,f.pendingProps,u.memoizedState),null;case 27:return et(f),u===null&&rn&&(b=f.stateNode=rF(f.type,f.pendingProps,be.current),is=f,bc=!0,C=fr,pd(f.type)?(ck=C,fr=Da(b.firstChild)):fr=C),Pi(u,f,f.pendingProps.children,p),GS(u,f),u===null&&(f.flags|=4194304),f.child;case 5:return u===null&&rn&&((C=b=fr)&&(b=Ege(b,f.type,f.pendingProps,bc),b!==null?(f.stateNode=b,is=f,fr=Da(b.firstChild),bc=!1,C=!0):C=!1),C||nh(f)),et(f),C=f.type,P=f.pendingProps,j=u!==null?u.memoizedProps:null,b=P.children,ik(C,P)?b=null:j!==null&&ik(C,j)&&(f.flags|=32),f.memoizedState!==null&&(C=rI(u,f,$me,null,null,p),a1._currentValue=C),GS(u,f),Pi(u,f,b,p),f.child;case 6:return u===null&&rn&&((u=p=fr)&&(p=wge(p,f.pendingProps,bc),p!==null?(f.stateNode=p,is=f,fr=null,u=!0):u=!1),u||nh(f)),null;case 13:return ZU(u,f,p);case 4:return Ie(f,f.stateNode.containerInfo),b=f.pendingProps,u===null?f.child=pm(f,null,b,p):Pi(u,f,b,p),f.child;case 11:return GU(u,f,f.type,f.pendingProps,p);case 7:return Pi(u,f,f.pendingProps,p),f.child;case 8:return Pi(u,f,f.pendingProps.children,p),f.child;case 12:return Pi(u,f,f.pendingProps.children,p),f.child;case 10:return b=f.pendingProps,Zu(f,f.type,b.value),Pi(u,f,b.children,p),f.child;case 9:return C=f.type._context,b=f.pendingProps.children,ih(f),C=Wi(C),b=b(C),f.flags|=1,Pi(u,f,b,p),f.child;case 14:return KU(u,f,f.type,f.pendingProps,p);case 15:return zU(u,f,f.type,f.pendingProps,p);case 19:return tj(u,f,p);case 31:return b=f.pendingProps,p=f.mode,b={mode:b.mode,children:b.children},u===null?(p=KS(b,p),p.ref=f.ref,f.child=p,p.return=f,f=p):(p=Cl(u.child,b),p.ref=f.ref,f.child=p,p.return=f,f=p),f;case 22:return WU(u,f,p);case 24:return ih(f),b=Wi(zr),u===null?(C=W4(),C===null&&(C=Nn,P=K4(),C.pooledCache=P,P.refCount++,P!==null&&(C.pooledCacheLanes|=p),C=P),f.memoizedState={parent:b,cache:C},X4(f),Zu(f,zr,C)):((u.lanes&p)!==0&&(J4(u,f),F0(f,null,null,p),j0()),C=u.memoizedState,P=f.memoizedState,C.parent!==b?(C={parent:b,cache:b},f.memoizedState=C,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=C),Zu(f,zr,b)):(b=P.cache,Zu(f,zr,b),b!==C.cache&&G4(f,[zr],p,!0))),Pi(u,f,f.pendingProps.children,p),f.child;case 29:throw f.pendingProps}throw Error(r(156,f.tag))}function Ll(u){u.flags|=4}function rj(u,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)u.flags&=-16777217;else if(u.flags|=16777216,!dF(f)){if(f=Ho.current,f!==null&&((Ht&4194048)===Ht?_c!==null:(Ht&62914560)!==Ht&&(Ht&536870912)===0||f!==_c))throw N0=Y4,$N;u.flags|=8192}}function zS(u,f){f!==null&&(u.flags|=4),u.flags&16384&&(f=u.tag!==22?Et():536870912,u.lanes|=f,ym|=f)}function K0(u,f){if(!rn)switch(u.tailMode){case"hidden":f=u.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?u.tail=null:p.sibling=null;break;case"collapsed":p=u.tail;for(var b=null;p!==null;)p.alternate!==null&&(b=p),p=p.sibling;b===null?f||u.tail===null?u.tail=null:u.tail.sibling=null:b.sibling=null}}function ir(u){var f=u.alternate!==null&&u.alternate.child===u.child,p=0,b=0;if(f)for(var C=u.child;C!==null;)p|=C.lanes|C.childLanes,b|=C.subtreeFlags&65011712,b|=C.flags&65011712,C.return=u,C=C.sibling;else for(C=u.child;C!==null;)p|=C.lanes|C.childLanes,b|=C.subtreeFlags,b|=C.flags,C.return=u,C=C.sibling;return u.subtreeFlags|=b,u.childLanes=p,f}function Yme(u,f,p){var b=f.pendingProps;switch(B4(f),f.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ir(f),null;case 1:return ir(f),null;case 3:return p=f.stateNode,b=null,u!==null&&(b=u.memoizedState.cache),f.memoizedState.cache!==b&&(f.flags|=2048),kl(zr),Ue(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(u===null||u.child===null)&&(x0(f)?Ll(f):u===null||u.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,DN())),ir(f),null;case 26:return p=f.memoizedState,u===null?(Ll(f),p!==null?(ir(f),rj(f,p)):(ir(f),f.flags&=-16777217)):p?p!==u.memoizedState?(Ll(f),ir(f),rj(f,p)):(ir(f),f.flags&=-16777217):(u.memoizedProps!==b&&Ll(f),ir(f),f.flags&=-16777217),null;case 27:ln(f),p=be.current;var C=f.type;if(u!==null&&f.stateNode!=null)u.memoizedProps!==b&&Ll(f);else{if(!b){if(f.stateNode===null)throw Error(r(166));return ir(f),null}u=ye.current,x0(f)?ON(f):(u=rF(C,b,p),f.stateNode=u,Ll(f))}return ir(f),null;case 5:if(ln(f),p=f.type,u!==null&&f.stateNode!=null)u.memoizedProps!==b&&Ll(f);else{if(!b){if(f.stateNode===null)throw Error(r(166));return ir(f),null}if(u=ye.current,x0(f))ON(f);else{switch(C=o2(be.current),u){case 1:u=C.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:u=C.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":u=C.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":u=C.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":u=C.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild);break;case"select":u=typeof b.is=="string"?C.createElement("select",{is:b.is}):C.createElement("select"),b.multiple?u.multiple=!0:b.size&&(u.size=b.size);break;default:u=typeof b.is=="string"?C.createElement(p,{is:b.is}):C.createElement(p)}}u[yn]=f,u[dr]=b;e:for(C=f.child;C!==null;){if(C.tag===5||C.tag===6)u.appendChild(C.stateNode);else if(C.tag!==4&&C.tag!==27&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===f)break e;for(;C.sibling===null;){if(C.return===null||C.return===f)break e;C=C.return}C.sibling.return=C.return,C=C.sibling}f.stateNode=u;e:switch(Oi(u,p,b),p){case"button":case"input":case"select":case"textarea":u=!!b.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&Ll(f)}}return ir(f),f.flags&=-16777217,null;case 6:if(u&&f.stateNode!=null)u.memoizedProps!==b&&Ll(f);else{if(typeof b!="string"&&f.stateNode===null)throw Error(r(166));if(u=be.current,x0(f)){if(u=f.stateNode,p=f.memoizedProps,b=null,C=is,C!==null)switch(C.tag){case 27:case 5:b=C.memoizedProps}u[yn]=f,u=!!(u.nodeValue===p||b!==null&&b.suppressHydrationWarning===!0||Xj(u.nodeValue,p)),u||nh(f)}else u=o2(u).createTextNode(b),u[yn]=f,f.stateNode=u}return ir(f),null;case 13:if(b=f.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(C=x0(f),b!==null&&b.dehydrated!==null){if(u===null){if(!C)throw Error(r(318));if(C=f.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(r(317));C[yn]=f}else A0(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;ir(f),C=!1}else C=DN(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=C),C=!0;if(!C)return f.flags&256?(Al(f),f):(Al(f),null)}if(Al(f),(f.flags&128)!==0)return f.lanes=p,f;if(p=b!==null,u=u!==null&&u.memoizedState!==null,p){b=f.child,C=null,b.alternate!==null&&b.alternate.memoizedState!==null&&b.alternate.memoizedState.cachePool!==null&&(C=b.alternate.memoizedState.cachePool.pool);var P=null;b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(P=b.memoizedState.cachePool.pool),P!==C&&(b.flags|=2048)}return p!==u&&p&&(f.child.flags|=8192),zS(f,f.updateQueue),ir(f),null;case 4:return Ue(),u===null&&ZI(f.stateNode.containerInfo),ir(f),null;case 10:return kl(f.type),ir(f),null;case 19:if(ne(Wr),C=f.memoizedState,C===null)return ir(f),null;if(b=(f.flags&128)!==0,P=C.rendering,P===null)if(b)K0(C,!1);else{if(hr!==0||u!==null&&(u.flags&128)!==0)for(u=f.child;u!==null;){if(P=HS(u),P!==null){for(f.flags|=128,K0(C,!1),u=P.updateQueue,f.updateQueue=u,zS(f,u),f.subtreeFlags=0,u=p,p=f.child;p!==null;)PN(p,u),p=p.sibling;return fe(Wr,Wr.current&1|2),f.child}u=u.sibling}C.tail!==null&&Dn()>XS&&(f.flags|=128,b=!0,K0(C,!1),f.lanes=4194304)}else{if(!b)if(u=HS(P),u!==null){if(f.flags|=128,b=!0,u=u.updateQueue,f.updateQueue=u,zS(f,u),K0(C,!0),C.tail===null&&C.tailMode==="hidden"&&!P.alternate&&!rn)return ir(f),null}else 2*Dn()-C.renderingStartTime>XS&&p!==536870912&&(f.flags|=128,b=!0,K0(C,!1),f.lanes=4194304);C.isBackwards?(P.sibling=f.child,f.child=P):(u=C.last,u!==null?u.sibling=P:f.child=P,C.last=P)}return C.tail!==null?(f=C.tail,C.rendering=f,C.tail=f.sibling,C.renderingStartTime=Dn(),f.sibling=null,u=Wr.current,fe(Wr,b?u&1|2:u&1),f):(ir(f),null);case 22:case 23:return Al(f),tI(),b=f.memoizedState!==null,u!==null?u.memoizedState!==null!==b&&(f.flags|=8192):b&&(f.flags|=8192),b?(p&536870912)!==0&&(f.flags&128)===0&&(ir(f),f.subtreeFlags&6&&(f.flags|=8192)):ir(f),p=f.updateQueue,p!==null&&zS(f,p.retryQueue),p=null,u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(p=u.memoizedState.cachePool.pool),b=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(b=f.memoizedState.cachePool.pool),b!==p&&(f.flags|=2048),u!==null&&ne(sh),null;case 24:return p=null,u!==null&&(p=u.memoizedState.cache),f.memoizedState.cache!==p&&(f.flags|=2048),kl(zr),ir(f),null;case 25:return null;case 30:return null}throw Error(r(156,f.tag))}function Xme(u,f){switch(B4(f),f.tag){case 1:return u=f.flags,u&65536?(f.flags=u&-65537|128,f):null;case 3:return kl(zr),Ue(),u=f.flags,(u&65536)!==0&&(u&128)===0?(f.flags=u&-65537|128,f):null;case 26:case 27:case 5:return ln(f),null;case 13:if(Al(f),u=f.memoizedState,u!==null&&u.dehydrated!==null){if(f.alternate===null)throw Error(r(340));A0()}return u=f.flags,u&65536?(f.flags=u&-65537|128,f):null;case 19:return ne(Wr),null;case 4:return Ue(),null;case 10:return kl(f.type),null;case 22:case 23:return Al(f),tI(),u!==null&&ne(sh),u=f.flags,u&65536?(f.flags=u&-65537|128,f):null;case 24:return kl(zr),null;case 25:return null;default:return null}}function ij(u,f){switch(B4(f),f.tag){case 3:kl(zr),Ue();break;case 26:case 27:case 5:ln(f);break;case 4:Ue();break;case 13:Al(f);break;case 19:ne(Wr);break;case 10:kl(f.type);break;case 22:case 23:Al(f),tI(),u!==null&&ne(sh);break;case 24:kl(zr)}}function z0(u,f){try{var p=f.updateQueue,b=p!==null?p.lastEffect:null;if(b!==null){var C=b.next;p=C;do{if((p.tag&u)===u){b=void 0;var P=p.create,j=p.inst;b=P(),j.destroy=b}p=p.next}while(p!==C)}}catch(H){In(f,f.return,H)}}function od(u,f,p){try{var b=f.updateQueue,C=b!==null?b.lastEffect:null;if(C!==null){var P=C.next;b=P;do{if((b.tag&u)===u){var j=b.inst,H=j.destroy;if(H!==void 0){j.destroy=void 0,C=f;var Q=p,ie=H;try{ie()}catch(me){In(C,Q,me)}}}b=b.next}while(b!==P)}}catch(me){In(f,f.return,me)}}function sj(u){var f=u.updateQueue;if(f!==null){var p=u.stateNode;try{KN(f,p)}catch(b){In(u,u.return,b)}}}function oj(u,f,p){p.props=ah(u.type,u.memoizedProps),p.state=u.memoizedState;try{p.componentWillUnmount()}catch(b){In(u,f,b)}}function W0(u,f){try{var p=u.ref;if(p!==null){switch(u.tag){case 26:case 27:case 5:var b=u.stateNode;break;case 30:b=u.stateNode;break;default:b=u.stateNode}typeof p=="function"?u.refCleanup=p(b):p.current=b}}catch(C){In(u,f,C)}}function Sc(u,f){var p=u.ref,b=u.refCleanup;if(p!==null)if(typeof b=="function")try{b()}catch(C){In(u,f,C)}finally{u.refCleanup=null,u=u.alternate,u!=null&&(u.refCleanup=null)}else if(typeof p=="function")try{p(null)}catch(C){In(u,f,C)}else p.current=null}function aj(u){var f=u.type,p=u.memoizedProps,b=u.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":p.autoFocus&&b.focus();break e;case"img":p.src?b.src=p.src:p.srcSet&&(b.srcset=p.srcSet)}}catch(C){In(u,u.return,C)}}function xI(u,f,p){try{var b=u.stateNode;vge(b,u.type,p,f),b[dr]=f}catch(C){In(u,u.return,C)}}function cj(u){return u.tag===5||u.tag===3||u.tag===26||u.tag===27&&pd(u.type)||u.tag===4}function AI(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||cj(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.tag===27&&pd(u.type)||u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function PI(u,f,p){var b=u.tag;if(b===5||b===6)u=u.stateNode,f?(p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p).insertBefore(u,f):(f=p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p,f.appendChild(u),p=p._reactRootContainer,p!=null||f.onclick!==null||(f.onclick=s2));else if(b!==4&&(b===27&&pd(u.type)&&(p=u.stateNode,f=null),u=u.child,u!==null))for(PI(u,f,p),u=u.sibling;u!==null;)PI(u,f,p),u=u.sibling}function WS(u,f,p){var b=u.tag;if(b===5||b===6)u=u.stateNode,f?p.insertBefore(u,f):p.appendChild(u);else if(b!==4&&(b===27&&pd(u.type)&&(p=u.stateNode),u=u.child,u!==null))for(WS(u,f,p),u=u.sibling;u!==null;)WS(u,f,p),u=u.sibling}function lj(u){var f=u.stateNode,p=u.memoizedProps;try{for(var b=u.type,C=f.attributes;C.length;)f.removeAttributeNode(C[0]);Oi(f,b,p),f[yn]=u,f[dr]=p}catch(P){In(u,u.return,P)}}var Ol=!1,Cr=!1,LI=!1,uj=typeof WeakSet=="function"?WeakSet:Set,pi=null;function Jme(u,f){if(u=u.containerInfo,nk=f2,u=SN(u),A4(u)){if("selectionStart"in u)var p={start:u.selectionStart,end:u.selectionEnd};else e:{p=(p=u.ownerDocument)&&p.defaultView||window;var b=p.getSelection&&p.getSelection();if(b&&b.rangeCount!==0){p=b.anchorNode;var C=b.anchorOffset,P=b.focusNode;b=b.focusOffset;try{p.nodeType,P.nodeType}catch{p=null;break e}var j=0,H=-1,Q=-1,ie=0,me=0,ve=u,ae=null;t:for(;;){for(var le;ve!==p||C!==0&&ve.nodeType!==3||(H=j+C),ve!==P||b!==0&&ve.nodeType!==3||(Q=j+b),ve.nodeType===3&&(j+=ve.nodeValue.length),(le=ve.firstChild)!==null;)ae=ve,ve=le;for(;;){if(ve===u)break t;if(ae===p&&++ie===C&&(H=j),ae===P&&++me===b&&(Q=j),(le=ve.nextSibling)!==null)break;ve=ae,ae=ve.parentNode}ve=le}p=H===-1||Q===-1?null:{start:H,end:Q}}else p=null}p=p||{start:0,end:0}}else p=null;for(rk={focusedElem:u,selectionRange:p},f2=!1,pi=f;pi!==null;)if(f=pi,u=f.child,(f.subtreeFlags&1024)!==0&&u!==null)u.return=f,pi=u;else for(;pi!==null;){switch(f=pi,P=f.alternate,u=f.flags,f.tag){case 0:break;case 11:case 15:break;case 1:if((u&1024)!==0&&P!==null){u=void 0,p=f,C=P.memoizedProps,P=P.memoizedState,b=p.stateNode;try{var ct=ah(p.type,C,p.elementType===p.type);u=b.getSnapshotBeforeUpdate(ct,P),b.__reactInternalSnapshotBeforeUpdate=u}catch(nt){In(p,p.return,nt)}}break;case 3:if((u&1024)!==0){if(u=f.stateNode.containerInfo,p=u.nodeType,p===9)ok(u);else if(p===1)switch(u.nodeName){case"HEAD":case"HTML":case"BODY":ok(u);break;default:u.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((u&1024)!==0)throw Error(r(163))}if(u=f.sibling,u!==null){u.return=f.return,pi=u;break}pi=f.return}}function dj(u,f,p){var b=p.flags;switch(p.tag){case 0:case 11:case 15:ad(u,p),b&4&&z0(5,p);break;case 1:if(ad(u,p),b&4)if(u=p.stateNode,f===null)try{u.componentDidMount()}catch(j){In(p,p.return,j)}else{var C=ah(p.type,f.memoizedProps);f=f.memoizedState;try{u.componentDidUpdate(C,f,u.__reactInternalSnapshotBeforeUpdate)}catch(j){In(p,p.return,j)}}b&64&&sj(p),b&512&&W0(p,p.return);break;case 3:if(ad(u,p),b&64&&(u=p.updateQueue,u!==null)){if(f=null,p.child!==null)switch(p.child.tag){case 27:case 5:f=p.child.stateNode;break;case 1:f=p.child.stateNode}try{KN(u,f)}catch(j){In(p,p.return,j)}}break;case 27:f===null&&b&4&&lj(p);case 26:case 5:ad(u,p),f===null&&b&4&&aj(p),b&512&&W0(p,p.return);break;case 12:ad(u,p);break;case 13:ad(u,p),b&4&&pj(u,p),b&64&&(u=p.memoizedState,u!==null&&(u=u.dehydrated,u!==null&&(p=oge.bind(null,p),Cge(u,p))));break;case 22:if(b=p.memoizedState!==null||Ol,!b){f=f!==null&&f.memoizedState!==null||Cr,C=Ol;var P=Cr;Ol=b,(Cr=f)&&!P?cd(u,p,(p.subtreeFlags&8772)!==0):ad(u,p),Ol=C,Cr=P}break;case 30:break;default:ad(u,p)}}function fj(u){var f=u.alternate;f!==null&&(u.alternate=null,fj(f)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(f=u.stateNode,f!==null&&d4(f)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}var Xn=null,Ps=!1;function Ml(u,f,p){for(p=p.child;p!==null;)hj(u,f,p),p=p.sibling}function hj(u,f,p){if(ui&&typeof ui.onCommitFiberUnmount=="function")try{ui.onCommitFiberUnmount(mc,p)}catch{}switch(p.tag){case 26:Cr||Sc(p,f),Ml(u,f,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:Cr||Sc(p,f);var b=Xn,C=Ps;pd(p.type)&&(Xn=p.stateNode,Ps=!1),Ml(u,f,p),r1(p.stateNode),Xn=b,Ps=C;break;case 5:Cr||Sc(p,f);case 6:if(b=Xn,C=Ps,Xn=null,Ml(u,f,p),Xn=b,Ps=C,Xn!==null)if(Ps)try{(Xn.nodeType===9?Xn.body:Xn.nodeName==="HTML"?Xn.ownerDocument.body:Xn).removeChild(p.stateNode)}catch(P){In(p,f,P)}else try{Xn.removeChild(p.stateNode)}catch(P){In(p,f,P)}break;case 18:Xn!==null&&(Ps?(u=Xn,tF(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,p.stateNode),d1(u)):tF(Xn,p.stateNode));break;case 4:b=Xn,C=Ps,Xn=p.stateNode.containerInfo,Ps=!0,Ml(u,f,p),Xn=b,Ps=C;break;case 0:case 11:case 14:case 15:Cr||od(2,p,f),Cr||od(4,p,f),Ml(u,f,p);break;case 1:Cr||(Sc(p,f),b=p.stateNode,typeof b.componentWillUnmount=="function"&&oj(p,f,b)),Ml(u,f,p);break;case 21:Ml(u,f,p);break;case 22:Cr=(b=Cr)||p.memoizedState!==null,Ml(u,f,p),Cr=b;break;default:Ml(u,f,p)}}function pj(u,f){if(f.memoizedState===null&&(u=f.alternate,u!==null&&(u=u.memoizedState,u!==null&&(u=u.dehydrated,u!==null))))try{d1(u)}catch(p){In(f,f.return,p)}}function Qme(u){switch(u.tag){case 13:case 19:var f=u.stateNode;return f===null&&(f=u.stateNode=new uj),f;case 22:return u=u.stateNode,f=u._retryCache,f===null&&(f=u._retryCache=new uj),f;default:throw Error(r(435,u.tag))}}function OI(u,f){var p=Qme(u);f.forEach(function(b){var C=age.bind(null,u,b);p.has(b)||(p.add(b),b.then(C,C))})}function oo(u,f){var p=f.deletions;if(p!==null)for(var b=0;b<p.length;b++){var C=p[b],P=u,j=f,H=j;e:for(;H!==null;){switch(H.tag){case 27:if(pd(H.type)){Xn=H.stateNode,Ps=!1;break e}break;case 5:Xn=H.stateNode,Ps=!1;break e;case 3:case 4:Xn=H.stateNode.containerInfo,Ps=!0;break e}H=H.return}if(Xn===null)throw Error(r(160));hj(P,j,C),Xn=null,Ps=!1,P=C.alternate,P!==null&&(P.return=null),C.return=null}if(f.subtreeFlags&13878)for(f=f.child;f!==null;)mj(f,u),f=f.sibling}var Ma=null;function mj(u,f){var p=u.alternate,b=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:oo(f,u),ao(u),b&4&&(od(3,u,u.return),z0(3,u),od(5,u,u.return));break;case 1:oo(f,u),ao(u),b&512&&(Cr||p===null||Sc(p,p.return)),b&64&&Ol&&(u=u.updateQueue,u!==null&&(b=u.callbacks,b!==null&&(p=u.shared.hiddenCallbacks,u.shared.hiddenCallbacks=p===null?b:p.concat(b))));break;case 26:var C=Ma;if(oo(f,u),ao(u),b&512&&(Cr||p===null||Sc(p,p.return)),b&4){var P=p!==null?p.memoizedState:null;if(b=u.memoizedState,p===null)if(b===null)if(u.stateNode===null){e:{b=u.type,p=u.memoizedProps,C=C.ownerDocument||C;t:switch(b){case"title":P=C.getElementsByTagName("title")[0],(!P||P[zf]||P[yn]||P.namespaceURI==="http://www.w3.org/2000/svg"||P.hasAttribute("itemprop"))&&(P=C.createElement(b),C.head.insertBefore(P,C.querySelector("head > title"))),Oi(P,b,p),P[yn]=u,fi(P),b=P;break e;case"link":var j=lF("link","href",C).get(b+(p.href||""));if(j){for(var H=0;H<j.length;H++)if(P=j[H],P.getAttribute("href")===(p.href==null||p.href===""?null:p.href)&&P.getAttribute("rel")===(p.rel==null?null:p.rel)&&P.getAttribute("title")===(p.title==null?null:p.title)&&P.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){j.splice(H,1);break t}}P=C.createElement(b),Oi(P,b,p),C.head.appendChild(P);break;case"meta":if(j=lF("meta","content",C).get(b+(p.content||""))){for(H=0;H<j.length;H++)if(P=j[H],P.getAttribute("content")===(p.content==null?null:""+p.content)&&P.getAttribute("name")===(p.name==null?null:p.name)&&P.getAttribute("property")===(p.property==null?null:p.property)&&P.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&P.getAttribute("charset")===(p.charSet==null?null:p.charSet)){j.splice(H,1);break t}}P=C.createElement(b),Oi(P,b,p),C.head.appendChild(P);break;default:throw Error(r(468,b))}P[yn]=u,fi(P),b=P}u.stateNode=b}else uF(C,u.type,u.stateNode);else u.stateNode=cF(C,b,u.memoizedProps);else P!==b?(P===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):P.count--,b===null?uF(C,u.type,u.stateNode):cF(C,b,u.memoizedProps)):b===null&&u.stateNode!==null&&xI(u,u.memoizedProps,p.memoizedProps)}break;case 27:oo(f,u),ao(u),b&512&&(Cr||p===null||Sc(p,p.return)),p!==null&&b&4&&xI(u,u.memoizedProps,p.memoizedProps);break;case 5:if(oo(f,u),ao(u),b&512&&(Cr||p===null||Sc(p,p.return)),u.flags&32){C=u.stateNode;try{Xp(C,"")}catch(le){In(u,u.return,le)}}b&4&&u.stateNode!=null&&(C=u.memoizedProps,xI(u,C,p!==null?p.memoizedProps:C)),b&1024&&(LI=!0);break;case 6:if(oo(f,u),ao(u),b&4){if(u.stateNode===null)throw Error(r(162));b=u.memoizedProps,p=u.stateNode;try{p.nodeValue=b}catch(le){In(u,u.return,le)}}break;case 3:if(l2=null,C=Ma,Ma=a2(f.containerInfo),oo(f,u),Ma=C,ao(u),b&4&&p!==null&&p.memoizedState.isDehydrated)try{d1(f.containerInfo)}catch(le){In(u,u.return,le)}LI&&(LI=!1,gj(u));break;case 4:b=Ma,Ma=a2(u.stateNode.containerInfo),oo(f,u),ao(u),Ma=b;break;case 12:oo(f,u),ao(u);break;case 13:oo(f,u),ao(u),u.child.flags&8192&&u.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(FI=Dn()),b&4&&(b=u.updateQueue,b!==null&&(u.updateQueue=null,OI(u,b)));break;case 22:C=u.memoizedState!==null;var Q=p!==null&&p.memoizedState!==null,ie=Ol,me=Cr;if(Ol=ie||C,Cr=me||Q,oo(f,u),Cr=me,Ol=ie,ao(u),b&8192)e:for(f=u.stateNode,f._visibility=C?f._visibility&-2:f._visibility|1,C&&(p===null||Q||Ol||Cr||ch(u)),p=null,f=u;;){if(f.tag===5||f.tag===26){if(p===null){Q=p=f;try{if(P=Q.stateNode,C)j=P.style,typeof j.setProperty=="function"?j.setProperty("display","none","important"):j.display="none";else{H=Q.stateNode;var ve=Q.memoizedProps.style,ae=ve!=null&&ve.hasOwnProperty("display")?ve.display:null;H.style.display=ae==null||typeof ae=="boolean"?"":(""+ae).trim()}}catch(le){In(Q,Q.return,le)}}}else if(f.tag===6){if(p===null){Q=f;try{Q.stateNode.nodeValue=C?"":Q.memoizedProps}catch(le){In(Q,Q.return,le)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===u)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===u)break e;for(;f.sibling===null;){if(f.return===null||f.return===u)break e;p===f&&(p=null),f=f.return}p===f&&(p=null),f.sibling.return=f.return,f=f.sibling}b&4&&(b=u.updateQueue,b!==null&&(p=b.retryQueue,p!==null&&(b.retryQueue=null,OI(u,p))));break;case 19:oo(f,u),ao(u),b&4&&(b=u.updateQueue,b!==null&&(u.updateQueue=null,OI(u,b)));break;case 30:break;case 21:break;default:oo(f,u),ao(u)}}function ao(u){var f=u.flags;if(f&2){try{for(var p,b=u.return;b!==null;){if(cj(b)){p=b;break}b=b.return}if(p==null)throw Error(r(160));switch(p.tag){case 27:var C=p.stateNode,P=AI(u);WS(u,P,C);break;case 5:var j=p.stateNode;p.flags&32&&(Xp(j,""),p.flags&=-33);var H=AI(u);WS(u,H,j);break;case 3:case 4:var Q=p.stateNode.containerInfo,ie=AI(u);PI(u,ie,Q);break;default:throw Error(r(161))}}catch(me){In(u,u.return,me)}u.flags&=-3}f&4096&&(u.flags&=-4097)}function gj(u){if(u.subtreeFlags&1024)for(u=u.child;u!==null;){var f=u;gj(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),u=u.sibling}}function ad(u,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)dj(u,f.alternate,f),f=f.sibling}function ch(u){for(u=u.child;u!==null;){var f=u;switch(f.tag){case 0:case 11:case 14:case 15:od(4,f,f.return),ch(f);break;case 1:Sc(f,f.return);var p=f.stateNode;typeof p.componentWillUnmount=="function"&&oj(f,f.return,p),ch(f);break;case 27:r1(f.stateNode);case 26:case 5:Sc(f,f.return),ch(f);break;case 22:f.memoizedState===null&&ch(f);break;case 30:ch(f);break;default:ch(f)}u=u.sibling}}function cd(u,f,p){for(p=p&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var b=f.alternate,C=u,P=f,j=P.flags;switch(P.tag){case 0:case 11:case 15:cd(C,P,p),z0(4,P);break;case 1:if(cd(C,P,p),b=P,C=b.stateNode,typeof C.componentDidMount=="function")try{C.componentDidMount()}catch(ie){In(b,b.return,ie)}if(b=P,C=b.updateQueue,C!==null){var H=b.stateNode;try{var Q=C.shared.hiddenCallbacks;if(Q!==null)for(C.shared.hiddenCallbacks=null,C=0;C<Q.length;C++)GN(Q[C],H)}catch(ie){In(b,b.return,ie)}}p&&j&64&&sj(P),W0(P,P.return);break;case 27:lj(P);case 26:case 5:cd(C,P,p),p&&b===null&&j&4&&aj(P),W0(P,P.return);break;case 12:cd(C,P,p);break;case 13:cd(C,P,p),p&&j&4&&pj(C,P);break;case 22:P.memoizedState===null&&cd(C,P,p),W0(P,P.return);break;case 30:break;default:cd(C,P,p)}f=f.sibling}}function MI(u,f){var p=null;u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(p=u.memoizedState.cachePool.pool),u=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(u=f.memoizedState.cachePool.pool),u!==p&&(u!=null&&u.refCount++,p!=null&&O0(p))}function DI(u,f){u=null,f.alternate!==null&&(u=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==u&&(f.refCount++,u!=null&&O0(u))}function Ec(u,f,p,b){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)vj(u,f,p,b),f=f.sibling}function vj(u,f,p,b){var C=f.flags;switch(f.tag){case 0:case 11:case 15:Ec(u,f,p,b),C&2048&&z0(9,f);break;case 1:Ec(u,f,p,b);break;case 3:Ec(u,f,p,b),C&2048&&(u=null,f.alternate!==null&&(u=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==u&&(f.refCount++,u!=null&&O0(u)));break;case 12:if(C&2048){Ec(u,f,p,b),u=f.stateNode;try{var P=f.memoizedProps,j=P.id,H=P.onPostCommit;typeof H=="function"&&H(j,f.alternate===null?"mount":"update",u.passiveEffectDuration,-0)}catch(Q){In(f,f.return,Q)}}else Ec(u,f,p,b);break;case 13:Ec(u,f,p,b);break;case 23:break;case 22:P=f.stateNode,j=f.alternate,f.memoizedState!==null?P._visibility&2?Ec(u,f,p,b):Y0(u,f):P._visibility&2?Ec(u,f,p,b):(P._visibility|=2,mm(u,f,p,b,(f.subtreeFlags&10256)!==0)),C&2048&&MI(j,f);break;case 24:Ec(u,f,p,b),C&2048&&DI(f.alternate,f);break;default:Ec(u,f,p,b)}}function mm(u,f,p,b,C){for(C=C&&(f.subtreeFlags&10256)!==0,f=f.child;f!==null;){var P=u,j=f,H=p,Q=b,ie=j.flags;switch(j.tag){case 0:case 11:case 15:mm(P,j,H,Q,C),z0(8,j);break;case 23:break;case 22:var me=j.stateNode;j.memoizedState!==null?me._visibility&2?mm(P,j,H,Q,C):Y0(P,j):(me._visibility|=2,mm(P,j,H,Q,C)),C&&ie&2048&&MI(j.alternate,j);break;case 24:mm(P,j,H,Q,C),C&&ie&2048&&DI(j.alternate,j);break;default:mm(P,j,H,Q,C)}f=f.sibling}}function Y0(u,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var p=u,b=f,C=b.flags;switch(b.tag){case 22:Y0(p,b),C&2048&&MI(b.alternate,b);break;case 24:Y0(p,b),C&2048&&DI(b.alternate,b);break;default:Y0(p,b)}f=f.sibling}}var X0=8192;function gm(u){if(u.subtreeFlags&X0)for(u=u.child;u!==null;)yj(u),u=u.sibling}function yj(u){switch(u.tag){case 26:gm(u),u.flags&X0&&u.memoizedState!==null&&Uge(Ma,u.memoizedState,u.memoizedProps);break;case 5:gm(u);break;case 3:case 4:var f=Ma;Ma=a2(u.stateNode.containerInfo),gm(u),Ma=f;break;case 22:u.memoizedState===null&&(f=u.alternate,f!==null&&f.memoizedState!==null?(f=X0,X0=16777216,gm(u),X0=f):gm(u));break;default:gm(u)}}function bj(u){var f=u.alternate;if(f!==null&&(u=f.child,u!==null)){f.child=null;do f=u.sibling,u.sibling=null,u=f;while(u!==null)}}function J0(u){var f=u.deletions;if((u.flags&16)!==0){if(f!==null)for(var p=0;p<f.length;p++){var b=f[p];pi=b,Sj(b,u)}bj(u)}if(u.subtreeFlags&10256)for(u=u.child;u!==null;)_j(u),u=u.sibling}function _j(u){switch(u.tag){case 0:case 11:case 15:J0(u),u.flags&2048&&od(9,u,u.return);break;case 3:J0(u);break;case 12:J0(u);break;case 22:var f=u.stateNode;u.memoizedState!==null&&f._visibility&2&&(u.return===null||u.return.tag!==13)?(f._visibility&=-3,YS(u)):J0(u);break;default:J0(u)}}function YS(u){var f=u.deletions;if((u.flags&16)!==0){if(f!==null)for(var p=0;p<f.length;p++){var b=f[p];pi=b,Sj(b,u)}bj(u)}for(u=u.child;u!==null;){switch(f=u,f.tag){case 0:case 11:case 15:od(8,f,f.return),YS(f);break;case 22:p=f.stateNode,p._visibility&2&&(p._visibility&=-3,YS(f));break;default:YS(f)}u=u.sibling}}function Sj(u,f){for(;pi!==null;){var p=pi;switch(p.tag){case 0:case 11:case 15:od(8,p,f);break;case 23:case 22:if(p.memoizedState!==null&&p.memoizedState.cachePool!==null){var b=p.memoizedState.cachePool.pool;b!=null&&b.refCount++}break;case 24:O0(p.memoizedState.cache)}if(b=p.child,b!==null)b.return=p,pi=b;else e:for(p=u;pi!==null;){b=pi;var C=b.sibling,P=b.return;if(fj(b),b===p){pi=null;break e}if(C!==null){C.return=P,pi=C;break e}pi=P}}}var Zme={getCacheForType:function(u){var f=Wi(zr),p=f.data.get(u);return p===void 0&&(p=u(),f.data.set(u,p)),p}},ege=typeof WeakMap=="function"?WeakMap:Map,pn=0,Nn=null,At=null,Ht=0,mn=0,co=null,ld=!1,vm=!1,NI=!1,Dl=0,hr=0,ud=0,lh=0,UI=0,Vo=0,ym=0,Q0=null,Ls=null,jI=!1,FI=0,XS=1/0,JS=null,dd=null,Li=0,fd=null,bm=null,_m=0,$I=0,BI=null,Ej=null,Z0=0,HI=null;function lo(){if((pn&2)!==0&&Ht!==0)return Ht&-Ht;if(F.T!==null){var u=am;return u!==0?u:YI()}return qe()}function wj(){Vo===0&&(Vo=(Ht&536870912)===0||rn?Je():536870912);var u=Ho.current;return u!==null&&(u.flags|=32),Vo}function uo(u,f,p){(u===Nn&&(mn===2||mn===9)||u.cancelPendingCommit!==null)&&(Sm(u,0),hd(u,Ht,Vo,!1)),wt(u,p),((pn&2)===0||u!==Nn)&&(u===Nn&&((pn&2)===0&&(lh|=p),hr===4&&hd(u,Ht,Vo,!1)),wc(u))}function Cj(u,f,p){if((pn&6)!==0)throw Error(r(327));var b=!p&&(f&124)===0&&(f&u.expiredLanes)===0||Sl(u,f),C=b?rge(u,f):GI(u,f,!0),P=b;do{if(C===0){vm&&!b&&hd(u,f,0,!1);break}else{if(p=u.current.alternate,P&&!tge(p)){C=GI(u,f,!1),P=!1;continue}if(C===2){if(P=f,u.errorRecoveryDisabledLanes&P)var j=0;else j=u.pendingLanes&-536870913,j=j!==0?j:j&536870912?536870912:0;if(j!==0){f=j;e:{var H=u;C=Q0;var Q=H.current.memoizedState.isDehydrated;if(Q&&(Sm(H,j).flags|=256),j=GI(H,j,!1),j!==2){if(NI&&!Q){H.errorRecoveryDisabledLanes|=P,lh|=P,C=4;break e}P=Ls,Ls=C,P!==null&&(Ls===null?Ls=P:Ls.push.apply(Ls,P))}C=j}if(P=!1,C!==2)continue}}if(C===1){Sm(u,0),hd(u,f,0,!0);break}e:{switch(b=u,P=C,P){case 0:case 1:throw Error(r(345));case 4:if((f&4194048)!==f)break;case 6:hd(b,f,Vo,!ld);break e;case 2:Ls=null;break;case 3:case 5:break;default:throw Error(r(329))}if((f&62914560)===f&&(C=FI+300-Dn(),10<C)){if(hd(b,f,Vo,!ld),yc(b,0,!0)!==0)break e;b.timeoutHandle=Zj(Tj.bind(null,b,p,Ls,JS,jI,f,Vo,lh,ym,ld,P,2,-0,0),C);break e}Tj(b,p,Ls,JS,jI,f,Vo,lh,ym,ld,P,0,-0,0)}}break}while(!0);wc(u)}function Tj(u,f,p,b,C,P,j,H,Q,ie,me,ve,ae,le){if(u.timeoutHandle=-1,ve=f.subtreeFlags,(ve&8192||(ve&16785408)===16785408)&&(o1={stylesheets:null,count:0,unsuspend:Nge},yj(f),ve=jge(),ve!==null)){u.cancelPendingCommit=ve(Lj.bind(null,u,f,P,p,b,C,j,H,Q,me,1,ae,le)),hd(u,P,j,!ie);return}Lj(u,f,P,p,b,C,j,H,Q)}function tge(u){for(var f=u;;){var p=f.tag;if((p===0||p===11||p===15)&&f.flags&16384&&(p=f.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var b=0;b<p.length;b++){var C=p[b],P=C.getSnapshot;C=C.value;try{if(!io(P(),C))return!1}catch{return!1}}if(p=f.child,f.subtreeFlags&16384&&p!==null)p.return=f,f=p;else{if(f===u)break;for(;f.sibling===null;){if(f.return===null||f.return===u)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function hd(u,f,p,b){f&=~UI,f&=~lh,u.suspendedLanes|=f,u.pingedLanes&=~f,b&&(u.warmLanes|=f),b=u.expirationTimes;for(var C=f;0<C;){var P=31-xi(C),j=1<<P;b[P]=-1,C&=~j}p!==0&&Gr(u,p,f)}function QS(){return(pn&6)===0?(e1(0),!1):!0}function VI(){if(At!==null){if(mn===0)var u=At.return;else u=At,Il=rh=null,oI(u),hm=null,q0=0,u=At;for(;u!==null;)ij(u.alternate,u),u=u.return;At=null}}function Sm(u,f){var p=u.timeoutHandle;p!==-1&&(u.timeoutHandle=-1,bge(p)),p=u.cancelPendingCommit,p!==null&&(u.cancelPendingCommit=null,p()),VI(),Nn=u,At=p=Cl(u.current,null),Ht=f,mn=0,co=null,ld=!1,vm=Sl(u,f),NI=!1,ym=Vo=UI=lh=ud=hr=0,Ls=Q0=null,jI=!1,(f&8)!==0&&(f|=f&32);var b=u.entangledLanes;if(b!==0)for(u=u.entanglements,b&=f;0<b;){var C=31-xi(b),P=1<<C;f|=u[C],b&=~P}return Dl=f,_S(),p}function Rj(u,f){Rt=null,F.H=FS,f===D0||f===xS?(f=VN(),mn=3):f===$N?(f=VN(),mn=4):mn=f===qU?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,co=f,At===null&&(hr=1,qS(u,jo(f,u.current)))}function Ij(){var u=F.H;return F.H=FS,u===null?FS:u}function kj(){var u=F.A;return F.A=Zme,u}function qI(){hr=4,ld||(Ht&4194048)!==Ht&&Ho.current!==null||(vm=!0),(ud&134217727)===0&&(lh&134217727)===0||Nn===null||hd(Nn,Ht,Vo,!1)}function GI(u,f,p){var b=pn;pn|=2;var C=Ij(),P=kj();(Nn!==u||Ht!==f)&&(JS=null,Sm(u,f)),f=!1;var j=hr;e:do try{if(mn!==0&&At!==null){var H=At,Q=co;switch(mn){case 8:VI(),j=6;break e;case 3:case 2:case 9:case 6:Ho.current===null&&(f=!0);var ie=mn;if(mn=0,co=null,Em(u,H,Q,ie),p&&vm){j=0;break e}break;default:ie=mn,mn=0,co=null,Em(u,H,Q,ie)}}nge(),j=hr;break}catch(me){Rj(u,me)}while(!0);return f&&u.shellSuspendCounter++,Il=rh=null,pn=b,F.H=C,F.A=P,At===null&&(Nn=null,Ht=0,_S()),j}function nge(){for(;At!==null;)xj(At)}function rge(u,f){var p=pn;pn|=2;var b=Ij(),C=kj();Nn!==u||Ht!==f?(JS=null,XS=Dn()+500,Sm(u,f)):vm=Sl(u,f);e:do try{if(mn!==0&&At!==null){f=At;var P=co;t:switch(mn){case 1:mn=0,co=null,Em(u,f,P,1);break;case 2:case 9:if(BN(P)){mn=0,co=null,Aj(f);break}f=function(){mn!==2&&mn!==9||Nn!==u||(mn=7),wc(u)},P.then(f,f);break e;case 3:mn=7;break e;case 4:mn=5;break e;case 7:BN(P)?(mn=0,co=null,Aj(f)):(mn=0,co=null,Em(u,f,P,7));break;case 5:var j=null;switch(At.tag){case 26:j=At.memoizedState;case 5:case 27:var H=At;if(!j||dF(j)){mn=0,co=null;var Q=H.sibling;if(Q!==null)At=Q;else{var ie=H.return;ie!==null?(At=ie,ZS(ie)):At=null}break t}}mn=0,co=null,Em(u,f,P,5);break;case 6:mn=0,co=null,Em(u,f,P,6);break;case 8:VI(),hr=6;break e;default:throw Error(r(462))}}ige();break}catch(me){Rj(u,me)}while(!0);return Il=rh=null,F.H=b,F.A=C,pn=p,At!==null?0:(Nn=null,Ht=0,_S(),hr)}function ige(){for(;At!==null&&!Aa();)xj(At)}function xj(u){var f=nj(u.alternate,u,Dl);u.memoizedProps=u.pendingProps,f===null?ZS(u):At=f}function Aj(u){var f=u,p=f.alternate;switch(f.tag){case 15:case 0:f=XU(p,f,f.pendingProps,f.type,void 0,Ht);break;case 11:f=XU(p,f,f.pendingProps,f.type.render,f.ref,Ht);break;case 5:oI(f);default:ij(p,f),f=At=PN(f,Dl),f=nj(p,f,Dl)}u.memoizedProps=u.pendingProps,f===null?ZS(u):At=f}function Em(u,f,p,b){Il=rh=null,oI(f),hm=null,q0=0;var C=f.return;try{if(zme(u,C,f,p,Ht)){hr=1,qS(u,jo(p,u.current)),At=null;return}}catch(P){if(C!==null)throw At=C,P;hr=1,qS(u,jo(p,u.current)),At=null;return}f.flags&32768?(rn||b===1?u=!0:vm||(Ht&536870912)!==0?u=!1:(ld=u=!0,(b===2||b===9||b===3||b===6)&&(b=Ho.current,b!==null&&b.tag===13&&(b.flags|=16384))),Pj(f,u)):ZS(f)}function ZS(u){var f=u;do{if((f.flags&32768)!==0){Pj(f,ld);return}u=f.return;var p=Yme(f.alternate,f,Dl);if(p!==null){At=p;return}if(f=f.sibling,f!==null){At=f;return}At=f=u}while(f!==null);hr===0&&(hr=5)}function Pj(u,f){do{var p=Xme(u.alternate,u);if(p!==null){p.flags&=32767,At=p;return}if(p=u.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!f&&(u=u.sibling,u!==null)){At=u;return}At=u=p}while(u!==null);hr=6,At=null}function Lj(u,f,p,b,C,P,j,H,Q){u.cancelPendingCommit=null;do e2();while(Li!==0);if((pn&6)!==0)throw Error(r(327));if(f!==null){if(f===u.current)throw Error(r(177));if(P=f.lanes|f.childLanes,P|=D4,Hn(u,p,P,j,H,Q),u===Nn&&(At=Nn=null,Ht=0),bm=f,fd=u,_m=p,$I=P,BI=C,Ej=b,(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?(u.callbackNode=null,u.callbackPriority=0,cge(Is,function(){return Uj(),null})):(u.callbackNode=null,u.callbackPriority=0),b=(f.flags&13878)!==0,(f.subtreeFlags&13878)!==0||b){b=F.T,F.T=null,C=q.p,q.p=2,j=pn,pn|=4;try{Jme(u,f,p)}finally{pn=j,q.p=C,F.T=b}}Li=1,Oj(),Mj(),Dj()}}function Oj(){if(Li===1){Li=0;var u=fd,f=bm,p=(f.flags&13878)!==0;if((f.subtreeFlags&13878)!==0||p){p=F.T,F.T=null;var b=q.p;q.p=2;var C=pn;pn|=4;try{mj(f,u);var P=rk,j=SN(u.containerInfo),H=P.focusedElem,Q=P.selectionRange;if(j!==H&&H&&H.ownerDocument&&_N(H.ownerDocument.documentElement,H)){if(Q!==null&&A4(H)){var ie=Q.start,me=Q.end;if(me===void 0&&(me=ie),"selectionStart"in H)H.selectionStart=ie,H.selectionEnd=Math.min(me,H.value.length);else{var ve=H.ownerDocument||document,ae=ve&&ve.defaultView||window;if(ae.getSelection){var le=ae.getSelection(),ct=H.textContent.length,nt=Math.min(Q.start,ct),Sn=Q.end===void 0?nt:Math.min(Q.end,ct);!le.extend&&nt>Sn&&(j=Sn,Sn=nt,nt=j);var te=bN(H,nt),ee=bN(H,Sn);if(te&&ee&&(le.rangeCount!==1||le.anchorNode!==te.node||le.anchorOffset!==te.offset||le.focusNode!==ee.node||le.focusOffset!==ee.offset)){var re=ve.createRange();re.setStart(te.node,te.offset),le.removeAllRanges(),nt>Sn?(le.addRange(re),le.extend(ee.node,ee.offset)):(re.setEnd(ee.node,ee.offset),le.addRange(re))}}}}for(ve=[],le=H;le=le.parentNode;)le.nodeType===1&&ve.push({element:le,left:le.scrollLeft,top:le.scrollTop});for(typeof H.focus=="function"&&H.focus(),H=0;H<ve.length;H++){var ge=ve[H];ge.element.scrollLeft=ge.left,ge.element.scrollTop=ge.top}}f2=!!nk,rk=nk=null}finally{pn=C,q.p=b,F.T=p}}u.current=f,Li=2}}function Mj(){if(Li===2){Li=0;var u=fd,f=bm,p=(f.flags&8772)!==0;if((f.subtreeFlags&8772)!==0||p){p=F.T,F.T=null;var b=q.p;q.p=2;var C=pn;pn|=4;try{dj(u,f.alternate,f)}finally{pn=C,q.p=b,F.T=p}}Li=3}}function Dj(){if(Li===4||Li===3){Li=0,bl();var u=fd,f=bm,p=_m,b=Ej;(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?Li=5:(Li=0,bm=fd=null,Nj(u,u.pendingLanes));var C=u.pendingLanes;if(C===0&&(dd=null),Ai(p),f=f.stateNode,ui&&typeof ui.onCommitFiberRoot=="function")try{ui.onCommitFiberRoot(mc,f,void 0,(f.current.flags&128)===128)}catch{}if(b!==null){f=F.T,C=q.p,q.p=2,F.T=null;try{for(var P=u.onRecoverableError,j=0;j<b.length;j++){var H=b[j];P(H.value,{componentStack:H.stack})}}finally{F.T=f,q.p=C}}(_m&3)!==0&&e2(),wc(u),C=u.pendingLanes,(p&4194090)!==0&&(C&42)!==0?u===HI?Z0++:(Z0=0,HI=u):Z0=0,e1(0)}}function Nj(u,f){(u.pooledCacheLanes&=f)===0&&(f=u.pooledCache,f!=null&&(u.pooledCache=null,O0(f)))}function e2(u){return Oj(),Mj(),Dj(),Uj()}function Uj(){if(Li!==5)return!1;var u=fd,f=$I;$I=0;var p=Ai(_m),b=F.T,C=q.p;try{q.p=32>p?32:p,F.T=null,p=BI,BI=null;var P=fd,j=_m;if(Li=0,bm=fd=null,_m=0,(pn&6)!==0)throw Error(r(331));var H=pn;if(pn|=4,_j(P.current),vj(P,P.current,j,p),pn=H,e1(0,!1),ui&&typeof ui.onPostCommitFiberRoot=="function")try{ui.onPostCommitFiberRoot(mc,P)}catch{}return!0}finally{q.p=C,F.T=b,Nj(u,f)}}function jj(u,f,p){f=jo(p,f),f=_I(u.stateNode,f,2),u=nd(u,f,2),u!==null&&(wt(u,2),wc(u))}function In(u,f,p){if(u.tag===3)jj(u,u,p);else for(;f!==null;){if(f.tag===3){jj(f,u,p);break}else if(f.tag===1){var b=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(dd===null||!dd.has(b))){u=jo(p,u),p=HU(2),b=nd(f,p,2),b!==null&&(VU(p,b,f,u),wt(b,2),wc(b));break}}f=f.return}}function KI(u,f,p){var b=u.pingCache;if(b===null){b=u.pingCache=new ege;var C=new Set;b.set(f,C)}else C=b.get(f),C===void 0&&(C=new Set,b.set(f,C));C.has(p)||(NI=!0,C.add(p),u=sge.bind(null,u,f,p),f.then(u,u))}function sge(u,f,p){var b=u.pingCache;b!==null&&b.delete(f),u.pingedLanes|=u.suspendedLanes&p,u.warmLanes&=~p,Nn===u&&(Ht&p)===p&&(hr===4||hr===3&&(Ht&62914560)===Ht&&300>Dn()-FI?(pn&2)===0&&Sm(u,0):UI|=p,ym===Ht&&(ym=0)),wc(u)}function Fj(u,f){f===0&&(f=Et()),u=rm(u,f),u!==null&&(wt(u,f),wc(u))}function oge(u){var f=u.memoizedState,p=0;f!==null&&(p=f.retryLane),Fj(u,p)}function age(u,f){var p=0;switch(u.tag){case 13:var b=u.stateNode,C=u.memoizedState;C!==null&&(p=C.retryLane);break;case 19:b=u.stateNode;break;case 22:b=u.stateNode._retryCache;break;default:throw Error(r(314))}b!==null&&b.delete(f),Fj(u,p)}function cge(u,f){return Mn(u,f)}var t2=null,wm=null,zI=!1,n2=!1,WI=!1,uh=0;function wc(u){u!==wm&&u.next===null&&(wm===null?t2=wm=u:wm=wm.next=u),n2=!0,zI||(zI=!0,uge())}function e1(u,f){if(!WI&&n2){WI=!0;do for(var p=!1,b=t2;b!==null;){if(u!==0){var C=b.pendingLanes;if(C===0)var P=0;else{var j=b.suspendedLanes,H=b.pingedLanes;P=(1<<31-xi(42|u)+1)-1,P&=C&~(j&~H),P=P&201326741?P&201326741|1:P?P|2:0}P!==0&&(p=!0,Vj(b,P))}else P=Ht,P=yc(b,b===Nn?P:0,b.cancelPendingCommit!==null||b.timeoutHandle!==-1),(P&3)===0||Sl(b,P)||(p=!0,Vj(b,P));b=b.next}while(p);WI=!1}}function lge(){$j()}function $j(){n2=zI=!1;var u=0;uh!==0&&(yge()&&(u=uh),uh=0);for(var f=Dn(),p=null,b=t2;b!==null;){var C=b.next,P=Bj(b,f);P===0?(b.next=null,p===null?t2=C:p.next=C,C===null&&(wm=p)):(p=b,(u!==0||(P&3)!==0)&&(n2=!0)),b=C}e1(u)}function Bj(u,f){for(var p=u.suspendedLanes,b=u.pingedLanes,C=u.expirationTimes,P=u.pendingLanes&-62914561;0<P;){var j=31-xi(P),H=1<<j,Q=C[j];Q===-1?((H&p)===0||(H&b)!==0)&&(C[j]=y0(H,f)):Q<=f&&(u.expiredLanes|=H),P&=~H}if(f=Nn,p=Ht,p=yc(u,u===f?p:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),b=u.callbackNode,p===0||u===f&&(mn===2||mn===9)||u.cancelPendingCommit!==null)return b!==null&&b!==null&&tt(b),u.callbackNode=null,u.callbackPriority=0;if((p&3)===0||Sl(u,p)){if(f=p&-p,f===u.callbackPriority)return f;switch(b!==null&&tt(b),Ai(p)){case 2:case 8:p=Pa;break;case 32:p=Is;break;case 268435456:p=Do;break;default:p=Is}return b=Hj.bind(null,u),p=Mn(p,b),u.callbackPriority=f,u.callbackNode=p,f}return b!==null&&b!==null&&tt(b),u.callbackPriority=2,u.callbackNode=null,2}function Hj(u,f){if(Li!==0&&Li!==5)return u.callbackNode=null,u.callbackPriority=0,null;var p=u.callbackNode;if(e2()&&u.callbackNode!==p)return null;var b=Ht;return b=yc(u,u===Nn?b:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),b===0?null:(Cj(u,b,f),Bj(u,Dn()),u.callbackNode!=null&&u.callbackNode===p?Hj.bind(null,u):null)}function Vj(u,f){if(e2())return null;Cj(u,f,!0)}function uge(){_ge(function(){(pn&6)!==0?Mn(Hp,lge):$j()})}function YI(){return uh===0&&(uh=Je()),uh}function qj(u){return u==null||typeof u=="symbol"||typeof u=="boolean"?null:typeof u=="function"?u:hS(""+u)}function Gj(u,f){var p=f.ownerDocument.createElement("input");return p.name=f.name,p.value=f.value,u.id&&p.setAttribute("form",u.id),f.parentNode.insertBefore(p,f),u=new FormData(u),p.parentNode.removeChild(p),u}function dge(u,f,p,b,C){if(f==="submit"&&p&&p.stateNode===C){var P=qj((C[dr]||null).action),j=b.submitter;j&&(f=(f=j[dr]||null)?qj(f.formAction):j.getAttribute("formAction"),f!==null&&(P=f,j=null));var H=new vS("action","action",null,b,C);u.push({event:H,listeners:[{instance:null,listener:function(){if(b.defaultPrevented){if(uh!==0){var Q=j?Gj(C,j):new FormData(C);mI(p,{pending:!0,data:Q,method:C.method,action:P},null,Q)}}else typeof P=="function"&&(H.preventDefault(),Q=j?Gj(C,j):new FormData(C),mI(p,{pending:!0,data:Q,method:C.method,action:P},P,Q))},currentTarget:C}]})}}for(var XI=0;XI<M4.length;XI++){var JI=M4[XI],fge=JI.toLowerCase(),hge=JI[0].toUpperCase()+JI.slice(1);Oa(fge,"on"+hge)}Oa(CN,"onAnimationEnd"),Oa(TN,"onAnimationIteration"),Oa(RN,"onAnimationStart"),Oa("dblclick","onDoubleClick"),Oa("focusin","onFocus"),Oa("focusout","onBlur"),Oa(Ame,"onTransitionRun"),Oa(Pme,"onTransitionStart"),Oa(Lme,"onTransitionCancel"),Oa(IN,"onTransitionEnd"),zp("onMouseEnter",["mouseout","mouseover"]),zp("onMouseLeave",["mouseout","mouseover"]),zp("onPointerEnter",["pointerout","pointerover"]),zp("onPointerLeave",["pointerout","pointerover"]),Wf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Wf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Wf("onBeforeInput",["compositionend","keypress","textInput","paste"]),Wf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Wf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Wf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var t1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pge=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(t1));function Kj(u,f){f=(f&4)!==0;for(var p=0;p<u.length;p++){var b=u[p],C=b.event;b=b.listeners;e:{var P=void 0;if(f)for(var j=b.length-1;0<=j;j--){var H=b[j],Q=H.instance,ie=H.currentTarget;if(H=H.listener,Q!==P&&C.isPropagationStopped())break e;P=H,C.currentTarget=ie;try{P(C)}catch(me){VS(me)}C.currentTarget=null,P=Q}else for(j=0;j<b.length;j++){if(H=b[j],Q=H.instance,ie=H.currentTarget,H=H.listener,Q!==P&&C.isPropagationStopped())break e;P=H,C.currentTarget=ie;try{P(C)}catch(me){VS(me)}C.currentTarget=null,P=Q}}}}function Pt(u,f){var p=f[Kf];p===void 0&&(p=f[Kf]=new Set);var b=u+"__bubble";p.has(b)||(zj(f,u,2,!1),p.add(b))}function QI(u,f,p){var b=0;f&&(b|=4),zj(p,u,b,f)}var r2="_reactListening"+Math.random().toString(36).slice(2);function ZI(u){if(!u[r2]){u[r2]=!0,$D.forEach(function(p){p!=="selectionchange"&&(pge.has(p)||QI(p,!1,u),QI(p,!0,u))});var f=u.nodeType===9?u:u.ownerDocument;f===null||f[r2]||(f[r2]=!0,QI("selectionchange",!1,f))}}function zj(u,f,p,b){switch(vF(f)){case 2:var C=Bge;break;case 8:C=Hge;break;default:C=hk}p=C.bind(null,f,p,u),C=void 0,!S4||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(C=!0),b?C!==void 0?u.addEventListener(f,p,{capture:!0,passive:C}):u.addEventListener(f,p,!0):C!==void 0?u.addEventListener(f,p,{passive:C}):u.addEventListener(f,p,!1)}function ek(u,f,p,b,C){var P=b;if((f&1)===0&&(f&2)===0&&b!==null)e:for(;;){if(b===null)return;var j=b.tag;if(j===3||j===4){var H=b.stateNode.containerInfo;if(H===C)break;if(j===4)for(j=b.return;j!==null;){var Q=j.tag;if((Q===3||Q===4)&&j.stateNode.containerInfo===C)return;j=j.return}for(;H!==null;){if(j=qp(H),j===null)return;if(Q=j.tag,Q===5||Q===6||Q===26||Q===27){b=P=j;continue e}H=H.parentNode}}b=b.return}eN(function(){var ie=P,me=b4(p),ve=[];e:{var ae=kN.get(u);if(ae!==void 0){var le=vS,ct=u;switch(u){case"keypress":if(mS(p)===0)break e;case"keydown":case"keyup":le=cme;break;case"focusin":ct="focus",le=T4;break;case"focusout":ct="blur",le=T4;break;case"beforeblur":case"afterblur":le=T4;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":le=rN;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":le=Xpe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":le=dme;break;case CN:case TN:case RN:le=Zpe;break;case IN:le=hme;break;case"scroll":case"scrollend":le=Wpe;break;case"wheel":le=mme;break;case"copy":case"cut":case"paste":le=tme;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":le=sN;break;case"toggle":case"beforetoggle":le=vme}var nt=(f&4)!==0,Sn=!nt&&(u==="scroll"||u==="scrollend"),te=nt?ae!==null?ae+"Capture":null:ae;nt=[];for(var ee=ie,re;ee!==null;){var ge=ee;if(re=ge.stateNode,ge=ge.tag,ge!==5&&ge!==26&&ge!==27||re===null||te===null||(ge=_0(ee,te),ge!=null&&nt.push(n1(ee,ge,re))),Sn)break;ee=ee.return}0<nt.length&&(ae=new le(ae,ct,null,p,me),ve.push({event:ae,listeners:nt}))}}if((f&7)===0){e:{if(ae=u==="mouseover"||u==="pointerover",le=u==="mouseout"||u==="pointerout",ae&&p!==y4&&(ct=p.relatedTarget||p.fromElement)&&(qp(ct)||ct[La]))break e;if((le||ae)&&(ae=me.window===me?me:(ae=me.ownerDocument)?ae.defaultView||ae.parentWindow:window,le?(ct=p.relatedTarget||p.toElement,le=ie,ct=ct?qp(ct):null,ct!==null&&(Sn=s(ct),nt=ct.tag,ct!==Sn||nt!==5&&nt!==27&&nt!==6)&&(ct=null)):(le=null,ct=ie),le!==ct)){if(nt=rN,ge="onMouseLeave",te="onMouseEnter",ee="mouse",(u==="pointerout"||u==="pointerover")&&(nt=sN,ge="onPointerLeave",te="onPointerEnter",ee="pointer"),Sn=le==null?ae:b0(le),re=ct==null?ae:b0(ct),ae=new nt(ge,ee+"leave",le,p,me),ae.target=Sn,ae.relatedTarget=re,ge=null,qp(me)===ie&&(nt=new nt(te,ee+"enter",ct,p,me),nt.target=re,nt.relatedTarget=Sn,ge=nt),Sn=ge,le&&ct)t:{for(nt=le,te=ct,ee=0,re=nt;re;re=Cm(re))ee++;for(re=0,ge=te;ge;ge=Cm(ge))re++;for(;0<ee-re;)nt=Cm(nt),ee--;for(;0<re-ee;)te=Cm(te),re--;for(;ee--;){if(nt===te||te!==null&&nt===te.alternate)break t;nt=Cm(nt),te=Cm(te)}nt=null}else nt=null;le!==null&&Wj(ve,ae,le,nt,!1),ct!==null&&Sn!==null&&Wj(ve,Sn,ct,nt,!0)}}e:{if(ae=ie?b0(ie):window,le=ae.nodeName&&ae.nodeName.toLowerCase(),le==="select"||le==="input"&&ae.type==="file")var Fe=hN;else if(dN(ae))if(pN)Fe=Ime;else{Fe=Tme;var kt=Cme}else le=ae.nodeName,!le||le.toLowerCase()!=="input"||ae.type!=="checkbox"&&ae.type!=="radio"?ie&&v4(ie.elementType)&&(Fe=hN):Fe=Rme;if(Fe&&(Fe=Fe(u,ie))){fN(ve,Fe,p,me);break e}kt&&kt(u,ae,ie),u==="focusout"&&ie&&ae.type==="number"&&ie.memoizedProps.value!=null&&g4(ae,"number",ae.value)}switch(kt=ie?b0(ie):window,u){case"focusin":(dN(kt)||kt.contentEditable==="true")&&(em=kt,P4=ie,k0=null);break;case"focusout":k0=P4=em=null;break;case"mousedown":L4=!0;break;case"contextmenu":case"mouseup":case"dragend":L4=!1,EN(ve,p,me);break;case"selectionchange":if(xme)break;case"keydown":case"keyup":EN(ve,p,me)}var Ge;if(I4)e:{switch(u){case"compositionstart":var it="onCompositionStart";break e;case"compositionend":it="onCompositionEnd";break e;case"compositionupdate":it="onCompositionUpdate";break e}it=void 0}else Zp?lN(u,p)&&(it="onCompositionEnd"):u==="keydown"&&p.keyCode===229&&(it="onCompositionStart");it&&(oN&&p.locale!=="ko"&&(Zp||it!=="onCompositionStart"?it==="onCompositionEnd"&&Zp&&(Ge=tN()):(Qu=me,E4="value"in Qu?Qu.value:Qu.textContent,Zp=!0)),kt=i2(ie,it),0<kt.length&&(it=new iN(it,u,null,p,me),ve.push({event:it,listeners:kt}),Ge?it.data=Ge:(Ge=uN(p),Ge!==null&&(it.data=Ge)))),(Ge=bme?_me(u,p):Sme(u,p))&&(it=i2(ie,"onBeforeInput"),0<it.length&&(kt=new iN("onBeforeInput","beforeinput",null,p,me),ve.push({event:kt,listeners:it}),kt.data=Ge)),dge(ve,u,ie,p,me)}Kj(ve,f)})}function n1(u,f,p){return{instance:u,listener:f,currentTarget:p}}function i2(u,f){for(var p=f+"Capture",b=[];u!==null;){var C=u,P=C.stateNode;if(C=C.tag,C!==5&&C!==26&&C!==27||P===null||(C=_0(u,p),C!=null&&b.unshift(n1(u,C,P)),C=_0(u,f),C!=null&&b.push(n1(u,C,P))),u.tag===3)return b;u=u.return}return[]}function Cm(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5&&u.tag!==27);return u||null}function Wj(u,f,p,b,C){for(var P=f._reactName,j=[];p!==null&&p!==b;){var H=p,Q=H.alternate,ie=H.stateNode;if(H=H.tag,Q!==null&&Q===b)break;H!==5&&H!==26&&H!==27||ie===null||(Q=ie,C?(ie=_0(p,P),ie!=null&&j.unshift(n1(p,ie,Q))):C||(ie=_0(p,P),ie!=null&&j.push(n1(p,ie,Q)))),p=p.return}j.length!==0&&u.push({event:f,listeners:j})}var mge=/\r\n?/g,gge=/\u0000|\uFFFD/g;function Yj(u){return(typeof u=="string"?u:""+u).replace(mge,`
`).replace(gge,"")}function Xj(u,f){return f=Yj(f),Yj(u)===f}function s2(){}function _n(u,f,p,b,C,P){switch(p){case"children":typeof b=="string"?f==="body"||f==="textarea"&&b===""||Xp(u,b):(typeof b=="number"||typeof b=="bigint")&&f!=="body"&&Xp(u,""+b);break;case"className":uS(u,"class",b);break;case"tabIndex":uS(u,"tabindex",b);break;case"dir":case"role":case"viewBox":case"width":case"height":uS(u,p,b);break;case"style":QD(u,b,P);break;case"data":if(f!=="object"){uS(u,"data",b);break}case"src":case"href":if(b===""&&(f!=="a"||p!=="href")){u.removeAttribute(p);break}if(b==null||typeof b=="function"||typeof b=="symbol"||typeof b=="boolean"){u.removeAttribute(p);break}b=hS(""+b),u.setAttribute(p,b);break;case"action":case"formAction":if(typeof b=="function"){u.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof P=="function"&&(p==="formAction"?(f!=="input"&&_n(u,f,"name",C.name,C,null),_n(u,f,"formEncType",C.formEncType,C,null),_n(u,f,"formMethod",C.formMethod,C,null),_n(u,f,"formTarget",C.formTarget,C,null)):(_n(u,f,"encType",C.encType,C,null),_n(u,f,"method",C.method,C,null),_n(u,f,"target",C.target,C,null)));if(b==null||typeof b=="symbol"||typeof b=="boolean"){u.removeAttribute(p);break}b=hS(""+b),u.setAttribute(p,b);break;case"onClick":b!=null&&(u.onclick=s2);break;case"onScroll":b!=null&&Pt("scroll",u);break;case"onScrollEnd":b!=null&&Pt("scrollend",u);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(r(61));if(p=b.__html,p!=null){if(C.children!=null)throw Error(r(60));u.innerHTML=p}}break;case"multiple":u.multiple=b&&typeof b!="function"&&typeof b!="symbol";break;case"muted":u.muted=b&&typeof b!="function"&&typeof b!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(b==null||typeof b=="function"||typeof b=="boolean"||typeof b=="symbol"){u.removeAttribute("xlink:href");break}p=hS(""+b),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":b!=null&&typeof b!="function"&&typeof b!="symbol"?u.setAttribute(p,""+b):u.removeAttribute(p);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":b&&typeof b!="function"&&typeof b!="symbol"?u.setAttribute(p,""):u.removeAttribute(p);break;case"capture":case"download":b===!0?u.setAttribute(p,""):b!==!1&&b!=null&&typeof b!="function"&&typeof b!="symbol"?u.setAttribute(p,b):u.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":b!=null&&typeof b!="function"&&typeof b!="symbol"&&!isNaN(b)&&1<=b?u.setAttribute(p,b):u.removeAttribute(p);break;case"rowSpan":case"start":b==null||typeof b=="function"||typeof b=="symbol"||isNaN(b)?u.removeAttribute(p):u.setAttribute(p,b);break;case"popover":Pt("beforetoggle",u),Pt("toggle",u),lS(u,"popover",b);break;case"xlinkActuate":El(u,"http://www.w3.org/1999/xlink","xlink:actuate",b);break;case"xlinkArcrole":El(u,"http://www.w3.org/1999/xlink","xlink:arcrole",b);break;case"xlinkRole":El(u,"http://www.w3.org/1999/xlink","xlink:role",b);break;case"xlinkShow":El(u,"http://www.w3.org/1999/xlink","xlink:show",b);break;case"xlinkTitle":El(u,"http://www.w3.org/1999/xlink","xlink:title",b);break;case"xlinkType":El(u,"http://www.w3.org/1999/xlink","xlink:type",b);break;case"xmlBase":El(u,"http://www.w3.org/XML/1998/namespace","xml:base",b);break;case"xmlLang":El(u,"http://www.w3.org/XML/1998/namespace","xml:lang",b);break;case"xmlSpace":El(u,"http://www.w3.org/XML/1998/namespace","xml:space",b);break;case"is":lS(u,"is",b);break;case"innerText":case"textContent":break;default:(!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(p=Kpe.get(p)||p,lS(u,p,b))}}function tk(u,f,p,b,C,P){switch(p){case"style":QD(u,b,P);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(r(61));if(p=b.__html,p!=null){if(C.children!=null)throw Error(r(60));u.innerHTML=p}}break;case"children":typeof b=="string"?Xp(u,b):(typeof b=="number"||typeof b=="bigint")&&Xp(u,""+b);break;case"onScroll":b!=null&&Pt("scroll",u);break;case"onScrollEnd":b!=null&&Pt("scrollend",u);break;case"onClick":b!=null&&(u.onclick=s2);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!BD.hasOwnProperty(p))e:{if(p[0]==="o"&&p[1]==="n"&&(C=p.endsWith("Capture"),f=p.slice(2,C?p.length-7:void 0),P=u[dr]||null,P=P!=null?P[p]:null,typeof P=="function"&&u.removeEventListener(f,P,C),typeof b=="function")){typeof P!="function"&&P!==null&&(p in u?u[p]=null:u.hasAttribute(p)&&u.removeAttribute(p)),u.addEventListener(f,b,C);break e}p in u?u[p]=b:b===!0?u.setAttribute(p,""):lS(u,p,b)}}}function Oi(u,f,p){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Pt("error",u),Pt("load",u);var b=!1,C=!1,P;for(P in p)if(p.hasOwnProperty(P)){var j=p[P];if(j!=null)switch(P){case"src":b=!0;break;case"srcSet":C=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,f));default:_n(u,f,P,j,p,null)}}C&&_n(u,f,"srcSet",p.srcSet,p,null),b&&_n(u,f,"src",p.src,p,null);return;case"input":Pt("invalid",u);var H=P=j=C=null,Q=null,ie=null;for(b in p)if(p.hasOwnProperty(b)){var me=p[b];if(me!=null)switch(b){case"name":C=me;break;case"type":j=me;break;case"checked":Q=me;break;case"defaultChecked":ie=me;break;case"value":P=me;break;case"defaultValue":H=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(r(137,f));break;default:_n(u,f,b,me,p,null)}}WD(u,P,H,Q,ie,j,C,!1),dS(u);return;case"select":Pt("invalid",u),b=j=P=null;for(C in p)if(p.hasOwnProperty(C)&&(H=p[C],H!=null))switch(C){case"value":P=H;break;case"defaultValue":j=H;break;case"multiple":b=H;default:_n(u,f,C,H,p,null)}f=P,p=j,u.multiple=!!b,f!=null?Yp(u,!!b,f,!1):p!=null&&Yp(u,!!b,p,!0);return;case"textarea":Pt("invalid",u),P=C=b=null;for(j in p)if(p.hasOwnProperty(j)&&(H=p[j],H!=null))switch(j){case"value":b=H;break;case"defaultValue":C=H;break;case"children":P=H;break;case"dangerouslySetInnerHTML":if(H!=null)throw Error(r(91));break;default:_n(u,f,j,H,p,null)}XD(u,b,C,P),dS(u);return;case"option":for(Q in p)if(p.hasOwnProperty(Q)&&(b=p[Q],b!=null))switch(Q){case"selected":u.selected=b&&typeof b!="function"&&typeof b!="symbol";break;default:_n(u,f,Q,b,p,null)}return;case"dialog":Pt("beforetoggle",u),Pt("toggle",u),Pt("cancel",u),Pt("close",u);break;case"iframe":case"object":Pt("load",u);break;case"video":case"audio":for(b=0;b<t1.length;b++)Pt(t1[b],u);break;case"image":Pt("error",u),Pt("load",u);break;case"details":Pt("toggle",u);break;case"embed":case"source":case"link":Pt("error",u),Pt("load",u);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ie in p)if(p.hasOwnProperty(ie)&&(b=p[ie],b!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,f));default:_n(u,f,ie,b,p,null)}return;default:if(v4(f)){for(me in p)p.hasOwnProperty(me)&&(b=p[me],b!==void 0&&tk(u,f,me,b,p,void 0));return}}for(H in p)p.hasOwnProperty(H)&&(b=p[H],b!=null&&_n(u,f,H,b,p,null))}function vge(u,f,p,b){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var C=null,P=null,j=null,H=null,Q=null,ie=null,me=null;for(le in p){var ve=p[le];if(p.hasOwnProperty(le)&&ve!=null)switch(le){case"checked":break;case"value":break;case"defaultValue":Q=ve;default:b.hasOwnProperty(le)||_n(u,f,le,null,b,ve)}}for(var ae in b){var le=b[ae];if(ve=p[ae],b.hasOwnProperty(ae)&&(le!=null||ve!=null))switch(ae){case"type":P=le;break;case"name":C=le;break;case"checked":ie=le;break;case"defaultChecked":me=le;break;case"value":j=le;break;case"defaultValue":H=le;break;case"children":case"dangerouslySetInnerHTML":if(le!=null)throw Error(r(137,f));break;default:le!==ve&&_n(u,f,ae,le,b,ve)}}m4(u,j,H,Q,ie,me,P,C);return;case"select":le=j=H=ae=null;for(P in p)if(Q=p[P],p.hasOwnProperty(P)&&Q!=null)switch(P){case"value":break;case"multiple":le=Q;default:b.hasOwnProperty(P)||_n(u,f,P,null,b,Q)}for(C in b)if(P=b[C],Q=p[C],b.hasOwnProperty(C)&&(P!=null||Q!=null))switch(C){case"value":ae=P;break;case"defaultValue":H=P;break;case"multiple":j=P;default:P!==Q&&_n(u,f,C,P,b,Q)}f=H,p=j,b=le,ae!=null?Yp(u,!!p,ae,!1):!!b!=!!p&&(f!=null?Yp(u,!!p,f,!0):Yp(u,!!p,p?[]:"",!1));return;case"textarea":le=ae=null;for(H in p)if(C=p[H],p.hasOwnProperty(H)&&C!=null&&!b.hasOwnProperty(H))switch(H){case"value":break;case"children":break;default:_n(u,f,H,null,b,C)}for(j in b)if(C=b[j],P=p[j],b.hasOwnProperty(j)&&(C!=null||P!=null))switch(j){case"value":ae=C;break;case"defaultValue":le=C;break;case"children":break;case"dangerouslySetInnerHTML":if(C!=null)throw Error(r(91));break;default:C!==P&&_n(u,f,j,C,b,P)}YD(u,ae,le);return;case"option":for(var ct in p)if(ae=p[ct],p.hasOwnProperty(ct)&&ae!=null&&!b.hasOwnProperty(ct))switch(ct){case"selected":u.selected=!1;break;default:_n(u,f,ct,null,b,ae)}for(Q in b)if(ae=b[Q],le=p[Q],b.hasOwnProperty(Q)&&ae!==le&&(ae!=null||le!=null))switch(Q){case"selected":u.selected=ae&&typeof ae!="function"&&typeof ae!="symbol";break;default:_n(u,f,Q,ae,b,le)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var nt in p)ae=p[nt],p.hasOwnProperty(nt)&&ae!=null&&!b.hasOwnProperty(nt)&&_n(u,f,nt,null,b,ae);for(ie in b)if(ae=b[ie],le=p[ie],b.hasOwnProperty(ie)&&ae!==le&&(ae!=null||le!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(r(137,f));break;default:_n(u,f,ie,ae,b,le)}return;default:if(v4(f)){for(var Sn in p)ae=p[Sn],p.hasOwnProperty(Sn)&&ae!==void 0&&!b.hasOwnProperty(Sn)&&tk(u,f,Sn,void 0,b,ae);for(me in b)ae=b[me],le=p[me],!b.hasOwnProperty(me)||ae===le||ae===void 0&&le===void 0||tk(u,f,me,ae,b,le);return}}for(var te in p)ae=p[te],p.hasOwnProperty(te)&&ae!=null&&!b.hasOwnProperty(te)&&_n(u,f,te,null,b,ae);for(ve in b)ae=b[ve],le=p[ve],!b.hasOwnProperty(ve)||ae===le||ae==null&&le==null||_n(u,f,ve,ae,b,le)}var nk=null,rk=null;function o2(u){return u.nodeType===9?u:u.ownerDocument}function Jj(u){switch(u){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Qj(u,f){if(u===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return u===1&&f==="foreignObject"?0:u}function ik(u,f){return u==="textarea"||u==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var sk=null;function yge(){var u=window.event;return u&&u.type==="popstate"?u===sk?!1:(sk=u,!0):(sk=null,!1)}var Zj=typeof setTimeout=="function"?setTimeout:void 0,bge=typeof clearTimeout=="function"?clearTimeout:void 0,eF=typeof Promise=="function"?Promise:void 0,_ge=typeof queueMicrotask=="function"?queueMicrotask:typeof eF<"u"?function(u){return eF.resolve(null).then(u).catch(Sge)}:Zj;function Sge(u){setTimeout(function(){throw u})}function pd(u){return u==="head"}function tF(u,f){var p=f,b=0,C=0;do{var P=p.nextSibling;if(u.removeChild(p),P&&P.nodeType===8)if(p=P.data,p==="/$"){if(0<b&&8>b){p=b;var j=u.ownerDocument;if(p&1&&r1(j.documentElement),p&2&&r1(j.body),p&4)for(p=j.head,r1(p),j=p.firstChild;j;){var H=j.nextSibling,Q=j.nodeName;j[zf]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&j.rel.toLowerCase()==="stylesheet"||p.removeChild(j),j=H}}if(C===0){u.removeChild(P),d1(f);return}C--}else p==="$"||p==="$?"||p==="$!"?C++:b=p.charCodeAt(0)-48;else b=0;p=P}while(p);d1(f)}function ok(u){var f=u.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var p=f;switch(f=f.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":ok(p),d4(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}u.removeChild(p)}}function Ege(u,f,p,b){for(;u.nodeType===1;){var C=p;if(u.nodeName.toLowerCase()!==f.toLowerCase()){if(!b&&(u.nodeName!=="INPUT"||u.type!=="hidden"))break}else if(b){if(!u[zf])switch(f){case"meta":if(!u.hasAttribute("itemprop"))break;return u;case"link":if(P=u.getAttribute("rel"),P==="stylesheet"&&u.hasAttribute("data-precedence"))break;if(P!==C.rel||u.getAttribute("href")!==(C.href==null||C.href===""?null:C.href)||u.getAttribute("crossorigin")!==(C.crossOrigin==null?null:C.crossOrigin)||u.getAttribute("title")!==(C.title==null?null:C.title))break;return u;case"style":if(u.hasAttribute("data-precedence"))break;return u;case"script":if(P=u.getAttribute("src"),(P!==(C.src==null?null:C.src)||u.getAttribute("type")!==(C.type==null?null:C.type)||u.getAttribute("crossorigin")!==(C.crossOrigin==null?null:C.crossOrigin))&&P&&u.hasAttribute("async")&&!u.hasAttribute("itemprop"))break;return u;default:return u}}else if(f==="input"&&u.type==="hidden"){var P=C.name==null?null:""+C.name;if(C.type==="hidden"&&u.getAttribute("name")===P)return u}else return u;if(u=Da(u.nextSibling),u===null)break}return null}function wge(u,f,p){if(f==="")return null;for(;u.nodeType!==3;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!p||(u=Da(u.nextSibling),u===null))return null;return u}function ak(u){return u.data==="$!"||u.data==="$?"&&u.ownerDocument.readyState==="complete"}function Cge(u,f){var p=u.ownerDocument;if(u.data!=="$?"||p.readyState==="complete")f();else{var b=function(){f(),p.removeEventListener("DOMContentLoaded",b)};p.addEventListener("DOMContentLoaded",b),u._reactRetry=b}}function Da(u){for(;u!=null;u=u.nextSibling){var f=u.nodeType;if(f===1||f===3)break;if(f===8){if(f=u.data,f==="$"||f==="$!"||f==="$?"||f==="F!"||f==="F")break;if(f==="/$")return null}}return u}var ck=null;function nF(u){u=u.previousSibling;for(var f=0;u;){if(u.nodeType===8){var p=u.data;if(p==="$"||p==="$!"||p==="$?"){if(f===0)return u;f--}else p==="/$"&&f++}u=u.previousSibling}return null}function rF(u,f,p){switch(f=o2(p),u){case"html":if(u=f.documentElement,!u)throw Error(r(452));return u;case"head":if(u=f.head,!u)throw Error(r(453));return u;case"body":if(u=f.body,!u)throw Error(r(454));return u;default:throw Error(r(451))}}function r1(u){for(var f=u.attributes;f.length;)u.removeAttributeNode(f[0]);d4(u)}var qo=new Map,iF=new Set;function a2(u){return typeof u.getRootNode=="function"?u.getRootNode():u.nodeType===9?u:u.ownerDocument}var Nl=q.d;q.d={f:Tge,r:Rge,D:Ige,C:kge,L:xge,m:Age,X:Lge,S:Pge,M:Oge};function Tge(){var u=Nl.f(),f=QS();return u||f}function Rge(u){var f=Gp(u);f!==null&&f.tag===5&&f.type==="form"?CU(f):Nl.r(u)}var Tm=typeof document>"u"?null:document;function sF(u,f,p){var b=Tm;if(b&&typeof f=="string"&&f){var C=Uo(f);C='link[rel="'+u+'"][href="'+C+'"]',typeof p=="string"&&(C+='[crossorigin="'+p+'"]'),iF.has(C)||(iF.add(C),u={rel:u,crossOrigin:p,href:f},b.querySelector(C)===null&&(f=b.createElement("link"),Oi(f,"link",u),fi(f),b.head.appendChild(f)))}}function Ige(u){Nl.D(u),sF("dns-prefetch",u,null)}function kge(u,f){Nl.C(u,f),sF("preconnect",u,f)}function xge(u,f,p){Nl.L(u,f,p);var b=Tm;if(b&&u&&f){var C='link[rel="preload"][as="'+Uo(f)+'"]';f==="image"&&p&&p.imageSrcSet?(C+='[imagesrcset="'+Uo(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(C+='[imagesizes="'+Uo(p.imageSizes)+'"]')):C+='[href="'+Uo(u)+'"]';var P=C;switch(f){case"style":P=Rm(u);break;case"script":P=Im(u)}qo.has(P)||(u=d({rel:"preload",href:f==="image"&&p&&p.imageSrcSet?void 0:u,as:f},p),qo.set(P,u),b.querySelector(C)!==null||f==="style"&&b.querySelector(i1(P))||f==="script"&&b.querySelector(s1(P))||(f=b.createElement("link"),Oi(f,"link",u),fi(f),b.head.appendChild(f)))}}function Age(u,f){Nl.m(u,f);var p=Tm;if(p&&u){var b=f&&typeof f.as=="string"?f.as:"script",C='link[rel="modulepreload"][as="'+Uo(b)+'"][href="'+Uo(u)+'"]',P=C;switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":P=Im(u)}if(!qo.has(P)&&(u=d({rel:"modulepreload",href:u},f),qo.set(P,u),p.querySelector(C)===null)){switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(s1(P)))return}b=p.createElement("link"),Oi(b,"link",u),fi(b),p.head.appendChild(b)}}}function Pge(u,f,p){Nl.S(u,f,p);var b=Tm;if(b&&u){var C=Kp(b).hoistableStyles,P=Rm(u);f=f||"default";var j=C.get(P);if(!j){var H={loading:0,preload:null};if(j=b.querySelector(i1(P)))H.loading=5;else{u=d({rel:"stylesheet",href:u,"data-precedence":f},p),(p=qo.get(P))&&lk(u,p);var Q=j=b.createElement("link");fi(Q),Oi(Q,"link",u),Q._p=new Promise(function(ie,me){Q.onload=ie,Q.onerror=me}),Q.addEventListener("load",function(){H.loading|=1}),Q.addEventListener("error",function(){H.loading|=2}),H.loading|=4,c2(j,f,b)}j={type:"stylesheet",instance:j,count:1,state:H},C.set(P,j)}}}function Lge(u,f){Nl.X(u,f);var p=Tm;if(p&&u){var b=Kp(p).hoistableScripts,C=Im(u),P=b.get(C);P||(P=p.querySelector(s1(C)),P||(u=d({src:u,async:!0},f),(f=qo.get(C))&&uk(u,f),P=p.createElement("script"),fi(P),Oi(P,"link",u),p.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},b.set(C,P))}}function Oge(u,f){Nl.M(u,f);var p=Tm;if(p&&u){var b=Kp(p).hoistableScripts,C=Im(u),P=b.get(C);P||(P=p.querySelector(s1(C)),P||(u=d({src:u,async:!0,type:"module"},f),(f=qo.get(C))&&uk(u,f),P=p.createElement("script"),fi(P),Oi(P,"link",u),p.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},b.set(C,P))}}function oF(u,f,p,b){var C=(C=be.current)?a2(C):null;if(!C)throw Error(r(446));switch(u){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(f=Rm(p.href),p=Kp(C).hoistableStyles,b=p.get(f),b||(b={type:"style",instance:null,count:0,state:null},p.set(f,b)),b):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){u=Rm(p.href);var P=Kp(C).hoistableStyles,j=P.get(u);if(j||(C=C.ownerDocument||C,j={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},P.set(u,j),(P=C.querySelector(i1(u)))&&!P._p&&(j.instance=P,j.state.loading=5),qo.has(u)||(p={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy},qo.set(u,p),P||Mge(C,u,p,j.state))),f&&b===null)throw Error(r(528,""));return j}if(f&&b!==null)throw Error(r(529,""));return null;case"script":return f=p.async,p=p.src,typeof p=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=Im(p),p=Kp(C).hoistableScripts,b=p.get(f),b||(b={type:"script",instance:null,count:0,state:null},p.set(f,b)),b):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,u))}}function Rm(u){return'href="'+Uo(u)+'"'}function i1(u){return'link[rel="stylesheet"]['+u+"]"}function aF(u){return d({},u,{"data-precedence":u.precedence,precedence:null})}function Mge(u,f,p,b){u.querySelector('link[rel="preload"][as="style"]['+f+"]")?b.loading=1:(f=u.createElement("link"),b.preload=f,f.addEventListener("load",function(){return b.loading|=1}),f.addEventListener("error",function(){return b.loading|=2}),Oi(f,"link",p),fi(f),u.head.appendChild(f))}function Im(u){return'[src="'+Uo(u)+'"]'}function s1(u){return"script[async]"+u}function cF(u,f,p){if(f.count++,f.instance===null)switch(f.type){case"style":var b=u.querySelector('style[data-href~="'+Uo(p.href)+'"]');if(b)return f.instance=b,fi(b),b;var C=d({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return b=(u.ownerDocument||u).createElement("style"),fi(b),Oi(b,"style",C),c2(b,p.precedence,u),f.instance=b;case"stylesheet":C=Rm(p.href);var P=u.querySelector(i1(C));if(P)return f.state.loading|=4,f.instance=P,fi(P),P;b=aF(p),(C=qo.get(C))&&lk(b,C),P=(u.ownerDocument||u).createElement("link"),fi(P);var j=P;return j._p=new Promise(function(H,Q){j.onload=H,j.onerror=Q}),Oi(P,"link",b),f.state.loading|=4,c2(P,p.precedence,u),f.instance=P;case"script":return P=Im(p.src),(C=u.querySelector(s1(P)))?(f.instance=C,fi(C),C):(b=p,(C=qo.get(P))&&(b=d({},p),uk(b,C)),u=u.ownerDocument||u,C=u.createElement("script"),fi(C),Oi(C,"link",b),u.head.appendChild(C),f.instance=C);case"void":return null;default:throw Error(r(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(b=f.instance,f.state.loading|=4,c2(b,p.precedence,u));return f.instance}function c2(u,f,p){for(var b=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),C=b.length?b[b.length-1]:null,P=C,j=0;j<b.length;j++){var H=b[j];if(H.dataset.precedence===f)P=H;else if(P!==C)break}P?P.parentNode.insertBefore(u,P.nextSibling):(f=p.nodeType===9?p.head:p,f.insertBefore(u,f.firstChild))}function lk(u,f){u.crossOrigin==null&&(u.crossOrigin=f.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=f.referrerPolicy),u.title==null&&(u.title=f.title)}function uk(u,f){u.crossOrigin==null&&(u.crossOrigin=f.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=f.referrerPolicy),u.integrity==null&&(u.integrity=f.integrity)}var l2=null;function lF(u,f,p){if(l2===null){var b=new Map,C=l2=new Map;C.set(p,b)}else C=l2,b=C.get(p),b||(b=new Map,C.set(p,b));if(b.has(u))return b;for(b.set(u,null),p=p.getElementsByTagName(u),C=0;C<p.length;C++){var P=p[C];if(!(P[zf]||P[yn]||u==="link"&&P.getAttribute("rel")==="stylesheet")&&P.namespaceURI!=="http://www.w3.org/2000/svg"){var j=P.getAttribute(f)||"";j=u+j;var H=b.get(j);H?H.push(P):b.set(j,[P])}}return b}function uF(u,f,p){u=u.ownerDocument||u,u.head.insertBefore(p,f==="title"?u.querySelector("head > title"):null)}function Dge(u,f,p){if(p===1||f.itemProp!=null)return!1;switch(u){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;switch(f.rel){case"stylesheet":return u=f.disabled,typeof f.precedence=="string"&&u==null;default:return!0}case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function dF(u){return!(u.type==="stylesheet"&&(u.state.loading&3)===0)}var o1=null;function Nge(){}function Uge(u,f,p){if(o1===null)throw Error(r(475));var b=o1;if(f.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var C=Rm(p.href),P=u.querySelector(i1(C));if(P){u=P._p,u!==null&&typeof u=="object"&&typeof u.then=="function"&&(b.count++,b=u2.bind(b),u.then(b,b)),f.state.loading|=4,f.instance=P,fi(P);return}P=u.ownerDocument||u,p=aF(p),(C=qo.get(C))&&lk(p,C),P=P.createElement("link"),fi(P);var j=P;j._p=new Promise(function(H,Q){j.onload=H,j.onerror=Q}),Oi(P,"link",p),f.instance=P}b.stylesheets===null&&(b.stylesheets=new Map),b.stylesheets.set(f,u),(u=f.state.preload)&&(f.state.loading&3)===0&&(b.count++,f=u2.bind(b),u.addEventListener("load",f),u.addEventListener("error",f))}}function jge(){if(o1===null)throw Error(r(475));var u=o1;return u.stylesheets&&u.count===0&&dk(u,u.stylesheets),0<u.count?function(f){var p=setTimeout(function(){if(u.stylesheets&&dk(u,u.stylesheets),u.unsuspend){var b=u.unsuspend;u.unsuspend=null,b()}},6e4);return u.unsuspend=f,function(){u.unsuspend=null,clearTimeout(p)}}:null}function u2(){if(this.count--,this.count===0){if(this.stylesheets)dk(this,this.stylesheets);else if(this.unsuspend){var u=this.unsuspend;this.unsuspend=null,u()}}}var d2=null;function dk(u,f){u.stylesheets=null,u.unsuspend!==null&&(u.count++,d2=new Map,f.forEach(Fge,u),d2=null,u2.call(u))}function Fge(u,f){if(!(f.state.loading&4)){var p=d2.get(u);if(p)var b=p.get(null);else{p=new Map,d2.set(u,p);for(var C=u.querySelectorAll("link[data-precedence],style[data-precedence]"),P=0;P<C.length;P++){var j=C[P];(j.nodeName==="LINK"||j.getAttribute("media")!=="not all")&&(p.set(j.dataset.precedence,j),b=j)}b&&p.set(null,b)}C=f.instance,j=C.getAttribute("data-precedence"),P=p.get(j)||b,P===b&&p.set(null,C),p.set(j,C),this.count++,b=u2.bind(this),C.addEventListener("load",b),C.addEventListener("error",b),P?P.parentNode.insertBefore(C,P.nextSibling):(u=u.nodeType===9?u.head:u,u.insertBefore(C,u.firstChild)),f.state.loading|=4}}var a1={$$typeof:x,Provider:null,Consumer:null,_currentValue:z,_currentValue2:z,_threadCount:0};function $ge(u,f,p,b,C,P,j,H){this.tag=1,this.containerInfo=u,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Vt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vt(0),this.hiddenUpdates=Vt(null),this.identifierPrefix=b,this.onUncaughtError=C,this.onCaughtError=P,this.onRecoverableError=j,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=H,this.incompleteTransitions=new Map}function fF(u,f,p,b,C,P,j,H,Q,ie,me,ve){return u=new $ge(u,f,p,j,H,Q,ie,ve),f=1,P===!0&&(f|=24),P=so(3,null,null,f),u.current=P,P.stateNode=u,f=K4(),f.refCount++,u.pooledCache=f,f.refCount++,P.memoizedState={element:b,isDehydrated:p,cache:f},X4(P),u}function hF(u){return u?(u=im,u):im}function pF(u,f,p,b,C,P){C=hF(C),b.context===null?b.context=C:b.pendingContext=C,b=td(f),b.payload={element:p},P=P===void 0?null:P,P!==null&&(b.callback=P),p=nd(u,b,f),p!==null&&(uo(p,u,f),U0(p,u,f))}function mF(u,f){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var p=u.retryLane;u.retryLane=p!==0&&p<f?p:f}}function fk(u,f){mF(u,f),(u=u.alternate)&&mF(u,f)}function gF(u){if(u.tag===13){var f=rm(u,67108864);f!==null&&uo(f,u,67108864),fk(u,67108864)}}var f2=!0;function Bge(u,f,p,b){var C=F.T;F.T=null;var P=q.p;try{q.p=2,hk(u,f,p,b)}finally{q.p=P,F.T=C}}function Hge(u,f,p,b){var C=F.T;F.T=null;var P=q.p;try{q.p=8,hk(u,f,p,b)}finally{q.p=P,F.T=C}}function hk(u,f,p,b){if(f2){var C=pk(b);if(C===null)ek(u,f,b,h2,p),yF(u,b);else if(qge(C,u,f,p,b))b.stopPropagation();else if(yF(u,b),f&4&&-1<Vge.indexOf(u)){for(;C!==null;){var P=Gp(C);if(P!==null)switch(P.tag){case 3:if(P=P.stateNode,P.current.memoizedState.isDehydrated){var j=ks(P.pendingLanes);if(j!==0){var H=P;for(H.pendingLanes|=2,H.entangledLanes|=2;j;){var Q=1<<31-xi(j);H.entanglements[1]|=Q,j&=~Q}wc(P),(pn&6)===0&&(XS=Dn()+500,e1(0))}}break;case 13:H=rm(P,2),H!==null&&uo(H,P,2),QS(),fk(P,2)}if(P=pk(b),P===null&&ek(u,f,b,h2,p),P===C)break;C=P}C!==null&&b.stopPropagation()}else ek(u,f,b,null,p)}}function pk(u){return u=b4(u),mk(u)}var h2=null;function mk(u){if(h2=null,u=qp(u),u!==null){var f=s(u);if(f===null)u=null;else{var p=f.tag;if(p===13){if(u=o(f),u!==null)return u;u=null}else if(p===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;u=null}else f!==u&&(u=null)}}return h2=u,null}function vF(u){switch(u){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(m0()){case Hp:return 2;case Pa:return 8;case Is:case g0:return 32;case Do:return 268435456;default:return 32}default:return 32}}var gk=!1,md=null,gd=null,vd=null,c1=new Map,l1=new Map,yd=[],Vge="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function yF(u,f){switch(u){case"focusin":case"focusout":md=null;break;case"dragenter":case"dragleave":gd=null;break;case"mouseover":case"mouseout":vd=null;break;case"pointerover":case"pointerout":c1.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":l1.delete(f.pointerId)}}function u1(u,f,p,b,C,P){return u===null||u.nativeEvent!==P?(u={blockedOn:f,domEventName:p,eventSystemFlags:b,nativeEvent:P,targetContainers:[C]},f!==null&&(f=Gp(f),f!==null&&gF(f)),u):(u.eventSystemFlags|=b,f=u.targetContainers,C!==null&&f.indexOf(C)===-1&&f.push(C),u)}function qge(u,f,p,b,C){switch(f){case"focusin":return md=u1(md,u,f,p,b,C),!0;case"dragenter":return gd=u1(gd,u,f,p,b,C),!0;case"mouseover":return vd=u1(vd,u,f,p,b,C),!0;case"pointerover":var P=C.pointerId;return c1.set(P,u1(c1.get(P)||null,u,f,p,b,C)),!0;case"gotpointercapture":return P=C.pointerId,l1.set(P,u1(l1.get(P)||null,u,f,p,b,C)),!0}return!1}function bF(u){var f=qp(u.target);if(f!==null){var p=s(f);if(p!==null){if(f=p.tag,f===13){if(f=o(p),f!==null){u.blockedOn=f,Wt(u.priority,function(){if(p.tag===13){var b=lo();b=Kr(b);var C=rm(p,b);C!==null&&uo(C,p,b),fk(p,b)}});return}}else if(f===3&&p.stateNode.current.memoizedState.isDehydrated){u.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}u.blockedOn=null}function p2(u){if(u.blockedOn!==null)return!1;for(var f=u.targetContainers;0<f.length;){var p=pk(u.nativeEvent);if(p===null){p=u.nativeEvent;var b=new p.constructor(p.type,p);y4=b,p.target.dispatchEvent(b),y4=null}else return f=Gp(p),f!==null&&gF(f),u.blockedOn=p,!1;f.shift()}return!0}function _F(u,f,p){p2(u)&&p.delete(f)}function Gge(){gk=!1,md!==null&&p2(md)&&(md=null),gd!==null&&p2(gd)&&(gd=null),vd!==null&&p2(vd)&&(vd=null),c1.forEach(_F),l1.forEach(_F)}function m2(u,f){u.blockedOn===f&&(u.blockedOn=null,gk||(gk=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Gge)))}var g2=null;function SF(u){g2!==u&&(g2=u,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){g2===u&&(g2=null);for(var f=0;f<u.length;f+=3){var p=u[f],b=u[f+1],C=u[f+2];if(typeof b!="function"){if(mk(b||p)===null)continue;break}var P=Gp(p);P!==null&&(u.splice(f,3),f-=3,mI(P,{pending:!0,data:C,method:p.method,action:b},b,C))}}))}function d1(u){function f(Q){return m2(Q,u)}md!==null&&m2(md,u),gd!==null&&m2(gd,u),vd!==null&&m2(vd,u),c1.forEach(f),l1.forEach(f);for(var p=0;p<yd.length;p++){var b=yd[p];b.blockedOn===u&&(b.blockedOn=null)}for(;0<yd.length&&(p=yd[0],p.blockedOn===null);)bF(p),p.blockedOn===null&&yd.shift();if(p=(u.ownerDocument||u).$$reactFormReplay,p!=null)for(b=0;b<p.length;b+=3){var C=p[b],P=p[b+1],j=C[dr]||null;if(typeof P=="function")j||SF(p);else if(j){var H=null;if(P&&P.hasAttribute("formAction")){if(C=P,j=P[dr]||null)H=j.formAction;else if(mk(C)!==null)continue}else H=j.action;typeof H=="function"?p[b+1]=H:(p.splice(b,3),b-=3),SF(p)}}}function vk(u){this._internalRoot=u}v2.prototype.render=vk.prototype.render=function(u){var f=this._internalRoot;if(f===null)throw Error(r(409));var p=f.current,b=lo();pF(p,b,u,f,null,null)},v2.prototype.unmount=vk.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var f=u.containerInfo;pF(u.current,2,null,u,null,null),QS(),f[La]=null}};function v2(u){this._internalRoot=u}v2.prototype.unstable_scheduleHydration=function(u){if(u){var f=qe();u={blockedOn:null,target:u,priority:f};for(var p=0;p<yd.length&&f!==0&&f<yd[p].priority;p++);yd.splice(p,0,u),p===0&&bF(u)}};var EF=e.version;if(EF!=="19.1.0")throw Error(r(527,EF,"19.1.0"));q.findDOMNode=function(u){var f=u._reactInternals;if(f===void 0)throw typeof u.render=="function"?Error(r(188)):(u=Object.keys(u).join(","),Error(r(268,u)));return u=c(f),u=u!==null?l(u):null,u=u===null?null:u.stateNode,u};var Kge={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var y2=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!y2.isDisabled&&y2.supportsFiber)try{mc=y2.inject(Kge),ui=y2}catch{}}return I1.createRoot=function(u,f){if(!i(u))throw Error(r(299));var p=!1,b="",C=jU,P=FU,j=$U,H=null;return f!=null&&(f.unstable_strictMode===!0&&(p=!0),f.identifierPrefix!==void 0&&(b=f.identifierPrefix),f.onUncaughtError!==void 0&&(C=f.onUncaughtError),f.onCaughtError!==void 0&&(P=f.onCaughtError),f.onRecoverableError!==void 0&&(j=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(H=f.unstable_transitionCallbacks)),f=fF(u,1,!1,null,null,p,b,C,P,j,H,null),u[La]=f.current,ZI(u),new vk(f)},I1.hydrateRoot=function(u,f,p){if(!i(u))throw Error(r(299));var b=!1,C="",P=jU,j=FU,H=$U,Q=null,ie=null;return p!=null&&(p.unstable_strictMode===!0&&(b=!0),p.identifierPrefix!==void 0&&(C=p.identifierPrefix),p.onUncaughtError!==void 0&&(P=p.onUncaughtError),p.onCaughtError!==void 0&&(j=p.onCaughtError),p.onRecoverableError!==void 0&&(H=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&(Q=p.unstable_transitionCallbacks),p.formState!==void 0&&(ie=p.formState)),f=fF(u,1,!0,f,p??null,b,C,P,j,H,Q,ie),f.context=hF(null),p=f.current,b=lo(),b=Kr(b),C=td(b),C.callback=null,nd(p,C,b),p=b,f.current.lanes=p,wt(f,p),wc(f),u[La]=f.current,ZI(u),new v2(f)},I1.version="19.1.0",I1}var xB;function Dbe(){if(xB)return Gk.exports;xB=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Gk.exports=Mbe(),Gk.exports}var Nbe=Dbe(),AB={};function Ube(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}var jbe=Object.defineProperty,Fbe=(t,e,n)=>e in t?jbe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,PB=(t,e,n)=>Fbe(t,typeof e!="symbol"?e+"":e,n);let ms=class{constructor(){PB(this,"_locking"),PB(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(i=>e=()=>{this._locks-=1,i()}),r=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),r}};function _r(t,e){if(!t)throw new Error(e)}const $be=34028234663852886e22,Bbe=-34028234663852886e22,Hbe=4294967295,Vbe=2147483647,qbe=-2147483648;function tw(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>Vbe||t<qbe)throw new Error("invalid int 32: "+t)}function AA(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>Hbe||t<0)throw new Error("invalid uint 32: "+t)}function $Q(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>$be||t<Bbe))throw new Error("invalid float 32: "+t)}const BQ=Symbol("@bufbuild/protobuf/enum-type");function Gbe(t){const e=t[BQ];return _r(e,"missing enum type on enum object"),e}function HQ(t,e,n,r){t[BQ]=VQ(e,n.map(i=>({no:i.no,name:i.name,localName:t[i.no]})))}function VQ(t,e,n){const r=Object.create(null),i=Object.create(null),s=[];for(const o of e){const a=qQ(o);s.push(a),r[o.name]=a,i[o.no]=a}return{typeName:t,values:s,findName(o){return r[o]},findNumber(o){return i[o]}}}function Kbe(t,e,n){const r={};for(const i of e){const s=qQ(i);r[s.localName]=s.no,r[s.no]=s.localName}return HQ(r,t,e),r}function qQ(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class d7{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const r=this.getType(),i=r.runtime.bin,s=i.makeReadOptions(n);return i.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const r=this.getType(),i=r.runtime.json,s=i.makeReadOptions(n);return i.readMessage(r,e,s,this),this}fromJsonString(e,n){let r;try{r=JSON.parse(e)}catch(i){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(i instanceof Error?i.message:String(i)))}return this.fromJson(r,n)}toBinary(e){const n=this.getType(),r=n.runtime.bin,i=r.makeWriteOptions(e),s=i.writerFactory();return r.writeMessage(this,s,i),s.finish()}toJson(e){const n=this.getType(),r=n.runtime.json,i=r.makeWriteOptions(e);return r.writeMessage(this,i)}toJsonString(e){var n;const r=this.toJson(e);return JSON.stringify(r,null,(n=e?.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function zbe(t,e,n,r){var i;const s=(i=r?.localName)!==null&&i!==void 0?i:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new d7),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function Wbe(){let t=0,e=0;for(let r=0;r<28;r+=7){let i=this.buf[this.pos++];if(t|=(i&127)<<r,(i&128)==0)return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[t,e];for(let r=3;r<=31;r+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<r,(i&128)==0)return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Yk(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const r=t>>>28&15|(e&7)<<4,i=e>>3!=0;if(n.push((i?r|128:r)&255),!!i){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const nw=4294967296;function LB(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let r=0,i=0;function s(o,a){const c=Number(t.slice(o,a));i*=n,r=r*n+c,r>=nw&&(i=i+(r/nw|0),r=r%nw)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?KQ(r,i):f7(r,i)}function Ybe(t,e){let n=f7(t,e);const r=n.hi&2147483648;r&&(n=KQ(n.lo,n.hi));const i=GQ(n.lo,n.hi);return r?"-"+i:i}function GQ(t,e){if({lo:t,hi:e}=Xbe(t,e),e<=2097151)return String(nw*e+t);const n=t&16777215,r=(t>>>24|e<<8)&16777215,i=e>>16&65535;let s=n+r*6777216+i*6710656,o=r+i*8147497,a=i*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+OB(o)+OB(s)}function Xbe(t,e){return{lo:t>>>0,hi:e>>>0}}function f7(t,e){return{lo:t|0,hi:e|0}}function KQ(t,e){return e=~e,t?t=~t+1:e+=1,f7(t,e)}const OB=t=>{const e=String(t);return"0000000".slice(e.length)+e};function MB(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function Jbe(){let t=this.buf[this.pos++],e=t&127;if((t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,(t&128)==0)return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;(t&128)!==0&&n<10;n++)t=this.buf[this.pos++];if((t&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function Qbe(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof AB!="object"||AB.BUF_BIGINT_DISABLE!=="1")){const i=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<i)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=i=>_r(/^-?[0-9]+$/.test(i),"int64 invalid: ".concat(i)),r=i=>_r(/^[0-9]+$/.test(i),"uint64 invalid: ".concat(i));return{zero:"0",supported:!1,parse(i){return typeof i!="string"&&(i=i.toString()),n(i),i},uParse(i){return typeof i!="string"&&(i=i.toString()),r(i),i},enc(i){return typeof i!="string"&&(i=i.toString()),n(i),LB(i)},uEnc(i){return typeof i!="string"&&(i=i.toString()),r(i),LB(i)},dec(i,s){return Ybe(i,s)},uDec(i,s){return GQ(i,s)}}}const nr=Qbe();var Se;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(Se||(Se={}));var pf;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(pf||(pf={}));function Ed(t,e,n){if(e===n)return!0;if(t==Se.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}switch(t){case Se.UINT64:case Se.FIXED64:case Se.INT64:case Se.SFIXED64:case Se.SINT64:return e==n}return!1}function av(t,e){switch(t){case Se.BOOL:return!1;case Se.UINT64:case Se.FIXED64:case Se.INT64:case Se.SFIXED64:case Se.SINT64:return e==0?nr.zero:"0";case Se.DOUBLE:case Se.FLOAT:return 0;case Se.BYTES:return new Uint8Array(0);case Se.STRING:return"";default:return 0}}function zQ(t,e){switch(t){case Se.BOOL:return e===!1;case Se.STRING:return e==="";case Se.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Rr;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Rr||(Rr={}));class Zbe{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let n=new Uint8Array(e),r=0;for(let i=0;i<this.chunks.length;i++)n.set(this.chunks[i],r),r+=this.chunks[i].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(AA(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return tw(e),MB(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){$Q(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){AA(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){tw(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return tw(e),e=(e<<1^e>>31)>>>0,MB(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),i=nr.enc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),i=nr.uEnc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(n)}int64(e){let n=nr.enc(e);return Yk(n.lo,n.hi,this.buf),this}sint64(e){let n=nr.enc(e),r=n.hi>>31,i=n.lo<<1^r,s=(n.hi<<1|n.lo>>>31)^r;return Yk(i,s,this.buf),this}uint64(e){let n=nr.uEnc(e);return Yk(n.lo,n.hi,this.buf),this}}class e_e{constructor(e,n){this.varint64=Wbe,this.uint32=Jbe,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,r=e&7;if(n<=0||r<0||r>5)throw new Error("illegal tag: field no "+n+" wire type "+r);return[n,r]}skip(e,n){let r=this.pos;switch(e){case Rr.Varint:for(;this.buf[this.pos++]&128;);break;case Rr.Bit64:this.pos+=4;case Rr.Bit32:this.pos+=4;break;case Rr.LengthDelimited:let i=this.uint32();this.pos+=i;break;case Rr.StartGroup:for(;;){const[s,o]=this.tag();if(o===Rr.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return nr.dec(...this.varint64())}uint64(){return nr.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),r=-(e&1);return e=(e>>>1|(n&1)<<31)^r,n=n>>>1^r,nr.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return nr.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return nr.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function t_e(t,e,n,r){let i;return{typeName:e,extendee:n,get field(){if(!i){const s=typeof r=="function"?r():r;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),i=t.util.newFieldList([s]).list()[0]}return i},runtime:t}}function WQ(t){const e=t.field.localName,n=Object.create(null);return n[e]=n_e(t),[n,()=>n[e]]}function n_e(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return av(e.T,e.L);case"message":const n=e.T,r=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(r):r;case"map":throw"map fields are not allowed to be extensions"}}function r_e(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let su="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),cT=[];for(let t=0;t<su.length;t++)cT[su[t].charCodeAt(0)]=t;cT[45]=su.indexOf("+");cT[95]=su.indexOf("/");const YQ={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),r=0,i=0,s,o=0;for(let a=0;a<t.length;a++){if(s=cT[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:o=s,i=1;break;case 1:n[r++]=o<<2|(s&48)>>4,o=s,i=2;break;case 2:n[r++]=(o&15)<<4|(s&60)>>2,o=s,i=3;break;case 3:n[r++]=(o&3)<<6|s,i=0;break}}if(i==1)throw Error("invalid base64 string.");return n.subarray(0,r)},enc(t){let e="",n=0,r,i=0;for(let s=0;s<t.length;s++)switch(r=t[s],n){case 0:e+=su[r>>2],i=(r&3)<<4,n=1;break;case 1:e+=su[i|r>>4],i=(r&15)<<2,n=2;break;case 2:e+=su[i|r>>6],e+=su[r&63],n=0;break}return n&&(e+=su[i],e+="=",n==1&&(e+="=")),e}};function i_e(t,e,n){JQ(e,t);const r=e.runtime.bin.makeReadOptions(n),i=r_e(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=WQ(e);for(const a of i)e.runtime.bin.readField(s,r.readerFactory(a.data),e.field,a.wireType,r);return o()}function s_e(t,e,n,r){JQ(e,t);const i=e.runtime.bin.makeReadOptions(r),s=e.runtime.bin.makeWriteOptions(r);if(XQ(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(d=>d.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const d of l)t.getType().runtime.bin.onUnknownField(t,d.no,d.wireType,d.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=i.readerFactory(o.finish());for(;c.pos<c.len;){const[l,d]=c.tag(),h=c.skip(d,l);t.getType().runtime.bin.onUnknownField(t,l,d,h)}}function XQ(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(r=>r.no==e.field.no)}function JQ(t,e){_r(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function QQ(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!zQ(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function DB(t,e){const n=t.localName,r=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=r?t.T.values[0].no:void 0;break;case"scalar":e[n]=r?av(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function ou(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(d7.prototype).every(r=>r in t&&typeof t[r]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function ZQ(t,e){return ou(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}Se.DOUBLE,Se.FLOAT,Se.INT64,Se.UINT64,Se.INT32,Se.UINT32,Se.BOOL,Se.STRING,Se.BYTES;const NB={ignoreUnknownFields:!1},UB={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function o_e(t){return t?Object.assign(Object.assign({},NB),t):NB}function a_e(t){return t?Object.assign(Object.assign({},UB),t):UB}const bC=Symbol(),rw=Symbol();function c_e(){return{makeReadOptions:o_e,makeWriteOptions:a_e,readMessage(t,e,n,r){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat($c(e)));r=r??new t;const i=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=i.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));i.set(c.oneof,o)}jB(r,a,c,n,t)}else{let l=!1;if(s?.findExtension&&o.startsWith("[")&&o.endsWith("]")){const d=s.findExtension(o.substring(1,o.length-1));if(d&&d.extendee.typeName==t.typeName){l=!0;const[h,m]=WQ(d);jB(h,a,d.field,n,d),s_e(r,d,m(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return r},writeMessage(t,e){const n=t.getType(),r={};let i;try{for(i of n.fields.byNumber()){if(!QQ(i,t)){if(i.req)throw"required field not set";if(!e.emitDefaultValues||!u_e(i))continue}const o=i.oneof?t[i.oneof.localName].value:t[i.localName],a=FB(i,o,e);a!==void 0&&(r[e.useProtoFieldName?i.name:i.jsonName]=a)}const s=e.typeRegistry;if(s?.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&XQ(t,a)){const c=i_e(t,a,e),l=FB(a.field,c,e);l!==void 0&&(r[a.field.jsonName]=l)}}}catch(s){const o=i?"cannot encode field ".concat(n.typeName,".").concat(i.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return r},readScalar(t,e,n){return Ay(t,e,n??pf.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||zQ(t,e)))return iw(t,e)},debug:$c}}function $c(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function jB(t,e,n,r,i){let s=n.localName;if(n.repeated){if(_r(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat($c(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat($c(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,r));break;case"enum":const c=Xk(n.T,a,r.ignoreUnknownFields,!0);c!==rw&&o.push(c);break;case"scalar":try{o.push(Ay(n.T,a,n.L,!0))}catch(l){let d="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat($c(a));throw l instanceof Error&&l.message.length>0&&(d+=": ".concat(l.message)),new Error(d)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat($c(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=l_e(n.K,a)}catch(d){let h="cannot decode map key for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat($c(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,r);break;case"enum":const d=Xk(n.V.T,c,r.ignoreUnknownFields,!0);d!==rw&&(o[l]=d);break;case"scalar":try{o[l]=Ay(n.V.T,c,pf.BIGINT,!0)}catch(h){let m="cannot decode map value for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat($c(e));throw h instanceof Error&&h.message.length>0&&(m+=": ".concat(h.message)),new Error(m)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];ou(a)?a.fromJson(e,r):(t[s]=a=o.fromJson(e,r),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=Xk(n.T,e,r.ignoreUnknownFields,!1);switch(c){case bC:DB(n,t);break;case rw:break;default:t[s]=c;break}break;case"scalar":try{const l=Ay(n.T,e,n.L,!1);switch(l){case bC:DB(n,t);break;default:t[s]=l;break}}catch(l){let d="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat($c(e));throw l instanceof Error&&l.message.length>0&&(d+=": ".concat(l.message)),new Error(d)}break}}function l_e(t,e){if(t===Se.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Ay(t,e,pf.BIGINT,!0).toString()}function Ay(t,e,n,r){if(e===null)return r?av(t,n):bC;switch(t){case Se.DOUBLE:case Se.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const i=Number(e);if(Number.isNaN(i)||!Number.isFinite(i))break;return t==Se.FLOAT&&$Q(i),i;case Se.INT32:case Se.FIXED32:case Se.SFIXED32:case Se.SINT32:case Se.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==Se.UINT32||t==Se.FIXED32?AA(s):tw(s),s;case Se.INT64:case Se.SFIXED64:case Se.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=nr.parse(e);return n?o.toString():o;case Se.FIXED64:case Se.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=nr.uParse(e);return n?a.toString():a;case Se.BOOL:if(typeof e!="boolean")break;return e;case Se.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case Se.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return YQ.dec(e)}throw new Error}function Xk(t,e,n,r){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:r?t.values[0].no:bC;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const i=t.findName(e);if(i!==void 0)return i.no;if(n)return rw;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat($c(e)))}function u_e(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function FB(t,e,n){if(t.kind=="map"){_r(typeof e=="object"&&e!=null);const r={},i=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of i)r[o.toString()]=iw(t.V.T,a);break;case"message":for(const[o,a]of i)r[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of i)r[o.toString()]=Jk(s,a,n.enumAsInteger);break}return n.emitDefaultValues||i.length>0?r:void 0}if(t.repeated){_r(Array.isArray(e));const r=[];switch(t.kind){case"scalar":for(let i=0;i<e.length;i++)r.push(iw(t.T,e[i]));break;case"enum":for(let i=0;i<e.length;i++)r.push(Jk(t.T,e[i],n.enumAsInteger));break;case"message":for(let i=0;i<e.length;i++)r.push(e[i].toJson(n));break}return n.emitDefaultValues||r.length>0?r:void 0}switch(t.kind){case"scalar":return iw(t.T,e);case"enum":return Jk(t.T,e,n.enumAsInteger);case"message":return ZQ(t.T,e).toJson(n)}}function Jk(t,e,n){var r;if(_r(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const i=t.findNumber(e);return(r=i?.name)!==null&&r!==void 0?r:e}function iw(t,e){switch(t){case Se.INT32:case Se.SFIXED32:case Se.SINT32:case Se.FIXED32:case Se.UINT32:return _r(typeof e=="number"),e;case Se.FLOAT:case Se.DOUBLE:return _r(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case Se.STRING:return _r(typeof e=="string"),e;case Se.BOOL:return _r(typeof e=="boolean"),e;case Se.UINT64:case Se.FIXED64:case Se.INT64:case Se.SFIXED64:case Se.SINT64:return _r(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case Se.BYTES:return _r(e instanceof Uint8Array),YQ.enc(e)}}const Dm=Symbol("@bufbuild/protobuf/unknown-fields"),$B={readUnknownFields:!0,readerFactory:t=>new e_e(t)},BB={writeUnknownFields:!0,writerFactory:()=>new Zbe};function d_e(t){return t?Object.assign(Object.assign({},$B),t):$B}function f_e(t){return t?Object.assign(Object.assign({},BB),t):BB}function h_e(){return{makeReadOptions:d_e,makeWriteOptions:f_e,listUnknownFields(t){var e;return(e=t[Dm])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Dm]},writeUnknownFields(t,e){const r=t[Dm];if(r)for(const i of r)e.tag(i.no,i.wireType).raw(i.data)},onUnknownField(t,e,n,r){const i=t;Array.isArray(i[Dm])||(i[Dm]=[]),i[Dm].push({no:e,wireType:n,data:r})},readMessage(t,e,n,r,i){const s=t.getType(),o=i?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(i===!0&&c==Rr.EndGroup));){const l=s.fields.find(a);if(!l){const d=e.skip(c,a);r.readUnknownFields&&this.onUnknownField(t,a,c,d);continue}HB(t,e,l,c,r)}if(i&&(c!=Rr.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:HB,writeMessage(t,e,n){const r=t.getType();for(const i of r.fields.byNumber()){if(!QQ(i,t)){if(i.req)throw new Error("cannot encode field ".concat(r.typeName,".").concat(i.name," to binary: required field not set"));continue}const s=i.oneof?t[i.oneof.localName].value:t[i.localName];VB(i,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,r){e!==void 0&&VB(t,e,n,r)}}}function HB(t,e,n,r,i){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?Se.INT32:n.T;let c=_C;if(n.kind=="scalar"&&n.L>0&&(c=m_e),s){let m=t[o];if(r==Rr.LengthDelimited&&a!=Se.STRING&&a!=Se.BYTES){let y=e.uint32()+e.pos;for(;e.pos<y;)m.push(c(e,a))}else m.push(c(e,a))}else t[o]=c(e,a);break;case"message":const l=n.T;s?t[o].push(sw(e,new l,i,n)):ou(t[o])?sw(e,t[o],i,n):(t[o]=sw(e,new l,i,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[d,h]=p_e(n,e,i);t[o][d]=h;break}}function sw(t,e,n,r){const i=e.getType().runtime.bin,s=r?.delimited;return i.readMessage(e,t,s?r.no:t.uint32(),n,s),e}function p_e(t,e,n){const r=e.uint32(),i=e.pos+r;let s,o;for(;e.pos<i;){const[a]=e.tag();switch(a){case 1:s=_C(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=_C(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=sw(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=av(t.K,pf.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=av(t.V.T,pf.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function m_e(t,e){const n=_C(t,e);return typeof n=="bigint"?n.toString():n}function _C(t,e){switch(e){case Se.STRING:return t.string();case Se.BOOL:return t.bool();case Se.DOUBLE:return t.double();case Se.FLOAT:return t.float();case Se.INT32:return t.int32();case Se.INT64:return t.int64();case Se.UINT64:return t.uint64();case Se.FIXED64:return t.fixed64();case Se.BYTES:return t.bytes();case Se.FIXED32:return t.fixed32();case Se.SFIXED32:return t.sfixed32();case Se.SFIXED64:return t.sfixed64();case Se.SINT64:return t.sint64();case Se.UINT32:return t.uint32();case Se.SINT32:return t.sint32()}}function VB(t,e,n,r){_r(e!==void 0);const i=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?Se.INT32:t.T;if(i)if(_r(Array.isArray(e)),t.packed)v_e(n,s,t.no,e);else for(const o of e)Py(n,s,t.no,o);else Py(n,s,t.no,e);break;case"message":if(i){_r(Array.isArray(e));for(const o of e)qB(n,r,t,o)}else qB(n,r,t,e);break;case"map":_r(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))g_e(n,r,t,o,a);break}}function g_e(t,e,n,r,i){t.tag(n.no,Rr.LengthDelimited),t.fork();let s=r;switch(n.K){case Se.INT32:case Se.FIXED32:case Se.UINT32:case Se.SFIXED32:case Se.SINT32:s=Number.parseInt(r);break;case Se.BOOL:_r(r=="true"||r=="false"),s=r=="true";break}switch(Py(t,n.K,1,s),n.V.kind){case"scalar":Py(t,n.V.T,2,i);break;case"enum":Py(t,Se.INT32,2,i);break;case"message":_r(i!==void 0),t.tag(2,Rr.LengthDelimited).bytes(i.toBinary(e));break}t.join()}function qB(t,e,n,r){const i=ZQ(n.T,r);n.delimited?t.tag(n.no,Rr.StartGroup).raw(i.toBinary(e)).tag(n.no,Rr.EndGroup):t.tag(n.no,Rr.LengthDelimited).bytes(i.toBinary(e))}function Py(t,e,n,r){_r(r!==void 0);let[i,s]=eZ(e);t.tag(n,i)[s](r)}function v_e(t,e,n,r){if(!r.length)return;t.tag(n,Rr.LengthDelimited).fork();let[,i]=eZ(e);for(let s=0;s<r.length;s++)t[i](r[s]);t.join()}function eZ(t){let e=Rr.Varint;switch(t){case Se.BYTES:case Se.STRING:e=Rr.LengthDelimited;break;case Se.DOUBLE:case Se.FIXED64:case Se.SFIXED64:e=Rr.Bit64;break;case Se.FIXED32:case Se.SFIXED32:case Se.FLOAT:e=Rr.Bit32;break}const n=Se[t].toLowerCase();return[e,n]}function y_e(){return{setEnumType:HQ,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const r of n.fields.byMember()){const i=r.localName,s=e,o=t;if(o[i]!=null)switch(r.kind){case"oneof":const a=o[i].case;if(a===void 0)continue;const c=r.findField(a);let l=o[i].value;c&&c.kind=="message"&&!ou(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===Se.BYTES&&(l=k1(l)),s[i]={case:a,value:l};break;case"scalar":case"enum":let d=o[i];r.T===Se.BYTES&&(d=r.repeated?d.map(k1):k1(d)),s[i]=d;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===Se.BYTES)for(const[g,y]of Object.entries(o[i]))s[i][g]=k1(y);else Object.assign(s[i],o[i]);break;case"message":const m=r.V.T;for(const g of Object.keys(o[i])){let y=o[i][g];m.fieldWrapper||(y=new m(y)),s[i][g]=y}break}break;case"message":const h=r.T;if(r.repeated)s[i]=o[i].map(m=>ou(m,h)?m:new h(m));else{const m=o[i];h.fieldWrapper?h.typeName==="google.protobuf.BytesValue"?s[i]=k1(m):s[i]=m:s[i]=ou(m,h)?m:new h(m)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(r=>{const i=e[r.localName],s=n[r.localName];if(r.repeated){if(i.length!==s.length)return!1;switch(r.kind){case"message":return i.every((o,a)=>r.T.equals(o,s[a]));case"scalar":return i.every((o,a)=>Ed(r.T,o,s[a]));case"enum":return i.every((o,a)=>Ed(Se.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(r.kind))}switch(r.kind){case"message":let o=i,a=s;return r.T.fieldWrapper&&(o!==void 0&&!ou(o)&&(o=r.T.fieldWrapper.wrapField(o)),a!==void 0&&!ou(a)&&(a=r.T.fieldWrapper.wrapField(a))),r.T.equals(o,a);case"enum":return Ed(Se.INT32,i,s);case"scalar":return Ed(r.T,i,s);case"oneof":if(i.case!==s.case)return!1;const c=r.findField(i.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(i.value,s.value);case"enum":return Ed(Se.INT32,i.value,s.value);case"scalar":return Ed(c.T,i.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(i).concat(Object.keys(s));switch(r.V.kind){case"message":const d=r.V.T;return l.every(m=>d.equals(i[m],s[m]));case"enum":return l.every(m=>Ed(Se.INT32,i[m],s[m]));case"scalar":const h=r.V.T;return l.every(m=>Ed(h,i[m],s[m]))}break}})},clone(t){const e=t.getType(),n=new e,r=n;for(const i of e.fields.byMember()){const s=t[i.localName];let o;if(i.repeated)o=s.map(D2);else if(i.kind=="map"){o=r[i.localName];for(const[a,c]of Object.entries(s))o[a]=D2(c)}else i.kind=="oneof"?o=i.findField(s.case)?{case:s.case,value:D2(s.value)}:{case:void 0}:o=D2(s);r[i.localName]=o}for(const i of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(r,i.no,i.wireType,i.data);return n}}}function D2(t){if(t===void 0)return t;if(ou(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function k1(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function b_e(t,e,n){return{syntax:t,json:c_e(),bin:h_e(),util:Object.assign(Object.assign({},y_e()),{newFieldList:e,initFields:n}),makeMessageType(r,i,s){return zbe(this,r,i,s)},makeEnum:Kbe,makeEnumType:VQ,getEnumType:Gbe,makeExtension(r,i,s){return t_e(this,r,i,s)}}}class __e{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const r of this.list())n[r.jsonName]=n[r.name]=r;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const r of this.list())n[r.no]=r;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const r of this.list())r.oneof?r.oneof!==n&&(n=r.oneof,e.push(n)):e.push(r)}return this.members}}function tZ(t,e){const n=nZ(t);return e?n:R_e(T_e(n))}function S_e(t){return tZ(t,!1)}const E_e=nZ;function nZ(t){let e=!1;const n=[];for(let r=0;r<t.length;r++){let i=t.charAt(r);switch(i){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(i),e=!1;break;default:e&&(e=!1,i=i.toUpperCase()),n.push(i);break}}return n.join("")}const w_e=new Set(["constructor","toString","toJSON","valueOf"]),C_e=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),rZ=t=>"".concat(t,"$"),T_e=t=>C_e.has(t)?rZ(t):t,R_e=t=>w_e.has(t)?rZ(t):t;class I_e{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=S_e(e)}addField(e){_r(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function k_e(t,e){var n,r,i,s,o,a;const c=[];let l;for(const d of typeof t=="function"?t():t){const h=d;if(h.localName=tZ(d.name,d.oneof!==void 0),h.jsonName=(n=d.jsonName)!==null&&n!==void 0?n:E_e(d.name),h.repeated=(r=d.repeated)!==null&&r!==void 0?r:!1,d.kind=="scalar"&&(h.L=(i=d.L)!==null&&i!==void 0?i:pf.BIGINT),h.delimited=(s=d.delimited)!==null&&s!==void 0?s:!1,h.req=(o=d.req)!==null&&o!==void 0?o:!1,h.opt=(a=d.opt)!==null&&a!==void 0?a:!1,d.packed===void 0&&(h.packed=d.kind=="enum"||d.kind=="scalar"&&d.T!=Se.BYTES&&d.T!=Se.STRING),d.oneof!==void 0){const m=typeof d.oneof=="string"?d.oneof:d.oneof.name;(!l||l.name!=m)&&(l=new I_e(m)),h.oneof=l,l.addField(h)}c.push(h)}return c}const se=b_e("proto3",t=>new __e(t,e=>k_e(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,r=t;if(e.repeated){r[n]=[];continue}switch(e.kind){case"oneof":r[n]={case:void 0};break;case"enum":r[n]=0;break;case"map":r[n]={};break;case"scalar":r[n]=av(e.T,e.L);break}}});class $s extends d7{constructor(e){super(),this.seconds=nr.zero,this.nanos=0,se.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(se.json.debug(e)));const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=nr.parse(i/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const i=(this.nanos+1e9).toString().substring(1);i.substring(3)==="000000"?r="."+i.substring(0,3)+"Z":i.substring(6)==="000"?r="."+i.substring(0,6)+"Z":r="."+i+"Z"}return new Date(n).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return $s.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new $s({seconds:nr.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new $s().fromBinary(e,n)}static fromJson(e,n){return new $s().fromJson(e,n)}static fromJsonString(e,n){return new $s().fromJsonString(e,n)}static equals(e,n){return se.util.equals($s,e,n)}}$s.runtime=se;$s.typeName="google.protobuf.Timestamp";$s.fields=se.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const x_e=se.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:$s},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:A_e,repeated:!0},{no:5,name:"events",kind:"message",T:L_e,repeated:!0}]),A_e=se.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:P_e,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),P_e=se.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:$s},{no:3,name:"value",kind:"scalar",T:2}]),L_e=se.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:$s},{no:7,name:"normalized_end_timestamp",kind:"message",T:$s,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),iZ=se.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Xa=se.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Fr=se.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),h7=se.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),fy=se.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),yb=se.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Za=se.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),xh=se.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),O_e=se.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Ci=se.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),lT=se.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:SC,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:vZ}]),SC=se.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),M_e=se.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:se.getEnumType(Fr),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),tp=se.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:se.getEnumType(xg)},{no:4,name:"tracks",kind:"message",T:cg,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:M_e},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:se.getEnumType(bb)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:se.getEnumType(Za)},{no:18,name:"kind_details",kind:"enum",T:se.getEnumType(D_e),repeated:!0}]),xg=se.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),bb=se.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),D_e=se.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),si=se.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),N_e=se.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:tf,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:se.getEnumType(sZ)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),cg=se.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:se.getEnumType(Xa)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:se.getEnumType(Fr)},{no:10,name:"layers",kind:"message",T:tf,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:N_e,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:se.getEnumType(si)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:vZ},{no:19,name:"audio_features",kind:"enum",T:se.getEnumType(Ci),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:se.getEnumType(iZ)}]),tf=se.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:se.getEnumType(h7)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),sZ=se.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),ds=se.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:se.getEnumType(It)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:p7,oneof:"value"},{no:3,name:"speaker",kind:"message",T:U_e,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:lZ,oneof:"value"},{no:7,name:"transcription",kind:"message",T:j_e,oneof:"value"},{no:8,name:"metrics",kind:"message",T:x_e,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:EC,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:m7,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:g7,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:v7,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:wC,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:CC,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:TC,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:oZ,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),It=se.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),oZ=se.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:se.getEnumType(si)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),aZ=se.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:p7,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:EC,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:m7,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:g7,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:v7,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:wC,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:CC,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:TC,oneof:"value"}]),U_e=se.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:cZ,repeated:!0}]),cZ=se.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),p7=se.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),lZ=se.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),j_e=se.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:F_e,repeated:!0}]),F_e=se.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),EC=se.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),m7=se.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),g7=se.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),v7=se.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:uZ,oneof:"value"}]),uZ=se.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),dZ=se.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),fZ=se.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:se.getEnumType(hZ)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),hZ=se.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),pZ=se.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:se.getEnumType(mZ)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),mZ=se.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),gZ=se.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:GB},{no:2,name:"screen",kind:"message",T:GB},{no:3,name:"resume_connection",kind:"enum",T:se.getEnumType(yb)},{no:4,name:"disabled_codecs",kind:"message",T:$_e},{no:5,name:"force_relay",kind:"enum",T:se.getEnumType(yb)}]),GB=se.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:se.getEnumType(yb)}]),$_e=se.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:SC,repeated:!0},{no:2,name:"publish",kind:"message",T:SC,repeated:!0}]),vZ=se.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),PA=se.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),yZ=se.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:se.getEnumType(PA)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),bZ=se.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),wC=se.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:se.getEnumType(si)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:yZ,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:bZ,oneof:"content_header"}],{localName:"DataStream_Header"}),CC=se.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),TC=se.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),B_e=se.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Ja=se.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),LA=se.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),H_e=se.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),V_e=se.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:mf,oneof:"message"},{no:2,name:"answer",kind:"message",T:mf,oneof:"message"},{no:3,name:"trickle",kind:"message",T:uT,oneof:"message"},{no:4,name:"add_track",kind:"message",T:_b,oneof:"message"},{no:5,name:"mute",kind:"message",T:dT,oneof:"message"},{no:6,name:"subscription",kind:"message",T:fT,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:_Z,oneof:"message"},{no:8,name:"leave",kind:"message",T:hT,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:EZ,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:TZ,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:E7,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Nc,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:_7,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:kZ,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:b7,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:SZ,oneof:"message"}]),KB=se.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:q_e,oneof:"message"},{no:2,name:"answer",kind:"message",T:mf,oneof:"message"},{no:3,name:"offer",kind:"message",T:mf,oneof:"message"},{no:4,name:"trickle",kind:"message",T:uT,oneof:"message"},{no:5,name:"update",kind:"message",T:z_e,oneof:"message"},{no:6,name:"track_published",kind:"message",T:y7,oneof:"message"},{no:8,name:"leave",kind:"message",T:hT,oneof:"message"},{no:9,name:"mute",kind:"message",T:dT,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:W_e,oneof:"message"},{no:11,name:"room_update",kind:"message",T:Y_e,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:J_e,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:Z_e,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:tSe,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:rSe,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:K_e,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:G_e,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:sSe,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:cSe,oneof:"message"},{no:22,name:"request_response",kind:"message",T:lSe,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:uSe,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:iSe,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:pSe,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:nSe,oneof:"message"}]),OA=se.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:tf,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:se.getEnumType(sZ)}]),_b=se.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:se.getEnumType(Xa)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:se.getEnumType(Fr)},{no:9,name:"layers",kind:"message",T:tf,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:OA,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:se.getEnumType(si)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:se.getEnumType(iZ)},{no:17,name:"audio_features",kind:"enum",T:se.getEnumType(Ci),repeated:!0}]),uT=se.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:se.getEnumType(Ja)},{no:3,name:"final",kind:"scalar",T:8}]),dT=se.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),q_e=se.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:lT},{no:2,name:"participant",kind:"message",T:tp},{no:3,name:"other_participants",kind:"message",T:tp,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:wZ,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:gZ},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:fZ},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:SC,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),G_e=se.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:wZ,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:gZ},{no:3,name:"server_info",kind:"message",T:fZ},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),y7=se.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:cg}]),K_e=se.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),mf=se.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),z_e=se.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:tp,repeated:!0}]),fT=se.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:dZ,repeated:!0}]),_Z=se.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:se.getEnumType(h7)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),b7=se.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:se.getEnumType(Ci),repeated:!0}]),SZ=se.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),hT=se.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:se.getEnumType(Za)},{no:3,name:"action",kind:"enum",T:se.getEnumType(Ag)},{no:4,name:"regions",kind:"message",T:oSe}]),Ag=se.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),EZ=se.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:tf,repeated:!0}]),_7=se.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),wZ=se.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),W_e=se.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:cZ,repeated:!0}]),Y_e=se.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:lT}]),X_e=se.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:se.getEnumType(fy)},{no:3,name:"score",kind:"scalar",T:2}]),J_e=se.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:X_e,repeated:!0}]),Q_e=se.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:se.getEnumType(LA)}]),Z_e=se.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:Q_e,repeated:!0}]),S7=se.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:se.getEnumType(h7)},{no:2,name:"enabled",kind:"scalar",T:8}]),eSe=se.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:S7,repeated:!0}]),tSe=se.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:S7,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:eSe,repeated:!0}]),nSe=se.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:B_e,repeated:!0}]),CZ=se.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),TZ=se.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:CZ,repeated:!0}]),rSe=se.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),iSe=se.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:lT},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:tp},{no:4,name:"other_participants",kind:"message",T:tp,repeated:!0}]),E7=se.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:mf},{no:2,name:"subscription",kind:"message",T:fT},{no:3,name:"publish_tracks",kind:"message",T:y7,repeated:!0},{no:4,name:"data_channels",kind:"message",T:IZ,repeated:!0},{no:5,name:"offer",kind:"message",T:mf},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:RZ,repeated:!0}]),RZ=se.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),IZ=se.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:se.getEnumType(Ja)}]),Nc=se.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:se.getEnumType(H_e),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),kZ=se.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),sSe=se.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),oSe=se.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:aSe,repeated:!0}]),aSe=se.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),cSe=se.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:se.getEnumType(O_e)}]),lSe=se.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:se.getEnumType(w7)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:uT,oneof:"request"},{no:5,name:"add_track",kind:"message",T:_b,oneof:"request"},{no:6,name:"mute",kind:"message",T:dT,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:_7,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:b7,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:SZ,oneof:"request"}]),w7=se.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),uSe=se.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),xZ=se.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),dSe=se.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:pZ},{no:2,name:"connection_settings",kind:"message",T:xZ},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:_b,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:mf},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:se.getEnumType(xh)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:E7}]),fSe=se.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:se.getEnumType(hSe)},{no:2,name:"join_request",kind:"scalar",T:12}]),hSe=se.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),pSe=se.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function mSe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ow={exports:{}},gSe=ow.exports,zB;function vSe(){return zB||(zB=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(gSe,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(v,w){var S=v[w];if(typeof S.bind=="function")return S.bind(v);try{return Function.prototype.bind.call(S,v)}catch{return function(){return Function.prototype.apply.apply(S,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&r?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function d(){for(var v=this.getLevel(),w=0;w<i.length;w++){var S=i[w];this[S]=w<v?e:this.methodFactory(S,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function h(v){return function(){typeof console!==n&&(d.call(this),this[v].apply(this,arguments))}}function m(v,w,S){return l(v)||h.apply(this,arguments)}function g(v,w){var S=this,R,x,T,I="loglevel";typeof v=="string"?I+=":"+v:typeof v=="symbol"&&(I=void 0);function k(U){var $=(i[U]||"silent").toUpperCase();if(!(typeof window===n||!I)){try{window.localStorage[I]=$;return}catch{}try{window.document.cookie=encodeURIComponent(I)+"="+$+";"}catch{}}}function A(){var U;if(!(typeof window===n||!I)){try{U=window.localStorage[I]}catch{}if(typeof U===n)try{var $=window.document.cookie,K=encodeURIComponent(I),Y=$.indexOf(K+"=");Y!==-1&&(U=/^([^;]+)/.exec($.slice(Y+K.length+1))[1])}catch{}return S.levels[U]===void 0&&(U=void 0),U}}function O(){if(!(typeof window===n||!I)){try{window.localStorage.removeItem(I)}catch{}try{window.document.cookie=encodeURIComponent(I)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function D(U){var $=U;if(typeof $=="string"&&S.levels[$.toUpperCase()]!==void 0&&($=S.levels[$.toUpperCase()]),typeof $=="number"&&$>=0&&$<=S.levels.SILENT)return $;throw new TypeError("log.setLevel() called with invalid level: "+U)}S.name=v,S.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},S.methodFactory=w||m,S.getLevel=function(){return T??x??R},S.setLevel=function(U,$){return T=D(U),$!==!1&&k(T),d.call(S)},S.setDefaultLevel=function(U){x=D(U),A()||S.setLevel(U,!1)},S.resetLevel=function(){T=null,O(),d.call(S)},S.enableAll=function(U){S.setLevel(S.levels.TRACE,U)},S.disableAll=function(U){S.setLevel(S.levels.SILENT,U)},S.rebuild=function(){if(o!==S&&(R=D(o.getLevel())),d.call(S),o===S)for(var U in s)s[U].rebuild()},R=D(o?o.getLevel():"WARN");var N=A();N!=null&&(T=D(N)),d.call(S)}o=new g,o.getLogger=function(w){if(typeof w!="symbol"&&typeof w!="string"||w==="")throw new TypeError("You must supply a name when creating a logger.");var S=s[w];return S||(S=s[w]=new g(w,o.methodFactory)),S};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return s},o.default=o,o})}(ow)),ow.exports}var g_=vSe(),Sb;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(Sb||(Sb={}));var sc;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(sc||(sc={}));let Tt=g_.getLogger("livekit");const AZ=Object.values(sc).map(t=>g_.getLogger(t));Tt.setDefaultLevel(Sb.info);function ku(t){const e=g_.getLogger(t);return e.setDefaultLevel(Tt.getLevel()),e}function PZ(t,e){if(e)g_.getLogger(e).setLevel(t);else for(const n of AZ)n.setLevel(t)}function ySe(t,e){AZ.forEach(r=>{const i=r.methodFactory;r.methodFactory=(s,o,a)=>{const c=i(s,o,a),l=Sb[s],d=l>=o&&l<Sb.silent;return(h,m)=>{m?c(h,m):c(h),d&&t(l,h,m)}},r.setLevel(r.getLevel())})}const bSe=g_.getLogger("lk-e2ee"),x1=7e3,_Se=[0,300,2*2*300,3*3*300,4*4*300,x1,x1,x1,x1,x1];class LZ{constructor(e){this._retryDelays=e!==void 0?[...e]:_Se}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function SSe(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function J(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{l(r.next(d))}catch(h){o(h)}}function c(d){try{l(r.throw(d))}catch(h){o(h)}}function l(d){d.done?s(d.value):i(d.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function WB(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function au(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof WB=="function"?WB(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var N2={exports:{}},YB;function ESe(){if(YB)return N2.exports;YB=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(I,k,A){return Function.prototype.apply.call(I,k,A)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(I){return Object.getOwnPropertyNames(I).concat(Object.getOwnPropertySymbols(I))}:n=function(I){return Object.getOwnPropertyNames(I)};function r(T){console&&console.warn&&console.warn(T)}var i=Number.isNaN||function(I){return I!==I};function s(){s.init.call(this)}N2.exports=s,N2.exports.once=S,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(T){if(typeof T!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof T)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(T){if(typeof T!="number"||T<0||i(T))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+T+".");o=T}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(I){if(typeof I!="number"||I<0||i(I))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+I+".");return this._maxListeners=I,this};function c(T){return T._maxListeners===void 0?s.defaultMaxListeners:T._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(I){for(var k=[],A=1;A<arguments.length;A++)k.push(arguments[A]);var O=I==="error",D=this._events;if(D!==void 0)O=O&&D.error===void 0;else if(!O)return!1;if(O){var N;if(k.length>0&&(N=k[0]),N instanceof Error)throw N;var U=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw U.context=N,U}var $=D[I];if($===void 0)return!1;if(typeof $=="function")e($,this,k);else for(var K=$.length,Y=y($,K),A=0;A<K;++A)e(Y[A],this,k);return!0};function l(T,I,k,A){var O,D,N;if(a(k),D=T._events,D===void 0?(D=T._events=Object.create(null),T._eventsCount=0):(D.newListener!==void 0&&(T.emit("newListener",I,k.listener?k.listener:k),D=T._events),N=D[I]),N===void 0)N=D[I]=k,++T._eventsCount;else if(typeof N=="function"?N=D[I]=A?[k,N]:[N,k]:A?N.unshift(k):N.push(k),O=c(T),O>0&&N.length>O&&!N.warned){N.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+N.length+" "+String(I)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.emitter=T,U.type=I,U.count=N.length,r(U)}return T}s.prototype.addListener=function(I,k){return l(this,I,k,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(I,k){return l(this,I,k,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(T,I,k){var A={fired:!1,wrapFn:void 0,target:T,type:I,listener:k},O=d.bind(A);return O.listener=k,A.wrapFn=O,O}s.prototype.once=function(I,k){return a(k),this.on(I,h(this,I,k)),this},s.prototype.prependOnceListener=function(I,k){return a(k),this.prependListener(I,h(this,I,k)),this},s.prototype.removeListener=function(I,k){var A,O,D,N,U;if(a(k),O=this._events,O===void 0)return this;if(A=O[I],A===void 0)return this;if(A===k||A.listener===k)--this._eventsCount===0?this._events=Object.create(null):(delete O[I],O.removeListener&&this.emit("removeListener",I,A.listener||k));else if(typeof A!="function"){for(D=-1,N=A.length-1;N>=0;N--)if(A[N]===k||A[N].listener===k){U=A[N].listener,D=N;break}if(D<0)return this;D===0?A.shift():v(A,D),A.length===1&&(O[I]=A[0]),O.removeListener!==void 0&&this.emit("removeListener",I,U||k)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(I){var k,A,O;if(A=this._events,A===void 0)return this;if(A.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):A[I]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete A[I]),this;if(arguments.length===0){var D=Object.keys(A),N;for(O=0;O<D.length;++O)N=D[O],N!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(k=A[I],typeof k=="function")this.removeListener(I,k);else if(k!==void 0)for(O=k.length-1;O>=0;O--)this.removeListener(I,k[O]);return this};function m(T,I,k){var A=T._events;if(A===void 0)return[];var O=A[I];return O===void 0?[]:typeof O=="function"?k?[O.listener||O]:[O]:k?w(O):y(O,O.length)}s.prototype.listeners=function(I){return m(this,I,!0)},s.prototype.rawListeners=function(I){return m(this,I,!1)},s.listenerCount=function(T,I){return typeof T.listenerCount=="function"?T.listenerCount(I):g.call(T,I)},s.prototype.listenerCount=g;function g(T){var I=this._events;if(I!==void 0){var k=I[T];if(typeof k=="function")return 1;if(k!==void 0)return k.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function y(T,I){for(var k=new Array(I),A=0;A<I;++A)k[A]=T[A];return k}function v(T,I){for(;I+1<T.length;I++)T[I]=T[I+1];T.pop()}function w(T){for(var I=new Array(T.length),k=0;k<I.length;++k)I[k]=T[k].listener||T[k];return I}function S(T,I){return new Promise(function(k,A){function O(N){T.removeListener(I,D),A(N)}function D(){typeof T.removeListener=="function"&&T.removeListener("error",O),k([].slice.call(arguments))}x(T,I,D,{once:!0}),I!=="error"&&R(T,O,{once:!0})})}function R(T,I,k){typeof T.on=="function"&&x(T,"error",I,k)}function x(T,I,k,A){if(typeof T.on=="function")A.once?T.once(I,k):T.on(I,k);else if(typeof T.addEventListener=="function")T.addEventListener(I,function O(D){A.once&&T.removeEventListener(I,O),k(D)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof T)}return N2.exports}var dl=ESe();let OZ=!0,MZ=!0;function hy(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function Cp(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return i.apply(this,arguments);const c=l=>{const d=n(l);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),i.apply(this,[o,c])};const s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function wSe(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(OZ=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function CSe(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(MZ=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function DZ(){if(typeof window=="object"){if(OZ)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function C7(t,e){MZ&&console.warn(t+" is deprecated, please use "+e+" instead.")}function TSe(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(hy(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(hy(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(hy(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=hy(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function XB(t){return Object.prototype.toString.call(t)==="[object Object]"}function NZ(t){return XB(t)?Object.keys(t).reduce(function(e,n){const r=XB(t[n]),i=r?NZ(t[n]):t[n],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[n]:i})},{}):t}function MA(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?MA(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{MA(t,t.get(i),n)})}))}function JB(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===r&&a.trackId===o.id&&MA(t,a,i)})}),i}const QB=DZ;function UZ(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const d=typeof a[l]=="object"?a[l]:{ideal:a[l]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const h=function(m,g){return m?m+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(d.ideal!==void 0){c.optional=c.optional||[];let m={};typeof d.ideal=="number"?(m[h("min",l)]=d.ideal,c.optional.push(m),m={},m[h("max",l)]=d.ideal,c.optional.push(m)):(m[h("",l)]=d.ideal,c.optional.push(m))}d.exact!==void 0&&typeof d.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=d.exact):["min","max"].forEach(m=>{d[m]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(m,l)]=d[m])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},i=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(d,h,m){h in d&&!(m in d)&&(d[m]=d[h],delete d[h])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const d=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete a.video.facingMode;let h;if(l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(m=>{m=m.filter(y=>y.kind==="videoinput");let g=m.find(y=>h.some(v=>y.label.toLowerCase().includes(v)));return!g&&m.length&&h.includes("back")&&(g=m[m.length-1]),g&&(a.video.deviceId=l.exact?{exact:g.deviceId}:{ideal:g.deviceId}),a.video=r(a.video),QB("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return QB("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){i(a,d=>{n.webkitGetUserMedia(d,c,h=>{l&&l(s(h))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return i(c,l=>a(l).then(d=>{if(l.audio&&!d.getAudioTracks().length||l.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(s(d))))}}}function jZ(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function FZ(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):s={track:i.track};const o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.id):s={track:i};const o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Cp(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function $Z(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=i.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function BZ(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>JB(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Cp(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>JB(s,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let i,s,o;return this.getSenders().forEach(a=>{a.track===r&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===r&&(s?o=!0:s=a),a.track===r)),o||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function HZ(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(h=>h.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function VZ(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return HZ(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(h=>{if(this.getSenders().find(g=>g.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const h=new t.MediaStream(d.getTracks());this._streams[d.id]=h,this._reverseStreams[h.id]=d,d=h}r.apply(this,[d])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(v=>v===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[h.id];if(y)y.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new t.MediaStream([d]);this._streams[h.id]=v,this._reverseStreams[v.id]=h,this.addStream(v)}return this.getSenders().find(v=>v.track===d)};function s(l,d){let h=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(m=>{const g=l._reverseStreams[m],y=l._streams[g.id];h=h.replace(new RegExp(y.id,"g"),g.id)}),new RTCSessionDescription({type:d.type,sdp:h})}function o(l,d){let h=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(m=>{const g=l._reverseStreams[m],y=l._streams[g.id];h=h.replace(new RegExp(g.id,"g"),y.id)}),new RTCSessionDescription({type:d.type,sdp:h})}["createOffer","createAnswer"].forEach(function(l){const d=t.RTCPeerConnection.prototype[l],h={[l](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[y=>{const v=s(this,y);m[0].apply(null,[v])},y=>{m[1]&&m[1].apply(null,y)},arguments[2]]):d.apply(this,arguments).then(y=>s(this,y))}};t.RTCPeerConnection.prototype[l]=h[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let m;Object.keys(this._streams).forEach(g=>{this._streams[g].getTracks().find(v=>d.track===v)&&(m=this._streams[g])}),m&&(m.getTracks().length===1?this.removeStream(this._reverseStreams[m.id]):m.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function DA(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function qZ(t,e){Cp(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}var ZB=Object.freeze({__proto__:null,fixNegotiationNeeded:qZ,shimAddTrackRemoveTrack:VZ,shimAddTrackRemoveTrackWithNative:HZ,shimGetSendersWithDtmf:$Z,shimGetUserMedia:UZ,shimMediaStream:jZ,shimOnTrack:FZ,shimPeerConnection:DA,shimSenderReceiverGetStats:BZ});function GZ(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,s,o){C7("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function RSe(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function KZ(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function NA(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return r.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((d,h)=>{c.set(h,Object.assign({},d,{type:n[d.type]||d.type}))})}return c}).then(o,a)}}function zZ(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function WZ(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Cp(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function YZ(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){C7("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function XZ(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function JZ(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function QZ(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function ZZ(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function eee(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var eH=Object.freeze({__proto__:null,shimAddTransceiver:JZ,shimCreateAnswer:eee,shimCreateOffer:ZZ,shimGetDisplayMedia:RSe,shimGetParameters:QZ,shimGetUserMedia:GZ,shimOnTrack:KZ,shimPeerConnection:NA,shimRTCDataChannel:XZ,shimReceiverGetStats:WZ,shimRemoveStream:YZ,shimSenderGetStats:zZ});function tee(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},t.RTCPeerConnection.prototype.addTrack=function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function nee(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function ree(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,d){const h=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[h]);return d?(m.then(l,d),Promise.resolve()):m},e.createAnswer=function(l,d){const h=arguments.length>=2?arguments[2]:arguments[0],m=r.apply(this,[h]);return d?(m.then(l,d),Promise.resolve()):m};let a=function(c,l,d){const h=i.apply(this,[c]);return d?(h.then(l,d),Promise.resolve()):h};e.setLocalDescription=a,a=function(c,l,d){const h=s.apply(this,[c]);return d?(h.then(l,d),Promise.resolve()):h},e.setRemoteDescription=a,a=function(c,l,d){const h=o.apply(this,[c]);return d?(h.then(l,d),Promise.resolve()):h},e.addIceCandidate=a}function iee(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(see(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function see(t){return t&&t.video!==void 0?Object.assign({},t,{video:NZ(t.video)}):t}function oee(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(C7("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(r.iceServers[o])}r.iceServers=s}return new e(r,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function aee(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function cee(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function lee(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var tH=Object.freeze({__proto__:null,shimAudioContext:lee,shimCallbacksAPI:ree,shimConstraints:see,shimCreateOfferLegacy:cee,shimGetUserMedia:iee,shimLocalStreamsAPI:tee,shimRTCIceServerUrls:oee,shimRemoteStreamsAPI:nee,shimTrackEventTransceiver:aee}),Qk={exports:{}},nH;function ISe(){return nH||(nH=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],s=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");r.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const d=e.parseRtpMap(l),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(d.parameters=h.length?e.parseFmtp(h[0]):{},d.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(d.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(d=>d.type===c.type&&d.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(m=>e.parseSsrcMedia(m)).filter(m=>m.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const d=e.matchPrefix(n,"a=ssrc-group:FID").map(m=>m.substring(17).split(" ").map(y=>parseInt(y,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(l=d[0][1]),i.codecs.forEach(m=>{if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){let g={ssrc:c,codecPayloadType:parseInt(m.parameters.apt,10)};c&&l&&(g.rtx={ssrc:l}),r.push(g),s&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(g))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(m=>{m.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let s;const o=r!==void 0?r:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e}(Qk)),Qk.exports}var uee=ISe(),Pg=mSe(uee),kSe=Ube({__proto__:null,default:Pg},[uee]);function aw(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=Pg.parseCandidate(r.candidate);for(const o in s)o in i||Object.defineProperty(i,o,{value:s[o]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,Cp(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function UA(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Cp(t,"icecandidate",e=>{if(e.candidate){const n=Pg.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function cw(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=Pg.splitSections(a.sdp);return c.shift(),c.some(l=>{const d=Pg.parseMLine(l);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},i=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const d=Pg.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?l=parseInt(d[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),l=i(c),d=s(arguments[0],c);let h;l===0&&d===0?h=Number.POSITIVE_INFINITY:l===0||d===0?h=Math.max(l,d):h=Math.min(l,d);const m={};Object.defineProperty(m,"maxMessageSize",{get(){return h}}),this._sctp=m}return o.apply(this,arguments)}}function lw(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},Cp(t,"datachannel",r=>(e(r.channel,r.target),r))}function jA(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function FA(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return n.apply(this,arguments)}}function uw(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function dw(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var xSe=Object.freeze({__proto__:null,removeExtmapAllowMixed:FA,shimAddIceCandidateNullOrEmpty:uw,shimConnectionState:jA,shimMaxMessageSize:cw,shimParameterlessSetLocalDescription:dw,shimRTCIceCandidate:aw,shimRTCIceCandidateRelayProtocol:UA,shimSendThrowTypeError:lw});function ASe(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=DZ,r=TSe(t),i={browserDetails:r,commonShim:xSe,extractVersion:hy,disableLog:wSe,disableWarnings:CSe,sdp:kSe};switch(r.browser){case"chrome":if(!ZB||!DA||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=ZB,uw(t,r),dw(t),UZ(t,r),jZ(t),DA(t,r),FZ(t),VZ(t,r),$Z(t),BZ(t),qZ(t,r),aw(t),UA(t),jA(t),cw(t,r),lw(t),FA(t,r);break;case"firefox":if(!eH||!NA||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=eH,uw(t,r),dw(t),GZ(t,r),NA(t,r),KZ(t),YZ(t),zZ(t),WZ(t),XZ(t),JZ(t),QZ(t),ZZ(t),eee(t),aw(t),jA(t),cw(t,r),lw(t);break;case"safari":if(!tH||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=tH,uw(t,r),dw(t),oee(t),cee(t),ree(t),tee(t),nee(t),aee(t),iee(t),lee(t),aw(t),UA(t),cw(t,r),lw(t),FA(t,r);break;default:n("Unsupported browser!");break}return i}ASe({window:typeof window>"u"?void 0:window});const PSe=10,A1="lk_e2ee",LSe="LKFrameEncryptionKey",OSe={sharedKey:!1,ratchetSalt:LSe,ratchetWindowSize:8,failureTolerance:PSe,keyringSize:16};var nf;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(nf||(nf={}));var rH;(function(t){t.KeyRatcheted="keyRatcheted"})(rH||(rH={}));var Kd;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Kd||(Kd={}));var iH;(function(t){t.Error="cryptorError"})(iH||(iH={}));function dee(){return MSe()||$A()}function $A(){return typeof window.RTCRtpScriptTransform<"u"}function MSe(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function DSe(t){return J(this,void 0,void 0,function*(){let e=new TextEncoder;return yield crypto.subtle.importKey("raw",e.encode(t),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])})}function NSe(t){return J(this,void 0,void 0,function*(){return yield crypto.subtle.importKey("raw",t,"HKDF",!1,["deriveBits","deriveKey"])})}function USe(t){var e,n,r,i,s;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="speaker"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="transcription"&&((s=t.value)===null||s===void 0?void 0:s.case)!=="encryptedPacket")return new aZ({value:t.value})}class fee extends dl.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,r,i)=>{Tt.debug("key ratcheted event received",{ratchetResult:n,participantId:r,keyIndex:i})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},OSe),e),this.on(nf.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,r){const i={key:e,participantIdentity:n,keyIndex:r};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(r??0),i),this.emit(nf.SetKey,i)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(nf.RatchetRequest,e,n)}}class jSe extends fee{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Object.assign(Object.assign({},e),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1});super(n)}setKey(e){return J(this,void 0,void 0,function*(){const n=typeof e=="string"?yield DSe(e):yield NSe(e);this.onSetEncryptionKey(n)})}}class Hu extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var Nt;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout"})(Nt||(Nt={}));class Qt extends Hu{constructor(e,n,r,i){super(1,e),this.name="ConnectionError",this.status=r,this.reason=n,this.context=i,this.reasonName=Nt[n]}}class T7 extends Hu{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class cu extends Hu{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class FSe extends Hu{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Jr extends Hu{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class BA extends Hu{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class sH extends Hu{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class oH extends Hu{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:w7[n]}}var as;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(as||(as={}));class Qo extends Hu{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=as[n]}}var RC;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(RC||(RC={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(RC||(RC={}));var aH;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(aH||(aH={}));var ue;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(ue||(ue={}));var ce;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(ce||(ce={}));var Pe;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(Pe||(Pe={}));var Te;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(Te||(Te={}));function $Se(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}const BSe=/version\/(\d+(\.?_?\d+)+)/i;let Zk;function zs(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(Zk===void 0||e){const r=HSe.find(i=>{let{test:s}=i;return s.test(n)});Zk=r?.describe(n)}return Zk}const HSe=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:fw(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:e6(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:fw(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:e6(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:fw(BSe,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:e6(t)}}}];function fw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=e.match(t);return r&&r.length>=n&&r[n]||""}function e6(t){return t.includes("mac os")?fw(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var VSe="2.15.13";const qSe=VSe,GSe=16;class Bi{}Bi.setTimeout=function(){return setTimeout(...arguments)};Bi.setInterval=function(){return setInterval(...arguments)};Bi.clearTimeout=function(){return clearTimeout(...arguments)};Bi.clearInterval=function(){return clearInterval(...arguments)};const KSe=5e3,P1=[];var wo;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(wo||(wo={}));let he=class tg extends dl.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=tg.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Tt,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),KSe):this.handleAppVisibilityChanged()},this.log=ku((i=r.loggerName)!==null&&i!==void 0?i:sc.Track),this.loggerContextCb=r.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=tg.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Lt(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===tg.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===tg.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(P1.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&P1.splice(P1.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),lg(this.mediaStreamTrack,e);const r=e.srcObject.getTracks(),i=r.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(i?Te.AudioPlaybackStarted:Te.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(i?Te.AudioPlaybackFailed:Te.VideoPlaybackFailed,s):s.name==="AbortError"?Tt.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):Tt.warn("could not playback ".concat(i?"audio":"video"),s),i&&e&&r.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(Te.ElementAttached,e),e}detach(e){try{if(e){Lg(this.mediaStreamTrack,e);const r=this.attachedElements.indexOf(e);return r>=0&&(this.attachedElements.splice(r,1),this.recycleElement(e),this.emit(Te.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(r=>{Lg(this.mediaStreamTrack,r),n.push(r),this.recycleElement(r),this.emit(Te.ElementDetached,r)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=ku(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),P1.forEach(r=>{r.parentElement||(n=!1)}),n&&P1.push(e)}}handleAppVisibilityChanged(){return J(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===tg.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){qs()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){qs()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}};function lg(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let r;t.kind==="audio"?r=n.getAudioTracks():r=n.getVideoTracks(),r.includes(t)||(r.forEach(i=>{n.removeTrack(i)}),n.addTrack(t)),(!rp()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(rp()||np())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function Lg(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let r;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(r=t.StreamState||(t.StreamState={}));function i(l){switch(l){case e.Audio:return Xa.AUDIO;case e.Video:return Xa.VIDEO;default:return Xa.DATA}}t.kindToProto=i;function s(l){switch(l){case Xa.AUDIO:return e.Audio;case Xa.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(l){switch(l){case n.Camera:return Fr.CAMERA;case n.Microphone:return Fr.MICROPHONE;case n.ScreenShare:return Fr.SCREEN_SHARE;case n.ScreenShareAudio:return Fr.SCREEN_SHARE_AUDIO;default:return Fr.UNKNOWN}}t.sourceToProto=o;function a(l){switch(l){case Fr.CAMERA:return n.Camera;case Fr.MICROPHONE:return n.Microphone;case Fr.SCREEN_SHARE:return n.ScreenShare;case Fr.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case LA.ACTIVE:return r.Active;case LA.PAUSED:return r.Paused;default:return r.Unknown}}t.streamStateFromProto=c})(he||(he={}));class Cn{constructor(e,n,r,i,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&r!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:r,maxFramerate:i,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const zSe=["vp8","h264"],WSe=["vp8","h264","vp9","av1","h265"];function YSe(t){return!!zSe.find(e=>e===t)}const XSe=YSe;var cH;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(cH||(cH={}));var IC;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(IC||(IC={}));const Yc={h90:new Cn(160,90,9e4,20),h180:new Cn(320,180,16e4,20),h216:new Cn(384,216,18e4,20),h360:new Cn(640,360,45e4,20),h540:new Cn(960,540,8e5,25),h720:new Cn(1280,720,17e5,30),h1080:new Cn(1920,1080,3e6,30),h1440:new Cn(2560,1440,5e6,30),h2160:new Cn(3840,2160,8e6,30)},HA={h120:new Cn(160,120,7e4,20),h180:new Cn(240,180,125e3,20),h240:new Cn(320,240,14e4,20),h360:new Cn(480,360,33e4,20),h480:new Cn(640,480,5e5,20),h540:new Cn(720,540,6e5,25),h720:new Cn(960,720,13e5,30),h1080:new Cn(1440,1080,23e5,30),h1440:new Cn(1920,1440,38e5,30)},pT={h360fps3:new Cn(640,360,2e5,3,"medium"),h360fps15:new Cn(640,360,4e5,15,"medium"),h720fps5:new Cn(1280,720,8e5,5,"medium"),h720fps15:new Cn(1280,720,15e5,15,"medium"),h720fps30:new Cn(1280,720,2e6,30,"medium"),h1080fps15:new Cn(1920,1080,25e5,15,"medium"),h1080fps30:new Cn(1920,1080,5e6,30,"medium"),original:new Cn(0,0,7e6,30,"medium")},JSe="|",lH="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function QSe(t){const e=t.split(JSe);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function gs(t){return J(this,void 0,void 0,function*(){return new Promise(e=>Bi.setTimeout(e,t))})}function VA(){return"addTransceiver"in RTCPeerConnection.prototype}function qA(){return"addTrack"in RTCPeerConnection.prototype}function ZSe(){if(!("getCapabilities"in RTCRtpSender)||rp()||np())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function e2e(){if(!("getCapabilities"in RTCRtpSender)||np())return!1;if(rp()){const n=zs();if(n?.version&&nl(n.version,"16")<0||n?.os==="iOS"&&n?.osVersion&&nl(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function Gc(t){return t==="av1"||t==="vp9"}function GA(t){return!document||Eb()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function t2e(){return typeof RTCPeerConnection>"u"?!1:VA()||qA()}function np(){var t;return((t=zs())===null||t===void 0?void 0:t.name)==="Firefox"}function uH(){const t=zs();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function rp(){var t;return((t=zs())===null||t===void 0?void 0:t.name)==="Safari"}function Eb(){const t=zs();return t?.name==="Safari"||t?.os==="iOS"}function n2e(){const t=zs();return t?.name==="Safari"&&t.version.startsWith("17.")||t?.os==="iOS"&&!!t?.osVersion&&nl(t.osVersion,"17")>=0}function r2e(t){return t||(t=zs()),t?.name==="Safari"&&nl(t.version,"18.3")>0||t?.os==="iOS"&&!!t?.osVersion&&nl(t.osVersion,"18.3")>0}function hee(){var t,e;return qs()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function i2e(){const t=zs(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&nl(t.osVersion,e)>=0?!0:t.name==="Safari"&&nl(t.version,e)>=0}function qs(){return typeof document<"u"}function tl(){return navigator.product=="ReactNative"}function KA(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function pee(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function mee(){if(!tl())return;let t=pee();if(t)return t.platform}function dH(){if(qs())return window.devicePixelRatio;if(tl()){let t=pee();if(t)return t.devicePixelRatio}return 1}function nl(t,e){const n=t.split("."),r=e.split("."),i=Math.min(n.length,r.length);for(let s=0;s<i;++s){const o=parseInt(n[s],10),a=parseInt(r[s],10);if(o>a)return 1;if(o<a)return-1;if(s===i-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==r.length?0:n.length<r.length?-1:1}function s2e(t){for(const e of t)e.target.handleResize(e)}function o2e(t){for(const e of t)e.target.handleVisibilityChanged(e)}let t6=null;const fH=()=>(t6||(t6=new ResizeObserver(s2e)),t6);let n6=null;const hH=()=>(n6||(n6=new IntersectionObserver(o2e,{root:null,rootMargin:"0px"})),n6);function a2e(){var t;const e=new pZ({sdk:mZ.JS,protocol:GSe,version:qSe});return tl()&&(e.os=(t=mee())!==null&&t!==void 0?t:""),e}function pH(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=document.createElement("canvas");i.width=t,i.height=e;const s=i.getContext("2d");s?.fillRect(0,0,i.width,i.height),r&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=i.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let L1;function r6(){if(!L1){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const r=t.createMediaStreamDestination();if(e.connect(n),n.connect(r),e.start(),[L1]=r.stream.getAudioTracks(),!L1)throw Error("Could not get empty media stream audio track");L1.enabled=!1}return L1.clone()}class ca{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((r,i)=>J(this,void 0,void 0,function*(){this.resolve=r,this.reject=i,e&&(yield e(r,i))})).finally(()=>{var r;this._isResolved=!0,(r=this.onFinally)===null||r===void 0||r.call(this)})}}function c2e(t){return WSe.includes(t)}function rf(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function l2e(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function zA(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function u2e(t,e){return t.segments.map(n=>{let{id:r,text:i,language:s,startTime:o,endTime:a,final:c}=n;var l;const d=(l=e.get(r))!==null&&l!==void 0?l:Date.now(),h=Date.now();return c?e.delete(r):e.set(r,d),{id:r,text:i,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:d,lastReceivedTime:h}})}function d2e(t){const{id:e,timestamp:n,message:r,editTimestamp:i}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:i?Number.parseInt(i.toString()):void 0,message:r}}function mH(t){switch(t.reason){case Nt.LeaveRequest:return t.context;case Nt.Cancelled:return Za.CLIENT_INITIATED;case Nt.NotAllowed:return Za.USER_REJECTED;case Nt.ServerUnreachable:return Za.JOIN_FAILURE;default:return Za.UNKNOWN_REASON}}function hw(t){return t!==void 0?Number(t):void 0}function Ah(t){return t!==void 0?BigInt(t):void 0}function qh(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function Qc(t){return!!t&&t.kind==he.Kind.Audio}function Of(t){return!!t&&t.kind==he.Kind.Video}function wd(t){return qh(t)&&Of(t)}function Hl(t){return qh(t)&&Qc(t)}function WA(t){return!!t&&!t.isLocal}function f2e(t){return!!t&&!t.isLocal}function i6(t){return WA(t)&&Of(t)}function h2e(t){return t.isLocal}function p2e(t,e){const n=[];let r=new TextEncoder().encode(t);for(;r.length>e;){let i=e;for(;i>0;){const s=r[i];if(s!==void 0&&(s&192)!==128)break;i--}n.push(r.slice(0,i)),r=r.slice(i)}return r.length>0&&n.push(r),n}function gee(t,e,n){var r,i,s,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=bee(t??{}),d=e?.processor,h=n?.processor,m=a??{};return m.audio===!0&&(m.audio={}),m.video===!0&&(m.video={}),m.audio&&(YA(m.audio,e),(r=(s=m.audio).deviceId)!==null&&r!==void 0||(s.deviceId={ideal:"default"}),(c||d)&&(m.audio.processor=c??d)),m.video&&(YA(m.video,n),(i=(o=m.video).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"}),(l||h)&&(m.video.processor=l??h)),m}function YA(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function R7(t){var e,n,r,i;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":YA(a,c.resolution);break;default:a[l]=c[l]}}),s.video=o,(e=(r=s.video).deviceId)!==null&&e!==void 0||(r.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(i=s.audio).deviceId)!==null&&n!==void 0||(i.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function vee(t){return J(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const r=yee();if(r){const i=r.createAnalyser();i.fftSize=2048;const s=i.frequencyBinCount,o=new Uint8Array(s);r.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield gs(n),i.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return r.close(),!c}return!1}()})}function yee(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const r=()=>J(this,void 0,void 0,function*(){var i;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}finally{(i=window.document.body)===null||i===void 0||i.removeEventListener("click",r)}});n.addEventListener("statechange",()=>{var i;n.state==="closed"&&((i=window.document.body)===null||i===void 0||i.removeEventListener("click",r))}),window.document.body.addEventListener("click",r)}return n}}function m2e(t){return t==="audioinput"?he.Source.Microphone:t==="videoinput"?he.Source.Camera:he.Source.Unknown}function XA(t){return t===he.Source.Microphone?"audioinput":t===he.Source.Camera?"videoinput":void 0}function g2e(t){var e,n;let r=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(r=typeof r=="boolean"?{}:r,rp()?r=Object.assign(Object.assign({},r),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):r=Object.assign(Object.assign({},r),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:r,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function Ly(t){return t.split("/")[1].toLowerCase()}function v2e(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new y7({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function Lt(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?Lt(t.track):{})}}function y2e(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function b2e(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const r=[...Object.keys(e),...Object.keys(t)],i={};for(const s of r)t[s]!==e[s]&&(i[s]=(n=e[s])!==null&&n!==void 0?n:"");return i}function bee(t){const e=Object.assign({},t);let n,r;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(r=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:r,optionsWithoutProcessor:$Se(e)}}function _2e(t){switch(t){case Fr.CAMERA:return he.Source.Camera;case Fr.MICROPHONE:return he.Source.Microphone;case Fr.SCREEN_SHARE:return he.Source.ScreenShare;case Fr.SCREEN_SHARE_AUDIO:return he.Source.ScreenShareAudio;default:return he.Source.Unknown}}function gH(t,e){return t.width*t.height<e.width*e.height}function S2e(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(r=>r.quality===e)}class E2e extends dl.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=r=>{var i,s;const{kind:o,data:a}=r.data;switch(o){case"error":Tt.error(a.error.message),this.emit(Kd.EncryptionError,a.error);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(d=>{this.postKey(d)});break;case"enable":if(a.enabled&&this.keyProvider.getKeys().forEach(d=>{this.postKey(d)}),this.encryptionEnabled!==a.enabled&&a.participantIdentity===((i=this.room)===null||i===void 0?void 0:i.localParticipant.identity))this.emit(Kd.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const d=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(a.participantIdentity);if(!d)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(Kd.ParticipantEncryptionStatusChanged,a.enabled,d)}break;case"ratchetKey":this.keyProvider.emit(nf.KeyRatcheted,a.ratchetResult,a.participantIdentity,a.keyIndex);break;case"decryptDataResponse":const c=this.decryptDataRequests.get(a.uuid);c?.resolve&&c.resolve(a);break;case"encryptDataResponse":const l=this.encryptDataRequests.get(a.uuid);l?.resolve&&l.resolve(a);break}},this.onWorkerError=r=>{Tt.error("e2ee worker encountered an error:",{error:r.error}),this.emit(Kd.EncryptionError,r.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!dee())throw new T7("tried to setup end-to-end encryption on an unsupported browser");if(Tt.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:bSe.getLevel()}};this.worker&&(Tt.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){Tt.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?Tt.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(Pe.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(ue.TrackPublished,(r,i)=>this.setParticipantCryptorEnabled(r.trackInfo.encryption!==si.NONE,i.identity)),e.on(ue.ConnectionStateChanged,r=>{r===xt.Connected&&e.remoteParticipants.forEach(i=>{i.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==si.NONE,i.identity)})})}).on(ue.TrackUnsubscribed,(r,i,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:r.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(ue.TrackSubscribed,(r,i,s)=>{this.setupE2EEReceiver(r,s.identity,i.trackInfo)}).on(ue.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(r=>{this.postKey(r)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(ce.LocalSenderCreated,(r,i)=>J(this,void 0,void 0,function*(){this.setupE2EESender(i,r)})),e.localParticipant.on(ce.LocalTrackPublished,r=>{if(!Of(r.track)||!Eb())return;const i={kind:"updateCodec",data:{trackId:r.track.mediaStreamID,codec:Ly(r.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}),n.on(nf.SetKey,r=>this.postKey(r)).on(nf.RatchetRequest,(r,i)=>this.postRatchetRequest(r,i))}encryptData(e){return J(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),r={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},i=new ca;return i.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,i),this.worker.postMessage(r),i.promise})}handleEncryptedData(e,n,r,i){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const s=crypto.randomUUID(),o={kind:"decryptDataRequest",data:{uuid:s,payload:e,iv:n,participantIdentity:r,keyIndex:i}},a=new ca;return a.onFinally=()=>{this.decryptDataRequests.delete(s)},this.decryptDataRequests.set(s,a),this.worker.postMessage(o),a.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(r)}postKey(e){let{key:n,participantIdentity:r,keyIndex:i}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:r,isPublisher:r===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:i}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const r={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(r)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const r={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,r){if(e.receiver){if(!r?.mimeType||r.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Ly(r.mimeType):void 0)}}setupE2EESender(e,n){if(!qh(e)||!n){n||Tt.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,r,i){return J(this,void 0,void 0,function*(){if(this.worker){if($A()&&!uH()){const s={kind:"decode",participantIdentity:r,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(A1 in e&&i){const c={kind:"updateCodec",data:{trackId:n,codec:i,participantIdentity:r}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:i,participantIdentity:r,isReuse:A1 in e}};this.worker.postMessage(a,[o,s])}e[A1]=!0}})}handleSender(e,n,r){var i;if(!(A1 in e||!this.worker)){if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if($A()&&!uH()){Tt.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{Tt.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:r,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[A1]=!0}}}const s6="default";class Ti{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Ti),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return J(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=Ti.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){Tt.debug("awaiting getUserMedia promise");try{n?yield Ti.userMediaPromiseMap.get(n):yield Promise.all(Ti.userMediaPromiseMap.values())}catch{Tt.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(i&&!(rp()&&r.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const l=c.label==="",d=n?c.kind===n:!0;return l&&d}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(d=>{d.stop()})}return r._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,r){return J(this,void 0,void 0,function*(){if(n!==s6)return n;const i=yield this.getDevices(e),s=i.find(a=>a.deviceId===s6);if(!s){Tt.warn("could not reliably determine default device");return}const o=i.find(a=>a.deviceId!==s6&&a.groupId===(r??s.groupId));if(!o){Tt.warn("could not reliably determine default device");return}return o?.deviceId})}hasDeviceInUse(e){return e?Ti.userMediaPromiseMap.has(e):Ti.userMediaPromiseMap.size>0}}Ti.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Ti.userMediaPromiseMap=new Map;var Oy;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(Oy||(Oy={}));class w2e{constructor(){this.pendingTasks=new Map,this.taskMutex=new ms,this.nextTaskIndex=0}run(e){return J(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Oy.WAITING};this.pendingTasks.set(n.id,n);const r=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Oy.RUNNING,yield e()}finally{n.status=Oy.COMPLETED,this.pendingTasks.delete(n.id),r()}})}flush(){return J(this,void 0,void 0,function*(){return this.run(()=>J(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class C2e{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r,i;if(!((r=n.signal)===null||r===void 0)&&r.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const s=new WebSocket(e,(i=n.protocols)!==null&&i!==void 0?i:[]);s.binaryType="arraybuffer",this.ws=s;const o=function(){let{closeCode:a,reason:c}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return s.close(a,c)};this.opened=new Promise((a,c)=>{s.onopen=()=>{a({readable:new ReadableStream({start(l){s.onmessage=d=>{let{data:h}=d;return l.enqueue(h)},s.onerror=d=>l.error(d)},cancel:o}),writable:new WritableStream({write(l){s.send(l)},abort(){s.close()},close:o}),protocol:s.protocol,extensions:s.extensions}),s.removeEventListener("error",c)},s.addEventListener("error",c)}),this.closed=new Promise((a,c)=>{const l=()=>J(this,void 0,void 0,function*(){const d=new Promise(m=>{s.readyState!==WebSocket.CLOSED&&s.addEventListener("close",g=>{m(g)},{once:!0})}),h=yield Promise.race([gs(250),d]);h?a(h):c(new Error("Encountered unspecified websocket error without a timely close event"))});s.onclose=d=>{let{code:h,reason:m}=d;a({closeCode:h,reason:m}),s.removeEventListener("error",l)},s.addEventListener("error",l)}),n.signal&&(n.signal.onabort=()=>s.close()),this.close=o}}function T2e(t,e){const n=new URL(l2e(t));return e.forEach((r,i)=>{n.searchParams.set(i,r)}),_ee(n,"rtc")}function R2e(t){const e=new URL(zA(t));return _ee(e,"validate")}function I2e(t){return t.endsWith("/")?t:"".concat(t,"/")}function _ee(t,e){return t.pathname="".concat(I2e(t.pathname)).concat(e),t.toString()}function vH(t){if(typeof t=="string")return KB.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return KB.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function k2e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const x2e=["syncState","trickle","offer","answer","simulate","leave"];function A2e(t){const e=x2e.indexOf(t.case)>=0;return Tt.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var or;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(or||(or={}));const P2e=250;class I7{get currentState(){return this.state}get isDisconnected(){return this.state===or.DISCONNECTING||this.state===or.DISCONNECTED}get isEstablishingConnection(){return this.state===or.CONNECTING||this.state===or.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;this.rtt=0,this.state=or.DISCONNECTED,this.log=Tt,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=ku((r=n.loggerName)!==null&&r!==void 0?r:sc.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new w2e,this.queuedRequests=[],this.closingLock=new ms,this.connectionLock=new ms,this.state=or.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,r,i){return J(this,void 0,void 0,function*(){return this.state=or.CONNECTING,this.options=r,yield this.connect(e,n,r,i)})}reconnect(e,n,r,i){return J(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=or.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:r,reconnectReason:i}))})}connect(e,n,r,i){return J(this,void 0,void 0,function*(){const s=yield this.connectionLock.lock();this.connectOptions=r;const o=a2e(),a=r.singlePeerConnection?O2e(n,o,r):L2e(n,o,r),c=T2e(e,a),l=R2e(c);return new Promise((d,h)=>J(this,void 0,void 0,function*(){var m,g;try{let y=!1;const v=T=>J(this,void 0,void 0,function*(){if(y)return;y=!0;const I=T instanceof Event?T.currentTarget:T,k=k2e(I,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(k)).catch(A=>{this.log.error(A),this.close()}):this.close(),w(),h(I instanceof AbortSignal?I.reason:I)});i?.addEventListener("abort",v);const w=()=>{clearTimeout(S),i?.removeEventListener("abort",v)},S=setTimeout(()=>{v(new Qt("room connection has timed out (signal)",Nt.ServerUnreachable))},r.websocketTimeout),R=(T,I)=>{this.handleSignalConnected(T,S,I)},x=new URL(c);x.searchParams.has("access_token")&&x.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(x),Object.assign({reconnect:r.reconnect,reconnectReason:r.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new C2e(c);try{this.ws.closed.then(N=>{this.isEstablishingConnection&&h(new Qt("Websocket got closed during a (re)connection attempt: ".concat(N.reason),Nt.InternalError)),N.closeCode!==1e3&&this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:N.reason,code:N.closeCode,wasClean:N.closeCode===1e3,state:this.state}))}).catch(N=>{this.isEstablishingConnection&&h(new Qt("Websocket error during a (re)connection attempt: ".concat(N),Nt.InternalError))});const T=yield this.ws.opened.catch(N=>J(this,void 0,void 0,function*(){if(this.state!==or.CONNECTED){this.state=or.DISCONNECTED,clearTimeout(S);const U=yield this.handleConnectionError(N,l);h(U);return}this.handleWSError(N),h(N)}));if(clearTimeout(S),!T)return;const I=T.readable.getReader();this.streamWriter=T.writable.getWriter();const k=yield I.read();if(I.releaseLock(),!k.value)throw new Qt("no message received as first message",Nt.InternalError);const A=vH(k.value),O=this.validateFirstMessage(A,(m=r.reconnect)!==null&&m!==void 0?m:!1);if(!O.isValid){h(O.error);return}((g=A.message)===null||g===void 0?void 0:g.case)==="join"&&(this.pingTimeoutDuration=A.message.value.pingTimeout,this.pingIntervalDuration=A.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const D=O.shouldProcessFirstMessage?A:void 0;R(T,D),d(O.response)}catch(T){h(T)}finally{w()}}finally{s()}}))})}startReadingLoop(e,n){return J(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield gs(this.signalLatency));const{done:r,value:i}=yield e.read();if(r)break;const s=vH(i);this.handleSignalResponse(s)}})}close(){return J(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return function*(){const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=or.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:r});const s=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([s,gs(P2e)])}}catch(s){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:s}))}finally{n&&(e.state=or.DISCONNECTED),i()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:ug(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:ug(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new uT({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new dT({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return J(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new _7({requestId:a,metadata:r,name:i,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new EZ({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new TZ({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:nr.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new kZ({timestamp:nr.parse(Date.now()),rtt:nr.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new b7({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new hT({reason:Za.CLIENT_INITIATED,action:Ag.DISCONNECT})})}sendRequest(e){return J(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!i&&!A2e(n)&&r.state===or.RECONNECTING){r.queuedRequests.push(()=>J(r,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(i||(yield r.requestQueue.flush()),r.signalLatency&&(yield gs(r.signalLatency)),r.isDisconnected){r.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!r.streamWriter){r.log.error("cannot send signal request before connected, type: ".concat(n?.case),r.logContext);return}const o=new V_e({message:n});try{r.useJSON?yield r.streamWriter.write(o.toJsonString()):yield r.streamWriter.write(o.toBinary())}catch(a){r.log.error("error sending signal message",Object.assign(Object.assign({},r.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,r;const i=e.message;if(i==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(i.case==="answer"){const o=yH(i.value);this.onAnswer&&this.onAnswer(o,i.value.id,i.value.midToTrackId)}else if(i.case==="offer"){const o=yH(i.value);this.onOffer&&this.onOffer(o,i.value.id,i.value.midToTrackId)}else if(i.case==="trickle"){const o=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(o,i.value.target)}else i.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=i.value.participants)!==null&&n!==void 0?n:[]):i.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):i.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((r=i.value.speakers)!==null&&r!==void 0?r:[]):i.case==="leave"?this.onLeave&&this.onLeave(i.value):i.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):i.case==="roomUpdate"?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):i.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(i.value):i.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):i.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):i.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):i.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(i.value):i.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):i.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(i.value):i.case==="pong"||(i.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):i.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(i.value):i.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):i.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(i.value.token),this.onRoomMoved&&this.onRoomMoved(i.value)):i.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(i.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return J(this,void 0,void 0,function*(){if(this.state===or.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Bi.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Bi.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Bi.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Bi.clearInterval(this.pingInterval)}handleSignalConnected(e,n,r){this.state=or.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),r)}validateFirstMessage(e,n){var r,i,s,o,a;return((r=e.message)===null||r===void 0?void 0:r.case)==="join"?{isValid:!0,response:e.message.value}:this.state===or.RECONNECTING&&((i=e.message)===null||i===void 0?void 0:i.case)!=="leave"?((s=e.message)===null||s===void 0?void 0:s.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((o=e.message)===null||o===void 0?void 0:o.case)==="leave"?{isValid:!1,error:new Qt("Received leave request while trying to (re)connect",Nt.LeaveRequest,void 0,e.message.value.reason)}:n?{isValid:!1,error:new Qt("Unexpected first message",Nt.InternalError)}:{isValid:!1,error:new Qt("did not receive join response, got ".concat((a=e.message)===null||a===void 0?void 0:a.case," instead"),Nt.InternalError)}}handleConnectionError(e,n){return J(this,void 0,void 0,function*(){try{const r=yield fetch(n);if(r.status.toFixed(0).startsWith("4")){const i=yield r.text();return new Qt(i,Nt.NotAllowed,r.status)}else return e instanceof Qt?e:new Qt("Encountered unknown websocket error during connection: ".concat(e),Nt.InternalError,r.status)}catch(r){return r instanceof Qt?r:new Qt(r instanceof Error?r.message:"server was not reachable",Nt.ServerUnreachable)}})}}function yH(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function ug(t,e){return new mf({sdp:t.sdp,type:t.type,id:e})}function L2e(t,e,n){var r;const i=new URLSearchParams;return i.set("access_token",t),n.reconnect&&(i.set("reconnect","1"),n.sid&&i.set("sid",n.sid)),i.set("auto_subscribe",n.autoSubscribe?"1":"0"),i.set("sdk",tl()?"reactnative":"js"),i.set("version",e.version),i.set("protocol",e.protocol.toString()),e.deviceModel&&i.set("device_model",e.deviceModel),e.os&&i.set("os",e.os),e.osVersion&&i.set("os_version",e.osVersion),e.browser&&i.set("browser",e.browser),e.browserVersion&&i.set("browser_version",e.browserVersion),n.adaptiveStream&&i.set("adaptive_stream","1"),n.reconnectReason&&i.set("reconnect_reason",n.reconnectReason.toString()),!((r=navigator.connection)===null||r===void 0)&&r.type&&i.set("network",navigator.connection.type),i}function O2e(t,e,n){const r=new URLSearchParams;r.set("access_token",t);const i=new dSe({clientInfo:e,connectionSettings:new xZ({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(i.reconnectReason=n.reconnectReason);const s=new fSe({joinRequest:i.toBinary()});return r.set("join_request",btoa(new TextDecoder("utf-8").decode(s.toBinary()))),r}class bH{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class M2e{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const r=Date.now();r-this._lastCleanup>this.ttl/2&&this.cleanup();const i=r+this.ttl;return this._map.set(e,{value:n,expiresAt:i}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,r]of this._map.entries())r.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,r]of this._map.entries())r.expiresAt>=Date.now()&&e(r.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],r=this.asValueMap();for(const[i,s]of r.entries())n.push(e(s,i,r));return n}asValueMap(){const e=new Map;for(const[n,r]of this._map.entries())r.expiresAt>=Date.now()&&e.set(n,r.value);return e}}var ja={},o6={},a6={exports:{}},_H;function k7(){if(_H)return a6.exports;_H=1;var t=a6.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),a6.exports}var SH;function D2e(){return SH||(SH=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,d){if(d&&!l)c[d]=e(a[1]);else for(var h=0;h<l.length;h+=1)a[h+1]!=null&&(c[l[h]]=e(a[h+1]))},r=function(a,c,l){var d=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:d&&!c[a.name]&&(c[a.name]={});var h=a.push?{}:d?c[a.name]:c;n(l.match(a.reg),h,a.names,a.name),a.push&&c[a.push].push(h)},i=k7(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],d=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(h){var m=h[0],g=h.slice(2);m==="m"&&(l.push({rtp:[],fmtp:[]}),d=l[l.length-1]);for(var y=0;y<(i[m]||[]).length;y+=1){var v=i[m][y];if(v.reg.test(g))return r(v,d,g)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),d=0;d<l.length;d+=3)c.push({component:l[d],ip:l[d+1],port:l[d+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var d,h=!1;return l[0]!=="~"?d=e(l):(d=e(l.substring(1,l.length)),h=!0),{scid:d,paused:h}})})}}(o6)),o6}var c6,EH;function N2e(){if(EH)return c6;EH=1;var t=k7(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(d){if(a>=l)return d;var h=c[a];switch(a+=1,d){case"%%":return"%";case"%s":return String(h);case"%d":return Number(h);case"%v":return""}})},r=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,d=[o+"="+l];if(a.names)for(var h=0;h<a.names.length;h+=1){var m=a.names[h];a.name?d.push(c[a.name][m]):d.push(c[a.names[h]])}else d.push(c[a.name]);return n.apply(null,d)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return c6=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(h){h.payloads==null&&(h.payloads="")});var c=a.outerOrder||i,l=a.innerOrder||s,d=[];return c.forEach(function(h){t[h].forEach(function(m){m.name in o&&o[m.name]!=null?d.push(r(h,m,o)):m.push in o&&o[m.push]!=null&&o[m.push].forEach(function(g){d.push(r(h,m,g))})})}),o.media.forEach(function(h){d.push(r("m",t.m[0],h)),l.forEach(function(m){t[m].forEach(function(g){g.name in h&&h[g.name]!=null?d.push(r(m,g,h)):g.push in h&&h[g.push]!=null&&h[g.push].forEach(function(y){d.push(r(m,g,y))})})})}),d.join(`\r
`)+`\r
`},c6}var wH;function U2e(){if(wH)return ja;wH=1;var t=D2e(),e=N2e(),n=k7();return ja.grammar=n,ja.write=e,ja.parse=t.parse,ja.parseParams=t.parseParams,ja.parseFmtpConfig=t.parseFmtpConfig,ja.parsePayloads=t.parsePayloads,ja.parseRemoteCandidates=t.parseRemoteCandidates,ja.parseImageAttributes=t.parseImageAttributes,ja.parseSimulcastStreamList=t.parseSimulcastStreamList,ja}var Pd=U2e();function x7(t,e,n){var r,i,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(r=n.isImmediate)!=null&&r,a=(i=n.callback)!=null&&i,c=n.maxWait,l=Date.now(),d=[];function h(){if(c!==void 0){var g=Date.now()-l;if(g+e>=c)return c-g}return e}var m=function(){var g=[].slice.call(arguments),y=this;return new Promise(function(v,w){var S=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var x=t.apply(y,g);a&&a(x),d.forEach(function(T){return(0,T.resolve)(x)}),d=[]}},h()),S){var R=t.apply(y,g);return a&&a(R),v(R)}d.push({resolve:v,reject:w})})};return m.cancel=function(g){s!==void 0&&clearTimeout(s),d.forEach(function(y){return(0,y.reject)(g)}),d=[]},m}const j2e=.7,F2e=20,Og={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class CH extends dl.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;super(),this.log=Tt,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=x7(i=>J(this,void 0,void 0,function*(){this.emit(Og.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(i)i(s);else throw s}}),F2e),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=ku((r=n.loggerName)!==null&&r!==void 0?r:sc.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new ms}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var r;n.candidate&&((r=this.onIceCandidate)===null||r===void 0||r.call(this,n.candidate))},e.onicecandidateerror=n=>{var r;(r=this.onIceCandidateError)===null||r===void 0||r.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var r;(r=this.onDataChannel)===null||r===void 0||r.call(this,n)},e.ontrack=n=>{var r;(r=this.onTrack)===null||r===void 0||r.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return J(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return J(this,void 0,void 0,function*(){var r;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let i;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=$2e(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=Pd.parse((r=e.sdp)!==null&&r!==void 0?r:"");s.media.forEach(o=>{const a=A7(o.mid);o.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||a!=c.transceiver.mid)return!1;let l=0;if(o.rtp.some(h=>h.codec.toUpperCase()===c.codec.toUpperCase()?(l=h.payload,!0):!1),l===0)return!0;let d=!1;for(const h of o.fmtp)if(h.payload===l){h.config=h.config.split(";").filter(m=>!m.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(h.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),d=!0;break}return d||c.maxbr>0&&o.fmtp.push({payload:l,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),i=Pd.write(s)}return yield this.setMungedSDP(e,i,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Og.NegotiationComplete),e.sdp&&Pd.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(Og.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return J(this,void 0,void 0,function*(){var n;const r=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e?.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const i=this.latestOfferId+1;this.latestOfferId=i;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=Pd.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{RH(a),a.type==="audio"?TH(a,["all"],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(h=>h.codec.toUpperCase()===c.codec.toUpperCase()?(l=h.payload,!0):!1),l===0||(Gc(c.codec)&&!rp()&&this.ensureVideoDDExtensionForSVC(a,o),c.codec!=="av1"))return!0;const d=Math.round(c.maxbr*j2e);for(const h of a.fmtp)if(h.payload===l){h.config.includes("x-google-start-bitrate")||(h.config+=";x-google-start-bitrate=".concat(d));break}return!0})}),this.latestOfferId>i){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:i}));return}yield this.setMungedSDP(s,Pd.write(o)),this.onOffer(s,this.latestOfferId)}finally{r()}})}createAndSetAnswer(){return J(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),r=Pd.parse((e=n.sdp)!==null&&e!==void 0?e:"");return r.media.forEach(i=>{RH(i),i.type==="audio"&&TH(i,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Pd.write(r)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Jr("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Jr("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return J(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const r=new Map,i=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),r.set(a.id,a);break;case"remote-candidate":i.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=r.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return i.get(o)})}setMungedSDP(e,n,r){return J(this,void 0,void 0,function*(){if(n){const i=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(r?"remote":"local"," description"),this.logContext),r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=i}}try{r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(i){let s="unknown error";i instanceof Error?s=i.message:typeof i=="string"&&(s=i);const o={error:s,sdp:e.sdp};throw!r&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new BA(s)}})}ensureVideoDDExtensionForSVC(e,n){var r,i;if(!((r=e.ext)===null||r===void 0?void 0:r.some(o=>o.uri===lH))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>o&&(o=l.value)}))}),this.ddExtID=o+1}(i=e.ext)===null||i===void 0||i.push({value:this.ddExtID,uri:lH})}}}function TH(t,e,n){const r=A7(t.mid);let i=0;t.rtp.some(s=>s.codec==="opus"?(i=s.payload,!0):!1),i>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(r)&&!t.rtcpFb.some(s=>s.payload===i&&s.type==="nack")&&t.rtcpFb.push({payload:i,type:"nack"}),(e.includes(r)||e.length===1&&e[0]==="all")&&t.fmtp.some(s=>s.payload===i?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function $2e(t){var e;const n=[],r=[],i=Pd.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return i.media.forEach(o=>{var a;const c=A7(o.mid);o.type==="audio"&&(o.rtp.some(l=>l.codec==="opus"?(s=l.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(l=>l.payload===s&&l.type==="nack")&&r.push(c),o.fmtp.some(l=>l.payload===s?(l.config.includes("sprop-stereo=1")&&n.push(c),!0):!1))}),{stereoMids:n,nackMids:r}}function RH(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function A7(t){return typeof t=="number"?t.toFixed(0):t}const JA="vp8",B2e={audioPreset:IC.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:pT.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:JA,backupCodec:!0,preConnectBuffer:!1},See={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Eee={deviceId:{ideal:"default"},resolution:Yc.h720.resolution},H2e={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new LZ,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},P7={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var yr;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(yr||(yr={}));class V2e{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,r){var i;this.peerConnectionTimeout=P7.peerConnectionTimeout,this.log=Tt,this.updateState=()=>{var s,o;const a=this.state,c=this.requiredTransports.map(l=>l.getConnectionState());c.every(l=>l==="connected")?this.state=yr.CONNECTED:c.some(l=>l==="failed")?this.state=yr.FAILED:c.some(l=>l==="connecting")?this.state=yr.CONNECTING:c.every(l=>l==="closed")?this.state=yr.CLOSED:c.some(l=>l==="closed")?this.state=yr.CLOSING:c.every(l=>l==="new")&&(this.state=yr.NEW),a!==this.state&&(this.log.debug("pc state change: from ".concat(yr[a]," to ").concat(yr[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),(o=this.subscriber)===null||o===void 0?void 0:o.getConnectionState()))},this.log=ku((i=r.loggerName)!==null&&i!==void 0?i:sc.PCManager),this.loggerOptions=r,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new CH(e,r),n!=="publisher-only"&&(this.subscriber=new CH(e,r),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Ja.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Ja.PUBLISHER)},this.publisher.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=yr.NEW,this.connectionLock=new ms,this.remoteOfferLock=new ms}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return J(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const r of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(r)}catch(i){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:i}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return J(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return J(this,void 0,void 0,function*(){var r;n===Ja.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(r=this.subscriber)===null||r===void 0?void 0:r.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return J(this,void 0,void 0,function*(){var r,i,s;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(r=this.subscriber)===null||r===void 0?void 0:r.getSignallingState().toString()}));const o=yield this.remoteOfferLock.lock();try{return(yield(i=this.subscriber)===null||i===void 0?void 0:i.setRemoteDescription(e,n))?yield(s=this.subscriber)===null||s===void 0?void 0:s.createAndSetAnswer():void 0}finally{o()}})}updateConfiguration(e,n){var r;this.publisher.setConfiguration(e),(r=this.subscriber)===null||r===void 0||r.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return J(this,void 0,void 0,function*(){var r;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((r=this.requiredTransports)===null||r===void 0?void 0:r.map(s=>this.ensureTransportConnected(s,e,n)))}finally{i()}})}negotiate(e){return J(this,void 0,void 0,function*(){return new Promise((n,r)=>J(this,void 0,void 0,function*(){const i=setTimeout(()=>{r("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(i),r("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(Og.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Og.NegotiationComplete,()=>{clearTimeout(i),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(i),r(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const r=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(i=>i.receiver===e);return r?.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Ja.PUBLISHER?this.publisher.getConnectedAddress():e===Ja.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return J(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(r.getConnectionState()!=="connected")return new Promise((c,l)=>J(s,void 0,void 0,function*(){const d=()=>{this.log.warn("abort transport connection",this.logContext),Bi.clearTimeout(h),l(new Qt("room connection has been cancelled",Nt.Cancelled))};i?.signal.aborted&&d(),i?.signal.addEventListener("abort",d);const h=Bi.setTimeout(()=>{i?.signal.removeEventListener("abort",d),l(new Qt("could not establish pc connection",Nt.InternalError))},o);for(;this.state!==yr.CONNECTED;)if(yield gs(50),i?.signal.aborted){l(new Qt("room connection has been cancelled",Nt.Cancelled));return}Bi.clearTimeout(h),i?.signal.removeEventListener("abort",d),c()}))}()})}}class Sr extends Error{constructor(e,n,r){super(n),this.code=e,this.message=IH(n,Sr.MAX_MESSAGE_BYTES),this.data=r?IH(r,Sr.MAX_DATA_BYTES):void 0}static fromProto(e){return new Sr(e.code,e.message,e.data)}toProto(){return new uZ({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Sr(Sr.ErrorCode[e],Sr.ErrorMessage[e],n)}}Sr.MAX_MESSAGE_BYTES=256;Sr.MAX_DATA_BYTES=15360;Sr.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Sr.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const wee=15360;function L7(t){return new TextEncoder().encode(t).length}function IH(t,e){if(L7(t)<=e)return t;let n=0,r=t.length;const i=new TextEncoder;for(;n<r;){const s=Math.floor((n+r+1)/2);i.encode(t.slice(0,s)).length<=e?n=s:r=s-1}return t.slice(0,n)}const O7=2e3;function mT(t,e){if(!e)return 0;let n,r;return"bytesReceived"in t?(n=t.bytesReceived,r=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,r=e.bytesSent),n===void 0||r===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-r)*8*1e3/(t.timestamp-e.timestamp)}const M7=typeof MediaRecorder<"u";class q2e{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const G2e=M7?MediaRecorder:q2e;class K2e extends G2e{constructor(e,n){if(!M7)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let r,i;const s=()=>i===void 0,o=()=>{this.removeEventListener("dataavailable",r),this.removeEventListener("stop",o),this.removeEventListener("error",a),i?.close(),i=void 0},a=c=>{i?.error(c),this.removeEventListener("dataavailable",r),this.removeEventListener("stop",o),this.removeEventListener("error",a),i=void 0};this.byteStream=new ReadableStream({start:c=>{i=c,r=l=>J(this,void 0,void 0,function*(){let d;if(l.data.arrayBuffer){const h=yield l.data.arrayBuffer();d=new Uint8Array(h)}else if(l.data.byteArray)d=l.data.byteArray;else throw new Error("no data available!");s()||c.enqueue(d)}),this.addEventListener("dataavailable",r)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function z2e(){return M7}const W2e=1e3,Y2e=1e4;class D7 extends he{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=x7(()=>J(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>J(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Te.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new ms,this.pauseUpstreamLock=new ms,this.trackChangeLock=new ms,this.trackChangeLock.lock().then(o=>J(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{o()}})),this._constraints=e.getConstraints(),r&&(this._constraints=r)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==he.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return J(this,void 0,void 0,function*(){var r;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{Lg(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let i;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(lg(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),i=this.processor.processedTrack}this.sender&&((r=this.sender.transport)===null||r===void 0?void 0:r.state)!=="closed"&&(yield this.sender.replaceTrack(i??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{lg(i??e,s)}))})}waitForDimensions(){return J(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:W2e;return function*(){var r;if(e.kind===he.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((r=zs())===null||r===void 0?void 0:r.os)==="iOS"&&(yield gs(10));const i=Date.now();for(;Date.now()-i<n;){const s=e.dimensions;if(s)return s;yield gs(50)}throw new cu("unable to get track dimensions after timeout")}()})}setDeviceId(e){return J(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===rf(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),rf(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return J(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===he.Source.ScreenShare)return;const{deviceId:r,groupId:i}=e._mediaStreamTrack.getSettings(),s=e.kind===he.Kind.Audio?"audioinput":"videoinput";return n?Ti.getInstance().normalizeDeviceId(s,r,i):r}()})}mute(){return J(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return J(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return J(this,void 0,void 0,function*(){const r=yield this.trackChangeLock.lock();try{if(!this.sender)throw new cu("unable to replace an unpublished track");let i,s;return typeof n=="boolean"?i=n:n!==void 0&&(i=n.userProvidedTrack,s=n.stopProcessor),this.providedByUser=i??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{r()}})}restart(e){return J(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:r,facingMode:i}=e,s=SSe(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===he.Kind.Video?o.video=r||i?{deviceId:r,facingMode:i}:!0:o.audio=r?Object.assign({deviceId:r},s):!0,this.attachedElements.forEach(l=>{Lg(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return this.kind===he.Kind.Video&&(yield c.applyConstraints(s)),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(Te.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Te.Muted:Te.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return J(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),hee()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return J(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(Te.UpstreamPaused,this);const r=zs();if(r?.name==="Safari"&&nl(r.version,"12.0")<0)throw new T7("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return J(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(Te.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return J(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return J(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield r.trackChangeLock.lock();try{r.log.debug("setting up processor",r.logContext);const a=document.createElement(r.kind),c={kind:r.kind,track:r._mediaStreamTrack,element:a,audioContext:r.audioContext};if(yield n.init(c),r.log.debug("processor initialized",r.logContext),r.processor&&(yield r.internalStopProcessor()),r.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(lg(r._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>{l instanceof DOMException&&l.name==="AbortError"?(r.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},r.logContext),{error:l})),setTimeout(()=>{a.play().catch(d=>{r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{err:d}))})},100)):r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{error:l}))}),r.processor=n,r.processorElement=a,r.processor.processedTrack){for(const l of r.attachedElements)l!==r.processorElement&&i&&(Lg(r._mediaStreamTrack,l),lg(r.processor.processedTrack,l));yield(s=r.sender)===null||s===void 0?void 0:s.replaceTrack(r.processor.processedTrack)}r.emit(Te.TrackProcessorUpdate,r.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return J(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const r=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{r()}}()})}internalStopProcessor(){return J(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var r,i;e.processor&&(e.log.debug("stopping processor",e.logContext),(r=e.processor.processedTrack)===null||r===void 0||r.stop(),yield e.processor.destroy(),e.processor=void 0,n||((i=e.processorElement)===null||i===void 0||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Te.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!z2e()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new K2e(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},Y2e)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class kC extends D7{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,he.Kind.Audio,n,r,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>J(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=mT(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Te.AudioTrackFeatureUpdate,this,Ci.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Te.AudioTrackFeatureUpdate,this,Ci.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return J(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===he.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return J(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const r=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==rf(this._constraints.deviceId);return this.source===he.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||r)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return J(this,void 0,void 0,function*(){let n;if(e){const r=R7({audio:e});typeof r.audio!="boolean"&&(n=r.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return J(this,void 0,void 0,function*(){const r=yield n.restart.call(this,e);return this.checkForSilence(),r})}startMonitor(){qs()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},O7)))}setProcessor(e){return J(this,void 0,void 0,function*(){var n;const r=yield this.trackChangeLock.lock();try{if(!tl()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const i={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(i),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Te.TrackProcessorUpdate,this.processor)}finally{r()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return J(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let r;return n.forEach(i=>{i.type==="outbound-rtp"&&(r={type:"audio",streamId:i.id,packetsSent:i.packetsSent,packetsLost:i.packetsLost,bytesSent:i.bytesSent,timestamp:i.timestamp,roundTripTime:i.roundTripTime,jitter:i.jitter})}),r})}checkForSilence(){return J(this,void 0,void 0,function*(){const e=yield vee(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(Te.AudioSilenceDetected)),e})}}function X2e(t,e,n){switch(t.kind){case"audio":return new kC(t,e,!1,void 0,n);case"video":return new cv(t,e,!1,n);default:throw new cu("unsupported track type: ".concat(t.kind))}}const J2e=Object.values(Yc),Q2e=Object.values(HA),Z2e=Object.values(pT),eEe=[Yc.h180,Yc.h360],tEe=[HA.h180,HA.h360],nEe=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var r,i;return new Cn(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((r=t.encoding.maxFramerate)!==null&&r!==void 0?r:30)/((i=n.fps)!==null&&i!==void 0?i:30))))),n.fps,t.encoding.priority)}),QA=["q","h","f"];function ZA(t,e,n,r){var i,s;let o=r?.videoEncoding;t&&(o=r?.screenShareEncoding);const a=r?.simulcast,c=r?.scalabilityMode,l=r?.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=iEe(t,e,n,l),Tt.debug("using video encoding",o));const d=o.maxFramerate,h=new Cn(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&Gc(l)){const y=new Cee(c),v=[];if(y.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const w=zs();if(Eb()||tl()||w?.name==="Chrome"&&nl(w?.version,"113")<0){const S=y.suffix=="h"?2:3,R=r2e(w);for(let x=0;x<y.spatial;x+=1)v.push({rid:QA[2-x],maxBitrate:o.maxBitrate/Math.pow(S,x),maxFramerate:h.encoding.maxFramerate,scaleResolutionDownBy:R?Math.pow(2,x):void 0});v[0].scalabilityMode=c}else v.push({maxBitrate:o.maxBitrate,maxFramerate:h.encoding.maxFramerate,scalabilityMode:c});return h.encoding.priority&&(v[0].priority=h.encoding.priority,v[0].networkPriority=h.encoding.priority),Tt.debug("using svc encoding",{encodings:v}),v}if(!a)return[o];let m=[];t?m=(i=xH(r?.screenShareSimulcastLayers))!==null&&i!==void 0?i:kH(t,h):m=(s=xH(r?.videoSimulcastLayers))!==null&&s!==void 0?s:kH(t,h);let g;if(m.length>0){const y=m[0];m.length>1&&([,g]=m);const v=Math.max(e,n);if(v>=960&&g)return l6(e,n,[y,g,h],d);if(v>=480)return l6(e,n,[y,h],d)}return l6(e,n,[h])}function rEe(t,e,n){var r,i,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&Tt.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(r=a.width)!==null&&r!==void 0?r:(i=t.dimensions)===null||i===void 0?void 0:i.width,l=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===he.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),ZA(t.source===he.Source.ScreenShare,c,l,n)}function iEe(t,e,n,r){const i=sEe(t,e,n);let{encoding:s}=i[0];const o=Math.max(e,n);for(let a=0;a<i.length;a+=1){const c=i[a];if(s=c.encoding,c.width>=o)break}if(r)switch(r){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function sEe(t,e,n){if(t)return Z2e;const r=e>n?e/n:n/e;return Math.abs(r-16/9)<Math.abs(r-4/3)?J2e:Q2e}function kH(t,e){if(t)return nEe(e);const{width:n,height:r}=e,i=n>r?n/r:r/n;return Math.abs(i-16/9)<Math.abs(i-4/3)?eEe:tEe}function l6(t,e,n,r){const i=[];if(n.forEach((s,o)=>{if(o>=QA.length)return;const a=Math.min(t,e),l={rid:QA[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},d=r&&s.encoding.maxFramerate?Math.min(r,s.encoding.maxFramerate):s.encoding.maxFramerate;d&&(l.maxFramerate=d);const h=np()||o===0;s.encoding.priority&&h&&(l.priority=s.encoding.priority,l.networkPriority=s.encoding.priority),i.push(l)}),tl()&&mee()==="ios"){let s;i.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;i.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,Tt.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Tt.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return i}function xH(t){if(t)return t.sort((e,n)=>{const{encoding:r}=e,{encoding:i}=n;return r.maxBitrate>i.maxBitrate?1:r.maxBitrate<i.maxBitrate?-1:r.maxBitrate===i.maxBitrate&&r.maxFramerate&&i.maxFramerate?r.maxFramerate>i.maxFramerate?1:-1:0})}class Cee{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function oEe(t){return t.source===he.Source.ScreenShare||t.constraints.height&&rf(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const aEe=5e3;class cv extends D7{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0;super(e,he.Kind.Video,n,r,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>J(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const o=new Map(s.map(c=>[c.rid,c])),a=s.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(Te.CpuConstrained)),this.prevStats){let c=0;o.forEach((l,d)=>{var h;const m=(h=this.prevStats)===null||h===void 0?void 0:h.get(d);c+=mT(l,m)}),this._currentBitrate=c}this.prevStats=o}),this.senderLock=new ms}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!qs())return;const r=(n=this.sender)===null||n===void 0?void 0:n.getParameters();r&&(this.encodings=r.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},O7))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return J(this,void 0,void 0,function*(){var n,r,i,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=au(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(d){r={error:d}}finally{try{!a&&!n&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return J(this,void 0,void 0,function*(){var n,r,i,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=au(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const d=s;yield(o=d.sender)===null||o===void 0?void 0:o.replaceTrack(d.mediaStreamTrack)}}catch(d){r={error:d}}finally{try{!a&&!n&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return J(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===he.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return J(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===he.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return J(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],r=yield this.sender.getStats();return r.forEach(i=>{var s;if(i.type==="outbound-rtp"){const o={type:"video",streamId:i.id,frameHeight:i.frameHeight,frameWidth:i.frameWidth,framesPerSecond:i.framesPerSecond,framesSent:i.framesSent,firCount:i.firCount,pliCount:i.pliCount,nackCount:i.nackCount,packetsSent:i.packetsSent,bytesSent:i.bytesSent,qualityLimitationReason:i.qualityLimitationReason,qualityLimitationDurations:i.qualityLimitationDurations,qualityLimitationResolutionChanges:i.qualityLimitationResolutionChanges,rid:(s=i.rid)!==null&&s!==void 0?s:i.id,retransmittedPacketsSent:i.retransmittedPacketsSent,targetBitrate:i.targetBitrate,timestamp:i.timestamp},a=r.get(i.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((i,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=i.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let r=wo.LOW;r<=wo.HIGH;r+=1)n.push(new S7({quality:r,enabled:r<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Gc(this.codec),n)}restartTrack(e){return J(this,void 0,void 0,function*(){var n,r,i,s,o;let a;if(e){const h=R7({video:e});typeof h.video!="boolean"&&(a=h.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,l=au(this.simulcastCodecs.values()),d;d=yield l.next(),n=d.done,!n;c=!0){s=d.value,c=!1;const h=s;h.sender&&((o=h.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(h.mediaStreamTrack=this.mediaStreamTrack.clone(),yield h.sender.replaceTrack(h.mediaStreamTrack))}}catch(h){r={error:h}}finally{try{!c&&!n&&(i=l.return)&&(yield i.call(l))}finally{if(r)throw r.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return J(this,arguments,void 0,function(r){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,l,d,h;if(yield n.setProcessor.call(i,r,s),!((d=i.processor)===null||d===void 0)&&d.processedTrack)try{for(var m=!0,g=au(i.simulcastCodecs.values()),y;y=yield g.next(),o=y.done,!o;m=!0)l=y.value,m=!1,yield(h=l.sender)===null||h===void 0?void 0:h.replaceTrack(i.processor.processedTrack)}catch(v){a={error:v}}finally{try{!m&&!o&&(c=g.return)&&(yield c.call(g))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return J(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const r={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,r),r}setSimulcastTrackSender(e,n){const r=this.simulcastCodecs.get(e);r&&(r.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},aEe))}setPublishingCodecs(e){return J(this,void 0,void 0,function*(){var n,r,i,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Gc(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,r=au(e);i=yield r.next(),s=i.done,!s;n=!0){c=i.value,n=!1;const d=c;if(!this.codec||this.codec===d.codec)yield this.setPublishingLayers(Gc(d.codec),d.qualities);else{const h=this.simulcastCodecs.get(d.codec);if(this.log.debug("try setPublishingCodec for ".concat(d.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:h})),!h||!h.sender){for(const m of d.qualities)if(m.enabled){l.push(d.codec);break}}else h.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(d.codec),this.logContext),yield AH(h.sender,h.encodings,d.qualities,this.senderLock,Gc(d.codec),this.log,this.logContext))}}}catch(d){o={error:d}}finally{try{!n&&!s&&(a=r.return)&&(yield a.call(r))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e,n){return J(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield AH(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return J(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((r,i)=>{var s;return Object.assign(Object.assign({},r),{active:i===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:i===0&&Gc(this.codec)?"L1T3":void 0,maxFramerate:i===0?15:0,maxBitrate:i===0?r.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return J(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),hee()&&this.isInBackground&&this.source===he.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function AH(t,e,n,r,i,s,o){return J(this,void 0,void 0,function*(){const a=yield r.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:l,senderEncodings:e}));return}let d=!1;!1&&l[0].scalabilityMode||(i&&n.some(g=>g.enabled)&&n.forEach(g=>g.enabled=!0),l.forEach((m,g)=>{var y;let v=(y=m.rid)!==null&&y!==void 0?y:"";v===""&&(v="q");const w=Tee(v),S=n.find(R=>R.quality===w);S&&m.active!==S.enabled&&(d=!0,m.active=S.enabled,s.debug("setting layer ".concat(S.quality," to ").concat(m.active?"enabled":"disabled"),o),np()&&(S.enabled?(m.scaleResolutionDownBy=e[g].scaleResolutionDownBy,m.maxBitrate=e[g].maxBitrate,m.maxFrameRate=e[g].maxFrameRate):(m.scaleResolutionDownBy=4,m.maxBitrate=10,m.maxFrameRate=2)))})),d&&(c.encodings=l,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function Tee(t){switch(t){case"f":return wo.HIGH;case"h":return wo.MEDIUM;case"q":return wo.LOW;default:return wo.HIGH}}function PH(t,e,n,r){if(!n)return[new tf({quality:wo.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(r){const i=n[0].scalabilityMode,s=new Cee(i),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new tf({quality:Math.min(wo.HIGH,s.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(i=>{var s,o,a;const c=(s=i.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=Tee((o=i.rid)!==null&&o!==void 0?o:"");return new tf({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=i.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const LH="_lossy",OH="_reliable",cEe=2*1e3,u6="leave-reconnect",lEe=3e4;var Jo;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Jo||(Jo={}));class uEe extends dl.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=P7.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Jo.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Tt,this.reliableDataSequence=1,this.reliableMessageBuffer=new bH,this.reliableReceivedState=new M2e(lEe),this.midToTrackId={},this.handleDataChannel=r=>J(this,[r],void 0,function(i){var s=this;let{channel:o}=i;return function*(){if(o){if(o.label===OH)s.reliableDCSub=o;else if(o.label===LH)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=r=>J(this,void 0,void 0,function*(){var i,s,o,a,c;const l=yield this.dataProcessLock.lock();try{let d;if(r.data instanceof ArrayBuffer)d=r.data;else if(r.data instanceof Blob)d=yield r.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:r.data}));return}const h=ds.fromBinary(new Uint8Array(d));if(h.sequence>0&&h.participantSid!==""){const m=this.reliableReceivedState.get(h.participantSid);if(m&&h.sequence<=m)return;this.reliableReceivedState.set(h.participantSid,h.sequence)}if(((i=h.value)===null||i===void 0?void 0:i.case)==="speaker")this.emit(Pe.ActiveSpeakersUpdate,h.value.value.speakers);else if(((s=h.value)===null||s===void 0?void 0:s.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const m=yield(o=this.e2eeManager)===null||o===void 0?void 0:o.handleEncryptedData(h.value.value.encryptedValue,h.value.value.iv,h.participantIdentity,h.value.value.keyIndex),g=aZ.fromBinary(m.payload),y=new ds({value:g.value,participantIdentity:h.participantIdentity,participantSid:h.participantSid});((a=y.value)===null||a===void 0?void 0:a.case)==="user"&&MH(y,y.value.value),this.emit(Pe.DataPacketReceived,y,h.value.value.encryptionType)}else((c=h.value)===null||c===void 0?void 0:c.case)==="user"&&MH(h,h.value.value),this.emit(Pe.DataPacketReceived,h,si.NONE)}finally{l()}}),this.handleDataError=r=>{const s=r.currentTarget.maxRetransmits===0?"lossy":"reliable";if(r instanceof ErrorEvent&&r.error){const{error:o}=r.error;this.log.error("DataChannel error on ".concat(s,": ").concat(r.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:r}))},this.handleBufferedAmountLow=r=>{const s=r.currentTarget.maxRetransmits===0?It.LOSSY:It.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(r,i)=>{if(this._isClosed)return;this.log.warn("".concat(r," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(Pe.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}r===u6&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Bi.setTimeout(()=>this.attemptReconnect(i).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((r,i)=>{this.pcState===Jo.Connected&&r();const s=()=>{this.off(Pe.Disconnected,o),r()},o=()=>{this.off(Pe.Restarted,s),i()};this.once(Pe.Restarted,s),this.once(Pe.Disconnected,o)}),this.updateAndEmitDCBufferStatus=r=>{const i=this.isBufferStatusLow(r);typeof i<"u"&&i!==this.dcBufferStatus.get(r)&&(this.dcBufferStatus.set(r,i),this.emit(Pe.DCBufferStatusChanged,i,r))},this.isBufferStatusLow=r=>{const i=this.dataChannelForKind(r);if(i)return r===It.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(i.bufferedAmount),i.bufferedAmount<=i.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===or.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(xh.RR_SIGNAL_DISCONNECTED))},this.log=ku((n=e.loggerName)!==null&&n!==void 0?n:sc.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new I7(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new ms,this.dataProcessLock=new ms,this.dcBufferStatus=new Map([[It.LOSSY,!0],[It.RELIABLE,!0]]),this.client.onParticipantUpdate=r=>this.emit(Pe.ParticipantUpdate,r),this.client.onConnectionQuality=r=>this.emit(Pe.ConnectionQualityUpdate,r),this.client.onRoomUpdate=r=>this.emit(Pe.RoomUpdate,r),this.client.onSubscriptionError=r=>this.emit(Pe.SubscriptionError,r),this.client.onSubscriptionPermissionUpdate=r=>this.emit(Pe.SubscriptionPermissionUpdate,r),this.client.onSpeakersChanged=r=>this.emit(Pe.SpeakersChanged,r),this.client.onStreamStateUpdate=r=>this.emit(Pe.StreamStateChanged,r),this.client.onRequestResponse=r=>this.emit(Pe.SignalRequestResponse,r)}get logContext(){var e,n,r,i,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(i=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.room)===null||i===void 0?void 0:i.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,r,i){return J(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=r,this.maxJoinAttempts=r.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,r,i);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate().catch(o=>{Tt.error(o,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=s.clientConfiguration,this.emit(Pe.SignalConnected,s),s}catch(s){if(s instanceof Qt&&s.reason===Nt.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,r,i);throw s}})}close(){return J(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(Pe.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return J(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=r=>{r&&(r.close(),r.onbufferedamountlow=null,r.onclose=null,r.onclosing=null,r.onerror=null,r.onmessage=null,r.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new bH,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return J(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new cu("a track with the same ID has already been published");return new Promise((n,r)=>{const i=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],r(new Qt("publication of local track timed out, no response from server",Nt.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(i),n(s)},reject:()=>{clearTimeout(i),r(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return J(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return J(this,void 0,void 0,function*(){var n,r;if(this.pcManager&&this.pcManager.currentState!==yr.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const i=this.makeRTCConfiguration(e);this.pcManager=new V2e(i,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(Pe.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>J(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===yr.CONNECTED){const d=this.pcState===Jo.New;this.pcState=Jo.Connected,d&&this.emit(Pe.Connected,e)}else s===yr.FAILED&&(this.pcState===Jo.Connected||this.pcState===Jo.Reconnecting)&&(this.pcState=Jo.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?xh.RR_SUBSCRIBER_FAILED:xh.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===or.RECONNECTING,l=[yr.FAILED,yr.CLOSING,yr.CLOSED].includes(s);c&&l&&!this._isClosed&&this.emit(Pe.Offline)}),this.pcManager.onTrack=s=>{s.streams.length!==0&&this.emit(Pe.MediaTrackAdded,s.track,s.streams[0],s.receiver)},dEe((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,r)=>J(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:r})),this.midToTrackId=r,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,r)=>J(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=r;const i=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);i&&this.client.sendAnswer(i,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:r}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],r(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(Pe.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(Pe.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(Pe.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(Pe.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(Pe.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,r;const i={direction:"recvonly"};for(let s=0;s<e.numAudios;s++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",i);for(let s=0;s<e.numVideos;s++)(r=this.pcManager)===null||r===void 0||r.addPublisherTransceiverOfKind("video",i);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",xh.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e?.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Ag.DISCONNECT:this.emit(Pe.Disconnected,e?.reason),this.close();break;case Ag.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(u6);break;case Ag.RESUME:this.handleDisconnect(u6)}}}makeRTCConfiguration(e){var n;const r=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),r.encodedInsertableStreams=!0),e.iceServers&&!r.iceServers){const i=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),i.push(o)}),r.iceServers=i}return e.clientConfiguration&&e.clientConfiguration.forceRelay===yb.ENABLED&&(r.iceTransportPolicy="relay"),r.sdpSemantics="unified-plan",r.continualGatheringPolicy="gather_continually",r}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(LH,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(OH,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,r){return J(this,void 0,void 0,function*(){if(VA())return yield this.createTransceiverRTCRtpSender(e,n,r);if(qA())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Jr("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,r,i){return J(this,void 0,void 0,function*(){if(VA())return this.createSimulcastTransceiverSender(e,n,r,i);if(qA())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Jr("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,r){return J(this,void 0,void 0,function*(){if(!this.pcManager)throw new Jr("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),Of(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:i};return r&&(s.sendEncodings=r),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,r,i){return J(this,void 0,void 0,function*(){if(!this.pcManager)throw new Jr("publisher is closed");const s={direction:"sendonly"};i&&(s.sendEncodings=i);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(r.videoCodec)return e.setSimulcastTrackSender(r.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return J(this,void 0,void 0,function*(){if(!this.pcManager)throw new Jr("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return J(this,void 0,void 0,function*(){var n,r,i;if(!this._isClosed){if(this.attemptingReconnect){Tt.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===yb.DISABLED||((i=(r=this.pcManager)===null||r===void 0?void 0:r.currentState)!==null&&i!==void 0?i:yr.NEW)===yr.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof Jr?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof Nm||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",xh.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(Pe.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return J(this,void 0,void 0,function*(){var n,r,i;try{if(!this.url||!this.token)throw new Jr("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(Pe.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Nm;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof Qt&&o.reason===Nt.NotAllowed?new Jr("could not reconnect, token might be expired"):new Nm}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(Pe.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==or.CONNECTED)throw new Nm("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(Pe.Restarted)}catch(s){const o=yield(r=this.regionUrlProvider)===null||r===void 0?void 0:r.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),s}})}resumeConnection(e){return J(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Jr("could not reconnect, url or token not saved");if(!this.pcManager)throw new Jr("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(Pe.Resuming);let r;try{this.setupSignalClientCallbacks(),r=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(i){let s="";throw i instanceof Error&&(s=i.message,this.log.error(i.message,Object.assign(Object.assign({},this.logContext),{error:i}))),i instanceof Qt&&i.reason===Nt.NotAllowed?new Jr("could not reconnect, token might be expired"):i instanceof Qt&&i.reason===Nt.LeaveRequest?i:new Nm(s)}if(this.emit(Pe.SignalResumed),r){const i=this.makeRTCConfiguration(r);this.pcManager.updateConfiguration(i),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=r.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==or.CONNECTED)throw new Nm("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),r?.lastMessageSeq&&this.resendReliableMessagesForResume(r.lastMessageSeq),this.emit(Pe.Resumed)})}waitForPCInitialConnection(e,n){return J(this,void 0,void 0,function*(){if(!this.pcManager)throw new Jr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return J(this,void 0,void 0,function*(){this.pcState=Jo.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield gs(cEe),!this.pcManager)throw new Jr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Jo.Connected}catch(e){throw this.pcState=Jo.Disconnected,new Qt("could not establish PC connection, ".concat(e.message),Nt.InternalError)}})}publishRpcResponse(e,n,r,i){return J(this,void 0,void 0,function*(){const s=new ds({destinationIdentities:[e],kind:It.RELIABLE,value:{case:"rpcResponse",value:new v7({requestId:n,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:r??""}})}});yield this.sendDataPacket(s,It.RELIABLE)})}publishRpcAck(e,n){return J(this,void 0,void 0,function*(){const r=new ds({destinationIdentities:[e],kind:It.RELIABLE,value:{case:"rpcAck",value:new g7({requestId:n})}});yield this.sendDataPacket(r,It.RELIABLE)})}sendDataPacket(e,n){return J(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const s=USe(e);if(s){const o=yield this.e2eeManager.encryptData(s.toBinary());e.value={case:"encryptedPacket",value:new oZ({encryptedValue:o.payload,iv:o.iv,keyIndex:o.keyIndex})}}}n===It.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const r=e.toBinary(),i=this.dataChannelForKind(n);if(i){if(n===It.RELIABLE&&this.reliableMessageBuffer.push({data:r,sequence:e.sequence}),this.attemptingReconnect)return;i.send(r)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return J(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(It.RELIABLE);const n=this.dataChannelForKind(It.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(r=>{n.send(r.data)})),this.updateAndEmitDCBufferStatus(It.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,r)=>J(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const i=()=>r("Engine closed");for(this.once(Pe.Closing,i);!this.dcBufferStatus.get(e);)yield gs(10);this.off(Pe.Closing,i),n()}}))}ensureDataTransportConnected(e){return J(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!r.pcManager)throw new Jr("PC manager is closed");const o=i?r.pcManager.subscriber:r.pcManager.publisher,a=i?"Subscriber":"Publisher";if(!o)throw new Qt("".concat(a," connection not set"),Nt.InternalError);let c=!1;!i&&!r.dataChannelForKind(n,i)&&(r.createDataChannels(),c=!0),!c&&!i&&!r.pcManager.publisher.isICEConnected&&r.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&r.negotiate().catch(h=>{Tt.error(h,r.logContext)});const l=r.dataChannelForKind(n,i);if(l?.readyState==="open")return;const d=new Date().getTime()+r.peerConnectionTimeout;for(;new Date().getTime()<d;){if(o.isICEConnected&&((s=r.dataChannelForKind(n,i))===null||s===void 0?void 0:s.readyState)==="open")return;yield gs(50)}throw new Qt("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),Nt.InternalError)}()})}ensurePublisherConnected(e){return J(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==yr.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return J(this,void 0,void 0,function*(){return new Promise((e,n)=>J(this,void 0,void 0,function*(){if(!this.pcManager){n(new BA("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const r=new AbortController,i=()=>{r.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(Pe.Closing,i),this.pcManager.publisher.once(Og.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();c2e(c)&&o.set(a.payload,c)}),this.emit(Pe.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(r),e()}catch(s){s instanceof BA&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",xh.RR_UNKNOWN),n(s)}finally{this.off(Pe.Closing,i)}}))})}dataChannelForKind(e,n){if(n){if(e===It.LOSSY)return this.lossyDCSub;if(e===It.RELIABLE)return this.reliableDCSub}else{if(e===It.LOSSY)return this.lossyDC;if(e===It.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var r,i,s,o;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const a=this.pcManager.publisher.getLocalDescription(),c=this.pcManager.publisher.getRemoteDescription(),l=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getRemoteDescription(),d=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getLocalDescription(),h=(o=(s=this.signalOpts)===null||s===void 0?void 0:s.autoSubscribe)!==null&&o!==void 0?o:!0,m=new Array,g=new Array;e.forEach(y=>{y.isDesired!==h&&m.push(y.trackSid),y.isEnabled||g.push(y.trackSid)}),this.client.sendSyncState(new E7({answer:this.options.singlePeerConnection?c?ug({sdp:c.sdp,type:c.type}):void 0:d?ug({sdp:d.sdp,type:d.type}):void 0,offer:this.options.singlePeerConnection?a?ug({sdp:a.sdp,type:a.type}):void 0:l?ug({sdp:l.sdp,type:l.type}):void 0,subscription:new fT({trackSids:m,subscribe:!h,participantTracks:[]}),publishTracks:v2e(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:g,datachannelReceiveStates:this.reliableReceivedState.map((y,v)=>new RZ({publisherSid:v,lastSeq:y}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(r,i)=>{r?.id!==void 0&&r.id!==null&&e.push(new IZ({label:r.label,id:r.id,target:i}))};return n(this.dataChannelForKind(It.LOSSY),Ja.PUBLISHER),n(this.dataChannelForKind(It.RELIABLE),Ja.PUBLISHER),n(this.dataChannelForKind(It.LOSSY,!0),Ja.SUBSCRIBER),n(this.dataChannelForKind(It.RELIABLE,!0),Ja.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Bi.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){qs()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){qs()&&window.removeEventListener("online",this.handleBrowserOnLine)}getTrackIdForReceiver(e){var n;const r=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(r){const i=Object.entries(this.midToTrackId).find(s=>{let[o]=s;return o===r});if(i)return i[1]}}}class Nm extends Error{}function dEe(t){return t!==void 0&&t>13}function MH(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const r=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=r,e.destinationIdentities=r}class eP{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return KA(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return J(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(r=>!this.attemptedRegions.find(i=>i.url===r.url));if(n.length>0){const r=n[0];return this.attemptedRegions.push(r),Tt.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return J(this,void 0,void 0,function*(){const n=yield fetch("".concat(fEe(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const r=yield n.json();return this.lastUpdateAt=Date.now(),r}else throw new Qt("Could not fetch region settings: ".concat(n.statusText),n.status===401?Nt.NotAllowed:Nt.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function fEe(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class Ree{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new Qo("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),as.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Qo("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),as.LengthExceeded)}}constructor(e,n,r,i){this.reader=n,this.totalByteSize=r,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=i}}class hEe extends Ree{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new ca,r=null,i=null;if(this.signal){const o=this.signal;i=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,o.reason)},o.addEventListener("abort",i),r=o}const s=()=>{e.releaseLock(),r&&i&&r.removeEventListener("abort",i),this.signal=void 0};return{next:()=>J(this,void 0,void 0,function*(){var o,a;try{const{done:c,value:l}=yield Promise.race([e.read(),n.promise,(a=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(l),{done:!1,value:l.content})}catch(c){throw s(),c}}),return(){return J(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return J(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var r,i,s,o;let a=new Set;const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,d=au(c),h;h=yield d.next(),r=h.done,!r;l=!0){o=h.value,l=!1;const m=o;a.add(m)}}catch(m){i={error:m}}finally{try{!l&&!r&&(s=d.return)&&(yield s.call(d))}finally{if(i)throw i.error}}return Array.from(a)}()})}}class pEe extends Ree{constructor(e,n,r,i){super(e,n,r,i),this.receivedChunks=new Map}handleChunkReceived(e){var n;const r=hw(e.chunkIndex),i=this.receivedChunks.get(r);if(i&&i.version>e.version)return;this.receivedChunks.set(r,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let r=new ca,i=null,s=null;if(this.signal){const a=this.signal;s=()=>{var c;(c=r.reject)===null||c===void 0||c.call(r,a.reason)},a.addEventListener("abort",s),i=a}const o=()=>{e.releaseLock(),i&&s&&i.removeEventListener("abort",s),this.signal=void 0};return{next:()=>J(this,void 0,void 0,function*(){var a,c;try{const{done:l,value:d}=yield Promise.race([e.read(),r.promise,(c=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(l)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(d);let h;try{h=n.decode(d.content)}catch(m){throw new Qo("Cannot decode datastream chunk ".concat(d.chunkIndex," as text: ").concat(m),as.DecodeFailed)}return{done:!1,value:h}}}catch(l){throw o(),l}}),return(){return J(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return J(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var r,i,s,o;let a="";const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,d=au(c),h;h=yield d.next(),r=h.done,!r;l=!0)o=h.value,l=!1,a+=o}catch(m){i={error:m}}finally{try{!l&&!r&&(s=d.return)&&(yield s.call(d))}finally{if(i)throw i.error}}return a}()})}}class mEe{constructor(){this.log=Tt,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new Qo('A text stream handler for topic "'.concat(e,'" has already been set.'),as.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new Qo('A byte stream handler for topic "'.concat(e,'" has already been set.'),as.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearHandlersAndControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear(),this.byteStreamHandlers.clear(),this.textStreamHandlers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,r,i,s;const o=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e);if(o.length>0||a.length>0){const c=new Qo("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),as.AbnormalEnd);for(const[l,d]of a)(r=(n=d.outOfBandFailureRejectingFuture).reject)===null||r===void 0||r.call(n,c),this.byteStreamControllers.delete(l);for(const[l,d]of o)(s=(i=d.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(i,c),this.textStreamControllers.delete(l)}}handleDataStreamPacket(e,n){return J(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,r){return J(this,void 0,void 0,function*(){var i;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let o;const a=new ca;a.promise.catch(d=>{this.log.error(d)});const c={id:e.streamId,name:(i=e.contentHeader.value.name)!==null&&i!==void 0?i:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:hw(e.timestamp),attributes:e.attributes,encryptionType:r},l=new ReadableStream({start:d=>{if(o=d,this.textStreamControllers.has(e.streamId))throw new Qo("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),as.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new hEe(c,l,hw(e.totalLength),a),{identity:n})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let o;const a=new ca;a.promise.catch(d=>{this.log.error(d)});const c={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:r},l=new ReadableStream({start:d=>{if(o=d,this.textStreamControllers.has(e.streamId))throw new Qo("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),as.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new pEe(c,l,hw(e.totalLength),a),{identity:n})}})}handleStreamChunk(e,n){const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new Qo("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),as.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e));const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new Qo("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),as.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e))}handleStreamTrailer(e,n){const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new Qo("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),as.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close(),this.textStreamControllers.delete(e.streamId)));const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new Qo("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),as.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class Iee{constructor(e,n,r){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=r,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return J(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class gEe extends Iee{}class vEe extends Iee{}const DH=15e3;class yEe{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return J(this,void 0,void 0,function*(){var r;const i=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(r=n?.attachments)===null||r===void 0?void 0:r.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(h,m)=>{var g;c[m]=h;const y=c.reduce((v,w)=>v+w,0);(g=n?.onProgress)===null||g===void 0||g.call(n,y)},d=yield this.streamText({streamId:i,totalSize:o,destinationIdentities:n?.destinationIdentities,topic:n?.topic,attachedStreamIds:a,attributes:n?.attributes});return yield d.write(e),l(1,0),yield d.close(),n?.attachments&&a&&(yield Promise.all(n.attachments.map((h,m)=>J(this,void 0,void 0,function*(){return this._sendFile(a[m],h,{topic:n.topic,mimeType:h.type,onProgress:g=>{l(g,m+1)}})})))),d.info})}streamText(e){return J(this,void 0,void 0,function*(){var n,r,i;const s=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(r=e?.topic)!==null&&r!==void 0?r:"",size:e?.totalSize,attributes:e?.attributes,encryptionType:!((i=this.engine.e2eeManager)===null||i===void 0)&&i.isDataChannelEncryptionEnabled?si.GCM:si.NONE},a=new wC({streamId:s,mimeType:o.mimeType,topic:o.topic,timestamp:Ah(o.timestamp),totalLength:Ah(e?.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new yZ({version:e?.version,attachedStreamIds:e?.attachedStreamIds,replyToStreamId:e?.replyToStreamId,operationType:e?.type==="update"?PA.UPDATE:PA.CREATE})}}),c=e?.destinationIdentities,l=new ds({destinationIdentities:c,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(l,It.RELIABLE);let d=0;const h=this.engine,m=new WritableStream({write(v){return J(this,void 0,void 0,function*(){for(const w of p2e(v,DH)){yield h.waitForBufferStatusLow(It.RELIABLE);const S=new CC({content:w,streamId:s,chunkIndex:Ah(d)}),R=new ds({destinationIdentities:c,value:{case:"streamChunk",value:S}});yield h.sendDataPacket(R,It.RELIABLE),d+=1}})},close(){return J(this,void 0,void 0,function*(){const v=new TC({streamId:s}),w=new ds({destinationIdentities:c,value:{case:"streamTrailer",value:v}});yield h.sendDataPacket(w,It.RELIABLE)})},abort(v){console.log("Sink error:",v)}});let g=()=>J(this,void 0,void 0,function*(){yield y.close()});h.once(Pe.Closing,g);const y=new gEe(m,o,()=>this.engine.off(Pe.Closing,g));return y})}sendFile(e,n){return J(this,void 0,void 0,function*(){const r=crypto.randomUUID();return yield this._sendFile(r,e,n),{id:r}})}_sendFile(e,n,r){return J(this,void 0,void 0,function*(){var i;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(i=r?.mimeType)!==null&&i!==void 0?i:n.type,topic:r?.topic,destinationIdentities:r?.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield s.write(c)}return yield s.close(),s.info})}streamBytes(e){return J(this,void 0,void 0,function*(){var n,r,i,s,o,a;const c=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),l=e?.destinationIdentities,d={id:c,mimeType:(r=e?.mimeType)!==null&&r!==void 0?r:"application/octet-stream",topic:(i=e?.topic)!==null&&i!==void 0?i:"",timestamp:Date.now(),attributes:e?.attributes,size:e?.totalSize,name:(s=e?.name)!==null&&s!==void 0?s:"unknown",encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?si.GCM:si.NONE},h=new wC({totalLength:Ah((a=d.size)!==null&&a!==void 0?a:0),mimeType:d.mimeType,streamId:c,topic:d.topic,timestamp:Ah(Date.now()),attributes:d.attributes,contentHeader:{case:"byteHeader",value:new bZ({name:d.name})}}),m=new ds({destinationIdentities:l,value:{case:"streamHeader",value:h}});yield this.engine.sendDataPacket(m,It.RELIABLE);let g=0;const y=new ms,v=this.engine,w=this.log,S=new WritableStream({write(x){return J(this,void 0,void 0,function*(){const T=yield y.lock();let I=0;try{for(;I<x.byteLength;){const k=x.slice(I,I+DH);yield v.waitForBufferStatusLow(It.RELIABLE);const A=new ds({destinationIdentities:l,value:{case:"streamChunk",value:new CC({content:k,streamId:c,chunkIndex:Ah(g)})}});yield v.sendDataPacket(A,It.RELIABLE),g+=1,I+=k.byteLength}}finally{T()}})},close(){return J(this,void 0,void 0,function*(){const x=new TC({streamId:c}),T=new ds({destinationIdentities:l,value:{case:"streamTrailer",value:x}});yield v.sendDataPacket(T,It.RELIABLE)})},abort(x){w.error("Sink error:",x)}});return new vEe(S,d)})}}class N7 extends he{constructor(e,n,r,i,s){super(e,r,s),this.sid=n,this.receiver=i}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Te.Muted:Te.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=r=>{r.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Te.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return J(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),O7)),y2e()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const r=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(r){const{timestamp:i,rtpTimestamp:s}=r;s&&this.rtpTimestamp!==s&&(this.emit(Te.TimeSyncUpdate,{timestamp:i,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class kee extends N7{constructor(e,n,r,i,s,o){super(e,n,he.Kind.Audio,r,o),this.monitorReceiver=()=>J(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=mT(a,this.prevStats)),this.prevStats=a}),this.audioContext=i,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const r of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):r.volume=e;tl()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(tl())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return J(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(GA(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&GA(e)&&e.setSinkId(this.sinkId).catch(r=>{this.log.error("Failed to set sink id on remote audio track",r,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let r=this.sourceNode;this.webAudioPluginNodes.forEach(i=>{r.connect(i),r=i}),this.gainNode=e.createGain(),r.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(Te.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(i=>{this.emit(Te.AudioPlaybackFailed,i)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return J(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(r=>{r.type==="inbound-rtp"&&(n={type:"audio",streamId:r.id,timestamp:r.timestamp,jitter:r.jitter,bytesReceived:r.bytesReceived,concealedSamples:r.concealedSamples,concealmentEvents:r.concealmentEvents,silentConcealedSamples:r.silentConcealedSamples,silentConcealmentEvents:r.silentConcealmentEvents,totalAudioEnergy:r.totalAudioEnergy,totalSamplesDuration:r.totalSamplesDuration})}),n})}}const d6=100;class bEe extends N7{constructor(e,n,r,i,s){super(e,n,he.Kind.Video,r,s),this.elementInfos=[],this.monitorReceiver=()=>J(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=mT(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=x7(()=>{this.updateDimensions()},d6),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),console.log("setStreamState",e),e===he.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?Lg(this._mediaStreamTrack,n):lg(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new _Ee(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(r=>r===e);for(const r of n)r.stopObserving();this.elementInfos=this.elementInfos.filter(r=>r!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const r of n)this.stopObservingElement(r);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return J(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,r="",i=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(r=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&i.set(s.id,s)}),n&&r!==""&&i.get(r)&&(n.mimeType=i.get(r).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(r=>r.element===e);for(const r of n)this.stopObservingElementInfo(r)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return J(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,r;const i=this.elementInfos.reduce((c,l)=>Math.max(c,l.visibilityChangedAt||0),0),s=!((r=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&r!==void 0)||r?this.isInBackground:!1,o=this.elementInfos.some(c=>c.pictureInPicture),a=this.elementInfos.some(c=>c.visible)&&!s||o;if(!(this.lastVisible===a&&!e)){if(!a&&Date.now()-i<d6){Bi.setTimeout(()=>{this.updateVisibility()},d6);return}this.lastVisible=a,this.emit(Te.VisibilityChanged,a,this)}}updateDimensions(){var e,n;let r=0,i=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>r+i&&(r=a,i=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===r&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===i||(this.lastDimensions={width:r,height:i},this.emit(Te.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?dH():n||(dH()>2?2:1)}}class _Ee{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=r=>{var i;const{target:s,isIntersecting:o}=r;s===this.element&&(this.isIntersecting=o,this.isPiP=O1(this.element),this.visibilityChangedAt=Date.now(),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this))},this.onEnterPiP=()=>{var r,i,s;(i=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP),this.isPiP=O1(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var r;this.isPiP=O1(this.element),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.element=e,this.isIntersecting=n??tP(e),this.isPiP=qs()&&O1(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,r;this.isIntersecting=tP(this.element),this.isPiP=O1(this.element),this.element.handleResize=()=>{var i;(i=this.handleResize)===null||i===void 0||i.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,hH().observe(this.element),fH().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(r=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,r,i,s;(e=hH())===null||e===void 0||e.unobserve(this.element),(n=fH())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(r=window.documentPictureInPicture)===null||r===void 0||r.removeEventListener("enter",this.onEnterPiP),(s=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function O1(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?tP(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function tP(t,e){const n=e||window;let r=t.offsetTop,i=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,r+=t.offsetTop,i+=t.offsetLeft;return r<n.pageYOffset+n.innerHeight&&i<n.pageXOffset+n.innerWidth&&r+o>n.pageYOffset&&i+s>n.pageXOffset&&!a&&c!=="none"}class eu extends dl.EventEmitter{constructor(e,n,r,i){var s;super(),this.metadataMuted=!1,this.encryption=si.NONE,this.log=Tt,this.handleMuted=()=>{this.emit(Te.Muted)},this.handleUnmuted=()=>{this.emit(Te.Unmuted)},this.log=ku((s=i?.loggerName)!==null&&s!==void 0?s:sc.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=r,this.source=he.Source.Unknown}setTrack(e){this.track&&(this.track.off(Te.Muted,this.handleMuted),this.track.off(Te.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Te.Muted,this.handleMuted),e.on(Te.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Lt(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==si.NONE}get audioTrack(){if(Qc(this.track))return this.track}get videoTrack(){if(Of(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=he.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===he.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(eu||(eu={}));class nP extends eu{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,r,i){super(e,n.sid,n.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Te.Ended)},this.handleCpuConstrained=()=>{this.track&&Of(this.track)&&this.emit(Te.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(r)}setTrack(e){this.track&&(this.track.off(Te.Ended,this.handleTrackEnded),this.track.off(Te.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(Te.Ended,this.handleTrackEnded),e.on(Te.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return J(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return J(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return J(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return J(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Qc(this.track)){const n=this.track.getSourceTrackSettings(),r=new Set;return n.autoGainControl&&r.add(Ci.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&r.add(Ci.TF_ECHO_CANCELLATION),n.noiseSuppression&&r.add(Ci.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&r.add(Ci.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||r.add(Ci.TF_NO_DTX),this.track.enhancedNoiseCancellation&&r.add(Ci.TF_ENHANCED_NOISE_CANCELLATION),Array.from(r.values())}else return[]}}function v_(t,e){return J(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:r,videoProcessor:i,optionsWithoutProcessor:s}=bee(t);let o=s.audio,a=s.video;if(r&&typeof s.audio=="object"&&(s.audio.processor=r),i&&typeof s.video=="object"&&(s.video.processor=i),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const h=s.audio.deviceId;s.audio.deviceId={exact:h},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:h}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const h=s.video.deviceId;s.video.deviceId={exact:h},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:h}})}(s.audio===!0||typeof s.audio=="object"&&!s.audio.deviceId)&&(s.audio={deviceId:"default"}),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const c=gee(s,See,Eee),l=R7(c),d=navigator.mediaDevices.getUserMedia(l);s.audio&&(Ti.userMediaPromiseMap.set("audioinput",d),d.catch(()=>Ti.userMediaPromiseMap.delete("audioinput"))),s.video&&(Ti.userMediaPromiseMap.set("videoinput",d),d.catch(()=>Ti.userMediaPromiseMap.delete("videoinput")));try{const h=yield d;return yield Promise.all(h.getTracks().map(m=>J(this,void 0,void 0,function*(){const g=m.kind==="audio";let y=g?c.audio:c.video;(typeof y=="boolean"||!y)&&(y={});let v;const w=g?l.audio:l.video;typeof w!="boolean"&&(v=w);const S=m.getSettings().deviceId;v?.deviceId&&rf(v.deviceId)!==S?v.deviceId=S:v||(v={deviceId:S});const R=X2e(m,v,e);return R.kind===he.Kind.Video?R.source=he.Source.Camera:R.kind===he.Kind.Audio&&(R.source=he.Source.Microphone),R.mediaStream=h,Qc(R)&&r?yield R.setProcessor(r):Of(R)&&i&&(yield R.setProcessor(i)),R})))}catch(h){if(!n)throw h;return v_(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function SEe(t){return J(this,void 0,void 0,function*(){return(yield v_({audio:!1,video:!0}))[0]})}function EEe(t){return J(this,void 0,void 0,function*(){return(yield v_({audio:!0,video:!1}))[0]})}var $d;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})($d||($d={}));function wEe(t){switch(t){case fy.EXCELLENT:return $d.Excellent;case fy.GOOD:return $d.Good;case fy.POOR:return $d.Poor;case fy.LOST:return $d.Lost;default:return $d.Unknown}}class xee extends dl.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===bb.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===xg.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,r,i,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:bb.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=$d.Unknown,this.log=Tt,this.log=ku((c=o?.loggerName)!==null&&c!==void 0?c:sc.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=r,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new ca,this.once(ce.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(he.Source.Camera);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(he.Source.Microphone);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(he.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===xg.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==xg.ACTIVE&&this.emit(ce.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,r=this.metadata;this.metadata=e,n&&this.emit(ce.ParticipantMetadataChanged,r)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(ce.ParticipantNameChanged,e)}_setAttributes(e){const n=b2e(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(ce.AttributesChanged,n)}setPermissions(e){var n,r,i,s,o,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((r=this.permissions)===null||r===void 0?void 0:r.canSubscribe)||e.canPublishData!==((i=this.permissions)===null||i===void 0?void 0:i.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((d,h)=>{var m;return d!==((m=this.permissions)===null||m===void 0?void 0:m.canPublishSources[h])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(ce.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(ce.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=wEe(e),n!==this._connectionQuality&&this.emit(ce.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>Qc(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(Te.Muted,()=>{this.emit(ce.TrackMuted,e)}),e.on(Te.Unmuted,()=>{this.emit(ce.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case he.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case he.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function CEe(t){var e,n,r;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new CZ({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(r=t.allowAll)!==null&&r!==void 0?r:!1,trackSids:t.allowedTrackSids||[]})}class TEe extends xee{constructor(e,n,r,i,s,o){super(e,n,void 0,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=si.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new ca)},this.handleReconnected=()=>{var a,c;(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||c===void 0||c.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,c,l,d,h,m;this.reconnectFuture&&(this.reconnectFuture.promise.catch(g=>this.log.warn(g.message,this.logContext)),(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||c===void 0||c.call(a,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&((d=(l=this.signalConnectedFuture).reject)===null||d===void 0||d.call(l,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),(m=(h=this.activeAgentFuture)===null||h===void 0?void 0:h.reject)===null||m===void 0||m.call(h,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var c,l;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new ca),(l=(c=this.signalConnectedFuture).resolve)===null||l===void 0||l.call(c)},this.handleSignalRequestResponse=a=>{const{requestId:c,reason:l,message:d}=a,h=this.pendingSignalRequests.get(c);h&&(l!==w7.OK&&h.reject(new oH(d,l)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let c=a.value.value,l=null,d=null;c.value.case==="payload"?l=c.value.value:c.value.case==="error"&&(d=Sr.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,l,d);break;case"rpcAck":let h=a.value.value;this.handleIncomingRpcAck(h.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>CEe(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,c)=>{if(c===void 0&&(c=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Lt(a)));return}this.engine.updateMuteStatus(a.sid,c)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Lt(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Lt(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const c=this.audioTrackPublications.get(a.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(a,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Lt(c))),this.emit(ce.LocalTrackCpuConstrained,a,c)},this.handleSubscribedQualityUpdate=a=>J(this,void 0,void 0,function*(){var c,l,d,h,m;if(!(!((m=this.roomOptions)===null||m===void 0)&&m.dynacast))return;const g=this.videoTrackPublications.get(a.trackSid);if(!g){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!g.videoTrack)return;const y=yield g.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var v=!0,w=au(y),S;S=yield w.next(),c=S.done,!c;v=!0){h=S.value,v=!1;const R=h;XSe(R)&&(this.log.debug("publish ".concat(R," for ").concat(g.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Lt(g))),yield this.publishAdditionalCodecForTrack(g.videoTrack,R,g.options))}}catch(R){l={error:R}}finally{try{!v&&!c&&(d=w.return)&&(yield d.call(w))}finally{if(l)throw l.error}}}),this.handleLocalTrackUnpublished=a=>{const c=this.trackPublications.get(a.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=a=>J(this,void 0,void 0,function*(){if(a.source===he.Source.ScreenShare||a.source===he.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Lt(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(Hl(a)||wd(a))try{if(qs())try{const c=yield navigator?.permissions.query({name:a.source===he.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),Lt(a))),c.onchange=()=>{c.state!=="denied"&&(a.isMuted||a.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Lt(a))),Hl(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Lt(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=r,this.roomOptions=i,this.setupEngine(r),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==si.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(Pe.RemoteMute,(r,i)=>{const s=this.trackPublications.get(r);!s||!s.track||(i?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(Pe.Connected,this.handleReconnected).on(Pe.SignalConnected,this.handleSignalConnected).on(Pe.SignalRestarted,this.handleReconnected).on(Pe.SignalResumed,this.handleReconnected).on(Pe.Restarting,this.handleReconnecting).on(Pe.Resuming,this.handleReconnecting).on(Pe.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(Pe.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(Pe.Closing,this.handleClosing).on(Pe.SignalRequestResponse,this.handleSignalRequestResponse).on(Pe.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return J(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return J(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return J(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return J(this,arguments,void 0,function(n){var r=this;let{metadata:i,name:s,attributes:o}=n;return function*(){return new Promise((a,c)=>J(r,void 0,void 0,function*(){var l,d;try{let h=!1;const m=yield this.engine.client.sendUpdateLocalMetadata((l=i??this.metadata)!==null&&l!==void 0?l:"",(d=s??this.name)!==null&&d!==void 0?d:"",o),g=performance.now();for(this.pendingSignalRequests.set(m,{resolve:a,reject:y=>{c(y),h=!0},values:{name:s,metadata:i,attributes:o}});performance.now()-g<5e3&&!h;){if((!s||this.name===s)&&(!i||this.metadata===i)&&(!o||Object.entries(o).every(y=>{let[v,w]=y;return this.attributes[v]===w||w===""&&!this.attributes[v]}))){this.pendingSignalRequests.delete(m),a();return}yield gs(50)}c(new oH("Request to update local metadata timed out","TimeoutError"))}catch(h){h instanceof Error&&c(h)}}))}()})}setCameraEnabled(e,n,r){return this.setTrackEnabled(he.Source.Camera,e,n,r)}setMicrophoneEnabled(e,n,r){return this.setTrackEnabled(he.Source.Microphone,e,n,r)}setScreenShareEnabled(e,n,r){return this.setTrackEnabled(he.Source.ScreenShare,e,n,r)}setE2EEEnabled(e){return J(this,void 0,void 0,function*(){this.encryptionType=e?si.GCM:si.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,r,i){return J(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l?.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case he.Source.Camera:c=yield this.createTracks({video:(s=r)!==null&&s!==void 0?s:!0});break;case he.Source.Microphone:c=yield this.createTracks({audio:(o=r)!==null&&o!==void 0?o:!0});break;case he.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},r));break;default:throw new cu(e)}}catch(l){throw c?.forEach(d=>{d.stop()}),l instanceof Error&&this.emit(ce.MediaDevicesError,l,XA(e)),this.pendingPublishing.delete(e),l}for(const l of c){const d=Object.assign(Object.assign({},this.roomOptions.publishDefaults),r);e===he.Source.Microphone&&Qc(l)&&d.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),l.startPreConnectBuffer())}try{const l=[];for(const h of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Lt(h))),l.push(this.publishTrack(h,i));[a]=yield Promise.all(l)}catch(l){throw c?.forEach(d=>{d.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!a?.track&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===he.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(he.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return J(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(he.Source.Camera)||this.pendingPublishing.has(he.Source.Microphone))){this.pendingPublishing.add(he.Source.Camera),this.pendingPublishing.add(he.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(he.Source.Camera),this.pendingPublishing.delete(he.Source.Microphone)}}})}createTracks(e){return J(this,void 0,void 0,function*(){var n,r;e??(e={});const i=gee(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(r=this.roomOptions)===null||r===void 0?void 0:r.videoCaptureDefaults);try{return(yield v_(i,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(Qc(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=he.Source.Microphone,this.emit(ce.AudioStreamAcquired)),Of(a)&&(this.cameraError=void 0,a.source=he.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return J(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new T7("getDisplayMedia not supported");e.resolution===void 0&&!n2e()&&(e.resolution=pT.h1080fps30.resolution);const n=g2e(e),r=yield navigator.mediaDevices.getDisplayMedia(n),i=r.getVideoTracks();if(i.length===0)throw new cu("no video track found");const s=new cv(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=he.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(r.getAudioTracks().length>0){this.emit(ce.AudioStreamAcquired);const a=new kC(r.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=he.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return J(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return J(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,d;Hl(r)&&r.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),qh(r)&&s.pendingPublishPromises.has(r)&&(yield s.pendingPublishPromises.get(r));let h;if(r instanceof MediaStreamTrack)h=r.getConstraints();else{h=r.constraints;let S;switch(r.source){case he.Source.Microphone:S="audioinput";break;case he.Source.Camera:S="videoinput"}S&&s.activeDeviceMap.has(S)&&(h=Object.assign(Object.assign({},h),{deviceId:s.activeDeviceMap.get(S)}))}if(r instanceof MediaStreamTrack)switch(r.kind){case"audio":r=new kC(r,h,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":r=new cv(r,h,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new cu("unsupported MediaStreamTrack kind ".concat(r.kind))}else r.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let m;if(s.trackPublications.forEach(S=>{S.track&&S.track===r&&(m=S)}),m)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),Lt(m))),m;const g=Object.assign(Object.assign({},s.roomOptions.publishDefaults),i),y="channelCount"in r.mediaStreamTrack.getSettings()&&r.mediaStreamTrack.getSettings().channelCount===2||r.mediaStreamTrack.getConstraints().channelCount===2,v=(c=g.forceStereo)!==null&&c!==void 0?c:y;v&&(g.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),Lt(r))),g.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=g.dtx)!==null&&l!==void 0||(g.dtx=!1),(d=g.red)!==null&&d!==void 0||(g.red=!1)),!i2e()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),g.simulcast=!1),g.source&&(r.source=g.source);const w=new Promise((S,R)=>J(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==or.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Lt(r)}));const x=setTimeout(()=>{R(new sH("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(x);const T=yield this.publish(r,g,v);S(T)}else try{const x=yield this.publish(r,g,v);S(x)}catch(x){R(x)}}catch(x){R(x)}}));s.pendingPublishPromises.set(r,w);try{return yield w}catch(S){throw S}finally{s.pendingPublishPromises.delete(r)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new ca),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Lt(e))),!1;const{canPublish:n,canPublishSources:r}=this.permissions;return n&&(r.length===0||r.map(i=>_2e(i)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Lt(e))),!1)}publish(e,n,r){return J(this,void 0,void 0,function*(){var i,s,o,a,c,l,d,h,m,g;if(!this.hasPermissionsToPublish(e))throw new sH("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(D=>qh(e)&&D.source===e.source)&&e.source!==he.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Lt(e))),n.stopMicTrackOnMute&&Qc(e)&&(e.stopOnMute=!0),e.source===he.Source.ScreenShare&&np()&&(n.simulcast=!1),n.videoCodec==="av1"&&!ZSe()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!e2e()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=JA),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(D=>n.videoCodec===Ly(D.mime))||(n.videoCodec=Ly(this.enabledPublishVideoCodecs[0].mime)));const v=n.videoCodec;e.on(Te.Muted,this.onTrackMuted),e.on(Te.Unmuted,this.onTrackUnmuted),e.on(Te.Ended,this.handleTrackEnded),e.on(Te.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Te.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Te.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const w=[],S=!(!((i=n.dtx)!==null&&i!==void 0)||i),R=e.getSourceTrackSettings();R.autoGainControl&&w.push(Ci.TF_AUTO_GAIN_CONTROL),R.echoCancellation&&w.push(Ci.TF_ECHO_CANCELLATION),R.noiseSuppression&&w.push(Ci.TF_NOISE_SUPPRESSION),R.channelCount&&R.channelCount>1&&w.push(Ci.TF_STEREO),S&&w.push(Ci.TF_NO_DTX),Hl(e)&&e.hasPreConnectBuffer&&w.push(Ci.TF_PRECONNECT_BUFFER);const x=new _b({cid:e.mediaStreamTrack.id,name:n.name,type:he.kindToProto(e.kind),muted:e.isMuted,source:he.sourceToProto(e.source),disableDtx:S,encryption:this.encryptionType,stereo:r,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n?.stream,backupCodecPolicy:n?.backupCodecPolicy,audioFeatures:w});let T;if(e.kind===he.Kind.Video){let D={width:0,height:0};try{D=yield e.waitForDimensions()}catch{const U=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Yc.h720.resolution;D={width:U.width,height:U.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Lt(e)),{dims:D}))}x.width=D.width,x.height=D.height,wd(e)&&(Gc(v)&&(e.source===he.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Lt(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),x.simulcastCodecs=[new OA({codec:v,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:JA}),n.backupCodec&&v!==n.backupCodec.codec&&x.encryption===si.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),x.simulcastCodecs.push(new OA({codec:n.backupCodec.codec,cid:""})))),T=ZA(e.source===he.Source.ScreenShare,x.width,x.height,n),x.layers=PH(x.width,x.height,T,Gc(n.videoCodec))}else e.kind===he.Kind.Audio&&(T=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(h=(d=n.audioPreset)===null||d===void 0?void 0:d.priority)!==null&&h!==void 0?h:"high",networkPriority:(g=(m=n.audioPreset)===null||m===void 0?void 0:m.priority)!==null&&g!==void 0?g:"high"}]);if(!this.engine||this.engine.isClosed)throw new Jr("cannot publish track when not connected");const I=()=>J(this,void 0,void 0,function*(){var D,N,U;if(!this.engine.pcManager)throw new Jr("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,T),this.emit(ce.LocalSenderCreated,e.sender,e),wd(e)&&((D=n.degradationPreference)!==null&&D!==void 0||(n.degradationPreference=oEe(e)),e.setDegradationPreference(n.degradationPreference)),T)if(np()&&e.kind===he.Kind.Audio){let $;for(const K of this.engine.pcManager.publisher.getTransceivers())if(K.sender===e.sender){$=K;break}$&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:$,codec:"opus",maxbr:!((N=T[0])===null||N===void 0)&&N.maxBitrate?T[0].maxBitrate/1e3:0})}else e.codec&&Gc(e.codec)&&(!((U=T[0])===null||U===void 0)&&U.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:x.cid,codec:e.codec,maxbr:T[0].maxBitrate/1e3});yield this.engine.negotiate()});let k;const A=new Promise((D,N)=>J(this,void 0,void 0,function*(){var U;try{k=yield this.engine.addTrack(x),D(k)}catch($){e.sender&&(!((U=this.engine.pcManager)===null||U===void 0)&&U.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(K=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Lt(e)),{error:K}))})),N($)}}));if(this.enabledPublishVideoCodecs.length>0)k=(yield Promise.all([A,I()]))[0];else{k=yield A;let D;if(k.codecs.forEach(N=>{D===void 0&&(D=N.mimeType)}),D&&e.kind===he.Kind.Video){const N=Ly(D);N!==v&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Lt(e)),{codec:N})),n.videoCodec=N,T=ZA(e.source===he.Source.ScreenShare,x.width,x.height,n))}yield I()}const O=new nP(e.kind,k,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(O.on(Te.CpuConstrained,D=>this.onTrackCpuConstrained(D,O)),O.options=n,e.sid=k.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:T,trackInfo:k})),wd(e)?e.startMonitor(this.engine.client):Hl(e)&&e.startMonitor(),this.addTrackPublication(O),this.emit(ce.LocalTrackPublished,O),Hl(e)&&k.audioFeatures.includes(Ci.TF_PRECONNECT_BUFFER)){const D=e.getPreConnectBuffer(),N=e.getPreConnectBufferMimeType();this.on(ce.LocalTrackSubscribed,U=>{if(U.trackSid===k.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Lt(e))),e.stopPreConnectBuffer()}}),D&&new Promise(($,K)=>J(this,void 0,void 0,function*(){var Y,G,F,q,z,W;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Lt(e)));const fe=setTimeout(()=>{K(new Error("agent not active within 10 seconds"))},1e4),ye=yield this.waitUntilActiveAgentPresent();clearTimeout(fe),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Lt(e)));const Ae=yield this.streamBytes({name:"preconnect-buffer",mimeType:N,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[ye.identity],attributes:{trackId:O.trackSid,sampleRate:String((z=R.sampleRate)!==null&&z!==void 0?z:"48000"),channels:String((W=R.channelCount)!==null&&W!==void 0?W:"1")}});try{for(var V=!0,X=au(D),ne;ne=yield X.next(),Y=ne.done,!Y;V=!0){q=ne.value,V=!1;const be=q;yield Ae.write(be)}}catch(be){G={error:be}}finally{try{!V&&!Y&&(F=X.return)&&(yield F.call(X))}finally{if(G)throw G.error}}yield Ae.close(),$()}catch(fe){K(fe)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Lt(e)))}).catch($=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Lt(e)),{error:$}))})}return O})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,r){return J(this,void 0,void 0,function*(){var i;if(this.encryptionType!==si.NONE)return;let s;if(this.trackPublications.forEach(g=>{g.track&&g.track===e&&(s=g)}),!s)throw new cu("track is not published");if(!wd(e))throw new cu("track is not a video track");const o=Object.assign(Object.assign({},(i=this.roomOptions)===null||i===void 0?void 0:i.publishDefaults),r),a=rEe(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Lt(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new _b({cid:c.mediaStreamTrack.id,type:he.kindToProto(e.kind),muted:e.isMuted,source:he.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=PH(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new Jr("cannot publish track when not connected");const d=()=>J(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),m=(yield Promise.all([this.engine.addTrack(l),d()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:m}))})}unpublishTrack(e,n){return J(this,void 0,void 0,function*(){var r,i;if(qh(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Lt(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?Lt(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(Te.Muted,this.onTrackMuted),e.off(Te.Unmuted,this.onTrackUnmuted),e.off(Te.Ended,this.handleTrackEnded),e.off(Te.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Te.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Te.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(i=(r=this.roomOptions)===null||r===void 0?void 0:r.stopLocalTrackOnUnpublish)!==null&&i!==void 0?i:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<yr.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),wd(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case he.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case he.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(ce.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return J(this,void 0,void 0,function*(){return(yield Promise.all(e.map(r=>this.unpublishTrack(r)))).filter(r=>!!r)})}republishAllTracks(e){return J(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){r.republishPromise&&(yield r.republishPromise),r.republishPromise=new Promise((s,o)=>J(r,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>J(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),i&&!l.isMuted&&l.source!==he.Source.ScreenShare&&l.source!==he.Source.ScreenShareAudio&&(Hl(l)||wd(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield r.republishPromise}()})}publishData(e){return J(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=i.reliable?It.RELIABLE:It.LOSSY,o=i.destinationIdentities,a=i.topic;let c=new p7({participantIdentity:r.identity,payload:n,destinationIdentities:o,topic:a});const l=new ds({kind:s,value:{case:"user",value:c}});yield r.engine.sendDataPacket(l,s)}()})}publishDtmf(e,n){return J(this,void 0,void 0,function*(){const r=new ds({kind:It.RELIABLE,value:{case:"sipDtmf",value:new lZ({code:e,digit:n})}});yield this.engine.sendDataPacket(r,It.RELIABLE)})}sendChatMessage(e,n){return J(this,void 0,void 0,function*(){const r={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n?.attachments},i=new ds({value:{case:"chatMessage",value:new EC(Object.assign(Object.assign({},r),{timestamp:nr.parse(r.timestamp)}))}});return yield this.engine.sendDataPacket(i,It.RELIABLE),this.emit(ce.ChatMessage,r),r})}editChatMessage(e,n){return J(this,void 0,void 0,function*(){const r=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),i=new ds({value:{case:"chatMessage",value:new EC(Object.assign(Object.assign({},r),{timestamp:nr.parse(r.timestamp),editTimestamp:nr.parse(r.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,It.RELIABLE),this.emit(ce.ChatMessage,r),r})}sendText(e,n){return J(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return J(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return J(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return J(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return J(this,arguments,void 0,function(n){var r=this;let{destinationIdentity:i,method:s,payload:o,responseTimeout:a=15e3}=n;return function*(){return new Promise((d,h)=>J(r,void 0,void 0,function*(){var m,g,y,v;if(L7(o)>wee){h(Sr.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((g=(m=this.engine.latestJoinResponse)===null||m===void 0?void 0:m.serverInfo)===null||g===void 0)&&g.version&&nl((v=(y=this.engine.latestJoinResponse)===null||y===void 0?void 0:y.serverInfo)===null||v===void 0?void 0:v.version,"1.8.0")<0){h(Sr.builtIn("UNSUPPORTED_SERVER"));return}const w=Math.max(a,8e3),S=crypto.randomUUID();yield this.publishRpcRequest(i,S,s,o,w);const R=setTimeout(()=>{this.pendingAcks.delete(S),h(Sr.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(S),clearTimeout(x)},7e3);this.pendingAcks.set(S,{resolve:()=>{clearTimeout(R)},participantIdentity:i});const x=setTimeout(()=>{this.pendingResponses.delete(S),h(Sr.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(S,{resolve:(T,I)=>{clearTimeout(x),this.pendingAcks.has(S)&&(console.warn("RPC response received before ack",S),this.pendingAcks.delete(S),clearTimeout(R)),I?h(I):d(T??"")},participantIdentity:i})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,r){const i=this.pendingResponses.get(e);i?(i.resolve(n,r),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,r,i,s){return J(this,void 0,void 0,function*(){const o=new ds({destinationIdentities:[e],kind:It.RELIABLE,value:{case:"rpcRequest",value:new m7({id:n,method:r,payload:i,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,It.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:r}]of this.pendingAcks)r===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:r,resolve:i}]of this.pendingResponses)r===e&&(i(null,Sr.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var r,i;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((i=(r=s.track)===null||r===void 0?void 0:r.isUpstreamPaused)!==null&&i!==void 0?i:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Lt(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,r,i,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(r=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||r===void 0||r.call(n,e):(s=(i=this.activeAgentFuture)===null||i===void 0?void 0:i.reject)===null||s===void 0||s.call(i,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new ca),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(r=>{const i=r.track;i&&(e instanceof MediaStreamTrack?(Hl(i)||wd(i))&&i.mediaStreamTrack===e&&(n=r):e===i&&(n=r))}),n}waitForPendingPublicationOfSource(e){return J(this,void 0,void 0,function*(){const r=Date.now();for(;Date.now()<r+1e4;){const i=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(i)return i[1];yield gs(20)}})}}class xC extends eu{constructor(e,n,r,i){super(e,n.sid,n.name,i),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(Te.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=r,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new fT({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new dZ({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Te.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(r)}get subscriptionStatus(){return this.subscribed===!1?eu.SubscriptionStatus.Unsubscribed:super.isSubscribed?eu.SubscriptionStatus.Subscribed:eu.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?eu.PermissionStatus.Allowed:eu.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,r;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((r=this.requestedVideoDimensions)===null||r===void 0?void 0:r.height)===e.height||(i6(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&i6(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:wo.HIGH}setTrack(e){const n=this.subscriptionStatus,r=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(Te.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(Te.VisibilityChanged,this.handleVisibilityChange),i.off(Te.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(Te.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Te.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Te.VisibilityChanged,this.handleVisibilityChange),e.on(Te.Ended,this.handleEnded),this.emit(Te.Subscribed,e)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(Te.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?Te.Muted:Te.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(Te.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Te.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return i6(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new _Z({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===he.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)gH(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const r=S2e(this.trackInfo,this.requestedMaxQuality);r&&gH(this.videoDimensionsAdaptiveStream,r)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:wo.HIGH})),e.quality=wo.HIGH)}this.emit(Te.UpdateSettings,e)}}class AC extends xee{static fromParticipantInfo(e,n,r){return new AC(e,n.sid,n.identity,n.name,n.metadata,n.attributes,r,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,r,i,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:bb.STANDARD;super(n,r||"",i,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Te.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Lt(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(Te.UpdateSubscription,n=>{n.participantTracks.forEach(r=>{r.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(Te.SubscriptionPermissionChanged,n=>{this.emit(ce.TrackSubscriptionPermissionChanged,e,n)}),e.on(Te.SubscriptionStatusChanged,n=>{this.emit(ce.TrackSubscriptionStatusChanged,e,n)}),e.on(Te.Subscribed,n=>{this.emit(ce.TrackSubscribed,n,e)}),e.on(Te.Unsubscribed,n=>{this.emit(ce.TrackUnsubscribed,n,e)}),e.on(Te.SubscriptionFailed,n=>{this.emit(ce.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:he.Source.Microphone;this.volumeMap.set(n,e);const r=this.getTrackPublication(n);r&&r.track&&r.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:he.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,r,i,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(d=>{!a&&e.kind===d.kind.toString()&&(a=d)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(ce.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,r,i,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Lt(a))),this.emit(ce.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new bEe(e,n,i,s):l=new kee(e,n,i,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(r),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&WA(l)&&Qc(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,r=new Map;return e.tracks.forEach(i=>{var s,o;let a=this.getTrackPublicationBySid(i.sid);if(a)a.updateInfo(i);else{const c=he.kindFromProto(i.type);if(!c)return;a=new xC(c,i,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(i),r.set(i.sid,a);const l=Array.from(this.trackPublications.values()).find(d=>d.source===a?.source);l&&a.source!==he.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Lt(l),newTrack:Lt(a)})),this.addTrackPublication(a)}n.set(i.sid,a)}),this.trackPublications.forEach(i=>{n.has(i.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Lt(i))),this.unpublishTrack(i.trackSid,!0))}),r.forEach(i=>{this.emit(ce.TrackPublished,i)}),!0}unpublishTrack(e,n){const r=this.trackPublications.get(e);if(!r)return;const{track:i}=r;switch(i&&(i.stop(),r.setTrack(void 0)),this.trackPublications.delete(e),r.kind){case he.Kind.Audio:this.audioTrackPublications.delete(e);break;case he.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(ce.TrackUnpublished,r)}setAudioOutput(e){return J(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(r=>{var i;Qc(r.track)&&WA(r.track)&&n.push(r.track.setSinkId((i=e.deviceId)!==null&&i!==void 0?i:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:r})),super.emit(e,...r)}}var xt;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(xt||(xt={}));const REe=4*1e3;class xu extends dl.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,r,i,s;if(super(),n=this,this.state=xt.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Tt,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(o,a,c)=>J(this,void 0,void 0,function*(){var l;if(!t2e())throw tl()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const d=yield this.disconnectLock.lock();if(this.state===xt.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),d(),Promise.resolve();if(this.connectFuture)return d(),this.connectFuture.promise;this.setAndEmitConnectionState(xt.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),KA(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new eP(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(g=>{var y;(y=this.regionUrlProvider)===null||y===void 0||y.setServerReportedRegions(g)}).catch(g=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:g}))}));const h=(g,y,v)=>J(this,void 0,void 0,function*(){var w,S;this.abortController&&this.abortController.abort();const R=new AbortController;this.abortController=R,d?.();try{yield this.attemptConnection(v??o,a,c,R),this.abortController=void 0,g()}catch(x){if(this.regionUrlProvider&&x instanceof Qt&&x.reason!==Nt.Cancelled&&x.reason!==Nt.NotAllowed){let T=null;try{T=yield this.regionUrlProvider.getNextBestRegionUrl((w=this.abortController)===null||w===void 0?void 0:w.signal)}catch(I){if(I instanceof Qt&&(I.status===401||I.reason===Nt.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),y(I);return}}T&&!(!((S=this.abortController)===null||S===void 0)&&S.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(x.message,". Retrying with another region: ").concat(T),this.logContext),this.recreateEngine(),yield h(g,y,T)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,mH(x)),y(x))}else{let T=Za.UNKNOWN_REASON;x instanceof Qt&&(T=mH(x)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,T),y(x)}}}),m=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new ca((g,y)=>{h(g,y,m)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,c,l,d,h)=>J(this,void 0,void 0,function*(){var m,g,y;const v=yield c.join(o,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof d.adaptiveStream=="object"?!0:d.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout,singlePeerConnection:d.singlePeerConnection},h.signal);let w=v.serverInfo;if(w||(w={version:v.serverVersion,region:v.serverRegion}),this.serverInfo=w,this.log.debug("connected to Livekit Server ".concat(Object.entries(w).map(S=>{let[R,x]=S;return"".concat(R,": ").concat(x)}).join(", ")),{room:(m=v.room)===null||m===void 0?void 0:m.name,roomSid:(g=v.room)===null||g===void 0?void 0:g.sid,identity:(y=v.participant)===null||y===void 0?void 0:y.identity}),!w.version)throw new FSe("unknown server version");return w.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),d.dynacast=!1),v}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,c,l)=>J(this,void 0,void 0,function*(){var d,h;this.state===xt.Reconnecting||this.isResuming||!((d=this.engine)===null||d===void 0)&&d.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((h=this.regionUrlProvider)===null||h===void 0)&&h.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},P7),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const m=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(m),this.setupLocalParticipantEvents(),this.emit(ue.SignalConnected)}catch(m){yield this.engine.close(),this.recreateEngine();const g=new Qt("could not establish signal connection",Nt.ServerUnreachable);throw m instanceof Error&&(g.message="".concat(g.message,": ").concat(m.message)),m instanceof Qt&&(g.reason=m.reason,g.status=m.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:m})),g}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new Qt("Connection attempt aborted",Nt.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(m){throw yield this.engine.close(),this.recreateEngine(),m}qs()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),qs()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(xt.Connected),this.emit(ue.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return J(n,[...a],void 0,function(){var l=this;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var h,m,g,y;const v=yield l.disconnectLock.lock();try{if(l.state===xt.Disconnected){l.log.debug("already disconnected",l.logContext);return}if(l.log.info("disconnect from room",Object.assign({},l.logContext)),l.state===xt.Connecting||l.state===xt.Reconnecting||l.isResuming){const w="Abort connection attempt due to user initiated disconnect";l.log.warn(w,l.logContext),(h=l.abortController)===null||h===void 0||h.abort(w),(g=(m=l.connectFuture)===null||m===void 0?void 0:m.reject)===null||g===void 0||g.call(m,new Qt("Client initiated disconnect",Nt.Cancelled)),l.connectFuture=void 0}!((y=l.engine)===null||y===void 0)&&y.client.isDisconnected||(yield l.engine.client.sendLeave()),l.engine&&(yield l.engine.close()),l.handleDisconnect(d,Za.CLIENT_INITIATED),l.engine=void 0}finally{v()}}()})},this.onPageLeave=()=>J(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>J(this,void 0,void 0,function*(){const o=[],a=zs();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const d=r6();d.enabled=!0;const h=new MediaStream([d]);l.srcObject=h,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:h,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(ue.Disconnected,()=>{l?.remove(),l=null})}o.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(d=>{o.push(d)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>J(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(d=>{o.includes(d)||o.push(d)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(xt.Reconnecting)&&this.emit(ue.Reconnecting)},this.handleSignalRestarted=o=>J(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(xt.Connected),this.emit(ue.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===xg.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],c={};o.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const d=this.getRemoteParticipantBySid(l.sid);d&&(d.audioLevel=l.level,d.setIsSpeaking(!0),a.push(d))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(ue.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(l=>{const d=this.remoteParticipants.get(l.identity);d&&d.sid!==l.sid||a.set(l.sid,l)}),o.forEach(l=>{let d=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(d=this.localParticipant),d&&(d.audioLevel=l.level,d.setIsSpeaking(l.active),l.active?a.set(l.sid,d):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,d)=>d.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(ue.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const d=he.streamStateFromProto(a.state);l.track.setStreamState(d),d!==l.track.streamState&&(c.emit(ce.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(ue.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(o.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=(o,a)=>{const c=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(c,o.value.value,o.kind,a);else if(o.value.case==="transcription")this.handleTranscription(c,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(c,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(c,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,c);else if(o.value.case==="streamHeader"||o.value.case==="streamChunk"||o.value.case==="streamTrailer")this.handleDataStream(o,a);else if(o.value.case==="rpcRequest"){const l=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,l.id,l.method,l.payload,l.responseTimeoutMs,l.version)}},this.handleUserPacket=(o,a,c,l)=>{this.emit(ue.DataReceived,a.payload,o,c,a.topic,l),o?.emit(ce.DataReceived,a.payload,c,l)},this.handleSipDtmf=(o,a)=>{this.emit(ue.SipDTMFReceived,a,o),o?.emit(ce.SipDTMFReceived,a)},this.handleTranscription=(o,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c?.trackPublications.get(a.trackId),d=u2e(a,this.transcriptionReceivedTimes);l?.emit(Te.TranscriptionReceived,d),c?.emit(ce.TranscriptionReceived,d,l),this.emit(ue.TranscriptionReceived,d,c,l)},this.handleChatMessage=(o,a)=>{const c=d2e(a);this.emit(ue.ChatMessage,c,o)},this.handleMetrics=(o,a)=>{this.emit(ue.MetricsReceived,o,a)},this.handleDataStream=(o,a)=>{this.incomingDataStreamManager.handleDataStreamPacket(o,a)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(ue.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(ue.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(ue.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(ue.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>J(this,void 0,void 0,function*(){var o;((o=zs())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(ue.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(ue.RoomMetadataChanged,o.metadata),a?.activeRecording!==o.activeRecording&&this.emitWhenConnected(ue.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(ue.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(ue.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(ue.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(ue.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(ue.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o?.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>J(this,void 0,void 0,function*(){var a,c,l,d,h,m;(a=o.track)===null||a===void 0||a.on(Te.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(Te.Restarted,this.onLocalTrackRestarted),(h=(d=(l=o.track)===null||l===void 0?void 0:l.getProcessor())===null||d===void 0?void 0:d.onPublish)===null||h===void 0||h.call(d,this),this.emit(ue.LocalTrackPublished,o,this.localParticipant),Hl(o.track)&&(yield o.track.checkForSilence())&&this.emit(ue.LocalAudioSilenceDetected,o);const g=yield(m=o.track)===null||m===void 0?void 0:m.getDeviceId(!1),y=XA(o.source);y&&g&&g!==this.localParticipant.activeDeviceMap.get(y)&&(this.localParticipant.activeDeviceMap.set(y,g),this.emit(ue.ActiveDeviceChanged,y,g))}),this.onLocalTrackUnpublished=o=>{var a,c;(a=o.track)===null||a===void 0||a.off(Te.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(Te.Restarted,this.onLocalTrackRestarted),this.emit(ue.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>J(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),c=XA(o.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(ue.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(ue.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,a)=>{this.emit(ue.MediaDevicesError,o,a)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(ue.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(ue.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},H2e),e),this.log=ku((r=this.options.loggerName)!==null&&r!==void 0?r:sc.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},See),e?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Eee),e?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},B2e),e?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new mEe,this.outgoingDataStreamManager=new yEe(this.engine,this.log),this.disconnectLock=new ms,this.localParticipant=new TEe("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",rf(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",rf(this.options.audioCaptureDefaults.deviceId)),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&this.switchActiveDevice("audiooutput",rf(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),qs()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),xu.cleanupRegistry&&xu.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return J(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,r=this.options.encryption||this.options.e2ee;r&&("e2eeManager"in r?(this.e2eeManager=r.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new E2e(r,n),this.e2eeManager.on(Kd.ParticipantEncryptionStatusChanged,(i,s)=>{h2e(s)&&(this.isE2EEEnabled=i),this.emit(ue.ParticipantEncryptionStatusChanged,i,s)}),this.e2eeManager.on(Kd.EncryptionError,i=>this.emit(ue.EncryptionError,i)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return J(this,void 0,void 0,function*(){return this.state===xt.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const r=i=>{i.sid!==""&&(this.engine.off(Pe.RoomUpdate,r),e(i.sid))};this.engine.on(Pe.RoomUpdate,r),this.once(ue.Disconnected,()=>{this.engine.off(Pe.RoomUpdate,r),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new uEe(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(Pe.ParticipantUpdate,this.handleParticipantUpdates).on(Pe.RoomUpdate,this.handleRoomUpdate).on(Pe.SpeakersChanged,this.handleSpeakersChanged).on(Pe.StreamStateChanged,this.handleStreamStateUpdate).on(Pe.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(Pe.SubscriptionError,this.handleSubscriptionError).on(Pe.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(Pe.MediaTrackAdded,(e,n,r)=>{this.onTrackAdded(e,n,r)}).on(Pe.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(Pe.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(Pe.DataPacketReceived,this.handleDataPacket).on(Pe.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(xt.SignalReconnecting)&&this.emit(ue.SignalReconnecting)}).on(Pe.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(xt.Connected)&&this.emit(ue.Reconnected)}).on(Pe.SignalResumed,()=>{this.bufferedEvents=[],(this.state===xt.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(Pe.Restarting,this.handleRestarting).on(Pe.SignalRestarted,this.handleSignalRestarted).on(Pe.Offline,()=>{this.setAndEmitConnectionState(xt.Reconnecting)&&this.emit(ue.Reconnecting)}).on(Pe.DCBufferStatusChanged,(e,n)=>{this.emit(ue.DCBufferStatusChanged,e,n)}).on(Pe.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(r=>{let{trackSid:i}=r;return i===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ce.LocalTrackSubscribed,n),this.emitWhenConnected(ue.LocalTrackSubscribed,n,this.localParticipant)}).on(Pe.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,r)=>{this.handleParticipantDisconnected(r,n)}),this.emit(ue.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Ti.getInstance().getDevices(e,n)}prepareConnection(e,n){return J(this,void 0,void 0,function*(){if(this.state===xt.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(KA(new URL(e))&&n){this.regionUrlProvider=new eP(e,n);const r=yield this.regionUrlProvider.getNextBestRegionUrl();r&&this.state===xt.Disconnected&&(this.regionUrl=r,yield fetch(zA(r),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(r),this.logContext))}else yield fetch(zA(e),{method:"HEAD"})}catch(r){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:r}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return J(this,void 0,void 0,function*(){let r=()=>J(this,void 0,void 0,function*(){}),i;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":i=new Nc({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":i=new Nc({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":i=new Nc({scenario:{case:"serverLeave",value:!0}});break;case"migration":i=new Nc({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>J(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new Nc({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>J(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new Nc({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":i=new Nc({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),r=()=>J(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new hT({reason:Za.CLIENT_INITIATED,action:Ag.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");i=new Nc({scenario:{case:"subscriberBandwidth",value:Ah(n)}});break;case"leave-full-reconnect":i=new Nc({scenario:{case:"leaveRequestFullReconnect",value:!0}})}i&&(yield this.engine.client.sendSimulateScenario(i),yield r())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return J(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,c,l,d,h,m,g;let y=!0,v=!1;const w=o?{exact:i}:i;if(r==="audioinput"){v=s.localParticipant.audioTrackPublications.size===0;const S=(a=s.getActiveDevice(r))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=w;const R=Array.from(s.localParticipant.audioTrackPublications.values()).filter(T=>T.source===he.Source.Microphone);try{y=(yield Promise.all(R.map(T=>{var I;return(I=T.audioTrack)===null||I===void 0?void 0:I.setDeviceId(w)}))).every(T=>T===!0)}catch(T){throw s.options.audioCaptureDefaults.deviceId=S,T}const x=R.some(T=>{var I,k;return(k=(I=T.track)===null||I===void 0?void 0:I.isMuted)!==null&&k!==void 0?k:!1});y&&x&&(v=!0)}else if(r==="videoinput"){v=s.localParticipant.videoTrackPublications.size===0;const S=(c=s.getActiveDevice(r))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=w;const R=Array.from(s.localParticipant.videoTrackPublications.values()).filter(T=>T.source===he.Source.Camera);try{y=(yield Promise.all(R.map(T=>{var I;return(I=T.videoTrack)===null||I===void 0?void 0:I.setDeviceId(w)}))).every(T=>T===!0)}catch(T){throw s.options.videoCaptureDefaults.deviceId=S,T}const x=R.some(T=>{var I,k;return(k=(I=T.track)===null||I===void 0?void 0:I.isMuted)!==null&&k!==void 0?k:!1});y&&x&&(v=!0)}else if(r==="audiooutput"){if(v=!0,!GA()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(i=(l=yield Ti.getInstance().normalizeDeviceId("audiooutput",i))!==null&&l!==void 0?l:""),(d=(g=s.options).audioOutput)!==null&&d!==void 0||(g.audioOutput={});const S=(h=s.getActiveDevice(r))!==null&&h!==void 0?h:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=i;try{s.options.webAudioMix&&((m=s.audioContext)===null||m===void 0||m.setSinkId(i)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(R=>R.setAudioOutput({deviceId:i})))}catch(R){throw s.options.audioOutput.deviceId=S,R}}return v&&(s.localParticipant.activeDeviceMap.set(r,i),s.emit(ue.ActiveDeviceChanged,r,i)),y}()})}setupLocalParticipantEvents(){this.localParticipant.on(ce.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ce.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ce.AttributesChanged,this.onLocalAttributesChanged).on(ce.TrackMuted,this.onLocalTrackMuted).on(ce.TrackUnmuted,this.onLocalTrackUnmuted).on(ce.LocalTrackPublished,this.onLocalTrackPublished).on(ce.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ce.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ce.MediaDevicesError,this.onMediaDevicesError).on(ce.AudioStreamAcquired,this.startAudio).on(ce.ChatMessage,this.onLocalChatMessageSent).on(ce.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,r){if(this.state===xt.Connecting||this.state===xt.Reconnecting){const h=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(g=>g.id)}),this.onTrackAdded(e,n,r),m()},m=()=>{this.off(ue.Reconnected,h),this.off(ue.Connected,h),this.off(ue.Disconnected,m)};this.once(ue.Reconnected,h),this.once(ue.Connected,h),this.once(ue.Disconnected,m);return}if(this.state===xt.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const i=QSe(n.id),s=i[0];let o=i[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(h=>h.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}if(!a.startsWith("TR")){const h=this.engine.getTrackIdForReceiver(r);if(!h){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(s),this.logContext);return}a=h}a.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(s,", streamId: ").concat(o,", trackId: ").concat(a),Object.assign(Object.assign({},this.logContext),{rpID:s,streamId:o,trackId:a}));let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={});const d=c.addSubscribedMediaTrack(e,a,n,r,l);d?.isEncrypted&&!this.e2eeManager&&this.emit(ue.EncryptionError,new Error("Encrypted ".concat(d.source," track received from participant ").concat(c.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearHandlersAndControllers(),this.state!==xt.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(i=>{i.trackPublications.forEach(s=>{i.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(i=>{var s,o,a;i.track&&this.localParticipant.unpublishTrack(i.track,e),e?((s=i.track)===null||s===void 0||s.detach(),(o=i.track)===null||o===void 0||o.stop()):(a=i.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(ce.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ce.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ce.AttributesChanged,this.onLocalAttributesChanged).off(ce.TrackMuted,this.onLocalTrackMuted).off(ce.TrackUnmuted,this.onLocalTrackUnmuted).off(ce.LocalTrackPublished,this.onLocalTrackPublished).off(ce.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ce.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ce.MediaDevicesError,this.onMediaDevicesError).off(ce.AudioStreamAcquired,this.startAudio).off(ce.ChatMessage,this.onLocalChatMessageSent).off(ce.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),qs()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=navigator.mediaDevices)===null||r===void 0||r.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(xt.Disconnected),this.emit(ue.Disconnected,n)}}}handleParticipantDisconnected(e,n){var r;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(i=>{n.unpublishTrack(i.trackSid,!0)}),this.emit(ue.ParticipantDisconnected,n),n.setDisconnected(),(r=this.localParticipant)===null||r===void 0||r.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,r,i,s,o){return J(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,Sr.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(r);if(!a){yield this.engine.publishRpcResponse(e,n,null,Sr.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const d=yield a({requestId:n,callerIdentity:e,payload:i,responseTimeout:s});L7(d)>wee?(c=Sr.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(r))):l=d}catch(d){d instanceof Sr?c=d:(console.warn("Uncaught error returned by RPC handler for ".concat(r,". Returning APPLICATION_ERROR instead."),d),c=Sr.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}selectDefaultDevices(){return J(this,void 0,void 0,function*(){var e,n,r;const i=Ti.getInstance().previousDevices,s=yield Ti.getInstance().getDevices(void 0,!1),o=zs();if(o?.name==="Chrome"&&o.os!=="iOS")for(let c of s){const l=i.find(d=>d.deviceId===c.deviceId);l&&l.label!==""&&l.kind===c.kind&&l.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(ue.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const l=m2e(c),d=this.localParticipant.getTrackPublication(l);if(d&&(!((e=d.track)===null||e===void 0)&&e.isUserProvided))continue;const h=s.filter(g=>g.kind===c),m=this.getActiveDevice(c);if(m===((n=i.filter(g=>g.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&h.length>0&&((r=h[0])===null||r===void 0?void 0:r.deviceId)!==m){yield this.switchActiveDevice(c,h[0].deviceId);continue}c==="audioinput"&&!Eb()||c==="videoinput"||h.length>0&&!h.find(g=>g.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!Eb())&&(yield this.switchActiveDevice(c,h[0].deviceId))}})}acquireAudioContext(){return J(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=yee())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(i=>i.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),gs(200)])}catch(i){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:i}))}const r=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";r!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit(ue.AudioPlaybackStatusChanged,r))})}createParticipant(e,n){var r;let i;return n?i=AC.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):i=new AC(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&i.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),i}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const i=this.remoteParticipants.get(e);return n&&i.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),i}const r=this.createParticipant(e,n);return this.remoteParticipants.set(e,r),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(ue.ParticipantConnected,r),r.on(ce.TrackPublished,i=>{this.emitWhenConnected(ue.TrackPublished,i,r)}).on(ce.TrackSubscribed,(i,s)=>{i.kind===he.Kind.Audio?(i.on(Te.AudioPlaybackStarted,this.handleAudioPlaybackStarted),i.on(Te.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):i.kind===he.Kind.Video&&(i.on(Te.VideoPlaybackFailed,this.handleVideoPlaybackFailed),i.on(Te.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(ue.TrackSubscribed,i,s,r)}).on(ce.TrackUnpublished,i=>{this.emit(ue.TrackUnpublished,i,r)}).on(ce.TrackUnsubscribed,(i,s)=>{this.emit(ue.TrackUnsubscribed,i,s,r)}).on(ce.TrackMuted,i=>{this.emitWhenConnected(ue.TrackMuted,i,r)}).on(ce.TrackUnmuted,i=>{this.emitWhenConnected(ue.TrackUnmuted,i,r)}).on(ce.ParticipantMetadataChanged,i=>{this.emitWhenConnected(ue.ParticipantMetadataChanged,i,r)}).on(ce.ParticipantNameChanged,i=>{this.emitWhenConnected(ue.ParticipantNameChanged,i,r)}).on(ce.AttributesChanged,i=>{this.emitWhenConnected(ue.ParticipantAttributesChanged,i,r)}).on(ce.ConnectionQualityChanged,i=>{this.emitWhenConnected(ue.ConnectionQualityChanged,i,r)}).on(ce.ParticipantPermissionsChanged,i=>{this.emitWhenConnected(ue.ParticipantPermissionsChanged,i,r)}).on(ce.TrackSubscriptionStatusChanged,(i,s)=>{this.emitWhenConnected(ue.TrackSubscriptionStatusChanged,i,s,r)}).on(ce.TrackSubscriptionFailed,(i,s)=>{this.emit(ue.TrackSubscriptionFailed,i,r,s)}).on(ce.TrackSubscriptionPermissionChanged,(i,s)=>{this.emitWhenConnected(ue.TrackSubscriptionPermissionChanged,i,s,r)}).on(ce.Active,()=>{this.emitWhenConnected(ue.ParticipantActive,r),r.kind===bb.AGENT&&this.localParticipant.setActiveAgent(r)}),n&&r.updateInfo(n),r}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((r,i)=>(r.push(...i.getTrackPublications()),r),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&f2e(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Bi.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Za.STATE_MISMATCH))):e=0},REe)}clearConnectionReconcile(){this.connectionReconcileInterval&&Bi.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(ue.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,r]=e;this.emit(n,...r)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(this.state===xt.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,r]);else if(this.state===xt.Connected)return this.emit(e,...r);return!1}simulateParticipants(e){return J(this,void 0,void 0,function*(){var n,r;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new lT({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:nr.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new tp({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(ue.SignalConnected),this.emit(ue.Connected),this.setAndEmitConnectionState(xt.Connected),i.video){const o=new nP(he.Kind.Video,new cg({source:Fr.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Xa.AUDIO,name:"video-dummy"}),new cv(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:pH(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(ce.LocalTrackPublished,o)}if(i.audio){const o=new nP(he.Kind.Audio,new cg({source:Fr.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Xa.AUDIO}),new kC(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:r6(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(ce.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new tp({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:xg.ACTIVE,tracks:[],joinedAt:nr.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const l=pH(160*((r=s.aspectRatios[o%s.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),d=new cg({source:Fr.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Xa.AUDIO});c.addSubscribedMediaTrack(l,d.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,d]}if(s.audio){const l=r6(),d=new cg({source:Fr.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Xa.AUDIO});c.addSubscribedMediaTrack(l,d.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,d]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(e!==ue.ActiveSpeakersChanged&&e!==ue.TranscriptionReceived){const s=Aee(r).filter(o=>o!==void 0);(e===ue.TrackSubscribed||e===ue.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...r)}}xu.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function Aee(t){return t.map(e=>{if(e)return Array.isArray(e)?Aee(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Ga;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Ga||(Ga={}));class Mf extends dl.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Ga.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new xu(r.roomOptions),this.connectOptions=r.connectOptions,this.options=r}run(e){return J(this,void 0,void 0,function*(){if(this.status!==Ga.IDLE)throw Error("check is running already");this.setStatus(Ga.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Ga.SKIPPED&&this.setStatus(this.isSuccess()?Ga.SUCCESS:Ga.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return J(this,void 0,void 0,function*(){return this.room.state===xt.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return J(this,void 0,void 0,function*(){this.room&&this.room.state!==xt.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Ga.SKIPPED)}switchProtocol(e){return J(this,void 0,void 0,function*(){let n=!1,r=!1;if(this.room.on(ue.Reconnecting,()=>{n=!0}),this.room.once(ue.Reconnected,()=>{r=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const i=Date.now()+1e4;for(;Date.now()<i;){if(r)return;yield gs(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class IEe extends Mf{get description(){return"Cloud regions"}perform(){return J(this,void 0,void 0,function*(){const e=new eP(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],r=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(r.has(o))continue;r.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const i=n[0];this.bestStats=i,this.appendMessage("best Cloud region: ".concat(i.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return J(this,void 0,void 0,function*(){var n,r;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const i=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!i)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,l="A".repeat(o),d=Date.now();for(let y=0;y<c;y++)yield s.write(l);yield s.close();const h=Date.now(),m=yield(r=this.room.engine.pcManager)===null||r===void 0?void 0:r.publisher.getStats(),g={region:i,rtt:1e4,duration:h-d};return m?.forEach(y=>{y.type==="candidate-pair"&&y.nominated&&(g.rtt=y.currentRoundTripTime*1e3)}),yield this.disconnect(),g})}}const f6=1e4;class kEe extends Mf{get description(){return"Connection via UDP vs TCP"}perform(){return J(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const r=this.bestStats;this.appendMessage("upstream bitrate: ".concat((r.bitrateTotal/r.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((r.rttTotal/r.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((r.jitterTotal/r.count*1e3).toFixed(2)," ms")),r.packetsLost>0&&this.appendWarning("packets lost: ".concat((r.packetsLost/r.packetsSent*100).toFixed(2),"%")),r.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((r.qualityLimitationDurations.bandwidth/(f6/1e3)*100).toFixed(2),"%")),r.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((r.qualityLimitationDurations.cpu/(f6/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return J(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const r=n.getContext("2d");if(!r)throw new Error("Could not get canvas context");let i=0;const s=()=>{i=(i+1)%360,r.fillStyle="hsl(".concat(i,", 100%, 50%)"),r.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,d={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},h=setInterval(()=>J(this,void 0,void 0,function*(){const m=yield l.getRTCStatsReport();m?.forEach(g=>{g.type==="outbound-rtp"?(d.packetsSent=g.packetsSent,d.qualityLimitationDurations=g.qualityLimitationDurations,d.bitrateTotal+=g.targetBitrate,d.count++):g.type==="remote-inbound-rtp"&&(d.packetsLost=g.packetsLost,d.rttTotal+=g.roundTripTime,d.jitterTotal+=g.jitter)})}),1e3);return yield new Promise(m=>setTimeout(m,f6)),clearInterval(h),a.stop(),n.remove(),yield this.disconnect(),d})}}class xEe extends Mf{get description(){return"Can publish audio"}perform(){return J(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield EEe();if(yield vee(r,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(r),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class AEe extends Mf{get description(){return"Can publish video"}perform(){return J(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield SEe();yield this.checkForVideo(r.mediaStreamTrack),n.localParticipant.publishTrack(r),yield new Promise(o=>setTimeout(o,5e3));const i=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let s=0;if(i.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return J(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const r=document.createElement("video");r.srcObject=n,r.muted=!0,r.autoplay=!0,r.playsInline=!0,r.setAttribute("playsinline","true"),document.body.appendChild(r),yield new Promise(i=>{r.onplay=()=>{setTimeout(()=>{var s,o,a,c;const l=document.createElement("canvas"),d=e.getSettings(),h=(o=(s=d.width)!==null&&s!==void 0?s:r.videoWidth)!==null&&o!==void 0?o:1280,m=(c=(a=d.height)!==null&&a!==void 0?a:r.videoHeight)!==null&&c!==void 0?c:720;l.width=h,l.height=m;const g=l.getContext("2d");g.drawImage(r,0,0);const v=g.getImageData(0,0,l.width,l.height).data;let w=!0;for(let S=0;S<v.length;S+=4)if(v[S]!==0||v[S+1]!==0||v[S+2]!==0){w=!1;break}w?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),i()},1e3)},r.play()}),n.getTracks().forEach(i=>i.stop()),r.remove()})}}class PEe extends Mf{get description(){return"Resuming connection after interruption"}perform(){return J(this,void 0,void 0,function*(){var e;const n=yield this.connect();let r=!1,i=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{r=!0};n.on(ue.SignalReconnecting,a).on(ue.Reconnecting,a).on(ue.Reconnected,()=>{i=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,r){if(!i||n.state!==xt.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class LEe extends Mf{get description(){return"Can connect via TURN"}perform(){return J(this,void 0,void 0,function*(){var e,n;const r=new I7,i=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let s=!1,o=!1,a=!1;for(let c of i.iceServers)for(let l of c.urls)l.startsWith("turn:")?(o=!0,a=!0):l.startsWith("turns:")&&(o=!0,a=!0,s=!0),l.startsWith("stun:")&&(a=!0);a?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class OEe extends Mf{get description(){return"Establishing WebRTC connection"}perform(){return J(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(ue.SignalConnected,()=>{var r;const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(s,o)=>{if(s.candidate){const a=new RTCIceCandidate(s);let c="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(MEe(a.address)?c+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(e=!0,c+=" (passive)"):a.protocol==="udp"&&(n=!0)),this.appendMessage(c)}i&&i(s,o)},!((r=this.room.engine.pcManager)===null||r===void 0)&&r.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=s=>{s instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(s.errorCode," ").concat(s.errorText," ").concat(s.url))})});try{yield this.connect(),Tt.info("now the room is connected")}catch(r){throw this.appendWarning("ports need to be open on firewall in order to connect."),r}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function MEe(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class DEe extends Mf{get description(){return"Connecting to signal connection via WebSocket"}perform(){return J(this,void 0,void 0,function*(){var e,n,r;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let i=new I7;const s=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===hZ.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((r=s.serverInfo)===null||r===void 0?void 0:r.region)),yield i.close()})}}class Fat extends dl.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=r}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Ga.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Ga.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return J(this,void 0,void 0,function*(){const n=this.getNextCheckId(),r=new e(this.url,this.token,this.options),i=o=>{this.updateCheck(n,o)};r.on("update",i);const s=yield r.run();return r.off("update",i),s})}checkWebsocket(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(DEe)})}checkWebRTC(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(OEe)})}checkTURN(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(LEe)})}checkReconnect(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(PEe)})}checkPublishAudio(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(xEe)})}checkPublishVideo(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(AEe)})}checkConnectionProtocol(){return J(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(kEe);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return J(this,void 0,void 0,function*(){return this.createAndRunCheck(IEe)})}}function Mt(t,e,n){return(e=UEe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function NEe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function UEe(t){var e=NEe(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class Es extends Error{constructor(e,n){var r;super(e,n),Mt(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}}Mt(Es,"code","ERR_JOSE_GENERIC");class jEe extends Es{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:r,reason:i,payload:n}}),Mt(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Mt(this,"claim",void 0),Mt(this,"reason",void 0),Mt(this,"payload",void 0),this.claim=r,this.reason=i,this.payload=n}}Mt(jEe,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class FEe extends Es{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:r,reason:i,payload:n}}),Mt(this,"code","ERR_JWT_EXPIRED"),Mt(this,"claim",void 0),Mt(this,"reason",void 0),Mt(this,"payload",void 0),this.claim=r,this.reason=i,this.payload=n}}Mt(FEe,"code","ERR_JWT_EXPIRED");class $Ee extends Es{constructor(){super(...arguments),Mt(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Mt($Ee,"code","ERR_JOSE_ALG_NOT_ALLOWED");class BEe extends Es{constructor(){super(...arguments),Mt(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Mt(BEe,"code","ERR_JOSE_NOT_SUPPORTED");class HEe extends Es{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Mt(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Mt(HEe,"code","ERR_JWE_DECRYPTION_FAILED");class VEe extends Es{constructor(){super(...arguments),Mt(this,"code","ERR_JWE_INVALID")}}Mt(VEe,"code","ERR_JWE_INVALID");class qEe extends Es{constructor(){super(...arguments),Mt(this,"code","ERR_JWS_INVALID")}}Mt(qEe,"code","ERR_JWS_INVALID");class GEe extends Es{constructor(){super(...arguments),Mt(this,"code","ERR_JWT_INVALID")}}Mt(GEe,"code","ERR_JWT_INVALID");class KEe extends Es{constructor(){super(...arguments),Mt(this,"code","ERR_JWK_INVALID")}}Mt(KEe,"code","ERR_JWK_INVALID");class zEe extends Es{constructor(){super(...arguments),Mt(this,"code","ERR_JWKS_INVALID")}}Mt(zEe,"code","ERR_JWKS_INVALID");class WEe extends Es{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Mt(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Mt(WEe,"code","ERR_JWKS_NO_MATCHING_KEY");class YEe extends Es{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Mt(this,Symbol.asyncIterator,void 0),Mt(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Mt(YEe,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class XEe extends Es{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),Mt(this,"code","ERR_JWKS_TIMEOUT")}}Mt(XEe,"code","ERR_JWKS_TIMEOUT");class JEe extends Es{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Mt(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Mt(JEe,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function rP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;const r=qh(t)?t.mediaStreamTrack:t,i=r.getSettings();let s={facingMode:(n=e.defaultFacingMode)!==null&&n!==void 0?n:"user",confidence:"low"};if("facingMode"in i){const o=i.facingMode;Tt.trace("rawFacingMode",{rawFacingMode:o}),o&&typeof o=="string"&&ewe(o)&&(s={facingMode:o,confidence:"high"})}if(["low","medium"].includes(s.confidence)){Tt.trace("Try to get facing mode from device label: (".concat(r.label,")"));const o=ZEe(r.label);o!==void 0&&(s=o)}return s}const NH=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),QEe=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function ZEe(t){var e;const n=t.trim().toLowerCase();if(n!=="")return NH.has(n)?NH.get(n):(e=Array.from(QEe.entries()).find(r=>{let[i]=r;return n.includes(i)}))===null||e===void 0?void 0:e[1]}function ewe(t){return t===void 0||["user","environment","left","right"].includes(t)}/**
 * react-router v7.7.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var UH="popstate";function twe(t={}){function e(r,i){let{pathname:s,search:o,hash:a}=r.location;return iP("",{pathname:s,search:o,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:wb(i)}return rwe(e,n,null,t)}function lr(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function rl(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function nwe(){return Math.random().toString(36).substring(2,10)}function jH(t,e){return{usr:t.state,key:t.key,idx:e}}function iP(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Bv(e):e,state:n,key:e&&e.key||r||nwe()}}function wb({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Bv(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function rwe(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,a="POP",c=null,l=d();l==null&&(l=0,o.replaceState({...o.state,idx:l},""));function d(){return(o.state||{idx:null}).idx}function h(){a="POP";let w=d(),S=w==null?null:w-l;l=w,c&&c({action:a,location:v.location,delta:S})}function m(w,S){a="PUSH";let R=iP(v.location,w,S);l=d()+1;let x=jH(R,l),T=v.createHref(R);try{o.pushState(x,"",T)}catch(I){if(I instanceof DOMException&&I.name==="DataCloneError")throw I;i.location.assign(T)}s&&c&&c({action:a,location:v.location,delta:1})}function g(w,S){a="REPLACE";let R=iP(v.location,w,S);l=d();let x=jH(R,l),T=v.createHref(R);o.replaceState(x,"",T),s&&c&&c({action:a,location:v.location,delta:0})}function y(w){return iwe(w)}let v={get action(){return a},get location(){return t(i,o)},listen(w){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(UH,h),c=w,()=>{i.removeEventListener(UH,h),c=null}},createHref(w){return e(i,w)},createURL:y,encodeLocation(w){let S=y(w);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:m,replace:g,go(w){return o.go(w)}};return v}function iwe(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),lr(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:wb(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function U7(t,e,n="/"){return swe(t,e,n,!1)}function swe(t,e,n,r){let i=typeof e=="string"?Bv(e):e,s=Au(i.pathname||"/",n);if(s==null)return null;let o=Pee(t);owe(o);let a=null;for(let c=0;a==null&&c<o.length;++c){let l=vwe(s);a=mwe(o[c],l,r)}return a}function Pee(t,e=[],n=[],r=""){let i=(s,o,a)=>{let c={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};c.relativePath.startsWith("/")&&(lr(c.relativePath.startsWith(r),`Absolute route path "${c.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(r.length));let l=bu([r,c.relativePath]),d=n.concat(c);s.children&&s.children.length>0&&(lr(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${l}".`),Pee(s.children,e,d,l)),!(s.path==null&&!s.index)&&e.push({path:l,score:hwe(l,s.index),routesMeta:d})};return t.forEach((s,o)=>{if(s.path===""||!s.path?.includes("?"))i(s,o);else for(let a of Lee(s.path))i(s,o,a)}),e}function Lee(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=Lee(r.join("/")),a=[];return a.push(...o.map(c=>c===""?s:[s,c].join("/"))),i&&a.push(...o),a.map(c=>t.startsWith("/")&&c===""?"/":c)}function owe(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:pwe(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var awe=/^:[\w-]+$/,cwe=3,lwe=2,uwe=1,dwe=10,fwe=-2,FH=t=>t==="*";function hwe(t,e){let n=t.split("/"),r=n.length;return n.some(FH)&&(r+=fwe),e&&(r+=lwe),n.filter(i=>!FH(i)).reduce((i,s)=>i+(awe.test(s)?cwe:s===""?uwe:dwe),r)}function pwe(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function mwe(t,e,n=!1){let{routesMeta:r}=t,i={},s="/",o=[];for(let a=0;a<r.length;++a){let c=r[a],l=a===r.length-1,d=s==="/"?e:e.slice(s.length)||"/",h=PC({path:c.relativePath,caseSensitive:c.caseSensitive,end:l},d),m=c.route;if(!h&&l&&n&&!r[r.length-1].route.index&&(h=PC({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},d)),!h)return null;Object.assign(i,h.params),o.push({params:i,pathname:bu([s,h.pathname]),pathnameBase:Swe(bu([s,h.pathnameBase])),route:m}),h.pathnameBase!=="/"&&(s=bu([s,h.pathnameBase]))}return o}function PC(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=gwe(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((l,{paramName:d,isOptional:h},m)=>{if(d==="*"){let y=a[m]||"";o=s.slice(0,s.length-y.length).replace(/(.)\/+$/,"$1")}const g=a[m];return h&&!g?l[d]=void 0:l[d]=(g||"").replace(/%2F/g,"/"),l},{}),pathname:s,pathnameBase:o,pattern:t}}function gwe(t,e=!1,n=!0){rl(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,c)=>(r.push({paramName:a,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function vwe(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return rl(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Au(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function ywe(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?Bv(t):t;return{pathname:n?n.startsWith("/")?n:bwe(n,e):e,search:Ewe(r),hash:wwe(i)}}function bwe(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function h6(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function _we(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Oee(t){let e=_we(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Mee(t,e,n,r=!1){let i;typeof t=="string"?i=Bv(t):(i={...t},lr(!i.pathname||!i.pathname.includes("?"),h6("?","pathname","search",i)),lr(!i.pathname||!i.pathname.includes("#"),h6("#","pathname","hash",i)),lr(!i.search||!i.search.includes("#"),h6("#","search","hash",i)));let s=t===""||i.pathname==="",o=s?"/":i.pathname,a;if(o==null)a=n;else{let h=e.length-1;if(!r&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),h-=1;i.pathname=m.join("/")}a=h>=0?e[h]:"/"}let c=ywe(i,a),l=o&&o!=="/"&&o.endsWith("/"),d=(s||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(l||d)&&(c.pathname+="/"),c}var bu=t=>t.join("/").replace(/\/\/+/g,"/"),Swe=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Ewe=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,wwe=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Cwe(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var Dee=["POST","PUT","PATCH","DELETE"];new Set(Dee);var Twe=["GET",...Dee];new Set(Twe);var Hv=_.createContext(null);Hv.displayName="DataRouter";var gT=_.createContext(null);gT.displayName="DataRouterState";_.createContext(!1);var Nee=_.createContext({isTransitioning:!1});Nee.displayName="ViewTransition";var Rwe=_.createContext(new Map);Rwe.displayName="Fetchers";var Iwe=_.createContext(null);Iwe.displayName="Await";var fl=_.createContext(null);fl.displayName="Navigation";var Vv=_.createContext(null);Vv.displayName="Location";var Vu=_.createContext({outlet:null,matches:[],isDataRoute:!1});Vu.displayName="Route";var j7=_.createContext(null);j7.displayName="RouteError";function Uee(t,{relative:e}={}){lr(y_(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=_.useContext(fl),{hash:i,pathname:s,search:o}=b_(t,{relative:e}),a=s;return n!=="/"&&(a=s==="/"?n:bu([n,s])),r.createHref({pathname:a,search:o,hash:i})}function y_(){return _.useContext(Vv)!=null}function rs(){return lr(y_(),"useLocation() may be used only in the context of a <Router> component."),_.useContext(Vv).location}function kwe(){return _.useContext(Vv).navigationType}var jee="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Fee(t){_.useContext(fl).static||_.useLayoutEffect(t)}function hl(){let{isDataRoute:t}=_.useContext(Vu);return t?Bwe():xwe()}function xwe(){lr(y_(),"useNavigate() may be used only in the context of a <Router> component.");let t=_.useContext(Hv),{basename:e,navigator:n}=_.useContext(fl),{matches:r}=_.useContext(Vu),{pathname:i}=rs(),s=JSON.stringify(Oee(r)),o=_.useRef(!1);return Fee(()=>{o.current=!0}),_.useCallback((c,l={})=>{if(rl(o.current,jee),!o.current)return;if(typeof c=="number"){n.go(c);return}let d=Mee(c,JSON.parse(s),i,l.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:bu([e,d.pathname])),(l.replace?n.replace:n.push)(d,l.state,l)},[e,n,s,i,t])}_.createContext(null);function b_(t,{relative:e}={}){let{matches:n}=_.useContext(Vu),{pathname:r}=rs(),i=JSON.stringify(Oee(n));return _.useMemo(()=>Mee(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function Awe(t,e){return $ee(t,e)}function $ee(t,e,n,r){lr(y_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=_.useContext(fl),{matches:s}=_.useContext(Vu),o=s[s.length-1],a=o?o.params:{},c=o?o.pathname:"/",l=o?o.pathnameBase:"/",d=o&&o.route;{let S=d&&d.path||"";Bee(c,!d||S.endsWith("*")||S.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${S}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${S}"> to <Route path="${S==="/"?"*":`${S}/*`}">.`)}let h=rs(),m;if(e){let S=typeof e=="string"?Bv(e):e;lr(l==="/"||S.pathname?.startsWith(l),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${l}" but pathname "${S.pathname}" was given in the \`location\` prop.`),m=S}else m=h;let g=m.pathname||"/",y=g;if(l!=="/"){let S=l.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(S.length).join("/")}let v=U7(t,{pathname:y});rl(d||v!=null,`No routes matched location "${m.pathname}${m.search}${m.hash}" `),rl(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${m.pathname}${m.search}${m.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let w=Dwe(v&&v.map(S=>Object.assign({},S,{params:Object.assign({},a,S.params),pathname:bu([l,i.encodeLocation?i.encodeLocation(S.pathname).pathname:S.pathname]),pathnameBase:S.pathnameBase==="/"?l:bu([l,i.encodeLocation?i.encodeLocation(S.pathnameBase).pathname:S.pathnameBase])})),s,n,r);return e&&w?_.createElement(Vv.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...m},navigationType:"POP"}},w):w}function Pwe(){let t=$we(),e=Cwe(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=_.createElement(_.Fragment,null,_.createElement("p",null,"💿 Hey developer 👋"),_.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",_.createElement("code",{style:s},"ErrorBoundary")," or"," ",_.createElement("code",{style:s},"errorElement")," prop on your route.")),_.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},e),n?_.createElement("pre",{style:i},n):null,o)}var Lwe=_.createElement(Pwe,null),Owe=class extends _.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?_.createElement(Vu.Provider,{value:this.props.routeContext},_.createElement(j7.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Mwe({routeContext:t,match:e,children:n}){let r=_.useContext(Hv);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),_.createElement(Vu.Provider,{value:t},n)}function Dwe(t,e=[],n=null,r=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,s=n?.errors;if(s!=null){let c=i.findIndex(l=>l.route.id&&s?.[l.route.id]!==void 0);lr(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),i=i.slice(0,Math.min(i.length,c+1))}let o=!1,a=-1;if(n)for(let c=0;c<i.length;c++){let l=i[c];if((l.route.HydrateFallback||l.route.hydrateFallbackElement)&&(a=c),l.route.id){let{loaderData:d,errors:h}=n,m=l.route.loader&&!d.hasOwnProperty(l.route.id)&&(!h||h[l.route.id]===void 0);if(l.route.lazy||m){o=!0,a>=0?i=i.slice(0,a+1):i=[i[0]];break}}}return i.reduceRight((c,l,d)=>{let h,m=!1,g=null,y=null;n&&(h=s&&l.route.id?s[l.route.id]:void 0,g=l.route.errorElement||Lwe,o&&(a<0&&d===0?(Bee("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,y=null):a===d&&(m=!0,y=l.route.hydrateFallbackElement||null)));let v=e.concat(i.slice(0,d+1)),w=()=>{let S;return h?S=g:m?S=y:l.route.Component?S=_.createElement(l.route.Component,null):l.route.element?S=l.route.element:S=c,_.createElement(Mwe,{match:l,routeContext:{outlet:c,matches:v,isDataRoute:n!=null},children:S})};return n&&(l.route.ErrorBoundary||l.route.errorElement||d===0)?_.createElement(Owe,{location:n.location,revalidation:n.revalidation,component:g,error:h,children:w(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):w()},null)}function F7(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Nwe(t){let e=_.useContext(Hv);return lr(e,F7(t)),e}function Uwe(t){let e=_.useContext(gT);return lr(e,F7(t)),e}function jwe(t){let e=_.useContext(Vu);return lr(e,F7(t)),e}function $7(t){let e=jwe(t),n=e.matches[e.matches.length-1];return lr(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function Fwe(){return $7("useRouteId")}function $we(){let t=_.useContext(j7),e=Uwe("useRouteError"),n=$7("useRouteError");return t!==void 0?t:e.errors?.[n]}function Bwe(){let{router:t}=Nwe("useNavigate"),e=$7("useNavigate"),n=_.useRef(!1);return Fee(()=>{n.current=!0}),_.useCallback(async(i,s={})=>{rl(n.current,jee),n.current&&(typeof i=="number"?t.navigate(i):await t.navigate(i,{fromRouteId:e,...s}))},[t,e])}var $H={};function Bee(t,e,n){!e&&!$H[t]&&($H[t]=!0,rl(!1,n))}_.memo(Hwe);function Hwe({routes:t,future:e,state:n}){return $ee(t,void 0,n,e)}function Hee(t){lr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Vwe({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:s=!1}){lr(!y_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),a=_.useMemo(()=>({basename:o,navigator:i,static:s,future:{}}),[o,i,s]);typeof n=="string"&&(n=Bv(n));let{pathname:c="/",search:l="",hash:d="",state:h=null,key:m="default"}=n,g=_.useMemo(()=>{let y=Au(c,o);return y==null?null:{location:{pathname:y,search:l,hash:d,state:h,key:m},navigationType:r}},[o,c,l,d,h,m,r]);return rl(g!=null,`<Router basename="${o}"> is not able to match the URL "${c}${l}${d}" because it does not start with the basename, so the <Router> won't render anything.`),g==null?null:_.createElement(fl.Provider,{value:a},_.createElement(Vv.Provider,{children:e,value:g}))}function qwe({children:t,location:e}){return Awe(LC(t),e)}function LC(t,e=[]){let n=[];return _.Children.forEach(t,(r,i)=>{if(!_.isValidElement(r))return;let s=[...e,i];if(r.type===_.Fragment){n.push.apply(n,LC(r.props.children,s));return}lr(r.type===Hee,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),lr(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=LC(r.props.children,s)),n.push(o)}),n}var pw="get",mw="application/x-www-form-urlencoded";function vT(t){return t!=null&&typeof t.tagName=="string"}function Gwe(t){return vT(t)&&t.tagName.toLowerCase()==="button"}function Kwe(t){return vT(t)&&t.tagName.toLowerCase()==="form"}function zwe(t){return vT(t)&&t.tagName.toLowerCase()==="input"}function Wwe(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Ywe(t,e){return t.button===0&&(!e||e==="_self")&&!Wwe(t)}var U2=null;function Xwe(){if(U2===null)try{new FormData(document.createElement("form"),0),U2=!1}catch{U2=!0}return U2}var Jwe=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function p6(t){return t!=null&&!Jwe.has(t)?(rl(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${mw}"`),null):t}function Qwe(t,e){let n,r,i,s,o;if(Kwe(t)){let a=t.getAttribute("action");r=a?Au(a,e):null,n=t.getAttribute("method")||pw,i=p6(t.getAttribute("enctype"))||mw,s=new FormData(t)}else if(Gwe(t)||zwe(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=t.getAttribute("formaction")||a.getAttribute("action");if(r=c?Au(c,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||pw,i=p6(t.getAttribute("formenctype"))||p6(a.getAttribute("enctype"))||mw,s=new FormData(a,t),!Xwe()){let{name:l,type:d,value:h}=t;if(d==="image"){let m=l?`${l}.`:"";s.append(`${m}x`,"0"),s.append(`${m}y`,"0")}else l&&s.append(l,h)}}else{if(vT(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=pw,r=null,i=mw,o=t}return s&&i==="text/plain"&&(o=s,s=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:s,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function B7(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Zwe(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&Au(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function eCe(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function tCe(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function nCe(t,e,n){let r=await Promise.all(t.map(async i=>{let s=e.routes[i.route.id];if(s){let o=await eCe(s,n);return o.links?o.links():[]}return[]}));return oCe(r.flat(1).filter(tCe).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function BH(t,e,n,r,i,s){let o=(c,l)=>n[l]?c.route.id!==n[l].route.id:!0,a=(c,l)=>n[l].pathname!==c.pathname||n[l].route.path?.endsWith("*")&&n[l].params["*"]!==c.params["*"];return s==="assets"?e.filter((c,l)=>o(c,l)||a(c,l)):s==="data"?e.filter((c,l)=>{let d=r.routes[c.route.id];if(!d||!d.hasLoader)return!1;if(o(c,l)||a(c,l))return!0;if(c.route.shouldRevalidate){let h=c.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function rCe(t,e,{includeHydrateFallback:n}={}){return iCe(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let s=[i.module];return i.clientActionModule&&(s=s.concat(i.clientActionModule)),i.clientLoaderModule&&(s=s.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(s=s.concat(i.hydrateFallbackModule)),i.imports&&(s=s.concat(i.imports)),s}).flat(1))}function iCe(t){return[...new Set(t)]}function sCe(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function oCe(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let s=JSON.stringify(sCe(i));return n.has(s)||(n.add(s),r.push({key:s,link:i})),r},[])}function Vee(){let t=_.useContext(Hv);return B7(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function aCe(){let t=_.useContext(gT);return B7(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var H7=_.createContext(void 0);H7.displayName="FrameworkContext";function qee(){let t=_.useContext(H7);return B7(t,"You must render this element inside a <HydratedRouter> element"),t}function cCe(t,e){let n=_.useContext(H7),[r,i]=_.useState(!1),[s,o]=_.useState(!1),{onFocus:a,onBlur:c,onMouseEnter:l,onMouseLeave:d,onTouchStart:h}=e,m=_.useRef(null);_.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let v=S=>{S.forEach(R=>{o(R.isIntersecting)})},w=new IntersectionObserver(v,{threshold:.5});return m.current&&w.observe(m.current),()=>{w.disconnect()}}},[t]),_.useEffect(()=>{if(r){let v=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(v)}}},[r]);let g=()=>{i(!0)},y=()=>{i(!1),o(!1)};return n?t!=="intent"?[s,m,{}]:[s,m,{onFocus:M1(a,g),onBlur:M1(c,y),onMouseEnter:M1(l,g),onMouseLeave:M1(d,y),onTouchStart:M1(h,g)}]:[!1,m,{}]}function M1(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function lCe({page:t,...e}){let{router:n}=Vee(),r=_.useMemo(()=>U7(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?_.createElement(dCe,{page:t,matches:r,...e}):null}function uCe(t){let{manifest:e,routeModules:n}=qee(),[r,i]=_.useState([]);return _.useEffect(()=>{let s=!1;return nCe(t,e,n).then(o=>{s||i(o)}),()=>{s=!0}},[t,e,n]),r}function dCe({page:t,matches:e,...n}){let r=rs(),{manifest:i,routeModules:s}=qee(),{basename:o}=Vee(),{loaderData:a,matches:c}=aCe(),l=_.useMemo(()=>BH(t,e,c,i,r,"data"),[t,e,c,i,r]),d=_.useMemo(()=>BH(t,e,c,i,r,"assets"),[t,e,c,i,r]),h=_.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let y=new Set,v=!1;if(e.forEach(S=>{let R=i.routes[S.route.id];!R||!R.hasLoader||(!l.some(x=>x.route.id===S.route.id)&&S.route.id in a&&s[S.route.id]?.shouldRevalidate||R.hasClientLoader?v=!0:y.add(S.route.id))}),y.size===0)return[];let w=Zwe(t,o,"data");return v&&y.size>0&&w.searchParams.set("_routes",e.filter(S=>y.has(S.route.id)).map(S=>S.route.id).join(",")),[w.pathname+w.search]},[o,a,r,i,l,e,t,s]),m=_.useMemo(()=>rCe(d,i),[d,i]),g=uCe(d);return _.createElement(_.Fragment,null,h.map(y=>_.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...n})),m.map(y=>_.createElement("link",{key:y,rel:"modulepreload",href:y,...n})),g.map(({key:y,link:v})=>_.createElement("link",{key:y,...v})))}function fCe(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var Gee=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Gee&&(window.__reactRouterVersion="7.7.1")}catch{}function hCe({basename:t,children:e,window:n}){let r=_.useRef();r.current==null&&(r.current=twe({window:n,v5Compat:!0}));let i=r.current,[s,o]=_.useState({action:i.action,location:i.location}),a=_.useCallback(c=>{_.startTransition(()=>o(c))},[o]);return _.useLayoutEffect(()=>i.listen(a),[i,a]),_.createElement(Vwe,{basename:t,children:e,location:s.location,navigationType:s.action,navigator:i})}var Kee=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,yT=_.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:s,replace:o,state:a,target:c,to:l,preventScrollReset:d,viewTransition:h,...m},g){let{basename:y}=_.useContext(fl),v=typeof l=="string"&&Kee.test(l),w,S=!1;if(typeof l=="string"&&v&&(w=l,Gee))try{let D=new URL(window.location.href),N=l.startsWith("//")?new URL(D.protocol+l):new URL(l),U=Au(N.pathname,y);N.origin===D.origin&&U!=null?l=U+N.search+N.hash:S=!0}catch{rl(!1,`<Link to="${l}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let R=Uee(l,{relative:i}),[x,T,I]=cCe(r,m),k=Wee(l,{replace:o,state:a,target:c,preventScrollReset:d,relative:i,viewTransition:h});function A(D){e&&e(D),D.defaultPrevented||k(D)}let O=_.createElement("a",{...m,...I,href:w||R,onClick:S||s?e:A,ref:fCe(g,T),target:c,"data-discover":!v&&n==="render"?"true":void 0});return x&&!v?_.createElement(_.Fragment,null,O,_.createElement(lCe,{page:R})):O});yT.displayName="Link";var pCe=_.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:s,to:o,viewTransition:a,children:c,...l},d){let h=b_(o,{relative:l.relative}),m=rs(),g=_.useContext(gT),{navigator:y,basename:v}=_.useContext(fl),w=g!=null&&SCe(h)&&a===!0,S=y.encodeLocation?y.encodeLocation(h).pathname:h.pathname,R=m.pathname,x=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;n||(R=R.toLowerCase(),x=x?x.toLowerCase():null,S=S.toLowerCase()),x&&v&&(x=Au(x,v)||x);const T=S!=="/"&&S.endsWith("/")?S.length-1:S.length;let I=R===S||!i&&R.startsWith(S)&&R.charAt(T)==="/",k=x!=null&&(x===S||!i&&x.startsWith(S)&&x.charAt(S.length)==="/"),A={isActive:I,isPending:k,isTransitioning:w},O=I?e:void 0,D;typeof r=="function"?D=r(A):D=[r,I?"active":null,k?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let N=typeof s=="function"?s(A):s;return _.createElement(yT,{...l,"aria-current":O,className:D,ref:d,style:N,to:o,viewTransition:a},typeof c=="function"?c(A):c)});pCe.displayName="NavLink";var mCe=_.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:s,method:o=pw,action:a,onSubmit:c,relative:l,preventScrollReset:d,viewTransition:h,...m},g)=>{let y=bCe(),v=_Ce(a,{relative:l}),w=o.toLowerCase()==="get"?"get":"post",S=typeof a=="string"&&Kee.test(a),R=x=>{if(c&&c(x),x.defaultPrevented)return;x.preventDefault();let T=x.nativeEvent.submitter,I=T?.getAttribute("formmethod")||o;y(T||x.currentTarget,{fetcherKey:e,method:I,navigate:n,replace:i,state:s,relative:l,preventScrollReset:d,viewTransition:h})};return _.createElement("form",{ref:g,method:w,action:v,onSubmit:r?c:R,...m,"data-discover":!S&&t==="render"?"true":void 0})});mCe.displayName="Form";function gCe(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function zee(t){let e=_.useContext(Hv);return lr(e,gCe(t)),e}function Wee(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:s,viewTransition:o}={}){let a=hl(),c=rs(),l=b_(t,{relative:s});return _.useCallback(d=>{if(Ywe(d,e)){d.preventDefault();let h=n!==void 0?n:wb(c)===wb(l);a(t,{replace:h,state:r,preventScrollReset:i,relative:s,viewTransition:o})}},[c,a,l,n,r,e,t,i,s,o])}var vCe=0,yCe=()=>`__${String(++vCe)}__`;function bCe(){let{router:t}=zee("useSubmit"),{basename:e}=_.useContext(fl),n=Fwe();return _.useCallback(async(r,i={})=>{let{action:s,method:o,encType:a,formData:c,body:l}=Qwe(r,e);if(i.navigate===!1){let d=i.fetcherKey||yCe();await t.fetch(d,n,i.action||s,{preventScrollReset:i.preventScrollReset,formData:c,body:l,formMethod:i.method||o,formEncType:i.encType||a,flushSync:i.flushSync})}else await t.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:c,body:l,formMethod:i.method||o,formEncType:i.encType||a,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})},[t,e,n])}function _Ce(t,{relative:e}={}){let{basename:n}=_.useContext(fl),r=_.useContext(Vu);lr(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),s={...b_(t||".",{relative:e})},o=rs();if(t==null){s.search=o.search;let a=new URLSearchParams(s.search),c=a.getAll("index");if(c.some(d=>d==="")){a.delete("index"),c.filter(h=>h).forEach(h=>a.append("index",h));let d=a.toString();s.search=d?`?${d}`:""}}return(!t||t===".")&&i.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(s.pathname=s.pathname==="/"?n:bu([n,s.pathname])),wb(s)}function SCe(t,{relative:e}={}){let n=_.useContext(Nee);lr(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=zee("useViewTransitionState"),i=b_(t,{relative:e});if(!n.isTransitioning)return!1;let s=Au(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=Au(n.nextLocation.pathname,r)||n.nextLocation.pathname;return PC(i.pathname,o)!=null||PC(i.pathname,s)!=null}var qv=FQ();const Yee=cl(qv),vt=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Gh="8.55.0",en=globalThis;function bT(t,e,n){const r=n||en,i=r.__SENTRY__=r.__SENTRY__||{},s=i[Gh]=i[Gh]||{};return s[t]||(s[t]=e())}const Df=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,ECe="Sentry Logger ",sP=["debug","info","warn","error","log","assert","trace"],OC={};function Tp(t){if(!("console"in en))return t();const e=en.console,n={},r=Object.keys(OC);r.forEach(i=>{const s=OC[i];n[i]=e[i],e[i]=s});try{return t()}finally{r.forEach(i=>{e[i]=n[i]})}}function wCe(){let t=!1;const e={enable:()=>{t=!0},disable:()=>{t=!1},isEnabled:()=>t};return Df?sP.forEach(n=>{e[n]=(...r)=>{t&&Tp(()=>{en.console[n](`${ECe}[${n}]:`,...r)})}}):sP.forEach(n=>{e[n]=()=>{}}),e}const De=bT("logger",wCe),Xee=50,ip="?",HH=/\(error: (.*)\)/,VH=/captureMessage|captureException/;function Jee(...t){const e=t.sort((n,r)=>n[0]-r[0]).map(n=>n[1]);return(n,r=0,i=0)=>{const s=[],o=n.split(`
`);for(let a=r;a<o.length;a++){const c=o[a];if(c.length>1024)continue;const l=HH.test(c)?c.replace(HH,"$1"):c;if(!l.match(/\S*Error: /)){for(const d of e){const h=d(l);if(h){s.push(h);break}}if(s.length>=Xee+i)break}}return TCe(s.slice(i))}}function CCe(t){return Array.isArray(t)?Jee(...t):t}function TCe(t){if(!t.length)return[];const e=Array.from(t);return/sentryWrapped/.test(j2(e).function||"")&&e.pop(),e.reverse(),VH.test(j2(e).function||"")&&(e.pop(),VH.test(j2(e).function||"")&&e.pop()),e.slice(0,Xee).map(n=>({...n,filename:n.filename||j2(e).filename,function:n.function||ip}))}function j2(t){return t[t.length-1]||{}}const m6="<anonymous>";function Pu(t){try{return!t||typeof t!="function"?m6:t.name||m6}catch{return m6}}function qH(t){const e=t.exception;if(e){const n=[];try{return e.values.forEach(r=>{r.stacktrace.frames&&n.push(...r.stacktrace.frames)}),n}catch{return}}}const gw={},GH={};function Nf(t,e){gw[t]=gw[t]||[],gw[t].push(e)}function Uf(t,e){if(!GH[t]){GH[t]=!0;try{e()}catch(n){Df&&De.error(`Error while instrumenting ${t}`,n)}}}function ha(t,e){const n=t&&gw[t];if(n)for(const r of n)try{r(e)}catch(i){Df&&De.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${Pu(r)}
Error:`,i)}}let g6=null;function Qee(t){const e="error";Nf(e,t),Uf(e,RCe)}function RCe(){g6=en.onerror,en.onerror=function(t,e,n,r,i){return ha("error",{column:r,error:i,line:n,msg:t,url:e}),g6?g6.apply(this,arguments):!1},en.onerror.__SENTRY_INSTRUMENTED__=!0}let v6=null;function Zee(t){const e="unhandledrejection";Nf(e,t),Uf(e,ICe)}function ICe(){v6=en.onunhandledrejection,en.onunhandledrejection=function(t){return ha("unhandledrejection",t),v6?v6.apply(this,arguments):!0},en.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function Rp(){return V7(en),en}function V7(t){const e=t.__SENTRY__=t.__SENTRY__||{};return e.version=e.version||Gh,e[Gh]=e[Gh]||{}}const ete=Object.prototype.toString;function _T(t){switch(ete.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return Lu(t,Error)}}function Gv(t,e){return ete.call(t)===`[object ${e}]`}function tte(t){return Gv(t,"ErrorEvent")}function KH(t){return Gv(t,"DOMError")}function kCe(t){return Gv(t,"DOMException")}function _u(t){return Gv(t,"String")}function q7(t){return typeof t=="object"&&t!==null&&"__sentry_template_string__"in t&&"__sentry_template_values__"in t}function G7(t){return t===null||q7(t)||typeof t!="object"&&typeof t!="function"}function lv(t){return Gv(t,"Object")}function ST(t){return typeof Event<"u"&&Lu(t,Event)}function xCe(t){return typeof Element<"u"&&Lu(t,Element)}function ACe(t){return Gv(t,"RegExp")}function ET(t){return!!(t&&t.then&&typeof t.then=="function")}function PCe(t){return lv(t)&&"nativeEvent"in t&&"preventDefault"in t&&"stopPropagation"in t}function Lu(t,e){try{return t instanceof e}catch{return!1}}function nte(t){return!!(typeof t=="object"&&t!==null&&(t.__isVue||t._isVue))}const Mg=en,LCe=80;function sp(t,e={}){if(!t)return"<unknown>";try{let n=t;const r=5,i=[];let s=0,o=0;const a=" > ",c=a.length;let l;const d=Array.isArray(e)?e:e.keyAttrs,h=!Array.isArray(e)&&e.maxStringLength||LCe;for(;n&&s++<r&&(l=OCe(n,d),!(l==="html"||s>1&&o+i.length*c+l.length>=h));)i.push(l),o+=l.length,n=n.parentNode;return i.reverse().join(a)}catch{return"<unknown>"}}function OCe(t,e){const n=t,r=[];if(!n||!n.tagName)return"";if(Mg.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const i=e&&e.length?e.filter(o=>n.getAttribute(o)).map(o=>[o,n.getAttribute(o)]):null;if(i&&i.length)i.forEach(o=>{r.push(`[${o[0]}="${o[1]}"]`)});else{n.id&&r.push(`#${n.id}`);const o=n.className;if(o&&_u(o)){const a=o.split(/\s+/);for(const c of a)r.push(`.${c}`)}}const s=["aria-label","type","name","title","alt"];for(const o of s){const a=n.getAttribute(o);a&&r.push(`[${o}="${a}"]`)}return r.join("")}function MCe(){try{return Mg.document.location.href}catch{return""}}function DCe(t){return Mg.document&&Mg.document.querySelector?Mg.document.querySelector(t):null}function rte(t){if(!Mg.HTMLElement)return null;let e=t;const n=5;for(let r=0;r<n;r++){if(!e)return null;if(e instanceof HTMLElement){if(e.dataset.sentryComponent)return e.dataset.sentryComponent;if(e.dataset.sentryElement)return e.dataset.sentryElement}e=e.parentNode}return null}function Dg(t,e=0){return typeof t!="string"||e===0||t.length<=e?t:`${t.slice(0,e)}...`}function zH(t,e){if(!Array.isArray(t))return"";const n=[];for(let r=0;r<t.length;r++){const i=t[r];try{nte(i)?n.push("[VueViewModel]"):n.push(String(i))}catch{n.push("[value cannot be serialized]")}}return n.join(e)}function NCe(t,e,n=!1){return _u(t)?ACe(e)?e.test(t):_u(e)?n?t===e:t.includes(e):!1:!1}function Kh(t,e=[],n=!1){return e.some(r=>NCe(t,r,n))}function Co(t,e,n){if(!(e in t))return;const r=t[e],i=n(r);typeof i=="function"&&ite(i,r);try{t[e]=i}catch{Df&&De.log(`Failed to replace method "${e}" in object`,t)}}function _a(t,e,n){try{Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0})}catch{Df&&De.log(`Failed to add non-enumerable property "${e}" to object`,t)}}function ite(t,e){try{const n=e.prototype||{};t.prototype=e.prototype=n,_a(t,"__sentry_original__",e)}catch{}}function K7(t){return t.__sentry_original__}function ste(t){if(_T(t))return{message:t.message,name:t.name,stack:t.stack,...YH(t)};if(ST(t)){const e={type:t.type,target:WH(t.target),currentTarget:WH(t.currentTarget),...YH(t)};return typeof CustomEvent<"u"&&Lu(t,CustomEvent)&&(e.detail=t.detail),e}else return t}function WH(t){try{return xCe(t)?sp(t):Object.prototype.toString.call(t)}catch{return"<unknown>"}}function YH(t){if(typeof t=="object"&&t!==null){const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}else return{}}function UCe(t,e=40){const n=Object.keys(ste(t));n.sort();const r=n[0];if(!r)return"[object has no keys]";if(r.length>=e)return Dg(r,e);for(let i=n.length;i>0;i--){const s=n.slice(0,i).join(", ");if(!(s.length>e))return i===n.length?s:Dg(s,e)}return""}function Hi(t){return oP(t,new Map)}function oP(t,e){if(jCe(t)){const n=e.get(t);if(n!==void 0)return n;const r={};e.set(t,r);for(const i of Object.getOwnPropertyNames(t))typeof t[i]<"u"&&(r[i]=oP(t[i],e));return r}if(Array.isArray(t)){const n=e.get(t);if(n!==void 0)return n;const r=[];return e.set(t,r),t.forEach(i=>{r.push(oP(i,e))}),r}return t}function jCe(t){if(!lv(t))return!1;try{const e=Object.getPrototypeOf(t).constructor.name;return!e||e==="Object"}catch{return!0}}const ote=1e3;function __(){return Date.now()/ote}function FCe(){const{performance:t}=en;if(!t||!t.now)return __;const e=Date.now()-t.now(),n=t.timeOrigin==null?e:t.timeOrigin;return()=>(n+t.now())/ote}const vs=FCe(),Qs=(()=>{const{performance:t}=en;if(!t||!t.now)return;const e=3600*1e3,n=t.now(),r=Date.now(),i=t.timeOrigin?Math.abs(t.timeOrigin+n-r):e,s=i<e,o=t.timing&&t.timing.navigationStart,c=typeof o=="number"?Math.abs(o+n-r):e,l=c<e;return s||l?i<=c?t.timeOrigin:o:r})();function pa(){const t=en,e=t.crypto||t.msCrypto;let n=()=>Math.random()*16;try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(n=()=>{const r=new Uint8Array(1);return e.getRandomValues(r),r[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,r=>(r^(n()&15)>>r/4).toString(16))}function ate(t){return t.exception&&t.exception.values?t.exception.values[0]:void 0}function Nd(t){const{message:e,event_id:n}=t;if(e)return e;const r=ate(t);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function aP(t,e,n){const r=t.exception=t.exception||{},i=r.values=r.values||[],s=i[0]=i[0]||{};s.value||(s.value=e||""),s.type||(s.type="Error")}function uv(t,e){const n=ate(t);if(!n)return;const r={type:"generic",handled:!0},i=n.mechanism;if(n.mechanism={...r,...i,...e},e&&"data"in e){const s={...i&&i.data,...e.data};n.mechanism.data=s}}function XH(t){if($Ce(t))return!0;try{_a(t,"__sentry_captured__",!0)}catch{}return!1}function $Ce(t){try{return t.__sentry_captured__}catch{}}var zl;(function(t){t[t.PENDING=0]="PENDING";const n=1;t[t.RESOLVED=n]="RESOLVED";const r=2;t[t.REJECTED=r]="REJECTED"})(zl||(zl={}));function op(t){return new ta(e=>{e(t)})}function MC(t){return new ta((e,n)=>{n(t)})}class ta{constructor(e){ta.prototype.__init.call(this),ta.prototype.__init2.call(this),ta.prototype.__init3.call(this),ta.prototype.__init4.call(this),this._state=zl.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(n){this._reject(n)}}then(e,n){return new ta((r,i)=>{this._handlers.push([!1,s=>{if(!e)r(s);else try{r(e(s))}catch(o){i(o)}},s=>{if(!n)i(s);else try{r(n(s))}catch(o){i(o)}}]),this._executeHandlers()})}catch(e){return this.then(n=>n,e)}finally(e){return new ta((n,r)=>{let i,s;return this.then(o=>{s=!1,i=o,e&&e()},o=>{s=!0,i=o,e&&e()}).then(()=>{if(s){r(i);return}n(i)})})}__init(){this._resolve=e=>{this._setResult(zl.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(zl.REJECTED,e)}}__init3(){this._setResult=(e,n)=>{if(this._state===zl.PENDING){if(ET(n)){n.then(this._resolve,this._reject);return}this._state=e,this._value=n,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===zl.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(n=>{n[0]||(this._state===zl.RESOLVED&&n[1](this._value),this._state===zl.REJECTED&&n[2](this._value),n[0]=!0)})}}}function BCe(t){const e=vs(),n={sid:pa(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>VCe(n)};return t&&dv(n,t),n}function dv(t,e={}){if(e.user&&(!t.ipAddress&&e.user.ip_address&&(t.ipAddress=e.user.ip_address),!t.did&&!e.did&&(t.did=e.user.id||e.user.email||e.user.username)),t.timestamp=e.timestamp||vs(),e.abnormal_mechanism&&(t.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(t.ignoreDuration=e.ignoreDuration),e.sid&&(t.sid=e.sid.length===32?e.sid:pa()),e.init!==void 0&&(t.init=e.init),!t.did&&e.did&&(t.did=`${e.did}`),typeof e.started=="number"&&(t.started=e.started),t.ignoreDuration)t.duration=void 0;else if(typeof e.duration=="number")t.duration=e.duration;else{const n=t.timestamp-t.started;t.duration=n>=0?n:0}e.release&&(t.release=e.release),e.environment&&(t.environment=e.environment),!t.ipAddress&&e.ipAddress&&(t.ipAddress=e.ipAddress),!t.userAgent&&e.userAgent&&(t.userAgent=e.userAgent),typeof e.errors=="number"&&(t.errors=e.errors),e.status&&(t.status=e.status)}function HCe(t,e){let n={};t.status==="ok"&&(n={status:"exited"}),dv(t,n)}function VCe(t){return Hi({sid:`${t.sid}`,init:t.init,started:new Date(t.started*1e3).toISOString(),timestamp:new Date(t.timestamp*1e3).toISOString(),status:t.status,errors:t.errors,did:typeof t.did=="number"||typeof t.did=="string"?`${t.did}`:void 0,duration:t.duration,abnormal_mechanism:t.abnormal_mechanism,attrs:{release:t.release,environment:t.environment,ip_address:t.ipAddress,user_agent:t.userAgent}})}function gf(){return pa()}function vf(){return pa().substring(16)}function wT(t,e,n=2){if(!e||typeof e!="object"||n<=0)return e;if(t&&e&&Object.keys(e).length===0)return t;const r={...t};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=wT(r[i],e[i],n-1));return r}const cP="_sentrySpan";function Cb(t,e){e?_a(t,cP,e):delete t[cP]}function DC(t){return t[cP]}const qCe=100;class z7{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:gf(),spanId:vf()}}clone(){const e=new z7;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,Cb(e,DC(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&dv(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,n){return this._tags={...this._tags,[e]:n},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,n){return this._extra={...this._extra,[e]:n},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,n){return n===null?delete this._contexts[e]:this._contexts[e]=n,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const n=typeof e=="function"?e(this):e,[r,i]=n instanceof yf?[n.getScopeData(),n.getRequestSession()]:lv(n)?[e,e.requestSession]:[],{tags:s,extra:o,user:a,contexts:c,level:l,fingerprint:d=[],propagationContext:h}=r||{};return this._tags={...this._tags,...s},this._extra={...this._extra,...o},this._contexts={...this._contexts,...c},a&&Object.keys(a).length&&(this._user=a),l&&(this._level=l),d.length&&(this._fingerprint=d),h&&(this._propagationContext=h),i&&(this._requestSession=i),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,Cb(this,void 0),this._attachments=[],this.setPropagationContext({traceId:gf()}),this._notifyScopeListeners(),this}addBreadcrumb(e,n){const r=typeof n=="number"?n:qCe;if(r<=0)return this;const i={timestamp:__(),...e};return this._breadcrumbs.push(i),this._breadcrumbs.length>r&&(this._breadcrumbs=this._breadcrumbs.slice(-r),this._client&&this._client.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:DC(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=wT(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext={spanId:vf(),...e},this}getPropagationContext(){return this._propagationContext}captureException(e,n){const r=n&&n.event_id?n.event_id:pa();if(!this._client)return De.warn("No client configured on scope - will not capture exception!"),r;const i=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:i,...n,event_id:r},this),r}captureMessage(e,n,r){const i=r&&r.event_id?r.event_id:pa();if(!this._client)return De.warn("No client configured on scope - will not capture message!"),i;const s=new Error(e);return this._client.captureMessage(e,n,{originalException:e,syntheticException:s,...r,event_id:i},this),i}captureEvent(e,n){const r=n&&n.event_id?n.event_id:pa();return this._client?(this._client.captureEvent(e,{...n,event_id:r},this),r):(De.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}const yf=z7;function GCe(){return bT("defaultCurrentScope",()=>new yf)}function KCe(){return bT("defaultIsolationScope",()=>new yf)}class zCe{constructor(e,n){let r;e?r=e:r=new yf;let i;n?i=n:i=new yf,this._stack=[{scope:r}],this._isolationScope=i}withScope(e){const n=this._pushScope();let r;try{r=e(n)}catch(i){throw this._popScope(),i}return ET(r)?r.then(i=>(this._popScope(),i),i=>{throw this._popScope(),i}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function fv(){const t=Rp(),e=V7(t);return e.stack=e.stack||new zCe(GCe(),KCe())}function WCe(t){return fv().withScope(t)}function YCe(t,e){const n=fv();return n.withScope(()=>(n.getStackTop().scope=t,e(t)))}function JH(t){return fv().withScope(()=>t(fv().getIsolationScope()))}function XCe(){return{withIsolationScope:JH,withScope:WCe,withSetScope:YCe,withSetIsolationScope:(t,e)=>JH(e),getCurrentScope:()=>fv().getScope(),getIsolationScope:()=>fv().getIsolationScope()}}function Kv(t){const e=V7(t);return e.acs?e.acs:XCe()}function Ln(){const t=Rp();return Kv(t).getCurrentScope()}function pl(){const t=Rp();return Kv(t).getIsolationScope()}function JCe(){return bT("globalScope",()=>new yf)}function CT(...t){const e=Rp(),n=Kv(e);if(t.length===2){const[r,i]=t;return r?n.withSetScope(r,i):n.withScope(i)}return n.withScope(t[0])}function cn(){return Ln().getClient()}function QCe(t){const e=t.getPropagationContext(),{traceId:n,spanId:r,parentSpanId:i}=e;return Hi({trace_id:n,span_id:r,parent_span_id:i})}const ZCe="_sentryMetrics";function lP(t){const e=t[ZCe];if(!e)return;const n={};for(const[,[r,i]]of e)(n[r]||(n[r]=[])).push(Hi(i));return n}const la="sentry.source",cte="sentry.sample_rate",Ou="sentry.op",qr="sentry.origin",uP="sentry.idle_span_finish_reason",TT="sentry.measurement_unit",RT="sentry.measurement_value",QH="sentry.custom_span_name",e3e="sentry.profile_id",W7="sentry.exclusive_time",t3e=0,lte=1,bi=2;function n3e(t){if(t<400&&t>=100)return{code:lte};if(t>=400&&t<500)switch(t){case 401:return{code:bi,message:"unauthenticated"};case 403:return{code:bi,message:"permission_denied"};case 404:return{code:bi,message:"not_found"};case 409:return{code:bi,message:"already_exists"};case 413:return{code:bi,message:"failed_precondition"};case 429:return{code:bi,message:"resource_exhausted"};case 499:return{code:bi,message:"cancelled"};default:return{code:bi,message:"invalid_argument"}}if(t>=500&&t<600)switch(t){case 501:return{code:bi,message:"unimplemented"};case 503:return{code:bi,message:"unavailable"};case 504:return{code:bi,message:"deadline_exceeded"};default:return{code:bi,message:"internal_error"}}return{code:bi,message:"unknown_error"}}function ute(t,e){t.setAttribute("http.response.status_code",e);const n=n3e(e);n.message!=="unknown_error"&&t.setStatus(n)}const Y7="sentry-",r3e=/^sentry-/,i3e=8192;function dte(t){const e=o3e(t);if(!e)return;const n=Object.entries(e).reduce((r,[i,s])=>{if(i.match(r3e)){const o=i.slice(Y7.length);r[o]=s}return r},{});if(Object.keys(n).length>0)return n}function s3e(t){if(!t)return;const e=Object.entries(t).reduce((n,[r,i])=>(i&&(n[`${Y7}${r}`]=i),n),{});return a3e(e)}function o3e(t){if(!(!t||!_u(t)&&!Array.isArray(t)))return Array.isArray(t)?t.reduce((e,n)=>{const r=ZH(n);return Object.entries(r).forEach(([i,s])=>{e[i]=s}),e},{}):ZH(t)}function ZH(t){return t.split(",").map(e=>e.split("=").map(n=>decodeURIComponent(n.trim()))).reduce((e,[n,r])=>(n&&r&&(e[n]=r),e),{})}function a3e(t){if(Object.keys(t).length!==0)return Object.entries(t).reduce((e,[n,r],i)=>{const s=`${encodeURIComponent(n)}=${encodeURIComponent(r)}`,o=i===0?s:`${e},${s}`;return o.length>i3e?(Df&&De.warn(`Not adding key: ${n} with val: ${r} to baggage header due to exceeding baggage size limits.`),e):o},"")}const fte=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function c3e(t){if(!t)return;const e=t.match(fte);if(!e)return;let n;return e[3]==="1"?n=!0:e[3]==="0"&&(n=!1),{traceId:e[1],parentSampled:n,parentSpanId:e[2]}}function l3e(t,e){const n=c3e(t),r=dte(e);if(!n||!n.traceId)return{traceId:gf(),spanId:vf()};const{traceId:i,parentSpanId:s,parentSampled:o}=n,a=vf();return{traceId:i,parentSpanId:s,spanId:a,sampled:o,dsc:r||{}}}function hte(t=gf(),e=vf(),n){let r="";return n!==void 0&&(r=n?"-1":"-0"),`${t}-${e}${r}`}const pte=0,mte=1;let eV=!1;function u3e(t){const{spanId:e,traceId:n}=t.spanContext(),{data:r,op:i,parent_span_id:s,status:o,origin:a}=on(t);return Hi({parent_span_id:s,span_id:e,trace_id:n,data:r,op:i,status:o,origin:a})}function d3e(t){const{spanId:e,traceId:n,isRemote:r}=t.spanContext(),i=r?e:on(t).parent_span_id,s=r?vf():e;return Hi({parent_span_id:i,span_id:s,trace_id:n})}function f3e(t){const{traceId:e,spanId:n}=t.spanContext(),r=Ip(t);return hte(e,n,r)}function zh(t){return typeof t=="number"?tV(t):Array.isArray(t)?t[0]+t[1]/1e9:t instanceof Date?tV(t.getTime()):vs()}function tV(t){return t>9999999999?t/1e3:t}function on(t){if(p3e(t))return t.getSpanJSON();try{const{spanId:e,traceId:n}=t.spanContext();if(h3e(t)){const{attributes:r,startTime:i,name:s,endTime:o,parentSpanId:a,status:c}=t;return Hi({span_id:e,trace_id:n,data:r,description:s,parent_span_id:a,start_timestamp:zh(i),timestamp:zh(o)||void 0,status:gte(c),op:r[Ou],origin:r[qr],_metrics_summary:lP(t)})}return{span_id:e,trace_id:n}}catch{return{}}}function h3e(t){const e=t;return!!e.attributes&&!!e.startTime&&!!e.name&&!!e.endTime&&!!e.status}function p3e(t){return typeof t.getSpanJSON=="function"}function Ip(t){const{traceFlags:e}=t.spanContext();return e===mte}function gte(t){if(!(!t||t.code===t3e))return t.code===lte?"ok":t.message||"unknown_error"}const Wh="_sentryChildSpans",dP="_sentryRootSpan";function vte(t,e){const n=t[dP]||t;_a(e,dP,n),t[Wh]?t[Wh].add(e):_a(t,Wh,new Set([e]))}function m3e(t,e){t[Wh]&&t[Wh].delete(e)}function vw(t){const e=new Set;function n(r){if(!e.has(r)&&Ip(r)){e.add(r);const i=r[Wh]?Array.from(r[Wh]):[];for(const s of i)n(s)}}return n(t),Array.from(e)}function Vi(t){return t[dP]||t}function Ki(){const t=Rp(),e=Kv(t);return e.getActiveSpan?e.getActiveSpan():DC(Ln())}function yte(){eV||(Tp(()=>{console.warn("[Sentry] Deprecation warning: Returning null from `beforeSendSpan` will be disallowed from SDK version 9.0.0 onwards. The callback will only support mutating spans. To drop certain spans, configure the respective integrations directly.")}),eV=!0)}let nV=!1;function g3e(){nV||(nV=!0,Qee(fP),Zee(fP))}function fP(){const t=Ki(),e=t&&Vi(t);if(e){const n="internal_error";vt&&De.log(`[Tracing] Root span: ${n} -> Global error occurred`),e.setStatus({code:bi,message:n})}}fP.tag="sentry_tracingErrorCallback";const bte="_sentryScope",_te="_sentryIsolationScope";function v3e(t,e,n){t&&(_a(t,_te,n),_a(t,bte,e))}function rV(t){return{scope:t[bte],isolationScope:t[_te]}}function bf(t){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const e=cn(),n=t||e&&e.getOptions();return!!n&&(n.enableTracing||"tracesSampleRate"in n||"tracesSampler"in n)}class zv{constructor(e={}){this._traceId=e.traceId||gf(),this._spanId=e.spanId||vf()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:pte}}end(e){}setAttribute(e,n){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,n,r){return this}addLink(e){return this}addLinks(e){return this}recordException(e,n){}}const X7="production",Ste="_frozenDsc";function iV(t,e){_a(t,Ste,e)}function Ete(t,e){const n=e.getOptions(),{publicKey:r}=e.getDsn()||{},i=Hi({environment:n.environment||X7,release:n.release,public_key:r,trace_id:t});return e.emit("createDsc",i),i}function wte(t,e){const n=e.getPropagationContext();return n.dsc||Ete(n.traceId,t)}function Wv(t){const e=cn();if(!e)return{};const n=Vi(t),r=n[Ste];if(r)return r;const i=n.spanContext().traceState,s=i&&i.get("sentry.dsc"),o=s&&dte(s);if(o)return o;const a=Ete(t.spanContext().traceId,e),c=on(n),l=c.data||{},d=l[cte];d!=null&&(a.sample_rate=`${d}`);const h=l[la],m=c.description;return h!=="url"&&m&&(a.transaction=m),bf()&&(a.sampled=String(Ip(n))),e.emit("createDsc",a,n),a}function y3e(t){if(!vt)return;const{description:e="< unknown name >",op:n="< unknown op >",parent_span_id:r}=on(t),{spanId:i}=t.spanContext(),s=Ip(t),o=Vi(t),a=o===t,c=`[Tracing] Starting ${s?"sampled":"unsampled"} ${a?"root ":""}span`,l=[`op: ${n}`,`name: ${e}`,`ID: ${i}`];if(r&&l.push(`parent ID: ${r}`),!a){const{op:d,description:h}=on(o);l.push(`root ID: ${o.spanContext().spanId}`),d&&l.push(`root op: ${d}`),h&&l.push(`root description: ${h}`)}De.log(`${c}
  ${l.join(`
  `)}`)}function b3e(t){if(!vt)return;const{description:e="< unknown name >",op:n="< unknown op >"}=on(t),{spanId:r}=t.spanContext(),s=Vi(t)===t,o=`[Tracing] Finishing "${n}" ${s?"root ":""}span "${e}" with ID ${r}`;De.log(o)}function Cte(t){if(typeof t=="boolean")return Number(t);const e=typeof t=="string"?parseFloat(t):t;if(typeof e!="number"||isNaN(e)||e<0||e>1){vt&&De.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(t)} of type ${JSON.stringify(typeof t)}.`);return}return e}function _3e(t,e){if(!bf(t))return[!1];const n=pl().getScopeData().sdkProcessingMetadata.normalizedRequest,r={...e,normalizedRequest:e.normalizedRequest||n};let i;typeof t.tracesSampler=="function"?i=t.tracesSampler(r):r.parentSampled!==void 0?i=r.parentSampled:typeof t.tracesSampleRate<"u"?i=t.tracesSampleRate:i=1;const s=Cte(i);return s===void 0?(vt&&De.warn("[Tracing] Discarding transaction because of invalid sample rate."),[!1]):s?Math.random()<s?[!0,s]:(vt&&De.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(i)})`),[!1,s]):(vt&&De.log(`[Tracing] Discarding transaction because ${typeof t.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),[!1,s])}const S3e=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function E3e(t){return t==="http"||t==="https"}function Yv(t,e=!1){const{host:n,path:r,pass:i,port:s,projectId:o,protocol:a,publicKey:c}=t;return`${a}://${c}${e&&i?`:${i}`:""}@${n}${s?`:${s}`:""}/${r&&`${r}/`}${o}`}function w3e(t){const e=S3e.exec(t);if(!e){Tp(()=>{console.error(`Invalid Sentry Dsn: ${t}`)});return}const[n,r,i="",s="",o="",a=""]=e.slice(1);let c="",l=a;const d=l.split("/");if(d.length>1&&(c=d.slice(0,-1).join("/"),l=d.pop()),l){const h=l.match(/^\d+/);h&&(l=h[0])}return Tte({host:s,pass:i,path:c,projectId:l,port:o,protocol:n,publicKey:r})}function Tte(t){return{protocol:t.protocol,publicKey:t.publicKey||"",pass:t.pass||"",host:t.host,port:t.port||"",path:t.path||"",projectId:t.projectId}}function C3e(t){if(!Df)return!0;const{port:e,projectId:n,protocol:r}=t;return["protocol","publicKey","host","projectId"].find(o=>t[o]?!1:(De.error(`Invalid Sentry Dsn: ${o} missing`),!0))?!1:n.match(/^\d+$/)?E3e(r)?e&&isNaN(parseInt(e,10))?(De.error(`Invalid Sentry Dsn: Invalid port ${e}`),!1):!0:(De.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(De.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1)}function Rte(t){const e=typeof t=="string"?w3e(t):Tte(t);if(!(!e||!C3e(e)))return e}function T3e(){const t=typeof WeakSet=="function",e=t?new WeakSet:[];function n(i){if(t)return e.has(i)?!0:(e.add(i),!1);for(let s=0;s<e.length;s++)if(e[s]===i)return!0;return e.push(i),!1}function r(i){if(t)e.delete(i);else for(let s=0;s<e.length;s++)if(e[s]===i){e.splice(s,1);break}}return[n,r]}function Wl(t,e=100,n=1/0){try{return hP("",t,e,n)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function Ite(t,e=3,n=100*1024){const r=Wl(t,e);return x3e(r)>n?Ite(t,e-1,n):r}function hP(t,e,n=1/0,r=1/0,i=T3e()){const[s,o]=i;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const a=R3e(t,e);if(!a.startsWith("[object "))return a;if(e.__sentry_skip_normalization__)return e;const c=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:n;if(c===0)return a.replace("object ","");if(s(e))return"[Circular ~]";const l=e;if(l&&typeof l.toJSON=="function")try{const g=l.toJSON();return hP("",g,c-1,r,i)}catch{}const d=Array.isArray(e)?[]:{};let h=0;const m=ste(e);for(const g in m){if(!Object.prototype.hasOwnProperty.call(m,g))continue;if(h>=r){d[g]="[MaxProperties ~]";break}const y=m[g];d[g]=hP(g,y,c-1,r,i),h++}return o(e),d}function R3e(t,e){try{if(t==="domain"&&e&&typeof e=="object"&&e._events)return"[Domain]";if(t==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&e===global)return"[Global]";if(typeof window<"u"&&e===window)return"[Window]";if(typeof document<"u"&&e===document)return"[Document]";if(nte(e))return"[VueViewModel]";if(PCe(e))return"[SyntheticEvent]";if(typeof e=="number"&&!Number.isFinite(e))return`[${e}]`;if(typeof e=="function")return`[Function: ${Pu(e)}]`;if(typeof e=="symbol")return`[${String(e)}]`;if(typeof e=="bigint")return`[BigInt: ${String(e)}]`;const n=I3e(e);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(n){return`**non-serializable** (${n})`}}function I3e(t){const e=Object.getPrototypeOf(t);return e?e.constructor.name:"null prototype"}function k3e(t){return~-encodeURI(t).split(/%..|./).length}function x3e(t){return k3e(JSON.stringify(t))}function Xv(t,e=[]){return[t,e]}function A3e(t,e){const[n,r]=t;return[n,[...r,e]]}function sV(t,e){const n=t[1];for(const r of n){const i=r[0].type;if(e(r,i))return!0}return!1}function pP(t){return en.__SENTRY__&&en.__SENTRY__.encodePolyfill?en.__SENTRY__.encodePolyfill(t):new TextEncoder().encode(t)}function P3e(t){const[e,n]=t;let r=JSON.stringify(e);function i(s){typeof r=="string"?r=typeof s=="string"?r+s:[pP(r),s]:r.push(typeof s=="string"?pP(s):s)}for(const s of n){const[o,a]=s;if(i(`
${JSON.stringify(o)}
`),typeof a=="string"||a instanceof Uint8Array)i(a);else{let c;try{c=JSON.stringify(a)}catch{c=JSON.stringify(Wl(a))}i(c)}}return typeof r=="string"?r:L3e(r)}function L3e(t){const e=t.reduce((i,s)=>i+s.length,0),n=new Uint8Array(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return n}function O3e(t){return[{type:"span"},t]}function M3e(t){const e=typeof t.data=="string"?pP(t.data):t.data;return[Hi({type:"attachment",length:e.length,filename:t.filename,content_type:t.contentType,attachment_type:t.attachmentType}),e]}const D3e={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket",raw_security:"security"};function oV(t){return D3e[t]}function kte(t){if(!t||!t.sdk)return;const{name:e,version:n}=t.sdk;return{name:e,version:n}}function N3e(t,e,n,r){const i=t.sdkProcessingMetadata&&t.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:t.event_id,sent_at:new Date().toISOString(),...e&&{sdk:e},...!!n&&r&&{dsn:Yv(r)},...i&&{trace:Hi({...i})}}}function U3e(t,e){return e&&(t.sdk=t.sdk||{},t.sdk.name=t.sdk.name||e.name,t.sdk.version=t.sdk.version||e.version,t.sdk.integrations=[...t.sdk.integrations||[],...e.integrations||[]],t.sdk.packages=[...t.sdk.packages||[],...e.packages||[]]),t}function j3e(t,e,n,r){const i=kte(n),s={sent_at:new Date().toISOString(),...i&&{sdk:i},...!!r&&e&&{dsn:Yv(e)}},o="aggregates"in t?[{type:"sessions"},t]:[{type:"session"},t.toJSON()];return Xv(s,[o])}function F3e(t,e,n,r){const i=kte(n),s=t.type&&t.type!=="replay_event"?t.type:"event";U3e(t,n&&n.sdk);const o=N3e(t,i,r,e);return delete t.sdkProcessingMetadata,Xv(o,[[{type:s},t]])}function $3e(t,e){function n(d){return!!d.trace_id&&!!d.public_key}const r=Wv(t[0]),i=e&&e.getDsn(),s=e&&e.getOptions().tunnel,o={sent_at:new Date().toISOString(),...n(r)&&{trace:r},...!!s&&i&&{dsn:Yv(i)}},a=e&&e.getOptions().beforeSendSpan,c=a?d=>{const h=a(on(d));return h||yte(),h}:d=>on(d),l=[];for(const d of t){const h=c(d);h&&l.push(O3e(h))}return Xv(o,l)}function B3e(t,e,n,r=Ki()){const i=r&&Vi(r);i&&(vt&&De.log(`[Measurement] Setting measurement on root span: ${t} = ${e} ${n}`),i.addEvent(t,{[RT]:e,[TT]:n}))}function aV(t){if(!t||t.length===0)return;const e={};return t.forEach(n=>{const r=n.attributes||{},i=r[TT],s=r[RT];typeof i=="string"&&typeof s=="number"&&(e[n.name]={value:s,unit:i})}),e}const cV=1e3;class J7{constructor(e={}){this._traceId=e.traceId||gf(),this._spanId=e.spanId||vf(),this._startTime=e.startTimestamp||vs(),this._attributes={},this.setAttributes({[qr]:"manual",[Ou]:e.op,...e.attributes}),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this}addLinks(e){return this}recordException(e,n){}spanContext(){const{_spanId:e,_traceId:n,_sampled:r}=this;return{spanId:e,traceId:n,traceFlags:r?mte:pte}}setAttribute(e,n){return n===void 0?delete this._attributes[e]:this._attributes[e]=n,this}setAttributes(e){return Object.keys(e).forEach(n=>this.setAttribute(n,e[n])),this}updateStartTime(e){this._startTime=zh(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this.setAttribute(la,"custom"),this}end(e){this._endTime||(this._endTime=zh(e),b3e(this),this._onSpanEnded())}getSpanJSON(){return Hi({data:this._attributes,description:this._name,op:this._attributes[Ou],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:gte(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[qr],_metrics_summary:lP(this),profile_id:this._attributes[e3e],exclusive_time:this._attributes[W7],measurements:aV(this._events),is_segment:this._isStandaloneSpan&&Vi(this)===this||void 0,segment_id:this._isStandaloneSpan?Vi(this).spanContext().spanId:void 0})}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,n,r){vt&&De.log("[Tracing] Adding an event to span:",e);const i=lV(n)?n:r||vs(),s=lV(n)?{}:n||{},o={name:e,time:zh(i),attributes:s};return this._events.push(o),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=cn();if(e&&e.emit("spanEnd",this),!(this._isStandaloneSpan||this===Vi(this)))return;if(this._isStandaloneSpan){this._sampled?V3e($3e([this],e)):(vt&&De.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span"));return}const r=this._convertSpanToTransaction();r&&(rV(this).scope||Ln()).captureEvent(r)}_convertSpanToTransaction(){if(!uV(on(this)))return;this._name||(vt&&De.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:e,isolationScope:n}=rV(this),i=(e||Ln()).getClient()||cn();if(this._sampled!==!0){vt&&De.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),i&&i.recordDroppedEvent("sample_rate","transaction");return}const o=vw(this).filter(h=>h!==this&&!H3e(h)).map(h=>on(h)).filter(uV),a=this._attributes[la];delete this._attributes[QH],o.forEach(h=>{h.data&&delete h.data[QH]});const c={contexts:{trace:u3e(this)},spans:o.length>cV?o.sort((h,m)=>h.start_timestamp-m.start_timestamp).slice(0,cV):o,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:e,capturedSpanIsolationScope:n,...Hi({dynamicSamplingContext:Wv(this)})},_metrics_summary:lP(this),...a&&{transaction_info:{source:a}}},l=aV(this._events);return l&&Object.keys(l).length&&(vt&&De.log("[Measurements] Adding measurements to transaction event",JSON.stringify(l,void 0,2)),c.measurements=l),c}}function lV(t){return t&&typeof t=="number"||t instanceof Date||Array.isArray(t)}function uV(t){return!!t.start_timestamp&&!!t.timestamp&&!!t.span_id&&!!t.trace_id}function H3e(t){return t instanceof J7&&t.isStandaloneSpan()}function V3e(t){const e=cn();if(!e)return;const n=t[1];if(!n||n.length===0){e.recordDroppedEvent("before_send","span");return}e.sendEnvelope(t)}const xte="__SENTRY_SUPPRESS_TRACING__";function S_(t){const e=Pte();if(e.startInactiveSpan)return e.startInactiveSpan(t);const n=G3e(t),{forceTransaction:r,parentSpan:i}=t;return(t.scope?o=>CT(t.scope,o):i!==void 0?o=>Ate(i,o):o=>o())(()=>{const o=Ln(),a=z3e(o);return t.onlyIfParent&&!a?new zv:q3e({parentSpan:a,spanArguments:n,forceTransaction:r,scope:o})})}function Ate(t,e){const n=Pte();return n.withActiveSpan?n.withActiveSpan(t,e):CT(r=>(Cb(r,t||void 0),e(r)))}function q3e({parentSpan:t,spanArguments:e,forceTransaction:n,scope:r}){if(!bf())return new zv;const i=pl();let s;if(t&&!n)s=K3e(t,r,e),vte(t,s);else if(t){const o=Wv(t),{traceId:a,spanId:c}=t.spanContext(),l=Ip(t);s=dV({traceId:a,parentSpanId:c,...e},r,l),iV(s,o)}else{const{traceId:o,dsc:a,parentSpanId:c,sampled:l}={...i.getPropagationContext(),...r.getPropagationContext()};s=dV({traceId:o,parentSpanId:c,...e},r,l),a&&iV(s,a)}return y3e(s),v3e(s,r,i),s}function G3e(t){const n={isStandalone:(t.experimental||{}).standalone,...t};if(t.startTime){const r={...n};return r.startTimestamp=zh(t.startTime),delete r.startTime,r}return n}function Pte(){const t=Rp();return Kv(t)}function dV(t,e,n){const r=cn(),i=r&&r.getOptions()||{},{name:s="",attributes:o}=t,[a,c]=e.getScopeData().sdkProcessingMetadata[xte]?[!1]:_3e(i,{name:s,parentSampled:n,attributes:o,transactionContext:{name:s,parentSampled:n}}),l=new J7({...t,attributes:{[la]:"custom",...t.attributes},sampled:a});return c!==void 0&&l.setAttribute(cte,c),r&&r.emit("spanStart",l),l}function K3e(t,e,n){const{spanId:r,traceId:i}=t.spanContext(),s=e.getScopeData().sdkProcessingMetadata[xte]?!1:Ip(t),o=s?new J7({...n,parentSpanId:r,traceId:i,sampled:s}):new zv({traceId:i});vte(t,o);const a=cn();return a&&(a.emit("spanStart",o),n.endTimestamp&&a.emit("spanEnd",o)),o}function z3e(t){const e=DC(t);if(!e)return;const n=cn();return(n?n.getOptions():{}).parentSpanIsAlwaysRootSpan?Vi(e):e}const yw={idleTimeout:1e3,finalTimeout:3e4,childSpanTimeout:15e3},W3e="heartbeatFailed",Y3e="idleTimeout",X3e="finalTimeout",J3e="externalFinish";function Lte(t,e={}){const n=new Map;let r=!1,i,s=J3e,o=!e.disableAutoFinish;const a=[],{idleTimeout:c=yw.idleTimeout,finalTimeout:l=yw.finalTimeout,childSpanTimeout:d=yw.childSpanTimeout,beforeSpanEnd:h}=e,m=cn();if(!m||!bf())return new zv;const g=Ln(),y=Ki(),v=Q3e(t);v.end=new Proxy(v.end,{apply(k,A,O){h&&h(v);const[D,...N]=O,U=D||vs(),$=zh(U),K=vw(v).filter(z=>z!==v);if(!K.length)return I($),Reflect.apply(k,A,[$,...N]);const Y=K.map(z=>on(z).timestamp).filter(z=>!!z),G=Y.length?Math.max(...Y):void 0,F=on(v).start_timestamp,q=Math.min(F?F+l/1e3:1/0,Math.max(F||-1/0,Math.min($,G||1/0)));return I(q),Reflect.apply(k,A,[q,...N])}});function w(){i&&(clearTimeout(i),i=void 0)}function S(k){w(),i=setTimeout(()=>{!r&&n.size===0&&o&&(s=Y3e,v.end(k))},c)}function R(k){i=setTimeout(()=>{!r&&o&&(s=W3e,v.end(k))},d)}function x(k){w(),n.set(k,!0);const A=vs();R(A+d/1e3)}function T(k){if(n.has(k)&&n.delete(k),n.size===0){const A=vs();S(A+c/1e3)}}function I(k){r=!0,n.clear(),a.forEach($=>$()),Cb(g,y);const A=on(v),{start_timestamp:O}=A;if(!O)return;(A.data||{})[uP]||v.setAttribute(uP,s),De.log(`[Tracing] Idle span "${A.op}" finished`);const N=vw(v).filter($=>$!==v);let U=0;N.forEach($=>{$.isRecording()&&($.setStatus({code:bi,message:"cancelled"}),$.end(k),vt&&De.log("[Tracing] Cancelling span since span ended early",JSON.stringify($,void 0,2)));const K=on($),{timestamp:Y=0,start_timestamp:G=0}=K,F=G<=k,q=(l+c)/1e3,z=Y-G<=q;if(vt){const W=JSON.stringify($,void 0,2);F?z||De.log("[Tracing] Discarding span since it finished after idle span final timeout",W):De.log("[Tracing] Discarding span since it happened after idle span was finished",W)}(!z||!F)&&(m3e(v,$),U++)}),U>0&&v.setAttribute("sentry.idle_span_discarded_spans",U)}return a.push(m.on("spanStart",k=>{if(r||k===v||on(k).timestamp)return;vw(v).includes(k)&&x(k.spanContext().spanId)})),a.push(m.on("spanEnd",k=>{r||T(k.spanContext().spanId)})),a.push(m.on("idleSpanEnableAutoFinish",k=>{k===v&&(o=!0,S(),n.size&&R())})),e.disableAutoFinish||S(),setTimeout(()=>{r||(v.setStatus({code:bi,message:"deadline_exceeded"}),s=X3e,v.end())},l),v}function Q3e(t){const e=S_(t);return Cb(Ln(),e),vt&&De.log("[Tracing] Started span is an idle span"),e}function mP(t,e,n,r=0){return new ta((i,s)=>{const o=t[r];if(e===null||typeof o!="function")i(e);else{const a=o({...e},n);vt&&o.id&&a===null&&De.log(`Event processor "${o.id}" dropped event`),ET(a)?a.then(c=>mP(t,c,n,r+1).then(i)).then(null,s):mP(t,a,n,r+1).then(i).then(null,s)}})}let F2,fV,$2;function Z3e(t){const e=en._sentryDebugIds;if(!e)return{};const n=Object.keys(e);return $2&&n.length===fV||(fV=n.length,$2=n.reduce((r,i)=>{F2||(F2={});const s=F2[i];if(s)r[s[0]]=s[1];else{const o=t(i);for(let a=o.length-1;a>=0;a--){const c=o[a],l=c&&c.filename,d=e[i];if(l&&d){r[l]=d,F2[i]=[l,d];break}}}return r},{})),$2}function eTe(t,e){const{fingerprint:n,span:r,breadcrumbs:i,sdkProcessingMetadata:s}=e;tTe(t,e),r&&iTe(t,r),sTe(t,n),nTe(t,i),rTe(t,s)}function hV(t,e){const{extra:n,tags:r,user:i,contexts:s,level:o,sdkProcessingMetadata:a,breadcrumbs:c,fingerprint:l,eventProcessors:d,attachments:h,propagationContext:m,transactionName:g,span:y}=e;B2(t,"extra",n),B2(t,"tags",r),B2(t,"user",i),B2(t,"contexts",s),t.sdkProcessingMetadata=wT(t.sdkProcessingMetadata,a,2),o&&(t.level=o),g&&(t.transactionName=g),y&&(t.span=y),c.length&&(t.breadcrumbs=[...t.breadcrumbs,...c]),l.length&&(t.fingerprint=[...t.fingerprint,...l]),d.length&&(t.eventProcessors=[...t.eventProcessors,...d]),h.length&&(t.attachments=[...t.attachments,...h]),t.propagationContext={...t.propagationContext,...m}}function B2(t,e,n){t[e]=wT(t[e],n,1)}function tTe(t,e){const{extra:n,tags:r,user:i,contexts:s,level:o,transactionName:a}=e,c=Hi(n);c&&Object.keys(c).length&&(t.extra={...c,...t.extra});const l=Hi(r);l&&Object.keys(l).length&&(t.tags={...l,...t.tags});const d=Hi(i);d&&Object.keys(d).length&&(t.user={...d,...t.user});const h=Hi(s);h&&Object.keys(h).length&&(t.contexts={...h,...t.contexts}),o&&(t.level=o),a&&t.type!=="transaction"&&(t.transaction=a)}function nTe(t,e){const n=[...t.breadcrumbs||[],...e];t.breadcrumbs=n.length?n:void 0}function rTe(t,e){t.sdkProcessingMetadata={...t.sdkProcessingMetadata,...e}}function iTe(t,e){t.contexts={trace:d3e(e),...t.contexts},t.sdkProcessingMetadata={dynamicSamplingContext:Wv(e),...t.sdkProcessingMetadata};const n=Vi(e),r=on(n).description;r&&!t.transaction&&t.type==="transaction"&&(t.transaction=r)}function sTe(t,e){t.fingerprint=t.fingerprint?Array.isArray(t.fingerprint)?t.fingerprint:[t.fingerprint]:[],e&&(t.fingerprint=t.fingerprint.concat(e)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint}function oTe(t,e,n,r,i,s){const{normalizeDepth:o=3,normalizeMaxBreadth:a=1e3}=t,c={...e,event_id:e.event_id||n.event_id||pa(),timestamp:e.timestamp||__()},l=n.integrations||t.integrations.map(w=>w.name);aTe(c,t),uTe(c,l),i&&i.emit("applyFrameMetadata",e),e.type===void 0&&cTe(c,t.stackParser);const d=fTe(r,n.captureContext);n.mechanism&&uv(c,n.mechanism);const h=i?i.getEventProcessors():[],m=JCe().getScopeData();if(s){const w=s.getScopeData();hV(m,w)}if(d){const w=d.getScopeData();hV(m,w)}const g=[...n.attachments||[],...m.attachments];g.length&&(n.attachments=g),eTe(c,m);const y=[...h,...m.eventProcessors];return mP(y,c,n).then(w=>(w&&lTe(w),typeof o=="number"&&o>0?dTe(w,o,a):w))}function aTe(t,e){const{environment:n,release:r,dist:i,maxValueLength:s=250}=e;t.environment=t.environment||n||X7,!t.release&&r&&(t.release=r),!t.dist&&i&&(t.dist=i),t.message&&(t.message=Dg(t.message,s));const o=t.exception&&t.exception.values&&t.exception.values[0];o&&o.value&&(o.value=Dg(o.value,s));const a=t.request;a&&a.url&&(a.url=Dg(a.url,s))}function cTe(t,e){const n=Z3e(e);try{t.exception.values.forEach(r=>{r.stacktrace.frames.forEach(i=>{n&&i.filename&&(i.debug_id=n[i.filename])})})}catch{}}function lTe(t){const e={};try{t.exception.values.forEach(r=>{r.stacktrace.frames.forEach(i=>{i.debug_id&&(i.abs_path?e[i.abs_path]=i.debug_id:i.filename&&(e[i.filename]=i.debug_id),delete i.debug_id)})})}catch{}if(Object.keys(e).length===0)return;t.debug_meta=t.debug_meta||{},t.debug_meta.images=t.debug_meta.images||[];const n=t.debug_meta.images;Object.entries(e).forEach(([r,i])=>{n.push({type:"sourcemap",code_file:r,debug_id:i})})}function uTe(t,e){e.length>0&&(t.sdk=t.sdk||{},t.sdk.integrations=[...t.sdk.integrations||[],...e])}function dTe(t,e,n){if(!t)return null;const r={...t,...t.breadcrumbs&&{breadcrumbs:t.breadcrumbs.map(i=>({...i,...i.data&&{data:Wl(i.data,e,n)}}))},...t.user&&{user:Wl(t.user,e,n)},...t.contexts&&{contexts:Wl(t.contexts,e,n)},...t.extra&&{extra:Wl(t.extra,e,n)}};return t.contexts&&t.contexts.trace&&r.contexts&&(r.contexts.trace=t.contexts.trace,t.contexts.trace.data&&(r.contexts.trace.data=Wl(t.contexts.trace.data,e,n))),t.spans&&(r.spans=t.spans.map(i=>({...i,...i.data&&{data:Wl(i.data,e,n)}}))),t.contexts&&t.contexts.flags&&r.contexts&&(r.contexts.flags=Wl(t.contexts.flags,3,n)),r}function fTe(t,e){if(!e)return t;const n=t?t.clone():new yf;return n.update(e),n}function hTe(t){if(t)return pTe(t)?{captureContext:t}:gTe(t)?{captureContext:t}:t}function pTe(t){return t instanceof yf||typeof t=="function"}const mTe=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function gTe(t){return Object.keys(t).some(e=>mTe.includes(e))}function IT(t,e){return Ln().captureException(t,hTe(e))}function vTe(t,e){const r={captureContext:e};return Ln().captureMessage(t,void 0,r)}function Ote(t,e){return Ln().captureEvent(t,e)}function yTe(t,e){pl().setContext(t,e)}function bTe(){return pl().lastEventId()}function _Te(){const t=cn();return!!t&&t.getOptions().enabled!==!1&&!!t.getTransport()}function pV(t){const e=cn(),n=pl(),r=Ln(),{release:i,environment:s=X7}=e&&e.getOptions()||{},{userAgent:o}=en.navigator||{},a=BCe({release:i,environment:s,user:r.getUser()||n.getUser(),...o&&{userAgent:o},...t}),c=n.getSession();return c&&c.status==="ok"&&dv(c,{status:"exited"}),Mte(),n.setSession(a),r.setSession(a),a}function Mte(){const t=pl(),e=Ln(),n=e.getSession()||t.getSession();n&&HCe(n),Dte(),t.setSession(),e.setSession()}function Dte(){const t=pl(),e=Ln(),n=cn(),r=e.getSession()||t.getSession();r&&n&&n.captureSession(r)}function mV(t=!1){if(t){Mte();return}Dte()}const STe="7";function Nte(t){const e=t.protocol?`${t.protocol}:`:"",n=t.port?`:${t.port}`:"";return`${e}//${t.host}${n}${t.path?`/${t.path}`:""}/api/`}function ETe(t){return`${Nte(t)}${t.projectId}/envelope/`}function wTe(t,e){const n={sentry_version:STe};return t.publicKey&&(n.sentry_key=t.publicKey),e&&(n.sentry_client=`${e.name}/${e.version}`),new URLSearchParams(n).toString()}function CTe(t,e,n){return e||`${ETe(t)}?${wTe(t,n)}`}function TTe(t,e){const n=Rte(t);if(!n)return"";const r=`${Nte(n)}embed/error-page/`;let i=`dsn=${Yv(n)}`;for(const s in e)if(s!=="dsn"&&s!=="onClose")if(s==="user"){const o=e.user;if(!o)continue;o.name&&(i+=`&name=${encodeURIComponent(o.name)}`),o.email&&(i+=`&email=${encodeURIComponent(o.email)}`)}else i+=`&${encodeURIComponent(s)}=${encodeURIComponent(e[s])}`;return`${r}?${i}`}const gV=[];function RTe(t){const e={};return t.forEach(n=>{const{name:r}=n,i=e[r];i&&!i.isDefaultInstance&&n.isDefaultInstance||(e[r]=n)}),Object.values(e)}function ITe(t){const e=t.defaultIntegrations||[],n=t.integrations;e.forEach(o=>{o.isDefaultInstance=!0});let r;if(Array.isArray(n))r=[...e,...n];else if(typeof n=="function"){const o=n(e);r=Array.isArray(o)?o:[o]}else r=e;const i=RTe(r),s=i.findIndex(o=>o.name==="Debug");if(s>-1){const[o]=i.splice(s,1);i.push(o)}return i}function kTe(t,e){const n={};return e.forEach(r=>{r&&Ute(t,r,n)}),n}function vV(t,e){for(const n of e)n&&n.afterAllSetup&&n.afterAllSetup(t)}function Ute(t,e,n){if(n[e.name]){vt&&De.log(`Integration skipped because it was already installed: ${e.name}`);return}if(n[e.name]=e,gV.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),gV.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(t),typeof e.preprocessEvent=="function"){const r=e.preprocessEvent.bind(e);t.on("preprocessEvent",(i,s)=>r(i,s,t))}if(typeof e.processEvent=="function"){const r=e.processEvent.bind(e),i=Object.assign((s,o)=>r(s,o,t),{id:e.name});t.addEventProcessor(i)}vt&&De.log(`Integration installed: ${e.name}`)}function xTe(t,e,n){const r=[{type:"client_report"},{timestamp:__(),discarded_events:t}];return Xv(e?{dsn:e}:{},[r])}class za extends Error{constructor(e,n="warn"){super(e),this.message=e,this.logLevel=n}}const yV="Not capturing exception because it's already been captured.";class ATe{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=Rte(e.dsn):vt&&De.warn("No DSN provided, client will not send events."),this._dsn){const i=CTe(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:i})}const r=["enableTracing","tracesSampleRate","tracesSampler"].find(i=>i in e&&e[i]==null);r&&Tp(()=>{console.warn(`[Sentry] Deprecation warning: \`${r}\` is set to undefined, which leads to tracing being enabled. In v9, a value of \`undefined\` will result in tracing being disabled.`)})}captureException(e,n,r){const i=pa();if(XH(e))return vt&&De.log(yV),i;const s={event_id:i,...n};return this._process(this.eventFromException(e,s).then(o=>this._captureEvent(o,s,r))),s.event_id}captureMessage(e,n,r,i){const s={event_id:pa(),...r},o=q7(e)?e:String(e),a=G7(e)?this.eventFromMessage(o,n,s):this.eventFromException(e,s);return this._process(a.then(c=>this._captureEvent(c,s,i))),s.event_id}captureEvent(e,n,r){const i=pa();if(n&&n.originalException&&XH(n.originalException))return vt&&De.log(yV),i;const s={event_id:i,...n},a=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,s,a||r)),s.event_id}captureSession(e){typeof e.release!="string"?vt&&De.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),dv(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const n=this._transport;return n?(this.emit("flush"),this._isClientDoneProcessing(e).then(r=>n.flush(e).then(i=>r&&i))):op(!0)}close(e){return this.flush(e).then(n=>(this.getOptions().enabled=!1,this.emit("close"),n))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const n=this._integrations[e.name];Ute(this,e,this._integrations),n||vV(this,[e])}sendEvent(e,n={}){this.emit("beforeSendEvent",e,n);let r=F3e(e,this._dsn,this._options._metadata,this._options.tunnel);for(const s of n.attachments||[])r=A3e(r,M3e(s));const i=this.sendEnvelope(r);i&&i.then(s=>this.emit("afterSendEvent",e,s),null)}sendSession(e){const n=j3e(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(n)}recordDroppedEvent(e,n,r){if(this._options.sendClientReports){const i=typeof r=="number"?r:1,s=`${e}:${n}`;vt&&De.log(`Recording outcome: "${s}"${i>1?` (${i} times)`:""}`),this._outcomes[s]=(this._outcomes[s]||0)+i}}on(e,n){const r=this._hooks[e]=this._hooks[e]||[];return r.push(n),()=>{const i=r.indexOf(n);i>-1&&r.splice(i,1)}}emit(e,...n){const r=this._hooks[e];r&&r.forEach(i=>i(...n))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,n=>(vt&&De.error("Error while sending envelope:",n),n)):(vt&&De.error("Transport disabled"),op({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=kTe(this,e),vV(this,e)}_updateSessionFromEvent(e,n){let r=n.level==="fatal",i=!1;const s=n.exception&&n.exception.values;if(s){i=!0;for(const c of s){const l=c.mechanism;if(l&&l.handled===!1){r=!0;break}}}const o=e.status==="ok";(o&&e.errors===0||o&&r)&&(dv(e,{...r&&{status:"crashed"},errors:e.errors||Number(i||r)}),this.captureSession(e))}_isClientDoneProcessing(e){return new ta(n=>{let r=0;const i=1,s=setInterval(()=>{this._numProcessing==0?(clearInterval(s),n(!0)):(r+=i,e&&r>=e&&(clearInterval(s),n(!1)))},i)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,n,r=Ln(),i=pl()){const s=this.getOptions(),o=Object.keys(this._integrations);return!n.integrations&&o.length>0&&(n.integrations=o),this.emit("preprocessEvent",e,n),e.type||i.setLastEventId(e.event_id||n.event_id),oTe(s,e,n,r,this,i).then(a=>{if(a===null)return a;a.contexts={trace:QCe(r),...a.contexts};const c=wte(this,r);return a.sdkProcessingMetadata={dynamicSamplingContext:c,...a.sdkProcessingMetadata},a})}_captureEvent(e,n={},r){return this._processEvent(e,n,r).then(i=>i.event_id,i=>{vt&&(i instanceof za&&i.logLevel==="log"?De.log(i.message):De.warn(i))})}_processEvent(e,n,r){const i=this.getOptions(),{sampleRate:s}=i,o=Fte(e),a=jte(e),c=e.type||"error",l=`before send for type \`${c}\``,d=typeof s>"u"?void 0:Cte(s);if(a&&typeof d=="number"&&Math.random()>d)return this.recordDroppedEvent("sample_rate","error",e),MC(new za(`Discarding event because it's not included in the random sample (sampling rate = ${s})`,"log"));const h=c==="replay_event"?"replay":c,g=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,n,r,g).then(y=>{if(y===null)throw this.recordDroppedEvent("event_processor",h,e),new za("An event processor returned `null`, will not send event.","log");if(n.data&&n.data.__sentry__===!0)return y;const w=LTe(this,i,y,n);return PTe(w,l)}).then(y=>{if(y===null){if(this.recordDroppedEvent("before_send",h,e),o){const R=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",R)}throw new za(`${l} returned \`null\`, will not send event.`,"log")}const v=r&&r.getSession();if(!o&&v&&this._updateSessionFromEvent(v,y),o){const S=y.sdkProcessingMetadata&&y.sdkProcessingMetadata.spanCountBeforeProcessing||0,R=y.spans?y.spans.length:0,x=S-R;x>0&&this.recordDroppedEvent("before_send","span",x)}const w=y.transaction_info;if(o&&w&&y.transaction!==e.transaction){const S="custom";y.transaction_info={...w,source:S}}return this.sendEvent(y,n),y}).then(null,y=>{throw y instanceof za?y:(this.captureException(y,{data:{__sentry__:!0},originalException:y}),new za(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${y}`))})}_process(e){this._numProcessing++,e.then(n=>(this._numProcessing--,n),n=>(this._numProcessing--,n))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([n,r])=>{const[i,s]=n.split(":");return{reason:i,category:s,quantity:r}})}_flushOutcomes(){vt&&De.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0){vt&&De.log("No outcomes to send");return}if(!this._dsn){vt&&De.log("No dsn provided, will not send outcomes");return}vt&&De.log("Sending outcomes:",e);const n=xTe(e,this._options.tunnel&&Yv(this._dsn));this.sendEnvelope(n)}}function PTe(t,e){const n=`${e} must return \`null\` or a valid event.`;if(ET(t))return t.then(r=>{if(!lv(r)&&r!==null)throw new za(n);return r},r=>{throw new za(`${e} rejected with ${r}`)});if(!lv(t)&&t!==null)throw new za(n);return t}function LTe(t,e,n,r){const{beforeSend:i,beforeSendTransaction:s,beforeSendSpan:o}=e;if(jte(n)&&i)return i(n,r);if(Fte(n)){if(n.spans&&o){const a=[];for(const c of n.spans){const l=o(c);l?a.push(l):(yte(),t.recordDroppedEvent("before_send","span"))}n.spans=a}if(s){if(n.spans){const a=n.spans.length;n.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:a}}return s(n,r)}}return n}function jte(t){return t.type===void 0}function Fte(t){return t.type==="transaction"}function OTe(t,e){e.debug===!0&&(vt?De.enable():Tp(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),Ln().update(e.initialScope);const r=new t(e);return MTe(r),r.init(),r}function MTe(t){Ln().setClient(t)}function DTe(t){const e=[];function n(){return t===void 0||e.length<t}function r(o){return e.splice(e.indexOf(o),1)[0]||Promise.resolve(void 0)}function i(o){if(!n())return MC(new za("Not adding Promise because buffer limit was reached."));const a=o();return e.indexOf(a)===-1&&e.push(a),a.then(()=>r(a)).then(null,()=>r(a).then(null,()=>{})),a}function s(o){return new ta((a,c)=>{let l=e.length;if(!l)return a(!0);const d=setTimeout(()=>{o&&o>0&&a(!1)},o);e.forEach(h=>{op(h).then(()=>{--l||(clearTimeout(d),a(!0))},c)})})}return{$:e,add:i,drain:s}}const NTe=60*1e3;function UTe(t,e=Date.now()){const n=parseInt(`${t}`,10);if(!isNaN(n))return n*1e3;const r=Date.parse(`${t}`);return isNaN(r)?NTe:r-e}function jTe(t,e){return t[e]||t.all||0}function FTe(t,e,n=Date.now()){return jTe(t,e)>n}function $Te(t,{statusCode:e,headers:n},r=Date.now()){const i={...t},s=n&&n["x-sentry-rate-limits"],o=n&&n["retry-after"];if(s)for(const a of s.trim().split(",")){const[c,l,,,d]=a.split(":",5),h=parseInt(c,10),m=(isNaN(h)?60:h)*1e3;if(!l)i.all=r+m;else for(const g of l.split(";"))g==="metric_bucket"?(!d||d.split(";").includes("custom"))&&(i[g]=r+m):i[g]=r+m}else o?i.all=r+UTe(o,r):e===429&&(i.all=r+60*1e3);return i}const BTe=64;function HTe(t,e,n=DTe(t.bufferSize||BTe)){let r={};const i=o=>n.drain(o);function s(o){const a=[];if(sV(o,(h,m)=>{const g=oV(m);if(FTe(r,g)){const y=bV(h,m);t.recordDroppedEvent("ratelimit_backoff",g,y)}else a.push(h)}),a.length===0)return op({});const c=Xv(o[0],a),l=h=>{sV(c,(m,g)=>{const y=bV(m,g);t.recordDroppedEvent(h,oV(g),y)})},d=()=>e({body:P3e(c)}).then(h=>(h.statusCode!==void 0&&(h.statusCode<200||h.statusCode>=300)&&vt&&De.warn(`Sentry responded with status code ${h.statusCode} to sent event.`),r=$Te(r,h),h),h=>{throw l("network_error"),h});return n.add(d).then(h=>h,h=>{if(h instanceof za)return vt&&De.error("Skipped sending event because buffer is full."),l("queue_overflow"),op({});throw h})}return{send:s,flush:i}}function bV(t,e){if(!(e!=="event"&&e!=="transaction"))return Array.isArray(t)?t[1]:void 0}function $te(t,e,n=[e],r="npm"){const i=t._metadata||{};i.sdk||(i.sdk={name:`sentry.javascript.${e}`,packages:n.map(s=>({name:`${r}:@sentry/${s}`,version:Gh})),version:Gh}),t._metadata=i}function Bte(t={}){const e=cn();if(!_Te()||!e)return{};const n=Rp(),r=Kv(n);if(r.getTraceData)return r.getTraceData(t);const i=Ln(),s=t.span||Ki(),o=s?f3e(s):VTe(i),a=s?Wv(s):wte(e,i),c=s3e(a);return fte.test(o)?{"sentry-trace":o,baggage:c}:(De.warn("Invalid sentry-trace data. Cannot generate trace data"),{})}function VTe(t){const{traceId:e,sampled:n,spanId:r}=t.getPropagationContext();return hte(e,r,n)}const qTe=100;function ap(t,e){const n=cn(),r=pl();if(!n)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:s=qTe}=n.getOptions();if(s<=0)return;const a={timestamp:__(),...t},c=i?Tp(()=>i(a,e)):a;c!==null&&(n.emit&&n.emit("beforeAddBreadcrumb",c,e),r.addBreadcrumb(c,s))}let _V;const GTe="FunctionToString",SV=new WeakMap,KTe=()=>({name:GTe,setupOnce(){_V=Function.prototype.toString;try{Function.prototype.toString=function(...t){const e=K7(this),n=SV.has(cn())&&e!==void 0?e:this;return _V.apply(n,t)}}catch{}},setup(t){SV.set(t,!0)}}),zTe=KTe,WTe=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/],YTe="InboundFilters",XTe=(t={})=>({name:YTe,processEvent(e,n,r){const i=r.getOptions(),s=QTe(t,i);return ZTe(e,s)?null:e}}),JTe=XTe;function QTe(t={},e={}){return{allowUrls:[...t.allowUrls||[],...e.allowUrls||[]],denyUrls:[...t.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...t.ignoreErrors||[],...e.ignoreErrors||[],...t.disableErrorDefaults?[]:WTe],ignoreTransactions:[...t.ignoreTransactions||[],...e.ignoreTransactions||[]],ignoreInternal:t.ignoreInternal!==void 0?t.ignoreInternal:!0}}function ZTe(t,e){return e.ignoreInternal&&sRe(t)?(vt&&De.warn(`Event dropped due to being internal Sentry Error.
Event: ${Nd(t)}`),!0):eRe(t,e.ignoreErrors)?(vt&&De.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${Nd(t)}`),!0):aRe(t)?(vt&&De.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${Nd(t)}`),!0):tRe(t,e.ignoreTransactions)?(vt&&De.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${Nd(t)}`),!0):nRe(t,e.denyUrls)?(vt&&De.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${Nd(t)}.
Url: ${NC(t)}`),!0):rRe(t,e.allowUrls)?!1:(vt&&De.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${Nd(t)}.
Url: ${NC(t)}`),!0)}function eRe(t,e){return t.type||!e||!e.length?!1:iRe(t).some(n=>Kh(n,e))}function tRe(t,e){if(t.type!=="transaction"||!e||!e.length)return!1;const n=t.transaction;return n?Kh(n,e):!1}function nRe(t,e){if(!e||!e.length)return!1;const n=NC(t);return n?Kh(n,e):!1}function rRe(t,e){if(!e||!e.length)return!0;const n=NC(t);return n?Kh(n,e):!0}function iRe(t){const e=[];t.message&&e.push(t.message);let n;try{n=t.exception.values[t.exception.values.length-1]}catch{}return n&&n.value&&(e.push(n.value),n.type&&e.push(`${n.type}: ${n.value}`)),e}function sRe(t){try{return t.exception.values[0].type==="SentryError"}catch{}return!1}function oRe(t=[]){for(let e=t.length-1;e>=0;e--){const n=t[e];if(n&&n.filename!=="<anonymous>"&&n.filename!=="[native code]")return n.filename||null}return null}function NC(t){try{let e;try{e=t.exception.values[0].stacktrace.frames}catch{}return e?oRe(e):null}catch{return vt&&De.error(`Cannot extract url for event ${Nd(t)}`),null}}function aRe(t){return t.type||!t.exception||!t.exception.values||t.exception.values.length===0?!1:!t.message&&!t.exception.values.some(e=>e.stacktrace||e.type&&e.type!=="Error"||e.value)}function cRe(t,e,n=250,r,i,s,o){if(!s.exception||!s.exception.values||!o||!Lu(o.originalException,Error))return;const a=s.exception.values.length>0?s.exception.values[s.exception.values.length-1]:void 0;a&&(s.exception.values=lRe(gP(t,e,i,o.originalException,r,s.exception.values,a,0),n))}function gP(t,e,n,r,i,s,o,a){if(s.length>=n+1)return s;let c=[...s];if(Lu(r[i],Error)){EV(o,a);const l=t(e,r[i]),d=c.length;wV(l,i,d,a),c=gP(t,e,n,r[i],i,[l,...c],l,d)}return Array.isArray(r.errors)&&r.errors.forEach((l,d)=>{if(Lu(l,Error)){EV(o,a);const h=t(e,l),m=c.length;wV(h,`errors[${d}]`,m,a),c=gP(t,e,n,l,i,[h,...c],h,m)}}),c}function EV(t,e){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,...t.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function wV(t,e,n,r){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,type:"chained",source:e,exception_id:n,parent_id:r}}function lRe(t,e){return t.map(n=>(n.value&&(n.value=Dg(n.value,e)),n))}function Yh(t){if(!t)return{};const e=t.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const n=e[6]||"",r=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:n,hash:r,relative:e[5]+n+r}}function CV(t){return t.split(/\\?\//).filter(e=>e.length>0&&e!==",").length}function uRe(t){const e="console";Nf(e,t),Uf(e,dRe)}function dRe(){"console"in en&&sP.forEach(function(t){t in en.console&&Co(en.console,t,function(e){return OC[t]=e,function(...n){ha("console",{args:n,level:t});const i=OC[t];i&&i.apply(en.console,n)}})})}function fRe(t){return t==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(t)?t:"log"}const hRe="Dedupe",pRe=()=>{let t;return{name:hRe,processEvent(e){if(e.type)return e;try{if(gRe(e,t))return vt&&De.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return t=e}}},mRe=pRe;function gRe(t,e){return e?!!(vRe(t,e)||yRe(t,e)):!1}function vRe(t,e){const n=t.message,r=e.message;return!(!n&&!r||n&&!r||!n&&r||n!==r||!Vte(t,e)||!Hte(t,e))}function yRe(t,e){const n=TV(e),r=TV(t);return!(!n||!r||n.type!==r.type||n.value!==r.value||!Vte(t,e)||!Hte(t,e))}function Hte(t,e){let n=qH(t),r=qH(e);if(!n&&!r)return!0;if(n&&!r||!n&&r||(n=n,r=r,r.length!==n.length))return!1;for(let i=0;i<r.length;i++){const s=r[i],o=n[i];if(s.filename!==o.filename||s.lineno!==o.lineno||s.colno!==o.colno||s.function!==o.function)return!1}return!0}function Vte(t,e){let n=t.fingerprint,r=e.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;n=n,r=r;try{return n.join("")===r.join("")}catch{return!1}}function TV(t){return t.exception&&t.exception.values&&t.exception.values[0]}function bRe(t,e,n,r,i="auto.http.browser"){if(!t.fetchData)return;const s=bf()&&e(t.fetchData.url);if(t.endTimestamp&&s){const m=t.fetchData.__span;if(!m)return;const g=r[m];g&&(ERe(g,t),delete r[m]);return}const{method:o,url:a}=t.fetchData,c=SRe(a),l=c?Yh(c).host:void 0,d=!!Ki(),h=s&&d?S_({name:`${o} ${a}`,attributes:{url:a,type:"fetch","http.method":o,"http.url":c,"server.address":l,[qr]:i,[Ou]:"http.client"}}):new zv;if(t.fetchData.__span=h.spanContext().spanId,r[h.spanContext().spanId]=h,n(t.fetchData.url)){const m=t.args[0],g=t.args[1]||{},y=_Re(m,g,bf()&&d?h:void 0);y&&(t.args[1]=g,g.headers=y)}return h}function _Re(t,e,n){const r=Bte({span:n}),i=r["sentry-trace"],s=r.baggage;if(!i)return;const o=e.headers||(wRe(t)?t.headers:void 0);if(o)if(CRe(o)){const a=new Headers(o);if(a.set("sentry-trace",i),s){const c=a.get("baggage");if(c){const l=H2(c);a.set("baggage",l?`${l},${s}`:s)}else a.set("baggage",s)}return a}else if(Array.isArray(o)){const a=[...o.filter(c=>!(Array.isArray(c)&&c[0]==="sentry-trace")).map(c=>{if(Array.isArray(c)&&c[0]==="baggage"&&typeof c[1]=="string"){const[l,d,...h]=c;return[l,H2(d),...h]}else return c}),["sentry-trace",i]];return s&&a.push(["baggage",s]),a}else{const a="baggage"in o?o.baggage:void 0;let c=[];return Array.isArray(a)?c=a.map(l=>typeof l=="string"?H2(l):l).filter(l=>l===""):a&&c.push(H2(a)),s&&c.push(s),{...o,"sentry-trace":i,baggage:c.length>0?c.join(","):void 0}}else return{...r}}function SRe(t){try{return new URL(t).href}catch{return}}function ERe(t,e){if(e.response){ute(t,e.response.status);const n=e.response&&e.response.headers&&e.response.headers.get("content-length");if(n){const r=parseInt(n);r>0&&t.setAttribute("http.response_content_length",r)}}else e.error&&t.setStatus({code:bi,message:"internal_error"});t.end()}function H2(t){return t.split(",").filter(e=>!e.split("=")[0].startsWith(Y7)).join(",")}function wRe(t){return typeof Request<"u"&&Lu(t,Request)}function CRe(t){return typeof Headers<"u"&&Lu(t,Headers)}function qte(t){if(t!==void 0)return t>=400&&t<500?"warning":t>=500?"error":void 0}const vP=en;function Gte(){if(!("fetch"in vP))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function yP(t){return t&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(t.toString())}function TRe(){if(typeof EdgeRuntime=="string")return!0;if(!Gte())return!1;if(yP(vP.fetch))return!0;let t=!1;const e=vP.document;if(e&&typeof e.createElement=="function")try{const n=e.createElement("iframe");n.hidden=!0,e.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(t=yP(n.contentWindow.fetch)),e.head.removeChild(n)}catch(n){Df&&De.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",n)}return t}function Kte(t,e){const n="fetch";Nf(n,t),Uf(n,()=>zte(void 0,e))}function RRe(t){const e="fetch-body-resolved";Nf(e,t),Uf(e,()=>zte(kRe))}function zte(t,e=!1){e&&!TRe()||Co(en,"fetch",function(n){return function(...r){const i=new Error,{method:s,url:o}=xRe(r),a={args:r,fetchData:{method:s,url:o},startTimestamp:vs()*1e3,virtualError:i};return t||ha("fetch",{...a}),n.apply(en,r).then(async c=>(t?t(c):ha("fetch",{...a,endTimestamp:vs()*1e3,response:c}),c),c=>{throw ha("fetch",{...a,endTimestamp:vs()*1e3,error:c}),_T(c)&&c.stack===void 0&&(c.stack=i.stack,_a(c,"framesToPop",1)),c})}})}async function IRe(t,e){if(t&&t.body){const n=t.body,r=n.getReader(),i=setTimeout(()=>{n.cancel().then(null,()=>{})},90*1e3);let s=!0;for(;s;){let o;try{o=setTimeout(()=>{n.cancel().then(null,()=>{})},5e3);const{done:a}=await r.read();clearTimeout(o),a&&(e(),s=!1)}catch{s=!1}finally{clearTimeout(o)}}clearTimeout(i),r.releaseLock(),n.cancel().then(null,()=>{})}}function kRe(t){let e;try{e=t.clone()}catch{return}IRe(e,()=>{ha("fetch-body-resolved",{endTimestamp:vs()*1e3,response:t})})}function bP(t,e){return!!t&&typeof t=="object"&&!!t[e]}function RV(t){return typeof t=="string"?t:t?bP(t,"url")?t.url:t.toString?t.toString():"":""}function xRe(t){if(t.length===0)return{method:"GET",url:""};if(t.length===2){const[n,r]=t;return{url:RV(n),method:bP(r,"method")?String(r.method).toUpperCase():"GET"}}const e=t[0];return{url:RV(e),method:bP(e,"method")?String(e.method).toUpperCase():"GET"}}function ARe(){return"npm"}const V2=en;function PRe(){const t=V2.chrome,e=t&&t.app&&t.app.runtime,n="history"in V2&&!!V2.history.pushState&&!!V2.history.replaceState;return!e&&n}const Ze=en;let _P=0;function Wte(){return _P>0}function LRe(){_P++,setTimeout(()=>{_P--})}function hv(t,e={}){function n(i){return typeof i=="function"}if(!n(t))return t;try{const i=t.__sentry_wrapped__;if(i)return typeof i=="function"?i:t;if(K7(t))return t}catch{return t}const r=function(...i){try{const s=i.map(o=>hv(o,e));return t.apply(this,s)}catch(s){throw LRe(),CT(o=>{o.addEventProcessor(a=>(e.mechanism&&(aP(a,void 0),uv(a,e.mechanism)),a.extra={...a.extra,arguments:i},a)),IT(s)}),s}};try{for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}catch{}ite(r,t),_a(t,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get(){return t.name}})}catch{}return r}const Ro=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function Q7(t,e){const n=Z7(t,e),r={type:URe(e),value:jRe(e)};return n.length&&(r.stacktrace={frames:n}),r.type===void 0&&r.value===""&&(r.value="Unrecoverable error caught"),r}function ORe(t,e,n,r){const i=cn(),s=i&&i.getOptions().normalizeDepth,o=VRe(e),a={__serialized__:Ite(e,s)};if(o)return{exception:{values:[Q7(t,o)]},extra:a};const c={exception:{values:[{type:ST(e)?e.constructor.name:r?"UnhandledRejection":"Error",value:BRe(e,{isUnhandledRejection:r})}]},extra:a};if(n){const l=Z7(t,n);l.length&&(c.exception.values[0].stacktrace={frames:l})}return c}function y6(t,e){return{exception:{values:[Q7(t,e)]}}}function Z7(t,e){const n=e.stacktrace||e.stack||"",r=DRe(e),i=NRe(e);try{return t(n,r,i)}catch{}return[]}const MRe=/Minified React error #\d+;/i;function DRe(t){return t&&MRe.test(t.message)?1:0}function NRe(t){return typeof t.framesToPop=="number"?t.framesToPop:0}function Yte(t){return typeof WebAssembly<"u"&&typeof WebAssembly.Exception<"u"?t instanceof WebAssembly.Exception:!1}function URe(t){const e=t&&t.name;return!e&&Yte(t)?t.message&&Array.isArray(t.message)&&t.message.length==2?t.message[0]:"WebAssembly.Exception":e}function jRe(t){const e=t&&t.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:Yte(t)&&Array.isArray(t.message)&&t.message.length==2?t.message[1]:e:"No error message"}function FRe(t,e,n,r){const i=n&&n.syntheticException||void 0,s=eM(t,e,i,r);return uv(s),s.level="error",n&&n.event_id&&(s.event_id=n.event_id),op(s)}function $Re(t,e,n="info",r,i){const s=r&&r.syntheticException||void 0,o=SP(t,e,s,i);return o.level=n,r&&r.event_id&&(o.event_id=r.event_id),op(o)}function eM(t,e,n,r,i){let s;if(tte(e)&&e.error)return y6(t,e.error);if(KH(e)||kCe(e)){const o=e;if("stack"in e)s=y6(t,e);else{const a=o.name||(KH(o)?"DOMError":"DOMException"),c=o.message?`${a}: ${o.message}`:a;s=SP(t,c,n,r),aP(s,c)}return"code"in o&&(s.tags={...s.tags,"DOMException.code":`${o.code}`}),s}return _T(e)?y6(t,e):lv(e)||ST(e)?(s=ORe(t,e,n,i),uv(s,{synthetic:!0}),s):(s=SP(t,e,n,r),aP(s,`${e}`),uv(s,{synthetic:!0}),s)}function SP(t,e,n,r){const i={};if(r&&n){const s=Z7(t,n);s.length&&(i.exception={values:[{value:e,stacktrace:{frames:s}}]}),uv(i,{synthetic:!0})}if(q7(e)){const{__sentry_template_string__:s,__sentry_template_values__:o}=e;return i.logentry={message:s,params:o},i}return i.message=e,i}function BRe(t,{isUnhandledRejection:e}){const n=UCe(t),r=e?"promise rejection":"exception";return tte(t)?`Event \`ErrorEvent\` captured as ${r} with message \`${t.message}\``:ST(t)?`Event \`${HRe(t)}\` (type=${t.type}) captured as ${r}`:`Object captured as ${r} with keys: ${n}`}function HRe(t){try{const e=Object.getPrototypeOf(t);return e?e.constructor.name:void 0}catch{}}function VRe(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const n=t[e];if(n instanceof Error)return n}}function qRe(t,{metadata:e,tunnel:n,dsn:r}){const i={event_id:t.event_id,sent_at:new Date().toISOString(),...e&&e.sdk&&{sdk:{name:e.sdk.name,version:e.sdk.version}},...!!n&&!!r&&{dsn:Yv(r)}},s=GRe(t);return Xv(i,[s])}function GRe(t){return[{type:"user_report"},t]}class KRe extends ATe{constructor(e){const n={parentSpanIsAlwaysRootSpan:!0,...e},r=Ze.SENTRY_SDK_SOURCE||ARe();$te(n,"browser",["browser"],r),super(n),n.sendClientReports&&Ze.document&&Ze.document.addEventListener("visibilitychange",()=>{Ze.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(e,n){return FRe(this._options.stackParser,e,n,this._options.attachStacktrace)}eventFromMessage(e,n="info",r){return $Re(this._options.stackParser,e,n,r,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled()){Ro&&De.warn("SDK not enabled, will not capture user feedback.");return}const n=qRe(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(n)}_prepareEvent(e,n,r){return e.platform=e.platform||"javascript",super._prepareEvent(e,n,r)}}const tM=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,zRe=(t,e)=>t>e[1]?"poor":t>e[0]?"needs-improvement":"good",Jv=(t,e,n,r)=>{let i,s;return o=>{e.value>=0&&(o||r)&&(s=e.value-(i||0),(s||i===void 0)&&(i=e.value,e.delta=s,e.rating=zRe(e.value,n),t(e)))}},st=en,WRe=()=>`v4-${Date.now()}-${Math.floor(Math.random()*(9e12-1))+1e12}`,E_=(t=!0)=>{const e=st.performance&&st.performance.getEntriesByType&&st.performance.getEntriesByType("navigation")[0];if(!t||e&&e.responseStart>0&&e.responseStart<performance.now())return e},w_=()=>{const t=E_();return t&&t.activationStart||0},Qv=(t,e)=>{const n=E_();let r="navigate";return n&&(st.document&&st.document.prerendering||w_()>0?r="prerender":st.document&&st.document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:t,value:typeof e>"u"?-1:e,rating:"good",delta:0,entries:[],id:WRe(),navigationType:r}},kp=(t,e,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const r=new PerformanceObserver(i=>{Promise.resolve().then(()=>{e(i.getEntries())})});return r.observe(Object.assign({type:t,buffered:!0},n||{})),r}}catch{}},Zv=t=>{const e=n=>{(n.type==="pagehide"||st.document&&st.document.visibilityState==="hidden")&&t(n)};st.document&&(addEventListener("visibilitychange",e,!0),addEventListener("pagehide",e,!0))},kT=t=>{let e=!1;return()=>{e||(t(),e=!0)}};let My=-1;const YRe=()=>st.document.visibilityState==="hidden"&&!st.document.prerendering?0:1/0,UC=t=>{st.document.visibilityState==="hidden"&&My>-1&&(My=t.type==="visibilitychange"?t.timeStamp:0,JRe())},XRe=()=>{addEventListener("visibilitychange",UC,!0),addEventListener("prerenderingchange",UC,!0)},JRe=()=>{removeEventListener("visibilitychange",UC,!0),removeEventListener("prerenderingchange",UC,!0)},xT=()=>(st.document&&My<0&&(My=YRe(),XRe()),{get firstHiddenTime(){return My}}),C_=t=>{st.document&&st.document.prerendering?addEventListener("prerenderingchange",()=>t(),!0):t()},QRe=[1800,3e3],ZRe=(t,e={})=>{C_(()=>{const n=xT(),r=Qv("FCP");let i;const o=kp("paint",a=>{a.forEach(c=>{c.name==="first-contentful-paint"&&(o.disconnect(),c.startTime<n.firstHiddenTime&&(r.value=Math.max(c.startTime-w_(),0),r.entries.push(c),i(!0)))})});o&&(i=Jv(t,r,QRe,e.reportAllChanges))})},e4e=[.1,.25],t4e=(t,e={})=>{ZRe(kT(()=>{const n=Qv("CLS",0);let r,i=0,s=[];const o=c=>{c.forEach(l=>{if(!l.hadRecentInput){const d=s[0],h=s[s.length-1];i&&d&&h&&l.startTime-h.startTime<1e3&&l.startTime-d.startTime<5e3?(i+=l.value,s.push(l)):(i=l.value,s=[l])}}),i>n.value&&(n.value=i,n.entries=s,r())},a=kp("layout-shift",o);a&&(r=Jv(t,n,e4e,e.reportAllChanges),Zv(()=>{o(a.takeRecords()),r(!0)}),setTimeout(r,0))}))},n4e=[100,300],r4e=(t,e={})=>{C_(()=>{const n=xT(),r=Qv("FID");let i;const s=c=>{c.startTime<n.firstHiddenTime&&(r.value=c.processingStart-c.startTime,r.entries.push(c),i(!0))},o=c=>{c.forEach(s)},a=kp("first-input",o);i=Jv(t,r,n4e,e.reportAllChanges),a&&Zv(kT(()=>{o(a.takeRecords()),a.disconnect()}))})};let Xte=0,b6=1/0,q2=0;const i4e=t=>{t.forEach(e=>{e.interactionId&&(b6=Math.min(b6,e.interactionId),q2=Math.max(q2,e.interactionId),Xte=q2?(q2-b6)/7+1:0)})};let EP;const s4e=()=>EP?Xte:performance.interactionCount||0,o4e=()=>{"interactionCount"in performance||EP||(EP=kp("event",i4e,{type:"event",buffered:!0,durationThreshold:0}))},Yl=[],_6=new Map,a4e=40;let c4e=0;const l4e=()=>s4e()-c4e,u4e=()=>{const t=Math.min(Yl.length-1,Math.floor(l4e()/50));return Yl[t]},S6=10,d4e=[],f4e=t=>{if(d4e.forEach(r=>r(t)),!(t.interactionId||t.entryType==="first-input"))return;const e=Yl[Yl.length-1],n=_6.get(t.interactionId);if(n||Yl.length<S6||e&&t.duration>e.latency){if(n)t.duration>n.latency?(n.entries=[t],n.latency=t.duration):t.duration===n.latency&&t.startTime===(n.entries[0]&&n.entries[0].startTime)&&n.entries.push(t);else{const r={id:t.interactionId,latency:t.duration,entries:[t]};_6.set(r.id,r),Yl.push(r)}Yl.sort((r,i)=>i.latency-r.latency),Yl.length>S6&&Yl.splice(S6).forEach(r=>_6.delete(r.id))}},Jte=t=>{const e=st.requestIdleCallback||st.setTimeout;let n=-1;return t=kT(t),st.document&&st.document.visibilityState==="hidden"?t():(n=e(t),Zv(t)),n},h4e=[200,500],p4e=(t,e={})=>{"PerformanceEventTiming"in st&&"interactionId"in PerformanceEventTiming.prototype&&C_(()=>{o4e();const n=Qv("INP");let r;const i=o=>{Jte(()=>{o.forEach(f4e);const a=u4e();a&&a.latency!==n.value&&(n.value=a.latency,n.entries=a.entries,r())})},s=kp("event",i,{durationThreshold:e.durationThreshold!=null?e.durationThreshold:a4e});r=Jv(t,n,h4e,e.reportAllChanges),s&&(s.observe({type:"first-input",buffered:!0}),Zv(()=>{i(s.takeRecords()),r(!0)}))})},m4e=[2500,4e3],IV={},g4e=(t,e={})=>{C_(()=>{const n=xT(),r=Qv("LCP");let i;const s=a=>{e.reportAllChanges||(a=a.slice(-1)),a.forEach(c=>{c.startTime<n.firstHiddenTime&&(r.value=Math.max(c.startTime-w_(),0),r.entries=[c],i())})},o=kp("largest-contentful-paint",s);if(o){i=Jv(t,r,m4e,e.reportAllChanges);const a=kT(()=>{IV[r.id]||(s(o.takeRecords()),o.disconnect(),IV[r.id]=!0,i(!0))});["keydown","click"].forEach(c=>{st.document&&addEventListener(c,()=>Jte(a),{once:!0,capture:!0})}),Zv(a)}})},v4e=[800,1800],wP=t=>{st.document&&st.document.prerendering?C_(()=>wP(t)):st.document&&st.document.readyState!=="complete"?addEventListener("load",()=>wP(t),!0):setTimeout(t,0)},y4e=(t,e={})=>{const n=Qv("TTFB"),r=Jv(t,n,v4e,e.reportAllChanges);wP(()=>{const i=E_();i&&(n.value=Math.max(i.responseStart-w_(),0),n.entries=[i],r(!0))})},Dy={},jC={};let Qte,Zte,ene,tne,nne;function rne(t,e=!1){return T_("cls",t,w4e,Qte,e)}function b4e(t,e=!1){return T_("lcp",t,T4e,ene,e)}function _4e(t){return T_("fid",t,C4e,Zte)}function S4e(t){return T_("ttfb",t,R4e,tne)}function E4e(t){return T_("inp",t,I4e,nne)}function Tb(t,e){return ine(t,e),jC[t]||(k4e(t),jC[t]=!0),sne(t,e)}function e0(t,e){const n=Dy[t];if(!(!n||!n.length))for(const r of n)try{r(e)}catch(i){tM&&De.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${Pu(r)}
Error:`,i)}}function w4e(){return t4e(t=>{e0("cls",{metric:t}),Qte=t},{reportAllChanges:!0})}function C4e(){return r4e(t=>{e0("fid",{metric:t}),Zte=t})}function T4e(){return g4e(t=>{e0("lcp",{metric:t}),ene=t},{reportAllChanges:!0})}function R4e(){return y4e(t=>{e0("ttfb",{metric:t}),tne=t})}function I4e(){return p4e(t=>{e0("inp",{metric:t}),nne=t})}function T_(t,e,n,r,i=!1){ine(t,e);let s;return jC[t]||(s=n(),jC[t]=!0),r&&e({metric:r}),sne(t,e,i?s:void 0)}function k4e(t){const e={};t==="event"&&(e.durationThreshold=0),kp(t,n=>{e0(t,{entries:n})},e)}function ine(t,e){Dy[t]=Dy[t]||[],Dy[t].push(e)}function sne(t,e,n){return()=>{n&&n();const r=Dy[t];if(!r)return;const i=r.indexOf(e);i!==-1&&r.splice(i,1)}}function x4e(t){return"duration"in t}function E6(t){return typeof t=="number"&&isFinite(t)}function Mu(t,e,n,{...r}){const i=on(t).start_timestamp;return i&&i>e&&typeof t.updateStartTime=="function"&&t.updateStartTime(e),Ate(t,()=>{const s=S_({startTime:e,...r});return s&&s.end(n),s})}function one(t){const e=cn();if(!e)return;const{name:n,transaction:r,attributes:i,startTime:s}=t,{release:o,environment:a}=e.getOptions(),c=e.getIntegrationByName("Replay"),l=c&&c.getReplayId(),d=Ln(),h=d.getUser(),m=h!==void 0?h.email||h.id||h.ip_address:void 0;let g;try{g=d.getScopeData().contexts.profile.profile_id}catch{}const y={release:o,environment:a,user:m||void 0,profile_id:g||void 0,replay_id:l||void 0,transaction:r,"user_agent.original":st.navigator&&st.navigator.userAgent,...i};return S_({name:n,attributes:y,startTime:s,experimental:{standalone:!0}})}function nM(){return st&&st.addEventListener&&st.performance}function Ir(t){return t/1e3}function ane(t){let e="unknown",n="unknown",r="";for(const i of t){if(i==="/"){[e,n]=t.split("/");break}if(!isNaN(Number(i))){e=r==="h"?"http":r,n=t.split(r)[1];break}r+=i}return r===t&&(e=r),{name:e,version:n}}function A4e(){let t=0,e,n;if(!L4e())return;let r=!1;function i(){r||(r=!0,n&&P4e(t,e,n),s())}const s=rne(({metric:o})=>{const a=o.entries[o.entries.length-1];a&&(t=o.value,e=a)},!0);Zv(()=>{i()}),setTimeout(()=>{const o=cn();if(!o)return;const a=o.on("startNavigationSpan",()=>{i(),a&&a()}),c=Ki(),l=c&&Vi(c),d=l&&on(l);d&&d.op==="pageload"&&(n=l.spanContext().spanId)},0)}function P4e(t,e,n){tM&&De.log(`Sending CLS span (${t})`);const r=Ir((Qs||0)+(e&&e.startTime||0)),i=Ln().getScopeData().transactionName,s=e?sp(e.sources[0]&&e.sources[0].node):"Layout shift",o=Hi({[qr]:"auto.http.browser.cls",[Ou]:"ui.webvital.cls",[W7]:e&&e.duration||0,"sentry.pageload.span_id":n}),a=one({name:s,transaction:i,attributes:o,startTime:r});a&&(a.addEvent("cls",{[TT]:"",[RT]:t}),a.end(r))}function L4e(){try{return PerformanceObserver.supportedEntryTypes.includes("layout-shift")}catch{return!1}}const O4e=2147483647;let kV=0,Ni={},Ds,Ny;function M4e({recordClsStandaloneSpans:t}){const e=nM();if(e&&Qs){e.mark&&st.performance.mark("sentry-tracing-init");const n=$4e(),r=F4e(),i=B4e(),s=t?A4e():j4e();return()=>{n(),r(),i(),s&&s()}}return()=>{}}function D4e(){Tb("longtask",({entries:t})=>{const e=Ki();if(!e)return;const{op:n,start_timestamp:r}=on(e);for(const i of t){const s=Ir(Qs+i.startTime),o=Ir(i.duration);n==="navigation"&&r&&s<r||Mu(e,s,s+o,{name:"Main UI thread blocked",op:"ui.long-task",attributes:{[qr]:"auto.ui.browser.metrics"}})}})}function N4e(){new PerformanceObserver(e=>{const n=Ki();if(n)for(const r of e.getEntries()){if(!r.scripts[0])continue;const i=Ir(Qs+r.startTime),{start_timestamp:s,op:o}=on(n);if(o==="navigation"&&s&&i<s)continue;const a=Ir(r.duration),c={[qr]:"auto.ui.browser.metrics"},l=r.scripts[0],{invoker:d,invokerType:h,sourceURL:m,sourceFunctionName:g,sourceCharPosition:y}=l;c["browser.script.invoker"]=d,c["browser.script.invoker_type"]=h,m&&(c["code.filepath"]=m),g&&(c["code.function"]=g),y!==-1&&(c["browser.script.source_char_position"]=y),Mu(n,i,i+a,{name:"Main UI thread blocked",op:"ui.long-animation-frame",attributes:c})}}).observe({type:"long-animation-frame",buffered:!0})}function U4e(){Tb("event",({entries:t})=>{const e=Ki();if(e){for(const n of t)if(n.name==="click"){const r=Ir(Qs+n.startTime),i=Ir(n.duration),s={name:sp(n.target),op:`ui.interaction.${n.name}`,startTime:r,attributes:{[qr]:"auto.ui.browser.metrics"}},o=rte(n.target);o&&(s.attributes["ui.component_name"]=o),Mu(e,r,r+i,s)}}})}function j4e(){return rne(({metric:t})=>{const e=t.entries[t.entries.length-1];e&&(Ni.cls={value:t.value,unit:""},Ny=e)},!0)}function F4e(){return b4e(({metric:t})=>{const e=t.entries[t.entries.length-1];e&&(Ni.lcp={value:t.value,unit:"millisecond"},Ds=e)},!0)}function $4e(){return _4e(({metric:t})=>{const e=t.entries[t.entries.length-1];if(!e)return;const n=Ir(Qs),r=Ir(e.startTime);Ni.fid={value:t.value,unit:"millisecond"},Ni["mark.fid"]={value:n+r,unit:"second"}})}function B4e(){return S4e(({metric:t})=>{t.entries[t.entries.length-1]&&(Ni.ttfb={value:t.value,unit:"millisecond"})})}function H4e(t,e){const n=nM();if(!n||!n.getEntries||!Qs)return;const r=Ir(Qs),i=n.getEntries(),{op:s,start_timestamp:o}=on(t);if(i.slice(kV).forEach(a=>{const c=Ir(a.startTime),l=Ir(Math.max(0,a.duration));if(!(s==="navigation"&&o&&r+c<o))switch(a.entryType){case"navigation":{q4e(t,a,r);break}case"mark":case"paint":case"measure":{V4e(t,a,c,l,r);const d=xT(),h=a.startTime<d.firstHiddenTime;a.name==="first-paint"&&h&&(Ni.fp={value:a.startTime,unit:"millisecond"}),a.name==="first-contentful-paint"&&h&&(Ni.fcp={value:a.startTime,unit:"millisecond"});break}case"resource":{z4e(t,a,a.name,c,l,r);break}}}),kV=Math.max(i.length-1,0),W4e(t),s==="pageload"){X4e(Ni);const a=Ni["mark.fid"];a&&Ni.fid&&(Mu(t,a.value,a.value+Ir(Ni.fid.value),{name:"first input delay",op:"ui.action",attributes:{[qr]:"auto.ui.browser.metrics"}}),delete Ni["mark.fid"]),(!("fcp"in Ni)||!e.recordClsOnPageloadSpan)&&delete Ni.cls,Object.entries(Ni).forEach(([c,l])=>{B3e(c,l.value,l.unit)}),t.setAttribute("performance.timeOrigin",r),t.setAttribute("performance.activationStart",w_()),Y4e(t)}Ds=void 0,Ny=void 0,Ni={}}function V4e(t,e,n,r,i){const s=E_(!1),o=Ir(s?s.requestStart:0),a=i+Math.max(n,o),c=i+n,l=c+r,d={[qr]:"auto.resource.browser.metrics"};return a!==c&&(d["sentry.browser.measure_happened_before_request"]=!0,d["sentry.browser.measure_start_time"]=a),Mu(t,a,l,{name:e.name,op:e.entryType,attributes:d}),a}function q4e(t,e,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(r=>{G2(t,e,r,n)}),G2(t,e,"secureConnection",n,"TLS/SSL"),G2(t,e,"fetch",n,"cache"),G2(t,e,"domainLookup",n,"DNS"),K4e(t,e,n)}function G2(t,e,n,r,i=n){const s=G4e(n),o=e[s],a=e[`${n}Start`];!a||!o||Mu(t,r+Ir(a),r+Ir(o),{op:`browser.${i}`,name:e.name,attributes:{[qr]:"auto.ui.browser.metrics"}})}function G4e(t){return t==="secureConnection"?"connectEnd":t==="fetch"?"domainLookupStart":`${t}End`}function K4e(t,e,n){const r=n+Ir(e.requestStart),i=n+Ir(e.responseEnd),s=n+Ir(e.responseStart);e.responseEnd&&(Mu(t,r,i,{op:"browser.request",name:e.name,attributes:{[qr]:"auto.ui.browser.metrics"}}),Mu(t,s,i,{op:"browser.response",name:e.name,attributes:{[qr]:"auto.ui.browser.metrics"}}))}function z4e(t,e,n,r,i,s){if(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")return;const o=Yh(n),a={[qr]:"auto.resource.browser.metrics"};w6(a,e,"transferSize","http.response_transfer_size"),w6(a,e,"encodedBodySize","http.response_content_length"),w6(a,e,"decodedBodySize","http.decoded_response_content_length");const c=e.deliveryType;c!=null&&(a["http.response_delivery_type"]=c);const l=e.renderBlockingStatus;l&&(a["resource.render_blocking_status"]=l),o.protocol&&(a["url.scheme"]=o.protocol.split(":").pop()),o.host&&(a["server.address"]=o.host),a["url.same_origin"]=n.includes(st.location.origin);const{name:d,version:h}=ane(e.nextHopProtocol);a["network.protocol.name"]=d,a["network.protocol.version"]=h;const m=s+r,g=m+i;Mu(t,m,g,{name:n.replace(st.location.origin,""),op:e.initiatorType?`resource.${e.initiatorType}`:"resource.other",attributes:a})}function W4e(t){const e=st.navigator;if(!e)return;const n=e.connection;n&&(n.effectiveType&&t.setAttribute("effectiveConnectionType",n.effectiveType),n.type&&t.setAttribute("connectionType",n.type),E6(n.rtt)&&(Ni["connection.rtt"]={value:n.rtt,unit:"millisecond"})),E6(e.deviceMemory)&&t.setAttribute("deviceMemory",`${e.deviceMemory} GB`),E6(e.hardwareConcurrency)&&t.setAttribute("hardwareConcurrency",String(e.hardwareConcurrency))}function Y4e(t){Ds&&(Ds.element&&t.setAttribute("lcp.element",sp(Ds.element)),Ds.id&&t.setAttribute("lcp.id",Ds.id),Ds.url&&t.setAttribute("lcp.url",Ds.url.trim().slice(0,200)),Ds.loadTime!=null&&t.setAttribute("lcp.loadTime",Ds.loadTime),Ds.renderTime!=null&&t.setAttribute("lcp.renderTime",Ds.renderTime),t.setAttribute("lcp.size",Ds.size)),Ny&&Ny.sources&&Ny.sources.forEach((e,n)=>t.setAttribute(`cls.source.${n+1}`,sp(e.node)))}function w6(t,e,n,r){const i=e[n];i!=null&&i<O4e&&(t[r]=i)}function X4e(t){const e=E_(!1);if(!e)return;const{responseStart:n,requestStart:r}=e;r<=n&&(t["ttfb.requestTime"]={value:n-r,unit:"millisecond"})}const J4e=1e3;let xV,CP,TP;function Q4e(t){const e="dom";Nf(e,t),Uf(e,Z4e)}function Z4e(){if(!st.document)return;const t=ha.bind(null,"dom"),e=AV(t,!0);st.document.addEventListener("click",e,!1),st.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(n=>{const i=st[n],s=i&&i.prototype;!s||!s.hasOwnProperty||!s.hasOwnProperty("addEventListener")||(Co(s,"addEventListener",function(o){return function(a,c,l){if(a==="click"||a=="keypress")try{const d=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},h=d[a]=d[a]||{refCount:0};if(!h.handler){const m=AV(t);h.handler=m,o.call(this,a,m,l)}h.refCount++}catch{}return o.call(this,a,c,l)}}),Co(s,"removeEventListener",function(o){return function(a,c,l){if(a==="click"||a=="keypress")try{const d=this.__sentry_instrumentation_handlers__||{},h=d[a];h&&(h.refCount--,h.refCount<=0&&(o.call(this,a,h.handler,l),h.handler=void 0,delete d[a]),Object.keys(d).length===0&&delete this.__sentry_instrumentation_handlers__)}catch{}return o.call(this,a,c,l)}}))})}function eIe(t){if(t.type!==CP)return!1;try{if(!t.target||t.target._sentryId!==TP)return!1}catch{}return!0}function tIe(t,e){return t!=="keypress"?!1:!e||!e.tagName?!0:!(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)}function AV(t,e=!1){return n=>{if(!n||n._sentryCaptured)return;const r=nIe(n);if(tIe(n.type,r))return;_a(n,"_sentryCaptured",!0),r&&!r._sentryId&&_a(r,"_sentryId",pa());const i=n.type==="keypress"?"input":n.type;eIe(n)||(t({event:n,name:i,global:e}),CP=n.type,TP=r?r._sentryId:void 0),clearTimeout(xV),xV=st.setTimeout(()=>{TP=void 0,CP=void 0},J4e)}}function nIe(t){try{return t.target}catch{return null}}let K2;function rM(t){const e="history";Nf(e,t),Uf(e,rIe)}function rIe(){if(!PRe())return;const t=st.onpopstate;st.onpopstate=function(...n){const r=st.location.href,i=K2;if(K2=r,ha("history",{from:i,to:r}),t)try{return t.apply(this,n)}catch{}};function e(n){return function(...r){const i=r.length>2?r[2]:void 0;if(i){const s=K2,o=String(i);K2=o,ha("history",{from:s,to:o})}return n.apply(this,r)}}Co(st.history,"pushState",e),Co(st.history,"replaceState",e)}const bw={};function iIe(t){const e=bw[t];if(e)return e;let n=st[t];if(yP(n))return bw[t]=n.bind(st);const r=st.document;if(r&&typeof r.createElement=="function")try{const i=r.createElement("iframe");i.hidden=!0,r.head.appendChild(i);const s=i.contentWindow;s&&s[t]&&(n=s[t]),r.head.removeChild(i)}catch(i){tM&&De.warn(`Could not create sandbox iframe for ${t} check, bailing to window.${t}: `,i)}return n&&(bw[t]=n.bind(st))}function PV(t){bw[t]=void 0}const dg="__sentry_xhr_v3__";function cne(t){const e="xhr";Nf(e,t),Uf(e,sIe)}function sIe(){if(!st.XMLHttpRequest)return;const t=XMLHttpRequest.prototype;t.open=new Proxy(t.open,{apply(e,n,r){const i=new Error,s=vs()*1e3,o=_u(r[0])?r[0].toUpperCase():void 0,a=oIe(r[1]);if(!o||!a)return e.apply(n,r);n[dg]={method:o,url:a,request_headers:{}},o==="POST"&&a.match(/sentry_key/)&&(n.__sentry_own_request__=!0);const c=()=>{const l=n[dg];if(l&&n.readyState===4){try{l.status_code=n.status}catch{}const d={endTimestamp:vs()*1e3,startTimestamp:s,xhr:n,virtualError:i};ha("xhr",d)}};return"onreadystatechange"in n&&typeof n.onreadystatechange=="function"?n.onreadystatechange=new Proxy(n.onreadystatechange,{apply(l,d,h){return c(),l.apply(d,h)}}):n.addEventListener("readystatechange",c),n.setRequestHeader=new Proxy(n.setRequestHeader,{apply(l,d,h){const[m,g]=h,y=d[dg];return y&&_u(m)&&_u(g)&&(y.request_headers[m.toLowerCase()]=g),l.apply(d,h)}}),e.apply(n,r)}}),t.send=new Proxy(t.send,{apply(e,n,r){const i=n[dg];if(!i)return e.apply(n,r);r[0]!==void 0&&(i.body=r[0]);const s={startTimestamp:vs()*1e3,xhr:n};return ha("xhr",s),e.apply(n,r)}})}function oIe(t){if(_u(t))return t;try{return t.toString()}catch{}}const C6=[],_w=new Map;function aIe(){if(nM()&&Qs){const e=cIe();return()=>{e()}}return()=>{}}const LV={click:"click",pointerdown:"click",pointerup:"click",mousedown:"click",mouseup:"click",touchstart:"click",touchend:"click",mouseover:"hover",mouseout:"hover",mouseenter:"hover",mouseleave:"hover",pointerover:"hover",pointerout:"hover",pointerenter:"hover",pointerleave:"hover",dragstart:"drag",dragend:"drag",drag:"drag",dragenter:"drag",dragleave:"drag",dragover:"drag",drop:"drag",keydown:"press",keyup:"press",keypress:"press",input:"press"};function cIe(){return E4e(({metric:t})=>{if(t.value==null)return;const e=t.entries.find(y=>y.duration===t.value&&LV[y.name]);if(!e)return;const{interactionId:n}=e,r=LV[e.name],i=Ir(Qs+e.startTime),s=Ir(t.value),o=Ki(),a=o?Vi(o):void 0,l=(n!=null?_w.get(n):void 0)||a,d=l?on(l).description:Ln().getScopeData().transactionName,h=sp(e.target),m=Hi({[qr]:"auto.http.browser.inp",[Ou]:`ui.interaction.${r}`,[W7]:e.duration}),g=one({name:h,transaction:d,attributes:m,startTime:i});g&&(g.addEvent("inp",{[TT]:"millisecond",[RT]:t.value}),g.end(i+s))})}function lIe(t){const e=({entries:n})=>{const r=Ki(),i=r&&Vi(r);n.forEach(s=>{if(!x4e(s)||!i)return;const o=s.interactionId;if(o!=null&&!_w.has(o)){if(C6.length>10){const a=C6.shift();_w.delete(a)}C6.push(o),_w.set(o,i)}})};Tb("event",e),Tb("first-input",e)}function uIe(t,e=iIe("fetch")){let n=0,r=0;function i(s){const o=s.body.length;n+=o,r++;const a={body:s.body,method:"POST",referrerPolicy:"origin",headers:t.headers,keepalive:n<=6e4&&r<15,...t.fetchOptions};if(!e)return PV("fetch"),MC("No fetch implementation available");try{return e(t.url,a).then(c=>(n-=o,r--,{statusCode:c.status,headers:{"x-sentry-rate-limits":c.headers.get("X-Sentry-Rate-Limits"),"retry-after":c.headers.get("Retry-After")}}))}catch(c){return PV("fetch"),n-=o,r--,MC(c)}}return HTe(t,i)}const dIe=30,fIe=50;function RP(t,e,n,r){const i={filename:t,function:e==="<anonymous>"?ip:e,in_app:!0};return n!==void 0&&(i.lineno=n),r!==void 0&&(i.colno=r),i}const hIe=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,pIe=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,mIe=/\((\S*)(?::(\d+))(?::(\d+))\)/,gIe=t=>{const e=hIe.exec(t);if(e){const[,r,i,s]=e;return RP(r,ip,+i,+s)}const n=pIe.exec(t);if(n){if(n[2]&&n[2].indexOf("eval")===0){const o=mIe.exec(n[2]);o&&(n[2]=o[1],n[3]=o[2],n[4]=o[3])}const[i,s]=lne(n[1]||ip,n[2]);return RP(s,i,n[3]?+n[3]:void 0,n[4]?+n[4]:void 0)}},vIe=[dIe,gIe],yIe=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,bIe=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,_Ie=t=>{const e=yIe.exec(t);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const s=bIe.exec(e[3]);s&&(e[1]=e[1]||"eval",e[3]=s[1],e[4]=s[2],e[5]="")}let r=e[3],i=e[1]||ip;return[i,r]=lne(i,r),RP(r,i,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}},SIe=[fIe,_Ie],EIe=[vIe,SIe],wIe=Jee(...EIe),lne=(t,e)=>{const n=t.indexOf("safari-extension")!==-1,r=t.indexOf("safari-web-extension")!==-1;return n||r?[t.indexOf("@")!==-1?t.split("@")[0]:ip,n?`safari-extension:${e}`:`safari-web-extension:${e}`]:[t,e]},z2=1024,CIe="Breadcrumbs",TIe=(t={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...t};return{name:CIe,setup(n){e.console&&uRe(xIe(n)),e.dom&&Q4e(kIe(n,e.dom)),e.xhr&&cne(AIe(n)),e.fetch&&Kte(PIe(n)),e.history&&rM(LIe(n)),e.sentry&&n.on("beforeSendEvent",IIe(n))}}},RIe=TIe;function IIe(t){return function(n){cn()===t&&ap({category:`sentry.${n.type==="transaction"?"transaction":"event"}`,event_id:n.event_id,level:n.level,message:Nd(n)},{event:n})}}function kIe(t,e){return function(r){if(cn()!==t)return;let i,s,o=typeof e=="object"?e.serializeAttribute:void 0,a=typeof e=="object"&&typeof e.maxStringLength=="number"?e.maxStringLength:void 0;a&&a>z2&&(Ro&&De.warn(`\`dom.maxStringLength\` cannot exceed ${z2}, but a value of ${a} was configured. Sentry will use ${z2} instead.`),a=z2),typeof o=="string"&&(o=[o]);try{const l=r.event,d=OIe(l)?l.target:l;i=sp(d,{keyAttrs:o,maxStringLength:a}),s=rte(d)}catch{i="<unknown>"}if(i.length===0)return;const c={category:`ui.${r.name}`,message:i};s&&(c.data={"ui.component_name":s}),ap(c,{event:r.event,name:r.name,global:r.global})}}function xIe(t){return function(n){if(cn()!==t)return;const r={category:"console",data:{arguments:n.args,logger:"console"},level:fRe(n.level),message:zH(n.args," ")};if(n.level==="assert")if(n.args[0]===!1)r.message=`Assertion failed: ${zH(n.args.slice(1)," ")||"console.assert"}`,r.data.arguments=n.args.slice(1);else return;ap(r,{input:n.args,level:n.level})}}function AIe(t){return function(n){if(cn()!==t)return;const{startTimestamp:r,endTimestamp:i}=n,s=n.xhr[dg];if(!r||!i||!s)return;const{method:o,url:a,status_code:c,body:l}=s,d={method:o,url:a,status_code:c},h={xhr:n.xhr,input:l,startTimestamp:r,endTimestamp:i},m=qte(c);ap({category:"xhr",data:d,type:"http",level:m},h)}}function PIe(t){return function(n){if(cn()!==t)return;const{startTimestamp:r,endTimestamp:i}=n;if(i&&!(n.fetchData.url.match(/sentry_key/)&&n.fetchData.method==="POST"))if(n.error){const s=n.fetchData,o={data:n.error,input:n.args,startTimestamp:r,endTimestamp:i};ap({category:"fetch",data:s,level:"error",type:"http"},o)}else{const s=n.response,o={...n.fetchData,status_code:s&&s.status},a={input:n.args,response:s,startTimestamp:r,endTimestamp:i},c=qte(o.status_code);ap({category:"fetch",data:o,type:"http",level:c},a)}}}function LIe(t){return function(n){if(cn()!==t)return;let r=n.from,i=n.to;const s=Yh(Ze.location.href);let o=r?Yh(r):void 0;const a=Yh(i);(!o||!o.path)&&(o=s),s.protocol===a.protocol&&s.host===a.host&&(i=a.relative),s.protocol===o.protocol&&s.host===o.host&&(r=o.relative),ap({category:"navigation",data:{from:r,to:i}})}}function OIe(t){return!!t&&!!t.target}const MIe=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],DIe="BrowserApiErrors",NIe=(t={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...t};return{name:DIe,setupOnce(){e.setTimeout&&Co(Ze,"setTimeout",OV),e.setInterval&&Co(Ze,"setInterval",OV),e.requestAnimationFrame&&Co(Ze,"requestAnimationFrame",jIe),e.XMLHttpRequest&&"XMLHttpRequest"in Ze&&Co(XMLHttpRequest.prototype,"send",FIe);const n=e.eventTarget;n&&(Array.isArray(n)?n:MIe).forEach($Ie)}}},UIe=NIe;function OV(t){return function(...e){const n=e[0];return e[0]=hv(n,{mechanism:{data:{function:Pu(t)},handled:!1,type:"instrument"}}),t.apply(this,e)}}function jIe(t){return function(e){return t.apply(this,[hv(e,{mechanism:{data:{function:"requestAnimationFrame",handler:Pu(t)},handled:!1,type:"instrument"}})])}}function FIe(t){return function(...e){const n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(i=>{i in n&&typeof n[i]=="function"&&Co(n,i,function(s){const o={mechanism:{data:{function:i,handler:Pu(s)},handled:!1,type:"instrument"}},a=K7(s);return a&&(o.mechanism.data.handler=Pu(a)),hv(s,o)})}),t.apply(this,e)}}function $Ie(t){const n=Ze[t],r=n&&n.prototype;!r||!r.hasOwnProperty||!r.hasOwnProperty("addEventListener")||(Co(r,"addEventListener",function(i){return function(s,o,a){try{BIe(o)&&(o.handleEvent=hv(o.handleEvent,{mechanism:{data:{function:"handleEvent",handler:Pu(o),target:t},handled:!1,type:"instrument"}}))}catch{}return i.apply(this,[s,hv(o,{mechanism:{data:{function:"addEventListener",handler:Pu(o),target:t},handled:!1,type:"instrument"}}),a])}}),Co(r,"removeEventListener",function(i){return function(s,o,a){try{const c=o.__sentry_wrapped__;c&&i.call(this,s,c,a)}catch{}return i.call(this,s,o,a)}}))}function BIe(t){return typeof t.handleEvent=="function"}const HIe=()=>({name:"BrowserSession",setupOnce(){if(typeof Ze.document>"u"){Ro&&De.warn("Using the `browserSessionIntegration` in non-browser environments is not supported.");return}pV({ignoreDuration:!0}),mV(),rM(({from:t,to:e})=>{t!==void 0&&t!==e&&(pV({ignoreDuration:!0}),mV())})}}),VIe="GlobalHandlers",qIe=(t={})=>{const e={onerror:!0,onunhandledrejection:!0,...t};return{name:VIe,setupOnce(){Error.stackTraceLimit=50},setup(n){e.onerror&&(KIe(n),MV("onerror")),e.onunhandledrejection&&(zIe(n),MV("onunhandledrejection"))}}},GIe=qIe;function KIe(t){Qee(e=>{const{stackParser:n,attachStacktrace:r}=une();if(cn()!==t||Wte())return;const{msg:i,url:s,line:o,column:a,error:c}=e,l=XIe(eM(n,c||i,void 0,r,!1),s,o,a);l.level="error",Ote(l,{originalException:c,mechanism:{handled:!1,type:"onerror"}})})}function zIe(t){Zee(e=>{const{stackParser:n,attachStacktrace:r}=une();if(cn()!==t||Wte())return;const i=WIe(e),s=G7(i)?YIe(i):eM(n,i,void 0,r,!0);s.level="error",Ote(s,{originalException:i,mechanism:{handled:!1,type:"onunhandledrejection"}})})}function WIe(t){if(G7(t))return t;try{if("reason"in t)return t.reason;if("detail"in t&&"reason"in t.detail)return t.detail.reason}catch{}return t}function YIe(t){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(t)}`}]}}}function XIe(t,e,n,r){const i=t.exception=t.exception||{},s=i.values=i.values||[],o=s[0]=s[0]||{},a=o.stacktrace=o.stacktrace||{},c=a.frames=a.frames||[],l=r,d=n,h=_u(e)&&e.length>0?e:MCe();return c.length===0&&c.push({colno:l,filename:h,function:ip,in_app:!0,lineno:d}),t}function MV(t){Ro&&De.log(`Global Handler attached: ${t}`)}function une(){const t=cn();return t&&t.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const JIe=()=>({name:"HttpContext",preprocessEvent(t){if(!Ze.navigator&&!Ze.location&&!Ze.document)return;const e=t.request&&t.request.url||Ze.location&&Ze.location.href,{referrer:n}=Ze.document||{},{userAgent:r}=Ze.navigator||{},i={...t.request&&t.request.headers,...n&&{Referer:n},...r&&{"User-Agent":r}},s={...t.request,...e&&{url:e},headers:i};t.request=s}}),QIe="cause",ZIe=5,eke="LinkedErrors",tke=(t={})=>{const e=t.limit||ZIe,n=t.key||QIe;return{name:eke,preprocessEvent(r,i,s){const o=s.getOptions();cRe(Q7,o.stackParser,o.maxValueLength,n,e,r,i)}}},nke=tke;function rke(t){const e=[JTe(),zTe(),UIe(),RIe(),GIe(),nke(),mRe(),JIe()];return t.autoSessionTracking!==!1&&e.push(HIe()),e}function ike(t={}){const e={defaultIntegrations:rke(t),release:typeof __SENTRY_RELEASE__=="string"?__SENTRY_RELEASE__:Ze.SENTRY_RELEASE&&Ze.SENTRY_RELEASE.id?Ze.SENTRY_RELEASE.id:void 0,autoSessionTracking:!0,sendClientReports:!0};return t.defaultIntegrations==null&&delete t.defaultIntegrations,{...e,...t}}function ske(){const t=typeof Ze.window<"u"&&Ze;if(!t)return!1;const e=t.chrome?"chrome":"browser",n=t[e],r=n&&n.runtime&&n.runtime.id,i=Ze.location&&Ze.location.href||"",s=["chrome-extension:","moz-extension:","ms-browser-extension:","safari-web-extension:"],o=!!r&&Ze===Ze.top&&s.some(c=>i.startsWith(`${c}//`)),a=typeof t.nw<"u";return!!r&&!o&&!a}function oke(t={}){const e=ike(t);if(!e.skipBrowserExtensionCheck&&ske()){Tp(()=>{console.error("[Sentry] You cannot run Sentry this way in a browser extension, check: https://docs.sentry.io/platforms/javascript/best-practices/browser-extensions/")});return}Ro&&(Gte()||De.warn("No Fetch API detected. The Sentry SDK requires a Fetch API compatible environment to send events. Please add a Fetch API polyfill."));const n={...e,stackParser:CCe(e.stackParser||wIe),integrations:ITe(e),transport:e.transport||uIe};return OTe(KRe,n)}function DV(t={}){if(!Ze.document){Ro&&De.error("Global document not defined in showReportDialog call");return}const e=Ln(),n=e.getClient(),r=n&&n.getDsn();if(!r){Ro&&De.error("DSN not configured for showReportDialog call");return}if(e&&(t.user={...e.getUser(),...t.user}),!t.eventId){const a=bTe();a&&(t.eventId=a)}const i=Ze.document.createElement("script");i.async=!0,i.crossOrigin="anonymous",i.src=TTe(r,t),t.onLoad&&(i.onload=t.onLoad);const{onClose:s}=t;if(s){const a=c=>{if(c.data==="__sentry_reportdialog_closed__")try{s()}finally{Ze.removeEventListener("message",a)}};Ze.addEventListener("message",a)}const o=Ze.document.head||Ze.document.body;o?o.appendChild(i):Ro&&De.error("Not injecting report dialog. No injection point found in HTML")}const NV=new WeakMap,T6=new Map,Sw={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0,trackFetchStreamPerformance:!1};function ake(t,e){const{traceFetch:n,traceXHR:r,trackFetchStreamPerformance:i,shouldCreateSpanForRequest:s,enableHTTPTimings:o,tracePropagationTargets:a}={traceFetch:Sw.traceFetch,traceXHR:Sw.traceXHR,trackFetchStreamPerformance:Sw.trackFetchStreamPerformance,...e},c=typeof s=="function"?s:h=>!0,l=h=>uke(h,a),d={};n&&(t.addEventProcessor(h=>(h.type==="transaction"&&h.spans&&h.spans.forEach(m=>{if(m.op==="http.client"){const g=T6.get(m.span_id);g&&(m.timestamp=g/1e3,T6.delete(m.span_id))}}),h)),i&&RRe(h=>{if(h.response){const m=NV.get(h.response);m&&h.endTimestamp&&T6.set(m,h.endTimestamp)}}),Kte(h=>{const m=bRe(h,c,l,d);if(h.response&&h.fetchData.__span&&NV.set(h.response,h.fetchData.__span),m){const g=dne(h.fetchData.url),y=g?Yh(g).host:void 0;m.setAttributes({"http.url":g,"server.address":y})}o&&m&&UV(m)})),r&&cne(h=>{const m=dke(h,c,l,d);o&&m&&UV(m)})}function cke(t){return t.entryType==="resource"&&"initiatorType"in t&&typeof t.nextHopProtocol=="string"&&(t.initiatorType==="fetch"||t.initiatorType==="xmlhttprequest")}function UV(t){const{url:e}=on(t).data||{};if(!e||typeof e!="string")return;const n=Tb("resource",({entries:r})=>{r.forEach(i=>{cke(i)&&i.name.endsWith(e)&&(lke(i).forEach(o=>t.setAttribute(...o)),setTimeout(n))})})}function Rc(t=0){return((Qs||performance.timeOrigin)+t)/1e3}function lke(t){const{name:e,version:n}=ane(t.nextHopProtocol),r=[];return r.push(["network.protocol.version",n],["network.protocol.name",e]),Qs?[...r,["http.request.redirect_start",Rc(t.redirectStart)],["http.request.fetch_start",Rc(t.fetchStart)],["http.request.domain_lookup_start",Rc(t.domainLookupStart)],["http.request.domain_lookup_end",Rc(t.domainLookupEnd)],["http.request.connect_start",Rc(t.connectStart)],["http.request.secure_connection_start",Rc(t.secureConnectionStart)],["http.request.connection_end",Rc(t.connectEnd)],["http.request.request_start",Rc(t.requestStart)],["http.request.response_start",Rc(t.responseStart)],["http.request.response_end",Rc(t.responseEnd)]]:r}function uke(t,e){const n=Ze.location&&Ze.location.href;if(n){let r,i;try{r=new URL(t,n),i=new URL(n).origin}catch{return!1}const s=r.origin===i;return e?Kh(r.toString(),e)||s&&Kh(r.pathname,e):s}else{const r=!!t.match(/^\/(?!\/)/);return e?Kh(t,e):r}}function dke(t,e,n,r){const i=t.xhr,s=i&&i[dg];if(!i||i.__sentry_own_request__||!s)return;const o=bf()&&e(s.url);if(t.endTimestamp&&o){const h=i.__sentry_xhr_span_id__;if(!h)return;const m=r[h];m&&s.status_code!==void 0&&(ute(m,s.status_code),m.end(),delete r[h]);return}const a=dne(s.url),c=a?Yh(a).host:void 0,l=!!Ki(),d=o&&l?S_({name:`${s.method} ${s.url}`,attributes:{type:"xhr","http.method":s.method,"http.url":a,url:s.url,"server.address":c,[qr]:"auto.http.browser",[Ou]:"http.client"}}):new zv;return i.__sentry_xhr_span_id__=d.spanContext().spanId,r[i.__sentry_xhr_span_id__]=d,n(s.url)&&fke(i,bf()&&l?d:void 0),d}function fke(t,e){const{"sentry-trace":n,baggage:r}=Bte({span:e});n&&hke(t,n,r)}function hke(t,e,n){try{t.setRequestHeader("sentry-trace",e),n&&t.setRequestHeader("baggage",n)}catch{}}function dne(t){try{return new URL(t,Ze.location.origin).href}catch{return}}function pke(){Ze&&Ze.document?Ze.document.addEventListener("visibilitychange",()=>{const t=Ki();if(!t)return;const e=Vi(t);if(Ze.document.hidden&&e){const n="cancelled",{op:r,status:i}=on(e);Ro&&De.log(`[Tracing] Transaction: ${n} -> since tab moved to the background, op: ${r}`),i||e.setStatus({code:bi,message:n}),e.setAttribute("sentry.cancellation_reason","document.hidden"),e.end()}}):Ro&&De.warn("[Tracing] Could not set up background tab detection due to lack of global document")}const mke="BrowserTracing",gke={...yw,instrumentNavigation:!0,instrumentPageLoad:!0,markBackgroundSpan:!0,enableLongTask:!0,enableLongAnimationFrame:!0,enableInp:!0,_experiments:{},...Sw},vke=(t={})=>{g3e();const{enableInp:e,enableLongTask:n,enableLongAnimationFrame:r,_experiments:{enableInteractions:i,enableStandaloneClsSpans:s},beforeStartSpan:o,idleTimeout:a,finalTimeout:c,childSpanTimeout:l,markBackgroundSpan:d,traceFetch:h,traceXHR:m,trackFetchStreamPerformance:g,shouldCreateSpanForRequest:y,enableHTTPTimings:v,instrumentPageLoad:w,instrumentNavigation:S}={...gke,...t},R=M4e({recordClsStandaloneSpans:s||!1});e&&aIe(),r&&en.PerformanceObserver&&PerformanceObserver.supportedEntryTypes&&PerformanceObserver.supportedEntryTypes.includes("long-animation-frame")?N4e():n&&D4e(),i&&U4e();const x={name:void 0,source:void 0};function T(I,k){const A=k.op==="pageload",O=o?o(k):k,D=O.attributes||{};k.name!==O.name&&(D[la]="custom",O.attributes=D),x.name=O.name,x.source=D[la];const N=Lte(O,{idleTimeout:a,finalTimeout:c,childSpanTimeout:l,disableAutoFinish:A,beforeSpanEnd:$=>{R(),H4e($,{recordClsOnPageloadSpan:!s})}});function U(){["interactive","complete"].includes(Ze.document.readyState)&&I.emit("idleSpanEnableAutoFinish",N)}return A&&Ze.document&&(Ze.document.addEventListener("readystatechange",()=>{U()}),U()),N}return{name:mke,afterAllSetup(I){let k,A=Ze.location&&Ze.location.href;function O(){k&&!on(k).timestamp&&(Ro&&De.log(`[Tracing] Finishing current active span with op: ${on(k).op}`),k.end())}I.on("startNavigationSpan",D=>{cn()===I&&(O(),k=T(I,{op:"navigation",...D}))}),I.on("startPageLoadSpan",(D,N={})=>{if(cn()!==I)return;O();const U=N.sentryTrace||jV("sentry-trace"),$=N.baggage||jV("baggage"),K=l3e(U,$);Ln().setPropagationContext(K),k=T(I,{op:"pageload",...D})}),I.on("spanEnd",D=>{const N=on(D).op;if(D!==Vi(D)||N!=="navigation"&&N!=="pageload")return;const U=Ln(),$=U.getPropagationContext();U.setPropagationContext({...$,sampled:$.sampled!==void 0?$.sampled:Ip(D),dsc:$.dsc||Wv(D)})}),Ze.location&&(w&&fne(I,{name:Ze.location.pathname,startTime:Qs?Qs/1e3:void 0,attributes:{[la]:"url",[qr]:"auto.pageload.browser"}}),S&&rM(({to:D,from:N})=>{if(N===void 0&&A&&A.indexOf(D)!==-1){A=void 0;return}N!==D&&(A=void 0,hne(I,{name:Ze.location.pathname,attributes:{[la]:"url",[qr]:"auto.navigation.browser"}}))})),d&&pke(),i&&yke(a,c,l,x),e&&lIe(),ake(I,{traceFetch:h,traceXHR:m,trackFetchStreamPerformance:g,tracePropagationTargets:I.getOptions().tracePropagationTargets,shouldCreateSpanForRequest:y,enableHTTPTimings:v})}}};function fne(t,e,n){t.emit("startPageLoadSpan",e,n),Ln().setTransactionName(e.name);const r=Ki();return(r&&on(r).op)==="pageload"?r:void 0}function hne(t,e){pl().setPropagationContext({traceId:gf()}),Ln().setPropagationContext({traceId:gf()}),t.emit("startNavigationSpan",e),Ln().setTransactionName(e.name);const n=Ki();return(n&&on(n).op)==="navigation"?n:void 0}function jV(t){const e=DCe(`meta[name=${t}]`);return e?e.getAttribute("content"):void 0}function yke(t,e,n,r){let i;const s=()=>{const o="ui.action.click",a=Ki(),c=a&&Vi(a);if(c){const l=on(c).op;if(["navigation","pageload"].includes(l)){Ro&&De.warn(`[Tracing] Did not create ${o} span because a pageload or navigation span is in progress.`);return}}if(i&&(i.setAttribute(uP,"interactionInterrupted"),i.end(),i=void 0),!r.name){Ro&&De.warn(`[Tracing] Did not create ${o} transaction because _latestRouteName is missing.`);return}i=Lte({name:r.name,op:o,attributes:{[la]:r.source||"url"}},{idleTimeout:t,finalTimeout:e,childSpanTimeout:n})};Ze.document&&addEventListener("click",s,{once:!1,capture:!0})}function bke(t){const e={...t};return $te(e,"react"),yTe("react",{version:_.version}),oke(e)}function _ke(t){const e=t.match(/^([^.]+)/);return e!==null&&parseInt(e[0])>=17}function Ske(t,e){const n=new WeakSet;function r(i,s){if(!n.has(i)){if(i.cause)return n.add(i),r(i.cause,s);i.cause=s}}r(t,e)}function Eke(t,{componentStack:e},n){if(_ke(_.version)&&_T(t)&&e){const r=new Error(t.message);r.name=`React ErrorBoundary ${t.name}`,r.stack=e,Ske(t,r)}return IT(t,{...n,captureContext:{contexts:{react:{componentStack:e}}}})}var R6={exports:{}},un={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FV;function wke(){if(FV)return un;FV=1;var t=typeof Symbol=="function"&&Symbol.for,e=t?Symbol.for("react.element"):60103,n=t?Symbol.for("react.portal"):60106,r=t?Symbol.for("react.fragment"):60107,i=t?Symbol.for("react.strict_mode"):60108,s=t?Symbol.for("react.profiler"):60114,o=t?Symbol.for("react.provider"):60109,a=t?Symbol.for("react.context"):60110,c=t?Symbol.for("react.async_mode"):60111,l=t?Symbol.for("react.concurrent_mode"):60111,d=t?Symbol.for("react.forward_ref"):60112,h=t?Symbol.for("react.suspense"):60113,m=t?Symbol.for("react.suspense_list"):60120,g=t?Symbol.for("react.memo"):60115,y=t?Symbol.for("react.lazy"):60116,v=t?Symbol.for("react.block"):60121,w=t?Symbol.for("react.fundamental"):60117,S=t?Symbol.for("react.responder"):60118,R=t?Symbol.for("react.scope"):60119;function x(I){if(typeof I=="object"&&I!==null){var k=I.$$typeof;switch(k){case e:switch(I=I.type,I){case c:case l:case r:case s:case i:case h:return I;default:switch(I=I&&I.$$typeof,I){case a:case d:case y:case g:case o:return I;default:return k}}case n:return k}}}function T(I){return x(I)===l}return un.AsyncMode=c,un.ConcurrentMode=l,un.ContextConsumer=a,un.ContextProvider=o,un.Element=e,un.ForwardRef=d,un.Fragment=r,un.Lazy=y,un.Memo=g,un.Portal=n,un.Profiler=s,un.StrictMode=i,un.Suspense=h,un.isAsyncMode=function(I){return T(I)||x(I)===c},un.isConcurrentMode=T,un.isContextConsumer=function(I){return x(I)===a},un.isContextProvider=function(I){return x(I)===o},un.isElement=function(I){return typeof I=="object"&&I!==null&&I.$$typeof===e},un.isForwardRef=function(I){return x(I)===d},un.isFragment=function(I){return x(I)===r},un.isLazy=function(I){return x(I)===y},un.isMemo=function(I){return x(I)===g},un.isPortal=function(I){return x(I)===n},un.isProfiler=function(I){return x(I)===s},un.isStrictMode=function(I){return x(I)===i},un.isSuspense=function(I){return x(I)===h},un.isValidElementType=function(I){return typeof I=="string"||typeof I=="function"||I===r||I===l||I===s||I===i||I===h||I===m||typeof I=="object"&&I!==null&&(I.$$typeof===y||I.$$typeof===g||I.$$typeof===o||I.$$typeof===a||I.$$typeof===d||I.$$typeof===w||I.$$typeof===S||I.$$typeof===R||I.$$typeof===v)},un.typeOf=x,un}var $V;function Cke(){return $V||($V=1,R6.exports=wke()),R6.exports}var I6,BV;function Tke(){if(BV)return I6;BV=1;var t=Cke(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},n={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};s[t.ForwardRef]=r,s[t.Memo]=i;function o(y){return t.isMemo(y)?i:s[y.$$typeof]||e}var a=Object.defineProperty,c=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,d=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,m=Object.prototype;function g(y,v,w){if(typeof v!="string"){if(m){var S=h(v);S&&S!==m&&g(y,S,w)}var R=c(v);l&&(R=R.concat(l(v)));for(var x=o(y),T=o(v),I=0;I<R.length;++I){var k=R[I];if(!n[k]&&!(w&&w[k])&&!(T&&T[k])&&!(x&&x[k])){var A=d(v,k);try{a(y,k,A)}catch{}}}}return y}return I6=g,I6}var Rke=Tke();const Ike=cl(Rke),pne=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,HV={componentStack:null,error:null,eventId:null};class AT extends _.Component{constructor(e){super(e),AT.prototype.__init.call(this),this.state=HV,this._openFallbackReportDialog=!0;const n=cn();n&&e.showDialog&&(this._openFallbackReportDialog=!1,this._cleanupHook=n.on("afterSendEvent",r=>{!r.type&&this._lastEventId&&r.event_id===this._lastEventId&&DV({...e.dialogOptions,eventId:this._lastEventId})}))}componentDidCatch(e,n){const{componentStack:r}=n,i=r??void 0,{beforeCapture:s,onError:o,showDialog:a,dialogOptions:c}=this.props;CT(l=>{s&&s(l,e,i);const d=this.props.handled!=null?this.props.handled:!!this.props.fallback,h=Eke(e,n,{mechanism:{handled:d}});o&&o(e,i,h),a&&(this._lastEventId=h,this._openFallbackReportDialog&&DV({...c,eventId:h})),this.setState({error:e,componentStack:r,eventId:h})})}componentDidMount(){const{onMount:e}=this.props;e&&e()}componentWillUnmount(){const{error:e,componentStack:n,eventId:r}=this.state,{onUnmount:i}=this.props;i&&i(e,n,r),this._cleanupHook&&(this._cleanupHook(),this._cleanupHook=void 0)}__init(){this.resetErrorBoundary=()=>{const{onReset:e}=this.props,{error:n,componentStack:r,eventId:i}=this.state;e&&e(n,r,i),this.setState(HV)}}render(){const{fallback:e,children:n}=this.props,r=this.state;if(r.error){let i;return typeof e=="function"?i=_.createElement(e,{error:r.error,componentStack:r.componentStack,resetError:this.resetErrorBoundary,eventId:r.eventId}):i=e,_.isValidElement(i)?i:(e&&pne&&De.warn("fallback did not produce a valid ReactElement"),null)}return typeof n=="function"?n():n}}let Ew,ww,Cw,Tw,cp,fg=!1;const mne=new WeakSet,k6=new Set;function kke(t,e){const n=vke({...t,instrumentPageLoad:!1,instrumentNavigation:!1}),{useEffect:r,useLocation:i,useNavigationType:s,createRoutesFromChildren:o,matchRoutes:a,stripBasename:c,instrumentPageLoad:l=!0,instrumentNavigation:d=!0}=t;return{...n,setup(){Ew=r,ww=i,Cw=s,cp=a,Tw=o,fg=c||!1},afterAllSetup(h){n.afterAllSetup(h);const m=Ze&&Ze.location&&Ze.location.pathname;l&&m&&fne(h,{name:m,attributes:{[la]:"url",[Ou]:"pageload",[qr]:`auto.pageload.react.reactrouter_v${e}`}}),d&&mne.add(h)}}}function xke(t){const{location:e,routes:n,navigationType:r,version:i,matches:s,basename:o,allRoutes:a}=t,c=Array.isArray(s)?s:cp(n,e,o),l=cn();if(!(!l||!mne.has(l))&&(r==="PUSH"||r==="POP")&&c){let d,h="url";const m=vne(e,a||n);m&&(d=Rb(iM(a||n,e)),h="route"),(!m||!d)&&([d,h]=bne(n,e,c,o)),hne(l,{name:d,attributes:{[la]:h,[Ou]:"navigation",[qr]:`auto.navigation.react.reactrouter_v${i}`}})}}function FC(t,e){if(!e||e==="/"||!t.toLowerCase().startsWith(e.toLowerCase()))return t;const n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?t:t.slice(n)||"/"}function Ake(t,e,n){const r=t||fg?FC(e,n):e;return[r[r.length-1]==="/"||r.slice(-2)==="/*"?r.slice(0,-1):r,"route"]}function gne(t){return t.endsWith("*")}function VV(t,e){return gne(t)&&e.route.children&&e.route.children.length>0||!1}function Pke(t){return!!(!t.children&&t.element&&t.path&&t.path.endsWith("/*"))}function vne(t,e){const n=cp(e,t);if(n){for(const r of n)if(Pke(r.route)&&Oke(r))return!0}return!1}function yne(t,e=new Set){return e.has(t)||(e.add(t),t.children&&!t.index&&t.children.forEach(n=>{yne(n,e).forEach(i=>e.add(i))})),e}function Lke(t){return Mke(t.route.path||"")}function Oke(t){return t.params["*"]||""}function Mke(t){return t[t.length-1]==="*"?t.slice(0,-1):t}function Uy(t){return t[t.length-1]==="/"?t.slice(0,-1):t}function Rb(t){return t[0]==="/"?t:`/${t}`}function iM(t,e){const n=cp(t,e);if(!n||n.length===0)return"";for(const r of n)if(r.route.path&&r.route.path!=="*"){const i=Lke(r),s=FC(e.pathname,Rb(r.pathnameBase));return Uy(Uy(i||"")+Rb(iM(t.filter(o=>o!==r.route),{pathname:s})))}return""}function bne(t,e,n,r=""){if(!t||t.length===0)return[fg?FC(e.pathname,r):e.pathname,"url"];let i="";if(n)for(const o of n){const a=o.route;if(a){if(a.index)return Ake(i,o.pathname,r);const c=a.path;if(c&&!VV(c,o)){const l=c[0]==="/"||i[i.length-1]==="/"?c:`/${c}`;if(i=Uy(i)+Rb(l),Uy(e.pathname)===Uy(r+o.pathname))return CV(i)!==CV(o.pathname)&&!gne(i)?[(fg?"":r)+l,"route"]:(VV(i,o)&&(i=i.slice(0,-1)),[(fg?"":r)+i,"route"])}}}return[fg?FC(e.pathname,r):e.pathname||"/","url"]}function Dke(t,e,n,r,i,s){const o=Array.isArray(r)?r:cp(s||n,e,i);if(o){let a,c="url";const l=vne(e,s||n);l&&(a=Rb(iM(s||n,e)),c="route"),(!l||!a)&&([a,c]=bne(n,e,o,i)),Ln().setTransactionName(a||"/"),t&&(t.updateName(a),t.setAttribute(la,c))}}function Nke(t,e){if(!Ew||!ww||!Cw||!Tw||!cp)return pne&&De.warn(`reactRouterV6Instrumentation was unable to wrap Routes because of one or more missing parameters.
      useEffect: ${Ew}. useLocation: ${ww}. useNavigationType: ${Cw}.
      createRoutesFromChildren: ${Tw}. matchRoutes: ${cp}.`),t;const n=r=>{const i=_.useRef(!0),s=ww(),o=Cw();return Ew(()=>{const a=Tw(r.children);i.current?(a.forEach(c=>{yne(c).forEach(d=>{k6.add(d)})}),Dke(Uke(),s,a,void 0,void 0,Array.from(k6)),i.current=!1):xke({location:s,routes:a,navigationType:o,version:e,allRoutes:Array.from(k6)})},[s,o]),_.createElement(t,{...r})};return Ike(n,t),n}function Uke(){const t=Ki(),e=t?Vi(t):void 0;if(!e)return;const n=on(e).op;return n==="navigation"||n==="pageload"?e:void 0}function jke(t){return kke(t,"7")}function Fke(t){return Nke(t,"7")}var x6={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var qV;function $ke(){return qV||(qV=1,function(t){(function(){var e={}.hasOwnProperty;function n(){for(var s="",o=0;o<arguments.length;o++){var a=arguments[o];a&&(s=i(s,r(a)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return n.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var o="";for(var a in s)e.call(s,a)&&s[a]&&(o=i(o,a));return o}function i(s,o){return o?s?s+" "+o:s+o:s}t.exports?(n.default=n,t.exports=n):window.classNames=n})()}(x6)),x6.exports}var Bke=$ke();const Oe=cl(Bke);function _ne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"m10.6 13.8-2.15-2.15a.95.95 0 0 0-.7-.275.95.95 0 0 0-.7.275.95.95 0 0 0-.275.7q0 .425.275.7L9.9 15.9q.3.3.7.3t.7-.3l5.65-5.65a.95.95 0 0 0 .275-.7.95.95 0 0 0-.275-.7.95.95 0 0 0-.7-.275.95.95 0 0 0-.7.275zM12 22a9.7 9.7 0 0 1-3.9-.788 10.1 10.1 0 0 1-3.175-2.137q-1.35-1.35-2.137-3.175A9.7 9.7 0 0 1 2 12q0-2.075.788-3.9a10.1 10.1 0 0 1 2.137-3.175q1.35-1.35 3.175-2.137A9.7 9.7 0 0 1 12 2q2.075 0 3.9.788a10.1 10.1 0 0 1 3.175 2.137q1.35 1.35 2.137 3.175A9.7 9.7 0 0 1 22 12a9.7 9.7 0 0 1-.788 3.9 10.1 10.1 0 0 1-2.137 3.175q-1.35 1.35-3.175 2.137A9.7 9.7 0 0 1 12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4 6.325 6.325 4 12t2.325 5.675T12 20"})})}_ne.displayName="CheckCircleIcon";const Hke=_.forwardRef(_ne);function Sne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12 17q.424 0 .713-.288A.97.97 0 0 0 13 16a.97.97 0 0 0-.287-.713A.97.97 0 0 0 12 15a.97.97 0 0 0-.713.287A.97.97 0 0 0 11 16q0 .424.287.712.288.288.713.288m0-4q.424 0 .713-.287A.97.97 0 0 0 13 12V8a.97.97 0 0 0-.287-.713A.97.97 0 0 0 12 7a.97.97 0 0 0-.713.287A.97.97 0 0 0 11 8v4q0 .424.287.713.288.287.713.287m0 9a9.7 9.7 0 0 1-3.9-.788 10.1 10.1 0 0 1-3.175-2.137q-1.35-1.35-2.137-3.175A9.7 9.7 0 0 1 2 12q0-2.075.788-3.9a10.1 10.1 0 0 1 2.137-3.175q1.35-1.35 3.175-2.137A9.7 9.7 0 0 1 12 2q2.075 0 3.9.788a10.1 10.1 0 0 1 3.175 2.137q1.35 1.35 2.137 3.175A9.7 9.7 0 0 1 22 12a9.7 9.7 0 0 1-.788 3.9 10.1 10.1 0 0 1-2.137 3.175q-1.35 1.35-3.175 2.137A9.7 9.7 0 0 1 12 22"})})}Sne.displayName="ErrorSolidIcon";const PT=_.forwardRef(Sne);function Ene(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M11.288 7.288A.97.97 0 0 1 12 7q.424 0 .713.287Q13 7.576 13 8t-.287.713A.97.97 0 0 1 12 9a.97.97 0 0 1-.713-.287A.97.97 0 0 1 11 8q0-.424.287-.713m.001 4.001A.97.97 0 0 1 12 11q.424 0 .713.287.287.288.287.713v4q0 .424-.287.712A.97.97 0 0 1 12 17a.97.97 0 0 1-.713-.288A.97.97 0 0 1 11 16v-4q0-.424.287-.713"}),E.jsx("path",{fillRule:"evenodd",d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10m-2 0a8 8 0 1 1-16 0 8 8 0 0 1 16 0",clipRule:"evenodd"})]})}Ene.displayName="InfoIcon";const Vke=_.forwardRef(Ene);function wne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M6.293 6.293a1 1 0 0 1 1.414 0L12 10.586l4.293-4.293a1 1 0 1 1 1.414 1.414L13.414 12l4.293 4.293a1 1 0 0 1-1.414 1.414L12 13.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 12 6.293 7.707a1 1 0 0 1 0-1.414"})})}wne.displayName="CloseIcon";const LT=_.forwardRef(wne),qke="_alert_zx76t_10",Gke="_content_zx76t_37",Kke="_icon_zx76t_48",zke="_actions_zx76t_64",Um={alert:qke,content:Gke,"text-content":"_text-content_zx76t_44",icon:Kke,actions:zke},Wke="_typography_6v6n8_153",GV={"font-body-xs-regular":"_font-body-xs-regular_6v6n8_12","font-body-xs-semibold":"_font-body-xs-semibold_6v6n8_17","font-body-xs-medium":"_font-body-xs-medium_6v6n8_22","font-body-sm-regular":"_font-body-sm-regular_6v6n8_31","font-body-sm-semibold":"_font-body-sm-semibold_6v6n8_36","font-body-sm-medium":"_font-body-sm-medium_6v6n8_41","font-body-md-regular":"_font-body-md-regular_6v6n8_50","font-body-md-semibold":"_font-body-md-semibold_6v6n8_55","font-body-md-medium":"_font-body-md-medium_6v6n8_60","font-body-lg-regular":"_font-body-lg-regular_6v6n8_69","font-body-lg-semibold":"_font-body-lg-semibold_6v6n8_74","font-body-lg-medium":"_font-body-lg-medium_6v6n8_79","font-heading-sm-regular":"_font-heading-sm-regular_6v6n8_88","font-heading-sm-semibold":"_font-heading-sm-semibold_6v6n8_93","font-heading-sm-medium":"_font-heading-sm-medium_6v6n8_98","font-heading-md-regular":"_font-heading-md-regular_6v6n8_107","font-heading-md-semibold":"_font-heading-md-semibold_6v6n8_112","font-heading-lg-regular":"_font-heading-lg-regular_6v6n8_121","font-heading-lg-semibold":"_font-heading-lg-semibold_6v6n8_126","font-heading-xl-regular":"_font-heading-xl-regular_6v6n8_135","font-heading-xl-semibold":"_font-heading-xl-semibold_6v6n8_140",typography:Wke},Cne=({as:t,children:e,type:n="body",weight:r="regular",size:i="md",className:s,...o})=>{const a=t||"p";return E.jsx(a,{...o,className:Oe(GV.typography,GV[`font-${n}-${i}-${r}`],s),children:e})},an=({as:t="p",children:e,...n})=>E.jsx(Cne,{as:t,type:"body",...n,children:e}),Yke="_destructive_1pz9o_95",A6={"icon-button":"_icon-button_1pz9o_8","no-background":"_no-background_1pz9o_42",destructive:Yke},Tne=_.forwardRef(function({as:e,children:n,className:r,disabled:i,...s},o){const a=e||"button",{onClick:c,onSubmit:l,onPointerDown:d,onPointerUp:h,onKeyDown:m,onKeyUp:g,onKeyPress:y,...v}=s,w=i?{}:{onClick:c,onSubmit:l,onPointerDown:d,onPointerUp:h,onKeyDown:m,onKeyUp:g,onKeyPress:y};return E.jsx(a,{...v,ref:o,className:r,role:e==="a"?"link":"button",tabIndex:0,...w,"aria-disabled":i,children:n})}),Xke={"indicator-icon":"_indicator-icon_zr2a0_17"},Jke=_.forwardRef(function({children:e,className:n,size:r="100%",colour:i,indicator:s},o){const a=Oe(Xke["indicator-icon"],n);return E.jsx("div",{ref:o,className:a,"data-indicator":s,style:{"--cpd-icon-button-size":r,"--cpd-color-icon-tertiary":i},children:Ce.Children.only(e)})}),Rne=_.createContext(null);function sM(){const t=_.useContext(Rne);if(t==null)throw new Error("Tooltip components must be wrapped in <Tooltip />");return t}function OT(){return typeof window<"u"}function t0(t){return Ine(t)?(t.nodeName||"").toLowerCase():"#document"}function Ws(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function ml(t){var e;return(e=(Ine(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function Ine(t){return OT()?t instanceof Node||t instanceof Ws(t).Node:!1}function jn(t){return OT()?t instanceof Element||t instanceof Ws(t).Element:!1}function Io(t){return OT()?t instanceof HTMLElement||t instanceof Ws(t).HTMLElement:!1}function IP(t){return!OT()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Ws(t).ShadowRoot}function R_(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=ko(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(i)}function Qke(t){return["table","td","th"].includes(t0(t))}function MT(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function oM(t){const e=DT(),n=jn(t)?ko(t):t;return["transform","translate","scale","rotate","perspective"].some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function Zke(t){let e=Du(t);for(;Io(e)&&!Su(e);){if(oM(e))return e;if(MT(e))return null;e=Du(e)}return null}function DT(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Su(t){return["html","body","#document"].includes(t0(t))}function ko(t){return Ws(t).getComputedStyle(t)}function NT(t){return jn(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Du(t){if(t0(t)==="html")return t;const e=t.assignedSlot||t.parentNode||IP(t)&&t.host||ml(t);return IP(e)?e.host:e}function kne(t){const e=Du(t);return Su(e)?t.ownerDocument?t.ownerDocument.body:t.body:Io(e)&&R_(e)?e:kne(e)}function sf(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=kne(t),s=i===((r=t.ownerDocument)==null?void 0:r.body),o=Ws(i);if(s){const a=kP(o);return e.concat(o,o.visualViewport||[],R_(i)?i:[],a&&n?sf(a):[])}return e.concat(i,sf(i,[],n))}function kP(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function xP(t){let e=t.activeElement;for(;((n=e)==null||(n=n.shadowRoot)==null?void 0:n.activeElement)!=null;){var n;e=e.shadowRoot.activeElement}return e}function pv(t,e){if(!t||!e)return!1;const n=e.getRootNode==null?void 0:e.getRootNode();if(t.contains(e))return!0;if(n&&IP(n)){let r=e;for(;r;){if(t===r)return!0;r=r.parentNode||r.host}}return!1}function xne(){const t=navigator.userAgentData;return t!=null&&t.platform?t.platform:navigator.platform}function Ane(){const t=navigator.userAgentData;return t&&Array.isArray(t.brands)?t.brands.map(e=>{let{brand:n,version:r}=e;return n+"/"+r}).join(" "):navigator.userAgent}function e6e(t){return n6e()?!1:!KV()&&t.width===0&&t.height===0||KV()&&t.width===1&&t.height===1&&t.pressure===0&&t.detail===0&&t.pointerType==="mouse"||t.width<1&&t.height<1&&t.pressure===0&&t.detail===0&&t.pointerType==="touch"}function Pne(){return/apple/i.test(navigator.vendor)}function KV(){const t=/android/i;return t.test(xne())||t.test(Ane())}function t6e(){return xne().toLowerCase().startsWith("mac")&&!navigator.maxTouchPoints}function n6e(){return Ane().includes("jsdom/")}function AP(t,e){const n=["mouse","pen"];return n.push("",void 0),n.includes(t)}function r6e(t){return"nativeEvent"in t}function i6e(t){return t.matches("html,body")}function zd(t){return t?.ownerDocument||document}function P6(t,e){if(e==null)return!1;if("composedPath"in t)return t.composedPath().includes(e);const n=t;return n.target!=null&&e.contains(n.target)}function ng(t){return"composedPath"in t?t.composedPath()[0]:t.target}const s6e="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])";function o6e(t){return Io(t)&&t.matches(s6e)}const a6e=["top","right","bottom","left"],_f=Math.min,Eo=Math.max,$C=Math.round,W2=Math.floor,Zc=t=>({x:t,y:t}),c6e={left:"right",right:"left",bottom:"top",top:"bottom"},l6e={start:"end",end:"start"};function PP(t,e,n){return Eo(t,_f(e,n))}function Nu(t,e){return typeof t=="function"?t(e):t}function Uu(t){return t.split("-")[0]}function n0(t){return t.split("-")[1]}function aM(t){return t==="x"?"y":"x"}function cM(t){return t==="y"?"height":"width"}function Sf(t){return["top","bottom"].includes(Uu(t))?"y":"x"}function lM(t){return aM(Sf(t))}function u6e(t,e,n){n===void 0&&(n=!1);const r=n0(t),i=lM(t),s=cM(i);let o=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=BC(o)),[o,BC(o)]}function d6e(t){const e=BC(t);return[LP(t),e,LP(e)]}function LP(t){return t.replace(/start|end/g,e=>l6e[e])}function f6e(t,e,n){const r=["left","right"],i=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return n?e?i:r:e?r:i;case"left":case"right":return e?s:o;default:return[]}}function h6e(t,e,n,r){const i=n0(t);let s=f6e(Uu(t),n==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(LP)))),s}function BC(t){return t.replace(/left|right|bottom|top/g,e=>c6e[e])}function p6e(t){return{top:0,right:0,bottom:0,left:0,...t}}function Lne(t){return typeof t!="number"?p6e(t):{top:t,right:t,bottom:t,left:t}}function HC(t){const{x:e,y:n,width:r,height:i}=t;return{width:r,height:i,top:n,left:e,right:e+r,bottom:n+i,x:e,y:n}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var m6e=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],OP=m6e.join(","),One=typeof Element>"u",Ib=One?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,VC=!One&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},qC=function t(e,n){var r;n===void 0&&(n=!0);var i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=i===""||i==="true",o=s||n&&e&&t(e.parentNode);return o},g6e=function(e){var n,r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"contenteditable");return r===""||r==="true"},v6e=function(e,n,r){if(qC(e))return[];var i=Array.prototype.slice.apply(e.querySelectorAll(OP));return n&&Ib.call(e,OP)&&i.unshift(e),i=i.filter(r),i},y6e=function t(e,n,r){for(var i=[],s=Array.from(e);s.length;){var o=s.shift();if(!qC(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),c=a.length?a:o.children,l=t(c,!0,r);r.flatten?i.push.apply(i,l):i.push({scopeParent:o,candidates:l})}else{var d=Ib.call(o,OP);d&&r.filter(o)&&(n||!e.includes(o))&&i.push(o);var h=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),m=!qC(h,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(h&&m){var g=t(h===!0?o.children:h.children,!0,r);r.flatten?i.push.apply(i,g):i.push({scopeParent:o,candidates:g})}else s.unshift.apply(s,o.children)}}return i},Mne=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},Dne=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||g6e(e))&&!Mne(e)?0:e.tabIndex},b6e=function(e,n){var r=Dne(e);return r<0&&n&&!Mne(e)?0:r},_6e=function(e,n){return e.tabIndex===n.tabIndex?e.documentOrder-n.documentOrder:e.tabIndex-n.tabIndex},Nne=function(e){return e.tagName==="INPUT"},S6e=function(e){return Nne(e)&&e.type==="hidden"},E6e=function(e){var n=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return n},w6e=function(e,n){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===n)return e[r]},C6e=function(e){if(!e.name)return!0;var n=e.form||VC(e),r=function(a){return n.querySelectorAll('input[type="radio"][name="'+a+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=r(window.CSS.escape(e.name));else try{i=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=w6e(i,e.form);return!s||s===e},T6e=function(e){return Nne(e)&&e.type==="radio"},R6e=function(e){return T6e(e)&&!C6e(e)},I6e=function(e){var n,r=e&&VC(e),i=(n=r)===null||n===void 0?void 0:n.host,s=!1;if(r&&r!==e){var o,a,c;for(s=!!((o=i)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(i)||e!=null&&(c=e.ownerDocument)!==null&&c!==void 0&&c.contains(e));!s&&i;){var l,d,h;r=VC(i),i=(l=r)===null||l===void 0?void 0:l.host,s=!!((d=i)!==null&&d!==void 0&&(h=d.ownerDocument)!==null&&h!==void 0&&h.contains(i))}}return s},zV=function(e){var n=e.getBoundingClientRect(),r=n.width,i=n.height;return r===0&&i===0},k6e=function(e,n){var r=n.displayCheck,i=n.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=Ib.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(Ib.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof i=="function"){for(var a=e;e;){var c=e.parentElement,l=VC(e);if(c&&!c.shadowRoot&&i(c)===!0)return zV(e);e.assignedSlot?e=e.assignedSlot:!c&&l!==e.ownerDocument?e=l.host:e=c}e=a}if(I6e(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return zV(e);return!1},x6e=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var n=e.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var r=0;r<n.children.length;r++){var i=n.children.item(r);if(i.tagName==="LEGEND")return Ib.call(n,"fieldset[disabled] *")?!0:!i.contains(e)}return!0}n=n.parentElement}return!1},A6e=function(e,n){return!(n.disabled||qC(n)||S6e(n)||k6e(n,e)||E6e(n)||x6e(n))},WV=function(e,n){return!(R6e(n)||Dne(n)<0||!A6e(e,n))},P6e=function(e){var n=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},L6e=function t(e){var n=[],r=[];return e.forEach(function(i,s){var o=!!i.scopeParent,a=o?i.scopeParent:i,c=b6e(a,o),l=o?t(i.candidates):a;c===0?o?n.push.apply(n,l):n.push(a):r.push({documentOrder:s,tabIndex:c,item:i,isScope:o,content:l})}),r.sort(_6e).reduce(function(i,s){return s.isScope?i.push.apply(i,s.content):i.push(s.content),i},[]).concat(n)},Une=function(e,n){n=n||{};var r;return n.getShadowRoot?r=y6e([e],n.includeContainer,{filter:WV.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:P6e}):r=v6e(e,n.includeContainer,WV.bind(null,n)),L6e(r)};function YV(t,e,n){let{reference:r,floating:i}=t;const s=Sf(e),o=lM(e),a=cM(o),c=Uu(e),l=s==="y",d=r.x+r.width/2-i.width/2,h=r.y+r.height/2-i.height/2,m=r[a]/2-i[a]/2;let g;switch(c){case"top":g={x:d,y:r.y-i.height};break;case"bottom":g={x:d,y:r.y+r.height};break;case"right":g={x:r.x+r.width,y:h};break;case"left":g={x:r.x-i.width,y:h};break;default:g={x:r.x,y:r.y}}switch(n0(e)){case"start":g[o]-=m*(n&&l?-1:1);break;case"end":g[o]+=m*(n&&l?-1:1);break}return g}const O6e=async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(e));let l=await o.getElementRects({reference:t,floating:e,strategy:i}),{x:d,y:h}=YV(l,r,c),m=r,g={},y=0;for(let v=0;v<a.length;v++){const{name:w,fn:S}=a[v],{x:R,y:x,data:T,reset:I}=await S({x:d,y:h,initialPlacement:r,placement:m,strategy:i,middlewareData:g,rects:l,platform:o,elements:{reference:t,floating:e}});d=R??d,h=x??h,g={...g,[w]:{...g[w],...T}},I&&y<=50&&(y++,typeof I=="object"&&(I.placement&&(m=I.placement),I.rects&&(l=I.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:i}):I.rects),{x:d,y:h}=YV(l,m,c)),v=-1)}return{x:d,y:h,placement:m,strategy:i,middlewareData:g}};async function kb(t,e){var n;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:d="viewport",elementContext:h="floating",altBoundary:m=!1,padding:g=0}=Nu(e,t),y=Lne(g),w=a[m?h==="floating"?"reference":"floating":h],S=HC(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(w)))==null||n?w:w.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:l,rootBoundary:d,strategy:c})),R=h==="floating"?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,x=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),T=await(s.isElement==null?void 0:s.isElement(x))?await(s.getScale==null?void 0:s.getScale(x))||{x:1,y:1}:{x:1,y:1},I=HC(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:R,offsetParent:x,strategy:c}):R);return{top:(S.top-I.top+y.top)/T.y,bottom:(I.bottom-S.bottom+y.bottom)/T.y,left:(S.left-I.left+y.left)/T.x,right:(I.right-S.right+y.right)/T.x}}const M6e=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:i,rects:s,platform:o,elements:a,middlewareData:c}=e,{element:l,padding:d=0}=Nu(t,e)||{};if(l==null)return{};const h=Lne(d),m={x:n,y:r},g=lM(i),y=cM(g),v=await o.getDimensions(l),w=g==="y",S=w?"top":"left",R=w?"bottom":"right",x=w?"clientHeight":"clientWidth",T=s.reference[y]+s.reference[g]-m[g]-s.floating[y],I=m[g]-s.reference[g],k=await(o.getOffsetParent==null?void 0:o.getOffsetParent(l));let A=k?k[x]:0;(!A||!await(o.isElement==null?void 0:o.isElement(k)))&&(A=a.floating[x]||s.floating[y]);const O=T/2-I/2,D=A/2-v[y]/2-1,N=_f(h[S],D),U=_f(h[R],D),$=N,K=A-v[y]-U,Y=A/2-v[y]/2+O,G=PP($,Y,K),F=!c.arrow&&n0(i)!=null&&Y!==G&&s.reference[y]/2-(Y<$?N:U)-v[y]/2<0,q=F?Y<$?Y-$:Y-K:0;return{[g]:m[g]+q,data:{[g]:G,centerOffset:Y-G-q,...F&&{alignmentOffset:q}},reset:F}}}),D6e=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:c,elements:l}=e,{mainAxis:d=!0,crossAxis:h=!0,fallbackPlacements:m,fallbackStrategy:g="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:v=!0,...w}=Nu(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const S=Uu(i),R=Sf(a),x=Uu(a)===a,T=await(c.isRTL==null?void 0:c.isRTL(l.floating)),I=m||(x||!v?[BC(a)]:d6e(a)),k=y!=="none";!m&&k&&I.push(...h6e(a,v,y,T));const A=[a,...I],O=await kb(e,w),D=[];let N=((r=s.flip)==null?void 0:r.overflows)||[];if(d&&D.push(O[S]),h){const Y=u6e(i,o,T);D.push(O[Y[0]],O[Y[1]])}if(N=[...N,{placement:i,overflows:D}],!D.every(Y=>Y<=0)){var U,$;const Y=(((U=s.flip)==null?void 0:U.index)||0)+1,G=A[Y];if(G)return{data:{index:Y,overflows:N},reset:{placement:G}};let F=($=N.filter(q=>q.overflows[0]<=0).sort((q,z)=>q.overflows[1]-z.overflows[1])[0])==null?void 0:$.placement;if(!F)switch(g){case"bestFit":{var K;const q=(K=N.filter(z=>{if(k){const W=Sf(z.placement);return W===R||W==="y"}return!0}).map(z=>[z.placement,z.overflows.filter(W=>W>0).reduce((W,V)=>W+V,0)]).sort((z,W)=>z[1]-W[1])[0])==null?void 0:K[0];q&&(F=q);break}case"initialPlacement":F=a;break}if(i!==F)return{reset:{placement:F}}}return{}}}};function XV(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function JV(t){return a6e.some(e=>t[e]>=0)}const N6e=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...i}=Nu(t,e);switch(r){case"referenceHidden":{const s=await kb(e,{...i,elementContext:"reference"}),o=XV(s,n.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:JV(o)}}}case"escaped":{const s=await kb(e,{...i,altBoundary:!0}),o=XV(s,n.floating);return{data:{escapedOffsets:o,escaped:JV(o)}}}default:return{}}}}};async function U6e(t,e){const{placement:n,platform:r,elements:i}=t,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=Uu(n),a=n0(n),c=Sf(n)==="y",l=["left","top"].includes(o)?-1:1,d=s&&c?-1:1,h=Nu(e,t);let{mainAxis:m,crossAxis:g,alignmentAxis:y}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return a&&typeof y=="number"&&(g=a==="end"?y*-1:y),c?{x:g*d,y:m*l}:{x:m*l,y:g*d}}const j6e=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:i,y:s,placement:o,middlewareData:a}=e,c=await U6e(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+c.x,y:s+c.y,data:{...c,placement:o}}}}},F6e=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:w=>{let{x:S,y:R}=w;return{x:S,y:R}}},...c}=Nu(t,e),l={x:n,y:r},d=await kb(e,c),h=Sf(Uu(i)),m=aM(h);let g=l[m],y=l[h];if(s){const w=m==="y"?"top":"left",S=m==="y"?"bottom":"right",R=g+d[w],x=g-d[S];g=PP(R,g,x)}if(o){const w=h==="y"?"top":"left",S=h==="y"?"bottom":"right",R=y+d[w],x=y-d[S];y=PP(R,y,x)}const v=a.fn({...e,[m]:g,[h]:y});return{...v,data:{x:v.x-n,y:v.y-r,enabled:{[m]:s,[h]:o}}}}}},$6e=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:i,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:c=!0,crossAxis:l=!0}=Nu(t,e),d={x:n,y:r},h=Sf(i),m=aM(h);let g=d[m],y=d[h];const v=Nu(a,e),w=typeof v=="number"?{mainAxis:v,crossAxis:0}:{mainAxis:0,crossAxis:0,...v};if(c){const x=m==="y"?"height":"width",T=s.reference[m]-s.floating[x]+w.mainAxis,I=s.reference[m]+s.reference[x]-w.mainAxis;g<T?g=T:g>I&&(g=I)}if(l){var S,R;const x=m==="y"?"width":"height",T=["top","left"].includes(Uu(i)),I=s.reference[h]-s.floating[x]+(T&&((S=o.offset)==null?void 0:S[h])||0)+(T?0:w.crossAxis),k=s.reference[h]+s.reference[x]+(T?0:((R=o.offset)==null?void 0:R[h])||0)-(T?w.crossAxis:0);y<I?y=I:y>k&&(y=k)}return{[m]:g,[h]:y}}}},B6e=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:i,rects:s,platform:o,elements:a}=e,{apply:c=()=>{},...l}=Nu(t,e),d=await kb(e,l),h=Uu(i),m=n0(i),g=Sf(i)==="y",{width:y,height:v}=s.floating;let w,S;h==="top"||h==="bottom"?(w=h,S=m===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(S=h,w=m==="end"?"top":"bottom");const R=v-d.top-d.bottom,x=y-d.left-d.right,T=_f(v-d[w],R),I=_f(y-d[S],x),k=!e.middlewareData.shift;let A=T,O=I;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(O=x),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(A=R),k&&!m){const N=Eo(d.left,0),U=Eo(d.right,0),$=Eo(d.top,0),K=Eo(d.bottom,0);g?O=y-2*(N!==0||U!==0?N+U:Eo(d.left,d.right)):A=v-2*($!==0||K!==0?$+K:Eo(d.top,d.bottom))}await c({...e,availableWidth:O,availableHeight:A});const D=await o.getDimensions(a.floating);return y!==D.width||v!==D.height?{reset:{rects:!0}}:{}}}};function jne(t){const e=ko(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Io(t),s=i?t.offsetWidth:n,o=i?t.offsetHeight:r,a=$C(n)!==s||$C(r)!==o;return a&&(n=s,r=o),{width:n,height:r,$:a}}function uM(t){return jn(t)?t:t.contextElement}function Ng(t){const e=uM(t);if(!Io(e))return Zc(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:s}=jne(e);let o=(s?$C(n.width):n.width)/r,a=(s?$C(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const H6e=Zc(0);function Fne(t){const e=Ws(t);return!DT()||!e.visualViewport?H6e:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function V6e(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Ws(t)?!1:e}function lp(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),s=uM(t);let o=Zc(1);e&&(r?jn(r)&&(o=Ng(r)):o=Ng(t));const a=V6e(s,n,r)?Fne(s):Zc(0);let c=(i.left+a.x)/o.x,l=(i.top+a.y)/o.y,d=i.width/o.x,h=i.height/o.y;if(s){const m=Ws(s),g=r&&jn(r)?Ws(r):r;let y=m,v=kP(y);for(;v&&r&&g!==y;){const w=Ng(v),S=v.getBoundingClientRect(),R=ko(v),x=S.left+(v.clientLeft+parseFloat(R.paddingLeft))*w.x,T=S.top+(v.clientTop+parseFloat(R.paddingTop))*w.y;c*=w.x,l*=w.y,d*=w.x,h*=w.y,c+=x,l+=T,y=Ws(v),v=kP(y)}}return HC({width:d,height:h,x:c,y:l})}function dM(t,e){const n=NT(t).scrollLeft;return e?e.left+n:lp(ml(t)).left+n}function $ne(t,e,n){n===void 0&&(n=!1);const r=t.getBoundingClientRect(),i=r.left+e.scrollLeft-(n?0:dM(t,r)),s=r.top+e.scrollTop;return{x:i,y:s}}function q6e(t){let{elements:e,rect:n,offsetParent:r,strategy:i}=t;const s=i==="fixed",o=ml(r),a=e?MT(e.floating):!1;if(r===o||a&&s)return n;let c={scrollLeft:0,scrollTop:0},l=Zc(1);const d=Zc(0),h=Io(r);if((h||!h&&!s)&&((t0(r)!=="body"||R_(o))&&(c=NT(r)),Io(r))){const g=lp(r);l=Ng(r),d.x=g.x+r.clientLeft,d.y=g.y+r.clientTop}const m=o&&!h&&!s?$ne(o,c,!0):Zc(0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+d.x+m.x,y:n.y*l.y-c.scrollTop*l.y+d.y+m.y}}function G6e(t){return Array.from(t.getClientRects())}function K6e(t){const e=ml(t),n=NT(t),r=t.ownerDocument.body,i=Eo(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Eo(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-n.scrollLeft+dM(t);const a=-n.scrollTop;return ko(r).direction==="rtl"&&(o+=Eo(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}function z6e(t,e){const n=Ws(t),r=ml(t),i=n.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,c=0;if(i){s=i.width,o=i.height;const l=DT();(!l||l&&e==="fixed")&&(a=i.offsetLeft,c=i.offsetTop)}return{width:s,height:o,x:a,y:c}}function W6e(t,e){const n=lp(t,!0,e==="fixed"),r=n.top+t.clientTop,i=n.left+t.clientLeft,s=Io(t)?Ng(t):Zc(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,c=i*s.x,l=r*s.y;return{width:o,height:a,x:c,y:l}}function QV(t,e,n){let r;if(e==="viewport")r=z6e(t,n);else if(e==="document")r=K6e(ml(t));else if(jn(e))r=W6e(e,n);else{const i=Fne(t);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return HC(r)}function Bne(t,e){const n=Du(t);return n===e||!jn(n)||Su(n)?!1:ko(n).position==="fixed"||Bne(n,e)}function Y6e(t,e){const n=e.get(t);if(n)return n;let r=sf(t,[],!1).filter(a=>jn(a)&&t0(a)!=="body"),i=null;const s=ko(t).position==="fixed";let o=s?Du(t):t;for(;jn(o)&&!Su(o);){const a=ko(o),c=oM(o);!c&&a.position==="fixed"&&(i=null),(s?!c&&!i:!c&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||R_(o)&&!c&&Bne(t,o))?r=r.filter(d=>d!==o):i=a,o=Du(o)}return e.set(t,r),r}function X6e(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const o=[...n==="clippingAncestors"?MT(e)?[]:Y6e(e,this._c):[].concat(n),r],a=o[0],c=o.reduce((l,d)=>{const h=QV(e,d,i);return l.top=Eo(h.top,l.top),l.right=_f(h.right,l.right),l.bottom=_f(h.bottom,l.bottom),l.left=Eo(h.left,l.left),l},QV(e,a,i));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function J6e(t){const{width:e,height:n}=jne(t);return{width:e,height:n}}function Q6e(t,e,n){const r=Io(e),i=ml(e),s=n==="fixed",o=lp(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const c=Zc(0);if(r||!r&&!s)if((t0(e)!=="body"||R_(i))&&(a=NT(e)),r){const m=lp(e,!0,s,e);c.x=m.x+e.clientLeft,c.y=m.y+e.clientTop}else i&&(c.x=dM(i));const l=i&&!r&&!s?$ne(i,a):Zc(0),d=o.left+a.scrollLeft-c.x-l.x,h=o.top+a.scrollTop-c.y-l.y;return{x:d,y:h,width:o.width,height:o.height}}function L6(t){return ko(t).position==="static"}function ZV(t,e){if(!Io(t)||ko(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return ml(t)===n&&(n=n.ownerDocument.body),n}function Hne(t,e){const n=Ws(t);if(MT(t))return n;if(!Io(t)){let i=Du(t);for(;i&&!Su(i);){if(jn(i)&&!L6(i))return i;i=Du(i)}return n}let r=ZV(t,e);for(;r&&Qke(r)&&L6(r);)r=ZV(r,e);return r&&Su(r)&&L6(r)&&!oM(r)?n:r||Zke(t)||n}const Z6e=async function(t){const e=this.getOffsetParent||Hne,n=this.getDimensions,r=await n(t.floating);return{reference:Q6e(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function exe(t){return ko(t).direction==="rtl"}const txe={convertOffsetParentRelativeRectToViewportRelativeRect:q6e,getDocumentElement:ml,getClippingRect:X6e,getOffsetParent:Hne,getElementRects:Z6e,getClientRects:G6e,getDimensions:J6e,getScale:Ng,isElement:jn,isRTL:exe};function Vne(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function nxe(t,e){let n=null,r;const i=ml(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function o(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),s();const l=t.getBoundingClientRect(),{left:d,top:h,width:m,height:g}=l;if(a||e(),!m||!g)return;const y=W2(h),v=W2(i.clientWidth-(d+m)),w=W2(i.clientHeight-(h+g)),S=W2(d),x={rootMargin:-y+"px "+-v+"px "+-w+"px "+-S+"px",threshold:Eo(0,_f(1,c))||1};let T=!0;function I(k){const A=k[0].intersectionRatio;if(A!==c){if(!T)return o();A?o(!1,A):r=setTimeout(()=>{o(!1,1e-7)},1e3)}A===1&&!Vne(l,t.getBoundingClientRect())&&o(),T=!1}try{n=new IntersectionObserver(I,{...x,root:i.ownerDocument})}catch{n=new IntersectionObserver(I,x)}n.observe(t)}return o(!0),s}function qne(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=r,l=uM(t),d=i||s?[...l?sf(l):[],...sf(e)]:[];d.forEach(S=>{i&&S.addEventListener("scroll",n,{passive:!0}),s&&S.addEventListener("resize",n)});const h=l&&a?nxe(l,n):null;let m=-1,g=null;o&&(g=new ResizeObserver(S=>{let[R]=S;R&&R.target===l&&g&&(g.unobserve(e),cancelAnimationFrame(m),m=requestAnimationFrame(()=>{var x;(x=g)==null||x.observe(e)})),n()}),l&&!c&&g.observe(l),g.observe(e));let y,v=c?lp(t):null;c&&w();function w(){const S=lp(t);v&&!Vne(v,S)&&n(),v=S,y=requestAnimationFrame(w)}return n(),()=>{var S;d.forEach(R=>{i&&R.removeEventListener("scroll",n),s&&R.removeEventListener("resize",n)}),h?.(),(S=g)==null||S.disconnect(),g=null,c&&cancelAnimationFrame(y)}}const rxe=j6e,ixe=F6e,sxe=D6e,oxe=B6e,axe=N6e,eq=M6e,cxe=$6e,lxe=(t,e,n)=>{const r=new Map,i={platform:txe,...n},s={...i.platform,_c:r};return O6e(t,e,{...i,platform:s})};var Rw=typeof document<"u"?_.useLayoutEffect:_.useEffect;function GC(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,i;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!GC(t[r],e[r]))return!1;return!0}if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=n;r--!==0;){const s=i[r];if(!(s==="_owner"&&t.$$typeof)&&!GC(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function Gne(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function tq(t,e){const n=Gne(t);return Math.round(e*n)/n}function O6(t){const e=_.useRef(t);return Rw(()=>{e.current=t}),e}function Kne(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:s,floating:o}={},transform:a=!0,whileElementsMounted:c,open:l}=t,[d,h]=_.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[m,g]=_.useState(r);GC(m,r)||g(r);const[y,v]=_.useState(null),[w,S]=_.useState(null),R=_.useCallback(z=>{z!==k.current&&(k.current=z,v(z))},[]),x=_.useCallback(z=>{z!==A.current&&(A.current=z,S(z))},[]),T=s||y,I=o||w,k=_.useRef(null),A=_.useRef(null),O=_.useRef(d),D=c!=null,N=O6(c),U=O6(i),$=O6(l),K=_.useCallback(()=>{if(!k.current||!A.current)return;const z={placement:e,strategy:n,middleware:m};U.current&&(z.platform=U.current),lxe(k.current,A.current,z).then(W=>{const V={...W,isPositioned:$.current!==!1};Y.current&&!GC(O.current,V)&&(O.current=V,qv.flushSync(()=>{h(V)}))})},[m,e,n,U,$]);Rw(()=>{l===!1&&O.current.isPositioned&&(O.current.isPositioned=!1,h(z=>({...z,isPositioned:!1})))},[l]);const Y=_.useRef(!1);Rw(()=>(Y.current=!0,()=>{Y.current=!1}),[]),Rw(()=>{if(T&&(k.current=T),I&&(A.current=I),T&&I){if(N.current)return N.current(T,I,K);K()}},[T,I,K,N,D]);const G=_.useMemo(()=>({reference:k,floating:A,setReference:R,setFloating:x}),[R,x]),F=_.useMemo(()=>({reference:T,floating:I}),[T,I]),q=_.useMemo(()=>{const z={position:n,left:0,top:0};if(!F.floating)return z;const W=tq(F.floating,d.x),V=tq(F.floating,d.y);return a?{...z,transform:"translate("+W+"px, "+V+"px)",...Gne(F.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:W,top:V}},[n,a,F.floating,d.x,d.y]);return _.useMemo(()=>({...d,update:K,refs:G,elements:F,floatingStyles:q}),[d,K,G,F,q])}const uxe=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:i}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?eq({element:r.current,padding:i}).fn(n):{}:r?eq({element:r,padding:i}).fn(n):{}}}},zne=(t,e)=>({...rxe(t),options:[t,e]}),Wne=(t,e)=>({...ixe(t),options:[t,e]}),dxe=(t,e)=>({...cxe(t),options:[t,e]}),Yne=(t,e)=>({...sxe(t),options:[t,e]}),fxe=(t,e)=>({...oxe(t),options:[t,e]}),hxe=(t,e)=>({...axe(t),options:[t,e]}),Xne=(t,e)=>({...uxe(t),options:[t,e]});function Jne(t){return _.useMemo(()=>t.every(e=>e==null)?null:e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})},t)}const Qne={...m_},pxe=Qne.useInsertionEffect,mxe=pxe||(t=>t());function lu(t){const e=_.useRef(()=>{});return mxe(()=>{e.current=t}),_.useCallback(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e.current==null?void 0:e.current(...r)},[])}var ys=typeof document<"u"?_.useLayoutEffect:_.useEffect;let nq=!1,gxe=0;const rq=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+gxe++;function vxe(){const[t,e]=_.useState(()=>nq?rq():void 0);return ys(()=>{t==null&&e(rq())},[]),_.useEffect(()=>{nq=!0},[]),t}const yxe=Qne.useId,mv=yxe||vxe,bxe=_.forwardRef(function(e,n){const{context:{placement:r,elements:{floating:i},middlewareData:{arrow:s,shift:o}},width:a=14,height:c=7,tipRadius:l=0,strokeWidth:d=0,staticOffset:h,stroke:m,d:g,style:{transform:y,...v}={},...w}=e,S=mv(),[R,x]=_.useState(!1);if(ys(()=>{if(!i)return;ko(i).direction==="rtl"&&x(!0)},[i]),!i)return null;const[T,I]=r.split("-"),k=T==="top"||T==="bottom";let A=h;(k&&o!=null&&o.x||!k&&o!=null&&o.y)&&(A=null);const O=d*2,D=O/2,N=a/2*(l/-8+1),U=c/2*l/4,$=!!g,K=A&&I==="end"?"bottom":"top";let Y=A&&I==="end"?"right":"left";A&&R&&(Y=I==="end"?"left":"right");const G=s?.x!=null?A||s.x:"",F=s?.y!=null?A||s.y:"",q=g||"M0,0"+(" H"+a)+(" L"+(a-N)+","+(c-U))+(" Q"+a/2+","+c+" "+N+","+(c-U))+" Z",z={top:$?"rotate(180deg)":"",left:$?"rotate(90deg)":"rotate(-90deg)",bottom:$?"":"rotate(180deg)",right:$?"rotate(-90deg)":"rotate(90deg)"}[T];return E.jsxs("svg",{...w,"aria-hidden":!0,ref:n,width:$?a:a+O,height:a,viewBox:"0 0 "+a+" "+(c>a?c:a),style:{position:"absolute",pointerEvents:"none",[Y]:G,[K]:F,[T]:k||$?"100%":"calc(100% - "+O/2+"px)",transform:[z,y].filter(W=>!!W).join(" "),...v},children:[O>0&&E.jsx("path",{clipPath:"url(#"+S+")",fill:"none",stroke:m,strokeWidth:O+(g?0:1),d:q}),E.jsx("path",{stroke:O&&!g?w.fill:"none",d:q}),E.jsx("clipPath",{id:S,children:E.jsx("rect",{x:-D,y:D*($?-1:1),width:a+O,height:a})})]})});function _xe(){const t=new Map;return{emit(e,n){var r;(r=t.get(e))==null||r.forEach(i=>i(n))},on(e,n){t.set(e,[...t.get(e)||[],n])},off(e,n){var r;t.set(e,((r=t.get(e))==null?void 0:r.filter(i=>i!==n))||[])}}}const Sxe=_.createContext(null),Exe=_.createContext(null),fM=()=>{var t;return((t=_.useContext(Sxe))==null?void 0:t.id)||null},hM=()=>_.useContext(Exe);function I_(t){return"data-floating-ui-"+t}function M6(t){const e=_.useRef(t);return ys(()=>{e.current=t}),e}const iq=I_("safe-polygon");function Iw(t,e,n){return n&&!AP(n)?0:typeof t=="number"?t:t?.[e]}function wxe(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,dataRef:i,events:s,elements:o}=t,{enabled:a=!0,delay:c=0,handleClose:l=null,mouseOnly:d=!1,restMs:h=0,move:m=!0}=e,g=hM(),y=fM(),v=M6(l),w=M6(c),S=M6(n),R=_.useRef(),x=_.useRef(-1),T=_.useRef(),I=_.useRef(-1),k=_.useRef(!0),A=_.useRef(!1),O=_.useRef(()=>{}),D=_.useRef(!1),N=_.useCallback(()=>{var q;const z=(q=i.current.openEvent)==null?void 0:q.type;return z?.includes("mouse")&&z!=="mousedown"},[i]);_.useEffect(()=>{if(!a)return;function q(z){let{open:W}=z;W||(clearTimeout(x.current),clearTimeout(I.current),k.current=!0,D.current=!1)}return s.on("openchange",q),()=>{s.off("openchange",q)}},[a,s]),_.useEffect(()=>{if(!a||!v.current||!n)return;function q(W){N()&&r(!1,W,"hover")}const z=zd(o.floating).documentElement;return z.addEventListener("mouseleave",q),()=>{z.removeEventListener("mouseleave",q)}},[o.floating,n,r,a,v,N]);const U=_.useCallback(function(q,z,W){z===void 0&&(z=!0),W===void 0&&(W="hover");const V=Iw(w.current,"close",R.current);V&&!T.current?(clearTimeout(x.current),x.current=window.setTimeout(()=>r(!1,q,W),V)):z&&(clearTimeout(x.current),r(!1,q,W))},[w,r]),$=lu(()=>{O.current(),T.current=void 0}),K=lu(()=>{if(A.current){const q=zd(o.floating).body;q.style.pointerEvents="",q.removeAttribute(iq),A.current=!1}}),Y=lu(()=>i.current.openEvent?["click","mousedown"].includes(i.current.openEvent.type):!1);_.useEffect(()=>{if(!a)return;function q(X){if(clearTimeout(x.current),k.current=!1,d&&!AP(R.current)||h>0&&!Iw(w.current,"open"))return;const ne=Iw(w.current,"open",R.current);ne?x.current=window.setTimeout(()=>{S.current||r(!0,X,"hover")},ne):n||r(!0,X,"hover")}function z(X){if(Y())return;O.current();const ne=zd(o.floating);if(clearTimeout(I.current),D.current=!1,v.current&&i.current.floatingContext){n||clearTimeout(x.current),T.current=v.current({...i.current.floatingContext,tree:g,x:X.clientX,y:X.clientY,onClose(){K(),$(),Y()||U(X,!0,"safe-polygon")}});const ye=T.current;ne.addEventListener("mousemove",ye),O.current=()=>{ne.removeEventListener("mousemove",ye)};return}(R.current==="touch"?!pv(o.floating,X.relatedTarget):!0)&&U(X)}function W(X){Y()||i.current.floatingContext&&(v.current==null||v.current({...i.current.floatingContext,tree:g,x:X.clientX,y:X.clientY,onClose(){K(),$(),Y()||U(X)}})(X))}if(jn(o.domReference)){var V;const X=o.domReference;return n&&X.addEventListener("mouseleave",W),(V=o.floating)==null||V.addEventListener("mouseleave",W),m&&X.addEventListener("mousemove",q,{once:!0}),X.addEventListener("mouseenter",q),X.addEventListener("mouseleave",z),()=>{var ne;n&&X.removeEventListener("mouseleave",W),(ne=o.floating)==null||ne.removeEventListener("mouseleave",W),m&&X.removeEventListener("mousemove",q),X.removeEventListener("mouseenter",q),X.removeEventListener("mouseleave",z)}}},[o,a,t,d,h,m,U,$,K,r,n,S,g,w,v,i,Y]),ys(()=>{var q;if(a&&n&&(q=v.current)!=null&&q.__options.blockPointerEvents&&N()){A.current=!0;const W=o.floating;if(jn(o.domReference)&&W){var z;const V=zd(o.floating).body;V.setAttribute(iq,"");const X=o.domReference,ne=g==null||(z=g.nodesRef.current.find(fe=>fe.id===y))==null||(z=z.context)==null?void 0:z.elements.floating;return ne&&(ne.style.pointerEvents=""),V.style.pointerEvents="none",X.style.pointerEvents="auto",W.style.pointerEvents="auto",()=>{V.style.pointerEvents="",X.style.pointerEvents="",W.style.pointerEvents=""}}}},[a,n,y,o,g,v,N]),ys(()=>{n||(R.current=void 0,D.current=!1,$(),K())},[n,$,K]),_.useEffect(()=>()=>{$(),clearTimeout(x.current),clearTimeout(I.current),K()},[a,o.domReference,$,K]);const G=_.useMemo(()=>{function q(z){R.current=z.pointerType}return{onPointerDown:q,onPointerEnter:q,onMouseMove(z){const{nativeEvent:W}=z;function V(){!k.current&&!S.current&&r(!0,W,"hover")}d&&!AP(R.current)||n||h===0||D.current&&z.movementX**2+z.movementY**2<2||(clearTimeout(I.current),R.current==="touch"?V():(D.current=!0,I.current=window.setTimeout(V,h)))}}},[d,r,n,S,h]),F=_.useMemo(()=>({onMouseEnter(){clearTimeout(x.current)},onMouseLeave(q){Y()||U(q.nativeEvent,!1)}}),[U,Y]);return _.useMemo(()=>a?{reference:G,floating:F}:{},[a,G,F])}const MP=()=>{},Zne=_.createContext({delay:0,initialDelay:0,timeoutMs:0,currentId:null,setCurrentId:MP,setState:MP,isInstantPhase:!1}),Cxe=()=>_.useContext(Zne);function Txe(t){const{children:e,delay:n,timeoutMs:r=0}=t,[i,s]=_.useReducer((c,l)=>({...c,...l}),{delay:n,timeoutMs:r,initialDelay:n,currentId:null,isInstantPhase:!1}),o=_.useRef(null),a=_.useCallback(c=>{s({currentId:c})},[]);return ys(()=>{i.currentId?o.current===null?o.current=i.currentId:i.isInstantPhase||s({isInstantPhase:!0}):(i.isInstantPhase&&s({isInstantPhase:!1}),o.current=null)},[i.currentId,i.isInstantPhase]),E.jsx(Zne.Provider,{value:_.useMemo(()=>({...i,setState:s,setCurrentId:a}),[i,a]),children:e})}function Rxe(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,floatingId:i}=t,{id:s,enabled:o=!0}=e,a=s??i,c=Cxe(),{currentId:l,setCurrentId:d,initialDelay:h,setState:m,timeoutMs:g}=c;return ys(()=>{o&&l&&(m({delay:{open:1,close:Iw(h,"close")}}),l!==a&&r(!1))},[o,a,r,m,l,h]),ys(()=>{function y(){r(!1),m({delay:h,currentId:null})}if(o&&l&&!n&&l===a){if(g){const v=window.setTimeout(y,g);return()=>{clearTimeout(v)}}y()}},[o,n,m,l,a,r,h,g]),ys(()=>{o&&(d===MP||!n||d(a))},[o,n,d,a]),c}function D6(t,e){let n=t.filter(i=>{var s;return i.parentId===e&&((s=i.context)==null?void 0:s.open)}),r=n;for(;r.length;)r=t.filter(i=>{var s;return(s=r)==null?void 0:s.some(o=>{var a;return i.parentId===o.id&&((a=i.context)==null?void 0:a.open)})}),n=n.concat(r);return n}const ere=()=>({getShadowRoot:!0,displayCheck:typeof ResizeObserver=="function"&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function tre(t,e){const n=Une(t,ere());e==="prev"&&n.reverse();const r=n.indexOf(xP(zd(t)));return n.slice(r+1)[0]}function Ixe(){return tre(document.body,"next")}function kxe(){return tre(document.body,"prev")}function N6(t,e){const n=e||t.currentTarget,r=t.relatedTarget;return!r||!pv(n,r)}function xxe(t){Une(t,ere()).forEach(n=>{n.dataset.tabindex=n.getAttribute("tabindex")||"",n.setAttribute("tabindex","-1")})}function sq(t){t.querySelectorAll("[data-tabindex]").forEach(n=>{const r=n.dataset.tabindex;delete n.dataset.tabindex,r?n.setAttribute("tabindex",r):n.removeAttribute("tabindex")})}const nre={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0};let Axe;function oq(t){t.key==="Tab"&&(t.target,clearTimeout(Axe))}const aq=_.forwardRef(function(e,n){const[r,i]=_.useState();ys(()=>(Pne()&&i("button"),document.addEventListener("keydown",oq),()=>{document.removeEventListener("keydown",oq)}),[]);const s={ref:n,tabIndex:0,role:r,"aria-hidden":r?void 0:!0,[I_("focus-guard")]:"",style:nre};return E.jsx("span",{...e,...s})}),rre=_.createContext(null),cq=I_("portal");function Pxe(t){t===void 0&&(t={});const{id:e,root:n}=t,r=mv(),i=Oxe(),[s,o]=_.useState(null),a=_.useRef(null);return ys(()=>()=>{s?.remove(),queueMicrotask(()=>{a.current=null})},[s]),ys(()=>{if(!r||a.current)return;const c=e?document.getElementById(e):null;if(!c)return;const l=document.createElement("div");l.id=r,l.setAttribute(cq,""),c.appendChild(l),a.current=l,o(l)},[e,r]),ys(()=>{if(n===null||!r||a.current)return;let c=n||i?.portalNode;c&&!jn(c)&&(c=c.current),c=c||document.body;let l=null;e&&(l=document.createElement("div"),l.id=e,c.appendChild(l));const d=document.createElement("div");d.id=r,d.setAttribute(cq,""),c=l||c,c.appendChild(d),a.current=d,o(d)},[e,n,r,i]),s}function Lxe(t){const{children:e,id:n,root:r,preserveTabOrder:i=!0}=t,s=Pxe({id:n,root:r}),[o,a]=_.useState(null),c=_.useRef(null),l=_.useRef(null),d=_.useRef(null),h=_.useRef(null),m=o?.modal,g=o?.open,y=!!o&&!o.modal&&o.open&&i&&!!(r||s);return _.useEffect(()=>{if(!s||!i||m)return;function v(w){s&&N6(w)&&(w.type==="focusin"?sq:xxe)(s)}return s.addEventListener("focusin",v,!0),s.addEventListener("focusout",v,!0),()=>{s.removeEventListener("focusin",v,!0),s.removeEventListener("focusout",v,!0)}},[s,i,m]),_.useEffect(()=>{s&&(g||sq(s))},[g,s]),E.jsxs(rre.Provider,{value:_.useMemo(()=>({preserveTabOrder:i,beforeOutsideRef:c,afterOutsideRef:l,beforeInsideRef:d,afterInsideRef:h,portalNode:s,setFocusManagerState:a}),[i,s]),children:[y&&s&&E.jsx(aq,{"data-type":"outside",ref:c,onFocus:v=>{if(N6(v,s)){var w;(w=d.current)==null||w.focus()}else{const S=kxe()||o?.domReference;S?.focus()}}}),y&&s&&E.jsx("span",{"aria-owns":s.id,style:nre}),s&&qv.createPortal(e,s),y&&s&&E.jsx(aq,{"data-type":"outside",ref:l,onFocus:v=>{if(N6(v,s)){var w;(w=h.current)==null||w.focus()}else{const S=Ixe()||o?.domReference;S?.focus(),o?.closeOnFocusOut&&o?.onOpenChange(!1,v.nativeEvent,"focus-out")}}})]})}const Oxe=()=>_.useContext(rre),Mxe="data-floating-ui-focusable",Dxe={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},Nxe={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},lq=t=>{var e,n;return{escapeKey:typeof t=="boolean"?t:(e=t?.escapeKey)!=null?e:!1,outsidePress:typeof t=="boolean"?t:(n=t?.outsidePress)!=null?n:!0}};function Uxe(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,elements:i,dataRef:s}=t,{enabled:o=!0,escapeKey:a=!0,outsidePress:c=!0,outsidePressEvent:l="pointerdown",referencePress:d=!1,referencePressEvent:h="pointerdown",ancestorScroll:m=!1,bubbles:g,capture:y}=e,v=hM(),w=lu(typeof c=="function"?c:()=>!1),S=typeof c=="function"?w:c,R=_.useRef(!1),x=_.useRef(!1),{escapeKey:T,outsidePress:I}=lq(g),{escapeKey:k,outsidePress:A}=lq(y),O=_.useRef(!1),D=lu(G=>{var F;if(!n||!o||!a||G.key!=="Escape"||O.current)return;const q=(F=s.current.floatingContext)==null?void 0:F.nodeId,z=v?D6(v.nodesRef.current,q):[];if(!T&&(G.stopPropagation(),z.length>0)){let W=!0;if(z.forEach(V=>{var X;if((X=V.context)!=null&&X.open&&!V.context.dataRef.current.__escapeKeyBubbles){W=!1;return}}),!W)return}r(!1,r6e(G)?G.nativeEvent:G,"escape-key")}),N=lu(G=>{var F;const q=()=>{var z;D(G),(z=ng(G))==null||z.removeEventListener("keydown",q)};(F=ng(G))==null||F.addEventListener("keydown",q)}),U=lu(G=>{var F;const q=R.current;R.current=!1;const z=x.current;if(x.current=!1,l==="click"&&z||q||typeof S=="function"&&!S(G))return;const W=ng(G),V="["+I_("inert")+"]",X=zd(i.floating).querySelectorAll(V);let ne=jn(W)?W:null;for(;ne&&!Su(ne);){const be=Du(ne);if(Su(be)||!jn(be))break;ne=be}if(X.length&&jn(W)&&!i6e(W)&&!pv(W,i.floating)&&Array.from(X).every(be=>!pv(ne,be)))return;if(Io(W)&&Y){const be=Su(W),_e=ko(W),Ie=/auto|scroll/,Ue=be||Ie.test(_e.overflowX),et=be||Ie.test(_e.overflowY),ln=Ue&&W.clientWidth>0&&W.scrollWidth>W.clientWidth,Bn=et&&W.clientHeight>0&&W.scrollHeight>W.clientHeight,Mn=_e.direction==="rtl",tt=Bn&&(Mn?G.offsetX<=W.offsetWidth-W.clientWidth:G.offsetX>W.clientWidth),Aa=ln&&G.offsetY>W.clientHeight;if(tt||Aa)return}const fe=(F=s.current.floatingContext)==null?void 0:F.nodeId,ye=v&&D6(v.nodesRef.current,fe).some(be=>{var _e;return P6(G,(_e=be.context)==null?void 0:_e.elements.floating)});if(P6(G,i.floating)||P6(G,i.domReference)||ye)return;const Ae=v?D6(v.nodesRef.current,fe):[];if(Ae.length>0){let be=!0;if(Ae.forEach(_e=>{var Ie;if((Ie=_e.context)!=null&&Ie.open&&!_e.context.dataRef.current.__outsidePressBubbles){be=!1;return}}),!be)return}r(!1,G,"outside-press")}),$=lu(G=>{var F;const q=()=>{var z;U(G),(z=ng(G))==null||z.removeEventListener(l,q)};(F=ng(G))==null||F.addEventListener(l,q)});_.useEffect(()=>{if(!n||!o)return;s.current.__escapeKeyBubbles=T,s.current.__outsidePressBubbles=I;let G=-1;function F(X){r(!1,X,"ancestor-scroll")}function q(){window.clearTimeout(G),O.current=!0}function z(){G=window.setTimeout(()=>{O.current=!1},DT()?5:0)}const W=zd(i.floating);a&&(W.addEventListener("keydown",k?N:D,k),W.addEventListener("compositionstart",q),W.addEventListener("compositionend",z)),S&&W.addEventListener(l,A?$:U,A);let V=[];return m&&(jn(i.domReference)&&(V=sf(i.domReference)),jn(i.floating)&&(V=V.concat(sf(i.floating))),!jn(i.reference)&&i.reference&&i.reference.contextElement&&(V=V.concat(sf(i.reference.contextElement)))),V=V.filter(X=>{var ne;return X!==((ne=W.defaultView)==null?void 0:ne.visualViewport)}),V.forEach(X=>{X.addEventListener("scroll",F,{passive:!0})}),()=>{a&&(W.removeEventListener("keydown",k?N:D,k),W.removeEventListener("compositionstart",q),W.removeEventListener("compositionend",z)),S&&W.removeEventListener(l,A?$:U,A),V.forEach(X=>{X.removeEventListener("scroll",F)}),window.clearTimeout(G)}},[s,i,a,S,l,n,r,m,o,T,I,D,k,N,U,A,$]),_.useEffect(()=>{R.current=!1},[S,l]);const K=_.useMemo(()=>({onKeyDown:D,...d&&{[Dxe[h]]:G=>{r(!1,G.nativeEvent,"reference-press")},...h!=="click"&&{onClick(G){r(!1,G.nativeEvent,"reference-press")}}}}),[D,r,d,h]),Y=_.useMemo(()=>({onKeyDown:D,onMouseDown(){x.current=!0},onMouseUp(){x.current=!0},[Nxe[l]]:()=>{R.current=!0}}),[D,l]);return _.useMemo(()=>o?{reference:K,floating:Y}:{},[o,K,Y])}function jxe(t){const{open:e=!1,onOpenChange:n,elements:r}=t,i=mv(),s=_.useRef({}),[o]=_.useState(()=>_xe()),a=fM()!=null,[c,l]=_.useState(r.reference),d=lu((g,y,v)=>{s.current.openEvent=g?y:void 0,o.emit("openchange",{open:g,event:y,reason:v,nested:a}),n?.(g,y,v)}),h=_.useMemo(()=>({setPositionReference:l}),[]),m=_.useMemo(()=>({reference:c||r.reference||null,floating:r.floating||null,domReference:r.reference}),[c,r.reference,r.floating]);return _.useMemo(()=>({dataRef:s,open:e,onOpenChange:d,elements:m,events:o,floatingId:i,refs:h}),[e,d,m,o,i,h])}function Fxe(t){t===void 0&&(t={});const{nodeId:e}=t,n=jxe({...t,elements:{reference:null,floating:null,...t.elements}}),r=t.rootContext||n,i=r.elements,[s,o]=_.useState(null),[a,c]=_.useState(null),d=i?.domReference||s,h=_.useRef(null),m=hM();ys(()=>{d&&(h.current=d)},[d]);const g=Kne({...t,elements:{...i,...a&&{reference:a}}}),y=_.useCallback(x=>{const T=jn(x)?{getBoundingClientRect:()=>x.getBoundingClientRect(),contextElement:x}:x;c(T),g.refs.setReference(T)},[g.refs]),v=_.useCallback(x=>{(jn(x)||x===null)&&(h.current=x,o(x)),(jn(g.refs.reference.current)||g.refs.reference.current===null||x!==null&&!jn(x))&&g.refs.setReference(x)},[g.refs]),w=_.useMemo(()=>({...g.refs,setReference:v,setPositionReference:y,domReference:h}),[g.refs,v,y]),S=_.useMemo(()=>({...g.elements,domReference:d}),[g.elements,d]),R=_.useMemo(()=>({...g,...r,refs:w,elements:S,nodeId:e}),[g,w,S,e,r]);return ys(()=>{r.dataRef.current.floatingContext=R;const x=m?.nodesRef.current.find(T=>T.id===e);x&&(x.context=R)}),_.useMemo(()=>({...g,context:R,refs:w,elements:S}),[g,w,S,R])}function $xe(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,events:i,dataRef:s,elements:o}=t,{enabled:a=!0,visibleOnly:c=!0}=e,l=_.useRef(!1),d=_.useRef(),h=_.useRef(!0);_.useEffect(()=>{if(!a)return;const g=Ws(o.domReference);function y(){!n&&Io(o.domReference)&&o.domReference===xP(zd(o.domReference))&&(l.current=!0)}function v(){h.current=!0}return g.addEventListener("blur",y),g.addEventListener("keydown",v,!0),()=>{g.removeEventListener("blur",y),g.removeEventListener("keydown",v,!0)}},[o.domReference,n,a]),_.useEffect(()=>{if(!a)return;function g(y){let{reason:v}=y;(v==="reference-press"||v==="escape-key")&&(l.current=!0)}return i.on("openchange",g),()=>{i.off("openchange",g)}},[i,a]),_.useEffect(()=>()=>{clearTimeout(d.current)},[]);const m=_.useMemo(()=>({onPointerDown(g){e6e(g.nativeEvent)||(h.current=!1)},onMouseLeave(){l.current=!1},onFocus(g){if(l.current)return;const y=ng(g.nativeEvent);if(c&&jn(y))try{if(Pne()&&t6e())throw Error();if(!y.matches(":focus-visible"))return}catch{if(!h.current&&!o6e(y))return}r(!0,g.nativeEvent,"focus")},onBlur(g){l.current=!1;const y=g.relatedTarget,v=g.nativeEvent,w=jn(y)&&y.hasAttribute(I_("focus-guard"))&&y.getAttribute("data-type")==="outside";d.current=window.setTimeout(()=>{var S;const R=xP(o.domReference?o.domReference.ownerDocument:document);!y&&R===o.domReference||pv((S=s.current.floatingContext)==null?void 0:S.refs.floating.current,R)||pv(o.domReference,R)||w||r(!1,v,"focus")})}}),[s,o.domReference,r,c]);return _.useMemo(()=>a?{reference:m}:{},[a,m])}const uq="active",dq="selected";function U6(t,e,n){const r=new Map,i=n==="item";let s=t;if(i&&t){const{[uq]:o,[dq]:a,...c}=t;s=c}return{...n==="floating"&&{tabIndex:-1,[Mxe]:""},...s,...e.map(o=>{const a=o?o[n]:null;return typeof a=="function"?t?a(t):null:a}).concat(t).reduce((o,a)=>(a&&Object.entries(a).forEach(c=>{let[l,d]=c;if(!(i&&[uq,dq].includes(l)))if(l.indexOf("on")===0){if(r.has(l)||r.set(l,[]),typeof d=="function"){var h;(h=r.get(l))==null||h.push(d),o[l]=function(){for(var m,g=arguments.length,y=new Array(g),v=0;v<g;v++)y[v]=arguments[v];return(m=r.get(l))==null?void 0:m.map(w=>w(...y)).find(w=>w!==void 0)}}}else o[l]=d}),o),{})}}function Bxe(t){t===void 0&&(t=[]);const e=t.map(a=>a?.reference),n=t.map(a=>a?.floating),r=t.map(a=>a?.item),i=_.useCallback(a=>U6(a,t,"reference"),e),s=_.useCallback(a=>U6(a,t,"floating"),n),o=_.useCallback(a=>U6(a,t,"item"),r);return _.useMemo(()=>({getReferenceProps:i,getFloatingProps:s,getItemProps:o}),[i,s,o])}const Hxe=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function Vxe(t,e){var n;e===void 0&&(e={});const{open:r,floatingId:i}=t,{enabled:s=!0,role:o="dialog"}=e,a=(n=Hxe.get(o))!=null?n:o,c=mv(),d=fM()!=null,h=_.useMemo(()=>a==="tooltip"||o==="label"?{["aria-"+(o==="label"?"labelledby":"describedby")]:r?i:void 0}:{"aria-expanded":r?"true":"false","aria-haspopup":a==="alertdialog"?"dialog":a,"aria-controls":r?i:void 0,...a==="listbox"&&{role:"combobox"},...a==="menu"&&{id:c},...a==="menu"&&d&&{role:"menuitem"},...o==="select"&&{"aria-autocomplete":"none"},...o==="combobox"&&{"aria-autocomplete":"list"}},[a,i,d,r,c,o]),m=_.useMemo(()=>{const y={id:i,...a&&{role:a}};return a==="tooltip"||o==="label"?y:{...y,...a==="menu"&&{"aria-labelledby":c}}},[a,i,c,o]),g=_.useCallback(y=>{let{active:v,selected:w}=y;const S={role:"option",...v&&{id:i+"-option"}};switch(o){case"select":return{...S,"aria-selected":v&&w};case"combobox":return{...S,...v&&{"aria-selected":!0}}}return{}},[i,o]);return _.useMemo(()=>s?{reference:h,floating:m,item:g}:{},[s,h,m,g])}const qxe="_tooltip_6ode6_8",Gxe="_invisible_6ode6_21",Kxe="_caption_6ode6_28",zxe="_arrow_6ode6_33",kw={tooltip:qxe,invisible:Gxe,caption:Kxe,arrow:zxe},ire={open:300,close:0},sre=({children:t})=>E.jsx(Txe,{delay:ire,timeoutMs:300,children:t});sre.displayName="TooltipProvider";function Wxe({open:t,disabled:e=!1,onOpenChange:n,placement:r="bottom",isTriggerInteractive:i,caption:s,"aria-atomic":o,"aria-live":a,...c}){const l=mv(),d=mv(),h=_.useRef(null),[m,g]=_.useState(!1),y=e?!1:t??m,v=(K,Y,G)=>{n?.(K,Y,G),t===void 0&&g(K)},w=Fxe({placement:r,open:y,onOpenChange:v,whileElementsMounted:qne,middleware:[zne(6),Yne({crossAxis:r.includes("-"),fallbackAxisSideDirection:"start",padding:5}),Wne({padding:5}),Xne({element:h})]}),S=w.context,{delay:R,initialDelay:x}=Rxe(S);if(x!==ire)throw new Error("Tooltips must be wrapped in a global <TooltipProvider>");const T=wxe(S,{move:!1,enabled:t===void 0,delay:i?R:{},mouseOnly:!0}),I=$xe(S,{enabled:t===void 0}),k=_.useRef(void 0);_.useEffect(()=>()=>window.clearTimeout(k.current),[]);const A=_.useMemo(()=>{const K=()=>{k.current===void 0?k.current=window.setTimeout(()=>{v(!1),k.current=void 0},1500):window.clearTimeout(k.current)};return{reference:{onTouchStart:()=>{k.current!==void 0&&window.clearTimeout(k.current),k.current=window.setTimeout(()=>{v(!0),k.current=void 0},500)},onTouchEnd:K,onTouchCancel:K}}},[]),O=Uxe(S),D="label"in c?"label":"description",N=Vxe(S,{enabled:D==="description",role:"tooltip"}),U=_.useMemo(()=>D==="label"?{reference:{"aria-labelledby":l,"aria-describedby":s?d:void 0}}:{},[D,l,d]),$=Bxe([T,I,A,O,N,U]);return _.useMemo(()=>({labelId:l,captionId:s?d:void 0,caption:s,purpose:D,open:y,setOpen:v,tooltipProps:{"aria-atomic":o,"aria-live":a},...$,...w,arrowRef:h}),[l,d,s,N,y,v,$,w,h])}const Yxe=t=>"label"in t&&!!t.label;function qi({children:t,isTriggerInteractive:e=!0,nonInteractiveTriggerTabIndex:n=0,...r}){const i=Wxe({isTriggerInteractive:e,...r});return E.jsxs(Rne.Provider,{value:i,children:[E.jsx(Qxe,{isTriggerInteractive:e,nonInteractiveTriggerTabIndex:n,children:t}),E.jsxs(Jxe,{children:[E.jsx("span",{id:i.labelId,children:Yxe(r)?r.label:r.description}),E.jsx(Xxe,{})]})]})}function Xxe(){const{caption:t,captionId:e}=sM();if(!t)return null;const r=typeof t=="string"?"span":"div";return E.jsx(r,{id:e,className:Oe(kw.caption,"cpd-theme-dark"),children:t})}function Jxe({children:t}){const{context:e,open:n,arrowRef:r,purpose:i,...s}=sM();return!n&&i!=="label"?null:E.jsx(Lxe,{children:E.jsxs("div",{ref:s.refs.setFloating,style:s.floatingStyles,...s.tooltipProps,...s.getFloatingProps(),className:Oe(kw.tooltip,{[kw.invisible]:i==="label"&&!n}),children:[E.jsx(bxe,{ref:r,context:e,width:10,height:6,className:kw.arrow}),t]})})}const Qxe=({children:t,isTriggerInteractive:e,nonInteractiveTriggerTabIndex:n})=>{const r=sM(),i=t?.ref,s=Jne([r.refs.setReference,i]),o=_.useMemo(()=>{if(_.isValidElement(t))if(e){const a=r.getReferenceProps({...typeof t.props=="object"?t.props:{},ref:s});return _.cloneElement(t,a)}else{const a=r.getReferenceProps({ref:s,tabIndex:n}),{"aria-labelledby":c,"aria-describedby":l,...d}=a;return E.jsx("span",{tabIndex:n,...d,children:_.cloneElement(t,{"aria-labelledby":c,"aria-describedby":l})})}},[r,s,t]);if(!o)throw new Error("Tooltip anchor must be a single valid React element");return o},UT=_.forwardRef(function({kind:e="primary",children:n,className:r,indicator:i,size:s="32px",style:o,disabled:a,destructive:c,tooltip:l,noBackground:d=!1,...h},m){const g=Oe(A6["icon-button"],r,{[A6.destructive]:c,[A6["no-background"]]:d}),y=E.jsx(Tne,{as:"button",ref:m,className:g,style:{"--cpd-icon-button-size":s,...o},disabled:a,...h,"data-indicator":i,"data-kind":e,children:E.jsx(Jke,{indicator:i,colour:a?"var(--cpd-color-icon-disabled)":void 0,children:Ce.Children.only(n)})});return l?E.jsx(qi,{label:l,children:y}):y}),Zxe=({type:t,title:e,children:n,className:r,actions:i,onClose:s,...o})=>{const a=Oe(Um.alert,r),c=_.useCallback(l=>{switch(t){case"critical":return E.jsx(PT,{...l});case"info":return E.jsx(Vke,{...l});case"success":return E.jsx(Hke,{...l})}},[t]);return E.jsxs("div",{...o,className:a,"data-type":t,children:[c({width:24,height:24,className:Um.icon,"aria-hidden":!0}),E.jsxs("div",{className:Um.content,children:[E.jsxs("div",{className:Um["text-content"],children:[E.jsx(an,{size:"md",weight:"semibold",children:e}),E.jsx(an,{size:"sm",weight:"regular",children:n})]}),i&&E.jsx("div",{className:Um.actions,children:i})]}),s&&E.jsx(UT,{onClick:s,"aria-label":"Close",role:"button",className:Um.close,children:E.jsx(LT,{})})]})},e5e="@",t5e="#",n5e="+",r5e=new Intl.Segmenter;function i5e(t){if(t.length<1)return"";const e=t[0];[e5e,t5e,n5e].includes(e)&&(t=t.substring(1));const n=r5e.segment(t)[Symbol.iterator]().next();return n.done?"":n.value.segment}const s5e="_avatar_1qbcf_8",o5e="_image_1qbcf_41",j6={avatar:s5e,image:o5e,"avatar-imageless":"_avatar-imageless_1qbcf_52"};function a5e(t){return t.split("").reduce((i,s)=>i+s.charCodeAt(0),0)%6+1}function c5e(t){return!!(t.onClick||t.onKeyDown||t.onKeyUp)}const l5e=_.forwardRef(function({src:e,id:n,name:r="",type:i="round",className:s="",size:o,style:a={},onError:c,...l},d){return Ce.createElement(c5e(l)?"button":"span",{ref:d,role:"img","aria-label":n,...l,"data-type":i,"data-color":a5e(n),className:Oe(j6.avatar,s,{[j6["avatar-imageless"]]:!e}),style:{...a,"--cpd-avatar-size":o}},E.jsx(Ce.Fragment,{children:e?E.jsx("img",{loading:"lazy",alt:"",src:e,referrerPolicy:"no-referrer",className:Oe(j6.image),"data-type":i,style:a,width:o,height:o,onError:c}):i5e(r)}))});function St(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t?.(i),n===!1||!i.defaultPrevented)return e?.(i)}}function xp(t,e=[]){let n=[];function r(s,o){const a=_.createContext(o),c=n.length;n=[...n,o];const l=h=>{const{scope:m,children:g,...y}=h,v=m?.[t]?.[c]||a,w=_.useMemo(()=>y,Object.values(y));return E.jsx(v.Provider,{value:w,children:g})};l.displayName=s+"Provider";function d(h,m){const g=m?.[t]?.[c]||a,y=_.useContext(g);if(y)return y;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[l,d]}const i=()=>{const s=n.map(o=>_.createContext(o));return function(a){const c=a?.[t]||s;return _.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return i.scopeName=t,[r,u5e(i,...e)]}function u5e(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:l})=>{const h=c(s)[`__scope${l}`];return{...a,...h}},{});return _.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}function fq(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function jT(...t){return e=>{let n=!1;const r=t.map(i=>{const s=fq(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():fq(t[i],null)}}}}function bs(...t){return _.useCallback(jT(...t),t)}var gv=_.forwardRef((t,e)=>{const{children:n,...r}=t,i=_.Children.toArray(n),s=i.find(f5e);if(s){const o=s.props.children,a=i.map(c=>c===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:c);return E.jsx(DP,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return E.jsx(DP,{...r,ref:e,children:n})});gv.displayName="Slot";var DP=_.forwardRef((t,e)=>{const{children:n,...r}=t;if(_.isValidElement(n)){const i=p5e(n);return _.cloneElement(n,{...h5e(r,n.props),ref:e?jT(e,i):i})}return _.Children.count(n)>1?_.Children.only(null):null});DP.displayName="SlotClone";var d5e=({children:t})=>E.jsx(E.Fragment,{children:t});function f5e(t){return _.isValidElement(t)&&t.type===d5e}function h5e(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function p5e(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var m5e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Pr=m5e.reduce((t,e)=>{const n=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?gv:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(a,{...o,ref:i})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function g5e(t,e){t&&qv.flushSync(()=>t.dispatchEvent(e))}function ore(t){const e=t+"CollectionProvider",[n,r]=xp(e),[i,s]=n(e,{collectionRef:{current:null},itemMap:new Map}),o=g=>{const{scope:y,children:v}=g,w=Ce.useRef(null),S=Ce.useRef(new Map).current;return E.jsx(i,{scope:y,itemMap:S,collectionRef:w,children:v})};o.displayName=e;const a=t+"CollectionSlot",c=Ce.forwardRef((g,y)=>{const{scope:v,children:w}=g,S=s(a,v),R=bs(y,S.collectionRef);return E.jsx(gv,{ref:R,children:w})});c.displayName=a;const l=t+"CollectionItemSlot",d="data-radix-collection-item",h=Ce.forwardRef((g,y)=>{const{scope:v,children:w,...S}=g,R=Ce.useRef(null),x=bs(y,R),T=s(l,v);return Ce.useEffect(()=>(T.itemMap.set(R,{ref:R,...S}),()=>void T.itemMap.delete(R))),E.jsx(gv,{[d]:"",ref:x,children:w})});h.displayName=l;function m(g){const y=s(t+"CollectionConsumer",g);return Ce.useCallback(()=>{const w=y.collectionRef.current;if(!w)return[];const S=Array.from(w.querySelectorAll(`[${d}]`));return Array.from(y.itemMap.values()).sort((T,I)=>S.indexOf(T.ref.current)-S.indexOf(I.ref.current))},[y.collectionRef,y.itemMap])}return[{Provider:o,Slot:c,ItemSlot:h},m,r]}var v5e=_.createContext(void 0);function are(t){const e=_.useContext(v5e);return t||e||"ltr"}function F6(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t?.(i),n===!1||!i.defaultPrevented)return e?.(i)}}function hq(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function cre(...t){return e=>{let n=!1;const r=t.map(i=>{const s=hq(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():hq(t[i],null)}}}}function lre(...t){return _.useCallback(cre(...t),t)}function y5e(t){const e=b5e(t),n=_.forwardRef((r,i)=>{const{children:s,...o}=r,a=_.Children.toArray(s),c=a.find(S5e);if(c){const l=c.props.children,d=a.map(h=>h===c?_.Children.count(l)>1?_.Children.only(null):_.isValidElement(l)?l.props.children:null:h);return E.jsx(e,{...o,ref:i,children:_.isValidElement(l)?_.cloneElement(l,void 0,d):null})}return E.jsx(e,{...o,ref:i,children:s})});return n.displayName=`${t}.Slot`,n}function b5e(t){const e=_.forwardRef((n,r)=>{const{children:i,...s}=n;if(_.isValidElement(i)){const o=w5e(i),a=E5e(s,i.props);return i.type!==_.Fragment&&(a.ref=r?cre(r,o):o),_.cloneElement(i,a)}return _.Children.count(i)>1?_.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var _5e=Symbol("radix.slottable");function S5e(t){return _.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===_5e}function E5e(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{const c=s(...a);return i(...a),c}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function w5e(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var C5e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ure=C5e.reduce((t,e)=>{const n=y5e(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function T5e(t,e){t&&qv.flushSync(()=>t.dispatchEvent(e))}function dre(t){const e=_.useRef(t);return _.useEffect(()=>{e.current=t}),_.useMemo(()=>(...n)=>e.current?.(...n),[])}function R5e(t){const e=_.useRef(t);return _.useEffect(()=>{e.current=t}),_.useMemo(()=>(...n)=>e.current?.(...n),[])}function I5e(t,e=globalThis?.document){const n=R5e(t);_.useEffect(()=>{const r=i=>{i.key==="Escape"&&n(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var k5e="DismissableLayer",NP="dismissableLayer.update",x5e="dismissableLayer.pointerDownOutside",A5e="dismissableLayer.focusOutside",pq,fre=_.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),pM=_.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:s,onInteractOutside:o,onDismiss:a,...c}=t,l=_.useContext(fre),[d,h]=_.useState(null),m=d?.ownerDocument??globalThis?.document,[,g]=_.useState({}),y=lre(e,A=>h(A)),v=Array.from(l.layers),[w]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),S=v.indexOf(w),R=d?v.indexOf(d):-1,x=l.layersWithOutsidePointerEventsDisabled.size>0,T=R>=S,I=O5e(A=>{const O=A.target,D=[...l.branches].some(N=>N.contains(O));!T||D||(i?.(A),o?.(A),A.defaultPrevented||a?.())},m),k=M5e(A=>{const O=A.target;[...l.branches].some(N=>N.contains(O))||(s?.(A),o?.(A),A.defaultPrevented||a?.())},m);return I5e(A=>{R===l.layers.size-1&&(r?.(A),!A.defaultPrevented&&a&&(A.preventDefault(),a()))},m),_.useEffect(()=>{if(d)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(pq=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(d)),l.layers.add(d),mq(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=pq)}},[d,m,n,l]),_.useEffect(()=>()=>{d&&(l.layers.delete(d),l.layersWithOutsidePointerEventsDisabled.delete(d),mq())},[d,l]),_.useEffect(()=>{const A=()=>g({});return document.addEventListener(NP,A),()=>document.removeEventListener(NP,A)},[]),E.jsx(ure.div,{...c,ref:y,style:{pointerEvents:x?T?"auto":"none":void 0,...t.style},onFocusCapture:F6(t.onFocusCapture,k.onFocusCapture),onBlurCapture:F6(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:F6(t.onPointerDownCapture,I.onPointerDownCapture)})});pM.displayName=k5e;var P5e="DismissableLayerBranch",L5e=_.forwardRef((t,e)=>{const n=_.useContext(fre),r=_.useRef(null),i=lre(e,r);return _.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),E.jsx(ure.div,{...t,ref:i})});L5e.displayName=P5e;function O5e(t,e=globalThis?.document){const n=dre(t),r=_.useRef(!1),i=_.useRef(()=>{});return _.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let c=function(){hre(x5e,n,l,{discrete:!0})};const l={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=c,e.addEventListener("click",i.current,{once:!0})):c()}else e.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",i.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function M5e(t,e=globalThis?.document){const n=dre(t),r=_.useRef(!1);return _.useEffect(()=>{const i=s=>{s.target&&!r.current&&hre(A5e,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function mq(){const t=new CustomEvent(NP);document.dispatchEvent(t)}function hre(t,e,n,{discrete:r}){const i=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?T5e(i,s):i.dispatchEvent(s)}var $6=0;function pre(){_.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??gq()),document.body.insertAdjacentElement("beforeend",t[1]??gq()),$6++,()=>{$6===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),$6--}},[])}function gq(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}function ju(t){const e=_.useRef(t);return _.useEffect(()=>{e.current=t}),_.useMemo(()=>(...n)=>e.current?.(...n),[])}var B6="focusScope.autoFocusOnMount",H6="focusScope.autoFocusOnUnmount",vq={bubbles:!1,cancelable:!0},D5e="FocusScope",mre=_.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=t,[a,c]=_.useState(null),l=ju(i),d=ju(s),h=_.useRef(null),m=bs(e,v=>c(v)),g=_.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_.useEffect(()=>{if(r){let v=function(x){if(g.paused||!a)return;const T=x.target;a.contains(T)?h.current=T:Ld(h.current,{select:!0})},w=function(x){if(g.paused||!a)return;const T=x.relatedTarget;T!==null&&(a.contains(T)||Ld(h.current,{select:!0}))},S=function(x){if(document.activeElement===document.body)for(const I of x)I.removedNodes.length>0&&Ld(a)};document.addEventListener("focusin",v),document.addEventListener("focusout",w);const R=new MutationObserver(S);return a&&R.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",v),document.removeEventListener("focusout",w),R.disconnect()}}},[r,a,g.paused]),_.useEffect(()=>{if(a){bq.add(g);const v=document.activeElement;if(!a.contains(v)){const S=new CustomEvent(B6,vq);a.addEventListener(B6,l),a.dispatchEvent(S),S.defaultPrevented||(N5e(B5e(gre(a)),{select:!0}),document.activeElement===v&&Ld(a))}return()=>{a.removeEventListener(B6,l),setTimeout(()=>{const S=new CustomEvent(H6,vq);a.addEventListener(H6,d),a.dispatchEvent(S),S.defaultPrevented||Ld(v??document.body,{select:!0}),a.removeEventListener(H6,d),bq.remove(g)},0)}}},[a,l,d,g]);const y=_.useCallback(v=>{if(!n&&!r||g.paused)return;const w=v.key==="Tab"&&!v.altKey&&!v.ctrlKey&&!v.metaKey,S=document.activeElement;if(w&&S){const R=v.currentTarget,[x,T]=U5e(R);x&&T?!v.shiftKey&&S===T?(v.preventDefault(),n&&Ld(x,{select:!0})):v.shiftKey&&S===x&&(v.preventDefault(),n&&Ld(T,{select:!0})):S===R&&v.preventDefault()}},[n,r,g.paused]);return E.jsx(Pr.div,{tabIndex:-1,...o,ref:m,onKeyDown:y})});mre.displayName=D5e;function N5e(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(Ld(r,{select:e}),document.activeElement!==n)return}function U5e(t){const e=gre(t),n=yq(e,t),r=yq(e.reverse(),t);return[n,r]}function gre(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function yq(t,e){for(const n of t)if(!j5e(n,{upTo:e}))return n}function j5e(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function F5e(t){return t instanceof HTMLInputElement&&"select"in t}function Ld(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&F5e(t)&&e&&t.select()}}var bq=$5e();function $5e(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=_q(t,e),t.unshift(e)},remove(e){t=_q(t,e),t[0]?.resume()}}}function _q(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function B5e(t){return t.filter(e=>e.tagName!=="A")}var H5e=globalThis?.document?_.useLayoutEffect:()=>{},V5e=m_.useId||(()=>{}),q5e=0;function vv(t){const[e,n]=_.useState(V5e());return H5e(()=>{n(r=>r??String(q5e++))},[t]),t||(e?`radix-${e}`:"")}var G5e="Arrow",vre=_.forwardRef((t,e)=>{const{children:n,width:r=10,height:i=5,...s}=t;return E.jsx(Pr.svg,{...s,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:E.jsx("polygon",{points:"0,0 30,0 15,10"})})});vre.displayName=G5e;var K5e=vre,UP=globalThis?.document?_.useLayoutEffect:()=>{};function z5e(t){const[e,n]=_.useState(void 0);return UP(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let o,a;if("borderBoxSize"in s){const c=s.borderBoxSize,l=Array.isArray(c)?c[0]:c;o=l.inlineSize,a=l.blockSize}else o=t.offsetWidth,a=t.offsetHeight;n({width:o,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var mM="Popper",[yre,bre]=xp(mM),[W5e,_re]=yre(mM),Sre=t=>{const{__scopePopper:e,children:n}=t,[r,i]=_.useState(null);return E.jsx(W5e,{scope:e,anchor:r,onAnchorChange:i,children:n})};Sre.displayName=mM;var Ere="PopperAnchor",wre=_.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...i}=t,s=_re(Ere,n),o=_.useRef(null),a=bs(e,o);return _.useEffect(()=>{s.onAnchorChange(r?.current||o.current)}),r?null:E.jsx(Pr.div,{...i,ref:a})});wre.displayName=Ere;var gM="PopperContent",[Y5e,X5e]=yre(gM),Cre=_.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:i=0,align:s="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:d=0,sticky:h="partial",hideWhenDetached:m=!1,updatePositionStrategy:g="optimized",onPlaced:y,...v}=t,w=_re(gM,n),[S,R]=_.useState(null),x=bs(e,_e=>R(_e)),[T,I]=_.useState(null),k=z5e(T),A=k?.width??0,O=k?.height??0,D=r+(s!=="center"?"-"+s:""),N=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},U=Array.isArray(l)?l:[l],$=U.length>0,K={padding:N,boundary:U.filter(Q5e),altBoundary:$},{refs:Y,floatingStyles:G,placement:F,isPositioned:q,middlewareData:z}=Kne({strategy:"fixed",placement:D,whileElementsMounted:(..._e)=>qne(..._e,{animationFrame:g==="always"}),elements:{reference:w.anchor},middleware:[zne({mainAxis:i+O,alignmentAxis:o}),c&&Wne({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?dxe():void 0,...K}),c&&Yne({...K}),fxe({...K,apply:({elements:_e,rects:Ie,availableWidth:Ue,availableHeight:et})=>{const{width:ln,height:Bn}=Ie.reference,Mn=_e.floating.style;Mn.setProperty("--radix-popper-available-width",`${Ue}px`),Mn.setProperty("--radix-popper-available-height",`${et}px`),Mn.setProperty("--radix-popper-anchor-width",`${ln}px`),Mn.setProperty("--radix-popper-anchor-height",`${Bn}px`)}}),T&&Xne({element:T,padding:a}),Z5e({arrowWidth:A,arrowHeight:O}),m&&hxe({strategy:"referenceHidden",...K})]}),[W,V]=Ire(F),X=ju(y);UP(()=>{q&&X?.()},[q,X]);const ne=z.arrow?.x,fe=z.arrow?.y,ye=z.arrow?.centerOffset!==0,[Ae,be]=_.useState();return UP(()=>{S&&be(window.getComputedStyle(S).zIndex)},[S]),E.jsx("div",{ref:Y.setFloating,"data-radix-popper-content-wrapper":"",style:{...G,transform:q?G.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ae,"--radix-popper-transform-origin":[z.transformOrigin?.x,z.transformOrigin?.y].join(" "),...z.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:E.jsx(Y5e,{scope:n,placedSide:W,onArrowChange:I,arrowX:ne,arrowY:fe,shouldHideArrow:ye,children:E.jsx(Pr.div,{"data-side":W,"data-align":V,...v,ref:x,style:{...v.style,animation:q?void 0:"none"}})})})});Cre.displayName=gM;var Tre="PopperArrow",J5e={top:"bottom",right:"left",bottom:"top",left:"right"},Rre=_.forwardRef(function(e,n){const{__scopePopper:r,...i}=e,s=X5e(Tre,r),o=J5e[s.placedSide];return E.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:E.jsx(K5e,{...i,ref:n,style:{...i.style,display:"block"}})})});Rre.displayName=Tre;function Q5e(t){return t!==null}var Z5e=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:i}=e,o=i.arrow?.centerOffset!==0,a=o?0:t.arrowWidth,c=o?0:t.arrowHeight,[l,d]=Ire(n),h={start:"0%",center:"50%",end:"100%"}[d],m=(i.arrow?.x??0)+a/2,g=(i.arrow?.y??0)+c/2;let y="",v="";return l==="bottom"?(y=o?h:`${m}px`,v=`${-c}px`):l==="top"?(y=o?h:`${m}px`,v=`${r.floating.height+c}px`):l==="right"?(y=`${-c}px`,v=o?h:`${g}px`):l==="left"&&(y=`${r.floating.width+c}px`,v=o?h:`${g}px`),{data:{x:y,y:v}}}});function Ire(t){const[e,n="center"]=t.split("-");return[e,n]}var eAe=Sre,tAe=wre,nAe=Cre,rAe=Rre,jP=globalThis?.document?_.useLayoutEffect:()=>{},iAe="Portal",kre=_.forwardRef((t,e)=>{const{container:n,...r}=t,[i,s]=_.useState(!1);jP(()=>s(!0),[]);const o=n||i&&globalThis?.document?.body;return o?Yee.createPortal(E.jsx(Pr.div,{...r,ref:e}),o):null});kre.displayName=iAe;function sAe(t,e){return _.useReducer((n,r)=>e[n][r]??n,t)}var k_=t=>{const{present:e,children:n}=t,r=oAe(e),i=typeof n=="function"?n({present:r.isPresent}):_.Children.only(n),s=bs(r.ref,aAe(i));return typeof n=="function"||r.isPresent?_.cloneElement(i,{ref:s}):null};k_.displayName="Presence";function oAe(t){const[e,n]=_.useState(),r=_.useRef({}),i=_.useRef(t),s=_.useRef("none"),o=t?"mounted":"unmounted",[a,c]=sAe(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _.useEffect(()=>{const l=Y2(r.current);s.current=a==="mounted"?l:"none"},[a]),jP(()=>{const l=r.current,d=i.current;if(d!==t){const m=s.current,g=Y2(l);t?c("MOUNT"):g==="none"||l?.display==="none"?c("UNMOUNT"):c(d&&m!==g?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,c]),jP(()=>{if(e){let l;const d=e.ownerDocument.defaultView??window,h=g=>{const v=Y2(r.current).includes(g.animationName);if(g.target===e&&v&&(c("ANIMATION_END"),!i.current)){const w=e.style.animationFillMode;e.style.animationFillMode="forwards",l=d.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=w)})}},m=g=>{g.target===e&&(s.current=Y2(r.current))};return e.addEventListener("animationstart",m),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{d.clearTimeout(l),e.removeEventListener("animationstart",m),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:_.useCallback(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function Y2(t){return t?.animationName||"none"}function aAe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function xre({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,i]=cAe({defaultProp:e,onChange:n}),s=t!==void 0,o=s?t:r,a=ju(n),c=_.useCallback(l=>{if(s){const h=typeof l=="function"?l(t):l;h!==t&&a(h)}else i(l)},[s,t,i,a]);return[o,c]}function cAe({defaultProp:t,onChange:e}){const n=_.useState(t),[r]=n,i=_.useRef(r),s=ju(e);return _.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),n}var V6="rovingFocusGroup.onEntryFocus",lAe={bubbles:!1,cancelable:!0},FT="RovingFocusGroup",[FP,Are,uAe]=ore(FT),[dAe,Pre]=xp(FT,[uAe]),[fAe,hAe]=dAe(FT),Lre=_.forwardRef((t,e)=>E.jsx(FP.Provider,{scope:t.__scopeRovingFocusGroup,children:E.jsx(FP.Slot,{scope:t.__scopeRovingFocusGroup,children:E.jsx(pAe,{...t,ref:e})})}));Lre.displayName=FT;var pAe=_.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:s,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:c,onEntryFocus:l,preventScrollOnEntryFocus:d=!1,...h}=t,m=_.useRef(null),g=bs(e,m),y=are(s),[v=null,w]=xre({prop:o,defaultProp:a,onChange:c}),[S,R]=_.useState(!1),x=ju(l),T=Are(n),I=_.useRef(!1),[k,A]=_.useState(0);return _.useEffect(()=>{const O=m.current;if(O)return O.addEventListener(V6,x),()=>O.removeEventListener(V6,x)},[x]),E.jsx(fAe,{scope:n,orientation:r,dir:y,loop:i,currentTabStopId:v,onItemFocus:_.useCallback(O=>w(O),[w]),onItemShiftTab:_.useCallback(()=>R(!0),[]),onFocusableItemAdd:_.useCallback(()=>A(O=>O+1),[]),onFocusableItemRemove:_.useCallback(()=>A(O=>O-1),[]),children:E.jsx(Pr.div,{tabIndex:S||k===0?-1:0,"data-orientation":r,...h,ref:g,style:{outline:"none",...t.style},onMouseDown:St(t.onMouseDown,()=>{I.current=!0}),onFocus:St(t.onFocus,O=>{const D=!I.current;if(O.target===O.currentTarget&&D&&!S){const N=new CustomEvent(V6,lAe);if(O.currentTarget.dispatchEvent(N),!N.defaultPrevented){const U=T().filter(F=>F.focusable),$=U.find(F=>F.active),K=U.find(F=>F.id===v),G=[$,K,...U].filter(Boolean).map(F=>F.ref.current);Dre(G,d)}}I.current=!1}),onBlur:St(t.onBlur,()=>R(!1))})})}),Ore="RovingFocusGroupItem",Mre=_.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:s,...o}=t,a=vv(),c=s||a,l=hAe(Ore,n),d=l.currentTabStopId===c,h=Are(n),{onFocusableItemAdd:m,onFocusableItemRemove:g}=l;return _.useEffect(()=>{if(r)return m(),()=>g()},[r,m,g]),E.jsx(FP.ItemSlot,{scope:n,id:c,focusable:r,active:i,children:E.jsx(Pr.span,{tabIndex:d?0:-1,"data-orientation":l.orientation,...o,ref:e,onMouseDown:St(t.onMouseDown,y=>{r?l.onItemFocus(c):y.preventDefault()}),onFocus:St(t.onFocus,()=>l.onItemFocus(c)),onKeyDown:St(t.onKeyDown,y=>{if(y.key==="Tab"&&y.shiftKey){l.onItemShiftTab();return}if(y.target!==y.currentTarget)return;const v=vAe(y,l.orientation,l.dir);if(v!==void 0){if(y.metaKey||y.ctrlKey||y.altKey||y.shiftKey)return;y.preventDefault();let S=h().filter(R=>R.focusable).map(R=>R.ref.current);if(v==="last")S.reverse();else if(v==="prev"||v==="next"){v==="prev"&&S.reverse();const R=S.indexOf(y.currentTarget);S=l.loop?yAe(S,R+1):S.slice(R+1)}setTimeout(()=>Dre(S))}})})})});Mre.displayName=Ore;var mAe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function gAe(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function vAe(t,e,n){const r=gAe(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return mAe[r]}function Dre(t,e=!1){const n=document.activeElement;for(const r of t)if(r===n||(r.focus({preventScroll:e}),document.activeElement!==n))return}function yAe(t,e){return t.map((n,r)=>t[(e+r)%t.length])}var bAe=Lre,_Ae=Mre,SAe=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},jm=new WeakMap,X2=new WeakMap,J2={},q6=0,Nre=function(t){return t&&(t.host||Nre(t.parentNode))},EAe=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=Nre(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},wAe=function(t,e,n,r){var i=EAe(e,Array.isArray(t)?t:[t]);J2[n]||(J2[n]=new WeakMap);var s=J2[n],o=[],a=new Set,c=new Set(i),l=function(h){!h||a.has(h)||(a.add(h),l(h.parentNode))};i.forEach(l);var d=function(h){!h||c.has(h)||Array.prototype.forEach.call(h.children,function(m){if(a.has(m))d(m);else try{var g=m.getAttribute(r),y=g!==null&&g!=="false",v=(jm.get(m)||0)+1,w=(s.get(m)||0)+1;jm.set(m,v),s.set(m,w),o.push(m),v===1&&y&&X2.set(m,!0),w===1&&m.setAttribute(n,"true"),y||m.setAttribute(r,"true")}catch(S){console.error("aria-hidden: cannot operate on ",m,S)}})};return d(e),a.clear(),q6++,function(){o.forEach(function(h){var m=jm.get(h)-1,g=s.get(h)-1;jm.set(h,m),s.set(h,g),m||(X2.has(h)||h.removeAttribute(r),X2.delete(h)),g||h.removeAttribute(n)}),q6--,q6||(jm=new WeakMap,jm=new WeakMap,X2=new WeakMap,J2={})}},Ure=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),i=SAe(t);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),wAe(r,i,n,"aria-hidden")):function(){return null}},$P=function(t,e){return $P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},$P(t,e)};function cc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");$P(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Ii=function(){return Ii=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ii.apply(this,arguments)};function x_(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function jre(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function Fre(t,e){return function(n,r){e(n,r,t)}}function $re(t,e,n,r,i,s){function o(S){if(S!==void 0&&typeof S!="function")throw new TypeError("Function expected");return S}for(var a=r.kind,c=a==="getter"?"get":a==="setter"?"set":"value",l=!e&&t?r.static?t:t.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,m=!1,g=n.length-1;g>=0;g--){var y={};for(var v in r)y[v]=v==="access"?{}:r[v];for(var v in r.access)y.access[v]=r.access[v];y.addInitializer=function(S){if(m)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(S||null))};var w=(0,n[g])(a==="accessor"?{get:d.get,set:d.set}:d[c],y);if(a==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(h=o(w.get))&&(d.get=h),(h=o(w.set))&&(d.set=h),(h=o(w.init))&&i.unshift(h)}else(h=o(w))&&(a==="field"?i.unshift(h):d[c]=h)}l&&Object.defineProperty(l,r.name,d),m=!0}function Bre(t,e,n){for(var r=arguments.length>2,i=0;i<e.length;i++)n=r?e[i].call(t,n):e[i].call(t);return r?n:void 0}function Hre(t){return typeof t=="symbol"?t:"".concat(t)}function Vre(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function qre(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function vM(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{l(r.next(d))}catch(h){o(h)}}function c(d){try{l(r.throw(d))}catch(h){o(h)}}function l(d){d.done?s(d.value):i(d.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function $T(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(d){return c([l,d])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(d){l=[6,d],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var BT=Object.create?function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]};function Gre(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&BT(e,t,n)}function Ef(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Sa(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Kre(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Sa(arguments[e]));return t}function zre(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Ea(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function Eu(t){return this instanceof Eu?(this.v=t,this):new Eu(t)}function yM(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(g){return function(y){return Promise.resolve(y).then(g,h)}}function a(g,y){r[g]&&(i[g]=function(v){return new Promise(function(w,S){s.push([g,v,w,S])>1||c(g,v)})},y&&(i[g]=y(i[g])))}function c(g,y){try{l(r[g](y))}catch(v){m(s[0][3],v)}}function l(g){g.value instanceof Eu?Promise.resolve(g.value.v).then(d,h):m(s[0][2],g)}function d(g){c("next",g)}function h(g){c("throw",g)}function m(g,y){g(y),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Wre(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:Eu(t[i](o)),done:!1}:s?s(o):o}:s}}function bM(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Ef=="function"?Ef(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function Yre(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var CAe=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},BP=function(t){return BP=Object.getOwnPropertyNames||function(e){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[n.length]=r);return n},BP(t)};function Xre(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=BP(t),r=0;r<n.length;r++)n[r]!=="default"&&BT(e,t,n[r]);return CAe(e,t),e}function Jre(t){return t&&t.__esModule?t:{default:t}}function Qre(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function Zre(t,e,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n}function eie(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function tie(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,i;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(i=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(s){return Promise.reject(s)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}var TAe=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function nie(t){function e(s){t.error=t.hasError?new TAe(s,t.error,"An error was suppressed during disposal."):s,t.hasError=!0}var n,r=0;function i(){for(;n=t.stack.pop();)try{if(!n.async&&r===1)return r=0,t.stack.push(n),Promise.resolve().then(i);if(n.dispose){var s=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(s).then(i,function(o){return e(o),i()})}else r|=1}catch(o){e(o)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return i()}function rie(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,i,s,o){return r?e?".jsx":".js":i&&(!s||!o)?n:i+s+"."+o.toLowerCase()+"js"}):t}const RAe={__extends:cc,__assign:Ii,__rest:x_,__decorate:jre,__param:Fre,__esDecorate:$re,__runInitializers:Bre,__propKey:Hre,__setFunctionName:Vre,__metadata:qre,__awaiter:vM,__generator:$T,__createBinding:BT,__exportStar:Gre,__values:Ef,__read:Sa,__spread:Kre,__spreadArrays:zre,__spreadArray:Ea,__await:Eu,__asyncGenerator:yM,__asyncDelegator:Wre,__asyncValues:bM,__makeTemplateObject:Yre,__importStar:Xre,__importDefault:Jre,__classPrivateFieldGet:Qre,__classPrivateFieldSet:Zre,__classPrivateFieldIn:eie,__addDisposableResource:tie,__disposeResources:nie,__rewriteRelativeImportExtension:rie},$at=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:tie,get __assign(){return Ii},__asyncDelegator:Wre,__asyncGenerator:yM,__asyncValues:bM,__await:Eu,__awaiter:vM,__classPrivateFieldGet:Qre,__classPrivateFieldIn:eie,__classPrivateFieldSet:Zre,__createBinding:BT,__decorate:jre,__disposeResources:nie,__esDecorate:$re,__exportStar:Gre,__extends:cc,__generator:$T,__importDefault:Jre,__importStar:Xre,__makeTemplateObject:Yre,__metadata:qre,__param:Fre,__propKey:Hre,__read:Sa,__rest:x_,__rewriteRelativeImportExtension:rie,__runInitializers:Bre,__setFunctionName:Vre,__spread:Kre,__spreadArray:Ea,__spreadArrays:zre,__values:Ef,default:RAe},Symbol.toStringTag,{value:"Module"}));var jy="right-scroll-bar-position",Fy="width-before-scroll-bar",IAe="with-scroll-bars-hidden",kAe="--removed-body-scroll-bar-size";function G6(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function xAe(t,e){var n=_.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var i=n.value;i!==r&&(n.value=r,n.callback(r,i))}}}})[0];return n.callback=e,n.facade}var AAe=typeof window<"u"?_.useLayoutEffect:_.useEffect,Sq=new WeakMap;function iie(t,e){var n=xAe(null,function(r){return t.forEach(function(i){return G6(i,r)})});return AAe(function(){var r=Sq.get(n);if(r){var i=new Set(r),s=new Set(t),o=n.current;i.forEach(function(a){s.has(a)||G6(a,null)}),s.forEach(function(a){i.has(a)||G6(a,o)})}Sq.set(n,t)},[t]),n}function PAe(t){return t}function LAe(t,e){e===void 0&&(e=PAe);var n=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(s){var o=e(s,r);return n.push(o),function(){n=n.filter(function(a){return a!==o})}},assignSyncMedium:function(s){for(r=!0;n.length;){var o=n;n=[],o.forEach(s)}n={push:function(a){return s(a)},filter:function(){return n}}},assignMedium:function(s){r=!0;var o=[];if(n.length){var a=n;n=[],a.forEach(s),o=n}var c=function(){var d=o;o=[],d.forEach(s)},l=function(){return Promise.resolve().then(c)};l(),n={push:function(d){o.push(d),l()},filter:function(d){return o=o.filter(d),n}}}};return i}function sie(t){t===void 0&&(t={});var e=LAe(null);return e.options=Ii({async:!0,ssr:!1},t),e}var oie=function(t){var e=t.sideCar,n=x_(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return _.createElement(r,Ii({},n))};oie.isSideCarExport=!0;function aie(t,e){return t.useMedium(e),oie}var cie=sie(),K6=function(){},HT=_.forwardRef(function(t,e){var n=_.useRef(null),r=_.useState({onScrollCapture:K6,onWheelCapture:K6,onTouchMoveCapture:K6}),i=r[0],s=r[1],o=t.forwardProps,a=t.children,c=t.className,l=t.removeScrollBar,d=t.enabled,h=t.shards,m=t.sideCar,g=t.noIsolation,y=t.inert,v=t.allowPinchZoom,w=t.as,S=w===void 0?"div":w,R=t.gapMode,x=x_(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),T=m,I=iie([n,e]),k=Ii(Ii({},x),i);return _.createElement(_.Fragment,null,d&&_.createElement(T,{sideCar:cie,removeScrollBar:l,shards:h,noIsolation:g,inert:y,setCallbacks:s,allowPinchZoom:!!v,lockRef:n,gapMode:R}),o?_.cloneElement(_.Children.only(a),Ii(Ii({},k),{ref:I})):_.createElement(S,Ii({},k,{className:c,ref:I}),a))});HT.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};HT.classNames={fullWidth:Fy,zeroRight:jy};var OAe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function MAe(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=OAe();return e&&t.setAttribute("nonce",e),t}function DAe(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function NAe(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var UAe=function(){var t=0,e=null;return{add:function(n){t==0&&(e=MAe())&&(DAe(e,n),NAe(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},jAe=function(){var t=UAe();return function(e,n){_.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},_M=function(){var t=jAe(),e=function(n){var r=n.styles,i=n.dynamic;return t(r,i),null};return e},FAe={left:0,top:0,right:0,gap:0},z6=function(t){return parseInt(t||"",10)||0},$Ae=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],i=e[t==="padding"?"paddingRight":"marginRight"];return[z6(n),z6(r),z6(i)]},BAe=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return FAe;var e=$Ae(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},HAe=_M(),Ug="data-scroll-locked",VAe=function(t,e,n,r){var i=t.left,s=t.top,o=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(IAe,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(Ug,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(jy,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Fy,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(jy," .").concat(jy,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Fy," .").concat(Fy,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Ug,`] {
    `).concat(kAe,": ").concat(a,`px;
  }
`)},Eq=function(){var t=parseInt(document.body.getAttribute(Ug)||"0",10);return isFinite(t)?t:0},qAe=function(){_.useEffect(function(){return document.body.setAttribute(Ug,(Eq()+1).toString()),function(){var t=Eq()-1;t<=0?document.body.removeAttribute(Ug):document.body.setAttribute(Ug,t.toString())}},[])},lie=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,i=r===void 0?"margin":r;qAe();var s=_.useMemo(function(){return BAe(i)},[i]);return _.createElement(HAe,{styles:VAe(s,!e,i,n?"":"!important")})},HP=!1;if(typeof window<"u")try{var Q2=Object.defineProperty({},"passive",{get:function(){return HP=!0,!0}});window.addEventListener("test",Q2,Q2),window.removeEventListener("test",Q2,Q2)}catch{HP=!1}var Fm=HP?{passive:!1}:!1,GAe=function(t){return t.tagName==="TEXTAREA"},uie=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!GAe(t)&&n[e]==="visible")},KAe=function(t){return uie(t,"overflowY")},zAe=function(t){return uie(t,"overflowX")},wq=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=die(t,r);if(i){var s=fie(t,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},WAe=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},YAe=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},die=function(t,e){return t==="v"?KAe(e):zAe(e)},fie=function(t,e){return t==="v"?WAe(e):YAe(e)},XAe=function(t,e){return t==="h"&&e==="rtl"?-1:1},JAe=function(t,e,n,r,i){var s=XAe(t,window.getComputedStyle(e).direction),o=s*r,a=n.target,c=e.contains(a),l=!1,d=o>0,h=0,m=0;do{var g=fie(t,a),y=g[0],v=g[1],w=g[2],S=v-w-s*y;(y||S)&&die(t,a)&&(h+=S,m+=y),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(d&&Math.abs(h)<1||!d&&Math.abs(m)<1)&&(l=!0),l},Z2=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Cq=function(t){return[t.deltaX,t.deltaY]},Tq=function(t){return t&&"current"in t?t.current:t},QAe=function(t,e){return t[0]===e[0]&&t[1]===e[1]},ZAe=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},ePe=0,$m=[];function tPe(t){var e=_.useRef([]),n=_.useRef([0,0]),r=_.useRef(),i=_.useState(ePe++)[0],s=_.useState(_M)[0],o=_.useRef(t);_.useEffect(function(){o.current=t},[t]),_.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var v=Ea([t.lockRef.current],(t.shards||[]).map(Tq),!0).filter(Boolean);return v.forEach(function(w){return w.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),v.forEach(function(w){return w.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var a=_.useCallback(function(v,w){if("touches"in v&&v.touches.length===2||v.type==="wheel"&&v.ctrlKey)return!o.current.allowPinchZoom;var S=Z2(v),R=n.current,x="deltaX"in v?v.deltaX:R[0]-S[0],T="deltaY"in v?v.deltaY:R[1]-S[1],I,k=v.target,A=Math.abs(x)>Math.abs(T)?"h":"v";if("touches"in v&&A==="h"&&k.type==="range")return!1;var O=wq(A,k);if(!O)return!0;if(O?I=A:(I=A==="v"?"h":"v",O=wq(A,k)),!O)return!1;if(!r.current&&"changedTouches"in v&&(x||T)&&(r.current=I),!I)return!0;var D=r.current||I;return JAe(D,w,v,D==="h"?x:T)},[]),c=_.useCallback(function(v){var w=v;if(!(!$m.length||$m[$m.length-1]!==s)){var S="deltaY"in w?Cq(w):Z2(w),R=e.current.filter(function(I){return I.name===w.type&&(I.target===w.target||w.target===I.shadowParent)&&QAe(I.delta,S)})[0];if(R&&R.should){w.cancelable&&w.preventDefault();return}if(!R){var x=(o.current.shards||[]).map(Tq).filter(Boolean).filter(function(I){return I.contains(w.target)}),T=x.length>0?a(w,x[0]):!o.current.noIsolation;T&&w.cancelable&&w.preventDefault()}}},[]),l=_.useCallback(function(v,w,S,R){var x={name:v,delta:w,target:S,should:R,shadowParent:nPe(S)};e.current.push(x),setTimeout(function(){e.current=e.current.filter(function(T){return T!==x})},1)},[]),d=_.useCallback(function(v){n.current=Z2(v),r.current=void 0},[]),h=_.useCallback(function(v){l(v.type,Cq(v),v.target,a(v,t.lockRef.current))},[]),m=_.useCallback(function(v){l(v.type,Z2(v),v.target,a(v,t.lockRef.current))},[]);_.useEffect(function(){return $m.push(s),t.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:m}),document.addEventListener("wheel",c,Fm),document.addEventListener("touchmove",c,Fm),document.addEventListener("touchstart",d,Fm),function(){$m=$m.filter(function(v){return v!==s}),document.removeEventListener("wheel",c,Fm),document.removeEventListener("touchmove",c,Fm),document.removeEventListener("touchstart",d,Fm)}},[]);var g=t.removeScrollBar,y=t.inert;return _.createElement(_.Fragment,null,y?_.createElement(s,{styles:ZAe(i)}):null,g?_.createElement(lie,{gapMode:t.gapMode}):null)}function nPe(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const rPe=aie(cie,tPe);var hie=_.forwardRef(function(t,e){return _.createElement(HT,Ii({},t,{ref:e,sideCar:rPe}))});hie.classNames=HT.classNames;var VP=["Enter"," "],iPe=["ArrowDown","PageUp","Home"],pie=["ArrowUp","PageDown","End"],sPe=[...iPe,...pie],oPe={ltr:[...VP,"ArrowRight"],rtl:[...VP,"ArrowLeft"]},aPe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},A_="Menu",[xb,cPe,lPe]=ore(A_),[Ap,VT]=xp(A_,[lPe,bre,Pre]),qT=bre(),mie=Pre(),[uPe,Pp]=Ap(A_),[dPe,P_]=Ap(A_),gie=t=>{const{__scopeMenu:e,open:n=!1,children:r,dir:i,onOpenChange:s,modal:o=!0}=t,a=qT(e),[c,l]=_.useState(null),d=_.useRef(!1),h=ju(s),m=are(i);return _.useEffect(()=>{const g=()=>{d.current=!0,document.addEventListener("pointerdown",y,{capture:!0,once:!0}),document.addEventListener("pointermove",y,{capture:!0,once:!0})},y=()=>d.current=!1;return document.addEventListener("keydown",g,{capture:!0}),()=>{document.removeEventListener("keydown",g,{capture:!0}),document.removeEventListener("pointerdown",y,{capture:!0}),document.removeEventListener("pointermove",y,{capture:!0})}},[]),E.jsx(eAe,{...a,children:E.jsx(uPe,{scope:e,open:n,onOpenChange:h,content:c,onContentChange:l,children:E.jsx(dPe,{scope:e,onClose:_.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:d,dir:m,modal:o,children:r})})})};gie.displayName=A_;var fPe="MenuAnchor",SM=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=qT(n);return E.jsx(tAe,{...i,...r,ref:e})});SM.displayName=fPe;var EM="MenuPortal",[hPe,vie]=Ap(EM,{forceMount:void 0}),yie=t=>{const{__scopeMenu:e,forceMount:n,children:r,container:i}=t,s=Pp(EM,e);return E.jsx(hPe,{scope:e,forceMount:n,children:E.jsx(k_,{present:n||s.open,children:E.jsx(kre,{asChild:!0,container:i,children:r})})})};yie.displayName=EM;var ma="MenuContent",[pPe,wM]=Ap(ma),bie=_.forwardRef((t,e)=>{const n=vie(ma,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,s=Pp(ma,t.__scopeMenu),o=P_(ma,t.__scopeMenu);return E.jsx(xb.Provider,{scope:t.__scopeMenu,children:E.jsx(k_,{present:r||s.open,children:E.jsx(xb.Slot,{scope:t.__scopeMenu,children:o.modal?E.jsx(mPe,{...i,ref:e}):E.jsx(gPe,{...i,ref:e})})})})}),mPe=_.forwardRef((t,e)=>{const n=Pp(ma,t.__scopeMenu),r=_.useRef(null),i=bs(e,r);return _.useEffect(()=>{const s=r.current;if(s)return Ure(s)},[]),E.jsx(CM,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:St(t.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),gPe=_.forwardRef((t,e)=>{const n=Pp(ma,t.__scopeMenu);return E.jsx(CM,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),CM=_.forwardRef((t,e)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:c,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:m,onDismiss:g,disableOutsideScroll:y,...v}=t,w=Pp(ma,n),S=P_(ma,n),R=qT(n),x=mie(n),T=cPe(n),[I,k]=_.useState(null),A=_.useRef(null),O=bs(e,A,w.onContentChange),D=_.useRef(0),N=_.useRef(""),U=_.useRef(0),$=_.useRef(null),K=_.useRef("right"),Y=_.useRef(0),G=y?hie:_.Fragment,F=y?{as:gv,allowPinchZoom:!0}:void 0,q=W=>{const V=N.current+W,X=T().filter(_e=>!_e.disabled),ne=document.activeElement,fe=X.find(_e=>_e.ref.current===ne)?.textValue,ye=X.map(_e=>_e.textValue),Ae=kPe(ye,V,fe),be=X.find(_e=>_e.textValue===Ae)?.ref.current;(function _e(Ie){N.current=Ie,window.clearTimeout(D.current),Ie!==""&&(D.current=window.setTimeout(()=>_e(""),1e3))})(V),be&&setTimeout(()=>be.focus())};_.useEffect(()=>()=>window.clearTimeout(D.current),[]),pre();const z=_.useCallback(W=>K.current===$.current?.side&&APe(W,$.current?.area),[]);return E.jsx(pPe,{scope:n,searchRef:N,onItemEnter:_.useCallback(W=>{z(W)&&W.preventDefault()},[z]),onItemLeave:_.useCallback(W=>{z(W)||(A.current?.focus(),k(null))},[z]),onTriggerLeave:_.useCallback(W=>{z(W)&&W.preventDefault()},[z]),pointerGraceTimerRef:U,onPointerGraceIntentChange:_.useCallback(W=>{$.current=W},[]),children:E.jsx(G,{...F,children:E.jsx(mre,{asChild:!0,trapped:i,onMountAutoFocus:St(s,W=>{W.preventDefault(),A.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:E.jsx(pM,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:m,onDismiss:g,children:E.jsx(bAe,{asChild:!0,...x,dir:S.dir,orientation:"vertical",loop:r,currentTabStopId:I,onCurrentTabStopIdChange:k,onEntryFocus:St(c,W=>{S.isUsingKeyboardRef.current||W.preventDefault()}),preventScrollOnEntryFocus:!0,children:E.jsx(nAe,{role:"menu","aria-orientation":"vertical","data-state":Die(w.open),"data-radix-menu-content":"",dir:S.dir,...R,...v,ref:O,style:{outline:"none",...v.style},onKeyDown:St(v.onKeyDown,W=>{const X=W.target.closest("[data-radix-menu-content]")===W.currentTarget,ne=W.ctrlKey||W.altKey||W.metaKey,fe=W.key.length===1;X&&(W.key==="Tab"&&W.preventDefault(),!ne&&fe&&q(W.key));const ye=A.current;if(W.target!==ye||!sPe.includes(W.key))return;W.preventDefault();const be=T().filter(_e=>!_e.disabled).map(_e=>_e.ref.current);pie.includes(W.key)&&be.reverse(),RPe(be)}),onBlur:St(t.onBlur,W=>{W.currentTarget.contains(W.target)||(window.clearTimeout(D.current),N.current="")}),onPointerMove:St(t.onPointerMove,Ab(W=>{const V=W.target,X=Y.current!==W.clientX;if(W.currentTarget.contains(V)&&X){const ne=W.clientX>Y.current?"right":"left";K.current=ne,Y.current=W.clientX}}))})})})})})})});bie.displayName=ma;var vPe="MenuGroup",TM=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return E.jsx(Pr.div,{role:"group",...r,ref:e})});TM.displayName=vPe;var yPe="MenuLabel",_ie=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return E.jsx(Pr.div,{...r,ref:e})});_ie.displayName=yPe;var KC="MenuItem",Rq="menu.itemSelect",GT=_.forwardRef((t,e)=>{const{disabled:n=!1,onSelect:r,...i}=t,s=_.useRef(null),o=P_(KC,t.__scopeMenu),a=wM(KC,t.__scopeMenu),c=bs(e,s),l=_.useRef(!1),d=()=>{const h=s.current;if(!n&&h){const m=new CustomEvent(Rq,{bubbles:!0,cancelable:!0});h.addEventListener(Rq,g=>r?.(g),{once:!0}),g5e(h,m),m.defaultPrevented?l.current=!1:o.onClose()}};return E.jsx(Sie,{...i,ref:c,disabled:n,onClick:St(t.onClick,d),onPointerDown:h=>{t.onPointerDown?.(h),l.current=!0},onPointerUp:St(t.onPointerUp,h=>{l.current||h.currentTarget?.click()}),onKeyDown:St(t.onKeyDown,h=>{const m=a.searchRef.current!=="";n||m&&h.key===" "||VP.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});GT.displayName=KC;var Sie=_.forwardRef((t,e)=>{const{__scopeMenu:n,disabled:r=!1,textValue:i,...s}=t,o=wM(KC,n),a=mie(n),c=_.useRef(null),l=bs(e,c),[d,h]=_.useState(!1),[m,g]=_.useState("");return _.useEffect(()=>{const y=c.current;y&&g((y.textContent??"").trim())},[s.children]),E.jsx(xb.ItemSlot,{scope:n,disabled:r,textValue:i??m,children:E.jsx(_Ae,{asChild:!0,...a,focusable:!r,children:E.jsx(Pr.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...s,ref:l,onPointerMove:St(t.onPointerMove,Ab(y=>{r?o.onItemLeave(y):(o.onItemEnter(y),y.defaultPrevented||y.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:St(t.onPointerLeave,Ab(y=>o.onItemLeave(y))),onFocus:St(t.onFocus,()=>h(!0)),onBlur:St(t.onBlur,()=>h(!1))})})})}),bPe="MenuCheckboxItem",Eie=_.forwardRef((t,e)=>{const{checked:n=!1,onCheckedChange:r,...i}=t;return E.jsx(Iie,{scope:t.__scopeMenu,checked:n,children:E.jsx(GT,{role:"menuitemcheckbox","aria-checked":zC(n)?"mixed":n,...i,ref:e,"data-state":IM(n),onSelect:St(i.onSelect,()=>r?.(zC(n)?!0:!n),{checkForDefaultPrevented:!1})})})});Eie.displayName=bPe;var wie="MenuRadioGroup",[_Pe,SPe]=Ap(wie,{value:void 0,onValueChange:()=>{}}),Cie=_.forwardRef((t,e)=>{const{value:n,onValueChange:r,...i}=t,s=ju(r);return E.jsx(_Pe,{scope:t.__scopeMenu,value:n,onValueChange:s,children:E.jsx(TM,{...i,ref:e})})});Cie.displayName=wie;var Tie="MenuRadioItem",Rie=_.forwardRef((t,e)=>{const{value:n,...r}=t,i=SPe(Tie,t.__scopeMenu),s=n===i.value;return E.jsx(Iie,{scope:t.__scopeMenu,checked:s,children:E.jsx(GT,{role:"menuitemradio","aria-checked":s,...r,ref:e,"data-state":IM(s),onSelect:St(r.onSelect,()=>i.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});Rie.displayName=Tie;var RM="MenuItemIndicator",[Iie,EPe]=Ap(RM,{checked:!1}),kie=_.forwardRef((t,e)=>{const{__scopeMenu:n,forceMount:r,...i}=t,s=EPe(RM,n);return E.jsx(k_,{present:r||zC(s.checked)||s.checked===!0,children:E.jsx(Pr.span,{...i,ref:e,"data-state":IM(s.checked)})})});kie.displayName=RM;var wPe="MenuSeparator",xie=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return E.jsx(Pr.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});xie.displayName=wPe;var CPe="MenuArrow",Aie=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=qT(n);return E.jsx(rAe,{...i,...r,ref:e})});Aie.displayName=CPe;var TPe="MenuSub",[Bat,Pie]=Ap(TPe),py="MenuSubTrigger",Lie=_.forwardRef((t,e)=>{const n=Pp(py,t.__scopeMenu),r=P_(py,t.__scopeMenu),i=Pie(py,t.__scopeMenu),s=wM(py,t.__scopeMenu),o=_.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:c}=s,l={__scopeMenu:t.__scopeMenu},d=_.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return _.useEffect(()=>d,[d]),_.useEffect(()=>{const h=a.current;return()=>{window.clearTimeout(h),c(null)}},[a,c]),E.jsx(SM,{asChild:!0,...l,children:E.jsx(Sie,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":Die(n.open),...t,ref:jT(e,i.onTriggerChange),onClick:h=>{t.onClick?.(h),!(t.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:St(t.onPointerMove,Ab(h=>{s.onItemEnter(h),!h.defaultPrevented&&!t.disabled&&!n.open&&!o.current&&(s.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{n.onOpenChange(!0),d()},100))})),onPointerLeave:St(t.onPointerLeave,Ab(h=>{d();const m=n.content?.getBoundingClientRect();if(m){const g=n.content?.dataset.side,y=g==="right",v=y?-5:5,w=m[y?"left":"right"],S=m[y?"right":"left"];s.onPointerGraceIntentChange({area:[{x:h.clientX+v,y:h.clientY},{x:w,y:m.top},{x:S,y:m.top},{x:S,y:m.bottom},{x:w,y:m.bottom}],side:g}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(h),h.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:St(t.onKeyDown,h=>{const m=s.searchRef.current!=="";t.disabled||m&&h.key===" "||oPe[r.dir].includes(h.key)&&(n.onOpenChange(!0),n.content?.focus(),h.preventDefault())})})})});Lie.displayName=py;var Oie="MenuSubContent",Mie=_.forwardRef((t,e)=>{const n=vie(ma,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,s=Pp(ma,t.__scopeMenu),o=P_(ma,t.__scopeMenu),a=Pie(Oie,t.__scopeMenu),c=_.useRef(null),l=bs(e,c);return E.jsx(xb.Provider,{scope:t.__scopeMenu,children:E.jsx(k_,{present:r||s.open,children:E.jsx(xb.Slot,{scope:t.__scopeMenu,children:E.jsx(CM,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:l,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{o.isUsingKeyboardRef.current&&c.current?.focus(),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:St(t.onFocusOutside,d=>{d.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:St(t.onEscapeKeyDown,d=>{o.onClose(),d.preventDefault()}),onKeyDown:St(t.onKeyDown,d=>{const h=d.currentTarget.contains(d.target),m=aPe[o.dir].includes(d.key);h&&m&&(s.onOpenChange(!1),a.trigger?.focus(),d.preventDefault())})})})})})});Mie.displayName=Oie;function Die(t){return t?"open":"closed"}function zC(t){return t==="indeterminate"}function IM(t){return zC(t)?"indeterminate":t?"checked":"unchecked"}function RPe(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function IPe(t,e){return t.map((n,r)=>t[(e+r)%t.length])}function kPe(t,e,n){const i=e.length>1&&Array.from(e).every(l=>l===e[0])?e[0]:e,s=n?t.indexOf(n):-1;let o=IPe(t,Math.max(s,0));i.length===1&&(o=o.filter(l=>l!==n));const c=o.find(l=>l.toLowerCase().startsWith(i.toLowerCase()));return c!==n?c:void 0}function xPe(t,e){const{x:n,y:r}=t;let i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s].x,c=e[s].y,l=e[o].x,d=e[o].y;c>r!=d>r&&n<(l-a)*(r-c)/(d-c)+a&&(i=!i)}return i}function APe(t,e){if(!e)return!1;const n={x:t.clientX,y:t.clientY};return xPe(n,e)}function Ab(t){return e=>e.pointerType==="mouse"?t(e):void 0}var Nie=gie,Uie=SM,jie=yie,Fie=bie,$ie=TM,Bie=_ie,Hie=GT,Vie=Eie,qie=Cie,Gie=Rie,Kie=kie,zie=xie,Wie=Aie,Yie=Lie,Xie=Mie,kM="ContextMenu",[PPe,Hat]=xp(kM,[VT]),ws=VT(),[LPe,Jie]=PPe(kM),Qie=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,dir:i,modal:s=!0}=t,[o,a]=_.useState(!1),c=ws(e),l=ju(r),d=_.useCallback(h=>{a(h),l(h)},[l]);return E.jsx(LPe,{scope:e,open:o,onOpenChange:d,modal:s,children:E.jsx(Nie,{...c,dir:i,open:o,onOpenChange:d,modal:s,children:n})})};Qie.displayName=kM;var Zie="ContextMenuTrigger",ese=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,disabled:r=!1,...i}=t,s=Jie(Zie,n),o=ws(n),a=_.useRef({x:0,y:0}),c=_.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),l=_.useRef(0),d=_.useCallback(()=>window.clearTimeout(l.current),[]),h=m=>{a.current={x:m.clientX,y:m.clientY},s.onOpenChange(!0)};return _.useEffect(()=>d,[d]),_.useEffect(()=>void(r&&d()),[r,d]),E.jsxs(E.Fragment,{children:[E.jsx(Uie,{...o,virtualRef:c}),E.jsx(Pr.span,{"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:e,style:{WebkitTouchCallout:"none",...t.style},onContextMenu:r?t.onContextMenu:St(t.onContextMenu,m=>{d(),h(m),m.preventDefault()}),onPointerDown:r?t.onPointerDown:St(t.onPointerDown,eE(m=>{d(),l.current=window.setTimeout(()=>h(m),700)})),onPointerMove:r?t.onPointerMove:St(t.onPointerMove,eE(d)),onPointerCancel:r?t.onPointerCancel:St(t.onPointerCancel,eE(d)),onPointerUp:r?t.onPointerUp:St(t.onPointerUp,eE(d))})]})});ese.displayName=Zie;var OPe="ContextMenuPortal",tse=t=>{const{__scopeContextMenu:e,...n}=t,r=ws(e);return E.jsx(jie,{...r,...n})};tse.displayName=OPe;var nse="ContextMenuContent",rse=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Jie(nse,n),s=ws(n),o=_.useRef(!1);return E.jsx(Fie,{...s,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{t.onCloseAutoFocus?.(a),!a.defaultPrevented&&o.current&&a.preventDefault(),o.current=!1},onInteractOutside:a=>{t.onInteractOutside?.(a),!a.defaultPrevented&&!i.modal&&(o.current=!0)},style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});rse.displayName=nse;var MPe="ContextMenuGroup",DPe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=ws(n);return E.jsx($ie,{...i,...r,ref:e})});DPe.displayName=MPe;var NPe="ContextMenuLabel",UPe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=ws(n);return E.jsx(Bie,{...i,...r,ref:e})});UPe.displayName=NPe;var jPe="ContextMenuItem",ise=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=ws(n);return E.jsx(Hie,{...i,...r,ref:e})});ise.displayName=jPe;var FPe="ContextMenuCheckboxItem",$Pe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=ws(n);return E.jsx(Vie,{...i,...r,ref:e})});$Pe.displayName=FPe;var BPe="ContextMenuRadioGroup",HPe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=ws(n);return E.jsx(qie,{...i,...r,ref:e})});HPe.displayName=BPe;var VPe="ContextMenuRadioItem",qPe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=ws(n);return E.jsx(Gie,{...i,...r,ref:e})});qPe.displayName=VPe;var GPe="ContextMenuItemIndicator",KPe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=ws(n);return E.jsx(Kie,{...i,...r,ref:e})});KPe.displayName=GPe;var zPe="ContextMenuSeparator",WPe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=ws(n);return E.jsx(zie,{...i,...r,ref:e})});WPe.displayName=zPe;var YPe="ContextMenuArrow",XPe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=ws(n);return E.jsx(Wie,{...i,...r,ref:e})});XPe.displayName=YPe;var JPe="ContextMenuSubTrigger",QPe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=ws(n);return E.jsx(Yie,{...i,...r,ref:e})});QPe.displayName=JPe;var ZPe="ContextMenuSubContent",eLe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=ws(n);return E.jsx(Xie,{...i,...r,ref:e,style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});eLe.displayName=ZPe;function eE(t){return e=>e.pointerType!=="mouse"?t(e):void 0}var Iq=Qie,tLe=ese,nLe=tse,rLe=rse;const iLe="_menu_19sse_8",sLe="_title_19sse_74",kq={menu:iLe,title:sLe},oLe={"menu-title":"_menu-title_1sgvx_8"},aLe=({title:t,id:e,className:n})=>{const r=Oe(oLe["menu-title"],n);return E.jsx(an,{as:"h3",id:e,className:r,size:"sm",weight:"semibold",children:t})},xM=_.forwardRef(({title:t,showTitle:e=!0,className:n,children:r,...i},s)=>{const o=_.useId();return E.jsxs("div",{role:"menu",ref:s,"aria-label":e?void 0:t,"aria-labelledby":e?o:void 0,className:Oe(n,kq.menu),...i,children:[e&&E.jsx(aLe,{className:kq.title,title:t,id:o}),r]})});xM.displayName="FloatingMenu";function $y(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t?.(i),n===!1||!i.defaultPrevented)return e?.(i)}}function xq(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function sse(...t){return e=>{let n=!1;const r=t.map(i=>{const s=xq(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():xq(t[i],null)}}}}function AM(...t){return _.useCallback(sse(...t),t)}function cLe(t,e){const n=_.createContext(e),r=s=>{const{children:o,...a}=s,c=_.useMemo(()=>a,Object.values(a));return E.jsx(n.Provider,{value:c,children:o})};r.displayName=t+"Provider";function i(s){const o=_.useContext(n);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[r,i]}function lLe(t,e=[]){let n=[];function r(s,o){const a=_.createContext(o),c=n.length;n=[...n,o];const l=h=>{const{scope:m,children:g,...y}=h,v=m?.[t]?.[c]||a,w=_.useMemo(()=>y,Object.values(y));return E.jsx(v.Provider,{value:w,children:g})};l.displayName=s+"Provider";function d(h,m){const g=m?.[t]?.[c]||a,y=_.useContext(g);if(y)return y;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[l,d]}const i=()=>{const s=n.map(o=>_.createContext(o));return function(a){const c=a?.[t]||s;return _.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return i.scopeName=t,[r,uLe(i,...e)]}function uLe(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:l})=>{const h=c(s)[`__scope${l}`];return{...a,...h}},{});return _.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}var up=globalThis?.document?_.useLayoutEffect:()=>{},dLe=m_[" useId ".trim().toString()]||(()=>{}),fLe=0;function W6(t){const[e,n]=_.useState(dLe());return up(()=>{n(r=>r??String(fLe++))},[t]),t||(e?`radix-${e}`:"")}var hLe=m_[" useInsertionEffect ".trim().toString()]||up;function pLe({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[i,s,o]=mLe({defaultProp:e,onChange:n}),a=t!==void 0,c=a?t:i;{const d=_.useRef(t!==void 0);_.useEffect(()=>{const h=d.current;h!==a&&console.warn(`${r} is changing from ${h?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=a},[a,r])}const l=_.useCallback(d=>{if(a){const h=gLe(d)?d(t):d;h!==t&&o.current?.(h)}else s(d)},[a,t,s,o]);return[c,l]}function mLe({defaultProp:t,onChange:e}){const[n,r]=_.useState(t),i=_.useRef(n),s=_.useRef(e);return hLe(()=>{s.current=e},[e]),_.useEffect(()=>{i.current!==n&&(s.current?.(n),i.current=n)},[n,i]),[n,r,s]}function gLe(t){return typeof t=="function"}function Aq(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function ose(...t){return e=>{let n=!1;const r=t.map(i=>{const s=Aq(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():Aq(t[i],null)}}}}function vLe(...t){return _.useCallback(ose(...t),t)}function yLe(t){const e=bLe(t),n=_.forwardRef((r,i)=>{const{children:s,...o}=r,a=_.Children.toArray(s),c=a.find(SLe);if(c){const l=c.props.children,d=a.map(h=>h===c?_.Children.count(l)>1?_.Children.only(null):_.isValidElement(l)?l.props.children:null:h);return E.jsx(e,{...o,ref:i,children:_.isValidElement(l)?_.cloneElement(l,void 0,d):null})}return E.jsx(e,{...o,ref:i,children:s})});return n.displayName=`${t}.Slot`,n}function bLe(t){const e=_.forwardRef((n,r)=>{const{children:i,...s}=n;if(_.isValidElement(i)){const o=wLe(i),a=ELe(s,i.props);return i.type!==_.Fragment&&(a.ref=r?ose(r,o):o),_.cloneElement(i,a)}return _.Children.count(i)>1?_.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var _Le=Symbol("radix.slottable");function SLe(t){return _.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===_Le}function ELe(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{const c=s(...a);return i(...a),c}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function wLe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var CLe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],TLe=CLe.reduce((t,e)=>{const n=yLe(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function Pq(t){const e=_.useRef(t);return _.useEffect(()=>{e.current=t}),_.useMemo(()=>(...n)=>e.current?.(...n),[])}var Y6="focusScope.autoFocusOnMount",X6="focusScope.autoFocusOnUnmount",Lq={bubbles:!1,cancelable:!0},RLe="FocusScope",ase=_.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=t,[a,c]=_.useState(null),l=Pq(i),d=Pq(s),h=_.useRef(null),m=vLe(e,v=>c(v)),g=_.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_.useEffect(()=>{if(r){let v=function(x){if(g.paused||!a)return;const T=x.target;a.contains(T)?h.current=T:Od(h.current,{select:!0})},w=function(x){if(g.paused||!a)return;const T=x.relatedTarget;T!==null&&(a.contains(T)||Od(h.current,{select:!0}))},S=function(x){if(document.activeElement===document.body)for(const I of x)I.removedNodes.length>0&&Od(a)};document.addEventListener("focusin",v),document.addEventListener("focusout",w);const R=new MutationObserver(S);return a&&R.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",v),document.removeEventListener("focusout",w),R.disconnect()}}},[r,a,g.paused]),_.useEffect(()=>{if(a){Mq.add(g);const v=document.activeElement;if(!a.contains(v)){const S=new CustomEvent(Y6,Lq);a.addEventListener(Y6,l),a.dispatchEvent(S),S.defaultPrevented||(ILe(LLe(cse(a)),{select:!0}),document.activeElement===v&&Od(a))}return()=>{a.removeEventListener(Y6,l),setTimeout(()=>{const S=new CustomEvent(X6,Lq);a.addEventListener(X6,d),a.dispatchEvent(S),S.defaultPrevented||Od(v??document.body,{select:!0}),a.removeEventListener(X6,d),Mq.remove(g)},0)}}},[a,l,d,g]);const y=_.useCallback(v=>{if(!n&&!r||g.paused)return;const w=v.key==="Tab"&&!v.altKey&&!v.ctrlKey&&!v.metaKey,S=document.activeElement;if(w&&S){const R=v.currentTarget,[x,T]=kLe(R);x&&T?!v.shiftKey&&S===T?(v.preventDefault(),n&&Od(x,{select:!0})):v.shiftKey&&S===x&&(v.preventDefault(),n&&Od(T,{select:!0})):S===R&&v.preventDefault()}},[n,r,g.paused]);return E.jsx(TLe.div,{tabIndex:-1,...o,ref:m,onKeyDown:y})});ase.displayName=RLe;function ILe(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(Od(r,{select:e}),document.activeElement!==n)return}function kLe(t){const e=cse(t),n=Oq(e,t),r=Oq(e.reverse(),t);return[n,r]}function cse(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Oq(t,e){for(const n of t)if(!xLe(n,{upTo:e}))return n}function xLe(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function ALe(t){return t instanceof HTMLInputElement&&"select"in t}function Od(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&ALe(t)&&e&&t.select()}}var Mq=PLe();function PLe(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=Dq(t,e),t.unshift(e)},remove(e){t=Dq(t,e),t[0]?.resume()}}}function Dq(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function LLe(t){return t.filter(e=>e.tagName!=="A")}function Nq(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function OLe(...t){return e=>{let n=!1;const r=t.map(i=>{const s=Nq(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():Nq(t[i],null)}}}}function MLe(t){const e=DLe(t),n=_.forwardRef((r,i)=>{const{children:s,...o}=r,a=_.Children.toArray(s),c=a.find(ULe);if(c){const l=c.props.children,d=a.map(h=>h===c?_.Children.count(l)>1?_.Children.only(null):_.isValidElement(l)?l.props.children:null:h);return E.jsx(e,{...o,ref:i,children:_.isValidElement(l)?_.cloneElement(l,void 0,d):null})}return E.jsx(e,{...o,ref:i,children:s})});return n.displayName=`${t}.Slot`,n}function DLe(t){const e=_.forwardRef((n,r)=>{const{children:i,...s}=n;if(_.isValidElement(i)){const o=FLe(i),a=jLe(s,i.props);return i.type!==_.Fragment&&(a.ref=r?OLe(r,o):o),_.cloneElement(i,a)}return _.Children.count(i)>1?_.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var NLe=Symbol("radix.slottable");function ULe(t){return _.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===NLe}function jLe(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{const c=s(...a);return i(...a),c}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function FLe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var $Le=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],BLe=$Le.reduce((t,e)=>{const n=MLe(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{}),HLe="Portal",lse=_.forwardRef((t,e)=>{const{container:n,...r}=t,[i,s]=_.useState(!1);up(()=>s(!0),[]);const o=n||i&&globalThis?.document?.body;return o?Yee.createPortal(E.jsx(BLe.div,{...r,ref:e}),o):null});lse.displayName=HLe;function Uq(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function VLe(...t){return e=>{let n=!1;const r=t.map(i=>{const s=Uq(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():Uq(t[i],null)}}}}function qLe(...t){return _.useCallback(VLe(...t),t)}function GLe(t,e){return _.useReducer((n,r)=>e[n][r]??n,t)}var KT=t=>{const{present:e,children:n}=t,r=KLe(e),i=typeof n=="function"?n({present:r.isPresent}):_.Children.only(n),s=qLe(r.ref,zLe(i));return typeof n=="function"||r.isPresent?_.cloneElement(i,{ref:s}):null};KT.displayName="Presence";function KLe(t){const[e,n]=_.useState(),r=_.useRef(null),i=_.useRef(t),s=_.useRef("none"),o=t?"mounted":"unmounted",[a,c]=GLe(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _.useEffect(()=>{const l=tE(r.current);s.current=a==="mounted"?l:"none"},[a]),up(()=>{const l=r.current,d=i.current;if(d!==t){const m=s.current,g=tE(l);t?c("MOUNT"):g==="none"||l?.display==="none"?c("UNMOUNT"):c(d&&m!==g?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,c]),up(()=>{if(e){let l;const d=e.ownerDocument.defaultView??window,h=g=>{const v=tE(r.current).includes(g.animationName);if(g.target===e&&v&&(c("ANIMATION_END"),!i.current)){const w=e.style.animationFillMode;e.style.animationFillMode="forwards",l=d.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=w)})}},m=g=>{g.target===e&&(s.current=tE(r.current))};return e.addEventListener("animationstart",m),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{d.clearTimeout(l),e.removeEventListener("animationstart",m),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:_.useCallback(l=>{r.current=l?getComputedStyle(l):null,n(l)},[])}}function tE(t){return t?.animationName||"none"}function zLe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function use(t){const e=WLe(t),n=_.forwardRef((r,i)=>{const{children:s,...o}=r,a=_.Children.toArray(s),c=a.find(XLe);if(c){const l=c.props.children,d=a.map(h=>h===c?_.Children.count(l)>1?_.Children.only(null):_.isValidElement(l)?l.props.children:null:h);return E.jsx(e,{...o,ref:i,children:_.isValidElement(l)?_.cloneElement(l,void 0,d):null})}return E.jsx(e,{...o,ref:i,children:s})});return n.displayName=`${t}.Slot`,n}function WLe(t){const e=_.forwardRef((n,r)=>{const{children:i,...s}=n;if(_.isValidElement(i)){const o=QLe(i),a=JLe(s,i.props);return i.type!==_.Fragment&&(a.ref=r?sse(r,o):o),_.cloneElement(i,a)}return _.Children.count(i)>1?_.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var YLe=Symbol("radix.slottable");function XLe(t){return _.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===YLe}function JLe(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{const c=s(...a);return i(...a),c}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function QLe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var ZLe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],L_=ZLe.reduce((t,e)=>{const n=use(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{}),dse=sie(),J6=function(){},zT=_.forwardRef(function(t,e){var n=_.useRef(null),r=_.useState({onScrollCapture:J6,onWheelCapture:J6,onTouchMoveCapture:J6}),i=r[0],s=r[1],o=t.forwardProps,a=t.children,c=t.className,l=t.removeScrollBar,d=t.enabled,h=t.shards,m=t.sideCar,g=t.noIsolation,y=t.inert,v=t.allowPinchZoom,w=t.as,S=w===void 0?"div":w,R=t.gapMode,x=x_(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),T=m,I=iie([n,e]),k=Ii(Ii({},x),i);return _.createElement(_.Fragment,null,d&&_.createElement(T,{sideCar:dse,removeScrollBar:l,shards:h,noIsolation:g,inert:y,setCallbacks:s,allowPinchZoom:!!v,lockRef:n,gapMode:R}),o?_.cloneElement(_.Children.only(a),Ii(Ii({},k),{ref:I})):_.createElement(S,Ii({},k,{className:c,ref:I}),a))});zT.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};zT.classNames={fullWidth:Fy,zeroRight:jy};var qP=!1;if(typeof window<"u")try{var nE=Object.defineProperty({},"passive",{get:function(){return qP=!0,!0}});window.addEventListener("test",nE,nE),window.removeEventListener("test",nE,nE)}catch{qP=!1}var Bm=qP?{passive:!1}:!1,eOe=function(t){return t.tagName==="TEXTAREA"},fse=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!eOe(t)&&n[e]==="visible")},tOe=function(t){return fse(t,"overflowY")},nOe=function(t){return fse(t,"overflowX")},jq=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=hse(t,r);if(i){var s=pse(t,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},rOe=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},iOe=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},hse=function(t,e){return t==="v"?tOe(e):nOe(e)},pse=function(t,e){return t==="v"?rOe(e):iOe(e)},sOe=function(t,e){return t==="h"&&e==="rtl"?-1:1},oOe=function(t,e,n,r,i){var s=sOe(t,window.getComputedStyle(e).direction),o=s*r,a=n.target,c=e.contains(a),l=!1,d=o>0,h=0,m=0;do{var g=pse(t,a),y=g[0],v=g[1],w=g[2],S=v-w-s*y;(y||S)&&hse(t,a)&&(h+=S,m+=y),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(d&&Math.abs(h)<1||!d&&Math.abs(m)<1)&&(l=!0),l},rE=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Fq=function(t){return[t.deltaX,t.deltaY]},$q=function(t){return t&&"current"in t?t.current:t},aOe=function(t,e){return t[0]===e[0]&&t[1]===e[1]},cOe=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},lOe=0,Hm=[];function uOe(t){var e=_.useRef([]),n=_.useRef([0,0]),r=_.useRef(),i=_.useState(lOe++)[0],s=_.useState(_M)[0],o=_.useRef(t);_.useEffect(function(){o.current=t},[t]),_.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var v=Ea([t.lockRef.current],(t.shards||[]).map($q),!0).filter(Boolean);return v.forEach(function(w){return w.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),v.forEach(function(w){return w.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var a=_.useCallback(function(v,w){if("touches"in v&&v.touches.length===2||v.type==="wheel"&&v.ctrlKey)return!o.current.allowPinchZoom;var S=rE(v),R=n.current,x="deltaX"in v?v.deltaX:R[0]-S[0],T="deltaY"in v?v.deltaY:R[1]-S[1],I,k=v.target,A=Math.abs(x)>Math.abs(T)?"h":"v";if("touches"in v&&A==="h"&&k.type==="range")return!1;var O=jq(A,k);if(!O)return!0;if(O?I=A:(I=A==="v"?"h":"v",O=jq(A,k)),!O)return!1;if(!r.current&&"changedTouches"in v&&(x||T)&&(r.current=I),!I)return!0;var D=r.current||I;return oOe(D,w,v,D==="h"?x:T)},[]),c=_.useCallback(function(v){var w=v;if(!(!Hm.length||Hm[Hm.length-1]!==s)){var S="deltaY"in w?Fq(w):rE(w),R=e.current.filter(function(I){return I.name===w.type&&(I.target===w.target||w.target===I.shadowParent)&&aOe(I.delta,S)})[0];if(R&&R.should){w.cancelable&&w.preventDefault();return}if(!R){var x=(o.current.shards||[]).map($q).filter(Boolean).filter(function(I){return I.contains(w.target)}),T=x.length>0?a(w,x[0]):!o.current.noIsolation;T&&w.cancelable&&w.preventDefault()}}},[]),l=_.useCallback(function(v,w,S,R){var x={name:v,delta:w,target:S,should:R,shadowParent:dOe(S)};e.current.push(x),setTimeout(function(){e.current=e.current.filter(function(T){return T!==x})},1)},[]),d=_.useCallback(function(v){n.current=rE(v),r.current=void 0},[]),h=_.useCallback(function(v){l(v.type,Fq(v),v.target,a(v,t.lockRef.current))},[]),m=_.useCallback(function(v){l(v.type,rE(v),v.target,a(v,t.lockRef.current))},[]);_.useEffect(function(){return Hm.push(s),t.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:m}),document.addEventListener("wheel",c,Bm),document.addEventListener("touchmove",c,Bm),document.addEventListener("touchstart",d,Bm),function(){Hm=Hm.filter(function(v){return v!==s}),document.removeEventListener("wheel",c,Bm),document.removeEventListener("touchmove",c,Bm),document.removeEventListener("touchstart",d,Bm)}},[]);var g=t.removeScrollBar,y=t.inert;return _.createElement(_.Fragment,null,y?_.createElement(s,{styles:cOe(i)}):null,g?_.createElement(lie,{gapMode:t.gapMode}):null)}function dOe(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const fOe=aie(dse,uOe);var mse=_.forwardRef(function(t,e){return _.createElement(zT,Ii({},t,{ref:e,sideCar:fOe}))});mse.classNames=zT.classNames;var WT="Dialog",[gse,Vat]=lLe(WT),[hOe,lc]=gse(WT),vse=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:i,onOpenChange:s,modal:o=!0}=t,a=_.useRef(null),c=_.useRef(null),[l,d]=pLe({prop:r,defaultProp:i??!1,onChange:s,caller:WT});return E.jsx(hOe,{scope:e,triggerRef:a,contentRef:c,contentId:W6(),titleId:W6(),descriptionId:W6(),open:l,onOpenChange:d,onOpenToggle:_.useCallback(()=>d(h=>!h),[d]),modal:o,children:n})};vse.displayName=WT;var yse="DialogTrigger",bse=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=lc(yse,n),s=AM(e,i.triggerRef);return E.jsx(L_.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":OM(i.open),...r,ref:s,onClick:$y(t.onClick,i.onOpenToggle)})});bse.displayName=yse;var PM="DialogPortal",[pOe,_se]=gse(PM,{forceMount:void 0}),Sse=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:i}=t,s=lc(PM,e);return E.jsx(pOe,{scope:e,forceMount:n,children:_.Children.map(r,o=>E.jsx(KT,{present:n||s.open,children:E.jsx(lse,{asChild:!0,container:i,children:o})}))})};Sse.displayName=PM;var WC="DialogOverlay",Ese=_.forwardRef((t,e)=>{const n=_se(WC,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=lc(WC,t.__scopeDialog);return s.modal?E.jsx(KT,{present:r||s.open,children:E.jsx(gOe,{...i,ref:e})}):null});Ese.displayName=WC;var mOe=use("DialogOverlay.RemoveScroll"),gOe=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=lc(WC,n);return E.jsx(mse,{as:mOe,allowPinchZoom:!0,shards:[i.contentRef],children:E.jsx(L_.div,{"data-state":OM(i.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),dp="DialogContent",wse=_.forwardRef((t,e)=>{const n=_se(dp,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=lc(dp,t.__scopeDialog);return E.jsx(KT,{present:r||s.open,children:s.modal?E.jsx(vOe,{...i,ref:e}):E.jsx(yOe,{...i,ref:e})})});wse.displayName=dp;var vOe=_.forwardRef((t,e)=>{const n=lc(dp,t.__scopeDialog),r=_.useRef(null),i=AM(e,n.contentRef,r);return _.useEffect(()=>{const s=r.current;if(s)return Ure(s)},[]),E.jsx(Cse,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:$y(t.onCloseAutoFocus,s=>{s.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:$y(t.onPointerDownOutside,s=>{const o=s.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&s.preventDefault()}),onFocusOutside:$y(t.onFocusOutside,s=>s.preventDefault())})}),yOe=_.forwardRef((t,e)=>{const n=lc(dp,t.__scopeDialog),r=_.useRef(!1),i=_.useRef(!1);return E.jsx(Cse,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||n.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;n.triggerRef.current?.contains(o)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),Cse=_.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,...o}=t,a=lc(dp,n),c=_.useRef(null),l=AM(e,c);return pre(),E.jsxs(E.Fragment,{children:[E.jsx(ase,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:E.jsx(pM,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":OM(a.open),...o,ref:l,onDismiss:()=>a.onOpenChange(!1)})}),E.jsxs(E.Fragment,{children:[E.jsx(_Oe,{titleId:a.titleId}),E.jsx(EOe,{contentRef:c,descriptionId:a.descriptionId})]})]})}),LM="DialogTitle",Tse=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=lc(LM,n);return E.jsx(L_.h2,{id:i.titleId,...r,ref:e})});Tse.displayName=LM;var Rse="DialogDescription",bOe=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=lc(Rse,n);return E.jsx(L_.p,{id:i.descriptionId,...r,ref:e})});bOe.displayName=Rse;var Ise="DialogClose",kse=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=lc(Ise,n);return E.jsx(L_.button,{type:"button",...r,ref:e,onClick:$y(t.onClick,()=>i.onOpenChange(!1))})});kse.displayName=Ise;function OM(t){return t?"open":"closed"}var xse="DialogTitleWarning",[qat,Ase]=cLe(xse,{contentName:dp,titleName:LM,docsSlug:"dialog"}),_Oe=({titleId:t})=>{const e=Ase(xse),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return _.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},SOe="DialogDescriptionWarning",EOe=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Ase(SOe).contentName}}.`;return _.useEffect(()=>{const i=t.current?.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},MM=vse,wOe=bse,DM=Sse,NM=Ese,UM=wse,jM=Tse,Pse=kse;function COe(t){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",e.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}const Lse=Ce.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),O_=()=>{const t=Ce.useContext(Lse);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};COe(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function TOe(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function ROe(){return FM(/^Mac/)}function IOe(){return FM(/^iPhone/)}function Bq(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function kOe(){return FM(/^iPad/)||ROe()&&navigator.maxTouchPoints>1}function Ose(){return IOe()||kOe()}function FM(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const xOe=24,AOe=typeof window<"u"?_.useLayoutEffect:_.useEffect;function Hq(...t){return(...e)=>{for(let n of t)typeof n=="function"&&n(...e)}}const Q6=typeof document<"u"&&window.visualViewport;function Vq(t){let e=window.getComputedStyle(t);return/(auto|scroll)/.test(e.overflow+e.overflowX+e.overflowY)}function Mse(t){for(Vq(t)&&(t=t.parentElement);t&&!Vq(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const POe=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let iE=0,Z6;function LOe(t={}){let{isDisabled:e}=t;AOe(()=>{if(!e)return iE++,iE===1&&Ose()&&(Z6=OOe()),()=>{iE--,iE===0&&Z6?.()}},[e])}function OOe(){let t,e=0,n=h=>{t=Mse(h.target),!(t===document.documentElement&&t===document.body)&&(e=h.changedTouches[0].pageY)},r=h=>{if(!t||t===document.documentElement||t===document.body){h.preventDefault();return}let m=h.changedTouches[0].pageY,g=t.scrollTop,y=t.scrollHeight-t.clientHeight;y!==0&&((g<=0&&m>e||g>=y&&m<e)&&h.preventDefault(),e=m)},i=h=>{let m=h.target;GP(m)&&m!==document.activeElement&&(h.preventDefault(),m.style.transform="translateY(-2000px)",m.focus(),requestAnimationFrame(()=>{m.style.transform=""}))},s=h=>{let m=h.target;GP(m)&&(m.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{m.style.transform="",Q6&&(Q6.height<window.innerHeight?requestAnimationFrame(()=>{qq(m)}):Q6.addEventListener("resize",()=>qq(m),{once:!0}))}))},o=()=>{window.scrollTo(0,0)},a=window.pageXOffset,c=window.pageYOffset,l=Hq(MOe(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let d=Hq(D1(document,"touchstart",n,{passive:!1,capture:!0}),D1(document,"touchmove",r,{passive:!1,capture:!0}),D1(document,"touchend",i,{passive:!1,capture:!0}),D1(document,"focus",s,!0),D1(window,"scroll",o));return()=>{l(),d(),window.scrollTo(a,c)}}function MOe(t,e,n){let r=t.style[e];return t.style[e]=n,()=>{t.style[e]=r}}function D1(t,e,n,r){return t.addEventListener(e,n,r),()=>{t.removeEventListener(e,n,r)}}function qq(t){let e=document.scrollingElement||document.documentElement;for(;t&&t!==e;){let n=Mse(t);if(n!==document.documentElement&&n!==document.body&&n!==t){let r=n.getBoundingClientRect().top,i=t.getBoundingClientRect().top,s=t.getBoundingClientRect().bottom;const o=n.getBoundingClientRect().bottom+xOe;s>o&&(n.scrollTop+=i-r)}t=n.parentElement}}function GP(t){return t instanceof HTMLInputElement&&!POe.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function DOe(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function NOe(...t){return e=>t.forEach(n=>DOe(n,e))}function Dse(...t){return _.useCallback(NOe(...t),t)}const Nse=new WeakMap;function Qr(t,e,n=!1){if(!t||!(t instanceof HTMLElement))return;let r={};Object.entries(e).forEach(([i,s])=>{if(i.startsWith("--")){t.style.setProperty(i,s);return}r[i]=t.style[i],t.style[i]=s}),!n&&Nse.set(t,r)}function UOe(t,e){if(!t||!(t instanceof HTMLElement))return;let n=Nse.get(t);n&&(t.style[e]=n[e])}const jr=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function sE(t,e){if(!t)return null;const n=window.getComputedStyle(t),r=n.transform||n.webkitTransform||n.mozTransform;let i=r.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[jr(e)?13:12]):(i=r.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[jr(e)?5:4]):null)}function jOe(t){return 8*(Math.log(t+1)-2)}function ex(t,e){if(!t)return()=>{};const n=t.style.cssText;return Object.assign(t.style,e),()=>{t.style.cssText=n}}function FOe(...t){return(...e)=>{for(const n of t)typeof n=="function"&&n(...e)}}const ar={DURATION:.5,EASE:[.32,.72,0,1]},Use=.4,$Oe=.25,BOe=100,jse=8,vh=16,KP=26,tx="vaul-dragging";function Fse(t){const e=Ce.useRef(t);return Ce.useEffect(()=>{e.current=t}),Ce.useMemo(()=>(...n)=>e.current==null?void 0:e.current.call(e,...n),[])}function HOe({defaultProp:t,onChange:e}){const n=Ce.useState(t),[r]=n,i=Ce.useRef(r),s=Fse(e);return Ce.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),n}function $se({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,i]=HOe({defaultProp:e,onChange:n}),s=t!==void 0,o=s?t:r,a=Fse(n),c=Ce.useCallback(l=>{if(s){const h=typeof l=="function"?l(t):l;h!==t&&a(h)}else i(l)},[s,t,i,a]);return[o,c]}function VOe({activeSnapPointProp:t,setActiveSnapPointProp:e,snapPoints:n,drawerRef:r,overlayRef:i,fadeFromIndex:s,onSnapPointChange:o,direction:a="bottom",container:c,snapToSequentialPoint:l}){const[d,h]=$se({prop:t,defaultProp:n?.[0],onChange:e}),[m,g]=Ce.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);Ce.useEffect(()=>{function A(){g({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[]);const y=Ce.useMemo(()=>d===n?.[n.length-1]||null,[n,d]),v=Ce.useMemo(()=>{var A;return(A=n?.findIndex(O=>O===d))!=null?A:null},[n,d]),w=n&&n.length>0&&(s||s===0)&&!Number.isNaN(s)&&n[s]===d||!n,S=Ce.useMemo(()=>{const A=c?{width:c.getBoundingClientRect().width,height:c.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var O;return(O=n?.map(D=>{const N=typeof D=="string";let U=0;if(N&&(U=parseInt(D,10)),jr(a)){const K=N?U:m?D*A.height:0;return m?a==="bottom"?A.height-K:-A.height+K:K}const $=N?U:m?D*A.width:0;return m?a==="right"?A.width-$:-A.width+$:$}))!=null?O:[]},[n,m,c]),R=Ce.useMemo(()=>v!==null?S?.[v]:null,[S,v]),x=Ce.useCallback(A=>{var O;const D=(O=S?.findIndex(N=>N===A))!=null?O:null;o(D),Qr(r.current,{transition:`transform ${ar.DURATION}s cubic-bezier(${ar.EASE.join(",")})`,transform:jr(a)?`translate3d(0, ${A}px, 0)`:`translate3d(${A}px, 0, 0)`}),S&&D!==S.length-1&&s!==void 0&&D!==s&&D<s?Qr(i.current,{transition:`opacity ${ar.DURATION}s cubic-bezier(${ar.EASE.join(",")})`,opacity:"0"}):Qr(i.current,{transition:`opacity ${ar.DURATION}s cubic-bezier(${ar.EASE.join(",")})`,opacity:"1"}),h(n?.[Math.max(D,0)])},[r.current,n,S,s,i,h]);Ce.useEffect(()=>{if(d||t){var A;const O=(A=n?.findIndex(D=>D===t||D===d))!=null?A:-1;S&&O!==-1&&typeof S[O]=="number"&&x(S[O])}},[d,t,n,S,x]);function T({draggedDistance:A,closeDrawer:O,velocity:D,dismissible:N}){if(s===void 0)return;const U=a==="bottom"||a==="right"?(R??0)-A:(R??0)+A,$=v===s-1,K=v===0,Y=A>0;if($&&Qr(i.current,{transition:`opacity ${ar.DURATION}s cubic-bezier(${ar.EASE.join(",")})`}),!l&&D>2&&!Y){N?O():x(S[0]);return}if(!l&&D>2&&Y&&S&&n){x(S[n.length-1]);return}const G=S?.reduce((q,z)=>typeof q!="number"||typeof z!="number"?q:Math.abs(z-U)<Math.abs(q-U)?z:q),F=jr(a)?window.innerHeight:window.innerWidth;if(D>Use&&Math.abs(A)<F*.4){const q=Y?1:-1;if(q>0&&y&&n){x(S[n.length-1]);return}if(K&&q<0&&N&&O(),v===null)return;x(S[v+q]);return}x(G)}function I({draggedDistance:A}){if(R===null)return;const O=a==="bottom"||a==="right"?R-A:R+A;(a==="bottom"||a==="right")&&O<S[S.length-1]||(a==="top"||a==="left")&&O>S[S.length-1]||Qr(r.current,{transform:jr(a)?`translate3d(0, ${O}px, 0)`:`translate3d(${O}px, 0, 0)`})}function k(A,O){if(!n||typeof v!="number"||!S||s===void 0)return null;const D=v===s-1;if(v>=s&&O)return 0;if(D&&!O)return 1;if(!w&&!D)return null;const U=D?v+1:v-1,$=D?S[U]-S[U-1]:S[U+1]-S[U],K=A/Math.abs($);return D?1-K:K}return{isLastSnapPoint:y,activeSnapPoint:d,shouldFade:w,getPercentageDragged:k,setActiveSnapPoint:h,activeSnapPointIndex:v,onRelease:T,onDrag:I,snapPointsOffset:S}}const qOe=()=>()=>{};function GOe(){const{direction:t,isOpen:e,shouldScaleBackground:n,setBackgroundColorOnScale:r,noBodyStyles:i}=O_(),s=Ce.useRef(null),o=_.useMemo(()=>document.body.style.backgroundColor,[]);function a(){return(window.innerWidth-KP)/window.innerWidth}Ce.useEffect(()=>{if(e&&n){s.current&&clearTimeout(s.current);const c=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!c)return;FOe(r&&!i?ex(document.body,{background:"black"}):qOe,ex(c,{transformOrigin:jr(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${ar.DURATION}s`,transitionTimingFunction:`cubic-bezier(${ar.EASE.join(",")})`}));const l=ex(c,{borderRadius:`${jse}px`,overflow:"hidden",...jr(t)?{transform:`scale(${a()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${a()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{l(),s.current=window.setTimeout(()=>{o?document.body.style.background=o:document.body.style.removeProperty("background")},ar.DURATION*1e3)}}},[e,n,o])}let N1=null;function KOe({isOpen:t,modal:e,nested:n,hasBeenOpened:r,preventScrollRestoration:i,noBodyStyles:s}){const[o,a]=Ce.useState(()=>typeof window<"u"?window.location.href:""),c=Ce.useRef(0),l=Ce.useCallback(()=>{if(Bq()&&N1===null&&t&&!s){N1={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:h,innerHeight:m}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-c.current}px`,left:`${-h}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const g=m-window.innerHeight;g&&c.current>=m&&(document.body.style.top=`${-(c.current+g)}px`)}),300)}},[t]),d=Ce.useCallback(()=>{if(Bq()&&N1!==null&&!s){const h=-parseInt(document.body.style.top,10),m=-parseInt(document.body.style.left,10);Object.assign(document.body.style,N1),window.requestAnimationFrame(()=>{if(i&&o!==window.location.href){a(window.location.href);return}window.scrollTo(m,h)}),N1=null}},[o]);return Ce.useEffect(()=>{function h(){c.current=window.scrollY}return h(),window.addEventListener("scroll",h),()=>{window.removeEventListener("scroll",h)}},[]),Ce.useEffect(()=>{if(e)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||d()}},[e,d]),Ce.useEffect(()=>{n||!r||(t?(!window.matchMedia("(display-mode: standalone)").matches&&l(),e||window.setTimeout(()=>{d()},500)):d())},[t,r,o,e,n,l,d]),{restorePositionSetting:d}}function zOe({open:t,onOpenChange:e,children:n,onDrag:r,onRelease:i,snapPoints:s,shouldScaleBackground:o=!1,setBackgroundColorOnScale:a=!0,closeThreshold:c=$Oe,scrollLockTimeout:l=BOe,dismissible:d=!0,handleOnly:h=!1,fadeFromIndex:m=s&&s.length-1,activeSnapPoint:g,setActiveSnapPoint:y,fixed:v,modal:w=!0,onClose:S,nested:R,noBodyStyles:x=!1,direction:T="bottom",defaultOpen:I=!1,disablePreventScroll:k=!0,snapToSequentialPoint:A=!1,preventScrollRestoration:O=!1,repositionInputs:D=!0,onAnimationEnd:N,container:U,autoFocus:$=!1}){var K,Y;const[G=!1,F]=$se({defaultProp:I,prop:t,onChange:Je=>{e?.(Je),!Je&&!R&&ui(),setTimeout(()=>{N?.(Je)},ar.DURATION*1e3),Je&&!w&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),Je||(document.body.style.pointerEvents="auto")}}),[q,z]=Ce.useState(!1),[W,V]=Ce.useState(!1),[X,ne]=Ce.useState(!1),fe=Ce.useRef(null),ye=Ce.useRef(null),Ae=Ce.useRef(null),be=Ce.useRef(null),_e=Ce.useRef(null),Ie=Ce.useRef(!1),Ue=Ce.useRef(null),et=Ce.useRef(0),ln=Ce.useRef(!1),Bn=Ce.useRef(!I),Mn=Ce.useRef(0),tt=Ce.useRef(null),Aa=Ce.useRef(((K=tt.current)==null?void 0:K.getBoundingClientRect().height)||0),bl=Ce.useRef(((Y=tt.current)==null?void 0:Y.getBoundingClientRect().width)||0),Dn=Ce.useRef(0),m0=Ce.useCallback(Je=>{s&&Je===Do.length-1&&(ye.current=new Date)},[]),{activeSnapPoint:Hp,activeSnapPointIndex:Pa,setActiveSnapPoint:Is,onRelease:g0,snapPointsOffset:Do,onDrag:v0,shouldFade:Vp,getPercentageDragged:mc}=VOe({snapPoints:s,activeSnapPointProp:g,setActiveSnapPointProp:y,drawerRef:tt,fadeFromIndex:m,overlayRef:fe,onSnapPointChange:m0,direction:T,container:U,snapToSequentialPoint:A});LOe({isDisabled:!G||W||!w||X||!q||!D||!k});const{restorePositionSetting:ui}=KOe({isOpen:G,modal:w,nested:R??!1,hasBeenOpened:q,preventScrollRestoration:O,noBodyStyles:x});function di(){return(window.innerWidth-KP)/window.innerWidth}function xi(Je){var Et,Vt;!d&&!s||tt.current&&!tt.current.contains(Je.target)||(Aa.current=((Et=tt.current)==null?void 0:Et.getBoundingClientRect().height)||0,bl.current=((Vt=tt.current)==null?void 0:Vt.getBoundingClientRect().width)||0,V(!0),Ae.current=new Date,Ose()&&window.addEventListener("touchend",()=>Ie.current=!1,{once:!0}),Je.target.setPointerCapture(Je.pointerId),et.current=jr(T)?Je.pageY:Je.pageX)}function Gf(Je,Et){var Vt;let wt=Je;const Hn=(Vt=window.getSelection())==null?void 0:Vt.toString(),Gr=tt.current?sE(tt.current,T):null,Or=new Date;if(wt.tagName==="SELECT"||wt.hasAttribute("data-vaul-no-drag")||wt.closest("[data-vaul-no-drag]"))return!1;if(T==="right"||T==="left")return!0;if(ye.current&&Or.getTime()-ye.current.getTime()<500)return!1;if(Gr!==null&&(T==="bottom"?Gr>0:Gr<0))return!0;if(Hn&&Hn.length>0)return!1;if(_e.current&&Or.getTime()-_e.current.getTime()<l&&Gr===0||Et)return _e.current=Or,!1;for(;wt;){if(wt.scrollHeight>wt.clientHeight){if(wt.scrollTop!==0)return _e.current=new Date,!1;if(wt.getAttribute("role")==="dialog")return!0}wt=wt.parentNode}return!0}function Ju(Je){if(tt.current&&W){const Et=T==="bottom"||T==="right"?1:-1,Vt=(et.current-(jr(T)?Je.pageY:Je.pageX))*Et,wt=Vt>0,Hn=s&&!d&&!wt;if(Hn&&Pa===0)return;const Gr=Math.abs(Vt),Or=document.querySelector("[data-vaul-drawer-wrapper]"),Kr=T==="bottom"||T==="top"?Aa.current:bl.current;let Ai=Gr/Kr;const qe=mc(Gr,wt);if(qe!==null&&(Ai=qe),Hn&&Ai>=1||!Ie.current&&!Gf(Je.target,wt))return;if(tt.current.classList.add(tx),Ie.current=!0,Qr(tt.current,{transition:"none"}),Qr(fe.current,{transition:"none"}),s&&v0({draggedDistance:Vt}),wt&&!s){const Dt=jOe(Vt),yn=Math.min(Dt*-1,0)*Et;Qr(tt.current,{transform:jr(T)?`translate3d(0, ${yn}px, 0)`:`translate3d(${yn}px, 0, 0)`});return}const Wt=1-Ai;if((Vp||m&&Pa===m-1)&&(r?.(Je,Ai),Qr(fe.current,{opacity:`${Wt}`,transition:"none"},!0)),Or&&fe.current&&o){const Dt=Math.min(di()+Ai*(1-di()),1),yn=8-Ai*8,dr=Math.max(0,14-Ai*14);Qr(Or,{borderRadius:`${yn}px`,transform:jr(T)?`scale(${Dt}) translate3d(0, ${dr}px, 0)`:`scale(${Dt}) translate3d(${dr}px, 0, 0)`,transition:"none"},!0)}if(!s){const Dt=Gr*Et;Qr(tt.current,{transform:jr(T)?`translate3d(0, ${Dt}px, 0)`:`translate3d(${Dt}px, 0, 0)`})}}}Ce.useEffect(()=>{window.requestAnimationFrame(()=>{Bn.current=!0})},[]),Ce.useEffect(()=>{var Je;function Et(){if(!tt.current||!D)return;const Vt=document.activeElement;if(GP(Vt)||ln.current){var wt;const Hn=((wt=window.visualViewport)==null?void 0:wt.height)||0,Gr=window.innerHeight;let Or=Gr-Hn;const Kr=tt.current.getBoundingClientRect().height||0,Ai=Kr>Gr*.8;Dn.current||(Dn.current=Kr);const qe=tt.current.getBoundingClientRect().top;if(Math.abs(Mn.current-Or)>60&&(ln.current=!ln.current),s&&s.length>0&&Do&&Pa){const Wt=Do[Pa]||0;Or+=Wt}if(Mn.current=Or,Kr>Hn||ln.current){const Wt=tt.current.getBoundingClientRect().height;let Dt=Wt;Wt>Hn&&(Dt=Hn-(Ai?qe:KP)),v?tt.current.style.height=`${Wt-Math.max(Or,0)}px`:tt.current.style.height=`${Math.max(Dt,Hn-qe)}px`}else TOe()||(tt.current.style.height=`${Dn.current}px`);s&&s.length>0&&!ln.current?tt.current.style.bottom="0px":tt.current.style.bottom=`${Math.max(Or,0)}px`}}return(Je=window.visualViewport)==null||Je.addEventListener("resize",Et),()=>{var Vt;return(Vt=window.visualViewport)==null?void 0:Vt.removeEventListener("resize",Et)}},[Pa,s,Do]);function gc(Je){_l(),S?.(),Je||F(!1),setTimeout(()=>{s&&Is(s[0])},ar.DURATION*1e3)}function vc(){if(!tt.current)return;const Je=document.querySelector("[data-vaul-drawer-wrapper]"),Et=sE(tt.current,T);Qr(tt.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${ar.DURATION}s cubic-bezier(${ar.EASE.join(",")})`}),Qr(fe.current,{transition:`opacity ${ar.DURATION}s cubic-bezier(${ar.EASE.join(",")})`,opacity:"1"}),o&&Et&&Et>0&&G&&Qr(Je,{borderRadius:`${jse}px`,overflow:"hidden",...jr(T)?{transform:`scale(${di()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${di()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${ar.DURATION}s`,transitionTimingFunction:`cubic-bezier(${ar.EASE.join(",")})`},!0)}function _l(){!W||!tt.current||(tt.current.classList.remove(tx),Ie.current=!1,V(!1),be.current=new Date)}function ks(Je){if(!W||!tt.current)return;tt.current.classList.remove(tx),Ie.current=!1,V(!1),be.current=new Date;const Et=sE(tt.current,T);if(!Je||!Gf(Je.target,!1)||!Et||Number.isNaN(Et)||Ae.current===null)return;const Vt=be.current.getTime()-Ae.current.getTime(),wt=et.current-(jr(T)?Je.pageY:Je.pageX),Hn=Math.abs(wt)/Vt;if(Hn>.05&&(ne(!0),setTimeout(()=>{ne(!1)},200)),s){g0({draggedDistance:wt*(T==="bottom"||T==="right"?1:-1),closeDrawer:gc,velocity:Hn,dismissible:d}),i?.(Je,!0);return}if(T==="bottom"||T==="right"?wt>0:wt<0){vc(),i?.(Je,!0);return}if(Hn>Use){gc(),i?.(Je,!1);return}var Gr;const Or=Math.min((Gr=tt.current.getBoundingClientRect().height)!=null?Gr:0,window.innerHeight);var Kr;const Ai=Math.min((Kr=tt.current.getBoundingClientRect().width)!=null?Kr:0,window.innerWidth),qe=T==="left"||T==="right";if(Math.abs(Et)>=(qe?Ai:Or)*c){gc(),i?.(Je,!1);return}i?.(Je,!0),vc()}Ce.useEffect(()=>(G&&(Qr(document.documentElement,{scrollBehavior:"auto"}),ye.current=new Date),()=>{UOe(document.documentElement,"scrollBehavior")}),[G]);function yc(Je){const Et=Je?(window.innerWidth-vh)/window.innerWidth:1,Vt=Je?-vh:0;Ue.current&&window.clearTimeout(Ue.current),Qr(tt.current,{transition:`transform ${ar.DURATION}s cubic-bezier(${ar.EASE.join(",")})`,transform:jr(T)?`scale(${Et}) translate3d(0, ${Vt}px, 0)`:`scale(${Et}) translate3d(${Vt}px, 0, 0)`}),!Je&&tt.current&&(Ue.current=setTimeout(()=>{const wt=sE(tt.current,T);Qr(tt.current,{transition:"none",transform:jr(T)?`translate3d(0, ${wt}px, 0)`:`translate3d(${wt}px, 0, 0)`})},500))}function Sl(Je,Et){if(Et<0)return;const Vt=(window.innerWidth-vh)/window.innerWidth,wt=Vt+Et*(1-Vt),Hn=-vh+Et*vh;Qr(tt.current,{transform:jr(T)?`scale(${wt}) translate3d(0, ${Hn}px, 0)`:`scale(${wt}) translate3d(${Hn}px, 0, 0)`,transition:"none"})}function y0(Je,Et){const Vt=jr(T)?window.innerHeight:window.innerWidth,wt=Et?(Vt-vh)/Vt:1,Hn=Et?-vh:0;Et&&Qr(tt.current,{transition:`transform ${ar.DURATION}s cubic-bezier(${ar.EASE.join(",")})`,transform:jr(T)?`scale(${wt}) translate3d(0, ${Hn}px, 0)`:`scale(${wt}) translate3d(${Hn}px, 0, 0)`})}return Ce.useEffect(()=>{w||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[w]),Ce.createElement(MM,{defaultOpen:I,onOpenChange:Je=>{!d&&!Je||(Je?z(!0):gc(!0),F(Je))},open:G},Ce.createElement(Lse.Provider,{value:{activeSnapPoint:Hp,snapPoints:s,setActiveSnapPoint:Is,drawerRef:tt,overlayRef:fe,onOpenChange:e,onPress:xi,onRelease:ks,onDrag:Ju,dismissible:d,shouldAnimate:Bn,handleOnly:h,isOpen:G,isDragging:W,shouldFade:Vp,closeDrawer:gc,onNestedDrag:Sl,onNestedOpenChange:yc,onNestedRelease:y0,keyboardIsOpen:ln,modal:w,snapPointsOffset:Do,activeSnapPointIndex:Pa,direction:T,shouldScaleBackground:o,setBackgroundColorOnScale:a,noBodyStyles:x,container:U,autoFocus:$}},n))}const Bse=Ce.forwardRef(function({...t},e){const{overlayRef:n,snapPoints:r,onRelease:i,shouldFade:s,isOpen:o,modal:a,shouldAnimate:c}=O_(),l=Dse(e,n),d=r&&r.length>0;if(!a)return null;const h=Ce.useCallback(m=>i(m),[i]);return Ce.createElement(NM,{onMouseUp:h,ref:l,"data-vaul-overlay":"","data-vaul-snap-points":o&&d?"true":"false","data-vaul-snap-points-overlay":o&&s?"true":"false","data-vaul-animate":c?.current?"true":"false",...t})});Bse.displayName="Drawer.Overlay";const Hse=Ce.forwardRef(function({onPointerDownOutside:t,style:e,onOpenAutoFocus:n,...r},i){const{drawerRef:s,onPress:o,onRelease:a,onDrag:c,keyboardIsOpen:l,snapPointsOffset:d,activeSnapPointIndex:h,modal:m,isOpen:g,direction:y,snapPoints:v,container:w,handleOnly:S,shouldAnimate:R,autoFocus:x}=O_(),[T,I]=Ce.useState(!1),k=Dse(i,s),A=Ce.useRef(null),O=Ce.useRef(null),D=Ce.useRef(!1),N=v&&v.length>0;GOe();const U=(K,Y,G=0)=>{if(D.current)return!0;const F=Math.abs(K.y),q=Math.abs(K.x),z=q>F,W=["bottom","right"].includes(Y)?1:-1;if(Y==="left"||Y==="right"){if(!(K.x*W<0)&&q>=0&&q<=G)return z}else if(!(K.y*W<0)&&F>=0&&F<=G)return!z;return D.current=!0,!0};Ce.useEffect(()=>{N&&window.requestAnimationFrame(()=>{I(!0)})},[]);function $(K){A.current=null,D.current=!1,a(K)}return Ce.createElement(UM,{"data-vaul-drawer-direction":y,"data-vaul-drawer":"","data-vaul-delayed-snap-points":T?"true":"false","data-vaul-snap-points":g&&N?"true":"false","data-vaul-custom-container":w?"true":"false","data-vaul-animate":R?.current?"true":"false",...r,ref:k,style:d&&d.length>0?{"--snap-point-height":`${d[h??0]}px`,...e}:e,onPointerDown:K=>{S||(r.onPointerDown==null||r.onPointerDown.call(r,K),A.current={x:K.pageX,y:K.pageY},o(K))},onOpenAutoFocus:K=>{n?.(K),x||K.preventDefault()},onPointerDownOutside:K=>{if(t?.(K),!m||K.defaultPrevented){K.preventDefault();return}l.current&&(l.current=!1)},onFocusOutside:K=>{if(!m){K.preventDefault();return}},onPointerMove:K=>{if(O.current=K,S||(r.onPointerMove==null||r.onPointerMove.call(r,K),!A.current))return;const Y=K.pageY-A.current.y,G=K.pageX-A.current.x,F=K.pointerType==="touch"?10:2;U({x:G,y:Y},y,F)?c(K):(Math.abs(G)>F||Math.abs(Y)>F)&&(A.current=null)},onPointerUp:K=>{r.onPointerUp==null||r.onPointerUp.call(r,K),A.current=null,D.current=!1,a(K)},onPointerOut:K=>{r.onPointerOut==null||r.onPointerOut.call(r,K),$(O.current)},onContextMenu:K=>{r.onContextMenu==null||r.onContextMenu.call(r,K),O.current&&$(O.current)}})});Hse.displayName="Drawer.Content";const WOe=250,YOe=120,XOe=Ce.forwardRef(function({preventCycle:t=!1,children:e,...n},r){const{closeDrawer:i,isDragging:s,snapPoints:o,activeSnapPoint:a,setActiveSnapPoint:c,dismissible:l,handleOnly:d,isOpen:h,onPress:m,onDrag:g}=O_(),y=Ce.useRef(null),v=Ce.useRef(!1);function w(){if(v.current){x();return}window.setTimeout(()=>{S()},YOe)}function S(){if(s||t||v.current){x();return}if(x(),!o||o.length===0){l||i();return}if(a===o[o.length-1]&&l){i();return}const I=o.findIndex(A=>A===a);if(I===-1)return;const k=o[I+1];c(k)}function R(){y.current=window.setTimeout(()=>{v.current=!0},WOe)}function x(){y.current&&window.clearTimeout(y.current),v.current=!1}return Ce.createElement("div",{onClick:w,onPointerCancel:x,onPointerDown:T=>{d&&m(T),R()},onPointerMove:T=>{d&&g(T)},ref:r,"data-vaul-drawer-visible":h?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},Ce.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},e))});XOe.displayName="Drawer.Handle";function JOe(t){const e=O_(),{container:n=e.container,...r}=t;return Ce.createElement(DM,{container:n,...r})}const Hs={Root:zOe,Content:Hse,Overlay:Bse,Trigger:wOe,Portal:JOe,Title:jM},QOe="_bg_1y38p_8",ZOe="_drawer_1y38p_17",e7e="_body_1y38p_51",YC={bg:QOe,drawer:ZOe,body:e7e},t7e="_content_vnv5k_8",n7e={content:t7e},$M=_.createContext(null);function BM(){const t=globalThis.navigator?.userAgent;return/android/i.test(t)?"android":/iPad|iPhone|iPod|Mac/.test(t)&&"ontouchend"in document?"ios":"other"}const HM=_.forwardRef(({title:t,children:e,className:n,...r},i)=>E.jsx("div",{ref:i,className:Oe(n,YC.drawer),"aria-label":t,"data-platform":BM(),...r,role:"menu",children:E.jsx("div",{className:YC.body,children:e})}));HM.displayName="DrawerMenu";const r7e=({onSelect:t,children:e})=>E.jsx(ise,{onSelect:t??void 0,asChild:!0,children:e}),i7e=({title:t,showTitle:e=!0,onOpenChange:n,trigger:r,hasAccessibleAlternative:i,children:s})=>{const[o,a]=_.useState(!1),c=_.useCallback(y=>{a(y),n?.(y)},[a,n]),l=BM(),d=l==="android"||l==="ios",h=_.useMemo(()=>({MenuItemWrapper:d?null:r7e,onOpenChange:c}),[c]),m=E.jsx($M.Provider,{value:h,children:s}),g=E.jsx(tLe,{"aria-haspopup":"menu",tabIndex:i?void 0:0,asChild:!0,children:r});return d?E.jsxs(E.Fragment,{children:[E.jsx(Iq,{onOpenChange:c,children:g}),E.jsx(Hs.Root,{open:o,onOpenChange:c,children:E.jsxs(Hs.Portal,{children:[E.jsx(Hs.Overlay,{className:Oe(YC.bg)}),E.jsx(Hs.Content,{asChild:!0,children:E.jsx(HM,{title:t,children:m})})]})})]}):E.jsxs(Iq,{onOpenChange:c,children:[g,E.jsx(nLe,{children:E.jsx(rLe,{asChild:!0,className:Oe(n7e.content),children:E.jsx(xM,{showTitle:e,title:t,children:m})})})]})},s7e="_glass_sepwu_8",o7e={glass:s7e},Vse=_.forwardRef(({children:t,className:e,...n},r)=>E.jsx("div",{ref:r,className:Oe(e,o7e.glass),...n,children:_.Children.only(t)}));Vse.displayName="Glass";const gl=({as:t="h1",children:e,...n})=>E.jsx(Cne,{as:t,type:"heading",...n,children:e}),a7e="_link_1v5rz_8",c7e={link:a7e},l7e=_.forwardRef(function({children:e,className:n,kind:r="primary",size:i="medium",...s},o){return E.jsx("a",{ref:o,...s,rel:"noreferrer noopener",className:Oe(c7e.link,n),"data-kind":r,"data-size":i,children:e})});var VM="DropdownMenu",[u7e,Gat]=xp(VM,[VT]),Cs=VT(),[d7e,qse]=u7e(VM),Gse=t=>{const{__scopeDropdownMenu:e,children:n,dir:r,open:i,defaultOpen:s,onOpenChange:o,modal:a=!0}=t,c=Cs(e),l=_.useRef(null),[d=!1,h]=xre({prop:i,defaultProp:s,onChange:o});return E.jsx(d7e,{scope:e,triggerId:vv(),triggerRef:l,contentId:vv(),open:d,onOpenChange:h,onOpenToggle:_.useCallback(()=>h(m=>!m),[h]),modal:a,children:E.jsx(Nie,{...c,open:d,onOpenChange:h,dir:r,modal:a,children:n})})};Gse.displayName=VM;var Kse="DropdownMenuTrigger",zse=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...i}=t,s=qse(Kse,n),o=Cs(n);return E.jsx(Uie,{asChild:!0,...o,children:E.jsx(Pr.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:jT(e,s.triggerRef),onPointerDown:St(t.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(s.onOpenToggle(),s.open||a.preventDefault())}),onKeyDown:St(t.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&s.onOpenToggle(),a.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});zse.displayName=Kse;var f7e="DropdownMenuPortal",Wse=t=>{const{__scopeDropdownMenu:e,...n}=t,r=Cs(e);return E.jsx(jie,{...r,...n})};Wse.displayName=f7e;var Yse="DropdownMenuContent",Xse=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=qse(Yse,n),s=Cs(n),o=_.useRef(!1);return E.jsx(Fie,{id:i.contentId,"aria-labelledby":i.triggerId,...s,...r,ref:e,onCloseAutoFocus:St(t.onCloseAutoFocus,a=>{o.current||i.triggerRef.current?.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:St(t.onInteractOutside,a=>{const c=a.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0,d=c.button===2||l;(!i.modal||d)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Xse.displayName=Yse;var h7e="DropdownMenuGroup",p7e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return E.jsx($ie,{...i,...r,ref:e})});p7e.displayName=h7e;var m7e="DropdownMenuLabel",g7e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return E.jsx(Bie,{...i,...r,ref:e})});g7e.displayName=m7e;var v7e="DropdownMenuItem",Jse=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return E.jsx(Hie,{...i,...r,ref:e})});Jse.displayName=v7e;var y7e="DropdownMenuCheckboxItem",b7e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return E.jsx(Vie,{...i,...r,ref:e})});b7e.displayName=y7e;var _7e="DropdownMenuRadioGroup",S7e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return E.jsx(qie,{...i,...r,ref:e})});S7e.displayName=_7e;var E7e="DropdownMenuRadioItem",w7e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return E.jsx(Gie,{...i,...r,ref:e})});w7e.displayName=E7e;var C7e="DropdownMenuItemIndicator",T7e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return E.jsx(Kie,{...i,...r,ref:e})});T7e.displayName=C7e;var R7e="DropdownMenuSeparator",I7e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return E.jsx(zie,{...i,...r,ref:e})});I7e.displayName=R7e;var k7e="DropdownMenuArrow",x7e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return E.jsx(Wie,{...i,...r,ref:e})});x7e.displayName=k7e;var A7e="DropdownMenuSubTrigger",P7e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return E.jsx(Yie,{...i,...r,ref:e})});P7e.displayName=A7e;var L7e="DropdownMenuSubContent",O7e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return E.jsx(Xie,{...i,...r,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});O7e.displayName=L7e;var M7e=Gse,D7e=zse,N7e=Wse,U7e=Xse;const j7e=({onSelect:t,children:e})=>E.jsx(Jse,{onSelect:t??void 0,asChild:!0,children:e}),qM=({title:t,showTitle:e=!0,open:n,onOpenChange:r,trigger:i,children:s,side:o="bottom",align:a="center"})=>{const c=BM(),l=c==="android"||c==="ios",d=_.useMemo(()=>({MenuItemWrapper:l?null:j7e,onOpenChange:r}),[r]),h=E.jsx($M.Provider,{value:d,children:s});return l?E.jsxs(Hs.Root,{open:n,onOpenChange:r,children:[E.jsx(Hs.Trigger,{asChild:!0,children:i}),E.jsxs(Hs.Portal,{children:[E.jsx(Hs.Overlay,{className:Oe(YC.bg)}),E.jsx(Hs.Content,{asChild:!0,children:E.jsx(HM,{title:t,children:h})})]})]}):E.jsxs(M7e,{open:n,onOpenChange:r,children:[E.jsx(D7e,{asChild:!0,children:i}),E.jsx(N7e,{children:E.jsx(U7e,{asChild:!0,side:o,align:a,sideOffset:8,children:E.jsx(xM,{title:t,showTitle:e,children:h})})})]})},F7e="_item_dyt4i_8",$7e="_interactive_dyt4i_26",B7e="_label_dyt4i_34",H7e="_icon_dyt4i_50",V7e="_disabled_dyt4i_118",Ul={item:F7e,interactive:$7e,"no-label":"_no-label_dyt4i_30",label:B7e,"no-icon":"_no-icon_dyt4i_41",icon:H7e,"nav-hint":"_nav-hint_dyt4i_59",disabled:V7e};function Qse(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M8.7 17.3a.95.95 0 0 1-.275-.7q0-.425.275-.7l3.9-3.9-3.9-3.9a.95.95 0 0 1-.275-.7q0-.425.275-.7a.95.95 0 0 1 .7-.275q.425 0 .7.275l4.6 4.6q.15.15.213.325.062.175.062.375t-.062.375a.9.9 0 0 1-.213.325l-4.6 4.6a.95.95 0 0 1-.7.275.95.95 0 0 1-.7-.275"})})}Qse.displayName="ChevronRightIcon";const Zse=_.forwardRef(Qse),yv=({as:t,className:e,Icon:n,label:r,labelProps:i,onSelect:s,kind:o="primary",children:a,onClick:c,disabled:l,hideChevron:d,...h})=>{const m=t??"button",g=_.useContext($M),y=_.useCallback(x=>{if(c?.(x),s!==null&&g?.MenuItemWrapper==null){const T=new CustomEvent("menu.itemSelect",{bubbles:!0,cancelable:!0});s(T),T.defaultPrevented||g?.onOpenChange(!1)}},[g,s]),v=_.isValidElement(n),w=n,S=n,R=E.jsxs(m,{role:"menuitem",...h,className:Oe(e,Ul.item,{[Ul.interactive]:s!==null,[Ul["no-label"]]:r===null,[Ul["no-icon"]]:!n,[Ul.disabled]:l}),"data-kind":o,onClick:y,disabled:m==="button"?l:void 0,"aria-disabled":m==="button"?void 0:l,children:[n&&(v?E.jsx(gv,{className:Ul.icon,children:w}):E.jsx(S,{width:24,height:24,className:Ul.icon,"aria-hidden":!0})),r!==null&&E.jsx(an,{className:Ul.label,size:"md",weight:"medium",as:"span",...i,children:r}),!d&&(m==="button"||m==="a")&&E.jsx(Zse,{width:8,height:24,className:Ul["nav-hint"],"aria-hidden":!0,viewBox:"8 0 8 24"}),a]});return g?.MenuItemWrapper==null||s===null?R:E.jsx(g.MenuItemWrapper,{onSelect:s,children:R})};var q7e="Label",eoe=_.forwardRef((t,e)=>E.jsx(Pr.label,{...t,ref:e,onMouseDown:n=>{n.target.closest("button, input, select, textarea")||(t.onMouseDown?.(n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));eoe.displayName=q7e;var[GM,Kat]=xp("Form"),KM="Form",[G7e,M_]=GM(KM),[K7e,toe]=GM(KM),noe=_.forwardRef((t,e)=>{const{__scopeForm:n,onClearServerErrors:r=()=>{},...i}=t,s=_.useRef(null),o=bs(e,s),[a,c]=_.useState({}),l=_.useCallback(N=>a[N],[a]),d=_.useCallback((N,U)=>c($=>({...$,[N]:{...$[N]??{},...U}})),[]),h=_.useCallback(N=>{c(U=>({...U,[N]:void 0})),R(U=>({...U,[N]:{}}))},[]),[m,g]=_.useState({}),y=_.useCallback(N=>m[N]??[],[m]),v=_.useCallback((N,U)=>{g($=>({...$,[N]:[...$[N]??[],U]}))},[]),w=_.useCallback((N,U)=>{g($=>({...$,[N]:($[N]??[]).filter(K=>K.id!==U)}))},[]),[S,R]=_.useState({}),x=_.useCallback(N=>S[N]??{},[S]),T=_.useCallback((N,U)=>{R($=>({...$,[N]:{...$[N]??{},...U}}))},[]),[I,k]=_.useState({}),A=_.useCallback((N,U)=>{k($=>{const K=new Set($[N]).add(U);return{...$,[N]:K}})},[]),O=_.useCallback((N,U)=>{k($=>{const K=new Set($[N]);return K.delete(U),{...$,[N]:K}})},[]),D=_.useCallback(N=>Array.from(I[N]??[]).join(" ")||void 0,[I]);return E.jsx(G7e,{scope:n,getFieldValidity:l,onFieldValidityChange:d,getFieldCustomMatcherEntries:y,onFieldCustomMatcherEntryAdd:v,onFieldCustomMatcherEntryRemove:w,getFieldCustomErrors:x,onFieldCustomErrorsChange:T,onFieldValiditionClear:h,children:E.jsx(K7e,{scope:n,onFieldMessageIdAdd:A,onFieldMessageIdRemove:O,getFieldDescription:D,children:E.jsx(Pr.form,{...i,ref:o,onInvalid:St(t.onInvalid,N=>{const U=ooe(N.currentTarget);U===N.target&&U.focus(),N.preventDefault()}),onSubmit:St(t.onSubmit,r,{checkForDefaultPrevented:!1}),onReset:St(t.onReset,r)})})})});noe.displayName=KM;var zM="FormField",[z7e,WM]=GM(zM),roe=_.forwardRef((t,e)=>{const{__scopeForm:n,name:r,serverInvalid:i=!1,...s}=t,a=M_(zM,n).getFieldValidity(r),c=vv();return E.jsx(z7e,{scope:n,id:c,name:r,serverInvalid:i,children:E.jsx(Pr.div,{"data-valid":XM(a,i),"data-invalid":JM(a,i),...s,ref:e})})});roe.displayName=zM;var zP="FormLabel",ioe=_.forwardRef((t,e)=>{const{__scopeForm:n,...r}=t,i=M_(zP,n),s=WM(zP,n),o=r.htmlFor||s.id,a=i.getFieldValidity(s.name);return E.jsx(eoe,{"data-valid":XM(a,s.serverInvalid),"data-invalid":JM(a,s.serverInvalid),...r,ref:e,htmlFor:o})});ioe.displayName=zP;var xw="FormControl",soe=_.forwardRef((t,e)=>{const{__scopeForm:n,...r}=t,i=M_(xw,n),s=WM(xw,n),o=toe(xw,n),a=_.useRef(null),c=bs(e,a),l=r.name||s.name,d=r.id||s.id,h=i.getFieldCustomMatcherEntries(l),{onFieldValidityChange:m,onFieldCustomErrorsChange:g,onFieldValiditionClear:y}=i,v=_.useCallback(async R=>{if(aoe(R.validity)){const $=nx(R.validity);m(l,$);return}const x=R.form?new FormData(R.form):new FormData,T=[R.value,x],I=[],k=[];h.forEach($=>{rMe($,T)?k.push($):iMe($)&&I.push($)});const A=I.map(({id:$,match:K})=>[$,K(...T)]),O=Object.fromEntries(A),D=Object.values(O).some(Boolean),N=D;R.setCustomValidity(N?Pb:"");const U=nx(R.validity);if(m(l,U),g(l,O),!D&&k.length>0){const $=k.map(({id:z,match:W})=>W(...T).then(V=>[z,V])),K=await Promise.all($),Y=Object.fromEntries(K),F=Object.values(Y).some(Boolean);R.setCustomValidity(F?Pb:"");const q=nx(R.validity);m(l,q),g(l,Y)}},[h,l,g,m]);_.useEffect(()=>{const R=a.current;if(R){const x=()=>v(R);return R.addEventListener("change",x),()=>R.removeEventListener("change",x)}},[v]);const w=_.useCallback(()=>{const R=a.current;R&&(R.setCustomValidity(""),y(l))},[l,y]);_.useEffect(()=>{const R=a.current?.form;if(R)return R.addEventListener("reset",w),()=>R.removeEventListener("reset",w)},[w]),_.useEffect(()=>{const R=a.current,x=R?.closest("form");if(x&&s.serverInvalid){const T=ooe(x);T===R&&T.focus()}},[s.serverInvalid]);const S=i.getFieldValidity(l);return E.jsx(Pr.input,{"data-valid":XM(S,s.serverInvalid),"data-invalid":JM(S,s.serverInvalid),"aria-invalid":s.serverInvalid?!0:void 0,"aria-describedby":o.getFieldDescription(l),title:"",...r,ref:c,id:d,name:l,onInvalid:St(t.onInvalid,R=>{const x=R.currentTarget;v(x)}),onChange:St(t.onChange,R=>{w()})})});soe.displayName=xw;var Pb="This value is not valid",W7e={badInput:Pb,patternMismatch:"This value does not match the required pattern",rangeOverflow:"This value is too large",rangeUnderflow:"This value is too small",stepMismatch:"This value does not match the required step",tooLong:"This value is too long",tooShort:"This value is too short",typeMismatch:"This value does not match the required type",valid:void 0,valueMissing:"This value is missing"},D_="FormMessage",Y7e=_.forwardRef((t,e)=>{const{match:n,name:r,...i}=t,s=WM(D_,t.__scopeForm),o=r??s.name;return n===void 0?E.jsx(YM,{...i,ref:e,name:o,children:t.children||Pb}):typeof n=="function"?E.jsx(J7e,{match:n,...i,ref:e,name:o}):E.jsx(X7e,{match:n,...i,ref:e,name:o})});Y7e.displayName=D_;var X7e=_.forwardRef((t,e)=>{const{match:n,forceMatch:r=!1,name:i,children:s,...o}=t,c=M_(D_,o.__scopeForm).getFieldValidity(i);return r||c?.[n]?E.jsx(YM,{ref:e,...o,name:i,children:s??W7e[n]}):null}),J7e=_.forwardRef((t,e)=>{const{match:n,forceMatch:r=!1,name:i,id:s,children:o,...a}=t,c=M_(D_,a.__scopeForm),l=_.useRef(null),d=bs(e,l),h=vv(),m=s??h,g=_.useMemo(()=>({id:m,match:n}),[m,n]),{onFieldCustomMatcherEntryAdd:y,onFieldCustomMatcherEntryRemove:v}=c;_.useEffect(()=>(y(i,g),()=>v(i,g.id)),[g,i,y,v]);const w=c.getFieldValidity(i),R=c.getFieldCustomErrors(i)[m];return r||w&&!aoe(w)&&R?E.jsx(YM,{id:m,ref:d,...a,name:i,children:o??Pb}):null}),YM=_.forwardRef((t,e)=>{const{__scopeForm:n,id:r,name:i,...s}=t,o=toe(D_,n),a=vv(),c=r??a,{onFieldMessageIdAdd:l,onFieldMessageIdRemove:d}=o;return _.useEffect(()=>(l(i,c),()=>d(i,c)),[i,c,l,d]),E.jsx(Pr.span,{id:c,...s,ref:e})}),Q7e="FormSubmit",Z7e=_.forwardRef((t,e)=>{const{__scopeForm:n,...r}=t;return E.jsx(Pr.button,{type:"submit",...r,ref:e})});Z7e.displayName=Q7e;function nx(t){const e={};for(const n in t)e[n]=t[n];return e}function eMe(t){return t instanceof HTMLElement}function tMe(t){return"validity"in t}function nMe(t){return tMe(t)&&(t.validity.valid===!1||t.getAttribute("aria-invalid")==="true")}function ooe(t){const e=t.elements,[n]=Array.from(e).filter(eMe).filter(nMe);return n}function rMe(t,e){return t.match.constructor.name==="AsyncFunction"||sMe(t.match,e)}function iMe(t){return t.match.constructor.name==="Function"}function sMe(t,e){return t(...e)instanceof Promise}function aoe(t){let e=!1;for(const n in t){const r=n;if(r!=="valid"&&r!=="customError"&&t[r]){e=!0;break}}return e}function XM(t,e){if(t?.valid===!0&&!e)return!0}function JM(t,e){if(t?.valid===!1||e)return!0}var oMe=noe,aMe=roe,cMe=ioe,coe=soe;const lMe="_container_1e0uz_10",uMe="_input_1e0uz_18",dMe="_ui_1e0uz_19",rx={container:lMe,input:uMe,ui:dMe},fMe=_.forwardRef(function({className:e,...n},r){const i=Oe(rx.container,e);return E.jsxs("div",{className:i,children:[E.jsx("input",{ref:r,...n,className:rx.input,type:"radio"}),E.jsx("div",{className:rx.ui})]})}),hMe=_.forwardRef(function(e,n){return E.jsx(coe,{asChild:!0,children:E.jsx(fMe,{ref:n,...e})})}),pMe="_root_19upo_16",mMe="_label_19upo_59",By={root:pMe,"inline-field":"_inline-field_19upo_32","inline-field-body":"_inline-field-body_19upo_38","inline-field-control":"_inline-field-control_19upo_44",label:mMe},gMe=_.forwardRef(function({children:e,...n},r){const i=Oe(By.label,n.className);return E.jsx(cMe,{ref:r,...n,className:i,children:e})});var vMe="Separator",Gq="horizontal",yMe=["horizontal","vertical"],loe=_.forwardRef((t,e)=>{const{decorative:n,orientation:r=Gq,...i}=t,s=bMe(r)?r:Gq,a=n?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return E.jsx(Pr.div,{"data-orientation":s,...a,...i,ref:e})});loe.displayName=vMe;function bMe(t){return yMe.includes(t)}var _Me=loe;const SMe="_separator_7ckbw_8",EMe={separator:SMe},Kq="--cpd-separator-spacing",QM=_.forwardRef(({className:t,spacing:e,kind:n="primary",...r},i)=>{const s=Oe(EMe.separator,t),o=_.useRef(null),a=Jne([o,i]);return _.useEffect(()=>{const c=o.current?.style;e?c?.setProperty(Kq,e):c?.removeProperty(Kq)},[e]),E.jsx(_Me,{...r,className:s,ref:a,"data-kind":n})});QM.displayName="Separator";const wMe="_container_19o42_10",CMe="_input_19o42_24",TMe="_ui_19o42_34",ix={container:wMe,input:CMe,ui:TMe},uoe=_.forwardRef(function({className:e,...n},r){const i=Oe(ix.container,e);return E.jsxs("div",{className:i,children:[E.jsx("input",{role:"switch",ref:r,className:ix.input,...n,type:"checkbox"}),E.jsx("div",{className:ix.ui})]})});_.forwardRef(function(e,n){return E.jsx(coe,{asChild:!0,children:E.jsx(uoe,{ref:n,...e})})});const ZM=_.forwardRef(function({className:e,Icon:n,label:r,onSelect:i,checked:s,disabled:o,onClick:a},c){const l=_.useId(),d=_.useCallback(()=>{},[]);return E.jsx(yv,{as:"div",role:"menuitemcheckbox","aria-checked":s,className:e,Icon:n,label:r,onSelect:i,disabled:o,onClick:a,children:E.jsx(uoe,{id:l,ref:c,"aria-hidden":!0,checked:s,disabled:o,onChange:d})})});function doe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M9.55 17.575q-.2 0-.375-.062a.9.9 0 0 1-.325-.213L4.55 13q-.274-.274-.262-.713.012-.437.287-.712a.95.95 0 0 1 .7-.275q.425 0 .7.275L9.55 15.15l8.475-8.475q.274-.275.713-.275.437 0 .712.275.275.274.275.713 0 .437-.275.712l-9.2 9.2q-.15.15-.325.212a1.1 1.1 0 0 1-.375.063"})})}doe.displayName="CheckIcon";const foe=_.forwardRef(doe),zq=_.forwardRef(function({children:e,...n},r){const i=Oe(By.root,n.className);return E.jsx(oMe,{ref:r,...n,className:i,children:e})}),RMe=_.forwardRef(function({className:e,control:n,children:r,...i},s){const o=Oe(By["inline-field"],e);return E.jsxs(aMe,{ref:s,...i,className:o,children:[E.jsx("div",{className:By["inline-field-control"],children:n}),E.jsx("div",{className:By["inline-field-body"],children:r})]})}),IMe="_icon_11k6c_18",kMe={icon:IMe};function hoe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{fillRule:"evenodd",d:"M12 4.031a8 8 0 1 0 8 8 1 1 0 0 1 2 0c0 5.523-4.477 10-10 10s-10-4.477-10-10 4.477-10 10-10a1 1 0 1 1 0 2",clipRule:"evenodd"})})}hoe.displayName="SpinnerIcon";const xMe=_.forwardRef(hoe),AMe=_.forwardRef(function({size:e=20,...n},r){return E.jsx(xMe,{ref:r,className:kMe.icon,style:{width:e,height:e},...n})}),PMe="_button_vczzf_8",LMe="_destructive_vczzf_107",U1={button:PMe,"icon-only":"_icon-only_vczzf_50","has-icon":"_has-icon_vczzf_57",destructive:LMe},Bt=_.forwardRef(function({as:e,kind:n="primary",size:r="lg",children:i,className:s,iconOnly:o,Icon:a,destructive:c,disabled:l,...d},h){const[m,g]=n==="destructive"?["secondary",!0]:[n,c],y=Oe(U1.button,s,{[U1["has-icon"]]:a,[U1["icon-only"]]:o,[U1.destructive]:g}),v=o&&r==="lg"?24:20;return E.jsxs(Tne,{...d,as:e||"button",ref:h,className:y,"data-size":r,"data-kind":m,tabIndex:0,disabled:l,children:[a&&E.jsx(a,{width:v,height:v,className:U1.icon,"aria-hidden":!0}),i]})});function poe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12 16q1.875 0 3.188-1.312Q16.5 13.375 16.5 11.5t-1.312-3.187T12 7 8.813 8.313 7.5 11.5t1.313 3.188T12 16m0-1.8q-1.125 0-1.912-.787A2.6 2.6 0 0 1 9.3 11.5q0-1.125.787-1.912A2.6 2.6 0 0 1 12 8.8q1.125 0 1.912.787.788.788.788 1.913t-.787 1.912A2.6 2.6 0 0 1 12 14.2m0 4.8q-3.475 0-6.35-1.837Q2.775 15.324 1.3 12.2a.8.8 0 0 1-.1-.312 3 3 0 0 1 0-.775.8.8 0 0 1 .1-.313q1.475-3.125 4.35-4.962Q8.525 4 12 4t6.35 1.838T22.7 10.8a.8.8 0 0 1 .1.313 3 3 0 0 1 0 .774.8.8 0 0 1-.1.313q-1.475 3.125-4.35 4.963Q15.475 19 12 19m0-2a9.54 9.54 0 0 0 5.188-1.488A9.77 9.77 0 0 0 20.8 11.5a9.77 9.77 0 0 0-3.613-4.012A9.54 9.54 0 0 0 12 6a9.55 9.55 0 0 0-5.187 1.487A9.77 9.77 0 0 0 3.2 11.5a9.77 9.77 0 0 0 3.613 4.012A9.54 9.54 0 0 0 12 17"})})}poe.displayName="VisibilityOnIcon";const OMe=_.forwardRef(poe),MMe="_content_o77nw_8",DMe="_destructive_o77nw_34",NMe="_success_o77nw_39",sx={content:MMe,destructive:DMe,success:NMe};function moe({className:t,size:e="large",destructive:n=!1,success:r=!1,children:i}){return E.jsx("div",{className:Oe(sx.content,t,{[sx.destructive]:n,[sx.success]:r}),"data-size":e,children:Ce.Children.only(i)})}const Lb={"nav-bar":"_nav-bar_1fp3r_8","nav-bar-items":"_nav-bar-items_1fp3r_14","nav-tab":"_nav-tab_1fp3r_25","nav-item":"_nav-item_1fp3r_47"},UMe=({children:t,className:e,role:n,"aria-label":r,...i})=>{const s=Oe(e,Lb["nav-bar"]),o=n!=="tablist"?{role:"navigation","aria-label":r}:{role:"presentation"},a=n==="tablist"?{role:"tablist","aria-label":r}:{};return E.jsx("nav",{...o,...i,className:s,children:E.jsx("ul",{...a,className:Lb["nav-bar-items"],children:t})})},jMe=_.forwardRef(function({children:e,href:n,onClick:r,...i},s){return E.jsx("a",{href:n,onClick:r,className:Lb["nav-item"],...i,ref:s,children:e})}),FMe=_.forwardRef(function({children:e,disabled:n,onClick:r,...i},s){return E.jsx("button",{onClick:r,className:Lb["nav-item"],disabled:n,ref:s,...i,children:e})}),$Me=t=>"href"in t&&!!t.href,BMe=_.forwardRef(function(e,n){const r=e["aria-controls"],s=!!r?{"aria-controls":r,role:"tab","aria-selected":e.active}:{"aria-current":e.active?!0:void 0},o={...e};delete o.active;let a;if($Me(o)){const c=n;a=E.jsx(jMe,{...o,...s,ref:c})}else{const c=n;a=E.jsx(FMe,{...o,...s,ref:c})}return E.jsx("li",{className:Lb["nav-tab"],"data-current":e.active?!0:void 0,role:"presentation",children:a})});function goe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12 14.95q-.2 0-.375-.062a.9.9 0 0 1-.325-.213l-4.6-4.6a.95.95 0 0 1-.275-.7q0-.425.275-.7a.95.95 0 0 1 .7-.275q.425 0 .7.275l3.9 3.9 3.9-3.9a.95.95 0 0 1 .7-.275q.425 0 .7.275a.95.95 0 0 1 .275.7.95.95 0 0 1-.275.7l-4.6 4.6q-.15.15-.325.212a1.1 1.1 0 0 1-.375.063"})})}goe.displayName="ChevronDownIcon";const HMe=_.forwardRef(goe);function voe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"m13.3 17.3-4.6-4.6a.9.9 0 0 1-.213-.325A1.1 1.1 0 0 1 8.425 12q0-.2.062-.375A.9.9 0 0 1 8.7 11.3l4.6-4.6a.95.95 0 0 1 .7-.275q.425 0 .7.275a.95.95 0 0 1 .275.7.95.95 0 0 1-.275.7L10.8 12l3.9 3.9a.95.95 0 0 1 .275.7.95.95 0 0 1-.275.7.95.95 0 0 1-.7.275.95.95 0 0 1-.7-.275"})})}voe.displayName="ChevronLeftIcon";const VMe=_.forwardRef(voe);var ox,Wq;function qMe(){return Wq||(Wq=1,ox={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ox}var GMe=qMe();const KMe=cl(GMe);var zMe=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function Yq(t){var e={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=t.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(e.name=n[1],(KMe[n[1]]||t.charAt(t.length-2)==="/")&&(e.voidElement=!0),e.name.startsWith("!--"))){var r=t.indexOf("-->");return{type:"comment",comment:r!==-1?t.slice(4,r):""}}for(var i=new RegExp(zMe),s=null;(s=i.exec(t))!==null;)if(s[0].trim())if(s[1]){var o=s[1].trim(),a=[o,""];o.indexOf("=")>-1&&(a=o.split("=")),e.attrs[a[0]]=a[1],i.lastIndex--}else s[2]&&(e.attrs[s[2]]=s[3].trim().substring(1,s[3].length-1));return e}var WMe=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,YMe=/^\s*$/,XMe=Object.create(null);function yoe(t,e){switch(e.type){case"text":return t+e.content;case"tag":return t+="<"+e.name+(e.attrs?function(n){var r=[];for(var i in n)r.push(i+'="'+n[i]+'"');return r.length?" "+r.join(" "):""}(e.attrs):"")+(e.voidElement?"/>":">"),e.voidElement?t:t+e.children.reduce(yoe,"")+"</"+e.name+">";case"comment":return t+"<!--"+e.comment+"-->"}}var JMe={parse:function(t,e){e||(e={}),e.components||(e.components=XMe);var n,r=[],i=[],s=-1,o=!1;if(t.indexOf("<")!==0){var a=t.indexOf("<");r.push({type:"text",content:a===-1?t:t.substring(0,a)})}return t.replace(WMe,function(c,l){if(o){if(c!=="</"+n.name+">")return;o=!1}var d,h=c.charAt(1)!=="/",m=c.startsWith("<!--"),g=l+c.length,y=t.charAt(g);if(m){var v=Yq(c);return s<0?(r.push(v),r):((d=i[s]).children.push(v),r)}if(h&&(s++,(n=Yq(c)).type==="tag"&&e.components[n.name]&&(n.type="component",o=!0),n.voidElement||o||!y||y==="<"||n.children.push({type:"text",content:t.slice(g,t.indexOf("<",g))}),s===0&&r.push(n),(d=i[s-1])&&d.children.push(n),i[s]=n),(!h||n.voidElement)&&(s>-1&&(n.voidElement||n.name===c.slice(2,-1))&&(s--,n=s===-1?r:i[s]),!o&&y!=="<"&&y)){d=s===-1?r:i[s].children;var w=t.indexOf("<",g),S=t.slice(g,w===-1?void 0:w);YMe.test(S)&&(S=" "),(w>-1&&s+d.length>=0||S!==" ")&&d.push({type:"text",content:S})}}),r},stringify:function(t){return t.reduce(function(e,n){return e+yoe("",n)},"")}};const Aw=(t,e,n,r)=>{const i=[n,{code:e,...r||{}}];if(t?.services?.logger?.forward)return t.services.logger.forward(i,"warn","react-i18next::",!0);ga(i[0])&&(i[0]=`react-i18next:: ${i[0]}`),t?.services?.logger?.warn?t.services.logger.warn(...i):console?.warn&&console.warn(...i)},Xq={},Ob=(t,e,n,r)=>{ga(n)&&Xq[n]||(ga(n)&&(Xq[n]=new Date),Aw(t,e,n,r))},boe=(t,e)=>()=>{if(t.isInitialized)e();else{const n=()=>{setTimeout(()=>{t.off("initialized",n)},0),e()};t.on("initialized",n)}},WP=(t,e,n)=>{t.loadNamespaces(e,boe(t,n))},Jq=(t,e,n,r)=>{if(ga(n)&&(n=[n]),t.options.preload&&t.options.preload.indexOf(e)>-1)return WP(t,n,r);n.forEach(i=>{t.options.ns.indexOf(i)<0&&t.options.ns.push(i)}),t.loadLanguages(e,boe(t,r))},QMe=(t,e,n={})=>!e.languages||!e.languages.length?(Ob(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(t,{lng:n.lng,precheck:(r,i)=>{if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&r.services.backendConnector.backend&&r.isLanguageChangingTo&&!i(r.isLanguageChangingTo,t))return!1}}),ga=t=>typeof t=="string",Wd=t=>typeof t=="object"&&t!==null,ZMe=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,e8e={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},t8e=t=>e8e[t],n8e=t=>t.replace(ZMe,t8e);let YP={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:n8e};const r8e=(t={})=>{YP={...YP,...t}},_oe=()=>YP;let Soe;const i8e=t=>{Soe=t},e8=()=>Soe,ax=(t,e)=>{if(!t)return!1;const n=t.props?.children??t.children;return e?n.length>0:!!n},cx=t=>{if(!t)return[];const e=t.props?.children??t.children;return t.props?.i18nIsDynamicList?hg(e):e},s8e=t=>Array.isArray(t)&&t.every(_.isValidElement),hg=t=>Array.isArray(t)?t:[t],o8e=(t,e)=>{const n={...e};return n.props=Object.assign(t.props,e.props),n},Eoe=(t,e,n,r)=>{if(!t)return"";let i="";const s=hg(t),o=e?.transSupportBasicHtmlNodes?e.transKeepBasicHtmlNodesFor??[]:[];return s.forEach((a,c)=>{if(ga(a)){i+=`${a}`;return}if(_.isValidElement(a)){const{props:l,type:d}=a,h=Object.keys(l).length,m=o.indexOf(d)>-1,g=l.children;if(!g&&m&&!h){i+=`<${d}/>`;return}if(!g&&(!m||h)||l.i18nIsDynamicList){i+=`<${c}></${c}>`;return}if(m&&h===1&&ga(g)){i+=`<${d}>${g}</${d}>`;return}const y=Eoe(g,e,n,r);i+=`<${c}>${y}</${c}>`;return}if(a===null){Aw(n,"TRANS_NULL_VALUE","Passed in a null value as child",{i18nKey:r});return}if(Wd(a)){const{format:l,...d}=a,h=Object.keys(d);if(h.length===1){const m=l?`${h[0]}, ${l}`:h[0];i+=`{{${m}}}`;return}Aw(n,"TRANS_INVALID_OBJ","Invalid child - Object should only have keys {{ value, format }} (format is optional).",{i18nKey:r,child:a});return}Aw(n,"TRANS_INVALID_VAR","Passed in a variable like {number} - pass variables for interpolation as full objects like {{number}}.",{i18nKey:r,child:a})}),i},a8e=(t,e,n,r,i,s,o)=>{if(n==="")return[];const a=i.transKeepBasicHtmlNodesFor||[],c=n&&new RegExp(a.map(S=>`<${S}`).join("|")).test(n);if(!t&&!e&&!c&&!o)return[n];const l=e??{},d=S=>{hg(S).forEach(x=>{ga(x)||(ax(x)?d(cx(x)):Wd(x)&&!_.isValidElement(x)&&Object.assign(l,x))})};d(t);const h=JMe.parse(`<0>${n}</0>`),m={...l,...s},g=(S,R,x)=>{const T=cx(S),I=v(T,R.children,x);return s8e(T)&&I.length===0||S.props?.i18nIsDynamicList?T:I},y=(S,R,x,T,I)=>{S.dummy?(S.children=R,x.push(_.cloneElement(S,{key:T},I?void 0:R))):x.push(..._.Children.map([S],k=>{const A={...k.props};return delete A.i18nIsDynamicList,_.createElement(k.type,{...A,key:T,ref:k.props.ref??k.ref},I?null:R)}))},v=(S,R,x)=>{const T=hg(S);return hg(R).reduce((k,A,O)=>{const D=A.children?.[0]?.content&&r.services.interpolator.interpolate(A.children[0].content,m,r.language);if(A.type==="tag"){let N=T[parseInt(A.name,10)];!N&&e&&(N=e[A.name]),x.length===1&&!N&&(N=x[0][A.name]),N||(N={});const U=Object.keys(A.attrs).length!==0?o8e({props:A.attrs},N):N,$=_.isValidElement(U),K=$&&ax(A,!0)&&!A.voidElement,Y=c&&Wd(U)&&U.dummy&&!$,G=Wd(e)&&Object.hasOwnProperty.call(e,A.name);if(ga(U)){const F=r.services.interpolator.interpolate(U,m,r.language);k.push(F)}else if(ax(U)||K){const F=g(U,A,x);y(U,F,k,O)}else if(Y){const F=v(T,A.children,x);y(U,F,k,O)}else if(Number.isNaN(parseFloat(A.name)))if(G){const F=g(U,A,x);y(U,F,k,O,A.voidElement)}else if(i.transSupportBasicHtmlNodes&&a.indexOf(A.name)>-1)if(A.voidElement)k.push(_.createElement(A.name,{key:`${A.name}-${O}`}));else{const F=v(T,A.children,x);k.push(_.createElement(A.name,{key:`${A.name}-${O}`},F))}else if(A.voidElement)k.push(`<${A.name} />`);else{const F=v(T,A.children,x);k.push(`<${A.name}>${F}</${A.name}>`)}else if(Wd(U)&&!$){const F=A.children[0]?D:null;F&&k.push(F)}else y(U,D,k,O,A.children.length!==1||!D)}else if(A.type==="text"){const N=i.transWrapTextNodes,U=o?i.unescape(r.services.interpolator.interpolate(A.content,m,r.language)):r.services.interpolator.interpolate(A.content,m,r.language);N?k.push(_.createElement(N,{key:`${A.name}-${O}`},U)):k.push(U)}return k},[])},w=v([{dummy:!0,children:t||[]}],h,hg(t||[]));return cx(w[0])},woe=(t,e,n)=>{const r=t.key||e,i=_.cloneElement(t,{key:r});if(!i.props||!i.props.children||n.indexOf(`${e}/>`)<0&&n.indexOf(`${e} />`)<0)return i;function s(){return _.createElement(_.Fragment,null,i)}return _.createElement(s,{key:r})},c8e=(t,e)=>t.map((n,r)=>woe(n,r,e)),l8e=(t,e)=>{const n={};return Object.keys(t).forEach(r=>{Object.assign(n,{[r]:woe(t[r],r,e)})}),n},u8e=(t,e,n,r)=>t?Array.isArray(t)?c8e(t,e):Wd(t)?l8e(t,e):(Ob(n,"TRANS_INVALID_COMPONENTS",'<Trans /> "components" prop expects an object or array',{i18nKey:r}),null):null,d8e=t=>!Wd(t)||Array.isArray(t)?!1:Object.keys(t).reduce((e,n)=>e&&Number.isNaN(Number.parseFloat(n)),!0);function f8e({children:t,count:e,parent:n,i18nKey:r,context:i,tOptions:s={},values:o,defaults:a,components:c,ns:l,i18n:d,t:h,shouldUnescape:m,...g}){const y=d||e8();if(!y)return Ob(y,"NO_I18NEXT_INSTANCE","Trans: You need to pass in an i18next instance using i18nextReactModule",{i18nKey:r}),t;const v=h||y.t.bind(y)||(Y=>Y),w={..._oe(),...y.options?.react};let S=l||v.ns||y.options?.defaultNS;S=ga(S)?[S]:S||["translation"];const R=Eoe(t,w,y,r),x=a||R||w.transEmptyNodeValue||r,{hashTransKey:T}=w,I=r||(T?T(R||x):R||x);y.options?.interpolation?.defaultVariables&&(o=o&&Object.keys(o).length>0?{...o,...y.options.interpolation.defaultVariables}:{...y.options.interpolation.defaultVariables});const k=o||e!==void 0&&!y.options?.interpolation?.alwaysFormat||!t?s.interpolation:{interpolation:{...s.interpolation,prefix:"#$?",suffix:"?$#"}},A={...s,context:i||s.context,count:e,...o,...k,defaultValue:x,ns:S},O=I?v(I,A):x,D=u8e(c,O,y,r);let N=D||t,U=null;d8e(D)&&(U=D,N=t);const $=a8e(N,U,O,y,w,A,m),K=n??w.defaultTransParent;return K?_.createElement(K,g,$):$}const h8e={type:"3rdParty",init(t){r8e(t.options.react),i8e(t)}},Coe=_.createContext();class p8e{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(n=>{this.usedNamespaces[n]||(this.usedNamespaces[n]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}function Ys({children:t,count:e,parent:n,i18nKey:r,context:i,tOptions:s={},values:o,defaults:a,components:c,ns:l,i18n:d,t:h,shouldUnescape:m,...g}){const{i18n:y,defaultNS:v}=_.useContext(Coe)||{},w=d||y||e8(),S=h||w?.t.bind(w);return f8e({children:t,count:e,parent:n,i18nKey:r,context:i,tOptions:s,values:o,defaults:a,components:c,ns:l||S?.ns||v||w?.options?.defaultNS,i18n:w,t:h,shouldUnescape:m,...g})}const m8e=(t,e)=>{const n=_.useRef();return _.useEffect(()=>{n.current=t},[t,e]),n.current},Toe=(t,e,n,r)=>t.getFixedT(e,n,r),g8e=(t,e,n,r)=>_.useCallback(Toe(t,e,n,r),[t,e,n,r]),We=(t,e={})=>{const{i18n:n}=e,{i18n:r,defaultNS:i}=_.useContext(Coe)||{},s=n||r||e8();if(s&&!s.reportNamespaces&&(s.reportNamespaces=new p8e),!s){Ob(s,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const T=(k,A)=>ga(A)?A:Wd(A)&&ga(A.defaultValue)?A.defaultValue:Array.isArray(k)?k[k.length-1]:k,I=[T,{},!1];return I.t=T,I.i18n={},I.ready=!1,I}s.options.react?.wait&&Ob(s,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const o={..._oe(),...s.options.react,...e},{useSuspense:a,keyPrefix:c}=o;let l=i||s.options?.defaultNS;l=ga(l)?[l]:l||["translation"],s.reportNamespaces.addUsedNamespaces?.(l);const d=(s.isInitialized||s.initializedStoreOnce)&&l.every(T=>QMe(T,s,o)),h=g8e(s,e.lng||null,o.nsMode==="fallback"?l:l[0],c),m=()=>h,g=()=>Toe(s,e.lng||null,o.nsMode==="fallback"?l:l[0],c),[y,v]=_.useState(m);let w=l.join();e.lng&&(w=`${e.lng}${w}`);const S=m8e(w),R=_.useRef(!0);_.useEffect(()=>{const{bindI18n:T,bindI18nStore:I}=o;R.current=!0,!d&&!a&&(e.lng?Jq(s,e.lng,l,()=>{R.current&&v(g)}):WP(s,l,()=>{R.current&&v(g)})),d&&S&&S!==w&&R.current&&v(g);const k=()=>{R.current&&v(g)};return T&&s?.on(T,k),I&&s?.store.on(I,k),()=>{R.current=!1,s&&T&&T?.split(" ").forEach(A=>s.off(A,k)),I&&s&&I.split(" ").forEach(A=>s.store.off(A,k))}},[s,w]),_.useEffect(()=>{R.current&&d&&v(m)},[s,c,d]);const x=[y,s,d];if(x.t=y,x.i18n=s,x.ready=d,d||!d&&!a)return x;throw new Promise(T=>{e.lng?Jq(s,e.lng,l,()=>T()):WP(s,l,()=>T())})};function Roe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{fillRule:"evenodd",d:"m12 4.236-6 3V12c0 5.156 4.239 7.254 6 7.898 1.761-.644 6-2.742 6-7.898V7.236zm-.894-1.789a2 2 0 0 1 1.788 0l6 3A2 2 0 0 1 20 7.236V12c0 6.742-5.773 9.246-7.51 9.846-.32.111-.66.111-.98 0C9.774 21.246 4 18.743 4 12V7.236a2 2 0 0 1 1.106-1.789z",clipRule:"evenodd"})})}Roe.displayName="AdminIcon";const v8e=_.forwardRef(Roe);function Ioe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"m12 10.775-3.9 3.9a.95.95 0 0 1-.7.275.95.95 0 0 1-.7-.275.95.95 0 0 1-.275-.7q0-.425.275-.7l4.6-4.6q.15-.15.325-.212Q11.8 8.4 12 8.4t.375.063a.9.9 0 0 1 .325.212l4.6 4.6a.95.95 0 0 1 .275.7.95.95 0 0 1-.275.7.95.95 0 0 1-.7.275.95.95 0 0 1-.7-.275z"})})}Ioe.displayName="ChevronUpIcon";const y8e=_.forwardRef(Ioe);function koe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12 11.034a1 1 0 0 0 .29.702l.005.005c.18.18.43.29.705.29h8a1 1 0 0 0 0-2h-5.586L22 3.445a1 1 0 0 0-1.414-1.414L14 8.617V3.031a1 1 0 1 0-2 0zm0 1.963a1 1 0 0 0-.29-.702l-.005-.004A1 1 0 0 0 11 12H3a1 1 0 1 0 0 2h5.586L2 20.586A1 1 0 1 0 3.414 22L10 15.414V21a1 1 0 0 0 2 0z"})})}koe.displayName="CollapseIcon";const xoe=_.forwardRef(koe);function Aoe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M7 21q-.824 0-1.412-.587A1.93 1.93 0 0 1 5 19V6a.97.97 0 0 1-.713-.287A.97.97 0 0 1 4 5q0-.424.287-.713A.97.97 0 0 1 5 4h4q0-.424.287-.712A.97.97 0 0 1 10 3h4q.424 0 .713.288Q15 3.575 15 4h4q.424 0 .712.287Q20 4.576 20 5t-.288.713A.97.97 0 0 1 19 6v13q0 .824-.587 1.413A1.93 1.93 0 0 1 17 21zM7 6v13h10V6zm2 10q0 .424.287.712Q9.576 17 10 17t.713-.288A.97.97 0 0 0 11 16V9a.97.97 0 0 0-.287-.713A.97.97 0 0 0 10 8a.97.97 0 0 0-.713.287A.97.97 0 0 0 9 9zm4 0q0 .424.287.712.288.288.713.288.424 0 .713-.288A.97.97 0 0 0 15 16V9a.97.97 0 0 0-.287-.713A.97.97 0 0 0 14 8a.97.97 0 0 0-.713.287A.97.97 0 0 0 13 9z"})})}Aoe.displayName="DeleteIcon";const b8e=_.forwardRef(Aoe);function Poe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{fillRule:"evenodd",d:"M15.706 2.637a2 2 0 0 1 2.829 0l2.828 2.828a2 2 0 0 1 0 2.829L9.605 20.052a1 1 0 0 1-.465.263L3.483 21.73a1 1 0 0 1-1.212-1.213l1.414-5.657a1 1 0 0 1 .263-.465zm1.224 7.262L14.102 7.07l-8.544 8.544-.943 3.771 3.771-.943z",clipRule:"evenodd"})})}Poe.displayName="EditIcon";const Qq=_.forwardRef(Poe);function Loe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"m2.765 16.02-2.47-2.416A1.02 1.02 0 0 1 0 12.852q0-.456.295-.751a15.6 15.6 0 0 1 5.316-3.786A15.9 15.9 0 0 1 12 7q3.355 0 6.39 1.329a16 16 0 0 1 5.315 3.772q.295.294.295.751t-.295.752l-2.47 2.416a1.047 1.047 0 0 1-1.396.108l-3.114-2.363a1.1 1.1 0 0 1-.322-.376 1.1 1.1 0 0 1-.108-.483v-2.27a13.6 13.6 0 0 0-2.12-.524C13.459 9.996 12 9.937 12 9.937s-1.459.059-2.174.175q-1.074.174-2.121.523v2.271q0 .268-.108.483a1.1 1.1 0 0 1-.322.376l-3.114 2.363a1.047 1.047 0 0 1-1.396-.107"})})}Loe.displayName="EndCallIcon";const Ooe=_.forwardRef(Loe);function Moe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M21 3.997a1 1 0 0 0-.29-.702l-.005-.004A1 1 0 0 0 20 3h-8a1 1 0 1 0 0 2h5.586L5 17.586V12a1 1 0 1 0-2 0v8.003a1 1 0 0 0 .29.702l.005.004c.18.18.43.291.705.291h8a1 1 0 1 0 0-2H6.414L19 6.414V12a1 1 0 1 0 2 0z"})})}Moe.displayName="ExpandIcon";const Doe=_.forwardRef(Moe);function Noe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M4 11a.97.97 0 0 1-.712-.287A.97.97 0 0 1 3 10V4q0-.424.288-.712A.97.97 0 0 1 4 3h6q.424 0 .713.288Q11 3.575 11 4v6q0 .424-.287.713A.97.97 0 0 1 10 11zm5-2V5H5v4zm5 12a.97.97 0 0 1-.713-.288A.97.97 0 0 1 13 20v-6q0-.424.287-.713A.97.97 0 0 1 14 13h6q.424 0 .712.287.288.288.288.713v6q0 .424-.288.712A.97.97 0 0 1 20 21zm5-2v-4h-4v4zM4 21a.97.97 0 0 1-.712-.288A.97.97 0 0 1 3 20v-6q0-.424.288-.713A.97.97 0 0 1 4 13h6q.424 0 .713.287.287.288.287.713v6q0 .424-.287.712A.97.97 0 0 1 10 21zm5-2v-4H5v4zm5-8a.97.97 0 0 1-.713-.287A.97.97 0 0 1 13 10V4q0-.424.287-.712A.97.97 0 0 1 14 3h6q.424 0 .712.288Q21 3.575 21 4v6q0 .424-.288.713A.97.97 0 0 1 20 11zm5-2V5h-4v4z"})})}Noe.displayName="GridIcon";const _8e=_.forwardRef(Noe);function Uoe(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M16.713 6.713A.97.97 0 0 1 16 7a.97.97 0 0 1-.713-.287A.97.97 0 0 1 15 6q0-.424.287-.713A.97.97 0 0 1 16 5q.424 0 .712.287Q17 5.576 17 6t-.288.713"}),E.jsx("path",{fillRule:"evenodd",d:"M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zm12 2H6v4h12zM6 12v-2h12v2zm0 2v2h12v-2zm0 6v-2h12v2z",clipRule:"evenodd"})]})}Uoe.displayName="HostIcon";const S8e=_.forwardRef(Uoe);function joe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12 19.071q-1.467 1.467-3.536 1.467-2.067 0-3.535-1.467t-1.467-3.535q0-2.07 1.467-3.536L7.05 9.879q.3-.3.707-.3t.707.3.301.707-.3.707l-2.122 2.121a2.9 2.9 0 0 0-.884 2.122q0 1.237.884 2.12.884.885 2.121.885t2.122-.884l2.121-2.121q.3-.3.707-.3t.707.3.3.707q0 .405-.3.707zm-1.414-4.243q-.3.3-.707.301a.97.97 0 0 1-.707-.3q-.3-.3-.301-.708 0-.405.3-.707l4.243-4.242q.3-.3.707-.3t.707.3.3.707-.3.707zm6.364-.707q-.3.3-.707.3a.97.97 0 0 1-.707-.3q-.3-.3-.301-.707 0-.405.3-.707l2.122-2.121q.884-.885.884-2.121 0-1.238-.884-2.122a2.9 2.9 0 0 0-2.121-.884q-1.237 0-2.122.884l-2.121 2.122q-.3.3-.707.3a.97.97 0 0 1-.707-.3q-.3-.3-.3-.708 0-.405.3-.707L12 4.93q1.467-1.467 3.536-1.467t3.535 1.467 1.467 3.536T19.071 12z"})})}joe.displayName="LinkIcon";const E8e=_.forwardRef(joe);function Foe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M6 22q-.825 0-1.412-.587A1.93 1.93 0 0 1 4 20V10q0-.825.588-1.412a2 2 0 0 1 .702-.463L1.333 4.167a1 1 0 0 1 1.414-1.414L7 7.006v-.012l13 13v.012l1.247 1.247a1 1 0 1 1-1.414 1.414l-.896-.896A1.94 1.94 0 0 1 18 22zm14-4.834V10q0-.825-.587-1.412A1.93 1.93 0 0 0 18 8h-1V6q0-2.075-1.463-3.537Q14.075 1 12 1T8.463 2.463a4.9 4.9 0 0 0-1.22 1.946L9 6.166V6q0-1.25.875-2.125A2.9 2.9 0 0 1 12 3q1.25 0 2.125.875T15 6v2h-4.166z"})})}Foe.displayName="LockOffIcon";const w8e=_.forwardRef(Foe);function $oe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M6 22q-.824 0-1.412-.587A1.93 1.93 0 0 1 4 20V10q0-.825.588-1.412A1.93 1.93 0 0 1 6 8h1V6q0-2.075 1.463-3.537Q9.926 1 12 1q2.075 0 3.537 1.463Q17 3.925 17 6v2h1q.824 0 1.413.588Q20 9.175 20 10v10q0 .824-.587 1.413A1.93 1.93 0 0 1 18 22zM9 8h6V6q0-1.25-.875-2.125A2.9 2.9 0 0 0 12 3q-1.25 0-2.125.875A2.9 2.9 0 0 0 9 6z"})})}$oe.displayName="LockSolidIcon";const C8e=_.forwardRef($oe);function Boe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M8 8v-.006l6.831 6.832-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.95 7.95 0 0 1 13 19.938V21a1 1 0 0 1-2 0v-1.062A8 8 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5zm9.417 6.583 1.478 1.477A7.96 7.96 0 0 0 20 12a1 1 0 0 0-2 0c0 .925-.21 1.8-.583 2.583M8.073 5.238l7.793 7.793q.132-.495.134-1.031V6a4 4 0 0 0-7.927-.762"})})}Boe.displayName="MicOffSolidIcon";const Hoe=_.forwardRef(Boe);function Voe(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{fillRule:"evenodd",d:"M8 8v-.006l2 2V10l3.414 3.414.003-.003 1.414 1.415-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.95 7.95 0 0 1 13 19.938V21a1 1 0 1 1-2 0v-1.062A8 8 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5z",clipRule:"evenodd"}),E.jsx("path",{d:"M14 6v5.166l1.866 1.866q.132-.496.134-1.032V6a4 4 0 0 0-7.928-.762L10 7.166V6a2 2 0 1 1 4 0m3.417 8.583 1.477 1.477A7.96 7.96 0 0 0 20 12a1 1 0 1 0-2 0c0 .925-.21 1.8-.583 2.583"})]})}Voe.displayName="MicOffIcon";const T8e=_.forwardRef(Voe);function qoe(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M8 6a4 4 0 1 1 8 0v6a4 4 0 0 1-8 0z"}),E.jsx("path",{d:"M5 11a1 1 0 0 1 1 1 6 6 0 0 0 12 0 1 1 0 1 1 2 0 8 8 0 0 1-7 7.938V21a1 1 0 1 1-2 0v-1.062A8 8 0 0 1 4 12a1 1 0 0 1 1-1"})]})}qoe.displayName="MicOnSolidIcon";const t8=_.forwardRef(qoe);function Goe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M3.5 3.5a1 1 0 1 0-1.414 1.414l4.113 4.114a5.5 5.5 0 0 0-.184 1.07A5.002 5.002 0 0 0 7 20h10.172l1.914 1.914A1 1 0 1 0 20.5 20.5l-.979-.979.004-.001L7.145 7.14l-.002.003zm18.5 12a4.48 4.48 0 0 1-.928 2.738L8.637 5.803A5.47 5.47 0 0 1 11.5 5a5.49 5.49 0 0 1 4.25 2.008 4 4 0 0 1 4.187 4.708A4.5 4.5 0 0 1 22 15.5"})})}Goe.displayName="OfflineIcon";const R8e=_.forwardRef(Goe);function Koe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M6 14q-.824 0-1.412-.588A1.93 1.93 0 0 1 4 12q0-.825.588-1.412A1.93 1.93 0 0 1 6 10q.824 0 1.412.588Q8 11.175 8 12t-.588 1.412A1.93 1.93 0 0 1 6 14m6 0q-.825 0-1.412-.588A1.93 1.93 0 0 1 10 12q0-.825.588-1.412A1.93 1.93 0 0 1 12 10q.825 0 1.412.588Q14 11.175 14 12t-.588 1.412A1.93 1.93 0 0 1 12 14m6 0q-.824 0-1.413-.588A1.93 1.93 0 0 1 16 12q0-.825.587-1.412A1.93 1.93 0 0 1 18 10q.824 0 1.413.588Q20 11.175 20 12t-.587 1.412A1.93 1.93 0 0 1 18 14"})})}Koe.displayName="OverflowHorizontalIcon";const I8e=_.forwardRef(Koe);function zoe(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M5 3h6a1 1 0 1 1 0 2H5v14h14v-6a1 1 0 1 1 2 0v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2"}),E.jsx("path",{d:"M15 3h5a1 1 0 0 1 1 1v5a1 1 0 1 1-2 0V6.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L17.586 5H15a1 1 0 1 1 0-2"})]})}zoe.displayName="PopOutIcon";const Woe=_.forwardRef(zoe);function Yoe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M11 3a1 1 0 1 1 2 0v8.5a.5.5 0 0 0 1 0V4a1 1 0 1 1 2 0v10.2l3.284-2.597a1.081 1.081 0 0 1 1.47 1.577c-.613.673-1.214 1.367-1.818 2.064-1.267 1.463-2.541 2.934-3.943 4.235A6 6 0 0 1 5 15V7a1 1 0 0 1 1.999 0v5.5a.5.5 0 0 0 1 0V4a1 1 0 0 1 2 0v7.5a.5.5 0 0 0 1 0z"})})}Yoe.displayName="RaisedHandSolidIcon";const Xoe=_.forwardRef(Yoe);function Joe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{fillRule:"evenodd",d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10m3.536-6.464a1 1 0 0 0-1.415-1.415A3 3 0 0 1 12 15a3 3 0 0 1-2.121-.879 1 1 0 1 0-1.414 1.415A5 5 0 0 0 12 17c1.38 0 2.632-.56 3.536-1.464M10 10.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m5.5 1.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3",clipRule:"evenodd"})})}Joe.displayName="ReactionSolidIcon";const k8e=_.forwardRef(Joe);function Qoe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12.731 2C13.432 2 14 2.568 14 3.269c0 .578.396 1.074.935 1.286q.128.052.253.106c.531.23 1.162.16 1.572-.25a1.27 1.27 0 0 1 1.794 0l1.034 1.035a1.27 1.27 0 0 1 0 1.794c-.41.41-.48 1.04-.248 1.572l.105.253c.212.539.708.935 1.286.935.701 0 1.269.568 1.269 1.269v1.462c0 .701-.568 1.269-1.269 1.269-.578 0-1.074.396-1.287.935q-.05.128-.104.253c-.232.531-.161 1.162.248 1.572a1.27 1.27 0 0 1 0 1.794l-1.034 1.034a1.27 1.27 0 0 1-1.794 0c-.41-.41-1.04-.48-1.572-.248a8 8 0 0 1-.253.105c-.539.212-.935.708-.935 1.286 0 .701-.568 1.269-1.269 1.269H11.27c-.702 0-1.27-.568-1.27-1.269 0-.578-.396-1.074-.935-1.287a8 8 0 0 1-.253-.104c-.531-.232-1.162-.161-1.572.248a1.27 1.27 0 0 1-1.794 0l-1.034-1.034a1.27 1.27 0 0 1 0-1.794c.41-.41.48-1.04.249-1.572a8 8 0 0 1-.106-.253C4.343 14.396 3.847 14 3.27 14 2.568 14 2 13.432 2 12.731V11.27c0-.702.568-1.27 1.269-1.27.578 0 1.074-.396 1.286-.935q.052-.128.106-.253c.23-.531.16-1.162-.25-1.572a1.27 1.27 0 0 1 0-1.794l1.035-1.034a1.27 1.27 0 0 1 1.794 0c.41.41 1.04.48 1.572.249a8 8 0 0 1 .253-.106c.539-.212.935-.708.935-1.286C10 2.568 10.568 2 11.269 2zM12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8"})})}Qoe.displayName="SettingsSolidIcon";const x8e=_.forwardRef(Qoe);function Zoe(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M1.288 20.713Q1.575 21 2 21h20q.424 0 .712-.288A.97.97 0 0 0 23 20a.97.97 0 0 0-.288-.712A.97.97 0 0 0 22 19H2a.97.97 0 0 0-.712.288A.97.97 0 0 0 1 20q0 .424.288.712m1.3-3.299A1.93 1.93 0 0 1 2 16V5q0-.824.587-1.412A1.93 1.93 0 0 1 4 3h16q.824 0 1.413.587Q22 4.176 22 5v11q0 .824-.587 1.413A1.93 1.93 0 0 1 20 18H4q-.824 0-1.412-.587m10.12-10.12a1 1 0 0 0-1.415 0l-2.5 2.5a1 1 0 0 0 1.414 1.414l.793-.793V13a1 1 0 1 0 2 0v-2.586l.793.793a1 1 0 0 0 1.414-1.414z"})})}Zoe.displayName="ShareScreenSolidIcon";const A8e=_.forwardRef(Zoe);function eae(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12 16a.97.97 0 0 1-.713-.287A.97.97 0 0 1 11 15V7.85L9.125 9.725q-.3.3-.7.3T7.7 9.7a.93.93 0 0 1-.288-.713A.98.98 0 0 1 7.7 8.3l3.6-3.6q.15-.15.325-.213.175-.062.375-.062t.375.062a.9.9 0 0 1 .325.213l3.6 3.6q.3.3.287.712a.98.98 0 0 1-.287.688q-.3.3-.713.313a.93.93 0 0 1-.712-.288L13 7.85V15q0 .424-.287.713A.97.97 0 0 1 12 16m-6 4q-.824 0-1.412-.587A1.93 1.93 0 0 1 4 18v-2q0-.424.287-.713A.97.97 0 0 1 5 15q.424 0 .713.287Q6 15.576 6 16v2h12v-2q0-.424.288-.713A.97.97 0 0 1 19 15q.424 0 .712.287.288.288.288.713v2q0 .824-.587 1.413A1.93 1.93 0 0 1 18 20z"})})}eae.displayName="ShareIcon";const P8e=_.forwardRef(eae);function tae(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M5 5h14v8h-5a1 1 0 0 0-1 1v5H5zm10 14v-4h4v4zM5 21h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2"})})}tae.displayName="SpotlightIcon";const L8e=_.forwardRef(tae);function nae(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M16.293 2.293a1 1 0 0 1 1.414 0l2 2a1 1 0 0 1 0 1.414l-2 2a1 1 0 1 1-1.414-1.414L16.586 6H6a2 2 0 0 0-2 2v7a1 1 0 1 1-2 0V8a4 4 0 0 1 4-4h10.586l-.293-.293a1 1 0 0 1 0-1.414M18 18H7.414l.293-.293a1 1 0 1 0-1.414-1.414l-2 2a1 1 0 0 0 0 1.414l2 2a1 1 0 0 0 1.414-1.414L7.414 20H18a4 4 0 0 0 4-4V9a1 1 0 1 0-2 0v7a2 2 0 0 1-2 2"}),E.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6"})]})}nae.displayName="SwitchCameraSolidIcon";const O8e=_.forwardRef(nae);function rae(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12.999 13.012v-.005zm-9.411 7.401Q4.175 21 5 21h14q.824 0 1.413-.587Q21 19.825 21 19V5q0-.824-.587-1.412A1.93 1.93 0 0 0 19 3H5q-.824 0-1.412.587A1.93 1.93 0 0 0 3 5v14q0 .824.587 1.413M12 9a1 1 0 0 0-1 1 1 1 0 1 1-2 0 3 3 0 1 1 4.44 2.633 1.4 1.4 0 0 0-.383.288.3.3 0 0 0-.057.085A1 1 0 0 1 11 13c0-.58.253-1.047.539-1.38.281-.33.63-.572.94-.742A1 1 0 0 0 12 9m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})})}rae.displayName="UnknownSolidIcon";const M8e=_.forwardRef(rae);function iae(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M10 12q-1.65 0-2.825-1.175T6 8t1.175-2.825T10 4t2.825 1.175T14 8t-1.175 2.825T10 12m-8 6v-.8q0-.85.438-1.562.437-.713 1.162-1.088a14.8 14.8 0 0 1 3.15-1.163A13.8 13.8 0 0 1 10 13q1.65 0 3.25.387 1.6.388 3.15 1.163.724.375 1.163 1.087Q18 16.35 18 17.2v.8q0 .824-.587 1.413A1.93 1.93 0 0 1 16 20H4q-.824 0-1.412-.587A1.93 1.93 0 0 1 2 18m2 0h12v-.8a.97.97 0 0 0-.5-.85q-1.35-.675-2.725-1.012a11.6 11.6 0 0 0-5.55 0Q5.85 15.675 4.5 16.35a.97.97 0 0 0-.5.85zm6-8q.825 0 1.412-.588Q12 8.826 12 8q0-.824-.588-1.412A1.93 1.93 0 0 0 10 6q-.825 0-1.412.588A1.93 1.93 0 0 0 8 8q0 .825.588 1.412Q9.175 10 10 10m7 1h2v2q0 .424.288.713.287.287.712.287.424 0 .712-.287A.97.97 0 0 0 21 13v-2h2q.424 0 .712-.287A.97.97 0 0 0 24 10a.97.97 0 0 0-.288-.713A.97.97 0 0 0 23 9h-2V7a.97.97 0 0 0-.288-.713A.97.97 0 0 0 20 6a.97.97 0 0 0-.712.287A.97.97 0 0 0 19 7v2h-2a.97.97 0 0 0-.712.287A.97.97 0 0 0 16 10q0 .424.288.713.287.287.712.287"})})}iae.displayName="UserAddIcon";const D8e=_.forwardRef(iae);function sae(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M9.175 13.825Q10.35 15 12 15t2.825-1.175T16 11t-1.175-2.825T12 7 9.175 8.175 8 11t1.175 2.825m4.237-1.412A1.93 1.93 0 0 1 12 13q-.825 0-1.412-.588A1.93 1.93 0 0 1 10 11q0-.825.588-1.412A1.93 1.93 0 0 1 12 9q.825 0 1.412.588Q14 10.175 14 11t-.588 1.412"}),E.jsx("path",{d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10m-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0"}),E.jsx("path",{d:"M16.23 18.792a13 13 0 0 0-1.455-.455 11.6 11.6 0 0 0-5.55 0q-.73.18-1.455.455a8 8 0 0 1-1.729-1.454q1.336-.618 2.709-.95A13.8 13.8 0 0 1 12 16q1.65 0 3.25.387 1.373.333 2.709.95a8 8 0 0 1-1.73 1.455"})]})}sae.displayName="UserProfileIcon";const oae=_.forwardRef(sae);function aae(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M2.747 2.753 4.35 4.355l.007-.003L18 17.994v.012l3.247 3.247a1 1 0 0 1-1.414 1.414l-2.898-2.898A2 2 0 0 1 16 20H6a4 4 0 0 1-4-4V8c0-.892.292-1.715.785-2.38L1.333 4.166a1 1 0 0 1 1.414-1.414M18 15.166 6.834 4H16a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715z"})})}aae.displayName="VideoCallOffSolidIcon";const N8e=_.forwardRef(aae);function cae(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M6 4h10a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715V18a2 2 0 0 1-2 2H6a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4"})})}cae.displayName="VideoCallSolidIcon";const lae=_.forwardRef(cae);function uae(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"m20.958 16.374.039 3.527q0 .427-.33.756-.33.33-.756.33a16 16 0 0 1-6.57-1.105 16.2 16.2 0 0 1-5.563-3.663 16.1 16.1 0 0 1-3.653-5.573 16.3 16.3 0 0 1-1.115-6.56q0-.427.33-.757T4.095 3l3.528.039a1.07 1.07 0 0 1 1.085.93l.543 3.954q.039.271-.039.504a1.1 1.1 0 0 1-.271.426l-1.64 1.64q.505 1.008 1.154 1.909c.433.6 1.444 1.696 1.444 1.696s1.095 1.01 1.696 1.444q.9.65 1.909 1.153l1.64-1.64q.193-.193.426-.27t.504-.04l3.954.543q.406.059.668.359t.262.727"})})}uae.displayName="VoiceCallSolidIcon";const U8e=_.forwardRef(uae);function dae(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("g",{clipPath:"url(#a)",children:E.jsx("path",{fillRule:"evenodd",d:"M8.929 15.1a13.6 13.6 0 0 0 4.654 3.066q2.62 1.036 5.492.923h.008l.003-.004.003-.002-.034-3.124-3.52-.483-1.791 1.792-.645-.322a13.5 13.5 0 0 1-3.496-2.52 13.4 13.4 0 0 1-2.52-3.496l-.322-.644 1.792-1.792-.483-3.519-3.123-.034-.003.002-.003.004v.002a13.65 13.65 0 0 0 .932 5.492A13.4 13.4 0 0 0 8.93 15.1m3.92 4.926a15.6 15.6 0 0 1-5.334-3.511 15.4 15.4 0 0 1-3.505-5.346 15.6 15.6 0 0 1-1.069-6.274 1.93 1.93 0 0 1 .589-1.366c.366-.366.84-.589 1.386-.589h.01l3.163.035a1.96 1.96 0 0 1 1.958 1.694v.005l.487 3.545v.003c.043.297.025.605-.076.907a2 2 0 0 1-.485.773l-.762.762a11.4 11.4 0 0 0 3.206 3.54q.457.33.948.614l.762-.761a2 2 0 0 1 .774-.486c.302-.1.61-.118.907-.076l3.553.487a1.96 1.96 0 0 1 1.694 1.958l.034 3.174c0 .546-.223 1.02-.588 1.386-.361.36-.827.582-1.363.588a15.3 15.3 0 0 1-6.29-1.062",clipRule:"evenodd"})}),E.jsx("defs",{children:E.jsx("clipPath",{id:"a",children:E.jsx("path",{d:"M0 0h24v24H0z"})})})]})}dae.displayName="VoiceCallIcon";const j8e=_.forwardRef(dae);function fae(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M3.5 3.5a1 1 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2l3.293 3.293c.63.63 1.707.184 1.707-.707v-3.758l7.086 7.086A1 1 0 0 0 20.5 20.5l-2.136-2.136.003-.003-1.414-1.414-.003.003-1.414-1.414.003-.003-1.415-1.415-.002.003L12 12v-.006L7.503 7.497 7.5 7.5zm11.496 8.662 1.661 1.66c.222-.564.343-1.18.343-1.822 0-1.38-.56-2.632-1.464-3.536a1 1 0 1 0-1.414 1.414 3 3 0 0 1 .874 2.284m3.164 3.165 1.462 1.46A8.96 8.96 0 0 0 21 12a8.98 8.98 0 0 0-2.636-6.364A1 1 0 0 0 16.95 7.05 6.98 6.98 0 0 1 19 12a7 7 0 0 1-.84 3.326M8.917 6.083 12 9.166V5.414c0-.89-1.077-1.337-1.707-.707z"})})}fae.displayName="VolumeOffSolidIcon";const F8e=_.forwardRef(fae);function hae(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"m3.5 3.5 4 4 .003-.003L8.917 8.91l-.003.003L10 10v-.006l2 2V12l2.122 2.121.002-.003 1.415 1.415-.003.003 1.414 1.414.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414L12 14.828v3.758c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h.172L2.086 4.914A1 1 0 0 1 3.5 3.5M7.172 10H5v4h2.828L10 16.17v-3.343zm7.824 2.162 1.661 1.66c.222-.564.343-1.18.343-1.822 0-1.38-.56-2.632-1.464-3.536a1 1 0 1 0-1.414 1.414 3 3 0 0 1 .874 2.284m3.164 3.165 1.462 1.46A8.96 8.96 0 0 0 21 12a8.98 8.98 0 0 0-2.636-6.364A1 1 0 0 0 16.95 7.05 6.98 6.98 0 0 1 19 12a7 7 0 0 1-.84 3.326M8.917 6.083 12 9.166V5.414c0-.89-1.077-1.337-1.707-.707z"})})}hae.displayName="VolumeOffIcon";const $8e=_.forwardRef(hae);function pae(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M3 14v-4a2 2 0 0 1 2-2h2l3.293-3.293c.63-.63 1.707-.184 1.707.707v13.172c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2m11.122-5.536a1 1 0 0 1 1.414 0A5 5 0 0 1 17 12c0 1.38-.56 2.632-1.464 3.536a1 1 0 0 1-1.415-1.415 3 3 0 0 0 .88-2.121c0-.829-.335-1.577-.88-2.121a1 1 0 0 1 0-1.415"}),E.jsx("path",{d:"M16.95 5.636a1 1 0 0 1 1.414 0A8.98 8.98 0 0 1 21 12a8.98 8.98 0 0 1-2.636 6.364 1 1 0 0 1-1.414-1.414A6.98 6.98 0 0 0 19 12a6.98 6.98 0 0 0-2.05-4.95 1 1 0 0 1 0-1.414"})]})}pae.displayName="VolumeOnSolidIcon";const B8e=_.forwardRef(pae);function mae(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M3 10a2 2 0 0 1 2-2h2l3.293-3.293c.63-.63 1.707-.184 1.707.707v13.172c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2zm4.828 4L10 16.172V7.828L7.828 10H5v4zm6.294-5.536a1 1 0 0 1 1.414 0A5 5 0 0 1 17 12c0 1.38-.56 2.632-1.464 3.535a1 1 0 1 1-1.415-1.414 3 3 0 0 0 .88-2.121c0-.829-.335-1.578-.88-2.122a1 1 0 0 1 0-1.414"}),E.jsx("path",{d:"M18.364 5.636A1 1 0 1 0 16.95 7.05 6.98 6.98 0 0 1 19 12a6.98 6.98 0 0 1-2.05 4.95 1 1 0 0 0 1.414 1.414A8.98 8.98 0 0 0 21 12a8.98 8.98 0 0 0-2.636-6.364"})]})}mae.displayName="VolumeOnIcon";const H8e=_.forwardRef(mae);function gae(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M4 20q-.824 0-1.412-.587A1.93 1.93 0 0 1 2 18V6q0-.824.587-1.412A1.93 1.93 0 0 1 4 4h16q.824 0 1.413.588Q22 5.175 22 6v12q0 .824-.587 1.413A1.93 1.93 0 0 1 20 20zm0-2h16V8H4z"})})}gae.displayName="WebBrowserIcon";const V8e=_.forwardRef(gae),q8e="_header_p1omj_8",G8e="_nav_p1omj_18",K8e="_headerLogo_p1omj_26",z8e="_leftNav_p1omj_33",W8e="_hideMobile_p1omj_33",Y8e="_rightNav_p1omj_45",X8e="_roomHeaderInfo_p1omj_61",J8e="_roomAvatar_p1omj_76",Q8e="_nameLine_p1omj_81",Z8e="_participantsLine_p1omj_100",ua={header:q8e,nav:G8e,headerLogo:K8e,leftNav:z8e,hideMobile:W8e,rightNav:Y8e,roomHeaderInfo:X8e,roomAvatar:J8e,nameLine:Q8e,participantsLine:Z8e},e9e=(t,e)=>_.createElement("svg",{width:260,height:30,viewBox:"0 0 260 30",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("desc",null,"Element Call (Beta)"),_.createElement("circle",{cx:15,cy:15,r:13,fill:"white"}),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 30C23.2843 30 30 23.2843 30 15C30 6.71573 23.2843 0 15 0C6.71573 0 0 6.71573 0 15C0 23.2843 6.71573 30 15 30ZM12.2579 6.98923C12.2579 6.38376 12.7497 5.89292 13.3565 5.89292C17.4687 5.89292 20.8024 9.21967 20.8024 13.3234C20.8024 13.9289 20.3106 14.4197 19.7038 14.4197C19.0971 14.4197 18.6052 13.9289 18.6052 13.3234C18.6052 10.4306 16.2553 8.08554 13.3565 8.08554C12.7497 8.08554 12.2579 7.59471 12.2579 6.98923ZM24.1066 13.3235C24.1066 12.7181 23.6148 12.2272 23.008 12.2272C22.4013 12.2272 21.9094 12.7181 21.9094 13.3235C21.9094 16.2163 19.5595 18.5614 16.6607 18.5614C16.0539 18.5614 15.5621 19.0523 15.5621 19.6577C15.5621 20.2632 16.0539 20.754 16.6607 20.754C20.7729 20.754 24.1066 17.4273 24.1066 13.3235ZM17.7601 23.011C17.7601 23.6164 17.2682 24.1073 16.6615 24.1073C12.5492 24.1073 9.21553 20.7805 9.21553 16.6768C9.21553 16.0713 9.70739 15.5805 10.3141 15.5805C10.9209 15.5805 11.4127 16.0713 11.4127 16.6768C11.4127 19.5696 13.7627 21.9146 16.6615 21.9146C17.2682 21.9146 17.7601 22.4055 17.7601 23.011ZM5.89281 16.6769C5.89281 17.2824 6.38466 17.7732 6.9914 17.7732C7.59813 17.7732 8.08999 17.2824 8.08999 16.6769C8.08999 13.7841 10.4399 11.439 13.3388 11.439C13.9455 11.439 14.4373 10.9482 14.4373 10.3427C14.4373 9.73722 13.9455 9.24639 13.3388 9.24639C9.22647 9.24639 5.89281 12.5731 5.89281 16.6769Z",fill:"#0DBD8B"}),_.createElement("path",{d:"M53.5406 17.258H42.8052C42.932 18.3814 43.3397 19.2782 44.0282 19.9486C44.7167 20.6009 45.6227 20.927 46.746 20.927C47.4889 20.927 48.1593 20.7459 48.7572 20.3835C49.3551 20.0211 49.7809 19.5319 50.0346 18.9159H53.296C52.8611 20.3472 52.0458 21.5068 50.8499 22.3947C49.6722 23.2644 48.2771 23.6992 46.6645 23.6992C44.5627 23.6992 42.8596 23.0016 41.555 21.6065C40.2686 20.2114 39.6254 18.4448 39.6254 16.3068C39.6254 14.2231 40.2776 12.4747 41.5822 11.0614C42.8867 9.64814 44.5718 8.94151 46.6373 8.94151C48.7029 8.94151 50.3698 9.63908 51.6381 11.0342C52.9245 12.4112 53.5677 14.1506 53.5677 16.2524L53.5406 17.258ZM46.6373 11.5778C45.6227 11.5778 44.7801 11.8767 44.1098 12.4747C43.4394 13.0726 43.0226 13.8698 42.8596 14.8663H50.3607C50.2158 13.8698 49.8172 13.0726 49.1649 12.4747C48.5126 11.8767 47.6701 11.5778 46.6373 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M55.7934 19.1605V2.9895H59.0276V19.2148C59.0276 19.9396 59.4262 20.302 60.2234 20.302L60.7941 20.2748V23.3459C60.4861 23.4003 60.16 23.4274 59.8157 23.4274C58.4206 23.4274 57.3969 23.0741 56.7446 22.3675C56.1104 21.6609 55.7934 20.5919 55.7934 19.1605Z",fill:"currentColor"}),_.createElement("path",{d:"M75.8563 17.258H65.121C65.2478 18.3814 65.6555 19.2782 66.344 19.9486C67.0325 20.6009 67.9384 20.927 69.0618 20.927C69.8047 20.927 70.4751 20.7459 71.073 20.3835C71.6709 20.0211 72.0967 19.5319 72.3503 18.9159H75.6117C75.1769 20.3472 74.3615 21.5068 73.1657 22.3947C71.988 23.2644 70.5928 23.6992 68.9803 23.6992C66.8785 23.6992 65.1753 23.0016 63.8708 21.6065C62.5843 20.2114 61.9411 18.4448 61.9411 16.3068C61.9411 14.2231 62.5934 12.4747 63.898 11.0614C65.2025 9.64814 66.8875 8.94151 68.9531 8.94151C71.0186 8.94151 72.6855 9.63908 73.9539 11.0342C75.2403 12.4112 75.8835 14.1506 75.8835 16.2524L75.8563 17.258ZM68.9531 11.5778C67.9384 11.5778 67.0959 11.8767 66.4255 12.4747C65.7551 13.0726 65.3384 13.8698 65.1753 14.8663H72.6765C72.5315 13.8698 72.1329 13.0726 71.4806 12.4747C70.8284 11.8767 69.9859 11.5778 68.9531 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M90.448 15.274V23.3731H87.2138V14.9207C87.2138 12.7827 86.326 11.7137 84.5503 11.7137C83.59 11.7137 82.82 12.0217 82.2402 12.6377C81.6785 13.2538 81.3977 14.0963 81.3977 15.1653V23.3731H78.1635V9.26764H81.1531V11.1429C81.4973 10.5088 82.0228 9.98333 82.7294 9.5666C83.436 9.14987 84.3148 8.94151 85.3657 8.94151C87.3225 8.94151 88.7358 9.68438 89.6055 11.1701C90.8013 9.68438 92.3958 8.94151 94.3888 8.94151C96.0376 8.94151 97.3059 9.45789 98.1937 10.4907C99.0816 11.5053 99.5255 12.8461 99.5255 14.513V23.3731H96.2913V14.9207C96.2913 12.7827 95.4035 11.7137 93.6278 11.7137C92.6494 11.7137 91.8703 12.0308 91.2905 12.6649C90.7288 13.2809 90.448 14.1506 90.448 15.274Z",fill:"currentColor"}),_.createElement("path",{d:"M115.61 17.258H104.874C105.001 18.3814 105.409 19.2782 106.097 19.9486C106.786 20.6009 107.692 20.927 108.815 20.927C109.558 20.927 110.228 20.7459 110.826 20.3835C111.424 20.0211 111.85 19.5319 112.104 18.9159H115.365C114.93 20.3472 114.115 21.5068 112.919 22.3947C111.741 23.2644 110.346 23.6992 108.734 23.6992C106.632 23.6992 104.929 23.0016 103.624 21.6065C102.338 20.2114 101.694 18.4448 101.694 16.3068C101.694 14.2231 102.347 12.4747 103.651 11.0614C104.956 9.64814 106.641 8.94151 108.706 8.94151C110.772 8.94151 112.439 9.63908 113.707 11.0342C114.994 12.4112 115.637 14.1506 115.637 16.2524L115.61 17.258ZM108.706 11.5778C107.692 11.5778 106.849 11.8767 106.179 12.4747C105.508 13.0726 105.092 13.8698 104.929 14.8663H112.43C112.285 13.8698 111.886 13.0726 111.234 12.4747C110.582 11.8767 109.739 11.5778 108.706 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M120.906 9.26764V11.1429C121.232 10.5269 121.767 10.0105 122.51 9.59378C123.271 9.15893 124.186 8.94151 125.255 8.94151C126.922 8.94151 128.208 9.44883 129.114 10.4635C130.038 11.4781 130.5 12.828 130.5 14.513V23.3731H127.266V14.9207C127.266 13.9242 127.03 13.1451 126.559 12.5834C126.106 12.0036 125.409 11.7137 124.467 11.7137C123.434 11.7137 122.619 12.0217 122.021 12.6377C121.441 13.2538 121.151 14.1053 121.151 15.1925V23.3731H117.917V9.26764H120.906Z",fill:"currentColor"}),_.createElement("path",{d:"M139.946 20.4922V23.2915C139.547 23.4003 138.985 23.4546 138.261 23.4546C135.507 23.4546 134.13 22.0685 134.13 19.2964V11.8496H131.982V9.26764H134.13V5.5986H137.364V9.26764H140V11.8496H137.364V18.9702C137.364 20.0755 137.889 20.6281 138.94 20.6281L139.946 20.4922Z",fill:"currentColor"}),_.createElement("path",{d:"M148.304 20.864C146.768 19.184 146 17.056 146 14.48C146 11.904 146.768 9.784 148.304 8.12C149.856 6.44 151.896 5.6 154.424 5.6C156.504 5.6 158.264 6.176 159.704 7.328C161.144 8.48 162.064 10.024 162.464 11.96H160.616C160.28 10.52 159.552 9.376 158.432 8.528C157.312 7.68 155.976 7.256 154.424 7.256C152.44 7.256 150.84 7.92 149.624 9.248C148.424 10.576 147.824 12.32 147.824 14.48C147.824 16.64 148.424 18.384 149.624 19.712C150.84 21.04 152.44 21.704 154.424 21.704C155.976 21.704 157.312 21.28 158.432 20.432C159.552 19.584 160.28 18.44 160.616 17H162.464C162.064 18.936 161.144 20.48 159.704 21.632C158.264 22.784 156.504 23.36 154.424 23.36C151.896 23.36 149.856 22.528 148.304 20.864Z",fill:"currentColor"}),_.createElement("path",{d:"M173.63 17.192C171.438 17.192 169.942 17.24 169.142 17.336C168.358 17.416 167.782 17.552 167.414 17.744C166.758 18.112 166.43 18.704 166.43 19.52C166.43 21.088 167.358 21.872 169.214 21.872C170.638 21.872 171.726 21.552 172.478 20.912C173.246 20.272 173.63 19.416 173.63 18.344V17.192ZM169.022 23.288C167.63 23.288 166.566 22.952 165.83 22.28C165.11 21.592 164.75 20.688 164.75 19.568C164.75 18.832 164.942 18.176 165.326 17.6C165.726 17.024 166.27 16.6 166.958 16.328C167.534 16.104 168.278 15.96 169.19 15.896C170.102 15.816 171.582 15.776 173.63 15.776V14.984C173.63 12.968 172.478 11.96 170.174 11.96C168.19 11.96 167.038 12.768 166.718 14.384H165.062C165.238 13.2 165.742 12.256 166.574 11.552C167.422 10.848 168.646 10.496 170.246 10.496C171.958 10.496 173.23 10.896 174.062 11.696C174.91 12.496 175.334 13.6 175.334 15.008V23H173.702V21.224C172.854 22.6 171.294 23.288 169.022 23.288Z",fill:"currentColor"}),_.createElement("path",{d:"M179.418 20.312V5H181.122V20.12C181.122 20.616 181.202 20.96 181.362 21.152C181.538 21.344 181.85 21.44 182.298 21.44L182.778 21.392V22.952C182.506 23 182.21 23.024 181.89 23.024C180.242 23.024 179.418 22.12 179.418 20.312Z",fill:"currentColor"}),_.createElement("path",{d:"M185.582 20.312V5H187.286V20.12C187.286 20.616 187.366 20.96 187.526 21.152C187.702 21.344 188.014 21.44 188.462 21.44L188.942 21.392V22.952C188.67 23 188.374 23.024 188.054 23.024C186.406 23.024 185.582 22.12 185.582 20.312Z",fill:"currentColor"}),_.createElement("path",{d:"M201 10C201 5.58172 204.582 2 209 2H252C256.418 2 260 5.58172 260 10V20C260 24.4183 256.418 28 252 28H209C204.582 28 201 24.4183 201 20V10Z",fill:"#368BD6"}),_.createElement("path",{d:"M212.076 20H216.492C218.99 20 220.215 18.7269 220.215 17.0277C220.215 15.3764 219.043 14.407 217.882 14.3484V14.2418C218.947 13.9915 219.789 13.2457 219.789 11.9194C219.789 10.2947 218.617 9.09091 216.252 9.09091H212.076V20ZM214.052 18.3487V15.1527H216.231C217.451 15.1527 218.207 15.8984 218.207 16.8732C218.207 17.7415 217.61 18.3487 216.178 18.3487H214.052ZM214.052 13.7305V10.7209H216.05C217.211 10.7209 217.813 11.3335 217.813 12.1751C217.813 13.1339 217.035 13.7305 216.007 13.7305H214.052ZM221.934 20H229.072V18.3434H223.911V15.3658H228.662V13.7092H223.911V10.7475H229.03V9.09091H221.934V20ZM230.566 10.7475H233.938V20H235.898V10.7475H239.27V9.09091H230.566V10.7475ZM241.031 20L241.931 17.31H246.032L246.938 20H249.047L245.201 9.09091H242.762L238.921 20H241.031ZM242.464 15.7227L243.939 11.3281H244.024L245.5 15.7227H242.464Z",fill:"white"})),t9e=_.forwardRef(e9e);var Lp=(t=>(t.XS="xs",t.SM="sm",t.MD="md",t.LG="lg",t.XL="xl",t))(Lp||{});const n9e=new Map([["xs",22],["sm",32],["md",36],["lg",42],["xl",90]]);function r9e(t,e,n=96){const r=Math.floor(n*window.devicePixelRatio),i=Math.floor(n*window.devicePixelRatio),s=n<=96?"crop":"scale";return e?t.mxcUrlToHttp(e,r,i,s,!1,!0,!0):null}const Op=({className:t,id:e,name:n,src:r,size:i="md",style:s,...o})=>{const a=r0(),c=_.useMemo(()=>Object.values(Lp).includes(i)?n9e.get(i):i,[i]),[l,d]=_.useState(void 0);return _.useEffect(()=>{if(a?.state!=="valid")return;const{authenticated:h,supportedFeatures:m}=a,g=h?.client;if(!g||!r||!c||!m.thumbnails)return;const y=g.getAccessToken();if(!y)return;const v=r9e(g,r,c);if(!v){d(void 0);return}let w;return fetch(v,{headers:{Authorization:`Bearer ${y}`}}).then(async S=>S.blob()).then(S=>{w=URL.createObjectURL(S),d(w)}).catch(S=>{d(void 0)}),()=>{w&&URL.revokeObjectURL(w)}},[a,r,c]),E.jsx(l5e,{className:t,id:e,name:n,size:`${c}px`,src:l,style:s,...o})},i9e="_lock_zf62g_8",s9e={lock:i9e},o9e=({encrypted:t})=>{const{t:e}=We(),n=t?C8e:w8e,r=e(t?"common.encrypted":"common.unencrypted");return E.jsx(qi,{label:r,placement:"right",isTriggerInteractive:!1,children:E.jsx(n,{width:16,height:16,className:s9e.lock,"data-encrypted":t})})};function YT(t){const e=_.useMemo(()=>window.matchMedia(t),[t]),n=_.useCallback(i=>(e.addEventListener("change",i),()=>e.removeEventListener("change",i)),[e]),r=_.useCallback(()=>e.matches,[e]);return _.useSyncExternalStore(n,r)}const a9e="_banner_sye6n_8",c9e={banner:a9e},l9e=({children:t,className:e,...n})=>{const{t:r}=We(),i=r0();let s=!1;return i?.state==="valid"&&(s=i.disconnected),E.jsx(E.Fragment,{children:s&&E.jsxs("div",{className:Oe(c9e.banner,e),...n,children:[t,r("disconnected_banner")]})})},qu=({ref:t,children:e,className:n,disconnectedBanner:r=!0,...i})=>E.jsxs(E.Fragment,{children:[E.jsx("header",{ref:t,className:Oe(ua.header,n),...i,children:e}),r&&E.jsx(l9e,{})]});qu.displayName="Header";const jf=({children:t,className:e,hideMobile:n,...r})=>E.jsx("div",{className:Oe(ua.nav,ua.leftNav,{[ua.hideMobile]:n},e),...r,children:t}),Ff=({children:t,className:e,hideMobile:n,...r})=>E.jsx("div",{className:Oe(ua.nav,ua.rightNav,{[ua.hideMobile]:n},e),...r,children:t}),fp=({className:t})=>{const{t:e}=We();return E.jsx(yT,{className:Oe(ua.headerLogo,t),to:"/","aria-label":e("header_label"),children:E.jsx(t9e,{})})},vae=({id:t,name:e,avatarUrl:n,encrypted:r,participantCount:i})=>{const{t:s}=We(),o=YT("(max-width: 550px)")?"sm":"lg";return E.jsxs("div",{className:ua.roomHeaderInfo,"data-size":o,children:[E.jsx(Op,{className:ua.roomAvatar,id:t,name:e,size:o==="sm"?Lp.SM:56,src:n??void 0}),E.jsxs("div",{className:ua.nameLine,children:[E.jsx(gl,{type:o==="sm"?"body":"heading",size:o==="sm"?"lg":"md",weight:"semibold","data-testid":"roomHeader_roomName",children:e}),E.jsx(o9e,{encrypted:r})]}),(i??0)>0&&E.jsxs("div",{className:ua.participantsLine,children:[E.jsx(oae,{width:20,height:20,"aria-label":s("header_participants_label")}),E.jsx(an,{as:"span",size:"sm",weight:"medium","data-testid":"roomHeader_participants_count",children:s("participant_count",{count:i??0})})]})]})},u9e="_page_fvtgn_8",d9e="_container_fvtgn_20",f9e="_content_fvtgn_28",lx={page:u9e,container:d9e,content:f9e};var yae=typeof global=="object"&&global&&global.Object===Object&&global,h9e=typeof self=="object"&&self&&self.Object===Object&&self,uc=yae||h9e||Function("return this")(),wf=uc.Symbol,bae=Object.prototype,p9e=bae.hasOwnProperty,m9e=bae.toString,j1=wf?wf.toStringTag:void 0;function g9e(t){var e=p9e.call(t,j1),n=t[j1];try{t[j1]=void 0;var r=!0}catch{}var i=m9e.call(t);return r&&(e?t[j1]=n:delete t[j1]),i}var v9e=Object.prototype,y9e=v9e.toString;function b9e(t){return y9e.call(t)}var _9e="[object Null]",S9e="[object Undefined]",Zq=wf?wf.toStringTag:void 0;function Mp(t){return t==null?t===void 0?S9e:_9e:Zq&&Zq in Object(t)?g9e(t):b9e(t)}function Cf(t){return t!=null&&typeof t=="object"}var E9e="[object Symbol]";function XT(t){return typeof t=="symbol"||Cf(t)&&Mp(t)==E9e}function _ae(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var oc=Array.isArray,eG=wf?wf.prototype:void 0,tG=eG?eG.toString:void 0;function Sae(t){if(typeof t=="string")return t;if(oc(t))return _ae(t,Sae)+"";if(XT(t))return tG?tG.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var w9e=/\s/;function C9e(t){for(var e=t.length;e--&&w9e.test(t.charAt(e)););return e}var T9e=/^\s+/;function R9e(t){return t&&t.slice(0,C9e(t)+1).replace(T9e,"")}function Zs(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var nG=NaN,I9e=/^[-+]0x[0-9a-f]+$/i,k9e=/^0b[01]+$/i,x9e=/^0o[0-7]+$/i,A9e=parseInt;function rG(t){if(typeof t=="number")return t;if(XT(t))return nG;if(Zs(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Zs(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=R9e(t);var n=k9e.test(t);return n||x9e.test(t)?A9e(t.slice(2),n?2:8):I9e.test(t)?nG:+t}function n8(t){return t}var P9e="[object AsyncFunction]",L9e="[object Function]",O9e="[object GeneratorFunction]",M9e="[object Proxy]";function r8(t){if(!Zs(t))return!1;var e=Mp(t);return e==L9e||e==O9e||e==P9e||e==M9e}var ux=uc["__core-js_shared__"],iG=function(){var t=/[^.]+$/.exec(ux&&ux.keys&&ux.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function D9e(t){return!!iG&&iG in t}var N9e=Function.prototype,U9e=N9e.toString;function Dp(t){if(t!=null){try{return U9e.call(t)}catch{}try{return t+""}catch{}}return""}var j9e=/[\\^$.*+?()[\]{}|]/g,F9e=/^\[object .+?Constructor\]$/,$9e=Function.prototype,B9e=Object.prototype,H9e=$9e.toString,V9e=B9e.hasOwnProperty,q9e=RegExp("^"+H9e.call(V9e).replace(j9e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function G9e(t){if(!Zs(t)||D9e(t))return!1;var e=r8(t)?q9e:F9e;return e.test(Dp(t))}function K9e(t,e){return t?.[e]}function Np(t,e){var n=K9e(t,e);return G9e(n)?n:void 0}var XP=Np(uc,"WeakMap"),sG=Object.create,z9e=function(){function t(){}return function(e){if(!Zs(e))return{};if(sG)return sG(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function W9e(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Y9e(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var X9e=800,J9e=16,Q9e=Date.now;function Z9e(t){var e=0,n=0;return function(){var r=Q9e(),i=J9e-(r-n);if(n=r,i>0){if(++e>=X9e)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function eDe(t){return function(){return t}}var XC=function(){try{var t=Np(Object,"defineProperty");return t({},"",{}),t}catch{}}(),tDe=XC?function(t,e){return XC(t,"toString",{configurable:!0,enumerable:!1,value:eDe(e),writable:!0})}:n8,nDe=Z9e(tDe),rDe=9007199254740991,iDe=/^(?:0|[1-9]\d*)$/;function JT(t,e){var n=typeof t;return e=e??rDe,!!e&&(n=="number"||n!="symbol"&&iDe.test(t))&&t>-1&&t%1==0&&t<e}function i8(t,e,n){e=="__proto__"&&XC?XC(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function N_(t,e){return t===e||t!==t&&e!==e}var sDe=Object.prototype,oDe=sDe.hasOwnProperty;function Eae(t,e,n){var r=t[e];(!(oDe.call(t,e)&&N_(r,n))||n===void 0&&!(e in t))&&i8(t,e,n)}function aDe(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?i8(n,a,c):Eae(n,a,c)}return n}var oG=Math.max;function cDe(t,e,n){return e=oG(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=oG(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),W9e(t,this,a)}}function lDe(t,e){return nDe(cDe(t,e,n8),t+"")}var uDe=9007199254740991;function s8(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=uDe}function QT(t){return t!=null&&s8(t.length)&&!r8(t)}function dDe(t,e,n){if(!Zs(n))return!1;var r=typeof e;return(r=="number"?QT(n)&&JT(e,n.length):r=="string"&&e in n)?N_(n[e],t):!1}function fDe(t){return lDe(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&dDe(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var hDe=Object.prototype;function o8(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||hDe;return t===n}function pDe(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var mDe="[object Arguments]";function aG(t){return Cf(t)&&Mp(t)==mDe}var wae=Object.prototype,gDe=wae.hasOwnProperty,vDe=wae.propertyIsEnumerable,JC=aG(function(){return arguments}())?aG:function(t){return Cf(t)&&gDe.call(t,"callee")&&!vDe.call(t,"callee")};function yDe(){return!1}var Cae=typeof exports=="object"&&exports&&!exports.nodeType&&exports,cG=Cae&&typeof module=="object"&&module&&!module.nodeType&&module,bDe=cG&&cG.exports===Cae,lG=bDe?uc.Buffer:void 0,_De=lG?lG.isBuffer:void 0,QC=_De||yDe,SDe="[object Arguments]",EDe="[object Array]",wDe="[object Boolean]",CDe="[object Date]",TDe="[object Error]",RDe="[object Function]",IDe="[object Map]",kDe="[object Number]",xDe="[object Object]",ADe="[object RegExp]",PDe="[object Set]",LDe="[object String]",ODe="[object WeakMap]",MDe="[object ArrayBuffer]",DDe="[object DataView]",NDe="[object Float32Array]",UDe="[object Float64Array]",jDe="[object Int8Array]",FDe="[object Int16Array]",$De="[object Int32Array]",BDe="[object Uint8Array]",HDe="[object Uint8ClampedArray]",VDe="[object Uint16Array]",qDe="[object Uint32Array]",Vn={};Vn[NDe]=Vn[UDe]=Vn[jDe]=Vn[FDe]=Vn[$De]=Vn[BDe]=Vn[HDe]=Vn[VDe]=Vn[qDe]=!0;Vn[SDe]=Vn[EDe]=Vn[MDe]=Vn[wDe]=Vn[DDe]=Vn[CDe]=Vn[TDe]=Vn[RDe]=Vn[IDe]=Vn[kDe]=Vn[xDe]=Vn[ADe]=Vn[PDe]=Vn[LDe]=Vn[ODe]=!1;function GDe(t){return Cf(t)&&s8(t.length)&&!!Vn[Mp(t)]}function KDe(t){return function(e){return t(e)}}var Tae=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Hy=Tae&&typeof module=="object"&&module&&!module.nodeType&&module,zDe=Hy&&Hy.exports===Tae,dx=zDe&&yae.process,uG=function(){try{var t=Hy&&Hy.require&&Hy.require("util").types;return t||dx&&dx.binding&&dx.binding("util")}catch{}}(),dG=uG&&uG.isTypedArray,a8=dG?KDe(dG):GDe,WDe=Object.prototype,YDe=WDe.hasOwnProperty;function Rae(t,e){var n=oc(t),r=!n&&JC(t),i=!n&&!r&&QC(t),s=!n&&!r&&!i&&a8(t),o=n||r||i||s,a=o?pDe(t.length,String):[],c=a.length;for(var l in t)(e||YDe.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||JT(l,c)))&&a.push(l);return a}function Iae(t,e){return function(n){return t(e(n))}}var XDe=Iae(Object.keys,Object),JDe=Object.prototype,QDe=JDe.hasOwnProperty;function ZDe(t){if(!o8(t))return XDe(t);var e=[];for(var n in Object(t))QDe.call(t,n)&&n!="constructor"&&e.push(n);return e}function kae(t){return QT(t)?Rae(t):ZDe(t)}function eNe(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var tNe=Object.prototype,nNe=tNe.hasOwnProperty;function rNe(t){if(!Zs(t))return eNe(t);var e=o8(t),n=[];for(var r in t)r=="constructor"&&(e||!nNe.call(t,r))||n.push(r);return n}function c8(t){return QT(t)?Rae(t,!0):rNe(t)}var iNe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,sNe=/^\w*$/;function l8(t,e){if(oc(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||XT(t)?!0:sNe.test(t)||!iNe.test(t)||e!=null&&t in Object(e)}var Mb=Np(Object,"create");function oNe(){this.__data__=Mb?Mb(null):{},this.size=0}function aNe(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var cNe="__lodash_hash_undefined__",lNe=Object.prototype,uNe=lNe.hasOwnProperty;function dNe(t){var e=this.__data__;if(Mb){var n=e[t];return n===cNe?void 0:n}return uNe.call(e,t)?e[t]:void 0}var fNe=Object.prototype,hNe=fNe.hasOwnProperty;function pNe(t){var e=this.__data__;return Mb?e[t]!==void 0:hNe.call(e,t)}var mNe="__lodash_hash_undefined__";function gNe(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Mb&&e===void 0?mNe:e,this}function hp(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}hp.prototype.clear=oNe;hp.prototype.delete=aNe;hp.prototype.get=dNe;hp.prototype.has=pNe;hp.prototype.set=gNe;function vNe(){this.__data__=[],this.size=0}function ZT(t,e){for(var n=t.length;n--;)if(N_(t[n][0],e))return n;return-1}var yNe=Array.prototype,bNe=yNe.splice;function _Ne(t){var e=this.__data__,n=ZT(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():bNe.call(e,n,1),--this.size,!0}function SNe(t){var e=this.__data__,n=ZT(e,t);return n<0?void 0:e[n][1]}function ENe(t){return ZT(this.__data__,t)>-1}function wNe(t,e){var n=this.__data__,r=ZT(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Gu(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Gu.prototype.clear=vNe;Gu.prototype.delete=_Ne;Gu.prototype.get=SNe;Gu.prototype.has=ENe;Gu.prototype.set=wNe;var Db=Np(uc,"Map");function CNe(){this.size=0,this.__data__={hash:new hp,map:new(Db||Gu),string:new hp}}function TNe(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function eR(t,e){var n=t.__data__;return TNe(e)?n[typeof e=="string"?"string":"hash"]:n.map}function RNe(t){var e=eR(this,t).delete(t);return this.size-=e?1:0,e}function INe(t){return eR(this,t).get(t)}function kNe(t){return eR(this,t).has(t)}function xNe(t,e){var n=eR(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Ku(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ku.prototype.clear=CNe;Ku.prototype.delete=RNe;Ku.prototype.get=INe;Ku.prototype.has=kNe;Ku.prototype.set=xNe;var ANe="Expected a function";function u8(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(ANe);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(u8.Cache||Ku),n}u8.Cache=Ku;var PNe=500;function LNe(t){var e=u8(t,function(r){return n.size===PNe&&n.clear(),r}),n=e.cache;return e}var ONe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,MNe=/\\(\\)?/g,DNe=LNe(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(ONe,function(n,r,i,s){e.push(i?s.replace(MNe,"$1"):r||n)}),e});function NNe(t){return t==null?"":Sae(t)}function tR(t,e){return oc(t)?t:l8(t,e)?[t]:DNe(NNe(t))}function U_(t){if(typeof t=="string"||XT(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function d8(t,e){e=tR(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[U_(e[n++])];return n&&n==r?t:void 0}function UNe(t,e,n){var r=t==null?void 0:d8(t,e);return r===void 0?n:r}function xae(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var f8=Iae(Object.getPrototypeOf,Object),jNe="[object Object]",FNe=Function.prototype,$Ne=Object.prototype,Aae=FNe.toString,BNe=$Ne.hasOwnProperty,HNe=Aae.call(Object);function VNe(t){if(!Cf(t)||Mp(t)!=jNe)return!1;var e=f8(t);if(e===null)return!0;var n=BNe.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&Aae.call(n)==HNe}function qNe(){this.__data__=new Gu,this.size=0}function GNe(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function KNe(t){return this.__data__.get(t)}function zNe(t){return this.__data__.has(t)}var WNe=200;function YNe(t,e){var n=this.__data__;if(n instanceof Gu){var r=n.__data__;if(!Db||r.length<WNe-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ku(r)}return n.set(t,e),this.size=n.size,this}function el(t){var e=this.__data__=new Gu(t);this.size=e.size}el.prototype.clear=qNe;el.prototype.delete=GNe;el.prototype.get=KNe;el.prototype.has=zNe;el.prototype.set=YNe;var Pae=typeof exports=="object"&&exports&&!exports.nodeType&&exports,fG=Pae&&typeof module=="object"&&module&&!module.nodeType&&module,XNe=fG&&fG.exports===Pae,hG=XNe?uc.Buffer:void 0;hG&&hG.allocUnsafe;function JNe(t,e){return t.slice()}function QNe(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Lae(){return[]}var ZNe=Object.prototype,eUe=ZNe.propertyIsEnumerable,pG=Object.getOwnPropertySymbols,Oae=pG?function(t){return t==null?[]:(t=Object(t),QNe(pG(t),function(e){return eUe.call(t,e)}))}:Lae,tUe=Object.getOwnPropertySymbols,nUe=tUe?function(t){for(var e=[];t;)xae(e,Oae(t)),t=f8(t);return e}:Lae;function Mae(t,e,n){var r=e(t);return oc(t)?r:xae(r,n(t))}function mG(t){return Mae(t,kae,Oae)}function rUe(t){return Mae(t,c8,nUe)}var JP=Np(uc,"DataView"),QP=Np(uc,"Promise"),ZP=Np(uc,"Set"),gG="[object Map]",iUe="[object Object]",vG="[object Promise]",yG="[object Set]",bG="[object WeakMap]",_G="[object DataView]",sUe=Dp(JP),oUe=Dp(Db),aUe=Dp(QP),cUe=Dp(ZP),lUe=Dp(XP),Ud=Mp;(JP&&Ud(new JP(new ArrayBuffer(1)))!=_G||Db&&Ud(new Db)!=gG||QP&&Ud(QP.resolve())!=vG||ZP&&Ud(new ZP)!=yG||XP&&Ud(new XP)!=bG)&&(Ud=function(t){var e=Mp(t),n=e==iUe?t.constructor:void 0,r=n?Dp(n):"";if(r)switch(r){case sUe:return _G;case oUe:return gG;case aUe:return vG;case cUe:return yG;case lUe:return bG}return e});var ZC=uc.Uint8Array;function uUe(t){var e=new t.constructor(t.byteLength);return new ZC(e).set(new ZC(t)),e}function dUe(t,e){var n=uUe(t.buffer);return new t.constructor(n,t.byteOffset,t.length)}function fUe(t){return typeof t.constructor=="function"&&!o8(t)?z9e(f8(t)):{}}var hUe="__lodash_hash_undefined__";function pUe(t){return this.__data__.set(t,hUe),this}function mUe(t){return this.__data__.has(t)}function e3(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Ku;++e<n;)this.add(t[e])}e3.prototype.add=e3.prototype.push=pUe;e3.prototype.has=mUe;function gUe(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function vUe(t,e){return t.has(e)}var yUe=1,bUe=2;function Dae(t,e,n,r,i,s){var o=n&yUe,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),d=s.get(e);if(l&&d)return l==e&&d==t;var h=-1,m=!0,g=n&bUe?new e3:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var y=t[h],v=e[h];if(r)var w=o?r(v,y,h,e,t,s):r(y,v,h,t,e,s);if(w!==void 0){if(w)continue;m=!1;break}if(g){if(!gUe(e,function(S,R){if(!vUe(g,R)&&(y===S||i(y,S,n,r,s)))return g.push(R)})){m=!1;break}}else if(!(y===v||i(y,v,n,r,s))){m=!1;break}}return s.delete(t),s.delete(e),m}function _Ue(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function SUe(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var EUe=1,wUe=2,CUe="[object Boolean]",TUe="[object Date]",RUe="[object Error]",IUe="[object Map]",kUe="[object Number]",xUe="[object RegExp]",AUe="[object Set]",PUe="[object String]",LUe="[object Symbol]",OUe="[object ArrayBuffer]",MUe="[object DataView]",SG=wf?wf.prototype:void 0,fx=SG?SG.valueOf:void 0;function DUe(t,e,n,r,i,s,o){switch(n){case MUe:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case OUe:return!(t.byteLength!=e.byteLength||!s(new ZC(t),new ZC(e)));case CUe:case TUe:case kUe:return N_(+t,+e);case RUe:return t.name==e.name&&t.message==e.message;case xUe:case PUe:return t==e+"";case IUe:var a=_Ue;case AUe:var c=r&EUe;if(a||(a=SUe),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=wUe,o.set(t,e);var d=Dae(a(t),a(e),r,i,s,o);return o.delete(t),d;case LUe:if(fx)return fx.call(t)==fx.call(e)}return!1}var NUe=1,UUe=Object.prototype,jUe=UUe.hasOwnProperty;function FUe(t,e,n,r,i,s){var o=n&NUe,a=mG(t),c=a.length,l=mG(e),d=l.length;if(c!=d&&!o)return!1;for(var h=c;h--;){var m=a[h];if(!(o?m in e:jUe.call(e,m)))return!1}var g=s.get(t),y=s.get(e);if(g&&y)return g==e&&y==t;var v=!0;s.set(t,e),s.set(e,t);for(var w=o;++h<c;){m=a[h];var S=t[m],R=e[m];if(r)var x=o?r(R,S,m,e,t,s):r(S,R,m,t,e,s);if(!(x===void 0?S===R||i(S,R,n,r,s):x)){v=!1;break}w||(w=m=="constructor")}if(v&&!w){var T=t.constructor,I=e.constructor;T!=I&&"constructor"in t&&"constructor"in e&&!(typeof T=="function"&&T instanceof T&&typeof I=="function"&&I instanceof I)&&(v=!1)}return s.delete(t),s.delete(e),v}var $Ue=1,EG="[object Arguments]",wG="[object Array]",oE="[object Object]",BUe=Object.prototype,CG=BUe.hasOwnProperty;function HUe(t,e,n,r,i,s){var o=oc(t),a=oc(e),c=o?wG:Ud(t),l=a?wG:Ud(e);c=c==EG?oE:c,l=l==EG?oE:l;var d=c==oE,h=l==oE,m=c==l;if(m&&QC(t)){if(!QC(e))return!1;o=!0,d=!1}if(m&&!d)return s||(s=new el),o||a8(t)?Dae(t,e,n,r,i,s):DUe(t,e,c,n,r,i,s);if(!(n&$Ue)){var g=d&&CG.call(t,"__wrapped__"),y=h&&CG.call(e,"__wrapped__");if(g||y){var v=g?t.value():t,w=y?e.value():e;return s||(s=new el),i(v,w,n,r,s)}}return m?(s||(s=new el),FUe(t,e,n,r,i,s)):!1}function h8(t,e,n,r,i){return t===e?!0:t==null||e==null||!Cf(t)&&!Cf(e)?t!==t&&e!==e:HUe(t,e,n,r,h8,i)}var VUe=1,qUe=2;function GUe(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var d=new el,h;if(!(h===void 0?h8(l,c,VUe|qUe,r,d):h))return!1}}return!0}function Nae(t){return t===t&&!Zs(t)}function KUe(t){for(var e=kae(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Nae(i)]}return e}function Uae(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function zUe(t){var e=KUe(t);return e.length==1&&e[0][2]?Uae(e[0][0],e[0][1]):function(n){return n===t||GUe(n,t,e)}}function WUe(t,e){return t!=null&&e in Object(t)}function YUe(t,e,n){e=tR(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=U_(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&s8(i)&&JT(o,i)&&(oc(t)||JC(t)))}function XUe(t,e){return t!=null&&YUe(t,e,WUe)}var JUe=1,QUe=2;function ZUe(t,e){return l8(t)&&Nae(e)?Uae(U_(t),e):function(n){var r=UNe(n,t);return r===void 0&&r===e?XUe(n,t):h8(e,r,JUe|QUe)}}function eje(t){return function(e){return e?.[t]}}function tje(t){return function(e){return d8(e,t)}}function nje(t){return l8(t)?eje(U_(t)):tje(t)}function rje(t){return typeof t=="function"?t:t==null?n8:typeof t=="object"?oc(t)?ZUe(t[0],t[1]):zUe(t):nje(t)}function ije(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var sje=ije(),hx=function(){return uc.Date.now()},oje="Expected a function",aje=Math.max,cje=Math.min;function lje(t,e,n){var r,i,s,o,a,c,l=0,d=!1,h=!1,m=!0;if(typeof t!="function")throw new TypeError(oje);e=rG(e)||0,Zs(n)&&(d=!!n.leading,h="maxWait"in n,s=h?aje(rG(n.maxWait)||0,e):s,m="trailing"in n?!!n.trailing:m);function g(k){var A=r,O=i;return r=i=void 0,l=k,o=t.apply(O,A),o}function y(k){return l=k,a=setTimeout(S,e),d?g(k):o}function v(k){var A=k-c,O=k-l,D=e-A;return h?cje(D,s-O):D}function w(k){var A=k-c,O=k-l;return c===void 0||A>=e||A<0||h&&O>=s}function S(){var k=hx();if(w(k))return R(k);a=setTimeout(S,v(k))}function R(k){return a=void 0,m&&r?g(k):(r=i=void 0,o)}function x(){a!==void 0&&clearTimeout(a),l=0,r=c=i=a=void 0}function T(){return a===void 0?o:R(hx())}function I(){var k=hx(),A=w(k);if(r=arguments,i=this,c=k,A){if(a===void 0)return y(c);if(h)return clearTimeout(a),a=setTimeout(S,e),g(c)}return a===void 0&&(a=setTimeout(S,e)),o}return I.cancel=x,I.flush=T,I}function eL(t,e,n){(n!==void 0&&!N_(t[e],n)||n===void 0&&!(e in t))&&i8(t,e,n)}function uje(t){return Cf(t)&&QT(t)}function tL(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}function dje(t){return aDe(t,c8(t))}function fje(t,e,n,r,i,s,o){var a=tL(t,n),c=tL(e,n),l=o.get(c);if(l){eL(t,n,l);return}var d=s?s(a,c,n+"",t,e,o):void 0,h=d===void 0;if(h){var m=oc(c),g=!m&&QC(c),y=!m&&!g&&a8(c);d=c,m||g||y?oc(a)?d=a:uje(a)?d=Y9e(a):g?(h=!1,d=JNe(c)):y?(h=!1,d=dUe(c)):d=[]:VNe(c)||JC(c)?(d=a,JC(a)?d=dje(a):(!Zs(a)||r8(a))&&(d=fUe(c))):h=!1}h&&(o.set(c,d),i(d,c,r,s,o),o.delete(c)),eL(t,n,d)}function jae(t,e,n,r,i){t!==e&&sje(e,function(s,o){if(i||(i=new el),Zs(s))fje(t,e,o,n,jae,r,i);else{var a=r?r(tL(t,o),s,o+"",t,e,i):void 0;a===void 0&&(a=s),eL(t,o,a)}},c8)}var hje=fDe(function(t,e,n){jae(t,e,n)});function pje(t,e,n,r){if(!Zs(t))return t;e=tR(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=U_(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var d=a[c];l=void 0,l===void 0&&(l=Zs(d)?d:JT(e[i+1])?[]:{})}Eae(a,c,l),a=a[c]}return t}function mje(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=d8(t,o);n(a,o)&&pje(s,tR(o,t),a)}return s}function gje(t,e){if(t==null)return{};var n=_ae(rUe(t),function(r){return[r]});return e=rje(e),mje(t,n,function(r,i){return e(r,i[0])})}var vje="Expected a function";function yje(t,e,n){var r=!0,i=!0;if(typeof t!="function")throw new TypeError(vje);return Zs(n)&&(r="leading"in n?!1:r,i="trailing"in n?!0:i),lje(t,e,{leading:r,maxWait:e,trailing:i})}const nL={default_server_config:{"m.homeserver":{base_url:"http://localhost:8008",server_name:"localhost"}},features:{feature_use_device_session_member_events:!0},ssla:"https://static.element.io/legal/element-software-and-services-license-agreement-uk-1.pdf",media_devices:{enable_audio:!0,enable_video:!0},app_prompt:!0};function p8(t){return!(t.ok||t.url.startsWith("file:")&&t.status===0)}class sn{static get(){if(!this.internalInstance?.config)throw new Error("Config instance read before config got initialized");return this.internalInstance.config}static async init(){if(!sn.internalInstance?.initPromise){const e=new sn;sn.internalInstance=e;let n;window.location.pathname.endsWith("/room/")||window.location.pathname.endsWith("/room")?n=new URL("/config.json",window.location.href).href:n="config.json",sn.internalInstance.initPromise=bje(n).then(r=>{e.config=hje({},nL,r)})}return sn.internalInstance.initPromise}static initDefault(){sn.internalInstance=new sn,sn.internalInstance.config={...nL}}static defaultHomeserverUrl(){return Br().homeserver??sn.get().default_server_config?.["m.homeserver"].base_url}static defaultServerName(){const e=Br().homeserver;return e?new URL(e).hostname:sn.get().default_server_config?.["m.homeserver"].server_name}}async function bje(t){const e=await fetch(t);return p8(e)?nL:e.json()}var hn=(t=>(t[t.NONE=0]="NONE",t[t.PER_PARTICIPANT=1]="PER_PARTICIPANT",t[t.SHARED_KEY=2]="SHARED_KEY",t))(hn||{});let va;/android/i.test(navigator.userAgent)?va="android":/iPad|iPhone|iPod|Mac/.test(navigator.userAgent)&&"ontouchend"in document?va="ios":va="desktop";const _je=()=>{const{userAgent:t}=navigator;return t.includes("Firefox")};var Fae=(t=>(t.StartNewCall="start_call",t.JoinExistingCall="join_existing",t.StartNewCallDM="start_call_dm",t.StartNewCallDMVoice="start_call_dm_voice",t.JoinExistingCallDM="join_existing_dm",t.JoinExistingCallDMVoice="join_existing_dm_voice",t.Unknown="unknown",t))(Fae||{}),Nb=(t=>(t.None="none",t.Standard="standard",t.AppBar="app_bar",t))(Nb||{});function Sje(t,e){const n=t.indexOf("?"),r=e(new URLSearchParams(n===-1?"":t.substring(n)));return`${t.substring(0,n)}?${r.toString()}`}class $ae{constructor(e,n){this.queryParams=new URLSearchParams(e);const r=n.indexOf("?");this.fragmentParams=new URLSearchParams(r===-1?"":n.substring(r))}getParam(e){return this.fragmentParams.get(e)??this.queryParams.get(e)}getEnumParam(e,n){const r=this.getParam(e);if(r!==null&&Object.values(n).includes(r))return r}getAllParams(e){return[...this.fragmentParams.getAll(e),...this.queryParams.getAll(e)]}getFlagParam(e,n=!1){const r=this.getParam(e);return r===null?n:r!=="false"}getFlag(e){const n=this.getParam(e);return n!==null?n!=="false":void 0}}let F1={};const Br=(t=window.location.search,e=window.location.hash)=>{if(F1.search===t&&F1.hash===e&&F1.params)return F1.params;const n=Eje(t,e);return F1={search:t,hash:e,params:n},n},Eje=(t="",e="")=>{const n=new $ae(t,e),r=parseFloat(n.getParam("fontScale")??""),i=n.getParam("widgetId"),s=n.getParam("parentUrl"),o=!!i&&!!s,a=o?n.getEnumParam("intent",Fae)??"unknown":"unknown";let c={confineToRoom:!0,appPrompt:!1,preload:!1,header:va==="desktop"?"none":"app_bar",showControls:!0,hideScreensharing:!1,allowIceFallback:!0,perParticipantE2EE:!0,controlledAudioDevices:va!=="desktop",skipLobby:!0,returnToLobby:!1,sendNotificationType:"notification",autoLeaveWhenOthersLeft:!1,waitForCallPickup:!1};switch(a){case"start_call":c.skipLobby=!1,c.callIntent="video";break;case"join_existing":c.skipLobby=!1,c.callIntent="video";break;case"start_call_dm_voice":c.callIntent="audio";case"start_call_dm":c.skipLobby=!0,c.sendNotificationType="ring",c.autoLeaveWhenOthersLeft=!0,c.waitForCallPickup=!0,c.callIntent=c.callIntent??"video";break;case"join_existing_dm_voice":c.callIntent="audio";case"join_existing_dm":c.skipLobby=!0,c.autoLeaveWhenOthersLeft=!0,c.callIntent=c.callIntent??"video";break;default:c={confineToRoom:!1,appPrompt:!0,preload:!1,header:"standard",showControls:!0,hideScreensharing:!1,allowIceFallback:!1,perParticipantE2EE:!1,controlledAudioDevices:!1,skipLobby:!1,returnToLobby:!1,sendNotificationType:void 0,autoLeaveWhenOthersLeft:!1,waitForCallPickup:!1}}const l={};switch(va==="desktop"?"desktop":"mobile"){case"desktop":case"mobile":switch(a){case"start_call":case"join_existing":case"start_call_dm":case"join_existing_dm":l.defaultAudioEnabled=!0,l.defaultVideoEnabled=!0;break;case"start_call_dm_voice":case"join_existing_dm_voice":l.defaultAudioEnabled=!0,l.defaultVideoEnabled=!1;break}}const h={widgetId:i,parentUrl:s,roomId:n.getParam("roomId"),password:n.getParam("password"),userId:o?n.getParam("userId"):null,displayName:n.getParam("displayName"),deviceId:o?n.getParam("deviceId"):null,baseUrl:o?n.getParam("baseUrl"):null,lang:n.getParam("lang"),fonts:n.getAllParams("font"),fontScale:Number.isNaN(r)?null:r,theme:n.getParam("theme"),viaServers:o?null:n.getParam("viaServers"),homeserver:o?null:n.getParam("homeserver"),posthogApiHost:n.getParam("posthogApiHost"),posthogApiKey:n.getParam("posthogApiKey"),posthogUserId:n.getParam("posthogUserId")??n.getParam("analyticsID"),rageshakeSubmitUrl:n.getParam("rageshakeSubmitUrl"),sentryDsn:n.getParam("sentryDsn"),sentryEnvironment:n.getParam("sentryEnvironment"),e2eEnabled:n.getFlagParam("enableE2EE",!0)},m={confineToRoom:n.getFlag("confineToRoom"),appPrompt:n.getFlag("appPrompt"),preload:o?n.getFlag("preload"):void 0,header:n.getEnumParam("header",Nb),showControls:n.getFlag("showControls"),hideScreensharing:n.getFlag("hideScreensharing"),allowIceFallback:n.getFlag("allowIceFallback"),perParticipantE2EE:n.getFlag("perParticipantE2EE"),controlledAudioDevices:n.getFlag("controlledAudioDevices"),skipLobby:o?n.getFlag("skipLobby"):!1,returnToLobby:o?n.getFlag("returnToLobby"):!1,sendNotificationType:n.getEnumParam("sendNotificationType",["ring","notification"]),waitForCallPickup:n.getFlag("waitForCallPickup"),autoLeaveWhenOthersLeft:n.getFlag("autoLeave")};return M.info(`UrlParams: final set of url params
`,"intent:",a,`
properties:`,h,"configuration:",m,"intentAndPlatformDerivedConfiguration:",l),{...h,...c,...gje(m,g=>g!==void 0),...l}},no=()=>{const{search:t,hash:e}=rs();return _.useMemo(()=>Br(t,e),[t,e])};function wje(t,e,n){let r=null;t=t.substring(1);const i=t.split("/"),s=i[0]=="room",o=i.length>1;n===""||n.startsWith("#?")?(o&&s&&(r=i[1]),s||(r=i[0])):r=n,r=r?.split("?")[0]??null,r&&(r.length<=1?r=null:(r.startsWith("#")||(r=`#${r}`),r.includes(":")||(r=`${r}:${sn.defaultServerName()}`)));const a=new $ae(e,n);let c=a.getParam("roomId");return c!==null&&(c=c.replaceAll(/^[^ -~]+|[^ -~]+$/g,""),c.startsWith("!")&&c.includes("")||(c=null)),{roomAlias:r,roomId:c,viaServers:a.getAllParams("viaServers")}}const Cje=()=>{const{pathname:t,search:e,hash:n}=rs();return _.useMemo(()=>wje(t,e,n),[t,e,n])};function Tje(t,e,n){const r=new URLSearchParams;switch(e?.kind){case hn.SHARED_KEY:{const i=encodeURIComponent(e.secret);i!==e.secret&&M.info("Encoded call password used non URL-safe chars: buggy client?"),r.set("password",i);break}case hn.PER_PARTICIPANT:r.set("perParticipantE2EE","true");break}return r.set("roomId",t),r}const Rje="_rageshakeControl_65ekp_8",TG={rageshakeControl:Rje},RG=1024*1024*5,Ije=2*1e3,kje=3;class xje extends zX{constructor(){super(...arguments),this.logs="",this.log=(e,...n)=>{const r=new Date().toISOString();n=n.map(s=>s instanceof DOMException?s.message+` (${s.name} | ${s.code})`:s instanceof Error?s.message+(s.stack?`
${s.stack}`:""):typeof s=="object"?JSON.stringify(s,Dje()):s);let i=`${r} ${e} ${n.join(" ")}
`;i=i.replace(/token=[a-zA-Z0-9-]+/gm,"token=xxxxx"),this.logs+=i,this.emit("log")}}popLogs(){const e=this.logs;return this.logs="",e}peekLogs(){return this.logs}}class Aje{constructor(e,n){this.indexedDB=e,this.loggerInstance=n,this.index=0,this.onLoggerLog=()=>{this.db&&this.throttledFlush()},this.throttledFlush=yje(()=>this.flush,Ije,{leading:!1,trailing:!0}),this.flush=async()=>this.flushPromise?this.flushAgainPromise?this.flushAgainPromise:(this.flushAgainPromise=this.flushPromise.then(this.flush).then(()=>{this.flushAgainPromise=void 0}),this.flushAgainPromise):(this.flushPromise=new Promise((r,i)=>{if(!this.db){i(new Error("No connected database"));return}const s=this.loggerInstance.popLogs();if(s.length===0){r();return}const o=this.db.transaction(["logs","logslastmod"],"readwrite"),a=o.objectStore("logs");o.oncomplete=()=>{r()},o.onerror=l=>{M.error("Failed to flush logs : ",l),i(new Error("Failed to write logs: "+o?.error?.message))},a.add(this.generateLogEntry(s)),o.objectStore("logslastmod").put(this.generateLastModifiedTime())}).then(()=>{this.flushPromise=void 0}),this.flushPromise),this.id="instance-"+To(16),n.on("log",this.onLoggerLog),window.addEventListener("beforeunload",()=>{this.flush().catch(r=>M.error("Failed to flush logs before unload",r))})}async connect(){const e=this.indexedDB.open("logs");return new Promise((n,r)=>{e.onsuccess=()=>{this.db=e.result,n()},e.onerror=()=>{const i="Failed to open log database: "+e?.error?.name;M.error(i),r(new Error(i))},e.onupgradeneeded=()=>{const i=e.result,s=i.createObjectStore("logs",{keyPath:["id","index"]});s.createIndex("id","id",{unique:!1}),s.add(this.generateLogEntry(new Date+" ::: Log database was created.")),i.createObjectStore("logslastmod",{keyPath:"id"}).add(this.generateLastModifiedTime())}})}async consume(){const e=this.db;if(!e)return Promise.reject(new Error("No connected database"));async function n(l,d){const h=e.transaction("logs","readonly").objectStore("logs");return new Promise((m,g)=>{const y=h.index("id").openCursor(IDBKeyRange.only(l),"prev");let v="";y.onerror=()=>{g(new Error("Query failed: "+y?.error?.message))},y.onsuccess=()=>{const w=y.result;if(!w){m(v);return}v=w.value.lines+v,v.length>=d?m(v):w.continue()}})}async function r(){const l=e.transaction("logslastmod","readonly").objectStore("logslastmod");return Pje(l,void 0,d=>({id:d.value.id,ts:d.value.ts})).then(d=>d.sort((h,m)=>m.ts-h.ts).map(h=>h.id))}async function i(l){return new Promise((d,h)=>{const m=e.transaction(["logs","logslastmod"],"readwrite"),g=m.objectStore("logs"),y=g.index("id").openKeyCursor(IDBKeyRange.only(l));y.onsuccess=()=>{const w=y.result;w&&(g.delete(w.primaryKey),w.continue())},m.oncomplete=()=>{d()},m.onerror=()=>{h(new Error(`Failed to delete logs for '${l}' : ${m?.error?.message}`))},m.objectStore("logslastmod").delete(l)})}const s=await r();let o=[];const a=[];let c=0;for(let l=0;l<s.length;l++){const d=await n(s[l],RG-c);if(a.push({lines:d,id:s[l]}),c+=d.length,c>=RG){o=s.slice(l+1).map(h=>parseInt(h,10));break}}return o.length>0&&(M.log("Removing logs: ",o),Promise.all(o.map(async l=>i(l))).then(()=>{M.log(`Removed ${o.length} old logs.`)},l=>{M.error(l)})),a}generateLogEntry(e){return{id:this.id,lines:e,index:this.index++}}generateLastModifiedTime(){return{id:this.id,ts:Date.now()}}}async function Pje(t,e,n){const r=t.openCursor(e);return new Promise((i,s)=>{const o=[];r.onerror=()=>{s(new Error("Query failed: "+r?.error?.message))},r.onsuccess=()=>{const a=r.result;if(!a){i(o);return}o.push(n(a)),a.continue()}})}async function Lje(){return global.mx_rage_logger=new xje,Nje(M,global.mx_rage_logger.log),["trace","debug","info","warn","error"].forEach(t=>{const e=window.console[t];if(!e)return;const n=`${t.toUpperCase()} matrix_sdk`;window.console[t]=(...r)=>{e(...r),typeof r[0]=="string"&&r[0].startsWith(n)&&global.mx_rage_logger.log(m8[t],"matrix_sdk",...r)}}),Oje()}async function Oje(){if(global.mx_rage_initStoragePromise)return global.mx_rage_initStoragePromise;M.log("Configuring rageshake persistence...");let t;try{t=window.indexedDB}catch(e){M.warn("Could not get indexDB from window.",e)}return t?(global.mx_rage_store=new Aje(t,global.mx_rage_logger),global.mx_rage_initStoragePromise=global.mx_rage_store.connect(),global.mx_rage_initStoragePromise):(global.mx_rage_initStoragePromise=Promise.resolve(),global.mx_rage_initStoragePromise)}async function Mje(){if(!global.mx_rage_logger)throw new Error("No console logger, did you forget to call init()?");return global.mx_rage_store?(await global.mx_rage_store.flush(),global.mx_rage_store.consume()):[{lines:global.mx_rage_logger.peekLogs(),id:"-"}]}const Dje=()=>{const t=new WeakSet,e=new WeakMap;return function(n,r){if(typeof r=="object"&&r!==null){if(t.has(r))return"<$ cycle-trimmed $>";t.add(r);let i=0;if(this&&(i=e.get(this)??0),e.set(r,i+1),i>kje)return"<$ object-pruned $>"}return r}};var m8=(t=>(t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent",t))(m8||{});function Nje(t,e){const n=t,r=n.methodFactory;n.methodFactory=function(i,s,o){const a=r(i,s,o),c=m8[i],l=c>=s&&c<5;return(...d)=>{a.apply(this,d),l&&e(c,o?.toString(),...d)}},n.setLevel(n.getLevel())}var Uje=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Nh="1.9.0",IG=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function jje(t){var e=new Set([t]),n=new Set,r=t.match(IG);if(!r)return function(){return!1};var i={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(i.prerelease!=null)return function(c){return c===t};function s(a){return n.add(a),!1}function o(a){return e.add(a),!0}return function(c){if(e.has(c))return!0;if(n.has(c))return!1;var l=c.match(IG);if(!l)return s(c);var d={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return d.prerelease!=null||i.major!==d.major?s(c):i.major===0?i.minor===d.minor&&i.patch<=d.patch?o(c):s(c):i.minor<=d.minor?o(c):s(c)}}var Fje=jje(Nh),$je=Nh.split(".")[0],Ub=Symbol.for("opentelemetry.js.api."+$je),jb=Uje;function nR(t,e,n,r){var i;r===void 0&&(r=!1);var s=jb[Ub]=(i=jb[Ub])!==null&&i!==void 0?i:{version:Nh};if(!r&&s[t]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return n.error(o.stack||o.message),!1}if(s.version!==Nh){var o=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+t+" does not match previously registered API v"+Nh);return n.error(o.stack||o.message),!1}return s[t]=e,n.debug("@opentelemetry/api: Registered a global for "+t+" v"+Nh+"."),!0}function bv(t){var e,n,r=(e=jb[Ub])===null||e===void 0?void 0:e.version;if(!(!r||!Fje(r)))return(n=jb[Ub])===null||n===void 0?void 0:n[t]}function rR(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+Nh+".");var n=jb[Ub];n&&delete n[t]}var Bje=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},Hje=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},Vje=function(){function t(e){this._namespace=e.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return $1("debug",this._namespace,e)},t.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return $1("error",this._namespace,e)},t.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return $1("info",this._namespace,e)},t.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return $1("warn",this._namespace,e)},t.prototype.verbose=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return $1("verbose",this._namespace,e)},t}();function $1(t,e,n){var r=bv("diag");if(r)return n.unshift(e),r[t].apply(r,Hje([],Bje(n),!1))}var _o;(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(_o||(_o={}));function qje(t,e){t<_o.NONE?t=_o.NONE:t>_o.ALL&&(t=_o.ALL),e=e||{};function n(r,i){var s=e[r];return typeof s=="function"&&t>=i?s.bind(e):function(){}}return{error:n("error",_o.ERROR),warn:n("warn",_o.WARN),info:n("info",_o.INFO),debug:n("debug",_o.DEBUG),verbose:n("verbose",_o.VERBOSE)}}var Gje=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},Kje=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},zje="diag",Tf=function(){function t(){function e(i){return function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=bv("diag");if(a)return a[i].apply(a,Kje([],Gje(s),!1))}}var n=this,r=function(i,s){var o,a,c;if(s===void 0&&(s={logLevel:_o.INFO}),i===n){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((o=l.stack)!==null&&o!==void 0?o:l.message),!1}typeof s=="number"&&(s={logLevel:s});var d=bv("diag"),h=qje((a=s.logLevel)!==null&&a!==void 0?a:_o.INFO,i);if(d&&!s.suppressOverrideMessage){var m=(c=new Error().stack)!==null&&c!==void 0?c:"<failed to generate stacktrace>";d.warn("Current logger will be overwritten from "+m),h.warn("Current logger will overwrite one already registered from "+m)}return nR("diag",h,n,!0)};n.setLogger=r,n.disable=function(){rR(zje,n)},n.createComponentLogger=function(i){return new Vje(i)},n.verbose=e("verbose"),n.debug=e("debug"),n.info=e("info"),n.warn=e("warn"),n.error=e("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}(),Wje=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},Yje=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Xje=function(){function t(e){this._entries=e?new Map(e):new Map}return t.prototype.getEntry=function(e){var n=this._entries.get(e);if(n)return Object.assign({},n)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var n=Wje(e,2),r=n[0],i=n[1];return[r,i]})},t.prototype.setEntry=function(e,n){var r=new t(this._entries);return r._entries.set(e,n),r},t.prototype.removeEntry=function(e){var n=new t(this._entries);return n._entries.delete(e),n},t.prototype.removeEntries=function(){for(var e,n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var s=new t(this._entries);try{for(var o=Yje(r),a=o.next();!a.done;a=o.next()){var c=a.value;s._entries.delete(c)}}catch(l){e={error:l}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return s},t.prototype.clear=function(){return new t},t}(),Jje=Symbol("BaggageEntryMetadata"),Qje=Tf.instance();function Zje(t){return t===void 0&&(t={}),new Xje(new Map(Object.entries(t)))}function eFe(t){return typeof t!="string"&&(Qje.error("Cannot create baggage metadata from unknown type: "+typeof t),t=""),{__TYPE__:Jje,toString:function(){return t}}}function g8(t){return Symbol.for(t)}var tFe=function(){function t(e){var n=this;n._currentContext=e?new Map(e):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,i){var s=new t(n._currentContext);return s._currentContext.set(r,i),s},n.deleteValue=function(r){var i=new t(n._currentContext);return i._currentContext.delete(r),i}}return t}(),rg=new tFe,nFe={get:function(t,e){if(t!=null)return t[e]},keys:function(t){return t==null?[]:Object.keys(t)}},rFe={set:function(t,e,n){t!=null&&(t[e]=n)}},iFe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},sFe=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},oFe=function(){function t(){}return t.prototype.active=function(){return rg},t.prototype.with=function(e,n,r){for(var i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];return n.call.apply(n,sFe([r],iFe(i),!1))},t.prototype.bind=function(e,n){return n},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}(),aFe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},cFe=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},px="context",lFe=new oFe,iR=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(e){return nR(px,e,Tf.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(e,n,r){for(var i,s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return(i=this._getContextManager()).with.apply(i,cFe([e,n,r],aFe(s),!1))},t.prototype.bind=function(e,n){return this._getContextManager().bind(e,n)},t.prototype._getContextManager=function(){return bv(px)||lFe},t.prototype.disable=function(){this._getContextManager().disable(),rR(px,Tf.instance())},t}(),Fu;(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})(Fu||(Fu={}));var Bae="0000000000000000",Hae="00000000000000000000000000000000",Vae={traceId:Hae,spanId:Bae,traceFlags:Fu.NONE},Vy=function(){function t(e){e===void 0&&(e=Vae),this._spanContext=e}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,n){return this},t.prototype.setAttributes=function(e){return this},t.prototype.addEvent=function(e,n){return this},t.prototype.addLink=function(e){return this},t.prototype.addLinks=function(e){return this},t.prototype.setStatus=function(e){return this},t.prototype.updateName=function(e){return this},t.prototype.end=function(e){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(e,n){},t}(),v8=g8("OpenTelemetry Context Key SPAN");function y8(t){return t.getValue(v8)||void 0}function uFe(){return y8(iR.getInstance().active())}function b8(t,e){return t.setValue(v8,e)}function dFe(t){return t.deleteValue(v8)}function fFe(t,e){return b8(t,new Vy(e))}function qae(t){var e;return(e=y8(t))===null||e===void 0?void 0:e.spanContext()}var hFe=/^([0-9a-f]{32})$/i,pFe=/^[0-9a-f]{16}$/i;function Gae(t){return hFe.test(t)&&t!==Hae}function mFe(t){return pFe.test(t)&&t!==Bae}function sR(t){return Gae(t.traceId)&&mFe(t.spanId)}function gFe(t){return new Vy(t)}var mx=iR.getInstance(),Kae=function(){function t(){}return t.prototype.startSpan=function(e,n,r){r===void 0&&(r=mx.active());var i=!!n?.root;if(i)return new Vy;var s=r&&qae(r);return vFe(s)&&sR(s)?new Vy(s):new Vy},t.prototype.startActiveSpan=function(e,n,r,i){var s,o,a;if(!(arguments.length<2)){arguments.length===2?a=n:arguments.length===3?(s=n,a=r):(s=n,o=r,a=i);var c=o??mx.active(),l=this.startSpan(e,s,c),d=b8(c,l);return mx.with(d,a,void 0,l)}},t}();function vFe(t){return typeof t=="object"&&typeof t.spanId=="string"&&typeof t.traceId=="string"&&typeof t.traceFlags=="number"}var yFe=new Kae,bFe=function(){function t(e,n,r,i){this._provider=e,this.name=n,this.version=r,this.options=i}return t.prototype.startSpan=function(e,n,r){return this._getTracer().startSpan(e,n,r)},t.prototype.startActiveSpan=function(e,n,r,i){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):yFe},t}(),_Fe=function(){function t(){}return t.prototype.getTracer=function(e,n,r){return new Kae},t}(),SFe=new _Fe,kG=function(){function t(){}return t.prototype.getTracer=function(e,n,r){var i;return(i=this.getDelegateTracer(e,n,r))!==null&&i!==void 0?i:new bFe(this,e,n,r)},t.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:SFe},t.prototype.setDelegate=function(e){this._delegate=e},t.prototype.getDelegateTracer=function(e,n,r){var i;return(i=this._delegate)===null||i===void 0?void 0:i.getTracer(e,n,r)},t}(),t3;(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(t3||(t3={}));var rL;(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(rL||(rL={}));var iL;(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(iL||(iL={}));var Xh=iR.getInstance(),En=Tf.instance(),EFe=function(){function t(){}return t.prototype.inject=function(e,n){},t.prototype.extract=function(e,n){return e},t.prototype.fields=function(){return[]},t}(),_8=g8("OpenTelemetry Baggage Key");function zae(t){return t.getValue(_8)||void 0}function wFe(){return zae(iR.getInstance().active())}function CFe(t,e){return t.setValue(_8,e)}function TFe(t){return t.deleteValue(_8)}var gx="propagation",RFe=new EFe,IFe=function(){function t(){this.createBaggage=Zje,this.getBaggage=zae,this.getActiveBaggage=wFe,this.setBaggage=CFe,this.deleteBaggage=TFe}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(e){return nR(gx,e,Tf.instance())},t.prototype.inject=function(e,n,r){return r===void 0&&(r=rFe),this._getGlobalPropagator().inject(e,n,r)},t.prototype.extract=function(e,n,r){return r===void 0&&(r=nFe),this._getGlobalPropagator().extract(e,n,r)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){rR(gx,Tf.instance())},t.prototype._getGlobalPropagator=function(){return bv(gx)||RFe},t}(),qy=IFe.getInstance(),vx="trace",kFe=function(){function t(){this._proxyTracerProvider=new kG,this.wrapSpanContext=gFe,this.isSpanContextValid=sR,this.deleteSpan=dFe,this.getSpan=y8,this.getActiveSpan=uFe,this.getSpanContext=qae,this.setSpan=b8,this.setSpanContext=fFe}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(e){var n=nR(vx,this._proxyTracerProvider,Tf.instance());return n&&this._proxyTracerProvider.setDelegate(e),n},t.prototype.getTracerProvider=function(){return bv(vx)||this._proxyTracerProvider},t.prototype.getTracer=function(e,n){return this.getTracerProvider().getTracer(e,n)},t.prototype.disable=function(){rR(vx,Tf.instance()),this._proxyTracerProvider=new kG},t}(),Wa=kFe.getInstance();const yx={trace:Wa},Wae=g8("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function xFe(t){return t.setValue(Wae,!0)}function S8(t){return t.getValue(Wae)===!0}const AFe="=",sL=";",oL=",",bx="baggage",PFe=180,LFe=4096,OFe=8192;function MFe(t){return t.reduce((e,n)=>{const r=`${e}${e!==""?oL:""}${n}`;return r.length>OFe?e:r},"")}function DFe(t){return t.getAllEntries().map(([e,n])=>{let r=`${encodeURIComponent(e)}=${encodeURIComponent(n.value)}`;return n.metadata!==void 0&&(r+=sL+n.metadata.toString()),r})}function NFe(t){const e=t.split(sL);if(e.length<=0)return;const n=e.shift();if(!n)return;const r=n.indexOf(AFe);if(r<=0)return;const i=decodeURIComponent(n.substring(0,r).trim()),s=decodeURIComponent(n.substring(r+1).trim());let o;return e.length>0&&(o=eFe(e.join(sL))),{key:i,value:s,metadata:o}}class UFe{inject(e,n,r){const i=qy.getBaggage(e);if(!i||S8(e))return;const s=DFe(i).filter(a=>a.length<=LFe).slice(0,PFe),o=MFe(s);o.length>0&&r.set(n,bx,o)}extract(e,n,r){const i=r.get(n,bx),s=Array.isArray(i)?i.join(oL):i;if(!s)return e;const o={};return s.length===0||(s.split(oL).forEach(c=>{const l=NFe(c);if(l){const d={value:l.value};l.metadata&&(d.metadata=l.metadata),o[l.key]=d}}),Object.entries(o).length===0)?e:qy.setBaggage(e,qy.createBaggage(o))}fields(){return[bx]}}function Pw(t){const e={};if(typeof t!="object"||t==null)return e;for(const[n,r]of Object.entries(t)){if(!jFe(n)){En.warn(`Invalid attribute key: ${n}`);continue}if(!Yae(r)){En.warn(`Invalid attribute value set for key: ${n}`);continue}Array.isArray(r)?e[n]=r.slice():e[n]=r}return e}function jFe(t){return typeof t=="string"&&t.length>0}function Yae(t){return t==null?!0:Array.isArray(t)?FFe(t):Xae(t)}function FFe(t){let e;for(const n of t)if(n!=null){if(!e){if(Xae(n)){e=typeof n;continue}return!1}if(typeof n!==e)return!1}return!0}function Xae(t){switch(typeof t){case"number":case"boolean":case"string":return!0}return!1}function $Fe(){return t=>{En.error(BFe(t))}}function BFe(t){return typeof t=="string"?t:JSON.stringify(HFe(t))}function HFe(t){const e={};let n=t;for(;n!==null;)Object.getOwnPropertyNames(n).forEach(r=>{if(e[r])return;const i=n[r];i&&(e[r]=String(i))}),n=Object.getPrototypeOf(n);return e}let VFe=$Fe();function E8(t){try{VFe(t)}catch{}}const jg=performance,qFe="2.0.1",_x="exception.message",GFe="exception.stacktrace",Sx="exception.type",Jae="service.name",aL="telemetry.sdk.language",KFe="webjs",cL="telemetry.sdk.name",lL="telemetry.sdk.version",zFe="process.runtime.name",Ex={[cL]:"opentelemetry",[zFe]:"browser",[aL]:KFe,[lL]:qFe},WFe=9,YFe=6,XFe=Math.pow(10,YFe),n3=Math.pow(10,WFe);function pg(t){const e=t/1e3,n=Math.trunc(e),r=Math.round(t%1e3*XFe);return[n,r]}function Qae(){let t=jg.timeOrigin;if(typeof t!="number"){const e=jg;t=e.timing&&e.timing.fetchStart}return t}function JFe(t){const e=pg(Qae()),n=pg(typeof t=="number"?t:jg.now());return ece(e,n)}function QFe(t,e){let n=e[0]-t[0],r=e[1]-t[1];return r<0&&(n-=1,r+=n3),[n,r]}function ZFe(t){return t[0]*n3+t[1]}function xG(t){return t[0]*1e3+t[1]/1e6}function wx(t){return t[0]*1e6+t[1]/1e3}function Zae(t){return Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"}function AG(t){return Zae(t)||typeof t=="number"||t instanceof Date}function ece(t,e){const n=[t[0]+e[0],t[1]+e[1]];return n[1]>=n3&&(n[1]-=n3,n[0]+=1),n}var Bc;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"})(Bc||(Bc={}));class e$e{_propagators;_fields;constructor(e={}){this._propagators=e.propagators??[],this._fields=Array.from(new Set(this._propagators.map(n=>typeof n.fields=="function"?n.fields():[]).reduce((n,r)=>n.concat(r),[])))}inject(e,n,r){for(const i of this._propagators)try{i.inject(e,n,r)}catch(s){En.warn(`Failed to inject with ${i.constructor.name}. Err: ${s.message}`)}}extract(e,n,r){return this._propagators.reduce((i,s)=>{try{return s.extract(i,n,r)}catch(o){En.warn(`Failed to extract with ${s.constructor.name}. Err: ${o.message}`)}return i},e)}fields(){return this._fields.slice()}}const uL="[_0-9a-z-*/]",t$e=`[a-z]${uL}{0,255}`,n$e=`[a-z0-9]${uL}{0,240}@[a-z]${uL}{0,13}`,r$e=new RegExp(`^(?:${t$e}|${n$e})$`),i$e=/^[ -~]{0,255}[!-~]$/,s$e=/,|=/;function o$e(t){return r$e.test(t)}function a$e(t){return i$e.test(t)&&!s$e.test(t)}const PG=32,c$e=512,LG=",",OG="=";class w8{_internalState=new Map;constructor(e){e&&this._parse(e)}set(e,n){const r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,n),r}unset(e){const n=this._clone();return n._internalState.delete(e),n}get(e){return this._internalState.get(e)}serialize(){return this._keys().reduce((e,n)=>(e.push(n+OG+this.get(n)),e),[]).join(LG)}_parse(e){e.length>c$e||(this._internalState=e.split(LG).reverse().reduce((n,r)=>{const i=r.trim(),s=i.indexOf(OG);if(s!==-1){const o=i.slice(0,s),a=i.slice(s+1,r.length);o$e(o)&&a$e(a)&&n.set(o,a)}return n},new Map),this._internalState.size>PG&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,PG))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const e=new w8;return e._internalState=new Map(this._internalState),e}}const Cx="traceparent",Tx="tracestate",l$e="00",u$e="(?!ff)[\\da-f]{2}",d$e="(?![0]{32})[\\da-f]{32}",f$e="(?![0]{16})[\\da-f]{16}",h$e="[\\da-f]{2}",p$e=new RegExp(`^\\s?(${u$e})-(${d$e})-(${f$e})-(${h$e})(-.*)?\\s?$`);function m$e(t){const e=p$e.exec(t);return!e||e[1]==="00"&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}}class g$e{inject(e,n,r){const i=Wa.getSpanContext(e);if(!i||S8(e)||!sR(i))return;const s=`${l$e}-${i.traceId}-${i.spanId}-0${Number(i.traceFlags||Fu.NONE).toString(16)}`;r.set(n,Cx,s),i.traceState&&r.set(n,Tx,i.traceState.serialize())}extract(e,n,r){const i=r.get(n,Cx);if(!i)return e;const s=Array.isArray(i)?i[0]:i;if(typeof s!="string")return e;const o=m$e(s);if(!o)return e;o.isRemote=!0;const a=r.get(n,Tx);if(a){const c=Array.isArray(a)?a.join(","):a;o.traceState=new w8(typeof c=="string"?c:void 0)}return Wa.setSpanContext(e,o)}fields(){return[Cx,Tx]}}const v$e="[object Object]",y$e="[object Null]",b$e="[object Undefined]",_$e=Function.prototype,tce=_$e.toString,S$e=tce.call(Object),E$e=Object.getPrototypeOf,nce=Object.prototype,rce=nce.hasOwnProperty,Lh=Symbol?Symbol.toStringTag:void 0,ice=nce.toString;function MG(t){if(!w$e(t)||C$e(t)!==v$e)return!1;const e=E$e(t);if(e===null)return!0;const n=rce.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&tce.call(n)===S$e}function w$e(t){return t!=null&&typeof t=="object"}function C$e(t){return t==null?t===void 0?b$e:y$e:Lh&&Lh in Object(t)?T$e(t):R$e(t)}function T$e(t){const e=rce.call(t,Lh),n=t[Lh];let r=!1;try{t[Lh]=void 0,r=!0}catch{}const i=ice.call(t);return r&&(e?t[Lh]=n:delete t[Lh]),i}function R$e(t){return ice.call(t)}const I$e=20;function k$e(...t){let e=t.shift();const n=new WeakMap;for(;t.length>0;)e=sce(e,t.shift(),0,n);return e}function Rx(t){return r3(t)?t.slice():t}function sce(t,e,n=0,r){let i;if(!(n>I$e)){if(n++,Lw(t)||Lw(e)||oce(e))i=Rx(e);else if(r3(t)){if(i=t.slice(),r3(e))for(let s=0,o=e.length;s<o;s++)i.push(Rx(e[s]));else if(B1(e)){const s=Object.keys(e);for(let o=0,a=s.length;o<a;o++){const c=s[o];i[c]=Rx(e[c])}}}else if(B1(t))if(B1(e)){if(!x$e(t,e))return e;i=Object.assign({},t);const s=Object.keys(e);for(let o=0,a=s.length;o<a;o++){const c=s[o],l=e[c];if(Lw(l))typeof l>"u"?delete i[c]:i[c]=l;else{const d=i[c],h=l;if(DG(t,c,r)||DG(e,c,r))delete i[c];else{if(B1(d)&&B1(h)){const m=r.get(d)||[],g=r.get(h)||[];m.push({obj:t,key:c}),g.push({obj:e,key:c}),r.set(d,m),r.set(h,g)}i[c]=sce(i[c],l,n,r)}}}}else i=e;return i}}function DG(t,e,n){const r=n.get(t[e])||[];for(let i=0,s=r.length;i<s;i++){const o=r[i];if(o.key===e&&o.obj===t)return!0}return!1}function r3(t){return Array.isArray(t)}function oce(t){return typeof t=="function"}function B1(t){return!Lw(t)&&!r3(t)&&!oce(t)&&typeof t=="object"}function Lw(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t>"u"||t instanceof Date||t instanceof RegExp||t===null}function x$e(t,e){return!(!MG(t)||!MG(e))}class A$e{_promise;_resolve;_reject;constructor(){this._promise=new Promise((e,n)=>{this._resolve=e,this._reject=n})}get promise(){return this._promise}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}class P$e{_callback;_that;_isCalled=!1;_deferred=new A$e;constructor(e,n){this._callback=e,this._that=n}get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...e){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...e)).then(n=>this._deferred.resolve(n),n=>this._deferred.reject(n))}catch(n){this._deferred.reject(n)}}return this._deferred.promise}}function L$e(t,e){return new Promise(n=>{Xh.with(xFe(Xh.active()),()=>{t.export(e,r=>{n(r)})})})}const O$e={_export:L$e};function M$e(){return"unknown_service"}const my=t=>t!==null&&typeof t=="object"&&typeof t.then=="function";class i3{_rawAttributes;_asyncAttributesPending=!1;_memoizedAttributes;static FromAttributeList(e){const n=new i3({});return n._rawAttributes=NG(e),n._asyncAttributesPending=e.filter(([r,i])=>my(i)).length>0,n}constructor(e){const n=e.attributes??{};this._rawAttributes=Object.entries(n).map(([r,i])=>(my(i)&&(this._asyncAttributesPending=!0),[r,i])),this._rawAttributes=NG(this._rawAttributes)}get asyncAttributesPending(){return this._asyncAttributesPending}async waitForAsyncAttributes(){if(this.asyncAttributesPending){for(let e=0;e<this._rawAttributes.length;e++){const[n,r]=this._rawAttributes[e];this._rawAttributes[e]=[n,my(r)?await r:r]}this._asyncAttributesPending=!1}}get attributes(){if(this.asyncAttributesPending&&En.error("Accessing resource attributes before async attributes settled"),this._memoizedAttributes)return this._memoizedAttributes;const e={};for(const[n,r]of this._rawAttributes){if(my(r)){En.debug(`Unsettled resource attribute ${n} skipped`);continue}r!=null&&(e[n]??=r)}return this._asyncAttributesPending||(this._memoizedAttributes=e),e}getRawAttributes(){return this._rawAttributes}merge(e){return e==null?this:i3.FromAttributeList([...e.getRawAttributes(),...this.getRawAttributes()])}}function ace(t){return i3.FromAttributeList(Object.entries(t))}function D$e(){return ace({[Jae]:M$e(),[aL]:Ex[aL],[cL]:Ex[cL],[lL]:Ex[lL]})}function NG(t){return t.map(([e,n])=>my(n)?[e,n.catch(r=>{En.debug("promise rejection for resource attribute: %s - %s",e,r)})]:[e,n])}const N$e="exception";class U$e{_spanContext;kind;parentSpanContext;attributes={};links=[];events=[];startTime;resource;instrumentationScope;_droppedAttributesCount=0;_droppedEventsCount=0;_droppedLinksCount=0;name;status={code:iL.UNSET};endTime=[0,0];_ended=!1;_duration=[-1,-1];_spanProcessor;_spanLimits;_attributeValueLengthLimit;_performanceStartTime;_performanceOffset;_startTimeProvided;constructor(e){const n=Date.now();this._spanContext=e.spanContext,this._performanceStartTime=jg.now(),this._performanceOffset=n-(this._performanceStartTime+Qae()),this._startTimeProvided=e.startTime!=null,this._spanLimits=e.spanLimits,this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,this._spanProcessor=e.spanProcessor,this.name=e.name,this.parentSpanContext=e.parentSpanContext,this.kind=e.kind,this.links=e.links||[],this.startTime=this._getTime(e.startTime??n),this.resource=e.resource,this.instrumentationScope=e.scope,e.attributes!=null&&this.setAttributes(e.attributes),this._spanProcessor.onStart(this,e.context)}spanContext(){return this._spanContext}setAttribute(e,n){if(n==null||this._isSpanEnded())return this;if(e.length===0)return En.warn(`Invalid attribute key: ${e}`),this;if(!Yae(n))return En.warn(`Invalid attribute value set for key: ${e}`),this;const{attributeCountLimit:r}=this._spanLimits;return r!==void 0&&Object.keys(this.attributes).length>=r&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(n),this)}setAttributes(e){for(const[n,r]of Object.entries(e))this.setAttribute(n,r);return this}addEvent(e,n,r){if(this._isSpanEnded())return this;const{eventCountLimit:i}=this._spanLimits;if(i===0)return En.warn("No events allowed."),this._droppedEventsCount++,this;i!==void 0&&this.events.length>=i&&(this._droppedEventsCount===0&&En.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),AG(n)&&(AG(r)||(r=n),n=void 0);const s=Pw(n);return this.events.push({name:e,attributes:s,time:this._getTime(r),droppedAttributesCount:0}),this}addLink(e){return this.links.push(e),this}addLinks(e){return this.links.push(...e),this}setStatus(e){return this._isSpanEnded()?this:(this.status={...e},this.status.message!=null&&typeof e.message!="string"&&(En.warn(`Dropping invalid status.message of type '${typeof e.message}', expected 'string'`),delete this.status.message),this)}updateName(e){return this._isSpanEnded()?this:(this.name=e,this)}end(e){if(this._isSpanEnded()){En.error(`${this.name} ${this._spanContext.traceId}-${this._spanContext.spanId} - You can only call end() on a span once.`);return}this._ended=!0,this.endTime=this._getTime(e),this._duration=QFe(this.startTime,this.endTime),this._duration[0]<0&&(En.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&En.warn(`Dropped ${this._droppedEventsCount} events because eventCountLimit reached`),this._spanProcessor.onEnd(this)}_getTime(e){if(typeof e=="number"&&e<=jg.now())return JFe(e+this._performanceOffset);if(typeof e=="number")return pg(e);if(e instanceof Date)return pg(e.getTime());if(Zae(e))return e;if(this._startTimeProvided)return pg(Date.now());const n=jg.now()-this._performanceStartTime;return ece(this.startTime,pg(n))}isRecording(){return this._ended===!1}recordException(e,n){const r={};typeof e=="string"?r[_x]=e:e&&(e.code?r[Sx]=e.code.toString():e.name&&(r[Sx]=e.name),e.message&&(r[_x]=e.message),e.stack&&(r[GFe]=e.stack)),r[Sx]||r[_x]?this.addEvent(N$e,r,n):En.warn(`Failed to record an exception ${e}`)}get duration(){return this._duration}get ended(){return this._ended}get droppedAttributesCount(){return this._droppedAttributesCount}get droppedEventsCount(){return this._droppedEventsCount}get droppedLinksCount(){return this._droppedLinksCount}_isSpanEnded(){if(this._ended){const e=new Error(`Operation attempted on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`);En.warn(`Cannot execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`,e)}return this._ended}_truncateToLimitUtil(e,n){return e.length<=n?e:e.substring(0,n)}_truncateToSize(e){const n=this._attributeValueLengthLimit;return n<=0?(En.warn(`Attribute value limit must be positive, got ${n}`),e):typeof e=="string"?this._truncateToLimitUtil(e,n):Array.isArray(e)?e.map(r=>typeof r=="string"?this._truncateToLimitUtil(r,n):r):e}}var _v;(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(_v||(_v={}));class s3{shouldSample(){return{decision:_v.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}class Fg{shouldSample(){return{decision:_v.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}class aE{_root;_remoteParentSampled;_remoteParentNotSampled;_localParentSampled;_localParentNotSampled;constructor(e){this._root=e.root,this._root||(E8(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Fg),this._remoteParentSampled=e.remoteParentSampled??new Fg,this._remoteParentNotSampled=e.remoteParentNotSampled??new s3,this._localParentSampled=e.localParentSampled??new Fg,this._localParentNotSampled=e.localParentNotSampled??new s3}shouldSample(e,n,r,i,s,o){const a=Wa.getSpanContext(e);return!a||!sR(a)?this._root.shouldSample(e,n,r,i,s,o):a.isRemote?a.traceFlags&Fu.SAMPLED?this._remoteParentSampled.shouldSample(e,n,r,i,s,o):this._remoteParentNotSampled.shouldSample(e,n,r,i,s,o):a.traceFlags&Fu.SAMPLED?this._localParentSampled.shouldSample(e,n,r,i,s,o):this._localParentNotSampled.shouldSample(e,n,r,i,s,o)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}}class UG{_ratio;_upperBound;constructor(e=0){this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(this._ratio*4294967295)}shouldSample(e,n){return{decision:Gae(n)&&this._accumulate(n)<this._upperBound?_v.RECORD_AND_SAMPLED:_v.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(e){return typeof e!="number"||isNaN(e)?0:e>=1?1:e<=0?0:e}_accumulate(e){let n=0;for(let r=0;r<e.length/8;r++){const i=r*8,s=parseInt(e.slice(i,i+8),16);n=(n^s)>>>0}return n}}const jG=1;function cce(){return{sampler:lce(),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:1/0,attributeCountLimit:128},spanLimits:{attributeValueLengthLimit:1/0,attributeCountLimit:128,linkCountLimit:128,eventCountLimit:128,attributePerEventCountLimit:128,attributePerLinkCountLimit:128}}}function lce(){const t="parentbased_always_on";switch(t){case"always_on":return new Fg;case"always_off":return new s3;case"parentbased_always_on":return new aE({root:new Fg});case"parentbased_always_off":return new aE({root:new s3});case"traceidratio":return new UG(FG());case"parentbased_traceidratio":return new aE({root:new UG(FG())});default:return En.error(`OTEL_TRACES_SAMPLER value "${t}" invalid, defaulting to "parentbased_always_on".`),new aE({root:new Fg})}}function FG(){return En.error(`OTEL_TRACES_SAMPLER_ARG is blank, defaulting to ${jG}.`),jG}const j$e=128,F$e=1/0;function $$e(t){const e={sampler:lce()},n=cce(),r=Object.assign({},n,e,t);return r.generalLimits=Object.assign({},n.generalLimits,t.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,t.spanLimits||{}),r}function B$e(t){const e=Object.assign({},t.spanLimits);return e.attributeCountLimit=t.spanLimits?.attributeCountLimit??t.generalLimits?.attributeCountLimit??void 0??void 0??j$e,e.attributeValueLengthLimit=t.spanLimits?.attributeValueLengthLimit??t.generalLimits?.attributeValueLengthLimit??void 0??void 0??F$e,Object.assign({},t,{spanLimits:e})}const H$e=8,V$e=16;class q$e{generateTraceId=$G(V$e);generateSpanId=$G(H$e)}const cE=Array(32);function $G(t){return function(){for(let n=0;n<t*2;n++)cE[n]=Math.floor(Math.random()*16)+48,cE[n]>=58&&(cE[n]+=39);return String.fromCharCode.apply(null,cE.slice(0,t*2))}}class G$e{_sampler;_generalLimits;_spanLimits;_idGenerator;instrumentationScope;_resource;_spanProcessor;constructor(e,n,r,i){const s=$$e(n);this._sampler=s.sampler,this._generalLimits=s.generalLimits,this._spanLimits=s.spanLimits,this._idGenerator=n.idGenerator||new q$e,this._resource=r,this._spanProcessor=i,this.instrumentationScope=e}startSpan(e,n={},r=Xh.active()){n.root&&(r=Wa.deleteSpan(r));const i=Wa.getSpan(r);if(S8(r))return En.debug("Instrumentation suppressed, returning Noop Span"),Wa.wrapSpanContext(Vae);const s=i?.spanContext(),o=this._idGenerator.generateSpanId();let a,c,l;!s||!Wa.isSpanContextValid(s)?c=this._idGenerator.generateTraceId():(c=s.traceId,l=s.traceState,a=s);const d=n.kind??rL.INTERNAL,h=(n.links??[]).map(R=>({context:R.context,attributes:Pw(R.attributes)})),m=Pw(n.attributes),g=this._sampler.shouldSample(r,c,e,d,m,h);l=g.traceState??l;const y=g.decision===t3.RECORD_AND_SAMPLED?Fu.SAMPLED:Fu.NONE,v={traceId:c,spanId:o,traceFlags:y,traceState:l};if(g.decision===t3.NOT_RECORD)return En.debug("Recording is off, propagating context in a non-recording span"),Wa.wrapSpanContext(v);const w=Pw(Object.assign(m,g.attributes));return new U$e({resource:this._resource,scope:this.instrumentationScope,context:r,spanContext:v,name:e,kind:d,links:h,parentSpanContext:a,attributes:w,startTime:n.startTime,spanProcessor:this._spanProcessor,spanLimits:this._spanLimits})}startActiveSpan(e,n,r,i){let s,o,a;if(arguments.length<2)return;arguments.length===2?a=n:arguments.length===3?(s=n,a=r):(s=n,o=r,a=i);const c=o??Xh.active(),l=this.startSpan(e,s,c),d=Wa.setSpan(c,l);return Xh.with(d,a,void 0,l)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}}class K$e{_spanProcessors;constructor(e){this._spanProcessors=e}forceFlush(){const e=[];for(const n of this._spanProcessors)e.push(n.forceFlush());return new Promise(n=>{Promise.all(e).then(()=>{n()}).catch(r=>{E8(r||new Error("MultiSpanProcessor: forceFlush failed")),n()})})}onStart(e,n){for(const r of this._spanProcessors)r.onStart(e,n)}onEnd(e){for(const n of this._spanProcessors)n.onEnd(e)}shutdown(){const e=[];for(const n of this._spanProcessors)e.push(n.shutdown());return new Promise((n,r)=>{Promise.all(e).then(()=>{n()},r)})}}var Oh;(function(t){t[t.resolved=0]="resolved",t[t.timeout=1]="timeout",t[t.error=2]="error",t[t.unresolved=3]="unresolved"})(Oh||(Oh={}));class z$e{_config;_tracers=new Map;_resource;_activeSpanProcessor;constructor(e={}){const n=k$e({},cce(),B$e(e));this._resource=n.resource??D$e(),this._config=Object.assign({},n,{resource:this._resource});const r=[];e.spanProcessors?.length&&r.push(...e.spanProcessors),this._activeSpanProcessor=new K$e(r)}getTracer(e,n,r){const i=`${e}@${n||""}:${r?.schemaUrl||""}`;return this._tracers.has(i)||this._tracers.set(i,new G$e({name:e,version:n,schemaUrl:r?.schemaUrl},this._config,this._resource,this._activeSpanProcessor)),this._tracers.get(i)}forceFlush(){const e=this._config.forceFlushTimeoutMillis,n=this._activeSpanProcessor._spanProcessors.map(r=>new Promise(i=>{let s;const o=setTimeout(()=>{i(new Error(`Span processor did not completed within timeout period of ${e} ms`)),s=Oh.timeout},e);r.forceFlush().then(()=>{clearTimeout(o),s!==Oh.timeout&&(s=Oh.resolved,i(s))}).catch(a=>{clearTimeout(o),s=Oh.error,i(a)})}));return new Promise((r,i)=>{Promise.all(n).then(s=>{const o=s.filter(a=>a!==Oh.resolved);o.length>0?i(o):r()}).catch(s=>i([s]))})}shutdown(){return this._activeSpanProcessor.shutdown()}}class W$e{_exporter;_shutdownOnce;_pendingExports;constructor(e){this._exporter=e,this._shutdownOnce=new P$e(this._shutdown,this),this._pendingExports=new Set}async forceFlush(){await Promise.all(Array.from(this._pendingExports)),this._exporter.forceFlush&&await this._exporter.forceFlush()}onStart(e,n){}onEnd(e){if(this._shutdownOnce.isCalled||(e.spanContext().traceFlags&Fu.SAMPLED)===0)return;const n=this._doExport(e).catch(r=>E8(r));this._pendingExports.add(n),n.finally(()=>this._pendingExports.delete(n))}async _doExport(e){e.resource.asyncAttributesPending&&await e.resource.waitForAsyncAttributes?.();const n=await O$e._export(this._exporter,[e]);if(n.code!==Bc.SUCCESS)throw n.error??new Error(`SimpleSpanProcessor: span export failed (status ${n})`)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return this._exporter.shutdown()}}class Y$e{_delegate;constructor(e){this._delegate=e}export(e,n){this._delegate.export(e,n)}forceFlush(){return this._delegate.forceFlush()}shutdown(){return this._delegate.shutdown()}}class BG extends Error{code;name="OTLPExporterError";data;constructor(e,n,r){super(e),this.data=r,this.code=n}}function X$e(t){if(Number.isFinite(t)&&t>0)return t;throw new Error(`Configuration: timeoutMillis is invalid, expected number greater than 0 (actual: '${t}')`)}function J$e(t){if(t!=null)return()=>t}function Q$e(t,e,n){return{timeoutMillis:X$e(t.timeoutMillis??e.timeoutMillis??n.timeoutMillis),concurrencyLimit:t.concurrencyLimit??e.concurrencyLimit??n.concurrencyLimit,compression:t.compression??e.compression??n.compression}}function Z$e(){return{timeoutMillis:1e4,concurrencyLimit:30,compression:"none"}}class eBe{_concurrencyLimit;_sendingPromises=[];constructor(e){this._concurrencyLimit=e}pushPromise(e){if(this.hasReachedLimit())throw new Error("Concurrency Limit reached");this._sendingPromises.push(e);const n=()=>{const r=this._sendingPromises.indexOf(e);this._sendingPromises.splice(r,1)};e.then(n,n)}hasReachedLimit(){return this._sendingPromises.length>=this._concurrencyLimit}async awaitAll(){await Promise.all(this._sendingPromises)}}function tBe(t){return new eBe(t.concurrencyLimit)}function nBe(t){return Object.prototype.hasOwnProperty.call(t,"partialSuccess")}function rBe(){return{handleResponse(t){t==null||!nBe(t)||t.partialSuccess==null||Object.keys(t.partialSuccess).length===0||En.warn("Received Partial Success response:",JSON.stringify(t.partialSuccess))}}}class iBe{_transport;_serializer;_responseHandler;_promiseQueue;_timeout;_diagLogger;constructor(e,n,r,i,s){this._transport=e,this._serializer=n,this._responseHandler=r,this._promiseQueue=i,this._timeout=s,this._diagLogger=En.createComponentLogger({namespace:"OTLPExportDelegate"})}export(e,n){if(this._diagLogger.debug("items to be sent",e),this._promiseQueue.hasReachedLimit()){n({code:Bc.FAILED,error:new Error("Concurrent export limit reached")});return}const r=this._serializer.serializeRequest(e);if(r==null){n({code:Bc.FAILED,error:new Error("Nothing to send")});return}this._promiseQueue.pushPromise(this._transport.send(r,this._timeout).then(i=>{if(i.status==="success"){if(i.data!=null)try{this._responseHandler.handleResponse(this._serializer.deserializeResponse(i.data))}catch(s){this._diagLogger.warn("Export succeeded but could not deserialize response - is the response specification compliant?",s,i.data)}n({code:Bc.SUCCESS});return}else if(i.status==="failure"&&i.error){n({code:Bc.FAILED,error:i.error});return}else i.status==="retryable"?n({code:Bc.FAILED,error:new BG("Export failed with retryable status")}):n({code:Bc.FAILED,error:new BG("Export failed with unknown error")})},i=>n({code:Bc.FAILED,error:i})))}forceFlush(){return this._promiseQueue.awaitAll()}async shutdown(){this._diagLogger.debug("shutdown started"),await this.forceFlush(),this._transport.shutdown()}}function sBe(t,e){return new iBe(t.transport,t.serializer,rBe(),t.promiseHandler,e.timeout)}function uce(t,e,n){return sBe({transport:n,serializer:e,promiseHandler:tBe(t)},{timeout:t.timeoutMillis})}function HG(t){return t>=48&&t<=57?t-48:t>=97&&t<=102?t-87:t-55}function dce(t){const e=new Uint8Array(t.length/2);let n=0;for(let r=0;r<t.length;r+=2){const i=HG(t.charCodeAt(r)),s=HG(t.charCodeAt(r+1));e[n++]=i<<4|s}return e}function fce(t){const e=BigInt(1e9);return BigInt(t[0])*e+BigInt(t[1])}function oBe(t){const e=Number(BigInt.asUintN(32,t)),n=Number(BigInt.asUintN(32,t>>BigInt(32)));return{low:e,high:n}}function aBe(t){const e=fce(t);return oBe(e)}function cBe(t){return fce(t).toString()}const lBe=typeof BigInt<"u"?cBe:ZFe;function VG(t){return t}function uBe(t){if(t!==void 0)return dce(t)}const dBe={encodeHrTime:aBe,encodeSpanContext:dce,encodeOptionalSpanContext:uBe};function fBe(t){return t===void 0?dBe:{encodeHrTime:lBe,encodeSpanContext:VG,encodeOptionalSpanContext:VG}}function hBe(t){return{attributes:oR(t.attributes),droppedAttributesCount:0}}function pBe(t){return{name:t.name,version:t.version}}function oR(t){return Object.keys(t).map(e=>hce(e,t[e]))}function hce(t,e){return{key:t,value:pce(e)}}function pce(t){const e=typeof t;return e==="string"?{stringValue:t}:e==="number"?Number.isInteger(t)?{intValue:t}:{doubleValue:t}:e==="boolean"?{boolValue:t}:t instanceof Uint8Array?{bytesValue:t}:Array.isArray(t)?{arrayValue:{values:t.map(pce)}}:e==="object"&&t!=null?{kvlistValue:{values:Object.entries(t).map(([n,r])=>hce(n,r))}}:{}}function mBe(t,e){const n=t.spanContext(),r=t.status,i=t.parentSpanContext?.spanId?e.encodeSpanContext(t.parentSpanContext?.spanId):void 0;return{traceId:e.encodeSpanContext(n.traceId),spanId:e.encodeSpanContext(n.spanId),parentSpanId:i,traceState:n.traceState?.serialize(),name:t.name,kind:t.kind==null?0:t.kind+1,startTimeUnixNano:e.encodeHrTime(t.startTime),endTimeUnixNano:e.encodeHrTime(t.endTime),attributes:oR(t.attributes),droppedAttributesCount:t.droppedAttributesCount,events:t.events.map(s=>vBe(s,e)),droppedEventsCount:t.droppedEventsCount,status:{code:r.code,message:r.message},links:t.links.map(s=>gBe(s,e)),droppedLinksCount:t.droppedLinksCount}}function gBe(t,e){return{attributes:t.attributes?oR(t.attributes):[],spanId:e.encodeSpanContext(t.context.spanId),traceId:e.encodeSpanContext(t.context.traceId),traceState:t.context.traceState?.serialize(),droppedAttributesCount:t.droppedAttributesCount||0}}function vBe(t,e){return{attributes:t.attributes?oR(t.attributes):[],name:t.name,timeUnixNano:e.encodeHrTime(t.time),droppedAttributesCount:t.droppedAttributesCount||0}}function yBe(t,e){const n=fBe(e);return{resourceSpans:_Be(t,n)}}function bBe(t){const e=new Map;for(const n of t){let r=e.get(n.resource);r||(r=new Map,e.set(n.resource,r));const i=`${n.instrumentationScope.name}@${n.instrumentationScope.version||""}:${n.instrumentationScope.schemaUrl||""}`;let s=r.get(i);s||(s=[],r.set(i,s)),s.push(n)}return e}function _Be(t,e){const n=bBe(t),r=[],i=n.entries();let s=i.next();for(;!s.done;){const[o,a]=s.value,c=[],l=a.values();let d=l.next();for(;!d.done;){const m=d.value;if(m.length>0){const g=m.map(y=>mBe(y,e));c.push({scope:pBe(m[0].instrumentationScope),spans:g,schemaUrl:m[0].instrumentationScope.schemaUrl})}d=l.next()}const h={resource:hBe(o),scopeSpans:c,schemaUrl:void 0};r.push(h),s=i.next()}return r}const SBe={serializeRequest:t=>{const e=yBe(t,{});return new TextEncoder().encode(JSON.stringify(e))},deserializeResponse:t=>{if(t.length===0)return{};const e=new TextDecoder;return JSON.parse(e.decode(t))}},EBe=5,wBe=1e3,CBe=5e3,TBe=1.5,qG=.2;function RBe(){return Math.random()*(2*qG)-qG}class IBe{_transport;constructor(e){this._transport=e}retry(e,n,r){return new Promise((i,s)=>{setTimeout(()=>{this._transport.send(e,n).then(i,s)},r)})}async send(e,n){const r=Date.now()+n;let i=await this._transport.send(e,n),s=EBe,o=wBe;for(;i.status==="retryable"&&s>0;){s--;const a=Math.max(Math.min(o,CBe)+RBe(),0);o=o*TBe;const c=i.retryInMillis??a,l=r-Date.now();if(c>l)return i;i=await this.retry(e,l,c)}return i}shutdown(){return this._transport.shutdown()}}function mce(t){return new IBe(t.transport)}function kBe(t){return[429,502,503,504].includes(t)}function xBe(t){if(t==null)return;const e=Number.parseInt(t,10);if(Number.isInteger(e))return e>0?e*1e3:-1;const n=new Date(t).getTime()-Date.now();return n>=0?n:0}class ABe{_parameters;constructor(e){this._parameters=e}send(e,n){return new Promise(r=>{const i=new XMLHttpRequest;i.timeout=n,i.open("POST",this._parameters.url);const s=this._parameters.headers();Object.entries(s).forEach(([o,a])=>{i.setRequestHeader(o,a)}),i.ontimeout=o=>{r({status:"failure",error:new Error("XHR request timed out")})},i.onreadystatechange=()=>{i.status>=200&&i.status<=299?(En.debug("XHR success"),r({status:"success"})):i.status&&kBe(i.status)?r({status:"retryable",retryInMillis:xBe(i.getResponseHeader("Retry-After"))}):i.status!==0&&r({status:"failure",error:new Error("XHR request failed with non-retryable status")})},i.onabort=()=>{r({status:"failure",error:new Error("XHR request aborted")})},i.onerror=()=>{r({status:"failure",error:new Error("XHR request errored")})},i.send(e)})}shutdown(){}}function PBe(t){return new ABe(t)}class LBe{_params;constructor(e){this._params=e}send(e){return new Promise(n=>{navigator.sendBeacon(this._params.url,new Blob([e],{type:this._params.blobType}))?(En.debug("SendBeacon success"),n({status:"success"})):n({status:"failure",error:new Error("SendBeacon failed")})})}shutdown(){}}function OBe(t){return new LBe(t)}function MBe(t,e){return uce(t,e,mce({transport:PBe(t)}))}function DBe(t,e){return uce(t,e,mce({transport:OBe({url:t.url,blobType:t.headers()["Content-Type"]})}))}function NBe(t){return()=>{const e={};return Object.entries(t?.()??{}).forEach(([n,r])=>{typeof r<"u"?e[n]=String(r):En.warn(`Header "${n}" has invalid value (${r}) and will be ignored`)}),e}}function UBe(t,e,n){const r={...n()},i={};return()=>(e!=null&&Object.assign(i,e()),t!=null&&Object.assign(i,t()),Object.assign(i,r))}function jBe(t){if(t!=null)try{return new URL(t),t}catch{throw new Error(`Configuration: Could not parse user-provided export URL: '${t}'`)}}function FBe(t,e,n){return{...Q$e(t,e,n),headers:UBe(NBe(t.headers),e.headers,n.headers),url:jBe(t.url)??e.url??n.url,agentOptions:t.agentOptions??e.agentOptions??n.agentOptions}}function $Be(t,e){return{...Z$e(),headers:()=>t,url:"http://localhost:4318/"+e,agentOptions:{keepAlive:!0}}}function BBe(t,e,n){return FBe({url:t.url,timeoutMillis:t.timeoutMillis,headers:J$e(t.headers),concurrencyLimit:t.concurrencyLimit},{},$Be(n,e))}function HBe(t,e,n,r){const i=!!t.headers||typeof navigator.sendBeacon!="function",s=BBe(t,n,r);return i?MBe(s,e):DBe(s,e)}class VBe extends Y$e{constructor(e={}){super(HBe(e,SBe,"v1/traces",{"Content-Type":"application/json"}))}}class qBe{_enabled=!1;_currentContext=rg;_bindFunction(e=rg,n){const r=this,i=function(...s){return r.with(e,()=>n.apply(this,s))};return Object.defineProperty(i,"length",{enumerable:!1,configurable:!0,writable:!1,value:n.length}),i}active(){return this._currentContext}bind(e,n){return e===void 0&&(e=this.active()),typeof n=="function"?this._bindFunction(e,n):n}disable(){return this._currentContext=rg,this._enabled=!1,this}enable(){return this._enabled?this:(this._enabled=!0,this._currentContext=rg,this)}with(e,n,r,...i){const s=this._currentContext;this._currentContext=e||rg;try{return n.call(r,...i)}finally{this._currentContext=s}}}function GBe(t){if(t!==null){if(t===void 0){const e=new qBe;e.enable(),Xh.setGlobalContextManager(e);return}t.enable(),Xh.setGlobalContextManager(t)}}function KBe(t){if(t!==null){if(t===void 0){qy.setGlobalPropagator(new e$e({propagators:[new g$e,new UFe]}));return}qy.setGlobalPropagator(t)}}class zBe extends z$e{constructor(e={}){super(e)}register(e={}){Wa.setGlobalTracerProvider(this),KBe(e.propagator),GBe(e.contextManager)}}function GG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Ne(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?GG(Object(n),!0).forEach(function(r){pe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):GG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Fb(t){return Fb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fb(t)}function tn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function KG(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nn(t,e,n){return e&&KG(t.prototype,e),n&&KG(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function pe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function WBe(t,e){if(t==null)return{};var n,r,i=function(o,a){if(o==null)return{};var c,l,d={},h=Object.keys(o);for(l=0;l<h.length;l++)c=h[l],a.indexOf(c)>=0||(d[c]=o[c]);return d}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function fs(t,e){return function(n){if(Array.isArray(n))return n}(t)||function(n,r){var i=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(i!=null){var s,o,a=[],c=!0,l=!1;try{for(i=i.call(n);!(c=(s=i.next()).done)&&(a.push(s.value),!r||a.length!==r);c=!0);}catch(d){l=!0,o=d}finally{try{c||i.return==null||i.return()}finally{if(l)throw o}}return a}}(t,e)||C8(t,e)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function wu(t){return function(e){if(Array.isArray(e))return dL(e)}(t)||function(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}(t)||C8(t)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function C8(t,e){if(t){if(typeof t=="string")return dL(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dL(t,e):void 0}}function dL(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function wa(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=C8(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var c=n.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{o||n.return==null||n.return()}finally{if(a)throw s}}}}var na={DEBUG:!1,LIB_VERSION:"1.160.3"},YBe=Array.isArray,gce=Object.prototype,vce=gce.hasOwnProperty,aR=gce.toString,oi=YBe||function(t){return aR.call(t)==="[object Array]"},da=function(t){return typeof t=="function"},Fi=function(t){return t===Object(t)&&!oi(t)},Ow=function(t){if(Fi(t)){for(var e in t)if(vce.call(t,e))return!1;return!0}return!1},Xe=function(t){return t===void 0},ns=function(t){return aR.call(t)=="[object String]"},zG=function(t){return ns(t)&&t.trim().length===0},zu=function(t){return t===null},Xs=function(t){return Xe(t)||zu(t)},ra=function(t){return aR.call(t)=="[object Number]"},Uh=function(t){return aR.call(t)==="[object Boolean]"},XBe=function(t){return t instanceof FormData},oe=typeof window<"u"?window:void 0,Gs=typeof globalThis<"u"?globalThis:oe,yce=Array.prototype,WG=yce.forEach,YG=yce.indexOf,ec=Gs?.navigator,$e=Gs?.document,Ns=Gs?.location,fL=Gs?.fetch,hL=Gs!=null&&Gs.XMLHttpRequest&&"withCredentials"in new Gs.XMLHttpRequest?Gs.XMLHttpRequest:void 0,XG=Gs?.AbortController,_i=ec?.userAgent,Zn=oe??{},JG="[PostHog.js]",Ee={_log:function(t){if(oe&&(na.DEBUG||Zn.POSTHOG_DEBUG)&&!Xe(oe.console)&&oe.console){for(var e=("__rrweb_original__"in oe.console[t])?oe.console[t].__rrweb_original__:oe.console[t],n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.apply(void 0,[JG].concat(r))}},info:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];Ee._log.apply(Ee,["log"].concat(e))},warn:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];Ee._log.apply(Ee,["warn"].concat(e))},error:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];Ee._log.apply(Ee,["error"].concat(e))},critical:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];(t=console).error.apply(t,[JG].concat(n))},uninitializedWarning:function(t){Ee.error("You must initialize PostHog before calling ".concat(t))}},o3={},cR=function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function $g(t,e,n){if(oi(t)){if(WG&&t.forEach===WG)t.forEach(e,n);else if("length"in t&&t.length===+t.length){for(var r=0,i=t.length;r<i;r++)if(r in t&&e.call(n,t[r],r)===o3)return}}}function Pn(t,e,n){if(!Xs(t)){if(oi(t))return $g(t,e,n);if(XBe(t)){var r,i=wa(t.entries());try{for(i.s();!(r=i.n()).done;){var s=r.value;if(e.call(n,s[1],s[0])===o3)return}}catch(a){i.e(a)}finally{i.f()}}else for(var o in t)if(vce.call(t,o)&&e.call(n,t[o],o)===o3)return}}var hs=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return $g(n,function(i){for(var s in i)i[s]!==void 0&&(t[s]=i[s])}),t};function Ft(t,e){return t.indexOf(e)!==-1}function Mw(t){for(var e=Object.keys(t),n=e.length,r=new Array(n);n--;)r[n]=[e[n],t[e[n]]];return r}var bce=function(){return Date.now=Date.now||function(){return+new Date},Date.now()},QG=function(t){try{return t()}catch{return}},JBe=function(t){return function(){try{for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.apply(this,n)}catch(i){Ee.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),Ee.critical(i)}}},pL=function(t){var e={};return Pn(t,function(n,r){ns(n)&&n.length>0&&(e[r]=n)}),e},mL=function(t){return t.replace(/^\$/,"")};function QBe(t,e){return n=t,r=function(s){return ns(s)&&!zu(e)?s.slice(0,e):s},i=new Set,function s(o,a){return o!==Object(o)?r?r(o,a):o:i.has(o)?void 0:(i.add(o),oi(o)?(c=[],$g(o,function(l){c.push(s(l))})):(c={},Pn(o,function(l,d){i.has(l)||(c[d]=s(l,d))})),c);var c}(n);var n,r,i}var Qa,ZBe=function(t){var e,n,r,i,s="";for(e=n=0,r=(t=(t+"").replace(/\r\n/g,`
`).replace(/\r/g,`
`)).length,i=0;i<r;i++){var o=t.charCodeAt(i),a=null;o<128?n++:a=o>127&&o<2048?String.fromCharCode(o>>6|192,63&o|128):String.fromCharCode(o>>12|224,o>>6&63|128,63&o|128),zu(a)||(n>e&&(s+=t.substring(e,n)),s+=a,e=n=i+1)}return n>e&&(s+=t.substring(e,t.length)),s},uu=function(){function t(e){return e&&(e.preventDefault=t.preventDefault,e.stopPropagation=t.stopPropagation),e}return t.preventDefault=function(){this.returnValue=!1},t.stopPropagation=function(){this.cancelBubble=!0},function(e,n,r,i,s){if(e)if(e.addEventListener&&!i)e.addEventListener(n,r,!!s);else{var o="on"+n,a=e[o];e[o]=function(c,l,d){return function(h){if(h=h||t(oe?.event)){var m,g=!0;da(d)&&(m=d(h));var y=l.call(c,h);return m!==!1&&y!==!1||(g=!1),g}}}(e,r,a)}else Ee.error("No valid element provided to register_event")}}();function _ce(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return t[n]}(function(t){t.GZipJS="gzip-js",t.Base64="base64"})(Qa||(Qa={}));var Sce="$people_distinct_id",gy="__alias",vy="__timers",ZG="$autocapture_disabled_server_side",gL="$heatmaps_enabled_server_side",eK="$exception_capture_enabled_server_side",tK="$exception_capture_endpoint_suffix",nK="$web_vitals_enabled_server_side",vL="$session_recording_enabled_server_side",rK="$console_log_recording_enabled_server_side",iK="$session_recording_network_payload_capture",sK="$session_recording_canvas_recording",oK="$replay_sample_rate",aK="$replay_minimum_duration",a3="$sesid",Gy="$session_is_sampled",mg="$enabled_feature_flags",yL="$early_access_features",gg="$stored_person_properties",jd="$stored_group_properties",bL="$surveys",lE="$surveys_activated",c3="$flag_call_reported",Xl="$user_state",_L="$client_session_props",SL="$capture_rate_limit",EL="$initial_campaign_params",wL="$initial_referrer_info",cK="$initial_person_info",l3="$epp",CL="__POSTHOG_TOOLBAR__",eHe=[Sce,gy,"__cmpns",vy,vL,gL,a3,mg,Xl,yL,jd,gg,bL,c3,_L,SL,EL,wL,l3],Ix="$active_feature_flags",uE="$override_feature_flags",lK="$feature_flag_payloads",uK=function(t){var e,n={},r=wa(Mw(t||{}));try{for(r.s();!(e=r.n()).done;){var i=fs(e.value,2),s=i[0],o=i[1];o&&(n[s]=o)}}catch(a){r.e(a)}finally{r.f()}return n},tHe=function(){function t(e){tn(this,t),this.instance=e,this._override_warning=!1,this.featureFlagEventHandlers=[],this.reloadFeatureFlagsQueued=!1,this.reloadFeatureFlagsInAction=!1}return nn(t,[{key:"getFlags",value:function(){return Object.keys(this.getFlagVariants())}},{key:"getFlagVariants",value:function(){var e=this.instance.get_property(mg),n=this.instance.get_property(uE);if(!n)return e||{};for(var r=hs({},e),i=Object.keys(n),s=0;s<i.length;s++)r[i[s]]=n[i[s]];return this._override_warning||(Ee.warn(" Overriding feature flags!",{enabledFlags:e,overriddenFlags:n,finalFlags:r}),this._override_warning=!0),r}},{key:"getFlagPayloads",value:function(){return this.instance.get_property(lK)||{}}},{key:"reloadFeatureFlags",value:function(){this.reloadFeatureFlagsQueued||(this.reloadFeatureFlagsQueued=!0,this._startReloadTimer())}},{key:"setAnonymousDistinctId",value:function(e){this.$anon_distinct_id=e}},{key:"setReloadingPaused",value:function(e){this.reloadFeatureFlagsInAction=e}},{key:"resetRequestQueue",value:function(){this.reloadFeatureFlagsQueued=!1}},{key:"_startReloadTimer",value:function(){var e=this;this.reloadFeatureFlagsQueued&&!this.reloadFeatureFlagsInAction&&setTimeout(function(){!e.reloadFeatureFlagsInAction&&e.reloadFeatureFlagsQueued&&(e.reloadFeatureFlagsQueued=!1,e._reloadFeatureFlagsRequest())},5)}},{key:"_reloadFeatureFlagsRequest",value:function(){var e=this;if(!this.instance.config.advanced_disable_feature_flags){this.setReloadingPaused(!0);var n=this.instance.config.token,r=this.instance.get_property(gg),i=this.instance.get_property(jd),s={token:n,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:r,group_properties:i,disable_flags:this.instance.config.advanced_disable_feature_flags||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:s,compression:this.instance.config.disable_compression?void 0:Qa.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(o){var a;e.setReloadingPaused(!1);var c=!0;o.statusCode===200&&(e.$anon_distinct_id=void 0,c=!1),e.receivedFeatureFlags((a=o.json)!==null&&a!==void 0?a:{},c),e._startReloadTimer()}})}}},{key:"getFeatureFlag",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0){var r,i=this.getFlagVariants()[e],s="".concat(i),o=this.instance.get_property(c3)||{};return(n.send_event||!("send_event"in n))&&(!(e in o)||!o[e].includes(s))&&(oi(o[e])?o[e].push(s):o[e]=[s],(r=this.instance.persistence)===null||r===void 0||r.register(pe({},c3,o)),this.instance.capture("$feature_flag_called",{$feature_flag:e,$feature_flag_response:i})),i}Ee.warn('getFeatureFlag for key "'+e+`" failed. Feature flags didn't load in time.`)}},{key:"getFeatureFlagPayload",value:function(e){return this.getFlagPayloads()[e]}},{key:"isFeatureEnabled",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0)return!!this.getFeatureFlag(e,n);Ee.warn('isFeatureEnabled for key "'+e+`" failed. Feature flags didn't load in time.`)}},{key:"addFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers.push(e)}},{key:"removeFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter(function(n){return n!==e})}},{key:"receivedFeatureFlags",value:function(e,n){if(this.instance.persistence){this.instance.decideEndpointWasHit=!0;var r=this.getFlagVariants(),i=this.getFlagPayloads();(function(s,o){var a,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},d=s.featureFlags,h=s.featureFlagPayloads;if(d)if(oi(d)){var m,g={};if(d)for(var y=0;y<d.length;y++)g[d[y]]=!0;o&&o.register((pe(m={},Ix,d),pe(m,mg,g),m))}else{var v=d,w=h;s.errorsWhileComputingFlags&&(v=Ne(Ne({},c),v),w=Ne(Ne({},l),w)),o&&o.register((pe(a={},Ix,Object.keys(uK(v))),pe(a,mg,v||{}),pe(a,lK,w||{}),a))}})(e,this.instance.persistence,r,i),this._fireFeatureFlagsCallbacks(n)}}},{key:"override",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.instance.__loaded||!this.instance.persistence)return Ee.uninitializedWarning("posthog.feature_flags.override");if(this._override_warning=n,e===!1)this.instance.persistence.unregister(uE);else if(oi(e)){for(var r={},i=0;i<e.length;i++)r[e[i]]=!0;this.instance.persistence.register(pe({},uE,r))}else this.instance.persistence.register(pe({},uE,e))}},{key:"onFeatureFlags",value:function(e){var n=this;if(this.addFeatureFlagsHandler(e),this.instance.decideEndpointWasHit){var r=this._prepareFeatureFlagsForCallbacks(),i=r.flags,s=r.flagVariants;e(i,s)}return function(){return n.removeFeatureFlagsHandler(e)}}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,n){var r,i,s=pe({},"$feature_enrollment/".concat(e),n);this.instance.capture("$feature_enrollment_update",{$feature_flag:e,$feature_enrollment:n,$set:s}),this.setPersonPropertiesForFlags(s,!1);var o=Ne(Ne({},this.getFlagVariants()),{},pe({},e,n));(r=this.instance.persistence)===null||r===void 0||r.register((pe(i={},Ix,Object.keys(uK(o))),pe(i,mg,o),i)),this._fireFeatureFlagsCallbacks()}},{key:"getEarlyAccessFeatures",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=this.instance.get_property(yL);if(i&&!r)return e(i);this.instance._send_request({transport:"XHR",url:this.instance.requestRouter.endpointFor("api","/api/early_access_features/?token=".concat(this.instance.config.token)),method:"GET",callback:function(s){var o;if(s.json){var a=s.json.earlyAccessFeatures;return(o=n.instance.persistence)===null||o===void 0||o.register(pe({},yL,a)),e(a)}}})}},{key:"_prepareFeatureFlagsForCallbacks",value:function(){var e=this.getFlags(),n=this.getFlagVariants();return{flags:e.filter(function(r){return n[r]}),flagVariants:Object.keys(n).filter(function(r){return n[r]}).reduce(function(r,i){return r[i]=n[i],r},{})}}},{key:"_fireFeatureFlagsCallbacks",value:function(e){var n=this._prepareFeatureFlagsForCallbacks(),r=n.flags,i=n.flagVariants;this.featureFlagEventHandlers.forEach(function(s){return s(r,i,{errorsLoading:e})})}},{key:"setPersonPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this.instance.get_property(gg)||{};this.instance.register(pe({},gg,Ne(Ne({},r),e))),n&&this.instance.reloadFeatureFlags()}},{key:"resetPersonPropertiesForFlags",value:function(){this.instance.unregister(gg)}},{key:"setGroupPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this.instance.get_property(jd)||{};Object.keys(r).length!==0&&Object.keys(r).forEach(function(i){r[i]=Ne(Ne({},r[i]),e[i]),delete e[i]}),this.instance.register(pe({},jd,Ne(Ne({},r),e))),n&&this.instance.reloadFeatureFlags()}},{key:"resetGroupPropertiesForFlags",value:function(e){if(e){var n=this.instance.get_property(jd)||{};this.instance.register(pe({},jd,Ne(Ne({},n),{},pe({},e,{}))))}else this.instance.unregister(jd)}}]),t}();Math.trunc||(Math.trunc=function(t){return t<0?Math.ceil(t):Math.floor(t)}),Number.isInteger||(Number.isInteger=function(t){return ra(t)&&isFinite(t)&&Math.floor(t)===t});var dK="0123456789abcdef",nHe=function(){function t(e){if(tn(this,t),this.bytes=e,e.length!==16)throw new TypeError("not 128-bit length")}return nn(t,[{key:"toString",value:function(){for(var e="",n=0;n<this.bytes.length;n++)e=e+dK.charAt(this.bytes[n]>>>4)+dK.charAt(15&this.bytes[n]),n!==3&&n!==5&&n!==7&&n!==9||(e+="-");if(e.length!==36)throw new Error("Invalid UUIDv7 was generated");return e}},{key:"clone",value:function(){return new t(this.bytes.slice(0))}},{key:"equals",value:function(e){return this.compareTo(e)===0}},{key:"compareTo",value:function(e){for(var n=0;n<16;n++){var r=this.bytes[n]-e.bytes[n];if(r!==0)return Math.sign(r)}return 0}}],[{key:"fromFieldsV7",value:function(e,n,r,i){if(!Number.isInteger(e)||!Number.isInteger(n)||!Number.isInteger(r)||!Number.isInteger(i)||e<0||n<0||r<0||i<0||e>0xffffffffffff||n>4095||r>1073741823||i>4294967295)throw new RangeError("invalid field value");var s=new Uint8Array(16);return s[0]=e/Math.pow(2,40),s[1]=e/Math.pow(2,32),s[2]=e/Math.pow(2,24),s[3]=e/Math.pow(2,16),s[4]=e/Math.pow(2,8),s[5]=e,s[6]=112|n>>>8,s[7]=n,s[8]=128|r>>>24,s[9]=r>>>16,s[10]=r>>>8,s[11]=r,s[12]=i>>>24,s[13]=i>>>16,s[14]=i>>>8,s[15]=i,new t(s)}}]),t}(),rHe=function(){function t(){tn(this,t),pe(this,"timestamp",0),pe(this,"counter",0),pe(this,"random",new iHe)}return nn(t,[{key:"generate",value:function(){var e=this.generateOrAbort();if(Xe(e)){this.timestamp=0;var n=this.generateOrAbort();if(Xe(n))throw new Error("Could not generate UUID after timestamp reset");return n}return e}},{key:"generateOrAbort",value:function(){var e=Date.now();if(e>this.timestamp)this.timestamp=e,this.resetCounter();else{if(!(e+1e4>this.timestamp))return;this.counter++,this.counter>4398046511103&&(this.timestamp++,this.resetCounter())}return nHe.fromFieldsV7(this.timestamp,Math.trunc(this.counter/Math.pow(2,30)),this.counter&Math.pow(2,30)-1,this.random.nextUint32())}},{key:"resetCounter",value:function(){this.counter=1024*this.random.nextUint32()+(1023&this.random.nextUint32())}}]),t}(),Ece=function(t){if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var e=0;e<t.length;e++)t[e]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return t};oe&&!Xe(oe.crypto)&&crypto.getRandomValues&&(Ece=function(t){return crypto.getRandomValues(t)});var fK,iHe=function(){function t(){tn(this,t),pe(this,"buffer",new Uint32Array(8)),pe(this,"cursor",1/0)}return nn(t,[{key:"nextUint32",value:function(){return this.cursor>=this.buffer.length&&(Ece(this.buffer),this.cursor=0),this.buffer[this.cursor++]}}]),t}(),Yd=function(){return sHe().toString()},sHe=function(){return(fK||(fK=new rHe)).generate()},oHe="Thu, 01 Jan 1970 00:00:00 GMT",H1="",aHe=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i;function cHe(t,e){if(e){var n=function(i){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$e;if(H1)return H1;if(!s||["localhost","127.0.0.1"].includes(i))return"";for(var o=i.split("."),a=Math.min(o.length,8),c="dmn_chk_"+Yd(),l=new RegExp("(^|;)\\s*"+c+"=1");!H1&&a--;){var d=o.slice(a).join("."),h=c+"=1;domain=."+d;s.cookie=h,l.test(s.cookie)&&(s.cookie=h+";expires="+oHe,H1=d)}return H1}(t);if(!n){var r=function(i){var s=i.match(aHe);return s?s[0]:""}(t);r!==n&&Ee.info("Warning: cookie subdomain discovery mismatch",r,n),n=r}return n?"; domain=."+n:""}return""}var Mi,Cu={is_supported:function(){return!!$e},error:function(t){Ee.error("cookieStore error: "+t)},get:function(t){if($e){try{for(var e=t+"=",n=$e.cookie.split(";").filter(function(s){return s.length}),r=0;r<n.length;r++){for(var i=n[r];i.charAt(0)==" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return decodeURIComponent(i.substring(e.length,i.length))}}catch{}return null}},parse:function(t){var e;try{e=JSON.parse(Cu.get(t))||{}}catch{}return e},set:function(t,e,n,r,i){if($e)try{var s="",o="",a=cHe($e.location.hostname,r);if(n){var c=new Date;c.setTime(c.getTime()+24*n*60*60*1e3),s="; expires="+c.toUTCString()}i&&(o="; secure");var l=t+"="+encodeURIComponent(JSON.stringify(e))+s+"; SameSite=Lax; path=/"+a+o;return l.length>3686.4&&Ee.warn("cookieStore warning: large cookie, len="+l.length),$e.cookie=l,l}catch{return}},remove:function(t,e){try{Cu.set(t,"",-1,e)}catch{return}}},kx=null,ri={is_supported:function(){if(!zu(kx))return kx;var t=!0;if(Xe(oe))t=!1;else try{var e="__mplssupport__";ri.set(e,"xyz"),ri.get(e)!=='"xyz"'&&(t=!1),ri.remove(e)}catch{t=!1}return t||Ee.error("localStorage unsupported; falling back to cookie store"),kx=t,t},error:function(t){Ee.error("localStorage error: "+t)},get:function(t){try{return oe?.localStorage.getItem(t)}catch(e){ri.error(e)}return null},parse:function(t){try{return JSON.parse(ri.get(t))||{}}catch{}return null},set:function(t,e){try{oe?.localStorage.setItem(t,JSON.stringify(e))}catch(n){ri.error(n)}},remove:function(t){try{oe?.localStorage.removeItem(t)}catch(e){ri.error(e)}}},lHe=["distinct_id",a3,Gy,l3],dE=Ne(Ne({},ri),{},{parse:function(t){try{var e={};try{e=Cu.parse(t)||{}}catch{}var n=hs(e,JSON.parse(ri.get(t)||"{}"));return ri.set(t,n),n}catch{}return null},set:function(t,e,n,r,i,s){try{ri.set(t,e,void 0,void 0,s);var o={};lHe.forEach(function(a){e[a]&&(o[a]=e[a])}),Object.keys(o).length&&Cu.set(t,o,n,r,i,s)}catch(a){ri.error(a)}},remove:function(t,e){try{oe?.localStorage.removeItem(t),Cu.remove(t,e)}catch(n){ri.error(n)}}}),fE={},uHe={is_supported:function(){return!0},error:function(t){Ee.error("memoryStorage error: "+t)},get:function(t){return fE[t]||null},parse:function(t){return fE[t]||null},set:function(t,e){fE[t]=e},remove:function(t){delete fE[t]}},yh=null,ji={is_supported:function(){if(!zu(yh))return yh;if(yh=!0,Xe(oe))yh=!1;else try{var t="__support__";ji.set(t,"xyz"),ji.get(t)!=='"xyz"'&&(yh=!1),ji.remove(t)}catch{yh=!1}return yh},error:function(t){Ee.error("sessionStorage error: ",t)},get:function(t){try{return oe?.sessionStorage.getItem(t)}catch(e){ji.error(e)}return null},parse:function(t){try{return JSON.parse(ji.get(t))||null}catch{}return null},set:function(t,e){try{oe?.sessionStorage.setItem(t,JSON.stringify(e))}catch(n){ji.error(n)}},remove:function(t){try{oe?.sessionStorage.removeItem(t)}catch(e){ji.error(e)}}},dHe=["localhost","127.0.0.1"],Ky=function(t){var e=$e?.createElement("a");return Xe(e)?null:(e.href=t,e)},u3=function(t,e){return!!function(n){try{new RegExp(n)}catch{return!1}return!0}(e)&&new RegExp(e).test(t)},fHe=function(t){var e,n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"&",i=[];return Pn(t,function(s,o){Xe(s)||Xe(o)||o==="undefined"||(e=encodeURIComponent(function(a){return a instanceof File}(s)?s.name:s.toString()),n=encodeURIComponent(o),i[i.length]=n+"="+e)}),i.join(r)},hK=function(t,e){for(var n,r=((t.split("#")[0]||"").split("?")[1]||"").split("&"),i=0;i<r.length;i++){var s=r[i].split("=");if(s[0]===e){n=s;break}}if(!oi(n)||n.length<2)return"";var o=n[1];try{o=decodeURIComponent(o)}catch{Ee.error("Skipping decoding for malformed query param: "+o)}return o.replace(/\+/g," ")},d3=function(t,e){var n=t.match(new RegExp(e+"=([^&]*)"));return n?n[1]:null},ya="Mobile",f3="iOS",Xc="Android",$b="Tablet",wce=Xc+" "+$b,Cce="iPad",Tce="Apple",Rce=Tce+" Watch",Bb="Safari",Sv="BlackBerry",Ice="Samsung",kce=Ice+"Browser",xce=Ice+" Internet",of="Chrome",hHe=of+" OS",Ace=of+" "+f3,T8="Internet Explorer",Pce=T8+" "+ya,R8="Opera",pHe=R8+" Mini",I8="Edge",Lce="Microsoft "+I8,Bg="Firefox",Oce=Bg+" "+f3,Hb="Nintendo",Vb="PlayStation",Hg="Xbox",Mce=Xc+" "+ya,Dce=ya+" "+Bb,yy="Windows",TL=yy+" Phone",pK="Nokia",RL="Ouya",Nce="Generic",mHe=Nce+" "+ya.toLowerCase(),Uce=Nce+" "+$b.toLowerCase(),IL="Konqueror",ss="(\\d+(\\.\\d+)?)",xx=new RegExp("Version/"+ss),gHe=new RegExp(Hg,"i"),vHe=new RegExp(Vb+" \\w+","i"),yHe=new RegExp(Hb+" \\w+","i"),k8=new RegExp(Sv+"|PlayBook|BB10","i"),bHe={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"},_He=function(t,e){return e&&Ft(e,Tce)||function(n){return Ft(n,Bb)&&!Ft(n,of)&&!Ft(n,Xc)}(t)},mK=function(t,e){return e=e||"",Ft(t," OPR/")&&Ft(t,"Mini")?pHe:Ft(t," OPR/")?R8:k8.test(t)?Sv:Ft(t,"IE"+ya)||Ft(t,"WPDesktop")?Pce:Ft(t,kce)?xce:Ft(t,I8)||Ft(t,"Edg/")?Lce:Ft(t,"FBIOS")?"Facebook "+ya:Ft(t,"UCWEB")||Ft(t,"UCBrowser")?"UC Browser":Ft(t,"CriOS")?Ace:Ft(t,"CrMo")?of:Ft(t,Xc)&&Ft(t,Bb)?Mce:Ft(t,of)?of:Ft(t,"FxiOS")?Oce:Ft(t.toLowerCase(),IL.toLowerCase())?IL:_He(t,e)?Ft(t,ya)?Dce:Bb:Ft(t,Bg)?Bg:Ft(t,"MSIE")||Ft(t,"Trident/")?T8:Ft(t,"Gecko")?Bg:""},SHe=(pe(Mi={},Pce,[new RegExp("rv:"+ss)]),pe(Mi,Lce,[new RegExp(I8+"?\\/"+ss)]),pe(Mi,of,[new RegExp("("+of+"|CrMo)\\/"+ss)]),pe(Mi,Ace,[new RegExp("CriOS\\/"+ss)]),pe(Mi,"UC Browser",[new RegExp("(UCBrowser|UCWEB)\\/"+ss)]),pe(Mi,Bb,[xx]),pe(Mi,Dce,[xx]),pe(Mi,R8,[new RegExp("(Opera|OPR)\\/"+ss)]),pe(Mi,Bg,[new RegExp(Bg+"\\/"+ss)]),pe(Mi,Oce,[new RegExp("FxiOS\\/"+ss)]),pe(Mi,IL,[new RegExp("Konqueror[:/]?"+ss,"i")]),pe(Mi,Sv,[new RegExp(Sv+" "+ss),xx]),pe(Mi,Mce,[new RegExp("android\\s"+ss,"i")]),pe(Mi,xce,[new RegExp(kce+"\\/"+ss)]),pe(Mi,T8,[new RegExp("(rv:|MSIE )"+ss)]),pe(Mi,"Mozilla",[new RegExp("rv:"+ss)]),Mi),gK=[[new RegExp(Hg+"; "+Hg+" (.*?)[);]","i"),function(t){return[Hg,t&&t[1]||""]}],[new RegExp(Hb,"i"),[Hb,""]],[new RegExp(Vb,"i"),[Vb,""]],[k8,[Sv,""]],[new RegExp(yy,"i"),function(t,e){if(/Phone/.test(e)||/WPDesktop/.test(e))return[TL,""];if(new RegExp(ya).test(e)&&!/IEMobile\b/.test(e))return[yy+" "+ya,""];var n=/Windows NT ([0-9.]+)/i.exec(e);if(n&&n[1]){var r=n[1],i=bHe[r]||"";return/arm/i.test(e)&&(i="RT"),[yy,i]}return[yy,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,function(t){if(t&&t[3]){var e=[t[3],t[4],t[5]||"0"];return[f3,e.join(".")]}return[f3,""]}],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,function(t){var e="";return t&&t.length>=3&&(e=Xe(t[2])?t[3]:t[2]),["watchOS",e]}],[new RegExp("("+Xc+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+Xc+")","i"),function(t){if(t&&t[2]){var e=[t[2],t[3],t[4]||"0"];return[Xc,e.join(".")]}return[Xc,""]}],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,function(t){var e=["Mac OS X",""];if(t&&t[1]){var n=[t[1],t[2],t[3]||"0"];e[1]=n.join(".")}return e}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[hHe,""]],[/Linux|debian/i,["Linux",""]]],vK=function(t){return yHe.test(t)?Hb:vHe.test(t)?Vb:gHe.test(t)?Hg:new RegExp(RL,"i").test(t)?RL:new RegExp("("+TL+"|WPDesktop)","i").test(t)?TL:/iPad/.test(t)?Cce:/iPod/.test(t)?"iPod Touch":/iPhone/.test(t)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(t)?Rce:k8.test(t)?Sv:/(kobo)\s(ereader|touch)/i.test(t)?"Kobo":new RegExp(pK,"i").test(t)?pK:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(t)||/(kf[a-z]+)( bui|\)).+silk\//i.test(t)?"Kindle Fire":/(Android|ZTE)/i.test(t)?!new RegExp(ya).test(t)||/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(t)?/pixel[\daxl ]{1,6}/i.test(t)&&!/pixel c/i.test(t)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(t)||/lmy47v/i.test(t)&&!/QTAQZ3/i.test(t)?Xc:wce:Xc:new RegExp("(pda|"+ya+")","i").test(t)?mHe:new RegExp($b,"i").test(t)&&!new RegExp($b+" pc","i").test(t)?Uce:""},hE="https?://(.*)",EHe=["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","gad_source","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","mc_cid","igshid","ttclid","rdt_cid"],Si={campaignParams:function(t){return $e?this._campaignParamsFromUrl($e.URL,t):{}},_campaignParamsFromUrl:function(t,e){var n=EHe.concat(e||[]),r={};return Pn(n,function(i){var s=hK(t,i);s&&(r[i]=s)}),r},_searchEngine:function(t){return t?t.search(hE+"google.([^/?]*)")===0?"google":t.search(hE+"bing.com")===0?"bing":t.search(hE+"yahoo.com")===0?"yahoo":t.search(hE+"duckduckgo.com")===0?"duckduckgo":null:null},_searchInfoFromReferrer:function(t){var e=Si._searchEngine(t),n=e!="yahoo"?"q":"p",r={};if(!zu(e)){r.$search_engine=e;var i=$e?hK($e.referrer,n):"";i.length&&(r.ph_keyword=i)}return r},searchInfo:function(){var t=$e?.referrer;return t?this._searchInfoFromReferrer(t):{}},browser:mK,browserVersion:function(t,e){var n=mK(t,e),r=SHe[n];if(Xe(r))return null;for(var i=0;i<r.length;i++){var s=r[i],o=t.match(s);if(o)return parseFloat(o[o.length-2])}return null},browserLanguage:function(){return navigator.language||navigator.userLanguage},os:function(t){for(var e=0;e<gK.length;e++){var n=fs(gK[e],2),r=n[0],i=n[1],s=r.exec(t),o=s&&(da(i)?i(s,t):i);if(o)return o}return["",""]},device:vK,deviceType:function(t){var e=vK(t);return e===Cce||e===wce||e==="Kobo"||e==="Kindle Fire"||e===Uce?$b:e===Hb||e===Hg||e===Vb||e===RL?"Console":e===Rce?"Wearable":e?ya:"Desktop"},referrer:function(){return $e?.referrer||"$direct"},referringDomain:function(){var t;return $e!=null&&$e.referrer&&((t=Ky($e.referrer))===null||t===void 0?void 0:t.host)||"$direct"},referrerInfo:function(){return{$referrer:this.referrer(),$referring_domain:this.referringDomain()}},initialPersonInfo:function(){return{r:this.referrer(),u:Ns?.href}},initialPersonPropsFromInfo:function(t){var e,n=t.r,r=t.u,i={$initial_referrer:n,$initial_referring_domain:n==null?void 0:n=="$direct"?"$direct":(e=Ky(n))===null||e===void 0?void 0:e.host};if(r){i.$initial_current_url=r;var s=Ky(r);i.$initial_host=s?.host,i.$initial_pathname=s?.pathname,Pn(this._campaignParamsFromUrl(r),function(o,a){i["$initial_"+mL(a)]=o})}return n&&Pn(this._searchInfoFromReferrer(n),function(o,a){i["$initial_"+mL(a)]=o}),i},properties:function(){if(!_i)return{};var t=fs(Si.os(_i),2),e=t[0],n=t[1];return hs(pL({$os:e,$os_version:n,$browser:Si.browser(_i,navigator.vendor),$device:Si.device(_i),$device_type:Si.deviceType(_i)}),{$current_url:Ns?.href,$host:Ns?.host,$pathname:Ns?.pathname,$raw_user_agent:_i.length>1e3?_i.substring(0,997)+"...":_i,$browser_version:Si.browserVersion(_i,navigator.vendor),$browser_language:Si.browserLanguage(),$screen_height:oe?.screen.height,$screen_width:oe?.screen.width,$viewport_height:oe?.innerHeight,$viewport_width:oe?.innerWidth,$lib:"web",$lib_version:na.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:bce()/1e3})},people_properties:function(){if(!_i)return{};var t=fs(Si.os(_i),2),e=t[0],n=t[1];return hs(pL({$os:e,$os_version:n,$browser:Si.browser(_i,navigator.vendor)}),{$browser_version:Si.browserVersion(_i,navigator.vendor)})}},wHe=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"],Ax=function(){function t(e){tn(this,t),this.config=e,this.props={},this.campaign_params_saved=!1,this.name=function(n){var r="";return n.token&&(r=n.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),n.persistence_name?"ph_"+n.persistence_name:"ph_"+r+"_posthog"}(e),this.storage=this.buildStorage(e),this.load(),e.debug&&Ee.info("Persistence loaded",e.persistence,Ne({},this.props)),this.update_config(e,e),this.save()}return nn(t,[{key:"buildStorage",value:function(e){wHe.indexOf(e.persistence.toLowerCase())===-1&&(Ee.critical("Unknown persistence type "+e.persistence+"; falling back to localStorage+cookie"),e.persistence="localStorage+cookie");var n=e.persistence.toLowerCase();return n==="localstorage"&&ri.is_supported()?ri:n==="localstorage+cookie"&&dE.is_supported()?dE:n==="sessionstorage"&&ji.is_supported()?ji:n==="memory"?uHe:n==="cookie"?Cu:dE.is_supported()?dE:Cu}},{key:"properties",value:function(){var e={};return Pn(this.props,function(n,r){if(r===mg&&Fi(n))for(var i=Object.keys(n),s=0;s<i.length;s++)e["$feature/".concat(i[s])]=n[i[s]];else a=r,c=!1,(zu(o=eHe)?c:YG&&o.indexOf===YG?o.indexOf(a)!=-1:(Pn(o,function(l){if(c||(c=l===a))return o3}),c))||(e[r]=n);var o,a,c}),e}},{key:"load",value:function(){if(!this.disabled){var e=this.storage.parse(this.name);e&&(this.props=hs({},e))}}},{key:"save",value:function(){this.disabled||this.storage.set(this.name,this.props,this.expire_days,this.cross_subdomain,this.secure,this.config.debug)}},{key:"remove",value:function(){this.storage.remove(this.name,!1),this.storage.remove(this.name,!0)}},{key:"clear",value:function(){this.remove(),this.props={}}},{key:"register_once",value:function(e,n,r){var i=this;if(Fi(e)){Xe(n)&&(n="None"),this.expire_days=Xe(r)?this.default_expiry:r;var s=!1;if(Pn(e,function(o,a){i.props.hasOwnProperty(a)&&i.props[a]!==n||(i.props[a]=o,s=!0)}),s)return this.save(),!0}return!1}},{key:"register",value:function(e,n){var r=this;if(Fi(e)){this.expire_days=Xe(n)?this.default_expiry:n;var i=!1;if(Pn(e,function(s,o){e.hasOwnProperty(o)&&r.props[o]!==s&&(r.props[o]=s,i=!0)}),i)return this.save(),!0}return!1}},{key:"unregister",value:function(e){e in this.props&&(delete this.props[e],this.save())}},{key:"update_campaign_params",value:function(){this.campaign_params_saved||(this.register(Si.campaignParams(this.config.custom_campaign_params)),this.campaign_params_saved=!0)}},{key:"update_search_keyword",value:function(){this.register(Si.searchInfo())}},{key:"update_referrer_info",value:function(){this.register_once(Si.referrerInfo(),void 0)}},{key:"set_initial_person_info",value:function(){this.props[EL]||this.props[wL]||this.register_once(pe({},cK,Si.initialPersonInfo()),void 0)}},{key:"get_referrer_info",value:function(){return pL({$referrer:this.props.$referrer,$referring_domain:this.props.$referring_domain})}},{key:"get_initial_props",value:function(){var e=this,n={};Pn([wL,EL],function(s){var o=e.props[s];o&&Pn(o,function(a,c){n["$initial_"+mL(c)]=a})});var r=this.props[cK];if(r){var i=Si.initialPersonPropsFromInfo(r);hs(n,i)}return n}},{key:"safe_merge",value:function(e){return Pn(this.props,function(n,r){r in e||(e[r]=n)}),e}},{key:"update_config",value:function(e,n){if(this.default_expiry=this.expire_days=e.cookie_expiration,this.set_disabled(e.disable_persistence),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie),e.persistence!==n.persistence){var r=this.buildStorage(e),i=this.props;this.clear(),this.storage=r,this.props=i,this.save()}}},{key:"set_disabled",value:function(e){this.disabled=e,this.disabled?this.remove():this.save()}},{key:"set_cross_subdomain",value:function(e){e!==this.cross_subdomain&&(this.cross_subdomain=e,this.remove(),this.save())}},{key:"get_cross_subdomain",value:function(){return!!this.cross_subdomain}},{key:"set_secure",value:function(e){e!==this.secure&&(this.secure=e,this.remove(),this.save())}},{key:"set_event_timer",value:function(e,n){var r=this.props[vy]||{};r[e]=n,this.props[vy]=r,this.save()}},{key:"remove_event_timer",value:function(e){var n=(this.props[vy]||{})[e];return Xe(n)||(delete this.props[vy][e],this.save()),n}},{key:"get_property",value:function(e){return this.props[e]}},{key:"set_property",value:function(e,n){this.props[e]=n,this.save()}}]),t}();function kL(t){return JSON.stringify(t,(e=[],function(n,r){if(Fi(r)){for(;e.length>0&&e.at(-1)!==this;)e.pop();return e.includes(r)?"[Circular]":(e.push(r),r)}return r})).length;var e}var CHe=2,THe=4;function xL(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:66060288e-1;if(t.size>=e&&t.data.length>1){var n=Math.floor(t.data.length/2),r=t.data.slice(0,n),i=t.data.slice(n);return[xL({size:kL(r),data:r,sessionId:t.sessionId,windowId:t.windowId}),xL({size:kL(i),data:i,sessionId:t.sessionId,windowId:t.windowId})].flatMap(function(s){return s})}return[t]}var Dw=function(t){return t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t}(Dw||{}),Vl=function(t){return t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration",t[t.Selection=14]="Selection",t[t.AdoptedStyleSheet=15]="AdoptedStyleSheet",t[t.CustomElement=16]="CustomElement",t}(Vl||{});function x8(t){return t?cR(t).split(/\s+/):[]}function yK(t){var e=oe?.location.href;return!!(e&&t&&t.some(function(n){return e.match(n)}))}function h3(t){var e="";switch(Fb(t.className)){case"string":e=t.className;break;case"object":e=(t.className&&"baseVal"in t.className?t.className.baseVal:null)||t.getAttribute("class")||"";break;default:e=""}return x8(e)}function jce(t){return Xs(t)?null:cR(t).split(/(\s+)/).filter(function(e){return Vg(e)}).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function p3(t){var e="";return PL(t)&&!Hce(t)&&t.childNodes&&t.childNodes.length&&Pn(t.childNodes,function(n){var r;Fce(n)&&n.textContent&&(e+=(r=jce(n.textContent))!==null&&r!==void 0?r:"")}),cR(e)}function A8(t){return!!t&&t.nodeType===1}function af(t,e){return!!t&&!!t.tagName&&t.tagName.toLowerCase()===e.toLowerCase()}function Fce(t){return!!t&&t.nodeType===3}function $ce(t){return!!t&&t.nodeType===11}var AL=["a","button","form","input","select","textarea","label"];function Bce(t){var e=t.parentNode;return!(!e||!A8(e))&&e}function RHe(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!oe||!t||af(t,"html")||!A8(t)||n!=null&&n.url_allowlist&&!yK(n.url_allowlist)||n!=null&&n.url_ignorelist&&yK(n.url_ignorelist))return!1;if(n!=null&&n.dom_event_allowlist){var s=n.dom_event_allowlist;if(s&&!s.some(function(g){return e.type===g}))return!1}for(var o=!1,a=[t],c=!0,l=t;l.parentNode&&!af(l,"body");)if($ce(l.parentNode))a.push(l.parentNode.host),l=l.parentNode.host;else{if(!(c=Bce(l)))break;if(r||AL.indexOf(c.tagName.toLowerCase())>-1)o=!0;else{var d=oe.getComputedStyle(c);d&&d.getPropertyValue("cursor")==="pointer"&&(o=!0)}a.push(c),l=c}if(!function(g,y){var v=y?.element_allowlist;if(Xe(v))return!0;var w,S=wa(g);try{var R=function(){var T=w.value;if(v.some(function(I){return T.tagName.toLowerCase()===I}))return{v:!0}};for(S.s();!(w=S.n()).done;){var x=R();if(Fb(x)==="object")return x.v}}catch(T){S.e(T)}finally{S.f()}return!1}(a,n)||!function(g,y){var v=y?.css_selector_allowlist;if(Xe(v))return!0;var w,S=wa(g);try{var R=function(){var T=w.value;if(v.some(function(I){return T.matches(I)}))return{v:!0}};for(S.s();!(w=S.n()).done;){var x=R();if(Fb(x)==="object")return x.v}}catch(T){S.e(T)}finally{S.f()}return!1}(a,n))return!1;var h=oe.getComputedStyle(t);if(h&&h.getPropertyValue("cursor")==="pointer"&&e.type==="click")return!0;var m=t.tagName.toLowerCase();switch(m){case"html":return!1;case"form":return(i||["submit"]).indexOf(e.type)>=0;case"input":case"select":case"textarea":return(i||["change","click"]).indexOf(e.type)>=0;default:return o?(i||["click"]).indexOf(e.type)>=0:(i||["click"]).indexOf(e.type)>=0&&(AL.indexOf(m)>-1||t.getAttribute("contenteditable")==="true")}}function PL(t){for(var e=t;e.parentNode&&!af(e,"body");e=e.parentNode){var n=h3(e);if(Ft(n,"ph-sensitive")||Ft(n,"ph-no-capture"))return!1}if(Ft(h3(t),"ph-include"))return!0;var r=t.type||"";if(ns(r))switch(r.toLowerCase()){case"hidden":case"password":return!1}var i=t.name||t.id||"";return!(ns(i)&&/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(i.replace(/[^a-zA-Z0-9]/g,"")))}function Hce(t){return!!(af(t,"input")&&!["button","checkbox","submit","reset"].includes(t.type)||af(t,"select")||af(t,"textarea")||t.getAttribute("contenteditable")==="true")}var Vce="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",IHe=new RegExp("^(?:".concat(Vce,")$")),kHe=new RegExp(Vce),qce="\\d{3}-?\\d{2}-?\\d{4}",xHe=new RegExp("^(".concat(qce,")$")),AHe=new RegExp("(".concat(qce,")"));function Vg(t){var e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return!(Xs(t)||ns(t)&&(t=cR(t),(e?IHe:kHe).test((t||"").replace(/[- ]/g,""))||(e?xHe:AHe).test(t)))}function bK(t){var e=p3(t);return Vg(e="".concat(e," ").concat(Gce(t)).trim())?e:""}function Gce(t){var e="";return t&&t.childNodes&&t.childNodes.length&&Pn(t.childNodes,function(n){var r;if(n&&((r=n.tagName)===null||r===void 0?void 0:r.toLowerCase())==="span")try{var i=p3(n);e="".concat(e," ").concat(i).trim(),n.childNodes&&n.childNodes.length&&(e="".concat(e," ").concat(Gce(n)).trim())}catch(s){Ee.error(s)}}),e}function PHe(t){return function(e){var n=e.map(function(r){var i,s,o="";if(r.tag_name&&(o+=r.tag_name),r.attr_class){r.attr_class.sort();var a,c=wa(r.attr_class);try{for(c.s();!(a=c.n()).done;){var l=a.value;o+=".".concat(l.replace(/"/g,""))}}catch(m){c.e(m)}finally{c.f()}}var d=Ne(Ne(Ne(Ne({},r.text?{text:r.text}:{}),{},{"nth-child":(i=r.nth_child)!==null&&i!==void 0?i:0,"nth-of-type":(s=r.nth_of_type)!==null&&s!==void 0?s:0},r.href?{href:r.href}:{}),r.attr_id?{attr_id:r.attr_id}:{}),r.attributes),h={};return Mw(d).sort(function(m,g){var y=fs(m,1)[0],v=fs(g,1)[0];return y.localeCompare(v)}).forEach(function(m){var g=fs(m,2),y=g[0],v=g[1];return h[_K(y.toString())]=_K(v.toString())}),o+=":",o+=Mw(d).map(function(m){var g=fs(m,2),y=g[0],v=g[1];return"".concat(y,'="').concat(v,'"')}).join("")});return n.join(";")}(function(e){return e.map(function(n){var r,i,s={text:(r=n.$el_text)===null||r===void 0?void 0:r.slice(0,400),tag_name:n.tag_name,href:(i=n.attr__href)===null||i===void 0?void 0:i.slice(0,2048),attr_class:LHe(n),attr_id:n.attr__id,nth_child:n.nth_child,nth_of_type:n.nth_of_type,attributes:{}};return Mw(n).filter(function(o){return fs(o,1)[0].indexOf("attr__")===0}).forEach(function(o){var a=fs(o,2),c=a[0],l=a[1];return s.attributes[c]=l}),s})}(t))}function _K(t){return t.replace(/"|\\"/g,'\\"')}function LHe(t){var e=t.attr__class;return e?oi(e)?e:x8(e):void 0}var LL="[SessionRecording]",OL="redacted",pE={initiatorTypes:["audio","beacon","body","css","early-hint","embed","fetch","frame","iframe","icon","image","img","input","link","navigation","object","ping","script","track","video","xmlhttprequest"],maskRequestFn:function(t){return t},recordHeaders:!1,recordBody:!1,recordInitialRequests:!1,recordPerformance:!1,performanceEntryTypeToObserve:["first-input","navigation","paint","resource"],payloadSizeLimitBytes:1e6,payloadHostDenyList:[".lr-ingest.io",".ingest.sentry.io"]},OHe=["authorization","x-forwarded-for","authorization","cookie","set-cookie","x-api-key","x-real-ip","remote-addr","forwarded","proxy-authorization","x-csrf-token","x-csrftoken","x-xsrf-token"],MHe=["password","secret","passwd","api_key","apikey","auth","credentials","mysql_pwd","privatekey","private_key","token"],DHe=["/s/","/e/","/i/"];function SK(t,e,n,r){if(Xs(t))return t;var i=e?.["content-length"]||function(s){return new Blob([s]).size}(t);return ns(i)&&(i=parseInt(i)),i>n?LL+" ".concat(r," body too large to record (").concat(i," bytes)"):t}function EK(t,e){if(Xs(t))return t;var n=t;return Vg(n,!1)||(n=LL+" "+e+" body "+OL),Pn(MHe,function(r){var i,s;(i=n)!==null&&i!==void 0&&i.length&&((s=n)===null||s===void 0?void 0:s.indexOf(r))!==-1&&(n=LL+" "+e+" body "+OL+" as might contain: "+r)}),n}var Jl,NHe=function(t,e){var n,r,i,s={payloadSizeLimitBytes:pE.payloadSizeLimitBytes,performanceEntryTypeToObserve:wu(pE.performanceEntryTypeToObserve),payloadHostDenyList:[].concat(wu(e.payloadHostDenyList||[]),wu(pE.payloadHostDenyList))},o=t.session_recording.recordHeaders!==!1&&e.recordHeaders,a=t.session_recording.recordBody!==!1&&e.recordBody,c=t.capture_performance!==!1&&e.recordPerformance,l=(n=s,i=Math.min(1e6,(r=n.payloadSizeLimitBytes)!==null&&r!==void 0?r:1e6),function(m){return m!=null&&m.requestBody&&(m.requestBody=SK(m.requestBody,m.requestHeaders,i,"Request")),m!=null&&m.responseBody&&(m.responseBody=SK(m.responseBody,m.responseHeaders,i,"Response")),m}),d=function(m){return l(function(v){var w=Ky(v.name);if(!(w&&w.pathname&&DHe.some(function(S){return w.pathname.indexOf(S)===0})))return v}((y=(g=m).requestHeaders,Xs(y)||Pn(Object.keys(y??{}),function(v){OHe.includes(v.toLowerCase())&&(y[v]=OL)}),g)));var g,y},h=da(t.session_recording.maskNetworkRequestFn);return h&&da(t.session_recording.maskCapturedNetworkRequestFn)&&Ee.warn("Both `maskNetworkRequestFn` and `maskCapturedNetworkRequestFn` are defined. `maskNetworkRequestFn` will be ignored."),h&&(t.session_recording.maskCapturedNetworkRequestFn=function(m){var g=t.session_recording.maskNetworkRequestFn({url:m.name});return Ne(Ne({},m),{},{name:g?.url})}),s.maskRequestFn=da(t.session_recording.maskCapturedNetworkRequestFn)?function(m){var g,y,v,w=d(m);return w&&(g=(y=(v=t.session_recording).maskCapturedNetworkRequestFn)===null||y===void 0?void 0:y.call(v,w))!==null&&g!==void 0?g:void 0}:function(m){return function(g){if(!Xe(g))return g.requestBody=EK(g.requestBody,"Request"),g.responseBody=EK(g.responseBody,"Response"),g}(d(m))},Ne(Ne(Ne({},pE),s),{},{recordHeaders:o,recordBody:a,recordPerformance:c,recordInitialRequests:c})},UHe=nn(function t(e){var n,r,i=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};tn(this,t),pe(this,"bucketSize",100),pe(this,"refillRate",10),pe(this,"mutationBuckets",{}),pe(this,"loggedTracker",{}),pe(this,"refillBuckets",function(){Object.keys(i.mutationBuckets).forEach(function(o){i.mutationBuckets[o]=i.mutationBuckets[o]+i.refillRate,i.mutationBuckets[o]>=i.bucketSize&&delete i.mutationBuckets[o]})}),pe(this,"getNodeOrRelevantParent",function(o){var a=i.rrweb.mirror.getNode(o);if(a?.nodeName!=="svg"&&a instanceof Element){var c=a.closest("svg");if(c)return[i.rrweb.mirror.getId(c),c]}return[o,a]}),pe(this,"numberOfChanges",function(o){var a,c,l,d,h,m,g,y;return((a=(c=o.removes)===null||c===void 0?void 0:c.length)!==null&&a!==void 0?a:0)+((l=(d=o.attributes)===null||d===void 0?void 0:d.length)!==null&&l!==void 0?l:0)+((h=(m=o.texts)===null||m===void 0?void 0:m.length)!==null&&h!==void 0?h:0)+((g=(y=o.adds)===null||y===void 0?void 0:y.length)!==null&&g!==void 0?g:0)}),pe(this,"throttleMutations",function(o){if(o.type!==3||o.data.source!==0)return o;var a=o.data,c=i.numberOfChanges(a);a.attributes&&(a.attributes=a.attributes.filter(function(d){var h,m,g,y=fs(i.getNodeOrRelevantParent(d.id),2),v=y[0],w=y[1];return i.mutationBuckets[v]===0?!1:(i.mutationBuckets[v]=(h=i.mutationBuckets[v])!==null&&h!==void 0?h:i.bucketSize,i.mutationBuckets[v]=Math.max(i.mutationBuckets[v]-1,0),i.mutationBuckets[v]===0&&(i.loggedTracker[v]||(i.loggedTracker[v]=!0,(m=(g=i.options).onBlockedNode)===null||m===void 0||m.call(g,v,w))),d)}));var l=i.numberOfChanges(a);return l!==0||c===l?o:void 0}),this.rrweb=e,this.options=s,this.refillRate=(n=this.options.refillRate)!==null&&n!==void 0?n:this.refillRate,this.bucketSize=(r=this.options.bucketSize)!==null&&r!==void 0?r:this.bucketSize,setInterval(function(){i.refillBuckets()},1e3)}),jHe=3e5,FHe=[Vl.MouseMove,Vl.MouseInteraction,Vl.Scroll,Vl.ViewportResize,Vl.Input,Vl.TouchMove,Vl.MediaInteraction,Vl.Drag],wK=function(t){return{rrwebMethod:t,enqueuedAt:Date.now(),attempt:1}},zo="[SessionRecording]",$He=function(){function t(e){var n=this;if(tn(this,t),pe(this,"queuedRRWebEvents",[]),pe(this,"isIdle",!1),pe(this,"_linkedFlagSeen",!1),pe(this,"_lastActivityTimestamp",Date.now()),pe(this,"_linkedFlag",null),pe(this,"_forceAllowLocalhostNetworkCapture",!1),pe(this,"_onBeforeUnload",function(){n._flushBuffer()}),pe(this,"_onOffline",function(){n._tryAddCustomEvent("browser offline",{})}),pe(this,"_onOnline",function(){n._tryAddCustomEvent("browser online",{})}),pe(this,"_onVisibilityChange",function(){if($e!=null&&$e.visibilityState){var o="window "+$e.visibilityState;n._tryAddCustomEvent(o,{})}}),pe(this,"_samplingSessionListener",null),this.instance=e,this._captureStarted=!1,this._endpoint="/s/",this.stopRrweb=void 0,this.receivedDecide=!1,!this.instance.sessionManager)throw Ee.error(zo+" started without valid sessionManager"),new Error(zo+" started without valid sessionManager. This is a bug.");var r=this.sessionManager.checkAndGetSessionAndWindowId(),i=r.sessionId,s=r.windowId;this.sessionId=i,this.windowId=s,this.buffer=this.clearBuffer(),this._setupSampling()}return nn(t,[{key:"rrwebRecord",get:function(){var e;return Zn==null||(e=Zn.rrweb)===null||e===void 0?void 0:e.record}},{key:"started",get:function(){return this._captureStarted}},{key:"sessionManager",get:function(){if(!this.instance.sessionManager)throw new Error(zo+" must be started with a valid sessionManager.");return this.instance.sessionManager}},{key:"fullSnapshotIntervalMillis",get:function(){var e;return((e=this.instance.config.session_recording)===null||e===void 0?void 0:e.full_snapshot_interval_millis)||jHe}},{key:"isSampled",get:function(){var e=this.instance.get_property(Gy);return Uh(e)?e:null}},{key:"sessionDuration",get:function(){var e,n,r=(e=this.buffer)===null||e===void 0?void 0:e.data[((n=this.buffer)===null||n===void 0?void 0:n.data.length)-1],i=this.sessionManager.checkAndGetSessionAndWindowId(!0).sessionStartTimestamp;return r?r.timestamp-i:null}},{key:"isRecordingEnabled",get:function(){var e=!!this.instance.get_property(vL),n=!this.instance.config.disable_session_recording;return oe&&e&&n}},{key:"isConsoleLogCaptureEnabled",get:function(){var e=!!this.instance.get_property(rK),n=this.instance.config.enable_recording_console_log;return n??e}},{key:"canvasRecording",get:function(){var e=this.instance.get_property(sK);return e&&e.fps&&e.quality?{enabled:e.enabled,fps:e.fps,quality:e.quality}:void 0}},{key:"networkPayloadCapture",get:function(){var e,n,r=this.instance.get_property(iK),i={recordHeaders:(e=this.instance.config.session_recording)===null||e===void 0?void 0:e.recordHeaders,recordBody:(n=this.instance.config.session_recording)===null||n===void 0?void 0:n.recordBody},s=i?.recordHeaders||r?.recordHeaders,o=i?.recordBody||r?.recordBody,a=Fi(this.instance.config.capture_performance)?this.instance.config.capture_performance.network_timing:this.instance.config.capture_performance,c=!!(Uh(a)?a:r?.capturePerformance);return s||o||c?{recordHeaders:s,recordBody:o,recordPerformance:c}:void 0}},{key:"sampleRate",get:function(){var e=this.instance.get_property(oK);return ra(e)?e:null}},{key:"minimumDuration",get:function(){var e=this.instance.get_property(aK);return ra(e)?e:null}},{key:"status",get:function(){return this.receivedDecide?this.isRecordingEnabled?Xs(this._linkedFlag)||this._linkedFlagSeen?Uh(this.isSampled)?this.isSampled?"sampled":"disabled":"active":"buffering":"disabled":"buffering"}},{key:"startIfEnabledOrStop",value:function(){this.isRecordingEnabled?(this._startCapture(),oe?.addEventListener("beforeunload",this._onBeforeUnload),oe?.addEventListener("offline",this._onOffline),oe?.addEventListener("online",this._onOnline),oe?.addEventListener("visibilitychange",this._onVisibilityChange),Ee.info(zo+" started")):(this.stopRecording(),this.clearBuffer(),clearInterval(this._fullSnapshotTimer))}},{key:"stopRecording",value:function(){this._captureStarted&&this.stopRrweb&&(this.stopRrweb(),this.stopRrweb=void 0,this._captureStarted=!1,oe?.removeEventListener("beforeunload",this._onBeforeUnload),oe?.removeEventListener("offline",this._onOffline),oe?.removeEventListener("online",this._onOnline),oe?.removeEventListener("visibilitychange",this._onVisibilityChange),Ee.info(zo+" stopped"))}},{key:"makeSamplingDecision",value:function(e){var n,r=this.sessionId!==e,i=this.sampleRate;if(ra(i)){var s,o=this.isSampled,a=r||!Uh(o);a?s=Math.random()<i:s=o,!s&&a&&Ee.warn(zo+" Sample rate (".concat(i,") has determined that this sessionId (").concat(e,") will not be sent to the server.")),this._tryAddCustomEvent("samplingDecisionMade",{sampleRate:i}),(n=this.instance.persistence)===null||n===void 0||n.register(pe({},Gy,s))}else{var c;(c=this.instance.persistence)===null||c===void 0||c.register(pe({},Gy,null))}}},{key:"afterDecideResponse",value:function(e){var n,r,i,s=this;if(this._persistDecideResponse(e),this._linkedFlag=((n=e.sessionRecording)===null||n===void 0?void 0:n.linkedFlag)||null,(r=e.sessionRecording)!==null&&r!==void 0&&r.endpoint&&(this._endpoint=(i=e.sessionRecording)===null||i===void 0?void 0:i.endpoint),this._setupSampling(),!Xs(this._linkedFlag)&&!this._linkedFlagSeen){var o=ns(this._linkedFlag)?this._linkedFlag:this._linkedFlag.flag,a=ns(this._linkedFlag)?null:this._linkedFlag.variant;this.instance.onFeatureFlags(function(c,l){var d=Fi(l)&&o in l,h=a?l[o]===a:d;if(h){var m={linkedFlag:o,linkedVariant:a},g="linked flag matched";Ee.info(zo+" "+g,m),s._tryAddCustomEvent(g,m)}s._linkedFlagSeen=h})}this.receivedDecide=!0,this.startIfEnabledOrStop()}},{key:"_setupSampling",value:function(){var e=this;ra(this.sampleRate)&&zu(this._samplingSessionListener)&&(this._samplingSessionListener=this.sessionManager.onSessionId(function(n){e.makeSamplingDecision(n)}))}},{key:"_persistDecideResponse",value:function(e){if(this.instance.persistence){var n=this.instance.persistence,r=function(){var i,s,o,a,c,l,d,h,m=(i=e.sessionRecording)===null||i===void 0?void 0:i.sampleRate,g=Xs(m)?null:parseFloat(m),y=(s=e.sessionRecording)===null||s===void 0?void 0:s.minimumDurationMilliseconds;n.register((pe(h={},vL,!!e.sessionRecording),pe(h,rK,(o=e.sessionRecording)===null||o===void 0?void 0:o.consoleLogRecordingEnabled),pe(h,iK,Ne({capturePerformance:e.capturePerformance},(a=e.sessionRecording)===null||a===void 0?void 0:a.networkPayloadCapture)),pe(h,sK,{enabled:(c=e.sessionRecording)===null||c===void 0?void 0:c.recordCanvas,fps:(l=e.sessionRecording)===null||l===void 0?void 0:l.canvasFps,quality:(d=e.sessionRecording)===null||d===void 0?void 0:d.canvasQuality}),pe(h,oK,g),pe(h,aK,Xe(y)?null:y),h))};r(),this.sessionManager.onSessionId(r)}}},{key:"log",value:function(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"log";(n=this.instance.sessionRecording)===null||n===void 0||n.onRRwebEmit({type:6,data:{plugin:"rrweb/console@1",payload:{level:r,trace:[],payload:[JSON.stringify(e)]}},timestamp:bce()})}},{key:"_startCapture",value:function(){var e=this;Xe(Object.assign)||this._captureStarted||this.instance.config.disable_session_recording||this.instance.consent.isOptedOut()||(this._captureStarted=!0,this.sessionManager.checkAndGetSessionAndWindowId(),this.rrwebRecord?this._onScriptLoaded():this.instance.requestRouter.loadScript("/static/recorder.js?v=".concat(na.LIB_VERSION),function(n){if(n)return Ee.error(zo+" could not load recorder.js",n);e._onScriptLoaded()}))}},{key:"isInteractiveEvent",value:function(e){var n;return e.type===3&&FHe.indexOf((n=e.data)===null||n===void 0?void 0:n.source)!==-1}},{key:"_updateWindowAndSessionIds",value:function(e){var n=this.isInteractiveEvent(e);n||this.isIdle||e.timestamp-this._lastActivityTimestamp>3e5&&(this.isIdle=!0,clearInterval(this._fullSnapshotTimer),this._flushBuffer());var r=!1;if(n&&(this._lastActivityTimestamp=e.timestamp,this.isIdle&&(this.isIdle=!1,this._tryAddCustomEvent("sessionNoLongerIdle",{reason:"user activity",type:e.type}),r=!0)),!this.isIdle){var i=this.sessionManager.checkAndGetSessionAndWindowId(!n,e.timestamp),s=i.windowId,o=i.sessionId,a=this.sessionId!==o,c=this.windowId!==s;this.windowId=s,this.sessionId=o,(r||[CHe,THe].indexOf(e.type)===-1&&(c||a||Xe(this._fullSnapshotTimer)))&&this._tryTakeFullSnapshot()}}},{key:"_tryRRWebMethod",value:function(e){try{return e.rrwebMethod(),!0}catch(n){return this.queuedRRWebEvents.length<10?this.queuedRRWebEvents.push({enqueuedAt:e.enqueuedAt||Date.now(),attempt:e.attempt++,rrwebMethod:e.rrwebMethod}):Ee.warn(zo+" could not emit queued rrweb event.",n,e),!1}}},{key:"_tryAddCustomEvent",value:function(e,n){var r=this;return this._tryRRWebMethod(wK(function(){return r.rrwebRecord.addCustomEvent(e,n)}))}},{key:"_tryTakeFullSnapshot",value:function(){var e=this;return this._tryRRWebMethod(wK(function(){return e.rrwebRecord.takeFullSnapshot()}))}},{key:"_onScriptLoaded",value:function(){for(var e,n=this,r={blockClass:"ph-no-capture",blockSelector:void 0,ignoreClass:"ph-ignore-input",maskTextClass:"ph-mask",maskTextSelector:void 0,maskTextFn:void 0,maskAllInputs:!0,maskInputOptions:{password:!0},maskInputFn:void 0,slimDOMOptions:{},collectFonts:!1,inlineStylesheet:!0,recordCrossOriginIframes:!1},i=this.instance.config.session_recording,s=0,o=Object.entries(i||{});s<o.length;s++){var a=fs(o[s],2),c=a[0],l=a[1];c in r&&(c==="maskInputOptions"?r.maskInputOptions=Ne({password:!0},l):r[c]=l)}if(this.canvasRecording&&this.canvasRecording.enabled&&(r.recordCanvas=!0,r.sampling={canvas:this.canvasRecording.fps},r.dataURLOptions={type:"image/webp",quality:this.canvasRecording.quality}),this.rrwebRecord){this.mutationRateLimiter=(e=this.mutationRateLimiter)!==null&&e!==void 0?e:new UHe(this.rrwebRecord,{onBlockedNode:function(h,m){var g="Too many mutations on node '".concat(h,"'. Rate limiting. This could be due to SVG animations or something similar");Ee.info(g,{node:m}),n.log(zo+" "+g,"warn")}});var d=this._gatherRRWebPlugins();this.stopRrweb=this.rrwebRecord(Ne({emit:function(h){n.onRRwebEmit(h)},plugins:d},r)),this.instance._addCaptureHook(function(h){try{if(h==="$pageview"){var m=oe?n._maskUrl(oe.location.href):"";if(!m)return;n._tryAddCustomEvent("$pageview",{href:m})}}catch(g){Ee.error("Could not add $pageview to rrweb session",g)}}),this._lastActivityTimestamp=Date.now(),this.isIdle=!1,this._tryAddCustomEvent("$session_options",{sessionRecordingOptions:r,activePlugins:d.map(function(h){return h?.name})}),this._tryAddCustomEvent("$posthog_config",{config:this.instance.config})}else Ee.error(zo+"onScriptLoaded was called but rrwebRecord is not available. This indicates something has gone wrong.")}},{key:"_scheduleFullSnapshot",value:function(){var e=this;if(this._fullSnapshotTimer&&clearInterval(this._fullSnapshotTimer),!this.isIdle){var n=this.fullSnapshotIntervalMillis;n&&(this._fullSnapshotTimer=setInterval(function(){e._tryTakeFullSnapshot()},n))}}},{key:"_gatherRRWebPlugins",value:function(){var e=[];return Zn.rrwebConsoleRecord&&this.isConsoleLogCaptureEnabled&&e.push(Zn.rrwebConsoleRecord.getRecordConsolePlugin()),this.networkPayloadCapture&&da(Zn.getRecordNetworkPlugin)&&(!dHe.includes(location.hostname)||this._forceAllowLocalhostNetworkCapture?e.push(Zn.getRecordNetworkPlugin(NHe(this.instance.config,this.networkPayloadCapture))):Ee.info(zo+" NetworkCapture not started because we are on localhost.")),e}},{key:"onRRwebEmit",value:function(e){if(this._processQueuedEvents(),e&&Fi(e)){if(e.type===Dw.Meta){var n=this._maskUrl(e.data.href);if(this._lastHref=n,!n)return;e.data.href=n}else this._pageViewFallBack();e.type===Dw.FullSnapshot&&this._scheduleFullSnapshot();var r=this.mutationRateLimiter?this.mutationRateLimiter.throttleMutations(e):e;if(r){var i=function(a){var c=a;if(c&&Fi(c)&&c.type===6&&Fi(c.data)&&c.data.plugin==="rrweb/console@1"){c.data.payload.payload.length>10&&(c.data.payload.payload=c.data.payload.payload.slice(0,10),c.data.payload.payload.push("...[truncated]"));for(var l=[],d=0;d<c.data.payload.payload.length;d++)c.data.payload.payload[d]&&c.data.payload.payload[d].length>2e3?l.push(c.data.payload.payload[d].slice(0,2e3)+"...[truncated]"):l.push(c.data.payload.payload[d]);return c.data.payload.payload=l,a}return a}(r),s=kL(i);if(this._updateWindowAndSessionIds(i),!this.isIdle||i.type===Dw.Custom){var o={$snapshot_bytes:s,$snapshot_data:i,$session_id:this.sessionId,$window_id:this.windowId};this.status!=="disabled"?this._captureSnapshotBuffered(o):this.clearBuffer()}}}}},{key:"_pageViewFallBack",value:function(){if(!this.instance.config.capture_pageview&&oe){var e=this._maskUrl(oe.location.href);this._lastHref!==e&&(this._tryAddCustomEvent("$url_changed",{href:e}),this._lastHref=e)}}},{key:"_processQueuedEvents",value:function(){var e=this;if(this.queuedRRWebEvents.length){var n=wu(this.queuedRRWebEvents);this.queuedRRWebEvents=[],n.forEach(function(r){Date.now()-r.enqueuedAt<=2e3&&e._tryRRWebMethod(r)})}}},{key:"_maskUrl",value:function(e){var n=this.instance.config.session_recording;if(n.maskNetworkRequestFn){var r,i={url:e};return(r=i=n.maskNetworkRequestFn(i))===null||r===void 0?void 0:r.url}return e}},{key:"clearBuffer",value:function(){return this.buffer={size:0,data:[],sessionId:this.sessionId,windowId:this.windowId},this.buffer}},{key:"_flushBuffer",value:function(){var e=this;this.flushBufferTimer&&(clearTimeout(this.flushBufferTimer),this.flushBufferTimer=void 0);var n=this.minimumDuration,r=this.sessionDuration,i=ra(r)&&r>=0,s=ra(n)&&i&&r<n;return this.status==="buffering"||s?(this.flushBufferTimer=setTimeout(function(){e._flushBuffer()},2e3),this.buffer):(this.buffer.data.length>0&&xL(this.buffer).forEach(function(o){e._captureSnapshot({$snapshot_bytes:o.size,$snapshot_data:o.data,$session_id:o.sessionId,$window_id:o.windowId})}),this.clearBuffer())}},{key:"_captureSnapshotBuffered",value:function(e){var n,r=this,i=2+(((n=this.buffer)===null||n===void 0?void 0:n.data.length)||0);!this.isIdle&&(this.buffer.size+e.$snapshot_bytes+i>943718.4||this.buffer.sessionId!==this.sessionId)&&(this.buffer=this._flushBuffer()),this.buffer.size+=e.$snapshot_bytes,this.buffer.data.push(e.$snapshot_data),this.flushBufferTimer||this.isIdle||(this.flushBufferTimer=setTimeout(function(){r._flushBuffer()},2e3))}},{key:"_captureSnapshot",value:function(e){this.instance.capture("$snapshot",e,{_url:this.instance.requestRouter.endpointFor("api",this._endpoint),_noTruncate:!0,_batchKey:"recordings",skip_client_rate_limiting:!0})}},{key:"overrideLinkedFlag",value:function(){this._linkedFlagSeen=!0}}]),t}(),BHe=function(){function t(e){tn(this,t),this.instance=e,this.instance.decideEndpointWasHit=this.instance._hasBootstrappedFeatureFlags()}return nn(t,[{key:"call",value:function(){var e=this,n={token:this.instance.config.token,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),person_properties:this.instance.get_property(gg),group_properties:this.instance.get_property(jd),disable_flags:this.instance.config.advanced_disable_feature_flags||this.instance.config.advanced_disable_feature_flags_on_first_load||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:n,compression:this.instance.config.disable_compression?void 0:Qa.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(r){return e.parseDecideResponse(r.json)}})}},{key:"parseDecideResponse",value:function(e){var n=this;this.instance.featureFlags.setReloadingPaused(!1),this.instance.featureFlags._startReloadTimer();var r=!e;if(this.instance.config.advanced_disable_feature_flags_on_first_load||this.instance.config.advanced_disable_feature_flags||this.instance.featureFlags.receivedFeatureFlags(e??{},r),r)Ee.error("Failed to fetch feature flags from PostHog.");else{if(!$e||!$e.body)return Ee.info("document not ready yet, trying again in 500 milliseconds..."),void setTimeout(function(){n.parseDecideResponse(e)},500);if(this.instance._afterDecideResponse(e),e.siteApps)if(this.instance.config.opt_in_site_apps){var i,s=wa(e.siteApps);try{var o=function(){var a=i.value,c=a.id,l=a.url,d=n.instance.requestRouter.endpointFor("api",l);Zn["__$$ph_site_app_".concat(c)]=n.instance,n.instance.requestRouter.loadScript(d,function(h){if(h)return Ee.error("Error while initializing PostHog app with config id ".concat(c),h)})};for(s.s();!(i=s.n()).done;)o()}catch(a){s.e(a)}finally{s.f()}}else e.siteApps.length>0&&Ee.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}}]),t}(),HHe=oe!=null&&oe.location?d3(oe.location.hash,"__posthog")||d3(location.hash,"state"):null,CK="_postHogToolbarParams";(function(t){t[t.UNINITIALIZED=0]="UNINITIALIZED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"})(Jl||(Jl={}));var VHe=function(){function t(e){tn(this,t),this.instance=e}return nn(t,[{key:"setToolbarState",value:function(e){Zn.ph_toolbar_state=e}},{key:"getToolbarState",value:function(){var e;return(e=Zn.ph_toolbar_state)!==null&&e!==void 0?e:Jl.UNINITIALIZED}},{key:"maybeLoadToolbar",value:function(){var e,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;if(!oe||!$e)return!1;r=(e=r)!==null&&e!==void 0?e:oe.location,s=(n=s)!==null&&n!==void 0?n:oe.history;try{if(!i){try{oe.localStorage.setItem("test","test"),oe.localStorage.removeItem("test")}catch{return!1}i=oe?.localStorage}var o,a=HHe||d3(r.hash,"__posthog")||d3(r.hash,"state"),c=a?QG(function(){return JSON.parse(atob(decodeURIComponent(a)))})||QG(function(){return JSON.parse(decodeURIComponent(a))}):null;return c&&c.action==="ph_authorize"?((o=c).source="url",o&&Object.keys(o).length>0&&(c.desiredHash?r.hash=c.desiredHash:s?s.replaceState(s.state,"",r.pathname+r.search):r.hash="")):((o=JSON.parse(i.getItem(CK)||"{}")).source="localstorage",delete o.userIntent),!(!o.token||this.instance.config.token!==o.token)&&(this.loadToolbar(o),!0)}catch{return!1}}},{key:"_callLoadToolbar",value:function(e){(Zn.ph_load_toolbar||Zn.ph_load_editor)(e,this.instance)}},{key:"loadToolbar",value:function(e){var n=this,r=!($e==null||!$e.getElementById(CL));if(!oe||r)return!1;var i=this.instance.requestRouter.region==="custom"&&this.instance.config.advanced_disable_toolbar_metrics,s=Ne(Ne({token:this.instance.config.token},e),{},{apiURL:this.instance.requestRouter.endpointFor("ui")},i?{instrument:!1}:{});if(oe.localStorage.setItem(CK,JSON.stringify(Ne(Ne({},s),{},{source:void 0}))),this.getToolbarState()===Jl.LOADED)this._callLoadToolbar(s);else if(this.getToolbarState()===Jl.UNINITIALIZED){this.setToolbarState(Jl.LOADING);var o=3e5,a=Math.floor(Date.now()/o)*o;this.instance.requestRouter.loadScript("/static/toolbar.js?t=".concat(a),function(c){if(c)return Ee.error("Failed to load toolbar",c),void n.setToolbarState(Jl.UNINITIALIZED);n.setToolbarState(Jl.LOADED),n._callLoadToolbar(s)}),uu(oe,"turbolinks:load",function(){n.setToolbarState(Jl.UNINITIALIZED),n.loadToolbar(s)})}return!0}},{key:"_loadEditor",value:function(e){return this.loadToolbar(e)}},{key:"maybeLoadEditor",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;return this.maybeLoadToolbar(e,n,r)}}]),t}(),qHe=function(){function t(e){tn(this,t),pe(this,"isPaused",!0),pe(this,"queue",[]),pe(this,"flushTimeoutMs",3e3),this.sendRequest=e}return nn(t,[{key:"enqueue",value:function(e){this.queue.push(e),this.flushTimeout||this.setFlushTimeout()}},{key:"unload",value:function(){var e=this;this.clearFlushTimeout();var n=this.queue.length>0?this.formatQueue():{},r=Object.values(n);[].concat(wu(r.filter(function(i){return i.url.indexOf("/e")===0})),wu(r.filter(function(i){return i.url.indexOf("/e")!==0}))).map(function(i){e.sendRequest(Ne(Ne({},i),{},{transport:"sendBeacon"}))})}},{key:"enable",value:function(){this.isPaused=!1,this.setFlushTimeout()}},{key:"setFlushTimeout",value:function(){var e=this;this.isPaused||(this.flushTimeout=setTimeout(function(){if(e.clearFlushTimeout(),e.queue.length>0){var n=e.formatQueue(),r=function(s){var o=n[s],a=new Date().getTime();o.data&&oi(o.data)&&Pn(o.data,function(c){c.offset=Math.abs(c.timestamp-a),delete c.timestamp}),e.sendRequest(o)};for(var i in n)r(i)}},this.flushTimeoutMs))}},{key:"clearFlushTimeout",value:function(){clearTimeout(this.flushTimeout),this.flushTimeout=void 0}},{key:"formatQueue",value:function(){var e={};return Pn(this.queue,function(n){var r,i=n,s=(i?i.batchKey:null)||i.url;Xe(e[s])&&(e[s]=Ne(Ne({},i),{},{data:[]})),(r=e[s].data)===null||r===void 0||r.push(i.data)}),this.queue=[],e}}]),t}(),ba=Uint8Array,Ks=Uint16Array,Ev=Uint32Array,P8=new ba([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),L8=new ba([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),TK=new ba([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Kce=function(t,e){for(var n=new Ks(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];var i=new Ev(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return[n,i]},zce=Kce(P8,2),GHe=zce[0],ML=zce[1];GHe[28]=258,ML[258]=28;for(var RK=Kce(L8,0)[1],Wce=new Ks(32768),Kn=0;Kn<32768;++Kn){var bh=(43690&Kn)>>>1|(21845&Kn)<<1;bh=(61680&(bh=(52428&bh)>>>2|(13107&bh)<<2))>>>4|(3855&bh)<<4,Wce[Kn]=((65280&bh)>>>8|(255&bh)<<8)>>>1}var zy=function(t,e,n){for(var r=t.length,i=0,s=new Ks(e);i<r;++i)++s[t[i]-1];var o,a=new Ks(e);for(i=0;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;for(o=new Ks(r),i=0;i<r;++i)o[i]=Wce[a[t[i]-1]++]>>>15-t[i];return o},pp=new ba(288);for(Kn=0;Kn<144;++Kn)pp[Kn]=8;for(Kn=144;Kn<256;++Kn)pp[Kn]=9;for(Kn=256;Kn<280;++Kn)pp[Kn]=7;for(Kn=280;Kn<288;++Kn)pp[Kn]=8;var m3=new ba(32);for(Kn=0;Kn<32;++Kn)m3[Kn]=5;var KHe=zy(pp,9),zHe=zy(m3,5),Yce=function(t){return(t/8>>0)+(7&t&&1)},Xce=function(t,e,n){(n==null||n>t.length)&&(n=t.length);var r=new(t instanceof Ks?Ks:t instanceof Ev?Ev:ba)(n-e);return r.set(t.subarray(e,n)),r},jl=function(t,e,n){n<<=7&e;var r=e/8>>0;t[r]|=n,t[r+1]|=n>>>8},V1=function(t,e,n){n<<=7&e;var r=e/8>>0;t[r]|=n,t[r+1]|=n>>>8,t[r+2]|=n>>>16},Px=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var i=n.length,s=n.slice();if(!i)return[new ba(0),0];if(i==1){var o=new ba(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort(function(I,k){return I.f-k.f}),n.push({s:-1,f:25001});var a=n[0],c=n[1],l=0,d=1,h=2;for(n[0]={s:-1,f:a.f+c.f,l:a,r:c};d!=i-1;)a=n[n[l].f<n[h].f?l++:h++],c=n[l!=d&&n[l].f<n[h].f?l++:h++],n[d++]={s:-1,f:a.f+c.f,l:a,r:c};var m=s[0].s;for(r=1;r<i;++r)s[r].s>m&&(m=s[r].s);var g=new Ks(m+1),y=WHe(n[d-1],g,0);if(y>e){r=0;var v=0,w=y-e,S=1<<w;for(s.sort(function(I,k){return g[k.s]-g[I.s]||I.f-k.f});r<i;++r){var R=s[r].s;if(!(g[R]>e))break;v+=S-(1<<y-g[R]),g[R]=e}for(v>>>=w;v>0;){var x=s[r].s;g[x]<e?v-=1<<e-g[x]++-1:++r}for(;r>=0&&v;--r){var T=s[r].s;g[T]==e&&(--g[T],++v)}y=e}return[new ba(g),y]},WHe=function t(e,n,r){return e.s==-1?Math.max(t(e.l,n,r+1),t(e.r,n,r+1)):n[e.s]=r},IK=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new Ks(++e),r=0,i=t[0],s=1,o=function(c){n[r++]=c},a=1;a<=e;++a)if(t[a]==i&&a!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(i),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(i);s=1,i=t[a]}return[n.subarray(0,r),e]},q1=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},DL=function(t,e,n){var r=n.length,i=Yce(e+2);t[i]=255&r,t[i+1]=r>>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var s=0;s<r;++s)t[i+s+4]=n[s];return 8*(i+4+r)},kK=function(t,e,n,r,i,s,o,a,c,l,d){jl(e,d++,n),++i[256];for(var h=Px(i,15),m=h[0],g=h[1],y=Px(s,15),v=y[0],w=y[1],S=IK(m),R=S[0],x=S[1],T=IK(v),I=T[0],k=T[1],A=new Ks(19),O=0;O<R.length;++O)A[31&R[O]]++;for(O=0;O<I.length;++O)A[31&I[O]]++;for(var D=Px(A,7),N=D[0],U=D[1],$=19;$>4&&!N[TK[$-1]];--$);var K,Y,G,F,q=l+5<<3,z=q1(i,pp)+q1(s,m3)+o,W=q1(i,m)+q1(s,v)+o+14+3*$+q1(A,N)+(2*A[16]+3*A[17]+7*A[18]);if(q<=z&&q<=W)return DL(e,d,t.subarray(c,c+l));if(jl(e,d,1+(W<z)),d+=2,W<z){K=zy(m,g),Y=m,G=zy(v,w),F=v;var V=zy(N,U);for(jl(e,d,x-257),jl(e,d+5,k-1),jl(e,d+10,$-4),d+=14,O=0;O<$;++O)jl(e,d+3*O,N[TK[O]]);d+=3*$;for(var X=[R,I],ne=0;ne<2;++ne){var fe=X[ne];for(O=0;O<fe.length;++O){var ye=31&fe[O];jl(e,d,V[ye]),d+=N[ye],ye>15&&(jl(e,d,fe[O]>>>5&127),d+=fe[O]>>>12)}}}else K=KHe,Y=pp,G=zHe,F=m3;for(O=0;O<a;++O)if(r[O]>255){ye=r[O]>>>18&31,V1(e,d,K[ye+257]),d+=Y[ye+257],ye>7&&(jl(e,d,r[O]>>>23&31),d+=P8[ye]);var Ae=31&r[O];V1(e,d,G[Ae]),d+=F[Ae],Ae>3&&(V1(e,d,r[O]>>>5&8191),d+=L8[Ae])}else V1(e,d,K[r[O]]),d+=Y[r[O]];return V1(e,d,K[256]),d+Y[256]},YHe=new Ev([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),XHe=function(){for(var t=new Ev(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(1&n&&3988292384)^n>>>1;t[e]=n}return t}(),JHe=function(t,e,n,r,i){return function(s,o,a,c,l,d){var h=s.length,m=new ba(c+h+5*(1+Math.floor(h/7e3))+l),g=m.subarray(c,m.length-l),y=0;if(!o||h<8)for(var v=0;v<=h;v+=65535){var w=v+65535;w<h?y=DL(g,y,s.subarray(v,w)):(g[v]=d,y=DL(g,y,s.subarray(v,h)))}else{for(var S=YHe[o-1],R=S>>>13,x=8191&S,T=(1<<a)-1,I=new Ks(32768),k=new Ks(T+1),A=Math.ceil(a/3),O=2*A,D=function(Dn){return(s[Dn]^s[Dn+1]<<A^s[Dn+2]<<O)&T},N=new Ev(25e3),U=new Ks(288),$=new Ks(32),K=0,Y=0,G=(v=0,0),F=0,q=0;v<h;++v){var z=D(v),W=32767&v,V=k[z];if(I[W]=V,k[z]=W,F<=v){var X=h-v;if((K>7e3||G>24576)&&X>423){y=kK(s,g,0,N,U,$,Y,G,q,v-q,y),G=K=Y=0,q=v;for(var ne=0;ne<286;++ne)U[ne]=0;for(ne=0;ne<30;++ne)$[ne]=0}var fe=2,ye=0,Ae=x,be=W-V&32767;if(X>2&&z==D(v-be))for(var _e=Math.min(R,X)-1,Ie=Math.min(32767,v),Ue=Math.min(258,X);be<=Ie&&--Ae&&W!=V;){if(s[v+fe]==s[v+fe-be]){for(var et=0;et<Ue&&s[v+et]==s[v+et-be];++et);if(et>fe){if(fe=et,ye=be,et>_e)break;var ln=Math.min(be,et-2),Bn=0;for(ne=0;ne<ln;++ne){var Mn=v-be+ne+32768&32767,tt=Mn-I[Mn]+32768&32767;tt>Bn&&(Bn=tt,V=Mn)}}}be+=(W=V)-(V=I[W])+32768&32767}if(ye){N[G++]=268435456|ML[fe]<<18|RK[ye];var Aa=31&ML[fe],bl=31&RK[ye];Y+=P8[Aa]+L8[bl],++U[257+Aa],++$[bl],F=v+fe,++K}else N[G++]=s[v],++U[s[v]]}}y=kK(s,g,d,N,U,$,Y,G,q,v-q,y)}return Xce(m,0,c+Yce(y)+l)}(t,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,n,r,!0)},Lx=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8};function QHe(t,e){e===void 0&&(e={});var n=function(){var a=4294967295;return{p:function(c){for(var l=a,d=0;d<c.length;++d)l=XHe[255&l^c[d]]^l>>>8;a=l},d:function(){return 4294967295^a}}}(),r=t.length;n.p(t);var i,s=JHe(t,e,10+((i=e).filename&&i.filename.length+1||0),8),o=s.length;return function(a,c){var l=c.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=c.level<2?4:c.level==9?2:0,a[9]=3,c.mtime!=0&&Lx(a,4,Math.floor(new Date(c.mtime||Date.now())/1e3)),l){a[3]=8;for(var d=0;d<=l.length;++d)a[d+10]=l.charCodeAt(d)}}(s,e),Lx(s,o-8,n.d()),Lx(s,o-4,r),s}var ZHe=!!hL||!!fL,xK="text/plain",g3=function(t,e){var n=fs(t.split("?"),2),r=n[0],i=n[1],s=Ne({},e);i?.split("&").forEach(function(a){var c=fs(a.split("="),1)[0];delete s[c]});var o=fHe(s);return o=o?(i?i+"&":"")+o:i,"".concat(r,"?").concat(o)},eVe=function(t){return"data="+encodeURIComponent(typeof t=="string"?t:JSON.stringify(t))},Ox=function(t){var e=t.data,n=t.compression;if(e){if(n===Qa.GZipJS){var r=QHe(function(s,o){var a=s.length;if(typeof TextEncoder<"u")return new TextEncoder().encode(s);for(var c=new ba(s.length+(s.length>>>1)),l=0,d=function(y){c[l++]=y},h=0;h<a;++h){if(l+5>c.length){var m=new ba(l+8+(a-h<<1));m.set(c),c=m}var g=s.charCodeAt(h);g<128||o?d(g):g<2048?(d(192|g>>>6),d(128|63&g)):g>55295&&g<57344?(d(240|(g=65536+(1047552&g)|1023&s.charCodeAt(++h))>>>18),d(128|g>>>12&63),d(128|g>>>6&63),d(128|63&g)):(d(224|g>>>12),d(128|g>>>6&63),d(128|63&g))}return Xce(c,0,l)}(JSON.stringify(e)),{mtime:0});return{contentType:xK,body:new Blob([r],{type:xK})}}if(n===Qa.Base64){var i=function(s){var o,a,c,l,d,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",m=0,g=0,y="",v=[];if(!s)return s;s=ZBe(s);do o=(d=s.charCodeAt(m++)<<16|s.charCodeAt(m++)<<8|s.charCodeAt(m++))>>18&63,a=d>>12&63,c=d>>6&63,l=63&d,v[g++]=h.charAt(o)+h.charAt(a)+h.charAt(c)+h.charAt(l);while(m<s.length);switch(y=v.join(""),s.length%3){case 1:y=y.slice(0,-2)+"==";break;case 2:y=y.slice(0,-1)+"="}return y}(JSON.stringify(e));return{contentType:"application/x-www-form-urlencoded",body:eVe(i)}}return{contentType:"application/json",body:JSON.stringify(e)}}},Wy=[];hL&&Wy.push({transport:"XHR",method:function(t){var e,n=new hL;n.open(t.method||"GET",t.url,!0);var r=(e=Ox(t))!==null&&e!==void 0?e:{},i=r.contentType,s=r.body;Pn(t.headers,function(o,a){n.setRequestHeader(a,o)}),i&&n.setRequestHeader("Content-Type",i),t.timeout&&(n.timeout=t.timeout),n.withCredentials=!0,n.onreadystatechange=function(){if(n.readyState===4){var o,a={statusCode:n.status,text:n.responseText};if(n.status===200)try{a.json=JSON.parse(n.responseText)}catch{}(o=t.callback)===null||o===void 0||o.call(t,a)}},n.send(s)}}),fL&&Wy.push({transport:"fetch",method:function(t){var e,n,r=(e=Ox(t))!==null&&e!==void 0?e:{},i=r.contentType,s=r.body,o=new Headers;Pn(t.headers,function(d,h){o.append(h,d)}),i&&o.append("Content-Type",i);var a=t.url,c=null;if(XG){var l=new XG;c={signal:l.signal,timeout:setTimeout(function(){return l.abort()},t.timeout)}}fL(a,{method:t?.method||"GET",headers:o,keepalive:t.method==="POST",body:s,signal:(n=c)===null||n===void 0?void 0:n.signal}).then(function(d){return d.text().then(function(h){var m,g={statusCode:d.status,text:h};if(d.status===200)try{g.json=JSON.parse(h)}catch(y){Ee.error(y)}(m=t.callback)===null||m===void 0||m.call(t,g)})}).catch(function(d){var h;Ee.error(d),(h=t.callback)===null||h===void 0||h.call(t,{statusCode:0,text:d})}).finally(function(){return c?clearTimeout(c.timeout):null})}}),ec!=null&&ec.sendBeacon&&Wy.push({transport:"sendBeacon",method:function(t){var e=g3(t.url,{beacon:"1"});try{var n,r=(n=Ox(t))!==null&&n!==void 0?n:{},i=r.contentType,s=r.body,o=typeof s=="string"?new Blob([s],{type:i}):s;ec.sendBeacon(e,o)}catch{}}});var tVe=["retriesPerformedSoFar"],jh,nVe=function(){function t(e){var n=this;tn(this,t),pe(this,"isPolling",!1),pe(this,"pollIntervalMs",3e3),pe(this,"queue",[]),this.instance=e,this.queue=[],this.areWeOnline=!0,!Xe(oe)&&"onLine"in oe.navigator&&(this.areWeOnline=oe.navigator.onLine,oe.addEventListener("online",function(){n.areWeOnline=!0,n.flush()}),oe.addEventListener("offline",function(){n.areWeOnline=!1}))}return nn(t,[{key:"retriableRequest",value:function(e){var n=this,r=e.retriesPerformedSoFar,i=WBe(e,tVe);ra(r)&&r>0&&(i.url=g3(i.url,{retry_count:r})),this.instance._send_request(Ne(Ne({},i),{},{callback:function(s){var o;s.statusCode!==200&&(s.statusCode<400||s.statusCode>=500)&&(r??0)<10?n.enqueue(Ne({retriesPerformedSoFar:r},i)):(o=i.callback)===null||o===void 0||o.call(i,s)}}))}},{key:"enqueue",value:function(e){var n=e.retriesPerformedSoFar||0;e.retriesPerformedSoFar=n+1;var r=function(o){var a=3e3*Math.pow(2,o),c=a/2,l=Math.min(18e5,a),d=(Math.random()-.5)*(l-c);return Math.ceil(l+d)}(n),i=Date.now()+r;this.queue.push({retryAt:i,requestOptions:e});var s="Enqueued failed request for retry in ".concat(r);navigator.onLine||(s+=" (Browser is offline)"),Ee.warn(s),this.isPolling||(this.isPolling=!0,this.poll())}},{key:"poll",value:function(){var e=this;this.poller&&clearTimeout(this.poller),this.poller=setTimeout(function(){e.areWeOnline&&e.queue.length>0&&e.flush(),e.poll()},this.pollIntervalMs)}},{key:"flush",value:function(){var e=Date.now(),n=[],r=this.queue.filter(function(a){return a.retryAt<e||(n.push(a),!1)});if(this.queue=n,r.length>0){var i,s=wa(r);try{for(s.s();!(i=s.n()).done;){var o=i.value.requestOptions;this.retriableRequest(o)}}catch(a){s.e(a)}finally{s.f()}}}},{key:"unload",value:function(){this.poller&&(clearTimeout(this.poller),this.poller=void 0);var e,n=wa(this.queue);try{for(n.s();!(e=n.n()).done;){var r=e.value.requestOptions;try{this.instance._send_request(Ne(Ne({},r),{},{transport:"sendBeacon"}))}catch(i){Ee.error(i)}}}catch(i){n.e(i)}finally{n.f()}this.queue=[]}}]),t}(),mE=1800,rVe=function(){function t(e,n,r,i){var s;tn(this,t),pe(this,"_sessionIdChangedHandlers",[]),this.config=e,this.persistence=n,this._windowId=void 0,this._sessionId=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this._sessionIdGenerator=r||Yd,this._windowIdGenerator=i||Yd;var o=e.persistence_name||e.token,a=e.session_idle_timeout_seconds||mE;if(ra(a)?a>mE?Ee.warn("session_idle_timeout_seconds cannot be  greater than 30 minutes. Using 30 minutes instead."):a<60&&Ee.warn("session_idle_timeout_seconds cannot be less than 60 seconds. Using 60 seconds instead."):(Ee.warn("session_idle_timeout_seconds must be a number. Defaulting to 30 minutes."),a=mE),this._sessionTimeoutMs=1e3*Math.min(Math.max(a,60),mE),this._window_id_storage_key="ph_"+o+"_window_id",this._primary_window_exists_storage_key="ph_"+o+"_primary_window_exists",this._canUseSessionStorage()){var c=ji.parse(this._window_id_storage_key),l=ji.parse(this._primary_window_exists_storage_key);c&&!l?this._windowId=c:ji.remove(this._window_id_storage_key),ji.set(this._primary_window_exists_storage_key,!0)}if((s=this.config.bootstrap)!==null&&s!==void 0&&s.sessionID)try{var d=function(h){var m=h.replace(/-/g,"");if(m.length!==32)throw new Error("Not a valid UUID");if(m[12]!=="7")throw new Error("Not a UUIDv7");return parseInt(m.substring(0,12),16)}(this.config.bootstrap.sessionID);this._setSessionId(this.config.bootstrap.sessionID,new Date().getTime(),d)}catch(h){Ee.error("Invalid sessionID in bootstrap",h)}this._listenToReloadWindow()}return nn(t,[{key:"onSessionId",value:function(e){var n=this;return Xe(this._sessionIdChangedHandlers)&&(this._sessionIdChangedHandlers=[]),this._sessionIdChangedHandlers.push(e),this._sessionId&&e(this._sessionId,this._windowId),function(){n._sessionIdChangedHandlers=n._sessionIdChangedHandlers.filter(function(r){return r!==e})}}},{key:"_canUseSessionStorage",value:function(){return this.config.persistence!=="memory"&&!this.persistence.disabled&&ji.is_supported()}},{key:"_setWindowId",value:function(e){e!==this._windowId&&(this._windowId=e,this._canUseSessionStorage()&&ji.set(this._window_id_storage_key,e))}},{key:"_getWindowId",value:function(){return this._windowId?this._windowId:this._canUseSessionStorage()?ji.parse(this._window_id_storage_key):null}},{key:"_setSessionId",value:function(e,n,r){e===this._sessionId&&n===this._sessionActivityTimestamp&&r===this._sessionStartTimestamp||(this._sessionStartTimestamp=r,this._sessionActivityTimestamp=n,this._sessionId=e,this.persistence.register(pe({},a3,[n,e,r])))}},{key:"_getSessionId",value:function(){if(this._sessionId&&this._sessionActivityTimestamp&&this._sessionStartTimestamp)return[this._sessionActivityTimestamp,this._sessionId,this._sessionStartTimestamp];var e=this.persistence.props[a3];return oi(e)&&e.length===2&&e.push(e[0]),e||[0,null,0]}},{key:"resetSessionId",value:function(){this._setSessionId(null,null,null)}},{key:"_listenToReloadWindow",value:function(){var e=this;oe?.addEventListener("beforeunload",function(){e._canUseSessionStorage()&&ji.remove(e._primary_window_exists_storage_key)})}},{key:"checkAndGetSessionAndWindowId",value:function(){var e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:null)||new Date().getTime(),r=fs(this._getSessionId(),3),i=r[0],s=r[1],o=r[2],a=this._getWindowId(),c=o&&o>0&&Math.abs(n-o)>864e5,l=!1,d=!s,h=!e&&Math.abs(n-i)>this._sessionTimeoutMs;d||h||c?(s=this._sessionIdGenerator(),a=this._windowIdGenerator(),Ee.info("[SessionId] new session ID generated",{sessionId:s,windowId:a,changeReason:{noSessionId:d,activityTimeout:h,sessionPastMaximumLength:c}}),o=n,l=!0):a||(a=this._windowIdGenerator(),l=!0);var m=i===0||!e||c?n:i,g=o===0?new Date().getTime():o;return this._setWindowId(a),this._setSessionId(s,m,g),l&&this._sessionIdChangedHandlers.forEach(function(y){return y(s,a)}),{sessionId:s,windowId:a,sessionStartTimestamp:g}}}]),t}();(function(t){t.US="us",t.EU="eu",t.CUSTOM="custom"})(jh||(jh={}));var AK="i.posthog.com",iVe=function(){function t(e){tn(this,t),pe(this,"_regionCache",{}),this.instance=e}return nn(t,[{key:"apiHost",get:function(){var e=this.instance.config.api_host.trim().replace(/\/$/,"");return e==="https://app.posthog.com"?"https://us.i.posthog.com":e}},{key:"uiHost",get:function(){var e,n=(e=this.instance.config.ui_host)===null||e===void 0?void 0:e.replace(/\/$/,"");return n||(n=this.apiHost.replace(".".concat(AK),".posthog.com")),n==="https://app.posthog.com"?"https://us.posthog.com":n}},{key:"region",get:function(){return this._regionCache[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=jh.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=jh.EU:this._regionCache[this.apiHost]=jh.CUSTOM),this._regionCache[this.apiHost]}},{key:"endpointFor",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(n&&(n=n[0]==="/"?n:"/".concat(n)),e==="ui")return this.uiHost+n;if(this.region===jh.CUSTOM)return this.apiHost+n;var r=AK+n;switch(e){case"assets":return"https://".concat(this.region,"-assets.").concat(r);case"api":return"https://".concat(this.region,".").concat(r)}}},{key:"loadScript",value:function(e,n){if(this.instance.config.disable_external_dependency_loading)return Ee.warn("".concat(e," was requested but loading of external scripts is disabled.")),n("Loading of external scripts is disabled");var r=e[0]==="/"?this.endpointFor("assets",e):e,i=function(){if(!$e)return n("document not found");var s=$e.createElement("script");s.type="text/javascript",s.src=r,s.onload=function(c){return n(void 0,c)},s.onerror=function(c){return n(c)};var o,a=$e.querySelectorAll("body > script");a.length>0?(o=a[0].parentNode)===null||o===void 0||o.insertBefore(s,a[0]):$e.body.appendChild(s)};$e!=null&&$e.body?i():$e?.addEventListener("DOMContentLoaded",i)}}]),t}(),Jce="posthog-js";function Qce(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.organization,r=e.projectId,i=e.prefix,s=e.severityAllowList,o=s===void 0?["error"]:s;return function(a){var c,l,d,h,m;if(!(o==="*"||o.includes(a.level))||!t.__loaded)return a;a.tags||(a.tags={});var g=t.requestRouter.endpointFor("ui","/project/".concat(t.config.token,"/person/").concat(t.get_distinct_id()));a.tags["PostHog Person URL"]=g,t.sessionRecordingStarted()&&(a.tags["PostHog Recording URL"]=t.get_session_replay_url({withTimestamp:!0}));var y=((c=a.exception)===null||c===void 0?void 0:c.values)||[],v={$exception_message:((l=y[0])===null||l===void 0?void 0:l.value)||a.message,$exception_type:(d=y[0])===null||d===void 0?void 0:d.type,$exception_personURL:g,$exception_level:a.level,$sentry_event_id:a.event_id,$sentry_exception:a.exception,$sentry_exception_message:((h=y[0])===null||h===void 0?void 0:h.value)||a.message,$sentry_exception_type:(m=y[0])===null||m===void 0?void 0:m.type,$sentry_tags:a.tags,$level:a.level};return n&&r&&(v.$sentry_url=(i||"https://sentry.io/organizations/")+n+"/issues/?project="+r+"&query="+a.event_id),t.exceptions.sendExceptionEvent(v),a}}var sVe=nn(function t(e,n,r,i,s){tn(this,t),this.name=Jce,this.setupOnce=function(o){o(Qce(e,{organization:n,projectId:r,prefix:i,severityAllowList:s}))}});function oVe(t,e){var n=t.config.segment;if(!n)return e();(function(r,i){var s=r.config.segment;if(!s)return i();var o=function(c){var l=function(){return c.anonymousId()||Yd()};r.config.get_device_id=l,c.id()&&(r.register({distinct_id:c.id(),$device_id:l()}),r.persistence.set_property(Xl,"identified")),i()},a=s.user();"then"in a&&da(a.then)?a.then(function(c){return o(c)}):o(a)})(t,function(){n.register(function(r){Promise&&Promise.resolve||Ee.warn("This browser does not have Promise support, and can not use the segment integration");var i=function(s,o){var a;if(!o)return s;s.event.userId||s.event.anonymousId===r.get_distinct_id()||(Ee.info("Segment integration does not have a userId set, resetting PostHog"),r.reset()),s.event.userId&&s.event.userId!==r.get_distinct_id()&&(Ee.info("Segment integration has a userId set, identifying with PostHog"),r.identify(s.event.userId));var c=r._calculate_event_properties(o,(a=s.event.properties)!==null&&a!==void 0?a:{},new Date);return s.event.properties=Object.assign({},c,s.event.properties),s};return{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:function(){return!0},load:function(){return Promise.resolve()},track:function(s){return i(s,s.event.event)},page:function(s){return i(s,"$pageview")},identify:function(s){return i(s,"$identify")},screen:function(s){return i(s,"$screen")}}}(t)).then(function(){e()})})}var PK,v3,$a,aVe=function(){function t(e){tn(this,t),this._instance=e}return nn(t,[{key:"doPageView",value:function(e){var n,r=this._previousPageViewProperties(e);return this._currentPath=(n=oe?.location.pathname)!==null&&n!==void 0?n:"",this._instance.scrollManager.resetContext(),this._prevPageviewTimestamp=e,r}},{key:"doPageLeave",value:function(e){return this._previousPageViewProperties(e)}},{key:"_previousPageViewProperties",value:function(e){var n=this._currentPath,r=this._prevPageviewTimestamp,i=this._instance.scrollManager.getContext();if(!r)return{};var s={};if(i){var o=i.maxScrollHeight,a=i.lastScrollY,c=i.maxScrollY,l=i.maxContentHeight,d=i.lastContentY,h=i.maxContentY;Xe(o)||Xe(a)||Xe(c)||Xe(l)||Xe(d)||Xe(h)||(o=Math.ceil(o),a=Math.ceil(a),c=Math.ceil(c),l=Math.ceil(l),d=Math.ceil(d),h=Math.ceil(h),s={$prev_pageview_last_scroll:a,$prev_pageview_last_scroll_percentage:o<=1?1:gE(a/o,0,1),$prev_pageview_max_scroll:c,$prev_pageview_max_scroll_percentage:o<=1?1:gE(c/o,0,1),$prev_pageview_last_content:d,$prev_pageview_last_content_percentage:l<=1?1:gE(d/l,0,1),$prev_pageview_max_content:h,$prev_pageview_max_content_percentage:l<=1?1:gE(h/l,0,1)})}return n&&(s.$prev_pageview_pathname=n),r&&(s.$prev_pageview_duration=(e.getTime()-r.getTime())/1e3),s}}]),t}();function gE(t,e,n){return Math.max(e,Math.min(t,n))}(function(t){t.Popover="popover",t.API="api",t.Widget="widget"})(PK||(PK={})),function(t){t.Open="open",t.MultipleChoice="multiple_choice",t.SingleChoice="single_choice",t.Rating="rating",t.Link="link"}(v3||(v3={})),function(t){t.NextQuestion="next_question",t.End="end",t.ResponseBased="response_based",t.SpecificQuestion="specific_question"}($a||($a={}));var Zce=function(){function t(){tn(this,t),pe(this,"events",{}),this.events={}}return nn(t,[{key:"on",value:function(e,n){var r=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(n),function(){r.events[e]=r.events[e].filter(function(i){return i!==n})}}},{key:"emit",value:function(e,n){var r,i=wa(this.events[e]||[]);try{for(i.s();!(r=i.n()).done;)(0,r.value)(n)}catch(a){i.e(a)}finally{i.f()}var s,o=wa(this.events["*"]||[]);try{for(o.s();!(s=o.n()).done;)(0,s.value)(e,n)}catch(a){o.e(a)}finally{o.f()}}}]),t}(),cVe=function(){function t(e){var n=this;tn(this,t),pe(this,"_debugEventEmitter",new Zce),pe(this,"checkStep",function(r,i){return n.checkStepEvent(r,i)&&n.checkStepUrl(r,i)&&n.checkStepElement(r,i)}),pe(this,"checkStepEvent",function(r,i){return i==null||!i.event||r?.event===i?.event}),this.instance=e,this.actionEvents=new Set,this.actionRegistry=new Set}return nn(t,[{key:"init",value:function(){var e,n=this;if(!Xe((e=this.instance)===null||e===void 0?void 0:e._addCaptureHook)){var r;(r=this.instance)===null||r===void 0||r._addCaptureHook(function(i,s){n.on(i,s)})}}},{key:"register",value:function(e){var n,r,i=this;if(!Xe((n=this.instance)===null||n===void 0?void 0:n._addCaptureHook)&&(e.forEach(function(a){var c,l;(c=i.actionRegistry)===null||c===void 0||c.add(a),(l=a.steps)===null||l===void 0||l.forEach(function(d){var h;(h=i.actionEvents)===null||h===void 0||h.add(d?.event||"")})}),(r=this.instance)!==null&&r!==void 0&&r.autocapture)){var s,o=new Set;e.forEach(function(a){var c;(c=a.steps)===null||c===void 0||c.forEach(function(l){l!=null&&l.selector&&o.add(l?.selector)})}),(s=this.instance)===null||s===void 0||s.autocapture.setElementSelectors(o)}}},{key:"on",value:function(e,n){var r,i=this;n!=null&&e.length!=0&&(this.actionEvents.has(e)||this.actionEvents.has(n?.event))&&this.actionRegistry&&((r=this.actionRegistry)===null||r===void 0?void 0:r.size)>0&&this.actionRegistry.forEach(function(s){i.checkAction(n,s)&&i._debugEventEmitter.emit("actionCaptured",s.name)})}},{key:"_addActionHook",value:function(e){this.onAction("actionCaptured",function(n){return e(n)})}},{key:"checkAction",value:function(e,n){if(n?.steps==null)return!1;var r,i=wa(n.steps);try{for(i.s();!(r=i.n()).done;){var s=r.value;if(this.checkStep(e,s))return!0}}catch(o){i.e(o)}finally{i.f()}return!1}},{key:"onAction",value:function(e,n){return this._debugEventEmitter.on(e,n)}},{key:"checkStepUrl",value:function(e,n){if(n!=null&&n.url){var r,i=e==null||(r=e.properties)===null||r===void 0?void 0:r.$current_url;if(!i||typeof i!="string"||!t.matchString(i,n?.url,n?.url_matching||"contains"))return!1}return!0}},{key:"checkStepElement",value:function(e,n){if((n!=null&&n.href||n!=null&&n.tag_name||n!=null&&n.text)&&!this.getElementsList(e).some(function(s){return!(n!=null&&n.href&&!t.matchString(s.href||"",n?.href,n?.href_matching||"exact"))&&(n==null||!n.tag_name||s.tag_name===n?.tag_name)&&!(n!=null&&n.text&&!t.matchString(s.text||"",n?.text,n?.text_matching||"exact")&&!t.matchString(s.$el_text||"",n?.text,n?.text_matching||"exact"))}))return!1;if(n!=null&&n.selector){var r,i=e==null||(r=e.properties)===null||r===void 0?void 0:r.$element_selectors;if(!i||!i.includes(n?.selector))return!1}return!0}},{key:"getElementsList",value:function(e){return e?.properties.$elements==null?[]:e?.properties.$elements}}],[{key:"matchString",value:function(e,n,r){switch(r){case"regex":return!!oe&&u3(e,n);case"exact":return n===e;case"contains":var i=t.escapeStringRegexp(n).replace(/_/g,".").replace(/%/g,".*");return u3(e,i);default:return!1}}},{key:"escapeStringRegexp",value:function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}}]),t}(),NL=function(){function t(e){tn(this,t),this.instance=e,this.eventToSurveys=new Map,this.actionToSurveys=new Map}return nn(t,[{key:"register",value:function(e){var n;Xe((n=this.instance)===null||n===void 0?void 0:n._addCaptureHook)||(this.setupEventBasedSurveys(e),this.setupActionBasedSurveys(e))}},{key:"setupActionBasedSurveys",value:function(e){var n=this,r=e.filter(function(i){var s,o,a,c;return((s=i.conditions)===null||s===void 0?void 0:s.actions)&&((o=i.conditions)===null||o===void 0||(a=o.actions)===null||a===void 0||(c=a.values)===null||c===void 0?void 0:c.length)>0});r.length!==0&&(this.actionMatcher==null&&(this.actionMatcher=new cVe(this.instance),this.actionMatcher.init(),this.actionMatcher._addActionHook(function(i){n.onAction(i)})),r.forEach(function(i){var s,o,a,c,l,d,h,m,g,y;i.conditions&&(s=i.conditions)!==null&&s!==void 0&&s.actions&&(o=i.conditions)!==null&&o!==void 0&&(a=o.actions)!==null&&a!==void 0&&a.values&&((c=i.conditions)===null||c===void 0||(l=c.actions)===null||l===void 0||(d=l.values)===null||d===void 0?void 0:d.length)>0&&((h=n.actionMatcher)===null||h===void 0||h.register(i.conditions.actions.values),(m=i.conditions)===null||m===void 0||(g=m.actions)===null||g===void 0||(y=g.values)===null||y===void 0||y.forEach(function(v){if(v&&v.name){var w=n.actionToSurveys.get(v.name);w&&w.push(i.id),n.actionToSurveys.set(v.name,w||[i.id])}}))}))}},{key:"setupEventBasedSurveys",value:function(e){var n,r=this;e.filter(function(i){var s,o,a,c;return((s=i.conditions)===null||s===void 0?void 0:s.events)&&((o=i.conditions)===null||o===void 0||(a=o.events)===null||a===void 0||(c=a.values)===null||c===void 0?void 0:c.length)>0}).length!==0&&((n=this.instance)===null||n===void 0||n._addCaptureHook(function(i,s){r.onEvent(i,s)}),e.forEach(function(i){var s,o,a;(s=i.conditions)===null||s===void 0||(o=s.events)===null||o===void 0||(a=o.values)===null||a===void 0||a.forEach(function(c){if(c&&c.name){var l=r.eventToSurveys.get(c.name);l&&l.push(i.id),r.eventToSurveys.set(c.name,l||[i.id])}})}))}},{key:"onEvent",value:function(e,n){var r,i,s=((r=this.instance)===null||r===void 0||(i=r.persistence)===null||i===void 0?void 0:i.props[lE])||[];if(t.SURVEY_SHOWN_EVENT_NAME==e&&n&&s.length>0){var o,a=n==null||(o=n.properties)===null||o===void 0?void 0:o.$survey_id;if(a){var c=s.indexOf(a);c>=0&&(s.splice(c,1),this._updateActivatedSurveys(s))}}else this.eventToSurveys.has(e)&&this._updateActivatedSurveys(s.concat(this.eventToSurveys.get(e)||[]))}},{key:"onAction",value:function(e){var n,r,i=((n=this.instance)===null||n===void 0||(r=n.persistence)===null||r===void 0?void 0:r.props[lE])||[];this.actionToSurveys.has(e)&&this._updateActivatedSurveys(i.concat(this.actionToSurveys.get(e)||[]))}},{key:"_updateActivatedSurveys",value:function(e){var n,r;(n=this.instance)===null||n===void 0||(r=n.persistence)===null||r===void 0||r.register(pe({},lE,wu(new Set(e))))}},{key:"getSurveys",value:function(){var e,n,r=(e=this.instance)===null||e===void 0||(n=e.persistence)===null||n===void 0?void 0:n.props[lE];return r||[]}},{key:"getEventToSurveys",value:function(){return this.eventToSurveys}},{key:"_getActionMatcher",value:function(){return this.actionMatcher}}]),t}();pe(NL,"SURVEY_SHOWN_EVENT_NAME","survey shown");var G1="[Surveys]",lVe={icontains:function(t){return!!oe&&oe.location.href.toLowerCase().indexOf(t.toLowerCase())>-1},not_icontains:function(t){return!!oe&&oe.location.href.toLowerCase().indexOf(t.toLowerCase())===-1},regex:function(t){return!!oe&&u3(oe.location.href,t)},not_regex:function(t){return!!oe&&!u3(oe.location.href,t)},exact:function(t){return oe?.location.href===t},is_not:function(t){return oe?.location.href!==t}},uVe=function(){function t(e){tn(this,t),this.instance=e,this._surveyEventReceiver=null}return nn(t,[{key:"afterDecideResponse",value:function(e){this._decideServerResponse=!!e.surveys,this.loadIfEnabled()}},{key:"loadIfEnabled",value:function(){var e=this,n=Zn?.extendPostHogWithSurveys;this.instance.config.disable_surveys||!this._decideServerResponse||n||(this._surveyEventReceiver==null&&(this._surveyEventReceiver=new NL(this.instance)),this.instance.requestRouter.loadScript("/static/surveys.js",function(r){if(r)return Ee.error(G1,"Could not load surveys script",r);e._surveyManager=Zn.extendPostHogWithSurveys(e.instance)}))}},{key:"getSurveys",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(this.instance.config.disable_surveys)return e([]);this._surveyEventReceiver==null&&(this._surveyEventReceiver=new NL(this.instance));var i=this.instance.get_property(bL);if(i&&!r)return e(i);this.instance._send_request({url:this.instance.requestRouter.endpointFor("api","/api/surveys/?token=".concat(this.instance.config.token)),method:"GET",transport:"XHR",callback:function(s){var o;if(s.statusCode!==200||!s.json)return e([]);var a,c=s.json.surveys||[],l=c.filter(function(d){var h,m,g,y,v,w,S,R,x,T,I,k;return((h=d.conditions)===null||h===void 0?void 0:h.events)&&((m=d.conditions)===null||m===void 0||(g=m.events)===null||g===void 0?void 0:g.values)&&((y=d.conditions)===null||y===void 0||(v=y.events)===null||v===void 0||(w=v.values)===null||w===void 0?void 0:w.length)>0||((S=d.conditions)===null||S===void 0?void 0:S.actions)&&((R=d.conditions)===null||R===void 0||(x=R.actions)===null||x===void 0?void 0:x.values)&&((T=d.conditions)===null||T===void 0||(I=T.actions)===null||I===void 0||(k=I.values)===null||k===void 0?void 0:k.length)>0});return l.length>0&&((a=n._surveyEventReceiver)===null||a===void 0||a.register(l)),(o=n.instance.persistence)===null||o===void 0||o.register(pe({},bL,c)),e(c)}})}},{key:"getActiveMatchingSurveys",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.getSurveys(function(i){var s,o=i.filter(function(l){return!(!l.start_date||l.end_date)}).filter(function(l){var d,h,m,g;if(!l.conditions)return!0;var y=(d=l.conditions)===null||d===void 0||!d.url||lVe[(h=(m=l.conditions)===null||m===void 0?void 0:m.urlMatchType)!==null&&h!==void 0?h:"icontains"](l.conditions.url),v=(g=l.conditions)===null||g===void 0||!g.selector||$e?.querySelector(l.conditions.selector);return y&&v}),a=(s=n._surveyEventReceiver)===null||s===void 0?void 0:s.getSurveys(),c=o.filter(function(l){var d,h,m,g,y,v,w,S,R,x;if(!l.linked_flag_key&&!l.targeting_flag_key&&!l.internal_targeting_flag_key)return!0;var T=!l.linked_flag_key||n.instance.featureFlags.isFeatureEnabled(l.linked_flag_key),I=!l.targeting_flag_key||n.instance.featureFlags.isFeatureEnabled(l.targeting_flag_key),k=((d=l.conditions)===null||d===void 0?void 0:d.events)&&((h=l.conditions)===null||h===void 0||(m=h.events)===null||m===void 0?void 0:m.values)&&((g=l.conditions)===null||g===void 0||(y=g.events)===null||y===void 0?void 0:y.values.length)>0,A=((v=l.conditions)===null||v===void 0?void 0:v.actions)&&((w=l.conditions)===null||w===void 0||(S=w.actions)===null||S===void 0?void 0:S.values)&&((R=l.conditions)===null||R===void 0||(x=R.actions)===null||x===void 0?void 0:x.values.length)>0,O=!k&&!A||a?.includes(l.id),D=n._canActivateRepeatedly(l),N=!(l.internal_targeting_flag_key&&!D)||n.instance.featureFlags.isFeatureEnabled(l.internal_targeting_flag_key);return T&&I&&N&&O});return e(c)},r)}},{key:"getNextSurveyStep",value:function(e,n,r){var i,s=e.questions[n],o=n+1;if((i=s.branching)===null||i===void 0||!i.type)return n===e.questions.length-1?$a.End:o;if(s.branching.type===$a.End)return $a.End;if(s.branching.type===$a.SpecificQuestion){if(Number.isInteger(s.branching.index))return s.branching.index}else if(s.branching.type===$a.ResponseBased){if(s.type===v3.SingleChoice){var a,c,l=s.choices.indexOf("".concat(r));if((a=s.branching)!==null&&a!==void 0&&(c=a.responseValues)!==null&&c!==void 0&&c.hasOwnProperty(l)){var d=s.branching.responseValues[l];return Number.isInteger(d)?d:d===$a.End?$a.End:o}}else if(s.type===v3.Rating){var h,m;if(typeof r!="number"||!Number.isInteger(r))throw new Error("The response type must be an integer");var g=function(v,w){if(w===3){if(v<1||v>3)throw new Error("The response must be in range 1-3");return v===1?"negative":v===2?"neutral":"positive"}if(w===5){if(v<1||v>5)throw new Error("The response must be in range 1-5");return v<=2?"negative":v===3?"neutral":"positive"}if(w===10){if(v<0||v>10)throw new Error("The response must be in range 0-10");return v<=6?"detractors":v<=8?"passives":"promoters"}throw new Error("The scale must be one of: 3, 5, 10")}(r,s.scale);if((h=s.branching)!==null&&h!==void 0&&(m=h.responseValues)!==null&&m!==void 0&&m.hasOwnProperty(g)){var y=s.branching.responseValues[g];return Number.isInteger(y)?y:y===$a.End?$a.End:o}}return o}return Ee.warn(G1,"Falling back to next question index due to unexpected branching type"),o}},{key:"_canActivateRepeatedly",value:function(e){return Xs(Zn.__PosthogExtensions__.canActivateRepeatedly)&&Ee.warn(G1,"canActivateRepeatedly is not defined, must init before calling"),Zn.__PosthogExtensions__.canActivateRepeatedly(e)}},{key:"canRenderSurvey",value:function(e){var n=this;Xs(this._surveyManager)?Ee.warn(G1,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys(function(r){var i=r.filter(function(s){return s.id===e})[0];n._surveyManager.canRenderSurvey(i)})}},{key:"renderSurvey",value:function(e,n){var r=this;Xs(this._surveyManager)?Ee.warn(G1,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys(function(i){var s=i.filter(function(o){return o.id===e})[0];r._surveyManager.renderSurvey(s,$e?.querySelector(n))})}}]),t}(),dVe=function(){function t(e){var n,r,i=this;tn(this,t),pe(this,"serverLimits",{}),pe(this,"lastEventRateLimited",!1),pe(this,"checkForLimiting",function(s){var o=s.text;if(o&&o.length)try{(JSON.parse(o).quota_limited||[]).forEach(function(a){Ee.info("[RateLimiter] ".concat(a||"events"," is quota limited.")),i.serverLimits[a]=new Date().getTime()+6e4})}catch(a){return void Ee.warn('[RateLimiter] could not rate limit - continuing. Error: "'.concat(a?.message,'"'),{text:o})}}),this.instance=e,this.captureEventsPerSecond=((n=e.config.rate_limiting)===null||n===void 0?void 0:n.events_per_second)||10,this.captureEventsBurstLimit=Math.max(((r=e.config.rate_limiting)===null||r===void 0?void 0:r.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond),this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}return nn(t,[{key:"clientRateLimitContext",value:function(){var e,n,r,i=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=new Date().getTime(),o=(e=(n=this.instance.persistence)===null||n===void 0?void 0:n.get_property(SL))!==null&&e!==void 0?e:{tokens:this.captureEventsBurstLimit,last:s};o.tokens+=(s-o.last)/1e3*this.captureEventsPerSecond,o.last=s,o.tokens>this.captureEventsBurstLimit&&(o.tokens=this.captureEventsBurstLimit);var a=o.tokens<1;return a||i||(o.tokens=Math.max(0,o.tokens-1)),!a||this.lastEventRateLimited||i||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to ".concat(this.captureEventsPerSecond," events per second and ").concat(this.captureEventsBurstLimit," events burst limit.")},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=a,(r=this.instance.persistence)===null||r===void 0||r.set_property(SL,o),{isRateLimited:a,remainingTokens:o.tokens}}},{key:"isServerRateLimited",value:function(e){var n=this.serverLimits[e||"events"]||!1;return n!==!1&&new Date().getTime()<n}}]),t}(),fVe=function(){return Ne({initialPathName:Ns?.pathname||"",referringDomain:Si.referringDomain()},Si.campaignParams())},hVe=function(){function t(e,n,r){var i=this;tn(this,t),pe(this,"_onSessionIdCallback",function(s){var o=i._getStoredProps();if(!o||o.sessionId!==s){var a={sessionId:s,props:i._sessionSourceParamGenerator()};i._persistence.register(pe({},_L,a))}}),this._sessionIdManager=e,this._persistence=n,this._sessionSourceParamGenerator=r||fVe,this._sessionIdManager.onSessionId(this._onSessionIdCallback)}return nn(t,[{key:"_getStoredProps",value:function(){return this._persistence.props[_L]}},{key:"getSessionProps",value:function(){var e,n=(e=this._getStoredProps())===null||e===void 0?void 0:e.props;return n?{$client_session_initial_referring_host:n.referringDomain,$client_session_initial_pathname:n.initialPathName,$client_session_initial_utm_source:n.utm_source,$client_session_initial_utm_campaign:n.utm_campaign,$client_session_initial_utm_medium:n.utm_medium,$client_session_initial_utm_content:n.utm_content,$client_session_initial_utm_term:n.utm_term}:{}}}]),t}(),pVe=["ahrefsbot","ahrefssiteaudit","applebot","baiduspider","bingbot","bingpreview","bot.htm","bot.php","crawler","deepscan","duckduckbot","facebookexternal","facebookcatalog","gptbot","http://yandex.com/bots","hubspot","ia_archiver","linkedinbot","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","semrushbot","sitebulb","slurp","turnitin","twitterbot","vercelbot","yahoo! slurp","yandexbot","headlesschrome","cypress","Google-HotelAdsVerifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google","Bytespider;"],LK=function(t,e){if(!t)return!1;var n=t.toLowerCase();return pVe.concat(e||[]).some(function(r){var i=r.toLowerCase();return n.indexOf(i)!==-1})},ele=function(){function t(){tn(this,t),this.clicks=[]}return nn(t,[{key:"isRageClick",value:function(e,n,r){var i=this.clicks[this.clicks.length-1];if(i&&Math.abs(e-i.x)+Math.abs(n-i.y)<30&&r-i.timestamp<1e3){if(this.clicks.push({x:e,y:n,timestamp:r}),this.clicks.length===3)return!0}else this.clicks=[{x:e,y:n,timestamp:r}];return!1}}]),t}();function OK(t){var e;return t.id===CL||!((e=t.closest)===null||e===void 0||!e.call(t,"#"+CL))}var mVe=function(){function t(e){var n,r=this;tn(this,t),pe(this,"rageclicks",new ele),pe(this,"_enabledServerSide",!1),pe(this,"_initialized",!1),pe(this,"_flushInterval",null),this.instance=e,this._enabledServerSide=!((n=this.instance.persistence)===null||n===void 0||!n.props[gL]),oe?.addEventListener("beforeunload",function(){r.flush()})}return nn(t,[{key:"flushIntervalMilliseconds",get:function(){var e=5e3;return Fi(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(e=this.instance.config.capture_heatmaps.flush_interval_milliseconds),e}},{key:"isEnabled",get:function(){return Xe(this.instance.config.capture_heatmaps)?Xe(this.instance.config.enable_heatmaps)?this._enabledServerSide:this.instance.config.enable_heatmaps:this.instance.config.capture_heatmaps!==!1}},{key:"startIfEnabled",value:function(){if(this.isEnabled){if(this._initialized)return;Ee.info("[heatmaps] starting..."),this._setupListeners(),this._flushInterval=setInterval(this.flush.bind(this),this.flushIntervalMilliseconds)}else{var e;clearInterval((e=this._flushInterval)!==null&&e!==void 0?e:void 0),this.getAndClearBuffer()}}},{key:"afterDecideResponse",value:function(e){var n=!!e.heatmaps;this.instance.persistence&&this.instance.persistence.register(pe({},gL,n)),this._enabledServerSide=n,this.startIfEnabled()}},{key:"getAndClearBuffer",value:function(){var e=this.buffer;return this.buffer=void 0,e}},{key:"_setupListeners",value:function(){var e=this;oe&&$e&&(uu($e,"click",function(n){return e._onClick(n||oe?.event)},!1,!0),uu($e,"mousemove",function(n){return e._onMouseMove(n||oe?.event)},!1,!0),this._initialized=!0)}},{key:"_getProperties",value:function(e,n){var r=this.instance.scrollManager.scrollY(),i=this.instance.scrollManager.scrollX(),s=this.instance.scrollManager.scrollElement(),o=function(a,c,l){for(var d=a;d&&!af(d,"body");){if(d===l)return!1;if(Ft(c,oe?.getComputedStyle(d).position))return!0;d=Bce(d)}return!1}(e.target,["fixed","sticky"],s);return{x:e.clientX+(o?0:i),y:e.clientY+(o?0:r),target_fixed:o,type:n}}},{key:"_onClick",value:function(e){var n;if(!OK(e.target)){var r=this._getProperties(e,"click");(n=this.rageclicks)!==null&&n!==void 0&&n.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this._capture(Ne(Ne({},r),{},{type:"rageclick"})),this._capture(r)}}},{key:"_onMouseMove",value:function(e){var n=this;OK(e.target)||(clearTimeout(this._mouseMoveTimeout),this._mouseMoveTimeout=setTimeout(function(){n._capture(n._getProperties(e,"mousemove"))},500))}},{key:"_capture",value:function(e){if(oe){var n=oe.location.href;this.buffer=this.buffer||{},this.buffer[n]||(this.buffer[n]=[]),this.buffer[n].push(e)}}},{key:"flush",value:function(){this.buffer&&!Ow(this.buffer)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}]),t}(),gVe=function(){function t(e){var n=this;tn(this,t),pe(this,"_updateScrollData",function(){var r,i,s,o;n.context||(n.context={});var a=n.scrollElement(),c=n.scrollY(),l=a?Math.max(0,a.scrollHeight-a.clientHeight):0,d=c+(a?.clientHeight||0),h=a?.scrollHeight||0;n.context.lastScrollY=Math.ceil(c),n.context.maxScrollY=Math.max(c,(r=n.context.maxScrollY)!==null&&r!==void 0?r:0),n.context.maxScrollHeight=Math.max(l,(i=n.context.maxScrollHeight)!==null&&i!==void 0?i:0),n.context.lastContentY=d,n.context.maxContentY=Math.max(d,(s=n.context.maxContentY)!==null&&s!==void 0?s:0),n.context.maxContentHeight=Math.max(h,(o=n.context.maxContentHeight)!==null&&o!==void 0?o:0)}),this.instance=e}return nn(t,[{key:"getContext",value:function(){return this.context}},{key:"resetContext",value:function(){var e=this.context;return setTimeout(this._updateScrollData,0),e}},{key:"startMeasuringScrollPosition",value:function(){oe?.addEventListener("scroll",this._updateScrollData,!0),oe?.addEventListener("scrollend",this._updateScrollData,!0),oe?.addEventListener("resize",this._updateScrollData)}},{key:"scrollElement",value:function(){if(!this.instance.config.scroll_root_selector)return oe?.document.documentElement;var e,n=wa(oi(this.instance.config.scroll_root_selector)?this.instance.config.scroll_root_selector:[this.instance.config.scroll_root_selector]);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=oe?.document.querySelector(r);if(i)return i}}catch(s){n.e(s)}finally{n.f()}}},{key:"scrollY",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollTop||0}return oe&&(oe.scrollY||oe.pageYOffset||oe.document.documentElement.scrollTop)||0}},{key:"scrollX",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollLeft||0}return oe&&(oe.scrollX||oe.pageXOffset||oe.document.documentElement.scrollLeft)||0}}]),t}(),Mx="$copy_autocapture";function Dx(t,e){return e.length>t?e.slice(0,t)+"...":e}var Fd,vVe=function(){function t(e){tn(this,t),pe(this,"_initialized",!1),pe(this,"_isDisabledServerSide",null),pe(this,"rageclicks",new ele),pe(this,"_elementsChainAsString",!1),this.instance=e,this._elementSelectors=null}return nn(t,[{key:"config",get:function(){var e,n,r=Fi(this.instance.config.autocapture)?this.instance.config.autocapture:{};return r.url_allowlist=(e=r.url_allowlist)===null||e===void 0?void 0:e.map(function(i){return new RegExp(i)}),r.url_ignorelist=(n=r.url_ignorelist)===null||n===void 0?void 0:n.map(function(i){return new RegExp(i)}),r}},{key:"_addDomEventHandlers",value:function(){var e=this;if(this.isBrowserSupported()){if(oe&&$e){var n=function(i){i=i||oe?.event;try{e._captureEvent(i)}catch(s){Ee.error("Failed to capture event",s)}},r=function(i){i=i||oe?.event,e._captureEvent(i,Mx)};uu($e,"submit",n,!1,!0),uu($e,"change",n,!1,!0),uu($e,"click",n,!1,!0),this.config.capture_copied_text&&(uu($e,"copy",r,!1,!0),uu($e,"cut",r,!1,!0))}}else Ee.info("Disabling Automatic Event Collection because this browser is not supported")}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(this._addDomEventHandlers(),this._initialized=!0)}},{key:"afterDecideResponse",value:function(e){e.elementsChainAsString&&(this._elementsChainAsString=e.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register(pe({},ZG,!!e.autocapture_opt_out)),this._isDisabledServerSide=!!e.autocapture_opt_out,this.startIfEnabled()}},{key:"setElementSelectors",value:function(e){this._elementSelectors=e}},{key:"getElementSelectors",value:function(e){var n,r=[];return(n=this._elementSelectors)===null||n===void 0||n.forEach(function(i){var s=$e?.querySelectorAll(i);s?.forEach(function(o){e===o&&r.push(i)})}),r}},{key:"isEnabled",get:function(){var e,n,r=(e=this.instance.persistence)===null||e===void 0?void 0:e.props[ZG],i=this._isDisabledServerSide;if(zu(i)&&!Uh(r)&&!this.instance.config.advanced_disable_decide)return!1;var s=(n=this._isDisabledServerSide)!==null&&n!==void 0?n:!!r;return!!this.instance.config.autocapture&&!s}},{key:"_previousElementSibling",value:function(e){if(e.previousElementSibling)return e.previousElementSibling;var n=e;do n=n.previousSibling;while(n&&!A8(n));return n}},{key:"_getAugmentPropertiesFromElement",value:function(e){if(!PL(e))return{};var n={};return Pn(e.attributes,function(r){if(r.name&&r.name.indexOf("data-ph-capture-attribute")===0){var i=r.name.replace("data-ph-capture-attribute-",""),s=r.value;i&&s&&Vg(s)&&(n[i]=s)}}),n}},{key:"_getPropertiesFromElement",value:function(e,n,r){var i,s=e.tagName.toLowerCase(),o={tag_name:s};AL.indexOf(s)>-1&&!r&&(s.toLowerCase()==="a"||s.toLowerCase()==="button"?o.$el_text=Dx(1024,bK(e)):o.$el_text=Dx(1024,p3(e)));var a=h3(e);a.length>0&&(o.classes=a.filter(function(m){return m!==""}));var c=(i=this.config)===null||i===void 0?void 0:i.element_attribute_ignorelist;Pn(e.attributes,function(m){var g;if((!Hce(e)||["name","id","class","aria-label"].indexOf(m.name)!==-1)&&(c==null||!c.includes(m.name))&&!n&&Vg(m.value)&&(g=m.name,!ns(g)||g.substring(0,10)!=="_ngcontent"&&g.substring(0,7)!=="_nghost")){var y=m.value;m.name==="class"&&(y=x8(y).join(" ")),o["attr__"+m.name]=Dx(1024,y)}});for(var l=1,d=1,h=e;h=this._previousElementSibling(h);)l++,h.tagName===e.tagName&&d++;return o.nth_child=l,o.nth_of_type=d,o}},{key:"_getDefaultProperties",value:function(e){return{$event_type:e,$ce_version:1}}},{key:"_getEventTarget",value:function(e){return Xe(e.target)?e.srcElement||null:(n=e.target)!==null&&n!==void 0&&n.shadowRoot?e.composedPath()[0]||null:e.target||null;var n}},{key:"_captureEvent",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"$autocapture";if(this.isEnabled){var i,s=this._getEventTarget(e);Fce(s)&&(s=s.parentNode||null),r==="$autocapture"&&e.type==="click"&&e instanceof MouseEvent&&this.instance.config.rageclick&&(i=this.rageclicks)!==null&&i!==void 0&&i.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this._captureEvent(e,"$rageclick");var o=r===Mx;if(s&&RHe(s,e,this.config,o,o?["copy","cut"]:void 0)){for(var a,c,l=[s],d=s;d.parentNode&&!af(d,"body");)$ce(d.parentNode)?(l.push(d.parentNode.host),d=d.parentNode.host):(l.push(d.parentNode),d=d.parentNode);var h,m,g=[],y={},v=!1;if(Pn(l,function(D){var N=PL(D);D.tagName.toLowerCase()==="a"&&(h=D.getAttribute("href"),h=N&&Vg(h)&&h),Ft(h3(D),"ph-no-capture")&&(v=!0),g.push(n._getPropertiesFromElement(D,n.instance.config.mask_all_element_attributes,n.instance.config.mask_all_text));var U=n._getAugmentPropertiesFromElement(D);hs(y,U)}),this.instance.config.mask_all_text||(s.tagName.toLowerCase()==="a"||s.tagName.toLowerCase()==="button"?g[0].$el_text=bK(s):g[0].$el_text=p3(s)),h){var w,S;g[0].attr__href=h;var R=(w=Ky(h))===null||w===void 0?void 0:w.host,x=oe==null||(S=oe.location)===null||S===void 0?void 0:S.host;R&&x&&R!==x&&(m=h)}if(v)return!1;var T=hs(this._getDefaultProperties(e.type),this._elementsChainAsString?{$elements_chain:PHe(g)}:{$elements:g},(a=g[0])!==null&&a!==void 0&&a.$el_text?{$el_text:(c=g[0])===null||c===void 0?void 0:c.$el_text}:{},m&&e.type==="click"?{$external_click_url:m}:{},y),I=this.getElementSelectors(s);if(I&&I.length>0&&(T.$element_selectors=I),r===Mx){var k,A=jce(oe==null||(k=oe.getSelection())===null||k===void 0?void 0:k.toString()),O=e.type||"clipboard";if(!A)return!1;T.$selected_content=A,T.$copy_type=O}return this.instance.capture(r,T),!0}}}},{key:"isBrowserSupported",value:function(){return da($e?.querySelectorAll)}}]),t}(),yVe=function(){function t(e){var n=this;tn(this,t),pe(this,"_restoreXHRPatch",void 0),pe(this,"_restoreFetchPatch",void 0),pe(this,"_startCapturing",function(){Xe(n._restoreXHRPatch)&&Zn.postHogTracingHeadersPatchFns._patchXHR(n.instance.sessionManager),Xe(n._restoreFetchPatch)&&Zn.postHogTracingHeadersPatchFns._patchFetch(n.instance.sessionManager)}),this.instance=e}return nn(t,[{key:"_loadScript",value:function(e){Zn.postHogTracingHeadersPatchFns&&e(),this.instance.requestRouter.loadScript("/static/tracing-headers.js?v=".concat(na.LIB_VERSION),function(n){if(n)return Ee.error("[TRACING-HEADERS] failed to load script",n);e()})}},{key:"startIfEnabledOrStop",value:function(){var e,n;this.instance.config.__add_tracing_headers?this._loadScript(this._startCapturing):((e=this._restoreXHRPatch)===null||e===void 0||e.call(this),(n=this._restoreFetchPatch)===null||n===void 0||n.call(this),this._restoreXHRPatch=void 0,this._restoreFetchPatch=void 0)}}]),t}();(function(t){t[t.PENDING=-1]="PENDING",t[t.DENIED=0]="DENIED",t[t.GRANTED=1]="GRANTED"})(Fd||(Fd={}));var bVe=function(){function t(e){tn(this,t),this.instance=e}return nn(t,[{key:"config",get:function(){return this.instance.config}},{key:"consent",get:function(){return this.getDnt()?Fd.DENIED:this.storedConsent}},{key:"isOptedOut",value:function(){return this.consent===Fd.DENIED||this.consent===Fd.PENDING&&this.config.opt_out_capturing_by_default}},{key:"isOptedIn",value:function(){return!this.isOptedOut()}},{key:"optInOut",value:function(e){this.storage.set(this.storageKey,e?1:0,this.config.cookie_expiration,this.config.cross_subdomain_cookie,this.config.secure_cookie)}},{key:"reset",value:function(){this.storage.remove(this.storageKey,this.config.cross_subdomain_cookie)}},{key:"storageKey",get:function(){var e=this.instance.config,n=e.token;return(e.opt_out_capturing_cookie_prefix||"__ph_opt_in_out_")+n}},{key:"storedConsent",get:function(){var e=this.storage.get(this.storageKey);return e==="1"?Fd.GRANTED:e==="0"?Fd.DENIED:Fd.PENDING}},{key:"storage",get:function(){if(!this._storage){var e=this.config.opt_out_capturing_persistence_type;this._storage=e==="localStorage"?ri:Cu;var n=e==="localStorage"?Cu:ri;n.get(this.storageKey)&&(this._storage.get(this.storageKey)||this.optInOut(n.get(this.storageKey)==="1"),n.remove(this.storageKey,this.config.cross_subdomain_cookie))}return this._storage}},{key:"getDnt",value:function(){return!!this.config.respect_dnt&&!!_ce([ec?.doNotTrack,ec?.msDoNotTrack,Zn.doNotTrack],function(e){return Ft([!0,1,"1","yes"],e)})}}]),t}(),vE="[Exception Autocapture]",_Ve=function(){function t(e){var n,r=this;tn(this,t),pe(this,"originalOnUnhandledRejectionHandler",void 0),pe(this,"startCapturing",function(){if(oe&&r.isEnabled&&!r.hasHandlers&&!r.isCapturing){var i=oe.posthogErrorWrappingFunctions.wrapOnError,s=oe.posthogErrorWrappingFunctions.wrapUnhandledRejection;if(i&&s)try{r.unwrapOnError=i(r.captureException.bind(r)),r.unwrapUnhandledRejection=s(r.captureException.bind(r))}catch(o){Ee.error(vE+" failed to start",o),r.stopCapturing()}else Ee.error(vE+" failed to load error wrapping functions - cannot start")}}),this.instance=e,this.remoteEnabled=!((n=this.instance.persistence)===null||n===void 0||!n.props[eK]),this.startIfEnabled()}return nn(t,[{key:"isEnabled",get:function(){var e;return(e=this.remoteEnabled)!==null&&e!==void 0&&e}},{key:"isCapturing",get:function(){var e;return!(oe==null||(e=oe.onerror)===null||e===void 0||!e.__POSTHOG_INSTRUMENTED__)}},{key:"hasHandlers",get:function(){return this.originalOnUnhandledRejectionHandler||this.unwrapOnError}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this.isCapturing&&(Ee.info(vE+" enabled, starting..."),this.loadScript(this.startCapturing))}},{key:"loadScript",value:function(e){this.hasHandlers&&e(),this.instance.requestRouter.loadScript("/static/exception-autocapture.js?v=".concat(na.LIB_VERSION),function(n){if(n)return Ee.error(vE+" failed to load script",n);e()})}},{key:"stopCapturing",value:function(){var e,n;(e=this.unwrapOnError)===null||e===void 0||e.call(this),(n=this.unwrapUnhandledRejection)===null||n===void 0||n.call(this)}},{key:"afterDecideResponse",value:function(e){var n=e.autocaptureExceptions;this.remoteEnabled=!!n||!1,this.instance.persistence&&this.instance.persistence.register(pe({},eK,this.remoteEnabled)),this.startIfEnabled()}},{key:"captureException",value:function(e){var n=this.instance.requestRouter.endpointFor("ui");e.$exception_personURL="".concat(n,"/project/").concat(this.instance.config.token,"/person/").concat(this.instance.get_distinct_id()),this.instance.exceptions.sendExceptionEvent(e)}}]),t}(),MK=9e5,_h="[Web Vitals]",SVe=function(){function t(e){var n,r=this;tn(this,t),pe(this,"_enabledServerSide",!1),pe(this,"_initialized",!1),pe(this,"buffer",{url:void 0,metrics:[],firstMetricTimestamp:void 0}),pe(this,"_flushToCapture",function(){clearTimeout(r._delayedFlushTimer),r.buffer.metrics.length!==0&&(r.instance.capture("$web_vitals",r.buffer.metrics.reduce(function(i,s){var o;return Ne(Ne({},i),{},(pe(o={},"$web_vitals_".concat(s.name,"_event"),Ne({},s)),pe(o,"$web_vitals_".concat(s.name,"_value"),s.value),o))},{})),r.buffer={url:void 0,metrics:[],firstMetricTimestamp:void 0})}),pe(this,"_addToBuffer",function(i){var s,o=(s=r.instance.sessionManager)===null||s===void 0?void 0:s.checkAndGetSessionAndWindowId(!0);if(Xe(o))Ee.error(_h+"Could not read session ID. Dropping metrics!");else{r.buffer=r.buffer||{url:void 0,metrics:[],firstMetricTimestamp:void 0};var a=r._currentURL();Xe(a)||(Xs(i?.name)||Xs(i?.value)?Ee.error(_h+"Invalid metric received",i):r._maxAllowedValue&&i.value>=r._maxAllowedValue?Ee.error(_h+"Ignoring metric with value >= "+r._maxAllowedValue,i):(r.buffer.url!==a&&(r._flushToCapture(),r._delayedFlushTimer=setTimeout(r._flushToCapture,8e3)),Xe(r.buffer.url)&&(r.buffer.url=a),r.buffer.firstMetricTimestamp=Xe(r.buffer.firstMetricTimestamp)?Date.now():r.buffer.firstMetricTimestamp,r.buffer.metrics.push(Ne(Ne({},i),{},{$current_url:a,$session_id:o.sessionId,$window_id:o.windowId,timestamp:Date.now()})),r.buffer.metrics.length===4&&r._flushToCapture()))}}),pe(this,"_startCapturing",function(){var i=Zn.postHogWebVitalsCallbacks,s=i.onLCP,o=i.onCLS,a=i.onFCP,c=i.onINP;s&&o&&a&&c?(s(r._addToBuffer),o(r._addToBuffer),a(r._addToBuffer),c(r._addToBuffer),r._initialized=!0):Ee.error(_h+"web vitals callbacks not loaded - not starting")}),this.instance=e,this._enabledServerSide=!((n=this.instance.persistence)===null||n===void 0||!n.props[nK]),this.startIfEnabled()}return nn(t,[{key:"_maxAllowedValue",get:function(){var e=Fi(this.instance.config.capture_performance)&&ra(this.instance.config.capture_performance.__web_vitals_max_value)?this.instance.config.capture_performance.__web_vitals_max_value:MK;return 0<e&&e<=6e4?MK:e}},{key:"isEnabled",get:function(){var e=Fi(this.instance.config.capture_performance)?this.instance.config.capture_performance.web_vitals:void 0;return Uh(e)?e:this._enabledServerSide}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(Ee.info(_h+" enabled, starting..."),this.loadScript(this._startCapturing))}},{key:"afterDecideResponse",value:function(e){var n=Fi(e.capturePerformance)&&!!e.capturePerformance.web_vitals;this.instance.persistence&&this.instance.persistence.register(pe({},nK,n)),this._enabledServerSide=n,this.startIfEnabled()}},{key:"loadScript",value:function(e){oe.postHogWebVitalsCallbacks&&e(),this.instance.requestRouter.loadScript("/static/web-vitals.js?v=".concat(na.LIB_VERSION),function(n){n?Ee.error(_h+" failed to load script",n):e()})}},{key:"_currentURL",value:function(){var e=oe?oe.location.href:void 0;return e||Ee.error(_h+"Could not determine current URL"),e}}]),t}(),DK="/e/",EVe=function(){function t(e){var n;tn(this,t),this.instance=e,this._endpointSuffix=((n=this.instance.persistence)===null||n===void 0?void 0:n.props[tK])||DK}return nn(t,[{key:"endpoint",get:function(){return this.instance.requestRouter.endpointFor("api",this._endpointSuffix)}},{key:"afterDecideResponse",value:function(e){var n=e.autocaptureExceptions;this._endpointSuffix=Fi(n)&&n.endpoint||DK,this.instance.persistence&&this.instance.persistence.register(pe({},tK,this._endpointSuffix))}},{key:"sendExceptionEvent",value:function(e){this.instance.capture("$exception",e,{_noTruncate:!0,_batchKey:"exceptionEvent",_url:this.endpoint})}}]),t}(),Yy={},NK=function(){},ig="posthog",tle=!ZHe&&_i?.indexOf("MSIE")===-1&&_i?.indexOf("Mozilla")===-1,UK=function(){var t,e,n;return{api_host:"https://us.i.posthog.com",ui_host:null,token:"",autocapture:!0,rageclick:!0,cross_subdomain_cookie:(e=$e?.location,n=e?.hostname,!!ns(n)&&n.split(".").slice(-2).join(".")!=="herokuapp.com"),persistence:"localStorage+cookie",persistence_name:"",loaded:NK,store_google:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageview:!0,capture_pageleave:"if_capture_pageview",debug:Ns&&ns(Ns?.search)&&Ns.search.indexOf("__posthog_debug=true")!==-1||!1,verbose:!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_surveys:!1,enable_recording_console_log:void 0,secure_cookie:(oe==null||(t=oe.location)===null||t===void 0?void 0:t.protocol)==="https:",ip:!0,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},inapp_protocol:"//",inapp_link_new_window:!1,request_batching:!0,properties_string_max_length:65535,session_recording:{},mask_all_element_attributes:!1,mask_all_text:!1,advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,on_request_error:function(r){var i="Bad HTTP status: "+r.statusCode+" "+r.text;Ee.error(i)},get_device_id:function(r){return r},_onCapture:NK,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"always",__add_tracing_headers:!1}},jK=function(t){var e={};Xe(t.process_person)||(e.person_profiles=t.process_person),Xe(t.xhr_headers)||(e.request_headers=t.xhr_headers),Xe(t.cookie_name)||(e.persistence_name=t.cookie_name),Xe(t.disable_cookie)||(e.disable_persistence=t.disable_cookie);var n=hs({},e,t);return oi(t.property_blacklist)&&(Xe(t.property_denylist)?n.property_denylist=t.property_blacklist:oi(t.property_denylist)?n.property_denylist=[].concat(wu(t.property_blacklist),wu(t.property_denylist)):Ee.error("Invalid value for property_denylist config: "+t.property_denylist)),n},wVe=function(){function t(){tn(this,t),pe(this,"__forceAllowLocalhost",!1)}return nn(t,[{key:"_forceAllowLocalhost",get:function(){return this.__forceAllowLocalhost},set:function(e){Ee.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=e}}]),t}(),nle=function(){function t(){var e=this;tn(this,t),pe(this,"webPerformance",new wVe),pe(this,"version",na.LIB_VERSION),pe(this,"_internalEventEmitter",new Zce),this.config=UK(),this.decideEndpointWasHit=!1,this.SentryIntegration=sVe,this.sentryIntegration=function(n){return function(r,i){var s=Qce(r,i);return{name:Jce,processEvent:function(o){return s(o)}}}(e,n)},this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this._initialPageviewCaptured=!1,this.featureFlags=new tHe(this),this.toolbar=new VHe(this),this.scrollManager=new gVe(this),this.pageViewManager=new aVe(this),this.surveys=new uVe(this),this.exceptions=new EVe(this),this.rateLimiter=new dVe(this),this.requestRouter=new iVe(this),this.consent=new bVe(this),this.people={set:function(n,r,i){var s=ns(n)?pe({},n,r):n;e.setPersonProperties(s),i?.({})},set_once:function(n,r,i){var s=ns(n)?pe({},n,r):n;e.setPersonProperties(void 0,s),i?.({})}},this.on("eventCaptured",function(n){return Ee.info("send",n)})}return nn(t,[{key:"init",value:function(e,n,r){if(r&&r!==ig){var i,s=(i=Yy[r])!==null&&i!==void 0?i:new t;return s._init(e,n,r),Yy[r]=s,Yy[ig][r]=s,s}return this._init(e,n,r)}},{key:"_init",value:function(e){var n,r,i=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;if(Xe(e)||zG(e))return Ee.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return Ee.warn("You have already initialized PostHog! Re-initializing is a no-op"),this;this.__loaded=!0,this.config={},this._triggered_notifs=[],this.set_config(hs({},UK(),jK(s),{name:o,token:e})),this.config.on_xhr_error&&Ee.error("[posthog] on_xhr_error is deprecated. Use on_request_error instead"),this.compression=s.disable_compression?void 0:Qa.GZipJS,this.persistence=new Ax(this.config),this.sessionPersistence=this.config.persistence==="sessionStorage"?this.persistence:new Ax(Ne(Ne({},this.config),{},{persistence:"sessionStorage"}));var a=Ne({},this.persistence.props),c=Ne({},this.sessionPersistence.props);if(this._requestQueue=new qHe(function(R){return i._send_retriable_request(R)}),this._retryQueue=new nVe(this),this.__request_queue=[],this.sessionManager=new rVe(this.config,this.persistence),this.sessionPropsManager=new hVe(this.sessionManager,this.persistence),new yVe(this).startIfEnabledOrStop(),this.sessionRecording=new $He(this),this.sessionRecording.startIfEnabledOrStop(),this.config.disable_scroll_properties||this.scrollManager.startMeasuringScrollPosition(),this.autocapture=new vVe(this),this.autocapture.startIfEnabled(),this.surveys.loadIfEnabled(),this.heatmaps=new mVe(this),this.heatmaps.startIfEnabled(),this.webVitalsAutocapture=new SVe(this),this.exceptionObserver=new _Ve(this),this.exceptionObserver.startIfEnabled(),na.DEBUG=na.DEBUG||this.config.debug,na.DEBUG&&Ee.info("Starting in debug mode",{this:this,config:s,thisC:Ne({},this.config),p:a,s:c}),this._sync_opt_out_with_persistence(),((n=s.bootstrap)===null||n===void 0?void 0:n.distinctID)!==void 0){var l,d,h=this.config.get_device_id(Yd()),m=(l=s.bootstrap)!==null&&l!==void 0&&l.isIdentifiedID?h:s.bootstrap.distinctID;this.persistence.set_property(Xl,(d=s.bootstrap)!==null&&d!==void 0&&d.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:s.bootstrap.distinctID,$device_id:m})}if(this._hasBootstrappedFeatureFlags()){var g,y,v=Object.keys(((g=s.bootstrap)===null||g===void 0?void 0:g.featureFlags)||{}).filter(function(R){var x,T;return!((x=s.bootstrap)===null||x===void 0||(T=x.featureFlags)===null||T===void 0||!T[R])}).reduce(function(R,x){var T,I;return R[x]=((T=s.bootstrap)===null||T===void 0||(I=T.featureFlags)===null||I===void 0?void 0:I[x])||!1,R},{}),w=Object.keys(((y=s.bootstrap)===null||y===void 0?void 0:y.featureFlagPayloads)||{}).filter(function(R){return v[R]}).reduce(function(R,x){var T,I,k,A;return(T=s.bootstrap)!==null&&T!==void 0&&(I=T.featureFlagPayloads)!==null&&I!==void 0&&I[x]&&(R[x]=(k=s.bootstrap)===null||k===void 0||(A=k.featureFlagPayloads)===null||A===void 0?void 0:A[x]),R},{});this.featureFlags.receivedFeatureFlags({featureFlags:v,featureFlagPayloads:w})}if(!this.get_distinct_id()){var S=this.config.get_device_id(Yd());this.register_once({distinct_id:S,$device_id:S},""),this.persistence.set_property(Xl,"anonymous")}return oe==null||(r=oe.addEventListener)===null||r===void 0||r.call(oe,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this)),this.toolbar.maybeLoadToolbar(),s.segment?oVe(this,function(){return i._loaded()}):this._loaded(),da(this.config._onCapture)&&this.on("eventCaptured",function(R){return i.config._onCapture(R.event,R)}),this}},{key:"_afterDecideResponse",value:function(e){var n,r,i,s,o,a,c,l;this.compression=void 0,e.supportedCompression&&!this.config.disable_compression&&(this.compression=Ft(e.supportedCompression,Qa.GZipJS)?Qa.GZipJS:Ft(e.supportedCompression,Qa.Base64)?Qa.Base64:void 0),(n=e.analytics)!==null&&n!==void 0&&n.endpoint&&(this.analyticsDefaultEndpoint=e.analytics.endpoint),(r=this.sessionRecording)===null||r===void 0||r.afterDecideResponse(e),(i=this.autocapture)===null||i===void 0||i.afterDecideResponse(e),(s=this.heatmaps)===null||s===void 0||s.afterDecideResponse(e),(o=this.surveys)===null||o===void 0||o.afterDecideResponse(e),(a=this.webVitalsAutocapture)===null||a===void 0||a.afterDecideResponse(e),(c=this.exceptions)===null||c===void 0||c.afterDecideResponse(e),(l=this.exceptionObserver)===null||l===void 0||l.afterDecideResponse(e)}},{key:"_loaded",value:function(){var e=this,n=this.config.advanced_disable_decide;n||this.featureFlags.setReloadingPaused(!0);try{this.config.loaded(this)}catch(r){Ee.critical("`loaded` function failed",r)}this._start_queue_if_opted_in(),this.config.capture_pageview&&setTimeout(function(){e.consent.isOptedIn()&&e._captureInitialPageview()},1),n||(new BHe(this).call(),this.featureFlags.resetRequestQueue())}},{key:"_start_queue_if_opted_in",value:function(){var e;this.has_opted_out_capturing()||this.config.request_batching&&((e=this._requestQueue)===null||e===void 0||e.enable())}},{key:"_dom_loaded",value:function(){var e=this;this.has_opted_out_capturing()||$g(this.__request_queue,function(n){return e._send_retriable_request(n)}),this.__request_queue=[],this._start_queue_if_opted_in()}},{key:"_handle_unload",value:function(){var e,n;this.config.request_batching?(this._shouldCapturePageleave()&&this.capture("$pageleave"),(e=this._requestQueue)===null||e===void 0||e.unload(),(n=this._retryQueue)===null||n===void 0||n.unload()):this._shouldCapturePageleave()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}},{key:"_send_request",value:function(e){var n=this;this.__loaded&&(tle?this.__request_queue.push(e):this.rateLimiter.isServerRateLimited(e.batchKey)||(e.transport=e.transport||this.config.api_transport,e.url=g3(e.url,{ip:this.config.ip?1:0}),e.headers=Ne({},this.config.request_headers),e.compression=e.compression==="best-available"?this.compression:e.compression,function(r){var i,s,o,a=Ne({},r);a.timeout=a.timeout||6e4,a.url=g3(a.url,{_:new Date().getTime().toString(),ver:na.LIB_VERSION,compression:a.compression});var c=(i=a.transport)!==null&&i!==void 0?i:"XHR",l=(s=(o=_ce(Wy,function(d){return d.transport===c}))===null||o===void 0?void 0:o.method)!==null&&s!==void 0?s:Wy[0].method;if(!l)throw new Error("No available transport method");l(a)}(Ne(Ne({},e),{},{callback:function(r){var i,s,o;n.rateLimiter.checkForLimiting(r),r.statusCode>=400&&((s=(o=n.config).on_request_error)===null||s===void 0||s.call(o,r)),(i=e.callback)===null||i===void 0||i.call(e,r)}}))))}},{key:"_send_retriable_request",value:function(e){this._retryQueue?this._retryQueue.retriableRequest(e):this._send_request(e)}},{key:"_execute_array",value:function(e){var n,r=this,i=[],s=[],o=[];$g(e,function(c){c&&(n=c[0],oi(n)?o.push(c):da(c)?c.call(r):oi(c)&&n==="alias"?i.push(c):oi(c)&&n.indexOf("capture")!==-1&&da(r[n])?o.push(c):s.push(c))});var a=function(c,l){$g(c,function(d){if(oi(d[0])){var h=l;Pn(d,function(m){h=h[m[0]].apply(h,m.slice(1))})}else this[d[0]].apply(this,d.slice(1))},l)};a(i,this),a(s,this),a(o,this)}},{key:"_hasBootstrappedFeatureFlags",value:function(){var e,n;return((e=this.config.bootstrap)===null||e===void 0?void 0:e.featureFlags)&&Object.keys((n=this.config.bootstrap)===null||n===void 0?void 0:n.featureFlags).length>0||!1}},{key:"push",value:function(e){this._execute_array([e])}},{key:"capture",value:function(e,n,r){var i;if(this.__loaded&&this.persistence&&this.sessionPersistence&&this._requestQueue){if(!this.consent.isOptedOut())if(!Xe(e)&&ns(e)){if(this.config.opt_out_useragent_filter||!this._is_bot()){var s=r!=null&&r.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(s==null||!s.isRateLimited){this.sessionPersistence.update_search_keyword(),this.config.store_google&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.store_google||this.config.save_referrer)&&this.persistence.set_initial_person_info();var o=new Date,a=r?.timestamp||o,c={uuid:Yd(),event:e,properties:this._calculate_event_properties(e,n||{},a)};s&&(c.properties.$lib_rate_limit_remaining_tokens=s.remainingTokens),r?.$set&&(c.$set=r?.$set);var l=this._calculate_set_once_properties(r?.$set_once);l&&(c.$set_once=l),(c=QBe(c,r!=null&&r._noTruncate?null:this.config.properties_string_max_length)).timestamp=a,Xe(r?.timestamp)||(c.properties.$event_time_override_provided=!0,c.properties.$event_time_override_system_time=o);var d=Ne(Ne({},c.properties.$set),c.$set);Ow(d)||this.setPersonPropertiesForFlags(d),this._internalEventEmitter.emit("eventCaptured",c);var h={method:"POST",url:(i=r?._url)!==null&&i!==void 0?i:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:c,compression:"best-available",batchKey:r?._batchKey};return!this.config.request_batching||r&&(r==null||!r._batchKey)||r!=null&&r.send_instantly?this._send_retriable_request(h):this._requestQueue.enqueue(h),c}Ee.critical("This capture call is ignored due to client rate limiting.")}}else Ee.error("No event name provided to posthog.capture")}else Ee.uninitializedWarning("posthog.capture")}},{key:"_addCaptureHook",value:function(e){this.on("eventCaptured",function(n){return e(n.event,n)})}},{key:"_calculate_event_properties",value:function(e,n,r){if(r=r||new Date,!this.persistence||!this.sessionPersistence)return n;var i=this.persistence.remove_event_timer(e),s=Ne({},n);if(s.token=this.config.token,e==="$snapshot"){var o=Ne(Ne({},this.persistence.properties()),this.sessionPersistence.properties());return s.distinct_id=o.distinct_id,(!ns(s.distinct_id)&&!ra(s.distinct_id)||zG(s.distinct_id))&&Ee.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),s}var a=Si.properties();if(this.sessionManager){var c=this.sessionManager.checkAndGetSessionAndWindowId(),l=c.sessionId,d=c.windowId;s.$session_id=l,s.$window_id=d}if(this.requestRouter.region===jh.CUSTOM&&(s.$lib_custom_api_host=this.config.api_host),this.sessionPropsManager&&this.config.__preview_send_client_session_params&&(e==="$pageview"||e==="$pageleave"||e==="$autocapture")){var h=this.sessionPropsManager.getSessionProps();s=hs(s,h)}if(!this.config.disable_scroll_properties){var m={};e==="$pageview"?m=this.pageViewManager.doPageView(r):e==="$pageleave"&&(m=this.pageViewManager.doPageLeave(r)),s=hs(s,m)}if(e==="$pageview"&&$e&&(s.title=$e.title),!Xe(i)){var g=r.getTime()-i;s.$duration=parseFloat((g/1e3).toFixed(3))}_i&&this.config.opt_out_useragent_filter&&(s.$browser_type=this._is_bot()?"bot":"browser"),(s=hs({},a,this.persistence.properties(),this.sessionPersistence.properties(),s)).$is_identified=this._isIdentified(),oi(this.config.property_denylist)?Pn(this.config.property_denylist,function(v){delete s[v]}):Ee.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var y=this.config.sanitize_properties;return y&&(s=y(s,e)),s.$process_person_profile=this._hasPersonProcessing(),s}},{key:"_calculate_set_once_properties",value:function(e){if(!this.persistence||!this._hasPersonProcessing())return e;var n=hs({},this.persistence.get_initial_props(),e||{});return Ow(n)?void 0:n}},{key:"register",value:function(e,n){var r;(r=this.persistence)===null||r===void 0||r.register(e,n)}},{key:"register_once",value:function(e,n,r){var i;(i=this.persistence)===null||i===void 0||i.register_once(e,n,r)}},{key:"register_for_session",value:function(e){var n;(n=this.sessionPersistence)===null||n===void 0||n.register(e)}},{key:"unregister",value:function(e){var n;(n=this.persistence)===null||n===void 0||n.unregister(e)}},{key:"unregister_for_session",value:function(e){var n;(n=this.sessionPersistence)===null||n===void 0||n.unregister(e)}},{key:"_register_single",value:function(e,n){this.register(pe({},e,n))}},{key:"getFeatureFlag",value:function(e,n){return this.featureFlags.getFeatureFlag(e,n)}},{key:"getFeatureFlagPayload",value:function(e){var n=this.featureFlags.getFeatureFlagPayload(e);try{return JSON.parse(n)}catch{return n}}},{key:"isFeatureEnabled",value:function(e,n){return this.featureFlags.isFeatureEnabled(e,n)}},{key:"reloadFeatureFlags",value:function(){this.featureFlags.reloadFeatureFlags()}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,n){this.featureFlags.updateEarlyAccessFeatureEnrollment(e,n)}},{key:"getEarlyAccessFeatures",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this.featureFlags.getEarlyAccessFeatures(e,n)}},{key:"on",value:function(e,n){return this._internalEventEmitter.on(e,n)}},{key:"onFeatureFlags",value:function(e){return this.featureFlags.onFeatureFlags(e)}},{key:"onSessionId",value:function(e){var n,r;return(n=(r=this.sessionManager)===null||r===void 0?void 0:r.onSessionId(e))!==null&&n!==void 0?n:function(){}}},{key:"getSurveys",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.surveys.getSurveys(e,n)}},{key:"getActiveMatchingSurveys",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.surveys.getActiveMatchingSurveys(e,n)}},{key:"renderSurvey",value:function(e,n){this.surveys.renderSurvey(e,n)}},{key:"canRenderSurvey",value:function(e){this.surveys.canRenderSurvey(e)}},{key:"getNextSurveyStep",value:function(e,n,r){return this.surveys.getNextSurveyStep(e,n,r)}},{key:"identify",value:function(e,n,r){if(!this.__loaded||!this.persistence)return Ee.uninitializedWarning("posthog.identify");if(ra(e)&&(e=e.toString(),Ee.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),e){if(["distinct_id","distinctid"].includes(e.toLowerCase()))Ee.critical('The string "'.concat(e,'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.'));else if(this._requirePersonProcessing("posthog.identify")){var i=this.get_distinct_id();if(this.register({$user_id:e}),!this.get_property("$device_id")){var s=i;this.register_once({$had_persisted_distinct_id:!0,$device_id:s},"")}e!==i&&e!==this.get_property(gy)&&(this.unregister(gy),this.register({distinct_id:e}));var o=(this.persistence.get_property(Xl)||"anonymous")==="anonymous";e!==i&&o?(this.persistence.set_property(Xl,"identified"),this.setPersonPropertiesForFlags(n||{},!1),this.capture("$identify",{distinct_id:e,$anon_distinct_id:i},{$set:n||{},$set_once:r||{}}),this.featureFlags.setAnonymousDistinctId(i)):(n||r)&&this.setPersonProperties(n,r),e!==i&&(this.reloadFeatureFlags(),this.unregister(c3))}}else Ee.error("Unique user id has not been set in posthog.identify")}},{key:"setPersonProperties",value:function(e,n){(e||n)&&this._requirePersonProcessing("posthog.setPersonProperties")&&(this.setPersonPropertiesForFlags(e||{}),this.capture("$set",{$set:e||{},$set_once:n||{}}))}},{key:"group",value:function(e,n,r){if(e&&n){if(this._requirePersonProcessing("posthog.group")){var i=this.getGroups();i[e]!==n&&this.resetGroupPropertiesForFlags(e),this.register({$groups:Ne(Ne({},i),{},pe({},e,n))}),r&&(this.capture("$groupidentify",{$group_type:e,$group_key:n,$group_set:r}),this.setGroupPropertiesForFlags(pe({},e,r))),i[e]===n||r||this.reloadFeatureFlags()}}else Ee.error("posthog.group requires a group type and group key")}},{key:"resetGroups",value:function(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}},{key:"setPersonPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this._requirePersonProcessing("posthog.setPersonPropertiesForFlags")&&this.featureFlags.setPersonPropertiesForFlags(e,n)}},{key:"resetPersonPropertiesForFlags",value:function(){this.featureFlags.resetPersonPropertiesForFlags()}},{key:"setGroupPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this._requirePersonProcessing("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(e,n)}},{key:"resetGroupPropertiesForFlags",value:function(e){this.featureFlags.resetGroupPropertiesForFlags(e)}},{key:"reset",value:function(e){var n,r,i,s;if(Ee.info("reset"),!this.__loaded)return Ee.uninitializedWarning("posthog.reset");var o=this.get_property("$device_id");this.consent.reset(),(n=this.persistence)===null||n===void 0||n.clear(),(r=this.sessionPersistence)===null||r===void 0||r.clear(),(i=this.persistence)===null||i===void 0||i.set_property(Xl,"anonymous"),(s=this.sessionManager)===null||s===void 0||s.resetSessionId();var a=this.config.get_device_id(Yd());this.register_once({distinct_id:a,$device_id:e?a:o},"")}},{key:"get_distinct_id",value:function(){return this.get_property("distinct_id")}},{key:"getGroups",value:function(){return this.get_property("$groups")||{}}},{key:"get_session_id",value:function(){var e,n;return(e=(n=this.sessionManager)===null||n===void 0?void 0:n.checkAndGetSessionAndWindowId(!0).sessionId)!==null&&e!==void 0?e:""}},{key:"get_session_replay_url",value:function(e){if(!this.sessionManager)return"";var n=this.sessionManager.checkAndGetSessionAndWindowId(!0),r=n.sessionId,i=n.sessionStartTimestamp,s=this.requestRouter.endpointFor("ui","/project/".concat(this.config.token,"/replay/").concat(r));if(e!=null&&e.withTimestamp&&i){var o,a=(o=e.timestampLookBack)!==null&&o!==void 0?o:10;if(!i)return s;var c=Math.max(Math.floor((new Date().getTime()-i)/1e3)-a,0);s+="?t=".concat(c)}return s}},{key:"alias",value:function(e,n){return e===this.get_property(Sce)?(Ee.critical("Attempting to create alias for existing People user - aborting."),-2):this._requirePersonProcessing("posthog.alias")?(Xe(n)&&(n=this.get_distinct_id()),e!==n?(this._register_single(gy,e),this.capture("$create_alias",{alias:e,distinct_id:n})):(Ee.warn("alias matches current distinct_id - skipping api call."),this.identify(e),-1)):void 0}},{key:"set_config",value:function(e){var n,r,i,s,o=Ne({},this.config);Fi(e)&&(hs(this.config,jK(e)),(n=this.persistence)===null||n===void 0||n.update_config(this.config,o),this.sessionPersistence=this.config.persistence==="sessionStorage"?this.persistence:new Ax(Ne(Ne({},this.config),{},{persistence:"sessionStorage"})),ri.is_supported()&&ri.get("ph_debug")==="true"&&(this.config.debug=!0),this.config.debug&&(na.DEBUG=!0,Ee.info("set_config",{config:e,oldConfig:o,newConfig:Ne({},this.config)})),(r=this.sessionRecording)===null||r===void 0||r.startIfEnabledOrStop(),(i=this.autocapture)===null||i===void 0||i.startIfEnabled(),(s=this.heatmaps)===null||s===void 0||s.startIfEnabled(),this.surveys.loadIfEnabled(),this._sync_opt_out_with_persistence())}},{key:"startSessionRecording",value:function(e){var n,r=Uh(e)&&e;if(r||e!=null&&e.sampling){var i,s,o=(i=this.sessionManager)===null||i===void 0?void 0:i.checkAndGetSessionAndWindowId();(s=this.persistence)===null||s===void 0||s.register(pe({},Gy,!0)),Ee.info("Session recording started with sampling override for session: ",o?.sessionId)}(r||e!=null&&e.linked_flag)&&((n=this.sessionRecording)===null||n===void 0||n.overrideLinkedFlag(),Ee.info("Session recording started with linked_flags override")),this.set_config({disable_session_recording:!1})}},{key:"stopSessionRecording",value:function(){this.set_config({disable_session_recording:!0})}},{key:"sessionRecordingStarted",value:function(){var e;return!((e=this.sessionRecording)===null||e===void 0||!e.started)}},{key:"captureException",value:function(e,n){var r=da(Zn.parseErrorAsProperties)?Zn.parseErrorAsProperties([e.message,void 0,void 0,void 0,e]):Ne({$exception_type:e.name,$exception_message:e.message,$exception_level:"error"},n);this.exceptions.sendExceptionEvent(r)}},{key:"loadToolbar",value:function(e){return this.toolbar.loadToolbar(e)}},{key:"get_property",value:function(e){var n;return(n=this.persistence)===null||n===void 0?void 0:n.props[e]}},{key:"getSessionProperty",value:function(e){var n;return(n=this.sessionPersistence)===null||n===void 0?void 0:n.props[e]}},{key:"toString",value:function(){var e,n=(e=this.config.name)!==null&&e!==void 0?e:ig;return n!==ig&&(n=ig+"."+n),n}},{key:"_isIdentified",value:function(){var e,n;return((e=this.persistence)===null||e===void 0?void 0:e.get_property(Xl))==="identified"||((n=this.sessionPersistence)===null||n===void 0?void 0:n.get_property(Xl))==="identified"}},{key:"_hasPersonProcessing",value:function(){var e,n,r,i;return!(this.config.person_profiles==="never"||this.config.person_profiles==="identified_only"&&!this._isIdentified()&&Ow(this.getGroups())&&((e=this.persistence)===null||e===void 0||(n=e.props)===null||n===void 0||!n[gy])&&((r=this.persistence)===null||r===void 0||(i=r.props)===null||i===void 0||!i[l3]))}},{key:"_shouldCapturePageleave",value:function(){return this.config.capture_pageleave===!0||this.config.capture_pageleave==="if_capture_pageview"&&this.config.capture_pageview}},{key:"createPersonProfile",value:function(){this._hasPersonProcessing()||this._requirePersonProcessing("posthog.createPersonProfile")&&this.setPersonProperties({},{})}},{key:"_requirePersonProcessing",value:function(e){return this.config.person_profiles==="never"?(Ee.error(e+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this._register_single(l3,!0),!0)}},{key:"_sync_opt_out_with_persistence",value:function(){var e,n,r,i,s=this.consent.isOptedOut(),o=this.config.opt_out_persistence_by_default,a=this.config.disable_persistence||s&&!!o;((e=this.persistence)===null||e===void 0?void 0:e.disabled)!==a&&((r=this.persistence)===null||r===void 0||r.set_disabled(a)),((n=this.sessionPersistence)===null||n===void 0?void 0:n.disabled)!==a&&((i=this.sessionPersistence)===null||i===void 0||i.set_disabled(a))}},{key:"opt_in_capturing",value:function(e){var n;this.consent.optInOut(!0),this._sync_opt_out_with_persistence(),(Xe(e?.captureEventName)||e!=null&&e.captureEventName)&&this.capture((n=e?.captureEventName)!==null&&n!==void 0?n:"$opt_in",e?.captureProperties,{send_instantly:!0}),this.config.capture_pageview&&this._captureInitialPageview()}},{key:"opt_out_capturing",value:function(){this.consent.optInOut(!1),this._sync_opt_out_with_persistence()}},{key:"has_opted_in_capturing",value:function(){return this.consent.isOptedIn()}},{key:"has_opted_out_capturing",value:function(){return this.consent.isOptedOut()}},{key:"clear_opt_in_out_capturing",value:function(){this.consent.reset(),this._sync_opt_out_with_persistence()}},{key:"_is_bot",value:function(){return ec?function(e,n){if(!e)return!1;var r=e.userAgent;if(r&&LK(r,n))return!0;try{var i=e?.userAgentData;if(i!=null&&i.brands&&i.brands.some(function(s){return LK(s?.brand,n)}))return!0}catch{}return!!e.webdriver}(ec,this.config.custom_blocked_useragents):void 0}},{key:"_captureInitialPageview",value:function(){$e&&!this._initialPageviewCaptured&&(this._initialPageviewCaptured=!0,this.capture("$pageview",{title:$e.title},{send_instantly:!0}))}},{key:"debug",value:function(e){e===!1?(oe?.console.log("You've disabled debug mode."),localStorage&&localStorage.removeItem("ph_debug"),this.set_config({debug:!1})):(oe?.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),localStorage&&localStorage.setItem("ph_debug","true"),this.set_config({debug:!0}))}}]),t}();(function(t,e){for(var n=0;n<e.length;n++)t.prototype[e[n]]=JBe(t.prototype[e[n]])})(nle,["identify"]);var FK,CVe=(FK=Yy[ig]=new nle,function(){function t(){t.done||(t.done=!0,tle=!1,Pn(Yy,function(e){e._dom_loaded()}))}$e!=null&&$e.addEventListener&&($e.readyState==="complete"?t():$e.addEventListener("DOMContentLoaded",t,!1)),oe&&uu(oe,"load",t,!0)}(),FK);class TVe extends zX{constructor(){super(...arguments),this.eventBacklogs=new Map}emit(e,...n){const r=super.emit(e,...n);if(!r){const i=this.eventBacklogs.get(e);i?i.push(n):this.eventBacklogs.set(e,[n])}return r}on(e,n){super.on(e,n);const r=this.eventBacklogs.get(e);if(r){for(const i of r)super.emit(e,...i);this.eventBacklogs.delete(e)}return this}addListener(e,n){return this.on(e,n)}once(e,n){super.once(e,n);const r=this.eventBacklogs.get(e);return r&&(super.emit(e,...r[0]),r.length===1?this.eventBacklogs.delete(e):r.shift()),this}}const RVe=""+new URL("cat-4r_NkDcK.ogg",import.meta.url).href,IVe=""+new URL("cat-Dd8bv_2W.mp3",import.meta.url).href,kVe=""+new URL("clap-AxCMZLTd.ogg",import.meta.url).href,xVe=""+new URL("clap-Dxm5qGyl.mp3",import.meta.url).href,AVe=""+new URL("crickets-DUJdcuUa.ogg",import.meta.url).href,PVe=""+new URL("crickets-CcwrRdbq.mp3",import.meta.url).href,LVe=""+new URL("dog-CxIWtkNX.ogg",import.meta.url).href,OVe=""+new URL("dog-BoQdnF-w.mp3",import.meta.url).href,MVe=""+new URL("generic-BBbS3Wph.ogg",import.meta.url).href,DVe=""+new URL("generic-BFeSb6fL.mp3",import.meta.url).href,NVe=""+new URL("lightbulb-BIeJtAR_.ogg",import.meta.url).href,UVe=""+new URL("lightbulb-BrnY00qi.mp3",import.meta.url).href,jVe=""+new URL("party-D7rIOhAQ.ogg",import.meta.url).href,FVe=""+new URL("party-BZPeTgC3.mp3",import.meta.url).href,$Ve=""+new URL("deer-DPSlVch4.ogg",import.meta.url).href,BVe=""+new URL("deer-91r1Gyrx.mp3",import.meta.url).href,HVe=""+new URL("rock-BVCJXNC-.ogg",import.meta.url).href,VVe=""+new URL("rock-CHdnB31m.mp3",import.meta.url).href,qVe=""+new URL("wave-FiiOzicp.ogg",import.meta.url).href,GVe=""+new URL("wave-Bzf1LSMH.mp3",import.meta.url).href,KVe=""+new URL("baduntss-Ca1ZuBEK.ogg",import.meta.url).href,zVe=""+new URL("baduntss-DOe0oFuS.mp3",import.meta.url).href,O8="io.element.call.reaction",UL={name:"generic",emoji:"",sound:{mp3:DVe,ogg:MVe}},jL=5,qb=[{emoji:"👍",name:"thumbsup",alias:["+1","yes","thumbs up"]},{emoji:"🎉",name:"party",alias:["hurray","success"],sound:{ogg:jVe,mp3:FVe}},{emoji:"👏",name:"clapping",alias:["celebrate","success"],sound:{ogg:kVe,mp3:xVe}},{emoji:"🐶",name:"dog",alias:["doggo","pupper","woofer","bark"],sound:{ogg:LVe,mp3:OVe}},{emoji:"🐱",name:"cat",alias:["meow","kitty"],sound:{ogg:RVe,mp3:IVe}},{emoji:"💡",name:"lightbulb",alias:["bulb","light","idea","ping"],sound:{ogg:NVe,mp3:UVe}},{emoji:"🦗",name:"crickets",alias:["awkward","silence"],sound:{ogg:AVe,mp3:PVe}},{emoji:"👎",name:"thumbsdown",alias:["-1","no","thumbs no"]},{emoji:"😵‍💫",name:"dizzy",alias:["dazed","confused"]},{emoji:"👌",name:"ok",alias:["okay","cool"]},{emoji:"🥰",name:"heart",alias:["heart","love","smiling"]},{emoji:"😄",name:"laugh",alias:["giggle","joy","smiling"]},{emoji:"🦌",name:"deer",alias:["stag","doe","bleat"],sound:{ogg:$Ve,mp3:BVe}},{emoji:"🤘",name:"rock",alias:["cool","horns","guitar"],sound:{ogg:HVe,mp3:VVe}},{emoji:"👋",name:"wave",alias:["hand","waving"],sound:{ogg:qVe,mp3:GVe}},{emoji:"🥁",name:"drum",alias:["joke"],sound:{ogg:KVe,mp3:zVe}}];var Ri=(t=>(t.JoinCall="io.element.join",t.HangupCall="im.vector.hangup",t.Close="io.element.close",t.TileLayout="io.element.tile_layout",t.SpotlightLayout="io.element.spotlight_layout",t.DeviceMute="io.element.device_mute",t))(Ri||{});const ut=(()=>{try{const{widgetId:t,parentUrl:e}=Br();if(t&&e){const n=new URL(e).origin;M.info("Widget API is available");const r=new Zye(t,n);r.requestCapability(xy.AlwaysOnScreen);const i=new TVe;[vr.ThemeChange,"io.element.join","im.vector.hangup","io.element.tile_layout","io.element.spotlight_layout","io.element.device_mute"].forEach(R=>{r.on(`action:${R}`,x=>{x.preventDefault(),i.emit(R,x)})});const{roomId:s,userId:o,deviceId:a,baseUrl:c,e2eEnabled:l,allowIceFallback:d}=Br();if(!s)throw new Error("Room ID must be supplied");if(!o)throw new Error("User ID must be supplied");if(!a)throw new Error("Device ID must be supplied");if(!c)throw new Error("Base URL must be supplied");const h=[Z.CallNotify,Z.RTCNotification],m=["org.matrix.rageshake_request",Z.CallEncryptionKeysPrefix,Z.Reaction,Z.RoomRedaction,O8,Z.RTCDecline],g=[o,`_${o}_${a}_m.call`,`${o}_${a}_m.call`].map(R=>({eventType:Z.GroupCallMemberPrefix,stateKey:R})),y=[{eventType:Z.RoomCreate},{eventType:Z.RoomName},{eventType:Z.RoomMember},{eventType:Z.RoomEncryption},{eventType:Z.GroupCallMemberPrefix}],v=[Z.CallInvite,Z.CallCandidates,Z.CallAnswer,Z.CallHangup,Z.CallReject,Z.CallSelectAnswer,Z.CallNegotiate,Z.CallSDPStreamMetadataChanged,Z.CallSDPStreamMetadataChangedPrefix,Z.CallReplaces,Z.CallEncryptionKeysPrefix],w=jQ(r,{sendEvent:[...h,...m],receiveEvent:m,sendState:g,receiveState:y,sendToDevice:v,receiveToDevice:v,turnServers:!1,sendDelayedEvents:!0,updateDelayedEvents:!0},s,{baseUrl:c,userId:o,deviceId:a,timelineSupport:!0,useE2eForGroupCall:l,fallbackICEServerAllowed:d},!1);return{api:r,lazyActions:i,client:(async()=>(await sn.init(),await w.startClient({clientWellKnownPollPeriod:60*10}),w))()}}else return M.info("No widget API available"),null}catch(t){return M.warn("Continuing without the widget API",t),null}})();class WVe{constructor(){this.cache={startTime:new Date(0),maxParticipantsCount:0}}cacheStartCall(e){this.cache.startTime=e}cacheParticipantCountChanged(e){this.cache.maxParticipantsCount=Math.max(e,this.cache.maxParticipantsCount)}track(e,n,r,i){Ut.instance.trackEvent({eventName:"CallEnded",callId:e,callParticipantsMax:this.cache.maxParticipantsCount,callParticipantsOnLeave:n,callDuration:(Date.now()-this.cache.startTime.getTime())/1e3,roomEventEncryptionKeysSent:i.statistics.counters.roomEventEncryptionKeysSent,roomEventEncryptionKeysReceived:i.statistics.counters.roomEventEncryptionKeysReceived,roomEventEncryptionKeysReceivedAverageAge:i.statistics.counters.roomEventEncryptionKeysReceived>0?i.statistics.totals.roomEventEncryptionKeysReceivedTotalAge/i.statistics.counters.roomEventEncryptionKeysReceived:0},{send_instantly:r})}}class YVe{track(e){Ut.instance.trackEvent({eventName:"CallStarted",callId:e})}}class XVe{constructor(){this.cache={signupStart:new Date(0),signupEnd:new Date(0)}}cacheSignupStart(e){this.cache.signupStart=e}getSignupEndTime(){return this.cache.signupEnd}cacheSignupEnd(e){this.cache.signupEnd=e}track(){Ut.instance.trackEvent({eventName:"Signup",signupDuration:Date.now()-this.cache.signupStart.getTime()}),Ut.instance.setRegistrationType(dR.Registered)}}class JVe{track(){Ut.instance.trackEvent({eventName:"Login"}),Ut.instance.setRegistrationType(dR.Registered)}}class QVe{track(e,n){Ut.instance.trackEvent({eventName:"MuteMicrophone",targetMuteState:e?"mute":"unmute",callId:n})}}class ZVe{track(e,n){Ut.instance.trackEvent({eventName:"MuteCamera",targetMuteState:e?"mute":"unmute",callId:n})}}class eqe{track(e){Ut.instance.trackEvent({eventName:"UndecryptableToDeviceEvent",callId:e})}}class tqe{track(e,n,r){Ut.instance.trackEvent({eventName:"QualitySurvey",callId:e,feedbackText:n,stars:r})}}class nqe{track(e){Ut.instance.trackEvent({eventName:"CallDisconnected",reason:e})}}class rqe{constructor(){this.connectStart=0,this.websocketConnected=0}cacheConnectStart(){this.connectStart=Date.now()}cacheWsConnect(){this.websocketConnected=Date.now()}track(e={log:!1}){const n=Date.now(),r=n-this.connectStart,i=this.websocketConnected-this.connectStart,s=n-this.websocketConnected;Ut.instance.trackEvent({eventName:"CallConnectDuration",totalDuration:r,websocketDuration:i,peerConnectionDuration:s}),e.log&&M.log(`Time to connect:
total: ${r}ms
peerConnection: ${i}ms
websocket: ${s}ms`)}}function Rn(t){return typeof t=="function"}function rle(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Nx=rle(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function y3(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var j_=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Ef(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(v){e={error:v}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var d=this.initialTeardown;if(Rn(d))try{d()}catch(v){s=v instanceof Nx?v.errors:[v]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var m=Ef(h),g=m.next();!g.done;g=m.next()){var y=g.value;try{$K(y)}catch(v){s=s??[],v instanceof Nx?s=Ea(Ea([],Sa(s)),Sa(v.errors)):s.push(v)}}}catch(v){r={error:v}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(r)throw r.error}}}if(s)throw new Nx(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)$K(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&y3(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&y3(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),ile=j_.EMPTY;function sle(t){return t instanceof j_||t&&"closed"in t&&Rn(t.remove)&&Rn(t.add)&&Rn(t.unsubscribe)}function $K(t){Rn(t)?t():t.unsubscribe()}var iqe={Promise:void 0},sqe={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,Ea([t,e],Sa(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function ole(t){sqe.setTimeout(function(){throw t})}function wv(){}function Nw(t){t()}var M8=function(t){cc(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,sle(n)&&n.add(r)):r.destination=cqe,r}return e.create=function(n,r,i){return new FL(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(j_),oqe=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){yE(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){yE(r)}else yE(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){yE(n)}},t}(),FL=function(t){cc(e,t);function e(n,r,i){var s=t.call(this)||this,o;return Rn(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new oqe(o),s}return e}(M8);function yE(t){ole(t)}function aqe(t){throw t}var cqe={closed:!0,next:wv,error:aqe,complete:wv},D8=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function $f(t){return t}function lqe(t){return t.length===0?$f:t.length===1?t[0]:function(n){return t.reduce(function(r,i){return i(r)},n)}}var Wn=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=dqe(e)?e:new FL(e,n,r);return Nw(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=BK(n),new n(function(i,s){var o=new FL({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[D8]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return lqe(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=BK(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t}();function BK(t){var e;return(e=t??iqe.Promise)!==null&&e!==void 0?e:Promise}function uqe(t){return t&&Rn(t.next)&&Rn(t.error)&&Rn(t.complete)}function dqe(t){return t&&t instanceof M8||uqe(t)&&sle(t)}function fqe(t){return Rn(t?.lift)}function Lr(t){return function(e){if(fqe(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Yn(t,e,n,r,i){return new hqe(t,e,n,r,i)}var hqe=function(t){cc(e,t);function e(n,r,i,s,o,a){var c=t.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(d){n.error(d)}}:t.prototype._next,c._error=s?function(l){try{s(l)}catch(d){n.error(d)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=i?function(){try{i()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(M8),pqe=rle(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ii=function(t){cc(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new HK(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new pqe},e.prototype.next=function(n){var r=this;Nw(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=Ef(r.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;Nw(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;Nw(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?ile:(this.currentObservers=null,a.push(n),new j_(function(){r.currentObservers=null,y3(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new Wn;return n.source=this,n},e.create=function(n,r){return new HK(n,r)},e}(Wn),HK=function(t){cc(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:ile},e}(ii),_s=function(t){cc(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(ii),mqe={now:function(){return Date.now()}},gqe=function(t){cc(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(j_),VK={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,Ea([t,e],Sa(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},vqe=function(t){cc(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),VK.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&VK.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,y3(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(gqe),qK=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=mqe.now,t}(),yqe=function(t){cc(e,t);function e(n,r){r===void 0&&(r=qK.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e}(qK),lR=new yqe(vqe),bqe=lR,vg=new Wn(function(t){return t.complete()});function ale(t){return t&&Rn(t.schedule)}function N8(t){return t[t.length-1]}function U8(t){return Rn(N8(t))?t.pop():void 0}function F_(t){return ale(N8(t))?t.pop():void 0}function _qe(t,e){return typeof N8(t)=="number"?t.pop():e}var j8=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function cle(t){return Rn(t?.then)}function lle(t){return Rn(t[D8])}function ule(t){return Symbol.asyncIterator&&Rn(t?.[Symbol.asyncIterator])}function dle(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Sqe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var fle=Sqe();function hle(t){return Rn(t?.[fle])}function ple(t){return yM(this,arguments,function(){var n,r,i,s;return $T(this,function(o){switch(o.label){case 0:n=t.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Eu(n.read())];case 3:return r=o.sent(),i=r.value,s=r.done,s?[4,Eu(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Eu(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function mle(t){return Rn(t?.getReader)}function zi(t){if(t instanceof Wn)return t;if(t!=null){if(lle(t))return Eqe(t);if(j8(t))return wqe(t);if(cle(t))return Cqe(t);if(ule(t))return gle(t);if(hle(t))return Tqe(t);if(mle(t))return Rqe(t)}throw dle(t)}function Eqe(t){return new Wn(function(e){var n=t[D8]();if(Rn(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function wqe(t){return new Wn(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function Cqe(t){return new Wn(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,ole)})}function Tqe(t){return new Wn(function(e){var n,r;try{for(var i=Ef(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function gle(t){return new Wn(function(e){Iqe(t,e).catch(function(n){return e.error(n)})})}function Rqe(t){return gle(ple(t))}function Iqe(t,e){var n,r,i,s;return vM(this,void 0,void 0,function(){var o,a;return $T(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=bM(t),c.label=1;case 1:return[4,n.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function cf(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function vle(t,e){return e===void 0&&(e=0),Lr(function(n,r){n.subscribe(Yn(r,function(i){return cf(r,t,function(){return r.next(i)},e)},function(){return cf(r,t,function(){return r.complete()},e)},function(i){return cf(r,t,function(){return r.error(i)},e)}))})}function yle(t,e){return e===void 0&&(e=0),Lr(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function kqe(t,e){return zi(t).pipe(yle(e),vle(e))}function xqe(t,e){return zi(t).pipe(yle(e),vle(e))}function Aqe(t,e){return new Wn(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function Pqe(t,e){return new Wn(function(n){var r;return cf(n,e,function(){r=t[fle](),cf(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return Rn(r?.return)&&r.return()}})}function ble(t,e){if(!t)throw new Error("Iterable cannot be null");return new Wn(function(n){cf(n,e,function(){var r=t[Symbol.asyncIterator]();cf(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function Lqe(t,e){return ble(ple(t),e)}function Oqe(t,e){if(t!=null){if(lle(t))return kqe(t,e);if(j8(t))return Aqe(t,e);if(cle(t))return xqe(t,e);if(ule(t))return ble(t,e);if(hle(t))return Pqe(t,e);if(mle(t))return Lqe(t,e)}throw dle(t)}function $_(t,e){return e?Oqe(t,e):zi(t)}function Ct(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=F_(t);return $_(t,n)}function Mqe(t){return t instanceof Date&&!isNaN(t)}function Re(t,e){return Lr(function(n,r){var i=0;n.subscribe(Yn(r,function(s){r.next(t.call(e,s,i++))}))})}var Dqe=Array.isArray;function Nqe(t,e){return Dqe(e)?t.apply(void 0,Ea([],Sa(e))):t(e)}function F8(t){return Re(function(e){return Nqe(t,e)})}var Uqe=Array.isArray,jqe=Object.getPrototypeOf,Fqe=Object.prototype,$qe=Object.keys;function _le(t){if(t.length===1){var e=t[0];if(Uqe(e))return{args:e,keys:null};if(Bqe(e)){var n=$qe(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function Bqe(t){return t&&typeof t=="object"&&jqe(t)===Fqe}function Sle(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function Xt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=F_(t),r=U8(t),i=_le(t),s=i.args,o=i.keys;if(s.length===0)return $_([],n);var a=new Wn(Hqe(s,n,o?function(c){return Sle(o,c)}:$f));return r?a.pipe(F8(r)):a}function Hqe(t,e,n){return n===void 0&&(n=$f),function(r){GK(e,function(){for(var i=t.length,s=new Array(i),o=i,a=i,c=function(d){GK(e,function(){var h=$_(t[d],e),m=!1;h.subscribe(Yn(r,function(g){s[d]=g,m||(m=!0,a--),a||r.next(n(s.slice()))},function(){--o||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function GK(t,e,n){t?cf(n,t,e):e()}function Vqe(t,e,n,r,i,s,o,a){var c=[],l=0,d=0,h=!1,m=function(){h&&!c.length&&!l&&e.complete()},g=function(v){return l<r?y(v):c.push(v)},y=function(v){l++;var w=!1;zi(n(v,d++)).subscribe(Yn(e,function(S){e.next(S)},function(){w=!0},void 0,function(){if(w)try{l--;for(var S=function(){var R=c.shift();o||y(R)};c.length&&l<r;)S();m()}catch(R){e.error(R)}}))};return t.subscribe(Yn(e,g,function(){h=!0,m()})),function(){}}function B_(t,e,n){return n===void 0&&(n=1/0),Rn(e)?B_(function(r,i){return Re(function(s,o){return e(r,s,i,o)})(zi(t(r,i)))},n):(typeof e=="number"&&(n=e),Lr(function(r,i){return Vqe(r,i,t,n)}))}function Ele(t){return t===void 0&&(t=1/0),B_($f,t)}function qqe(){return Ele(1)}function mp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return qqe()($_(t,F_(t)))}function Gqe(t){return new Wn(function(e){zi(t()).subscribe(e)})}function Kqe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=U8(t),r=_le(t),i=r.args,s=r.keys,o=new Wn(function(a){var c=i.length;if(!c){a.complete();return}for(var l=new Array(c),d=c,h=c,m=function(y){var v=!1;zi(i[y]).subscribe(Yn(a,function(w){v||(v=!0,h--),l[y]=w},function(){return d--},void 0,function(){(!d||!v)&&(h||a.next(s?Sle(s,l):l),a.complete())}))},g=0;g<c;g++)m(g)});return n?o.pipe(F8(n)):o}var zqe=["addListener","removeListener"],Wqe=["addEventListener","removeEventListener"],Yqe=["on","off"];function Zo(t,e,n,r){if(Rn(n)&&(r=n,n=void 0),r)return Zo(t,e,n).pipe(F8(r));var i=Sa(Qqe(t)?Wqe.map(function(a){return function(c){return t[a](e,c,n)}}):Xqe(t)?zqe.map(KK(t,e)):Jqe(t)?Yqe.map(KK(t,e)):[],2),s=i[0],o=i[1];if(!s&&j8(t))return B_(function(a){return Zo(a,e,n)})(zi(t));if(!s)throw new TypeError("Invalid event target");return new Wn(function(a){var c=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];return a.next(1<l.length?l:l[0])};return s(c),function(){return o(c)}})}function KK(t,e){return function(n){return function(r){return t[n](e,r)}}}function Xqe(t){return Rn(t.addListener)&&Rn(t.removeListener)}function Jqe(t){return Rn(t.on)&&Rn(t.off)}function Qqe(t){return Rn(t.addEventListener)&&Rn(t.removeEventListener)}function du(t,e,n){t===void 0&&(t=0),n===void 0&&(n=bqe);var r=-1;return e!=null&&(ale(e)?n=e:r=e),new Wn(function(i){var s=Mqe(t)?+t-n.now():t;s<0&&(s=0);var o=0;return n.schedule(function(){i.closed||(i.next(o++),0<=r?this.schedule(void 0,r):i.complete())},s)})}function Zqe(t,e){return e===void 0&&(e=lR),du(t,t,e)}function H_(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=F_(t),r=_qe(t,1/0),i=t;return i.length?i.length===1?zi(i[0]):Ele(r)($_(i,n)):vg}var $L=new Wn(wv),eGe=Array.isArray;function tGe(t){return t.length===1&&eGe(t[0])?t[0]:t}function es(t,e){return Lr(function(n,r){var i=0;n.subscribe(Yn(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function nGe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=tGe(t),t.length===1?zi(t[0]):new Wn(rGe(t))}function rGe(t){return function(e){for(var n=[],r=function(s){n.push(zi(t[s]).subscribe(Yn(e,function(o){if(n){for(var a=0;a<n.length;a++)a!==s&&n[a].unsubscribe();n=null}e.next(o)})))},i=0;n&&!e.closed&&i<t.length;i++)r(i)}}function wle(t){return Lr(function(e,n){var r=!1,i=null,s=null,o=!1,a=function(){if(s?.unsubscribe(),s=null,r){r=!1;var l=i;i=null,n.next(l)}o&&n.complete()},c=function(){s=null,o&&n.complete()};e.subscribe(Yn(n,function(l){r=!0,i=l,s||zi(t(l)).subscribe(s=Yn(n,a,c))},function(){o=!0,(!r||!s||s.closed)&&n.complete()}))})}function iGe(t,e,n,r,i){return function(s,o){var a=n,c=e,l=0;s.subscribe(Yn(o,function(d){var h=l++;c=a?t(c,d,h):(a=!0,d),o.next(c)},i))}}function Uw(t){return t<=0?function(){return vg}:Lr(function(e,n){var r=0;e.subscribe(Yn(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function sGe(){return Lr(function(t,e){t.subscribe(Yn(e,wv))})}function oGe(t){return Re(function(){return t})}function aGe(t,e){return B_(function(n,r){return zi(t(n,r)).pipe(Uw(1),oGe(n))})}function cGe(t,e){e===void 0&&(e=lR);var n=du(t,e);return aGe(function(){return n})}function Kc(t,e){return e===void 0&&(e=$f),t=t??lGe,Lr(function(n,r){var i,s=!0;n.subscribe(Yn(r,function(o){var a=e(o);(s||!t(i,a))&&(s=!1,i=a,r.next(o))}))})}function lGe(t,e){return t===e}function uGe(t,e){return Kc(function(n,r){return n[t]===r[t]})}function dGe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(n){return mp(n,Ct.apply(void 0,Ea([],Sa(t))))}}function fGe(t){return Lr(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function jw(){return Lr(function(t,e){var n,r=!1;t.subscribe(Yn(e,function(i){var s=n;n=i,r&&e.next([s,i]),r=!0}))})}function ql(t,e){return Lr(iGe(t,e,arguments.length>=2,!0))}function hGe(t){return es(function(e,n){return t<=n})}function pGe(t){return Lr(function(e,n){var r=!1,i=0;e.subscribe(Yn(n,function(s){return(r||(r=!t(s,i++)))&&n.next(s)}))})}function dn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=F_(t);return Lr(function(r,i){(n?mp(t,r,n):mp(t,r)).subscribe(i)})}function Ot(t,e){return Lr(function(n,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};n.subscribe(Yn(r,function(c){i?.unsubscribe();var l=0,d=s++;zi(t(c,d)).subscribe(i=Yn(r,function(h){return r.next(e?e(c,h,d,l++):h)},function(){i=null,a()}))},function(){o=!0,a()}))})}function zK(){return Ot($f)}function mGe(t,e){return Lr(function(n,r){var i=e;return Ot(function(s,o){return t(i,s,o)},function(s,o){return i=o,o})(n).subscribe(r),function(){i=null}})}function Cle(t){return Lr(function(e,n){zi(t).subscribe(Yn(n,function(){return n.complete()},wv)),!n.closed&&e.subscribe(n)})}function gGe(t,e){return e===void 0&&(e=!1),Lr(function(n,r){var i=0;n.subscribe(Yn(r,function(s){var o=t(s,i++);(o||e)&&r.next(s),!o&&r.complete()}))})}function vGe(t,e,n){var r=Rn(t)||e||n?{next:t,error:e,complete:n}:t;return r?Lr(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(Yn(s,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),s.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),s.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),s.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):$f}function yGe(t,e){return Lr(function(n,r){var i=e??{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,c=a===void 0?!1:a,l=!1,d=null,h=null,m=!1,g=function(){h?.unsubscribe(),h=null,c&&(w(),m&&r.complete())},y=function(){h=null,m&&r.complete()},v=function(S){return h=zi(t(S)).subscribe(Yn(r,g,y))},w=function(){if(l){l=!1;var S=d;d=null,r.next(S),!m&&v(S)}};n.subscribe(Yn(r,function(S){l=!0,d=S,!(h&&!h.closed)&&(o?w():v(S))},function(){m=!0,!(c&&l&&h&&!h.closed)&&r.complete()}))})}function BL(t,e,n){e===void 0&&(e=lR);var r=du(t,e);return yGe(function(){return r},n)}function Tle(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=U8(t);return Lr(function(r,i){for(var s=t.length,o=new Array(s),a=t.map(function(){return!1}),c=!1,l=function(h){zi(t[h]).subscribe(Yn(i,function(m){o[h]=m,!c&&!a[h]&&(a[h]=!0,(c=a.every($f))&&(a=null))},wv))},d=0;d<s;d++)l(d);r.subscribe(Yn(i,function(h){if(c){var m=Ea([h],Sa(o));i.next(n?n.apply(void 0,Ea([],Sa(m))):m)}}))})}function Qe(t){const e=_.useCallback(r=>{const i=t.subscribe(r);return()=>i.unsubscribe()},[t]),n=_.useCallback(()=>t.value,[t]);return _.useSyncExternalStore(e,n)}class li{constructor(e,n){this.defaultValue=n,this.setValue=s=>{this._value$.next(s),localStorage.setItem(this.key,JSON.stringify(s))},this.getValue=()=>this._value$.getValue(),this.key=`matrix-setting-${e}`;const r=localStorage.getItem(this.key);let i=n;if(r!==null)try{i=JSON.parse(r)}catch(s){M.warn(`Invalid value stored for setting ${e}: ${r}.`,s)}this._value$=new _s(i),this.value$=this._value$}}function Gn(t){return[Qe(t.value$),t.setValue]}const Rle=new li("opt-in-analytics",null),uR=()=>{const t=Gn(Rle);return Ut.instance.isEnabled()?t:[!1,null]},$8=new li("developer-settings-tab",!1),Ile=new li("duplicate-tiles",0),kle=new li("show-non-member-tiles",!1),B8=new li("debug-tile-layout",!1),Gb=new li("show-connection-stats",!1),WK=new li("audio-input",void 0),YK=new li("audio-output",void 0),XK=new li("video-input",void 0),xle=new li("background-blur",!1),Ale=new li("hand-raised-show-timer",!1),Ple=new li("reactions-show",!0),H8=new li("reactions-play-sound",!0),Lle=new li("sound-effect-volume",.5),Ole=new li("new-membership-manager",!0),V8=new li("experimental-to-device-transport",!0),Mle=new li("mute-all-audio",!1),JK=new li("always-show-self",!0),Dle=new li("always-show-iphone-earpiece",!1);var dR=(t=>(t[t.Guest=0]="Guest",t[t.Registered=1]="Registered",t))(dR||{});const Fc=class Fc{constructor(e){this.posthog=e,this.enabled=!1,this.anonymity=0,this.platformSuperProperties={},this.registrationType=0,this.optInListener=null,this.sanitizeProperties=(i,s)=>(this.anonymity==1&&(i.$referrer=null,i.$referring_domain=null,i.$initial_referrer=null,i.$initial_referring_domain=null,i.$device_id=null),i.$current_url=i.$current_url.split("/").slice(0,3).join(""),i),this.eventCallEnded=new WVe,this.eventSignup=new XVe,this.eventCallStarted=new YVe,this.eventLogin=new JVe,this.eventMuteMicrophone=new QVe,this.eventMuteCamera=new ZVe,this.eventUndecryptableToDevice=new eqe,this.eventQualitySurvey=new tqe,this.eventCallDisconnected=new nqe,this.eventCallConnectDuration=new rqe;let n,r;n=Br().posthogApiKey??void 0,r=Br().posthogApiHost??void 0,n&&r?(this.posthog.init(n,{api_host:r,autocapture:!1,mask_all_text:!0,mask_all_element_attributes:!0,capture_pageview:!1,sanitize_properties:this.sanitizeProperties,respect_dnt:!0,advanced_disable_decide:!0}),this.enabled=!0):(M.info("Posthog is not enabled because there is no api key or no host given in the config"),this.enabled=!1)}static hasInstance(){return!!this.internalInstance}static get instance(){return this.internalInstance||(this.internalInstance=new Fc(CVe)),this.internalInstance}static resetInstance(){this.internalInstance=null}registerSuperProperties(e){this.enabled&&this.posthog.register(e)}static getPlatformProperties(){return{appVersion:"embedded-v0.16.3",matrixBackend:ut?"embedded":"jssdk",callBackend:"livekit",cryptoVersion:ut?void 0:window.matrixclient?.getCrypto()?.getVersion()}}capture(e,n,r){this.enabled&&this.posthog.capture(e,{...n},r)}isEnabled(){return this.enabled}setAnonymity(e){this.enabled&&(e==0||e==1)&&(this.posthog.reset(),this.updateSuperProperties()),this.anonymity=e}static getRandomAnalyticsId(){return[...crypto.getRandomValues(new Uint8Array(16))].map(e=>e.toString(16)).join("")}async identifyUser(e){if(this.anonymity==2&&this.enabled){let n=await this.getAnalyticsId();try{if(!n&&!ut){const r=e();await this.setAccountAnalyticsId(r),n=await this.hashedEcAnalyticsId(r)}}catch(r){M.log("Unable to identify user for tracking"+r?.toString())}n?this.posthog.identify(n):M.info("No analyticsID is available. Should not try to setup posthog")}}async getAnalyticsId(){const e=window.matrixclient;let n;return ut?n=Br().posthogUserId:n=(await e.getAccountDataFromServer(Fc.ANALYTICS_EVENT_TYPE))?.id??null,n?await this.hashedEcAnalyticsId(n):null}async hashedEcAnalyticsId(e){const n=window.matrixclient,r="ec"+e+n.getUserId(),i=await crypto.subtle.digest("sha-256",new TextEncoder().encode(r)),s=new Int32Array(i);return Array.from(s).map(o=>Math.abs(o).toString(16).padStart(2,"0")).join("")}async setAccountAnalyticsId(e){if(!ut){const n=window.matrixclient,r=await n.getAccountDataFromServer(Fc.ANALYTICS_EVENT_TYPE);await n.setAccountData(Fc.ANALYTICS_EVENT_TYPE,Object.assign({id:e},r))}}getAnonymity(){return this.anonymity}logout(){this.enabled&&this.posthog.reset(),this.optInListener?.unsubscribe(),this.optInListener=null,this.setAnonymity(0)}onLoginStatusChanged(){this.maybeIdentifyUser().catch(()=>M.log("Could not identify user on login status change"))}updateSuperProperties(){this.platformSuperProperties=Fc.getPlatformProperties(),this.registerSuperProperties({...this.platformSuperProperties,registrationType:this.registrationType==0?"Guest":"Registered"})}userRegisteredInThisSession(){return this.eventSignup.getSignupEndTime()>new Date(0)}async maybeIdentifyUser(){window.matrixclient&&(this.anonymity===2&&(this.setRegistrationType(window.matrixclient.isGuest()||window.passwordlessUser?0:1),this.identificationPromise=this.identifyUser(Fc.getRandomAnalyticsId),await this.identificationPromise,this.userRegisteredInThisSession()&&this.eventSignup.track()),this.anonymity!==0&&this.updateSuperProperties())}trackEvent({eventName:e,...n},r){const i=()=>{this.anonymity==0||this.anonymity==1||this.capture(e,n,r)};this.identificationPromise?this.identificationPromise.then(i,s=>{M.error("Failed to identify user for tracking",s)}):i()}startListeningToSettingsChanges(){this.optInListener??=Rle.value$.subscribe(e=>{this.setAnonymity(e?2:0),this.maybeIdentifyUser().catch(()=>M.log("Could not identify user"))})}setRegistrationType(e){this.registrationType=e,!(this.anonymity==0||this.anonymity==1)&&this.updateSuperProperties()}};Fc.ANALYTICS_EVENT_TYPE="im.vector.analytics",Fc.internalInstance=null;let Ut=Fc;const bGe=2*60*1e3;class _Ge{async forceFlush(){}onStart(e){try{switch(e.name){case"matrix.groupCallMembership":this.onGroupCallMembershipStart(e);return;case"matrix.groupCallMembership.summaryReport":this.onSummaryReportStart(e);return}}catch(n){M.debug(n)}}onEnd(e){switch(e.name){case"matrix.groupCallMembership":this.onGroupCallMembershipEnd(e);return}}get prevCall(){const e=localStorage.getItem("matrix-prev-call");if(e===null)return null;try{return JSON.parse(e)}catch(n){return M.warn("Invalid prev call data",e,"error:",n),null}}set prevCall(e){localStorage.setItem("matrix-prev-call",JSON.stringify(e))}onGroupCallMembershipStart(e){const n=this.prevCall,r=e.attributes["matrix.confId"];if(n!==null&&r===n.callId){const i=xG(e.startTime)-n.hangupTs;i<=bGe&&Ut.instance.trackEvent({eventName:"Rejoin",callId:n.callId,rejoinDuration:i})}}onGroupCallMembershipEnd(e){this.prevCall={callId:e.attributes["matrix.confId"],hangupTs:xG(e.endTime)}}onSummaryReportStart(e){const n=e.events.find(r=>r.name==="matrix.stats.summary");if(n!==void 0){const r=n.attributes;if(r){const i=`${r["matrix.stats.summary.percentageReceivedMedia"]}`,s=`${r["matrix.stats.summary.percentageReceivedVideoMedia"]}`,o=`${r["matrix.stats.summary.percentageReceivedAudioMedia"]}`,a=`${r["matrix.stats.summary.maxJitter"]}`,c=`${r["matrix.stats.summary.maxPacketLoss"]}`,l=`${r["matrix.stats.summary.peerConnections"]}`,d=`${r["matrix.stats.summary.percentageConcealedAudio"]}`,h=`${r["matrix.stats.summary.opponentUsersInCall"]}`,m=`${r["matrix.stats.summary.opponentDevicesInCall"]}`,g=`${r["matrix.stats.summary.diffDevicesToPeerConnections"]}`,y=`${r["matrix.stats.summary.ratioPeerConnectionToDevices"]}`;Ut.instance.trackEvent({eventName:"MediaReceived",callId:e.attributes["matrix.confId"],mediaReceived:i,audioReceived:o,videoReceived:s,maxJitter:a,maxPacketLoss:c,peerConnections:l,percentageConcealedAudio:d,opponentUsersInCall:h,opponentDevicesInCall:m,diffDevicesToPeerConnections:g,ratioPeerConnectionToDevices:y},{send_instantly:!0})}}}async shutdown(){return Promise.resolve()}}const QK=t=>Object.entries(t).map(([e,n])=>({key:e,type:typeof n,value:n}));class SGe{constructor(){this.spans=[]}async forceFlush(){}onStart(e){this.spans.push(e)}onEnd(){}dump(){const e=Date.now()*1e3,n=new Map;for(const s of this.spans){const o=s.spanContext().traceId;let a=n.get(o);a===void 0&&(a=[],n.set(o,a)),a.push(s)}const r="p1",i={[r]:{serviceName:"element-call",tags:[]},warnings:null};return JSON.stringify({total:0,limit:0,offset:0,errors:null,data:[...n.entries()].map(([s,o])=>({traceID:s,warnings:null,processes:i,spans:o.map(a=>{const c=a.spanContext(),l=wx(a.startTime),d=a.duration[0]===-1?e-l:wx(a.duration);return{traceID:s,spanID:c.spanId,operationName:a.name,processID:r,warnings:null,startTime:l,duration:d,references:a.parentSpanContext?.spanId===void 0?[]:[{refType:"CHILD_OF",traceID:s,spanID:a.parentSpanContext?.spanId}],tags:QK(a.attributes),logs:a.events.map(h=>({timestamp:wx(h.time),fields:[...QK(h.attributes??{}),{key:"event",type:"string",value:h.name}]}))}})}))})}async shutdown(){}}const EGe="element-call";let K1;class fR{static globalInit(){(!K1||K1.isOtlpEnabled!==!1)&&(M.info("(Re)starting OpenTelemetry debug reporting"),K1?.dispose(),K1=new fR(void 0,Nle()))}static get instance(){return K1}constructor(e,n){const r=[];e?(M.info("Enabling OTLP collector with URL "+e),this.otlpExporter=new VBe({url:e}),r.push(new W$e(this.otlpExporter))):M.info("OTLP collector disabled"),n&&(this.rageshakeProcessor=new SGe,r.push(this.rageshakeProcessor)),r.push(new _Ge),this._provider=new zBe({resource:ace({[Jae]:EGe}),spanProcessors:r}),yx.trace.setGlobalTracerProvider(this._provider),this._tracer=yx.trace.getTracer("my-element-call-otl-tracer")}dispose(){yx.trace.disable(),this._provider?.shutdown().catch(e=>{M.error("Failed to shutdown OpenTelemetry",e)})}get isOtlpEnabled(){return!!this.otlpExporter}get tracer(){return this._tracer}get provider(){return this._provider}}const ZK=async t=>{const{gzip:e}=await lb(async()=>{const{gzip:r}=await import("./pako.esm-Bt8vjcgE.js");return{gzip:r}},[],import.meta.url),n=new TextEncoder().encode(t);return new Blob([e(n)])};async function wGe(t,e){e.append("crypto_version",t.getVersion());const n=await t.getOwnDeviceKeys(),r=[`curve25519:${n.curve25519}`,`ed25519:${n.ed25519}`];e.append("device_keys",r.join(", "));const i=await t.getCrossSigningStatus();e.append("cross_signing_ready",String(await t.isCrossSigningReady())),e.append("cross_signing_key",await t.getCrossSigningKeyId()??"n/a"),e.append("cross_signing_privkey_in_secret_storage",String(i.privateKeysInSecretStorage)),e.append("cross_signing_master_privkey_cached",String(i.privateKeysCachedLocally.masterKey)),e.append("cross_signing_self_signing_privkey_cached",String(i.privateKeysCachedLocally.selfSigningKey)),e.append("cross_signing_user_signing_privkey_cached",String(i.privateKeysCachedLocally.userSigningKey))}async function CGe(t,e,n){const r=t.secretStorage;n.append("secret_storage_ready",String(await e.isSecretStorageReady())),n.append("secret_storage_key_in_account",String(await r.hasKey())),n.append("session_backup_key_in_secret_storage",String(!!await t.isKeyBackupKeyStored()));const i=await e.getSessionBackupPrivateKey();n.append("session_backup_key_cached",String(!!i)),n.append("session_backup_key_well_formed",String(i instanceof Uint8Array))}function Nle(){return Br().rageshakeSubmitUrl??void 0}function hR(t=Nle){const{client:e}=jp(),[{sending:n,sent:r,error:i},s]=_.useState({sending:!1,sent:!1,error:void 0});return{submitRageshake:_.useCallback(async a=>{const c=t();if(!c)throw new Error("No rageshake URL is configured");if(!n)try{s({sending:!0,sent:!1,error:void 0});let l="UNKNOWN";window.navigator&&window.navigator.userAgent&&(l=window.navigator.userAgent);let d="UNKNOWN";try{d=String(window.matchMedia("(pointer: coarse)").matches)}catch(y){M.warn("Could not get coarse pointer for rageshake submit.",y)}let h=a.rageshakeRequestId?`Rageshake ${a.rageshakeRequestId}`:"";a.description&&(h+=`: ${a.description}`);const m=new FormData;if(m.append("text",h??"User did not supply any additional text."),m.append("app","matrix-video-chat"),m.append("version","embedded-v0.16.3"),m.append("user_agent",l),m.append("installed_pwa","false"),m.append("touch_input",d),m.append("call_backend","livekit"),m.append("hostname",window.location.hostname),e){const y=e.getUserId(),v=e.getUser(y);m.append("display_name",v?.displayName??""),m.append("user_id",e.credentials.userId??""),m.append("device_id",e.deviceId??""),a.roomId&&m.append("room_id",a.roomId);const w=e.getCrypto();w&&(await wGe(w,m),await CGe(e,w,m))}if(a.label&&m.append("label",a.label),navigator.storage&&navigator.storage.persisted)try{m.append("storageManager_persisted",String(await navigator.storage.persisted()))}catch(y){M.warn("coulr not get navigator peristed storage",y)}else if(document.hasStorageAccess)try{m.append("storageManager_persisted",String(await document.hasStorageAccess()))}catch(y){M.warn("could not get storage access",y)}if(navigator.storage&&navigator.storage.estimate)try{const y=await navigator.storage.estimate();m.append("storageManager_quota",String(y.quota)),m.append("storageManager_usage",String(y.usage)),y.usageDetails&&Object.keys(y.usageDetails).forEach(v=>{m.append(`storageManager_usage_${v}`,String(y.usageDetails[v]))})}catch(y){M.warn("could not obatain storage estimate",y)}if(a.sendLogs){const y=await Mje();for(const v of y)m.append("compressed-log",await ZK(v.lines),v.id);m.append("file",await ZK(fR.instance.rageshakeProcessor.dump()),"traces.json.gz")}a.rageshakeRequestId&&m.append("group_call_rageshake_request_id",a.rageshakeRequestId);const g=await fetch(c,{method:"POST",body:m});if(g.status!==200)throw new Error(`Failed to submit feedback: receive HTTP ${g.status} ${g.statusText}`);s({sending:!1,sent:!0,error:void 0})}catch(l){s({sending:!1,sent:!1,error:l}),M.error(l)}},[e,n,t]),sending:n,sent:r,error:i,available:!!t()}}function TGe(){const{client:t}=jp();return _.useCallback((n,r)=>{t.sendEvent(n,"org.matrix.rageshake_request",{request_id:r}).catch(i=>{M.error("Failed to send org.matrix.rageshake_request event",i)})},[t])}function RGe(t){const[e,n]=_.useState(!1),r=_.useCallback(()=>n(!1),[n]),{client:i}=jp(),[s,o]=_.useState();return _.useEffect(()=>{if(!i)return;const a=c=>{c.getType()==="org.matrix.rageshake_request"&&t===c.getRoomId()&&i.getUserId()!==c.getSender()&&(o(c.getContent().request_id),n(!0))};return i.on(Le.Event,a),()=>{i.removeListener(Le.Event,a)}},[n,t,i]),{rageshakeRequestId:s??"",roomId:t,open:e,onDismiss:r}}const IGe=({description:t})=>{const{submitRageshake:e,sending:n,sent:r,error:i}=hR(),{t:s}=We(),o=_.useCallback(()=>{e({description:t,sendLogs:!0}).catch(c=>{M.error("Failed to send rageshake",c)})},[e,t]);if(!sn.get().rageshake?.submit_url)return null;let a=null;if(n)a=E.jsx("span",{children:s("rageshake_sending")});else if(r)a=E.jsx("div",{children:s("rageshake_sent")});else{let c=s("rageshake_send_logs");i&&(c=s("rageshake_button_error_caption")),a=E.jsx(Bt,{onClick:o,className:TG.wideButton,disabled:n,children:c})}return E.jsx("div",{className:TG.rageshakeControl,children:a})},kGe="_error_17zfc_1",xGe="_icon_17zfc_9",bE={error:kGe,icon:xGe},AGe="_endCall_bwclo_8",PGe={endCall:AGe},Ule=({muted:t,...e})=>{const{t:n}=We(),r=t?Hoe:t8,i=n(t?"unmute_microphone_button_label":"mute_microphone_button_label");return E.jsx(qi,{label:i,children:E.jsx(Bt,{iconOnly:!0,Icon:r,kind:t?"primary":"secondary",...e})})},jle=({muted:t,...e})=>{const{t:n}=We(),r=t?N8e:lae,i=n(t?"start_video_button_label":"stop_video_button_label");return E.jsx(qi,{label:i,children:E.jsx(Bt,{iconOnly:!0,Icon:r,kind:t?"primary":"secondary",...e})})},LGe=({enabled:t,...e})=>{const{t:n}=We(),r=n(t?"stop_screenshare_button_label":"screenshare_button_label");return E.jsx(qi,{label:r,children:E.jsx(Bt,{iconOnly:!0,Icon:A8e,kind:t?"primary":"secondary",...e})})},Fle=({className:t,...e})=>{const{t:n}=We();return E.jsx(qi,{label:n("hangup_button_label"),children:E.jsx(Bt,{className:Oe(t,PGe.endCall),iconOnly:!0,Icon:Ooe,destructive:!0,...e})})},$le=t=>{const{t:e}=We();return E.jsx(qi,{label:e("common.settings"),children:E.jsx(Bt,{iconOnly:!0,Icon:x8e,kind:"secondary",...t})})},OGe="_external_jhjdf_8",MGe={external:OGe};function Ble(t,e){const n=Uee(t),r=Wee(t,{state:e});return[n,r]}const il=({ref:t,to:e,state:n,...r})=>{const[i,s]=Ble(e,n);return E.jsx(l7e,{ref:t,...r,href:i,onClick:s})},Jh=({ref:t,className:e,children:n,...r})=>E.jsx("a",{ref:t,className:Oe(e,MGe.external),target:"_blank",rel:"noreferrer noopener",...r,children:n}),q8=({ref:t,to:e,state:n,...r})=>{const[i,s]=Ble(e,n);return E.jsx(Bt,{as:"a",ref:t,...r,href:i,onClick:s})};function Fw(t,e,n,r){_.useEffect(()=>{if(t)return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)},[t,e,n,r])}function Hle(t,e,n){_.useEffect(()=>(t.on(e,n),()=>{t.off(e,n)}),[t,e,n])}function gp(t,e,n){const r=_.useCallback(i=>(t.on(e,i),()=>{t.off(e,i)}),[t,e]);return _.useSyncExternalStore(r,n)}function G8(t){return gp(t,ei.MembershipsChanged,_.useCallback(()=>t.memberships,[t]))}const Vle=_.createContext(void 0),K8=()=>{const t=_.use(Vle);if(!t)throw new Error("useReactions must be used within a ReactionsProvider");return t},DGe=({children:t,rtcSession:e,vm:n})=>{const r=G8(e),i=r0(),s=i?.state==="valid"&&i.supportedFeatures.reactions,o=e.room,a=o.client.getUserId(),c=o.client.getDeviceId(),l=`${a}:${c}`,d=_.useMemo(()=>r.find(S=>S.sender===a&&S.deviceId===c)?.eventId,[r,a,c]),h=Qe(n.reactions$),m=_.useMemo(()=>l!==void 0?h[l]:void 0,[l,h]),g=Qe(n.handsRaised$),y=_.useMemo(()=>l!==void 0?g[l]:void 0,[l,g]),v=_.useCallback(async()=>{if(!l)return;const S=y?.reactionEventId;if(S)try{await o.client.redactEvent(e.room.roomId,S),M.debug("Redacted raise hand event")}catch(R){throw M.error("Failed to redact reaction event",S,R),R}else try{if(!d)throw new Error("Cannot find own membership event");const R=await o.client.sendEvent(e.room.roomId,Z.Reaction,{"m.relates_to":{rel_type:vn.Annotation,event_id:d,key:"🖐️"}});M.debug("Sent raise hand event",R.event_id)}catch(R){M.error("Failed to send raised hand",R)}},[d,l,y,e,o]),w=_.useCallback(async S=>{if(!(!l||m)){if(!d)throw new Error("Cannot find own membership event");await o.client.sendEvent(e.room.roomId,O8,{"m.relates_to":{rel_type:vn.Reference,event_id:d},emoji:S.emoji,name:S.name})}},[d,m,o,l,e]);return E.jsx(Vle,{value:{supportsReactions:s,toggleRaisedHand:v,sendReaction:w},children:t})},NGe="_raisedButton_unw54_1",UGe="_reactionPopupMenu_unw54_5",jGe="_reactionPopupMenuRoot_unw54_21",FGe="_reactionPopupMenuModal_unw54_21",$Ge="_reactionsMenuSection_unw54_47",BGe="_reactionsMenu_unw54_47",HGe="_reactionButton_unw54_81",VGe="_verticalSeperator_unw54_91",qGe="_alert_unw54_99",Ha={raisedButton:NGe,reactionPopupMenu:UGe,reactionPopupMenuRoot:jGe,reactionPopupMenuModal:FGe,reactionsMenuSection:$Ge,reactionsMenu:BGe,reactionButton:HGe,verticalSeperator:VGe,alert:qGe};function ez(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function GGe(...t){return e=>{let n=!1;const r=t.map(i=>{const s=ez(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():ez(t[i],null)}}}}function KGe(t){const e=zGe(t),n=_.forwardRef((r,i)=>{const{children:s,...o}=r,a=_.Children.toArray(s),c=a.find(YGe);if(c){const l=c.props.children,d=a.map(h=>h===c?_.Children.count(l)>1?_.Children.only(null):_.isValidElement(l)?l.props.children:null:h);return E.jsx(e,{...o,ref:i,children:_.isValidElement(l)?_.cloneElement(l,void 0,d):null})}return E.jsx(e,{...o,ref:i,children:s})});return n.displayName=`${t}.Slot`,n}function zGe(t){const e=_.forwardRef((n,r)=>{const{children:i,...s}=n;if(_.isValidElement(i)){const o=JGe(i),a=XGe(s,i.props);return i.type!==_.Fragment&&(a.ref=r?GGe(r,o):o),_.cloneElement(i,a)}return _.Children.count(i)>1?_.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var WGe=Symbol("radix.slottable");function YGe(t){return _.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===WGe}function XGe(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{const c=s(...a);return i(...a),c}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function JGe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var QGe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ZGe=QGe.reduce((t,e)=>{const n=KGe(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{}),eKe=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),tKe="VisuallyHidden",HL=_.forwardRef((t,e)=>E.jsx(ZGe.span,{...t,ref:e,style:{...eKe,...t.style}}));HL.displayName=tKe;const nKe="_modal_lmgdq_8",rKe="_dialog_lmgdq_14",iKe="_content_lmgdq_21",sKe="_drawer_lmgdq_32",oKe="_close_lmgdq_59",aKe="_header_lmgdq_84",cKe="_body_lmgdq_114",lKe="_tabbed_lmgdq_129",uKe="_handle_lmgdq_133",Ms={modal:nKe,dialog:rKe,content:iKe,drawer:sKe,close:oKe,header:aKe,body:cKe,tabbed:lKe,handle:uKe},dKe="_bg_180k3_8",fKe="_animate_180k3_23",hKe="_overlay_180k3_42",Bs={bg:dKe,animate:fKe,overlay:hKe},Up=({title:t,hideHeader:e,children:n,className:r,classNameDrawer:i,classNameModal:s,open:o,onDismiss:a,tabbed:c,...l})=>{const{t:d}=We(),h=YT("(hover: none) or (pointer: coarse)"),m=_.useCallback(g=>{g||a?.()},[a]);if(h)return E.jsx(Hs.Root,{open:o,onOpenChange:m,dismissible:a!==void 0,children:E.jsxs(Hs.Portal,{children:[E.jsx(Hs.Overlay,{className:Oe(Bs.bg)}),E.jsx(Hs.Content,{className:Oe(r,i,Bs.overlay,Ms.modal,Ms.drawer,{[Ms.tabbed]:c}),role:"dialog","aria-describedby":void 0,...l,children:E.jsxs("div",{className:Ms.content,children:[E.jsxs("div",{className:Ms.header,children:[E.jsx("div",{className:Ms.handle}),E.jsx(HL,{asChild:!0,children:E.jsx(Hs.Title,{children:t})})]}),E.jsx("div",{className:Ms.body,children:n})]})})]})});{const g=E.jsx(jM,{asChild:!0,children:E.jsx(gl,{as:"h2",weight:"semibold",size:"md",children:t})}),y=E.jsxs("div",{className:Ms.header,children:[g,a!==void 0&&E.jsx(Pse,{className:Ms.close,"data-testid":"modal_close","aria-label":d("action.close"),children:E.jsx(LT,{width:20,height:20})})]});return E.jsx(MM,{open:o,onOpenChange:m,children:E.jsxs(DM,{children:[E.jsx(NM,{className:Oe(Bs.bg,Bs.animate)}),E.jsx(UM,{asChild:!0,"aria-describedby":void 0,role:"dialog",...l,children:E.jsx(Vse,{className:Oe(r,s,Bs.overlay,Bs.animate,Ms.modal,Ms.dialog,{[Ms.tabbed]:c}),children:E.jsxs("div",{className:Ms.content,children:[e?null:y,e?E.jsx(HL,{asChild:!0,children:g}):null,E.jsx("div",{className:Ms.body,children:n})]})})})]})})}},pKe=({raised:t,open:e,...n})=>{const{t:r}=We();return E.jsx(qi,{label:r("common.reactions"),children:E.jsx(Bt,{className:Oe(t&&Ha.raisedButton),"aria-expanded":e,"aria-haspopup":!0,kind:t||e?"primary":"secondary",iconOnly:!0,Icon:t?Xoe:k8e,...n})})};function mKe({sendReaction:t,toggleRaisedHand:e,isHandRaised:n,canReact:r,errorText:i}){const{t:s}=We(),[o,a]=_.useState(!1),c=_.useMemo(()=>o?qb:qb.slice(0,5),[o]),l=s(n?"action.lower_hand":"action.raise_hand");return E.jsxs(E.Fragment,{children:[i&&E.jsx(Zxe,{className:Ha.alert,type:"critical",title:s("error.generic"),children:i}),E.jsxs("div",{className:Ha.reactionPopupMenu,children:[E.jsx("section",{className:Ha.handRaiseSection,children:E.jsx(qi,{label:l,caption:"H",children:E.jsx(Bt,{kind:n?"primary":"secondary","aria-keyshortcuts":"H","aria-pressed":n,"aria-label":l,onClick:()=>e(),iconOnly:!0,Icon:Xoe})})}),E.jsx("div",{className:Ha.verticalSeperator}),E.jsx("section",{className:Ha.reactionsMenuSection,children:E.jsx("menu",{className:Oe(o&&Ha.reactionsMenuExpanded,Ha.reactionsMenu),children:c.map((d,h)=>E.jsx("li",{children:E.jsx(qi,{label:d.name,caption:h<jL?(h+1).toString():void 0,children:E.jsx(Bt,{kind:"secondary",className:Ha.reactionButton,disabled:!r,onClick:()=>t(d),"aria-keyshortcuts":h<jL?(h+1).toString():void 0,children:d.emoji})})},d.name))})}),E.jsx("section",{style:{marginLeft:"var(--cpd-separator-spacing)"},children:E.jsx(qi,{label:s(o?"action.show_less":"action.show_more"),children:E.jsx(Bt,{iconOnly:!0,"aria-label":s(o?"action.show_less":"action.show_more"),Icon:o?y8e:HMe,kind:"tertiary",onClick:()=>a(!o)})})})]})]})}function gKe({identifier:t,vm:e,...n}){const{t:r}=We(),{toggleRaisedHand:i,sendReaction:s}=K8(),[o,a]=_.useState(!1),[c,l]=_.useState(!1),[d,h]=_.useState(),m=!!Qe(e.handsRaised$)[t],g=!Qe(e.reactions$)[t];_.useEffect(()=>{h(void 0)},[c]);const y=_.useCallback(async w=>{try{a(!0),await s(w),h(void 0),l(!1)}catch(S){h(S instanceof Error?S.message:"Unknown error"),M.error("Failed to send reaction",S)}finally{a(!1)}},[s]),v=_.useCallback(()=>{(async()=>{try{a(!0),await i(),l(!1)}catch(S){h(S instanceof Error?S.message:"Unknown error"),M.error("Failed to raise/lower hand",S)}finally{a(!1)}})()},[i]);return E.jsxs(E.Fragment,{children:[E.jsx(pKe,{disabled:o,onClick:()=>l(w=>!w),raised:!!m,open:c,...n}),E.jsx(Up,{open:c,title:r("action.pick_reaction"),hideHeader:!0,classNameModal:Ha.reactionPopupMenuModal,className:Ha.reactionPopupMenuRoot,onDismiss:()=>l(!1),children:E.jsx(mKe,{errorText:d,isHandRaised:!!m,canReact:!o&&!!g,sendReaction:w=>void y(w),toggleRaisedHand:v})})]})}const Kb=({Icon:t,title:e,rageshake:n,fatal:r,children:i,widget:s})=>{const{t:o}=We(),{confineToRoom:a}=no(),c=_.useCallback(()=>{window.location.href="/"},[]),l=({widget:h})=>{const m=()=>{h.api.transport.send(Ri.Close,{}).catch(g=>{M.error("Failed to send close action",g)}).finally(()=>{h.api.transport.stop()})};return E.jsx(Bt,{kind:"primary",onClick:m,children:o("action.close")})},d=()=>r||location.pathname==="/"?E.jsx(Bt,{kind:"tertiary",className:bE.homeLink,onClick:c,children:o("return_home_button")}):E.jsx(q8,{kind:"tertiary",className:bE.homeLink,to:"/",children:o("return_home_button")});return E.jsxs("div",{className:bE.error,children:[E.jsx(moe,{className:bE.icon,children:E.jsx(t,{"aria-hidden":!0})}),E.jsx(gl,{as:"h1",weight:"semibold",size:"md",children:e}),i,n&&E.jsx(IGe,{description:`***Error View***: ${e}`}),s?E.jsx(l,{widget:s}):!a&&E.jsx(d,{})]})};class qle extends Error{constructor(e,n){super(e),this.richMessage=n}}const vKe=()=>{const{t}=We();return E.jsx(Kb,{widget:ut,Icon:Woe,title:t("error.open_elsewhere"),children:E.jsx("p",{children:t("error.open_elsewhere_description",{brand:"Element Call"})})})};class yKe extends qle{constructor(){super("App opened in another tab",E.jsx(vKe,{}))}}const qg=({className:t,children:e})=>{const{header:n}=no();return E.jsxs("div",{className:Oe(lx.page,t),children:[n==="standard"&&E.jsxs(qu,{children:[E.jsx(jf,{children:E.jsx(fp,{})}),E.jsx(Ff,{})]}),E.jsx("div",{className:lx.container,children:E.jsx("div",{className:lx.content,children:e})})]})},zb=({error:t,widget:e})=>{const{t:n}=We();return _.useEffect(()=>{M.error(t),IT(t)},[t]),E.jsx(qg,{children:t instanceof qle?t.richMessage:E.jsx(Kb,{widget:e,Icon:PT,title:n("error.generic"),rageshake:!0,fatal:!0,children:E.jsx("p",{children:n("error.generic_description")})})})},pR=()=>{const{t}=We();return E.jsx(qg,{children:E.jsx("h1",{children:t("common.loading")})})},z8=_.createContext(void 0);z8.Provider;const r0=()=>_.use(z8);function jp(){let t,e;const n=r0();return n?.state==="valid"&&(t=n.authenticated?.client,e=n.setClient),{client:t,setClient:e}}function W8(){const t=r0();let e,n,r=!1,i=!0,s,o=!1,a;return t?.state==="valid"?(e=t.authenticated?.client,n=t.setClient,r=t.authenticated?.isPasswordlessUser??!1,i=!1,o=e!==void 0,a=t.authenticated?.logout):t?.state==="error"&&(s=t.error,i=!1),{client:e,setClient:n,passwordlessUser:r,loading:i,authenticated:o,logout:a,error:s}}const tz="BroadcastChannel"in window?new BroadcastChannel("load"):null,bKe=({children:t})=>{const e=hl(),[n,r]=_.useState(void 0),i=_.useRef(!1);_.useEffect(()=>{i.current||(i.current=!0,_Ke().then(R=>{r(R),Ut.instance.isEnabled()&&Ut.instance.startListeningToSettingsChanges()}).catch(R=>M.error(R)).finally(()=>i.current=!1))},[]);const s=_.useCallback(async R=>{const x=Kle();!n?.client||!x||(await n.client.setPassword({type:"m.login.password",identifier:{type:"m.id.user",user:x.user_id},user:x.user_id,password:x.tempPassword},R),nz({...x,passwordlessUser:!1}),r({...n,passwordlessUser:!1}))},[n]),o=_.useCallback((R,x)=>{const T=n?.client;T&&T!==R&&T.stopClient(),nz(x),r({widgetApi:null,client:R,passwordlessUser:x.passwordlessUser}),Ut.instance.isEnabled()&&Ut.instance.startListeningToSettingsChanges()},[n?.client]),a=_.useCallback(async()=>{const R=n?.client;R&&(await R.logout(!0),await R.clearStores(),Gle(),r(null),await e("/"),Ut.instance.logout(),Ut.instance.setRegistrationType(dR.Guest))},[e,n?.client]);_.useEffect(()=>{ut||tz?.postMessage({})},[]);const[c,l]=_.useState(void 0);Fw(tz,"message",_.useCallback(()=>{n?.client.stopClient(),l(new yKe)},[n?.client,l]));const[d,h]=_.useState(!1),[m,g]=_.useState(!1),[y,v]=_.useState(!1),w=_.useMemo(()=>c?{state:"error",error:c}:n===void 0?void 0:{state:"valid",authenticated:n===null?void 0:{client:n.client,isPasswordlessUser:n.passwordlessUser,changePassword:s,logout:a},setClient:o,disconnected:d,supportedFeatures:{reactions:m,thumbnails:y}},[c,s,n,a,o,d,m,y]),S=_.useCallback((R,x,T)=>{h(SKe(R,T))},[]);return _.useEffect(()=>{if(n){if(window.matrixclient=n.client,window.passwordlessUser=n.passwordlessUser,Ut.hasInstance()&&Ut.instance.onLoginStatusChanged(),n.client&&n.client.on(Le.Sync,S),n.widgetApi){v(!1);const R=n.widgetApi.hasCapability("org.matrix.msc2762.send.event:m.reaction"),x=n.widgetApi.hasCapability("org.matrix.msc2762.send.event:m.room.redaction"),T=n.widgetApi.hasCapability("org.matrix.msc2762.receive.event:m.reaction"),I=n.widgetApi.hasCapability("org.matrix.msc2762.receive.event:m.room.redaction");!R||!T||!x||!I?(M.warn("Widget does not support reactions"),g(!1)):g(!0)}else g(!0),v(!0);return()=>{n.client&&n.client.removeListener(Le.Sync,S)}}},[n,S]),c?E.jsx(zb,{widget:ut,error:c}):E.jsx(z8,{value:w,children:t})};async function _Ke(){if(ut){M.log("Using a matryoshka client");const t=await ut.client;return{widgetApi:ut.api,client:t,passwordlessUser:!1}}else{const{initSPA:t}=await lb(async()=>{const{initSPA:e}=await import("./spa-3dms9gnk.js");return{initSPA:e}},[],import.meta.url);return t(Kle,Gle)}}const Gle=()=>localStorage.removeItem("matrix-auth-store"),nz=t=>localStorage.setItem("matrix-auth-store",JSON.stringify(t)),Kle=()=>{const t=localStorage.getItem("matrix-auth-store");if(t)return JSON.parse(t)},SKe=(t,e)=>t==="ERROR"&&e?.error?.name==="ConnectionError";function V_(t){const[{success:e,loading:n,displayName:r,avatarUrl:i,error:s},o]=_.useState(()=>{let c;return t&&(c=t.getUser(t.getUserId())??void 0),{success:!1,loading:!1,displayName:c?.rawDisplayName,avatarUrl:c?.avatarUrl,error:void 0}});_.useEffect(()=>{const c=(d,{displayName:h,avatarUrl:m})=>{o({success:!1,loading:!1,displayName:h,avatarUrl:m,error:void 0})};let l;if(t){const d=t.getUserId();l=t.getUser(d),l?.on(Ui.DisplayName,c),l?.on(Ui.AvatarUrl,c)}return()=>{l&&(l.removeListener(Ui.DisplayName,c),l.removeListener(Ui.AvatarUrl,c))}},[t]);const a=_.useCallback(async({displayName:c,avatar:l,removeAvatar:d})=>{if(t){o(h=>({...h,loading:!0,error:void 0,success:!1}));try{await t.setDisplayName(c);let h;d?await t.setAvatarUrl(""):l&&({content_uri:h}=await t.uploadContent(l),await t.setAvatarUrl(h)),o(m=>({...m,displayName:c,avatarUrl:d?void 0:h??m.avatarUrl,loading:!1,success:!0}))}catch(h){o(m=>({...m,loading:!1,error:h instanceof Error?h:Error(h),success:!1}))}}else M.error("Client not initialized before calling saveProfile")},[t]);return{loading:n,error:s,displayName:r,avatarUrl:i,saveProfile:a,success:e}}const EKe="_settingsModal_1dkeq_8",wKe="_volumeSlider_1dkeq_20",rz={settingsModal:EKe,volumeSlider:wKe},CKe="_tabContainer_1nnp9_8",TKe="_tabList_1nnp9_14",iz={tabContainer:CKe,tabList:TKe};function RKe({label:t,tab:e,onTabChange:n,tabs:r}){const i=_.useId();return E.jsxs("div",{className:iz.tabContainer,children:[E.jsx(UMe,{role:"tablist","aria-label":t,className:iz.tabList,children:r.map(({key:s,name:o})=>E.jsx(BMe,{"aria-controls":`${i}[${s}]`,onClick:()=>n(s),active:s===e,children:o},s))}),r.map(({key:s,content:o})=>E.jsx("div",{id:`${i}[${s}]`,style:{display:s===e?void 0:"none"},children:o},s))]})}const IKe="_fieldRow_iwncy_8",kKe="_field_iwncy_8",xKe="_rightAlign_iwncy_21",AKe="_inputField_iwncy_33",PKe="_disabled_iwncy_52",LKe="_prefix_iwncy_110",OKe="_checkboxField_iwncy_131",MKe="_checkbox_iwncy_131",DKe="_description_iwncy_168",NKe="_errorMessage_iwncy_197",UKe="_noLabel_iwncy_210",ea={fieldRow:IKe,field:kKe,rightAlign:xKe,inputField:AKe,disabled:PKe,prefix:LKe,checkboxField:OKe,checkbox:MKe,description:DKe,errorMessage:NKe,noLabel:UKe},jKe=(t,e)=>_.createElement("svg",{fill:"none",height:24,stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",width:24,xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{d:"m20 6-11 11-5-5"})),FKe=_.forwardRef(jKe);class zle extends Error{constructor(e,n){super(n(e,{lng:"en"})),this.translatedMessage=n(e)}}class $Ke extends zle{}const sz=(t,e)=>new $Ke(t,e);function yt({children:t,rightAlign:e,className:n}){return E.jsx("div",{className:Oe(ea.fieldRow,{[ea.rightAlign]:e},n),children:t})}function BKe({children:t,className:e}){return E.jsx("div",{className:Oe(ea.field,e),children:t})}const Tn=({ref:t,id:e,label:n,className:r,type:i,checked:s,prefix:o,suffix:a,description:c,disabled:l,min:d,...h})=>{const m=_.useId();return E.jsxs(BKe,{className:Oe(i==="checkbox"?ea.checkboxField:ea.inputField,{[ea.prefix]:!!o,[ea.disabled]:l},r),children:[o&&E.jsx("span",{children:o}),i==="textarea"?E.jsx("textarea",{id:e,ref:t,disabled:l,"aria-describedby":m,...h}):E.jsx("input",{id:e,ref:t,type:i,checked:s,disabled:l,"aria-describedby":m,min:d,...h}),E.jsxs("label",{htmlFor:e,children:[i==="checkbox"&&E.jsx("div",{className:ea.checkbox,children:E.jsx(FKe,{})}),n]}),a&&E.jsx("span",{children:a}),c&&E.jsx("p",{id:m,className:n?ea.description:Oe(ea.description,ea.noLabel),children:c})]})};Tn.displayName="InputField";const Bf=({error:t})=>E.jsx("p",{className:ea.errorMessage,children:t instanceof zle?t.translatedMessage:t.message}),HKe="_avatarInputField_1ep5q_8",VKe="_avatar_1ep5q_8",qKe="_fileInput_1ep5q_17",GKe="_edit_1ep5q_21",_E={avatarInputField:HKe,avatar:VKe,fileInput:qKe,edit:GKe},Wle=({id:t,label:e,className:n,avatarUrl:r,userId:i,displayName:s,onRemoveAvatar:o,...a})=>{const{t:c}=We(),[l,d]=_.useState(!1),[h,m]=_.useState(void 0),[g,y]=_.useState(!1),v=_.useRef(null);_.useEffect(()=>{const R=v.current,x=T=>{const I=T;I.target.files&&I.target.files.length>0?(m(URL.createObjectURL(I.target.files[0])),d(!1)):m(void 0)};return R.addEventListener("change",x),()=>{R?.removeEventListener("change",x)}});const w=_.useCallback(()=>{v.current.click()},[v]),S=_.useCallback(()=>{d(!0),o()},[o]);return E.jsxs("div",{className:Oe(_E.avatarInputField,n),children:[E.jsx(Op,{id:i,className:_E.avatar,name:s,size:Lp.XL,src:l?void 0:h||r}),E.jsx("input",{id:t,accept:"image/*",ref:v,type:"file",className:_E.fileInput,role:"button","aria-label":e,...a}),E.jsx("div",{className:_E.edit,children:(r||h)&&!l?E.jsxs(qM,{title:c("action.edit"),showTitle:!1,open:g,onOpenChange:y,trigger:E.jsx(Bt,{iconOnly:!0,Icon:Qq,kind:"tertiary",size:"sm","aria-label":c("action.edit")}),children:[E.jsx(yv,{Icon:P8e,label:c("action.upload_file"),onSelect:w}),E.jsx(yv,{Icon:b8e,label:c("action.remove"),kind:"critical",onSelect:S})]}):E.jsx(Bt,{type:"button",iconOnly:!0,Icon:Qq,kind:"tertiary",size:"sm","aria-label":c("action.edit"),onClick:w})})]})};Wle.displayName="AvatarInputField";const KKe="_content_gj715_8",zKe="_avatarFieldRow_gj715_15",oz={content:KKe,avatarFieldRow:zKe},WKe=({client:t})=>{const{t:e}=We(),{error:n,displayName:r,avatarUrl:i,saveProfile:s}=V_(t),o=_.useMemo(()=>t.getUserId(),[t]),a=_.useRef(null),c=_.useRef(!1),l=_.useCallback(()=>{c.current=!0},[]),d=_.useRef(!1),h=_.useCallback(()=>{d.current=!0,c.current=!0},[]);return _.useEffect(()=>{const m=a.current;return()=>{if(c.current){const g=new FormData(m),y=g.get("displayName"),v=g.get("avatar"),w=typeof v=="string"?v.length:v?.size??0,S=typeof y=="string"?y:y?.name??null;if(!S)return;s({displayName:S,avatar:v&&w>0?v:void 0,removeAvatar:d.current&&(!v||w===0)}).catch(R=>{M.error("Failed to save profile",R)})}}},[s]),E.jsxs("form",{onChange:l,ref:a,className:oz.content,children:[E.jsx(yt,{className:oz.avatarFieldRow,children:o&&r&&E.jsx(Wle,{id:"avatar",name:"avatar",label:e("common.avatar"),avatarUrl:i,userId:o,displayName:r,onRemoveAvatar:h})}),E.jsx(yt,{children:E.jsx(Tn,{id:"userId",name:"userId",label:e("common.username"),type:"text",disabled:!0,value:t.getUserId()})}),E.jsx(yt,{children:E.jsx(Tn,{id:"displayName",name:"displayName",label:e("common.display_name"),type:"text",required:!0,autoComplete:"off",placeholder:e("common.display_name"),defaultValue:r,"data-testid":"profile_displayname"})}),n&&E.jsx(yt,{children:E.jsx(Bf,{error:n})})]})},YKe="_feedback_19yh9_8",Yle={feedback:YKe},Xle=()=>E.jsxs(Ys,{i18nKey:"analytics_notice",children:["By participating in this beta, you consent to the collection of anonymous data, which we use to improve the product. You can find more information about which data we track in our"," ",E.jsx(Jh,{href:"https://element.io/privacy",children:"Privacy Policy"})," ","and our"," ",E.jsx(Jh,{href:"https://element.io/cookie-policy",children:"Cookie Policy"}),"."]}),XKe=({roomId:t})=>{const{t:e}=We(),{submitRageshake:n,sending:r,sent:i,error:s,available:o}=hR(),a=TGe(),c=_.useCallback(h=>{h.preventDefault();const m=new FormData(h.target),g=m.get("description"),y=typeof g=="string"?g:"",v=!!m.get("sendLogs"),w=To(16);n({description:y,sendLogs:v,rageshakeRequestId:w,roomId:t}).catch(S=>{M.error("Failed to send feedback rageshake",S)}),t&&v&&a(t,w)},[n,t,a]);uR();const l=null,d=o?E.jsxs(E.Fragment,{children:[E.jsx("h4",{children:e("settings.feedback_tab_h4")}),E.jsx(an,{children:e("settings.feedback_tab_body")}),E.jsxs("form",{onSubmit:c,children:[E.jsx(yt,{children:E.jsx(Tn,{className:Yle.feedback,id:"description",name:"description",label:e("settings.feedback_tab_description_label"),placeholder:e("settings.feedback_tab_description_label"),type:"textarea",disabled:r||i})}),!i&&E.jsxs(yt,{children:[E.jsx(Tn,{id:"sendLogs",name:"sendLogs",label:e("settings.feedback_tab_send_logs_label"),type:"checkbox",defaultChecked:!0}),E.jsx(Bt,{type:"submit",disabled:r,children:e(r?"submitting":"action.submit")})]}),E.jsxs(yt,{children:[s&&E.jsx(Bf,{error:s}),i&&E.jsx(an,{children:e("settings.feedback_tab_thank_you")})]})]})]}):null;return E.jsxs("div",{children:[l,d]})};var $w={exports:{}},JKe=$w.exports,az;function QKe(){return az||(az=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(JKe,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(v,w){var S=v[w];if(typeof S.bind=="function")return S.bind(v);try{return Function.prototype.bind.call(S,v)}catch{return function(){return Function.prototype.apply.apply(S,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&r?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function d(){for(var v=this.getLevel(),w=0;w<i.length;w++){var S=i[w];this[S]=w<v?e:this.methodFactory(S,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function h(v){return function(){typeof console!==n&&(d.call(this),this[v].apply(this,arguments))}}function m(v,w,S){return l(v)||h.apply(this,arguments)}function g(v,w){var S=this,R,x,T,I="loglevel";typeof v=="string"?I+=":"+v:typeof v=="symbol"&&(I=void 0);function k(U){var $=(i[U]||"silent").toUpperCase();if(!(typeof window===n||!I)){try{window.localStorage[I]=$;return}catch{}try{window.document.cookie=encodeURIComponent(I)+"="+$+";"}catch{}}}function A(){var U;if(!(typeof window===n||!I)){try{U=window.localStorage[I]}catch{}if(typeof U===n)try{var $=window.document.cookie,K=encodeURIComponent(I),Y=$.indexOf(K+"=");Y!==-1&&(U=/^([^;]+)/.exec($.slice(Y+K.length+1))[1])}catch{}return S.levels[U]===void 0&&(U=void 0),U}}function O(){if(!(typeof window===n||!I)){try{window.localStorage.removeItem(I)}catch{}try{window.document.cookie=encodeURIComponent(I)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function D(U){var $=U;if(typeof $=="string"&&S.levels[$.toUpperCase()]!==void 0&&($=S.levels[$.toUpperCase()]),typeof $=="number"&&$>=0&&$<=S.levels.SILENT)return $;throw new TypeError("log.setLevel() called with invalid level: "+U)}S.name=v,S.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},S.methodFactory=w||m,S.getLevel=function(){return T??x??R},S.setLevel=function(U,$){return T=D(U),$!==!1&&k(T),d.call(S)},S.setDefaultLevel=function(U){x=D(U),A()||S.setLevel(U,!1)},S.resetLevel=function(){T=null,O(),d.call(S)},S.enableAll=function(U){S.setLevel(S.levels.TRACE,U)},S.disableAll=function(U){S.setLevel(S.levels.SILENT,U)},S.rebuild=function(){if(o!==S&&(R=D(o.getLevel())),d.call(S),o===S)for(var U in s)s[U].rebuild()},R=D(o?o.getLevel():"WARN");var N=A();N!=null&&(T=D(N)),d.call(S)}o=new g,o.getLogger=function(w){if(typeof w!="symbol"&&typeof w!="string"||w==="")throw new TypeError("You must supply a name when creating a logger.");var S=s[w];return S||(S=s[w]=new g(w,o.methodFactory)),S};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return s},o.default=o,o})}($w)),$w.exports}var ZKe=QKe();const eze=cl(ZKe);var tze=(t,e,n)=>new Promise((r,i)=>{var s=c=>{try{a(n.next(c))}catch(l){i(l)}},o=c=>{try{a(n.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(s,o);a((n=n.apply(t,e)).next())});function nze(t){return typeof t>"u"?!1:rze(t)||ize(t)}function rze(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function ize(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}function sze(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&typeof t.publication>"u":!1}function oze(t){if(typeof t=="string"||typeof t=="number")return`${t}`;if(sze(t))return`${t.participant.identity}_${t.source}_placeholder`;if(nze(t))return`${t.participant.identity}_${t.publication.source}_${t.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${t}`)}var aze=[ue.ConnectionStateChanged,ue.RoomMetadataChanged,ue.ActiveSpeakersChanged,ue.ConnectionQualityChanged,ue.ParticipantConnected,ue.ParticipantDisconnected,ue.ParticipantPermissionsChanged,ue.ParticipantMetadataChanged,ue.ParticipantNameChanged,ue.ParticipantAttributesChanged,ue.TrackMuted,ue.TrackUnmuted,ue.TrackPublished,ue.TrackUnpublished,ue.TrackStreamStateChanged,ue.TrackSubscriptionFailed,ue.TrackSubscriptionPermissionChanged,ue.TrackSubscriptionStatusChanged],cze=[...aze,ue.LocalTrackPublished,ue.LocalTrackUnpublished];ce.TrackPublished,ce.TrackUnpublished,ce.TrackMuted,ce.TrackUnmuted,ce.TrackStreamStateChanged,ce.TrackSubscribed,ce.TrackUnsubscribed,ce.TrackSubscriptionPermissionChanged,ce.TrackSubscriptionFailed,ce.LocalTrackPublished,ce.LocalTrackUnpublished;var lze=[ce.ConnectionQualityChanged,ce.IsSpeakingChanged,ce.ParticipantMetadataChanged,ce.ParticipantPermissionsChanged,ce.TrackMuted,ce.TrackUnmuted,ce.TrackPublished,ce.TrackUnpublished,ce.TrackStreamStateChanged,ce.TrackSubscriptionFailed,ce.TrackSubscriptionPermissionChanged,ce.TrackSubscriptionStatusChanged];[...lze,ce.LocalTrackPublished,ce.LocalTrackUnpublished];var uze=eze.getLogger("lk-components-js");uze.setDefaultLevel("WARN");function dze(t,...e){return new Wn(r=>{const i=()=>{r.next(t)};return e.forEach(o=>{t.on(o,i)}),()=>{e.forEach(o=>{t.off(o,i)})}}).pipe(dn(t))}function fze(t,e){return new Wn(r=>{const i=(...o)=>{r.next(o)};return t.on(e,i),()=>{t.off(e,i)}})}function cz(t,e,n=!0){const r=new Wn(s=>{xu.getLocalDevices(t,n).then(o=>{s.next(o),s.complete()}).catch(o=>{e?.(o),s.next([]),s.complete()})}),i=new Wn(s=>{var o;const a=()=>tze(this,null,function*(){try{const c=yield xu.getLocalDevices(t,n);s.next(c)}catch(c){e?.(c)}});if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(o=navigator?.mediaDevices)==null||o.addEventListener("devicechange",a)}return()=>{var c;(c=navigator?.mediaDevices)==null||c.removeEventListener("devicechange",a)}});return mp(r,i)}function Y8(t,...e){return new Wn(r=>{const i=()=>{r.next(t)};return e.forEach(o=>{t.on(o,i)}),()=>{e.forEach(o=>{t.off(o,i)})}}).pipe(dn(t))}function X8(t){return Y8(t,ce.TrackMuted,ce.TrackUnmuted,ce.ParticipantPermissionsChanged,ce.TrackPublished,ce.TrackUnpublished,ce.LocalTrackPublished,ce.LocalTrackUnpublished,ce.MediaDevicesError,ce.TrackSubscriptionStatusChanged).pipe(Re(n=>{const{isMicrophoneEnabled:r,isCameraEnabled:i,isScreenShareEnabled:s}=n,o=n.getTrackPublication(he.Source.Microphone),a=n.getTrackPublication(he.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:r,isScreenShareEnabled:s,cameraTrack:a,microphoneTrack:o,participant:n}}))}function hze(t,e={}){var n;let r;const i=new Wn(c=>(r=c,()=>a.unsubscribe())).pipe(dn(Array.from(t.remoteParticipants.values()))),s=(n=e.additionalRoomEvents)!=null?n:cze,o=Array.from(new Set([ue.ParticipantConnected,ue.ParticipantDisconnected,ue.ConnectionStateChanged,...s])),a=dze(t,...o).subscribe(c=>r?.next(Array.from(c.remoteParticipants.values())));return t.remoteParticipants.size>0&&r?.next(Array.from(t.remoteParticipants.values())),i}const sg=new ii,Jle=new ii,Qle=new ii,VL=new ii;let lz=!1;const Zle=()=>{lz||(lz=!0,window.controls.onAudioPlaybackStarted?.())};window.controls={canEnterPip(){return sg.observed},enablePip(){if(!sg.observed)throw new Error("No call is running");sg.next(!0)},disablePip(){if(!sg.observed)throw new Error("No call is running");sg.next(!1)},setAvailableAudioDevices(t){M.info("setAvailableAudioDevices called from native:",t),Jle.next(t)},setAudioDevice(t){M.info("setAudioDevice called from native",t),Qle.next(t)},setAudioEnabled(t){if(M.info("setAudioEnabled called from native:",t),!VL.observed)throw new Error("Output controls are disabled. No setAudioEnabled$ observer");VL.next(t)},setOutputEnabled(t){this.setAudioEnabled(t)},setAvailableOutputDevices(t){this.setAvailableAudioDevices(t)},setOutputDevice(t){this.setAudioDevice(t)}};const b3=Symbol("nothing");function pze(t){return e=>Gqe(()=>{let n=b3;return e.pipe(vGe(r=>n=r),fGe(()=>{n!==b3&&t(n)}))})}function qL(t,e){return n=>n.pipe(ql(e,t),dn(t))}const uz=Symbol("switch");function mze(t,e){return n=>mp(n.pipe(Re((r,i)=>t(r,i)?uz:r),gGe(r=>r!==uz)),e)}function Bw(t){let e=b3;if(t.subscribe(n=>e=n).unsubscribe(),e===b3)throw new Error("Not a state Observable");return e}function dz(...t){return Xt(t,(...e)=>e.every(n=>n))}function z1(t){return e=>e.pipe(Tle(t),wle(([,n])=>n?t.pipe(es(r=>!r)):Ct(null)),Re(([n])=>n))}function eue(t){return new _s(t)}const fz="earpiece-id",tue=va==="ios"?eue(!0):Dle.value$;function mR(t,e,n,r){const i=a=>r.error("Error creating MediaDeviceObserver",a),s=cz(t,i,!1),o=cz(t,i,!0);return n.behavior(e.pipe(Ot(a=>a?s.pipe(mze((c,l)=>l===0&&c.every(d=>!d.label),o)):s)),[])}function J8(t){return new Map(t.map((e,n)=>[e.deviceId,e.label?{type:"name",name:e.label}:{type:"number",number:n+1}]))}function Q8(t,e){return Xt([t,e],(n,r)=>{if(n.size)return r!==void 0&&n.has(r)||n.size===1&&n.has("")?r:n.keys().next().value})}class gze{constructor(e,n){this.usingNames$=e,this.scope=n,this.logger=M.getChild("[MediaDevices AudioInput]"),this.availableRaw$=mR("audioinput",this.usingNames$,this.scope,this.logger),this.available$=this.scope.behavior(this.availableRaw$.pipe(Re(J8))),this.selected$=this.scope.behavior(Q8(this.available$,WK.value$).pipe(Re(r=>r===void 0?void 0:{id:r,hardwareDeviceChange$:this.availableRaw$.pipe(Re(i=>i.find(s=>s.deviceId===r)?.groupId),jw(),es(([i,s])=>i!==s),Re(()=>{}))}))),this.available$.subscribe(r=>{this.logger.info("[audio-input] available devices:",r)})}select(e){WK.setValue(e)}}class vze{constructor(e,n){this.usingNames$=e,this.scope=n,this.logger=M.getChild("[MediaDevices AudioOutput]"),this.available$=this.scope.behavior(mR("audiooutput",this.usingNames$,this.scope,this.logger).pipe(Re(r=>{let i=J8(r);return i.size&&!i.has("")&&!i.has("default")&&i.set("",{type:"default",name:r[0]?.label||null}),!!window.GestureEvent&&(i=new Map),i}))),this.selected$=this.scope.behavior(Q8(this.available$,YK.value$).pipe(Re(r=>r===void 0?void 0:{id:r,virtualEarpiece:!1}))),this.available$.subscribe(r=>{this.logger.info("[audio-output] available devices:",r)})}select(e){YK.setValue(e)}}class yze{constructor(e,n){this.usingNames$=e,this.scope=n,this.logger=M.getChild("[MediaDevices ControlledAudioOutput]"),this.availableRaw$=mR("audiooutput",this.usingNames$,this.scope,this.logger),this.available$=this.scope.behavior(Xt([Jle.pipe(dn([])),tue],(r,i)=>{const s=new Map(r.map(({id:o,name:a,isEarpiece:c,isSpeaker:l})=>{let d;return c?d={type:"earpiece"}:l?d={type:"speaker"}:d={type:"name",name:a},[o,d]}));return i&&r.some(o=>o.forEarpiece)&&s.set(fz,{type:"earpiece"}),s})),this.deviceSelection$=new ii,this.selected$=this.scope.behavior(Xt([this.available$,H_(Qle.pipe(dn(void 0)),this.deviceSelection$)],(r,i)=>{const s=i??r.keys().next().value;return s===void 0?void 0:{id:s,virtualEarpiece:s===fz}})),this.selected$.subscribe(r=>{r!==void 0&&(this.logger.info("[controlled-output] onAudioDeviceSelect called:",r),window.controls.onAudioDeviceSelect?.(r.id),window.controls.onOutputDeviceSelect?.(r.id))}),this.available$.subscribe(r=>{this.logger.info("[controlled-output] available devices:",r)}),this.availableRaw$.subscribe(r=>{this.logger.info("[controlled-output] available raw devices:",r)})}select(e){this.deviceSelection$.next(e)}}class bze{constructor(e,n){this.usingNames$=e,this.scope=n,this.logger=M.getChild("[MediaDevices VideoInput]"),this.available$=this.scope.behavior(mR("videoinput",this.usingNames$,this.scope,this.logger).pipe(Re(J8))),this.selected$=this.scope.behavior(Q8(this.available$,XK.value$).pipe(Re(r=>r===void 0?void 0:{id:r}))),this.available$.subscribe(r=>{this.logger.info("[video-input] available devices:",r)})}select(e){XK.setValue(e)}}class _ze{constructor(e){this.scope=e,this.deviceNamesRequest$=new ii,this.usingNames$=this.scope.behavior(this.deviceNamesRequest$.pipe(Re(()=>!0)),!1),this.audioInput=new gze(this.usingNames$,this.scope),this.audioOutput=Br().controlledAudioDevices?new yze(this.usingNames$,this.scope):new vze(this.usingNames$,this.scope),this.videoInput=new bze(this.usingNames$,this.scope)}requestDeviceNames(){this.deviceNamesRequest$.next()}}function Sze(t,e,n){if(!n)return _.useState(e)[0];const[r]=_.useState(()=>new _s(n)),[i]=_.useState(()=>e(r)),s=_.useRef(!0);return t(()=>{if(s.current){s.current=!1;return}r.next(n)},n),i}function Z8(t,e){return Sze(_.useEffect,t,e)}var Eze=t=>t+1|0,wze=()=>{const t=_.useState(0)[1];return _.useRef(()=>t(Eze)).current},nue=typeof window>"u"?_.useEffect:_.useLayoutEffect,hz=t=>t[1]?.next?t[1]:{next:t[1],error:t[2],complete:t[3]};function Cze(t,e){const n=_.useRef(e),r=_.useRef(),i=_.useRef();return nue(()=>{n.current=e,r.current=hz(e)}),t(()=>{const s=n.current[0];r.current||(r.current=hz(n.current));const o=s.subscribe({next:a=>{s===n.current[0]&&r.current.next?.(a)},error:a=>{s===n.current[0]&&(r.current.error?r.current.error(a):console.error(a))},complete:()=>{s===n.current[0]&&r.current.complete?.()}});return i.current=o,()=>{o.unsubscribe()}},[e[0]]),i}function Tze(t,e,n,r){return Cze(_.useEffect,[t,e,n,r])}function ai(t){const e=wze(),n=_.useRef(t),r=_.useRef(),i=_.useRef(!1),s=_.useRef(!1),[o,a]=_.useState(()=>{let c;return t.subscribe({next:l=>{s.current=!0,c=l},error:l=>{r.current=l}}).unsubscribe(),c});if(nue(()=>{n.current=t}),_.useEffect(()=>{r.current=null;const c=n.current;let l=o;const d=c.subscribe({next:h=>{c===n.current&&(i.current?a(()=>h):l=h)},error:h=>{c===n.current&&(r.current=h,e())}});return i.current||l!==o&&a(()=>l),i.current=!0,()=>{d.unsubscribe()}},[t]),r.current)throw r.current;if(s.current)return _.useDebugValue(o),o;throw new Error("Observable did not synchronously emit a value.")}function Rze(t){const[e]=_.useState(()=>new _s(t)),[n]=_.useState(()=>({get current(){return e.value},set current(r){e.next(r)}}));return[n,e]}const rue=_.createContext(void 0);function Wu(){const t=_.use(rue);if(t===void 0)throw new Error("useMediaDevices must be used within a MediaDevices context provider");return t}const Ize=()=>{const t=Wu(),e=ai(t.audioOutput.selected$),n=ai(t.audioOutput.available$);return e?.id?n.get(e.id)?.type==="earpiece":!1},iue=()=>{const t=Wu(),n=ai(t.audioOutput.selected$)?.virtualEarpiece??!1;return{pan:_.useMemo(()=>n?1:0,[n]),volume:_.useMemo(()=>n?.1:1,[n])}},kze=()=>{const{t}=We(),[e,n]=Gn(Ale),[r,i]=Gn(Ple),[s,o]=Gn(H8),a=(d,h)=>{h(d.target.checked)},[c,l]=Gn($8);return E.jsxs("div",{children:[E.jsx(an,{children:t("settings.preferences_tab.introduction")}),E.jsx(yt,{children:E.jsx(Tn,{id:"showHandRaisedTimer",label:t("settings.preferences_tab.show_hand_raised_timer_label"),description:t("settings.preferences_tab.show_hand_raised_timer_description"),type:"checkbox",checked:e,onChange:d=>a(d,n)})}),E.jsx(yt,{children:E.jsx(Tn,{id:"showReactions",label:t("settings.preferences_tab.reactions_show_label"),description:t("settings.preferences_tab.reactions_show_description"),type:"checkbox",checked:r,onChange:d=>a(d,i)})}),E.jsx(yt,{children:E.jsx(Tn,{id:"playReactionSound",label:t("settings.preferences_tab.reactions_play_sound_label"),description:t("settings.preferences_tab.reactions_play_sound_description"),type:"checkbox",checked:s,onChange:d=>a(d,o)})}),E.jsx(yt,{children:E.jsx(Tn,{id:"developerSettingsTab",type:"checkbox",checked:c,label:t("settings.preferences_tab.developer_mode_label"),description:t("settings.preferences_tab.developer_mode_label_description"),onChange:d=>l(d.target.checked)})})]})};function sue(t,[e,n]){return Math.min(n,Math.max(e,t))}function yg(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t?.(i),n===!1||!i.defaultPrevented)return e?.(i)}}function pz(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function oue(...t){return e=>{let n=!1;const r=t.map(i=>{const s=pz(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():pz(t[i],null)}}}}function Rf(...t){return _.useCallback(oue(...t),t)}function aue(t,e=[]){let n=[];function r(s,o){const a=_.createContext(o),c=n.length;n=[...n,o];const l=h=>{const{scope:m,children:g,...y}=h,v=m?.[t]?.[c]||a,w=_.useMemo(()=>y,Object.values(y));return E.jsx(v.Provider,{value:w,children:g})};l.displayName=s+"Provider";function d(h,m){const g=m?.[t]?.[c]||a,y=_.useContext(g);if(y)return y;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[l,d]}const i=()=>{const s=n.map(o=>_.createContext(o));return function(a){const c=a?.[t]||s;return _.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return i.scopeName=t,[r,xze(i,...e)]}function xze(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:l})=>{const h=c(s)[`__scope${l}`];return{...a,...h}},{});return _.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}var Aze=m_[" useInsertionEffect ".trim().toString()]||up;function Pze({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[i,s,o]=Lze({defaultProp:e,onChange:n}),a=t!==void 0,c=a?t:i;{const d=_.useRef(t!==void 0);_.useEffect(()=>{const h=d.current;h!==a&&console.warn(`${r} is changing from ${h?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=a},[a,r])}const l=_.useCallback(d=>{if(a){const h=Oze(d)?d(t):d;h!==t&&o.current?.(h)}else s(d)},[a,t,s,o]);return[c,l]}function Lze({defaultProp:t,onChange:e}){const[n,r]=_.useState(t),i=_.useRef(n),s=_.useRef(e);return Aze(()=>{s.current=e},[e]),_.useEffect(()=>{i.current!==n&&(s.current?.(n),i.current=n)},[n,i]),[n,r,s]}function Oze(t){return typeof t=="function"}var Mze=_.createContext(void 0);function Dze(t){const e=_.useContext(Mze);return t||e||"ltr"}function Nze(t){const e=_.useRef({value:t,previous:t});return _.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}function Uze(t){const[e,n]=_.useState(void 0);return up(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let o,a;if("borderBoxSize"in s){const c=s.borderBoxSize,l=Array.isArray(c)?c[0]:c;o=l.inlineSize,a=l.blockSize}else o=t.offsetWidth,a=t.offsetHeight;n({width:o,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}function GL(t){const e=jze(t),n=_.forwardRef((r,i)=>{const{children:s,...o}=r,a=_.Children.toArray(s),c=a.find($ze);if(c){const l=c.props.children,d=a.map(h=>h===c?_.Children.count(l)>1?_.Children.only(null):_.isValidElement(l)?l.props.children:null:h);return E.jsx(e,{...o,ref:i,children:_.isValidElement(l)?_.cloneElement(l,void 0,d):null})}return E.jsx(e,{...o,ref:i,children:s})});return n.displayName=`${t}.Slot`,n}function jze(t){const e=_.forwardRef((n,r)=>{const{children:i,...s}=n;if(_.isValidElement(i)){const o=Hze(i),a=Bze(s,i.props);return i.type!==_.Fragment&&(a.ref=r?oue(r,o):o),_.cloneElement(i,a)}return _.Children.count(i)>1?_.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Fze=Symbol("radix.slottable");function $ze(t){return _.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Fze}function Bze(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{const c=s(...a);return i(...a),c}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function Hze(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Vze=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],q_=Vze.reduce((t,e)=>{const n=GL(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function qze(t){const e=t+"CollectionProvider",[n,r]=aue(e),[i,s]=n(e,{collectionRef:{current:null},itemMap:new Map}),o=v=>{const{scope:w,children:S}=v,R=Ce.useRef(null),x=Ce.useRef(new Map).current;return E.jsx(i,{scope:w,itemMap:x,collectionRef:R,children:S})};o.displayName=e;const a=t+"CollectionSlot",c=GL(a),l=Ce.forwardRef((v,w)=>{const{scope:S,children:R}=v,x=s(a,S),T=Rf(w,x.collectionRef);return E.jsx(c,{ref:T,children:R})});l.displayName=a;const d=t+"CollectionItemSlot",h="data-radix-collection-item",m=GL(d),g=Ce.forwardRef((v,w)=>{const{scope:S,children:R,...x}=v,T=Ce.useRef(null),I=Rf(w,T),k=s(d,S);return Ce.useEffect(()=>(k.itemMap.set(T,{ref:T,...x}),()=>void k.itemMap.delete(T))),E.jsx(m,{[h]:"",ref:I,children:R})});g.displayName=d;function y(v){const w=s(t+"CollectionConsumer",v);return Ce.useCallback(()=>{const R=w.collectionRef.current;if(!R)return[];const x=Array.from(R.querySelectorAll(`[${h}]`));return Array.from(w.itemMap.values()).sort((k,A)=>x.indexOf(k.ref.current)-x.indexOf(A.ref.current))},[w.collectionRef,w.itemMap])}return[{Provider:o,Slot:l,ItemSlot:g},y,r]}var cue=["PageUp","PageDown"],lue=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],uue={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},i0="Slider",[KL,Gze,Kze]=qze(i0),[due,zat]=aue(i0,[Kze]),[zze,gR]=due(i0),fue=_.forwardRef((t,e)=>{const{name:n,min:r=0,max:i=100,step:s=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:c=0,defaultValue:l=[r],value:d,onValueChange:h=()=>{},onValueCommit:m=()=>{},inverted:g=!1,form:y,...v}=t,w=_.useRef(new Set),S=_.useRef(0),x=o==="horizontal"?Wze:Yze,[T=[],I]=Pze({prop:d,defaultProp:l,onChange:U=>{[...w.current][S.current]?.focus(),h(U)}}),k=_.useRef(T);function A(U){const $=eWe(T,U);N(U,$)}function O(U){N(U,S.current)}function D(){const U=k.current[S.current];T[S.current]!==U&&m(T)}function N(U,$,{commit:K}={commit:!1}){const Y=iWe(s),G=sWe(Math.round((U-r)/s)*s+r,Y),F=sue(G,[r,i]);I((q=[])=>{const z=Qze(q,F,$);if(rWe(z,c*s)){S.current=z.indexOf(F);const W=String(z)!==String(q);return W&&K&&m(z),W?z:q}else return q})}return E.jsx(zze,{scope:t.__scopeSlider,name:n,disabled:a,min:r,max:i,valueIndexToChangeRef:S,thumbs:w.current,values:T,orientation:o,form:y,children:E.jsx(KL.Provider,{scope:t.__scopeSlider,children:E.jsx(KL.Slot,{scope:t.__scopeSlider,children:E.jsx(x,{"aria-disabled":a,"data-disabled":a?"":void 0,...v,ref:e,onPointerDown:yg(v.onPointerDown,()=>{a||(k.current=T)}),min:r,max:i,inverted:g,onSlideStart:a?void 0:A,onSlideMove:a?void 0:O,onSlideEnd:a?void 0:D,onHomeKeyDown:()=>!a&&N(r,0,{commit:!0}),onEndKeyDown:()=>!a&&N(i,T.length-1,{commit:!0}),onStepKeyDown:({event:U,direction:$})=>{if(!a){const G=cue.includes(U.key)||U.shiftKey&&lue.includes(U.key)?10:1,F=S.current,q=T[F],z=s*G*$;N(q+z,F,{commit:!0})}}})})})})});fue.displayName=i0;var[hue,pue]=due(i0,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Wze=_.forwardRef((t,e)=>{const{min:n,max:r,dir:i,inverted:s,onSlideStart:o,onSlideMove:a,onSlideEnd:c,onStepKeyDown:l,...d}=t,[h,m]=_.useState(null),g=Rf(e,x=>m(x)),y=_.useRef(void 0),v=Dze(i),w=v==="ltr",S=w&&!s||!w&&s;function R(x){const T=y.current||h.getBoundingClientRect(),I=[0,T.width],A=e9(I,S?[n,r]:[r,n]);return y.current=T,A(x-T.left)}return E.jsx(hue,{scope:t.__scopeSlider,startEdge:S?"left":"right",endEdge:S?"right":"left",direction:S?1:-1,size:"width",children:E.jsx(mue,{dir:v,"data-orientation":"horizontal",...d,ref:g,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:x=>{const T=R(x.clientX);o?.(T)},onSlideMove:x=>{const T=R(x.clientX);a?.(T)},onSlideEnd:()=>{y.current=void 0,c?.()},onStepKeyDown:x=>{const I=uue[S?"from-left":"from-right"].includes(x.key);l?.({event:x,direction:I?-1:1})}})})}),Yze=_.forwardRef((t,e)=>{const{min:n,max:r,inverted:i,onSlideStart:s,onSlideMove:o,onSlideEnd:a,onStepKeyDown:c,...l}=t,d=_.useRef(null),h=Rf(e,d),m=_.useRef(void 0),g=!i;function y(v){const w=m.current||d.current.getBoundingClientRect(),S=[0,w.height],x=e9(S,g?[r,n]:[n,r]);return m.current=w,x(v-w.top)}return E.jsx(hue,{scope:t.__scopeSlider,startEdge:g?"bottom":"top",endEdge:g?"top":"bottom",size:"height",direction:g?1:-1,children:E.jsx(mue,{"data-orientation":"vertical",...l,ref:h,style:{...l.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:v=>{const w=y(v.clientY);s?.(w)},onSlideMove:v=>{const w=y(v.clientY);o?.(w)},onSlideEnd:()=>{m.current=void 0,a?.()},onStepKeyDown:v=>{const S=uue[g?"from-bottom":"from-top"].includes(v.key);c?.({event:v,direction:S?-1:1})}})})}),mue=_.forwardRef((t,e)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:s,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:c,...l}=t,d=gR(i0,n);return E.jsx(q_.span,{...l,ref:e,onKeyDown:yg(t.onKeyDown,h=>{h.key==="Home"?(o(h),h.preventDefault()):h.key==="End"?(a(h),h.preventDefault()):cue.concat(lue).includes(h.key)&&(c(h),h.preventDefault())}),onPointerDown:yg(t.onPointerDown,h=>{const m=h.target;m.setPointerCapture(h.pointerId),h.preventDefault(),d.thumbs.has(m)?m.focus():r(h)}),onPointerMove:yg(t.onPointerMove,h=>{h.target.hasPointerCapture(h.pointerId)&&i(h)}),onPointerUp:yg(t.onPointerUp,h=>{const m=h.target;m.hasPointerCapture(h.pointerId)&&(m.releasePointerCapture(h.pointerId),s(h))})})}),gue="SliderTrack",vue=_.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,i=gR(gue,n);return E.jsx(q_.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:e})});vue.displayName=gue;var zL="SliderRange",yue=_.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,i=gR(zL,n),s=pue(zL,n),o=_.useRef(null),a=Rf(e,o),c=i.values.length,l=i.values.map(m=>Sue(m,i.min,i.max)),d=c>1?Math.min(...l):0,h=100-Math.max(...l);return E.jsx(q_.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:a,style:{...t.style,[s.startEdge]:d+"%",[s.endEdge]:h+"%"}})});yue.displayName=zL;var WL="SliderThumb",bue=_.forwardRef((t,e)=>{const n=Gze(t.__scopeSlider),[r,i]=_.useState(null),s=Rf(e,a=>i(a)),o=_.useMemo(()=>r?n().findIndex(a=>a.ref.current===r):-1,[n,r]);return E.jsx(Xze,{...t,ref:s,index:o})}),Xze=_.forwardRef((t,e)=>{const{__scopeSlider:n,index:r,name:i,...s}=t,o=gR(WL,n),a=pue(WL,n),[c,l]=_.useState(null),d=Rf(e,R=>l(R)),h=c?o.form||!!c.closest("form"):!0,m=Uze(c),g=o.values[r],y=g===void 0?0:Sue(g,o.min,o.max),v=Zze(r,o.values.length),w=m?.[a.size],S=w?tWe(w,y,a.direction):0;return _.useEffect(()=>{if(c)return o.thumbs.add(c),()=>{o.thumbs.delete(c)}},[c,o.thumbs]),E.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${y}% + ${S}px)`},children:[E.jsx(KL.ItemSlot,{scope:t.__scopeSlider,children:E.jsx(q_.span,{role:"slider","aria-label":t["aria-label"]||v,"aria-valuemin":o.min,"aria-valuenow":g,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...s,ref:d,style:g===void 0?{display:"none"}:t.style,onFocus:yg(t.onFocus,()=>{o.valueIndexToChangeRef.current=r})})}),h&&E.jsx(_ue,{name:i??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:g},r)]})});bue.displayName=WL;var Jze="RadioBubbleInput",_ue=_.forwardRef(({__scopeSlider:t,value:e,...n},r)=>{const i=_.useRef(null),s=Rf(i,r),o=Nze(e);return _.useEffect(()=>{const a=i.current;if(!a)return;const c=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(c,"value").set;if(o!==e&&d){const h=new Event("input",{bubbles:!0});d.call(a,e),a.dispatchEvent(h)}},[o,e]),E.jsx(q_.input,{style:{display:"none"},...n,ref:s,defaultValue:e})});_ue.displayName=Jze;function Qze(t=[],e,n){const r=[...t];return r[n]=e,r.sort((i,s)=>i-s)}function Sue(t,e,n){const s=100/(n-e)*(t-e);return sue(s,[0,100])}function Zze(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function eWe(t,e){if(t.length===1)return 0;const n=t.map(i=>Math.abs(i-e)),r=Math.min(...n);return n.indexOf(r)}function tWe(t,e,n){const r=t/2,s=e9([0,50],[0,r]);return(r-s(e)*n)*n}function nWe(t){return t.slice(0,-1).map((e,n)=>t[n+1]-e)}function rWe(t,e){if(e>0){const n=nWe(t);return Math.min(...n)>=e}return!0}function e9(t,e){return n=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(t[1]-t[0]);return e[0]+r*(n-t[0])}}function iWe(t){return(String(t).split(".")[1]||"").length}function sWe(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}var oWe=fue,aWe=vue,cWe=yue,lWe=bue;const uWe="_slider_15go1_8",dWe="_track_15go1_14",fWe="_highlight_15go1_31",hWe="_handle_15go1_43",SE={slider:uWe,track:dWe,highlight:fWe,handle:hWe},Eue=({className:t,label:e,value:n,onValueChange:r,onValueCommit:i,min:s,max:o,step:a,disabled:c})=>{const l=_.useCallback(([h])=>r(h),[r]),d=_.useCallback(([h])=>i?.(h),[i]);return E.jsxs(oWe,{className:Oe(t,SE.slider),value:[n],onValueChange:l,onValueCommit:d,min:s,max:o,step:a,disabled:c,children:[E.jsx(aWe,{className:SE.track,children:E.jsx(cWe,{className:SE.highlight})}),E.jsx(qi,{placement:"top",label:Math.round(n*100).toString()+"%",children:E.jsx(lWe,{className:SE.handle,"aria-label":e})})]})},pWe="_selection_1akwb_1",mWe="_title_1akwb_5",gWe="_separator_1akwb_10",vWe="_options_1akwb_14",yWe="_secondary_1akwb_20",W1={selection:pWe,title:mWe,separator:gWe,options:vWe,secondary:yWe},Ux=({device:t,title:e,numberedLabel:n})=>{const{t:r}=We(),i=_.useId(),s=ai(t.available$),o=ai(t.selected$)?.id,a=_.useCallback(c=>{t.select(c.target.value)},[t]);return s.size<=1?null:E.jsxs("div",{className:W1.selection,children:[E.jsx(gl,{type:"body",weight:"semibold",size:"sm",as:"h4",className:W1.title,children:e}),E.jsx(QM,{className:W1.separator}),E.jsx("div",{className:W1.options,children:[...s].map(([c,l])=>{let d;switch(l.type){case"name":d=l.name;break;case"number":d=n(l.number);break;case"default":d=l.name===null?r("settings.devices.default"):E.jsxs(Ys,{i18nKey:"settings.devices.default_named",name:l.name,children:["Default"," ",E.jsxs("span",{className:W1.secondary,children:["(",{name:l.name},")"]})]});break;case"speaker":d=r("settings.devices.loudspeaker");break;case"earpiece":d=r("settings.devices.handset");break}return E.jsx(RMe,{name:i,control:E.jsx(hMe,{checked:c===o,onChange:a,value:c}),children:E.jsx(gMe,{children:d})},c)})})]})};var vp=typeof self<"u"?self:{};function Sh(){throw Error("Invalid UTF8")}function mz(t,e){return e=String.fromCharCode.apply(null,e),t==null?e:t+e}let EE,jx;const bWe=typeof TextDecoder<"u";let _We;const SWe=typeof TextEncoder<"u";function wue(t){if(SWe)t=(_We||=new TextEncoder).encode(t);else{let n=0;const r=new Uint8Array(3*t.length);for(let i=0;i<t.length;i++){var e=t.charCodeAt(i);if(e<128)r[n++]=e;else{if(e<2048)r[n++]=e>>6|192;else{if(e>=55296&&e<=57343){if(e<=56319&&i<t.length){const s=t.charCodeAt(++i);if(s>=56320&&s<=57343){e=1024*(e-55296)+s-56320+65536,r[n++]=e>>18|240,r[n++]=e>>12&63|128,r[n++]=e>>6&63|128,r[n++]=63&e|128;continue}i--}e=65533}r[n++]=e>>12|224,r[n++]=e>>6&63|128}r[n++]=63&e|128}}t=n===r.length?r:r.subarray(0,n)}return t}var t9,_3;e:{for(var gz=["CLOSURE_FLAGS"],Fx=vp,$x=0;$x<gz.length;$x++)if((Fx=Fx[gz[$x]])==null){_3=null;break e}_3=Fx}var Wb,vz=_3&&_3[610401301];t9=vz!=null&&vz;const yz=vp.navigator;function YL(t){return!!t9&&!!Wb&&Wb.brands.some(({brand:e})=>e&&e.indexOf(t)!=-1)}function ia(t){var e;return(e=vp.navigator)&&(e=e.userAgent)||(e=""),e.indexOf(t)!=-1}function Bd(){return!!t9&&!!Wb&&Wb.brands.length>0}function Bx(){return Bd()?YL("Chromium"):(ia("Chrome")||ia("CriOS"))&&!(!Bd()&&ia("Edge"))||ia("Silk")}function n9(t){return n9[" "](t),t}Wb=yz&&yz.userAgentData||null,n9[" "]=function(){};var EWe=!Bd()&&(ia("Trident")||ia("MSIE"));!ia("Android")||Bx(),Bx(),ia("Safari")&&(Bx()||!Bd()&&ia("Coast")||!Bd()&&ia("Opera")||!Bd()&&ia("Edge")||(Bd()?YL("Microsoft Edge"):ia("Edg/"))||Bd()&&YL("Opera"));var Cue={},by=null;function wWe(t){const e=t.length;let n=3*e/4;n%3?n=Math.floor(n):"=.".indexOf(t[e-1])!=-1&&(n="=.".indexOf(t[e-2])!=-1?n-2:n-1);const r=new Uint8Array(n);let i=0;return function(s,o){function a(l){for(;c<s.length;){const d=s.charAt(c++),h=by[d];if(h!=null)return h;if(!/^[\s\xa0]*$/.test(d))throw Error("Unknown base64 encoding at char: "+d)}return l}Tue();let c=0;for(;;){const l=a(-1),d=a(0),h=a(64),m=a(64);if(m===64&&l===-1)break;o(l<<2|d>>4),h!=64&&(o(d<<4&240|h>>2),m!=64&&o(h<<6&192|m))}}(t,function(s){r[i++]=s}),i!==n?r.subarray(0,i):r}function Tue(){if(!by){by={};var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"];for(let n=0;n<5;n++){const r=t.concat(e[n].split(""));Cue[n]=r;for(let i=0;i<r.length;i++){const s=r[i];by[s]===void 0&&(by[s]=i)}}}}var Rue=typeof Uint8Array<"u",Iue=!EWe&&typeof btoa=="function";function bz(t){if(!Iue){var e;e===void 0&&(e=0),Tue(),e=Cue[e];var n=Array(Math.floor(t.length/3)),r=e[64]||"";let c=0,l=0;for(;c<t.length-2;c+=3){var i=t[c],s=t[c+1],o=t[c+2],a=e[i>>2];i=e[(3&i)<<4|s>>4],s=e[(15&s)<<2|o>>6],o=e[63&o],n[l++]=a+i+s+o}switch(a=0,o=r,t.length-c){case 2:o=e[(15&(a=t[c+1]))<<2]||r;case 1:t=t[c],n[l]=e[t>>2]+e[(3&t)<<4|a>>4]+o+r}return n.join("")}for(e="",n=0,r=t.length-10240;n<r;)e+=String.fromCharCode.apply(null,t.subarray(n,n+=10240));return e+=String.fromCharCode.apply(null,n?t.subarray(n):t),btoa(e)}const _z=/[-_.]/g,CWe={"-":"+",_:"/",".":"="};function TWe(t){return CWe[t]||""}function kue(t){if(!Iue)return wWe(t);_z.test(t)&&(t=t.replace(_z,TWe)),t=atob(t);const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function G_(t){return Rue&&t!=null&&t instanceof Uint8Array}var Cv={};function yp(){return RWe||=new Tu(null,Cv)}function r9(t){xue(Cv);var e=t.g;return(e=e==null||G_(e)?e:typeof e=="string"?kue(e):null)==null?e:t.g=e}var Tu=class{h(){return new Uint8Array(r9(this)||0)}constructor(t,e){if(xue(e),this.g=t,t!=null&&t.length===0)throw Error("ByteString should be constructed with non-empty values")}};let RWe,IWe;function xue(t){if(t!==Cv)throw Error("illegal external caller")}function Aue(t,e){t.__closure__error__context__984382||(t.__closure__error__context__984382={}),t.__closure__error__context__984382.severity=e}function XL(t){return Aue(t=Error(t),"warning"),t}var vR=typeof Symbol=="function"&&typeof Symbol()=="symbol",kWe=new Set;function K_(t,e,n=!1,r=!1){return t=typeof Symbol=="function"&&typeof Symbol()=="symbol"?r&&Symbol.for&&t?Symbol.for(t):t!=null?Symbol(t):Symbol():e,n&&kWe.add(t),t}var xWe=K_("jas",void 0,!0,!0),Sz=K_(void 0,"0di"),Hx=K_(void 0,"2ex"),Y1=K_(void 0,"1oa",!0),Tv=K_(void 0,Symbol(),!0);const ze=vR?xWe:"Ga",Pue={Ga:{value:0,configurable:!0,writable:!0,enumerable:!1}},Lue=Object.defineProperties;function yR(t,e){vR||ze in t||Lue(t,Pue),t[ze]|=e}function $r(t,e){vR||ze in t||Lue(t,Pue),t[ze]=e}function s0(t){return yR(t,34),t}function AWe(t,e){$r(e,-30975&(0|t))}function JL(t,e){$r(e,-30941&(34|t))}function i9(){return typeof BigInt=="function"}function Js(t){return Array.prototype.slice.call(t)}var s9,z_={},Oue={};function Ez(t){return!(!t||typeof t!="object"||t.Ia!==Oue)}function o9(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&t.constructor===Object}function a9(t,e){if(t!=null){if(typeof t=="string")t=t?new Tu(t,Cv):yp();else if(t.constructor!==Tu)if(G_(t))t=t.length?new Tu(new Uint8Array(t),Cv):yp();else{if(!e)throw Error();t=void 0}}return t}function S3(t){return!(!Array.isArray(t)||t.length)&&!!(1&(0|t[ze]))}const wz=[];function Hf(t){if(2&t)throw Error()}$r(wz,55),s9=Object.freeze(wz);let Cz=class Mue{constructor(e,n,r){this.l=0,this.g=e,this.h=n,this.m=r}next(){if(this.l<this.g.length){const e=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,e):e}}return{done:!0,value:void 0}}[Symbol.iterator](){return new Mue(this.g,this.h,this.m)}};function c9(t){return Tv?t[Tv]:void 0}var PWe=Object.freeze({});function bR(t){return t.Qa=!0,t}var LWe=bR(t=>typeof t=="number"),Tz=bR(t=>typeof t=="string"),OWe=bR(t=>typeof t=="boolean"),_R=typeof vp.BigInt=="function"&&typeof vp.BigInt(0)=="bigint",QL=bR(t=>_R?t>=DWe&&t<=UWe:t[0]==="-"?Rz(t,MWe):Rz(t,NWe));const MWe=Number.MIN_SAFE_INTEGER.toString(),DWe=_R?BigInt(Number.MIN_SAFE_INTEGER):void 0,NWe=Number.MAX_SAFE_INTEGER.toString(),UWe=_R?BigInt(Number.MAX_SAFE_INTEGER):void 0;function Rz(t,e){if(t.length>e.length)return!1;if(t.length<e.length||t===e)return!0;for(let n=0;n<t.length;n++){const r=t[n],i=e[n];if(r>i)return!1;if(r<i)return!0}}const jWe=typeof Uint8Array.prototype.slice=="function";let Due,An=0,br=0;function Iz(t){const e=t>>>0;An=e,br=(t-e)/4294967296>>>0}function Rv(t){if(t<0){Iz(-t);const[e,n]=f9(An,br);An=e>>>0,br=n>>>0}else Iz(t)}function l9(t){const e=Due||=new DataView(new ArrayBuffer(8));e.setFloat32(0,+t,!0),br=0,An=e.getUint32(0,!0)}function u9(t,e){const n=4294967296*e+(t>>>0);return Number.isSafeInteger(n)?n:Yb(t,e)}function d9(t,e){const n=2147483648&e;return n&&(e=~e>>>0,(t=1+~t>>>0)==0&&(e=e+1>>>0)),typeof(t=u9(t,e))=="number"?n?-t:t:n?"-"+t:t}function Yb(t,e){if(t>>>=0,(e>>>=0)<=2097151)var n=""+(4294967296*e+t);else i9()?n=""+(BigInt(e)<<BigInt(32)|BigInt(t)):(t=(16777215&t)+6777216*(n=16777215&(t>>>24|e<<8))+6710656*(e=e>>16&65535),n+=8147497*e,e*=2,t>=1e7&&(n+=t/1e7>>>0,t%=1e7),n>=1e7&&(e+=n/1e7>>>0,n%=1e7),n=e+kz(n)+kz(t));return n}function kz(t){return t=String(t),"0000000".slice(t.length)+t}function SR(t){if(t.length<16)Rv(Number(t));else if(i9())t=BigInt(t),An=Number(t&BigInt(4294967295))>>>0,br=Number(t>>BigInt(32)&BigInt(4294967295));else{const e=+(t[0]==="-");br=An=0;const n=t.length;for(let r=e,i=(n-e)%6+e;i<=n;r=i,i+=6){const s=Number(t.slice(r,i));br*=1e6,An=1e6*An+s,An>=4294967296&&(br+=Math.trunc(An/4294967296),br>>>=0,An>>>=0)}if(e){const[r,i]=f9(An,br);An=r,br=i}}}function f9(t,e){return e=~e,t?t=1+~t:e+=1,[t,e]}const h9=typeof BigInt=="function"?BigInt.asIntN:void 0,FWe=typeof BigInt=="function"?BigInt.asUintN:void 0,Gg=Number.isSafeInteger,ER=Number.isFinite,E3=Math.trunc;function Vf(t){return t==null||typeof t=="number"?t:t==="NaN"||t==="Infinity"||t==="-Infinity"?Number(t):void 0}function Nue(t){return t==null||typeof t=="boolean"?t:typeof t=="number"?!!t:void 0}const $We=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function wR(t){switch(typeof t){case"bigint":return!0;case"number":return ER(t);case"string":return $We.test(t);default:return!1}}function o0(t){if(t==null)return t;if(typeof t=="string"&&t)t=+t;else if(typeof t!="number")return;return ER(t)?0|t:void 0}function Uue(t){if(t==null)return t;if(typeof t=="string"&&t)t=+t;else if(typeof t!="number")return;return ER(t)?t>>>0:void 0}function xz(t){if(t[0]==="-")return!1;const e=t.length;return e<20||e===20&&Number(t.substring(0,6))<184467}function p9(t){return t=E3(t),Gg(t)||(Rv(t),t=d9(An,br)),t}function m9(t){var e=E3(Number(t));if(Gg(e))return String(e);if((e=t.indexOf("."))!==-1&&(t=t.substring(0,e)),e=t.length,!(t[0]==="-"?e<20||e===20&&Number(t.substring(0,7))>-922337:e<19||e===19&&Number(t.substring(0,6))<922337))if(SR(t),t=An,2147483648&(e=br))if(i9())t=""+(BigInt(0|e)<<BigInt(32)|BigInt(t>>>0));else{const[n,r]=f9(t,e);t="-"+Yb(n,r)}else t=Yb(t,e);return t}function w3(t){return t==null?t:typeof t=="bigint"?(QL(t)?t=Number(t):(t=h9(64,t),t=QL(t)?Number(t):String(t)),t):wR(t)?typeof t=="number"?p9(t):m9(t):void 0}function BWe(t){if(t==null)return t;var e=typeof t;if(e==="bigint")return String(FWe(64,t));if(wR(t)){if(e==="string")return e=E3(Number(t)),Gg(e)&&e>=0?t=String(e):((e=t.indexOf("."))!==-1&&(t=t.substring(0,e)),xz(t)||(SR(t),t=Yb(An,br))),t;if(e==="number")return(t=E3(t))>=0&&Gg(t)?t:function(n){if(n<0){Rv(n);var r=Yb(An,br);return n=Number(r),Gg(n)?n:r}return xz(r=String(n))?r:(Rv(n),u9(An,br))}(t)}}function jue(t){if(typeof t!="string")throw Error();return t}function a0(t){if(t!=null&&typeof t!="string")throw Error();return t}function Iv(t){return t==null||typeof t=="string"?t:void 0}function g9(t,e,n,r){if(t!=null&&typeof t=="object"&&t.W===z_)return t;if(!Array.isArray(t))return n?2&r?((t=e[Sz])||(s0((t=new e).u),t=e[Sz]=t),e=t):e=new e:e=void 0,e;let i=n=0|t[ze];return i===0&&(i|=32&r),i|=2&r,i!==n&&$r(t,i),new e(t)}function HWe(t,e,n){if(e)e:{if(!wR(e=t))throw XL("int64");switch(typeof e){case"string":e=m9(e);break e;case"bigint":if(t=e=h9(64,e),Tz(t)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(t))throw Error(String(t))}else if(LWe(t)&&!Number.isSafeInteger(t))throw Error(String(t));e=_R?BigInt(e):OWe(e)?e?"1":"0":Tz(e)?e.trim()||"0":String(e);break e;default:e=p9(e)}}else e=w3(t);return typeof(n=(t=e)==null?n?0:void 0:t)=="string"&&Gg(e=+n)?e:n}const VWe={};let qWe=function(){try{return n9(new class extends Map{constructor(){super()}}),!1}catch{return!0}}(),Vx=class{constructor(){this.g=new Map}get(e){return this.g.get(e)}set(e,n){return this.g.set(e,n),this.size=this.g.size,this}delete(e){return e=this.g.delete(e),this.size=this.g.size,e}clear(){this.g.clear(),this.size=this.g.size}has(e){return this.g.has(e)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(e,n){return this.g.forEach(e,n)}[Symbol.iterator](){return this.entries()}};const GWe=qWe?(Object.setPrototypeOf(Vx.prototype,Map.prototype),Object.defineProperties(Vx.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),Vx):class extends Map{constructor(){super()}};function Az(t){return t}function qx(t){if(2&t.L)throw Error("Cannot mutate an immutable Map")}var Ca=class extends GWe{constructor(t,e,n=Az,r=Az){super();let i=0|t[ze];i|=64,$r(t,i),this.L=i,this.S=e,this.R=n,this.Y=this.S?KWe:r;for(let s=0;s<t.length;s++){const o=t[s],a=n(o[0],!1,!0);let c=o[1];e?c===void 0&&(c=null):c=r(o[1],!1,!0,void 0,void 0,i),super.set(a,c)}}na(t=Pz){if(this.size!==0)return this.X(t)}X(t=Pz){const e=[],n=super.entries();for(var r;!(r=n.next()).done;)(r=r.value)[0]=t(r[0]),r[1]=t(r[1]),e.push(r);return e}clear(){qx(this),super.clear()}delete(t){return qx(this),super.delete(this.R(t,!0,!1))}entries(){var t=this.ma();return new Cz(t,zWe,this)}keys(){return this.Ha()}values(){var t=this.ma();return new Cz(t,Ca.prototype.get,this)}forEach(t,e){super.forEach((n,r)=>{t.call(e,this.get(r),r,this)})}set(t,e){return qx(this),(t=this.R(t,!0,!1))==null?this:e==null?(super.delete(t),this):super.set(t,this.Y(e,!0,!0,this.S,!1,this.L))}Na(t){const e=this.R(t[0],!1,!0);t=t[1],t=this.S?t===void 0?null:t:this.Y(t,!1,!0,void 0,!1,this.L),super.set(e,t)}has(t){return super.has(this.R(t,!1,!1))}get(t){t=this.R(t,!1,!1);const e=super.get(t);if(e!==void 0){var n=this.S;return n?((n=this.Y(e,!1,!0,n,this.ra,this.L))!==e&&super.set(t,n),n):e}}ma(){return Array.from(super.keys())}Ha(){return super.keys()}[Symbol.iterator](){return this.entries()}};function KWe(t,e,n,r,i,s){return t=g9(t,r,n,s),i&&(t=TR(t)),t}function Pz(t){return t}function zWe(t){return[t,this.get(t)]}let WWe,Fue,YWe;function Lz(){return WWe||=new Ca(s0([]),void 0,void 0,void 0,VWe)}function v9(t,e,n,r,i){if(t!=null){if(Array.isArray(t))t=S3(t)?void 0:i&&2&(0|t[ze])?t:y9(t,e,n,r!==void 0,i);else if(o9(t)){const s={};for(let o in t)s[o]=v9(t[o],e,n,r,i);t=s}else t=e(t,r);return t}}function y9(t,e,n,r,i){const s=r||n?0|t[ze]:0,o=r?!!(32&s):void 0;r=Js(t);for(let a=0;a<r.length;a++)r[a]=v9(r[a],e,n,o,i);return n&&((t=c9(t))&&(r[Tv]=Js(t)),n(s,r)),r}function XWe(t){return v9(t,$ue,void 0,void 0,!1)}function $ue(t){return t.W===z_?t.toJSON():t instanceof Ca?t.na(XWe):function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"bigint":return QL(e)?Number(e):String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(S3(e))return}else{if(G_(e))return bz(e);if(e instanceof Tu){const n=e.g;return n==null?"":typeof n=="string"?n:e.g=bz(n)}if(e instanceof Ca)return e.na()}}return e}(t)}function Bue(t){return y9(t,$ue,void 0,void 0,!1)}function lf(t,e,n){return t=Hue(t,e[0],e[1],n?1:2),e!==Fue&&n&&yR(t,16384),t}function Hue(t,e,n,r){if(t==null){var i=96;n?(t=[n],i|=512):t=[],e&&(i=-33521665&i|(1023&e)<<15)}else{if(!Array.isArray(t))throw Error("narr");if(2048&(i=0|t[ze]))throw Error("farr");if(64&i)return t;if(r===1||r===2||(i|=64),n&&(i|=512,n!==t[0]))throw Error("mid");e:{if(r=(n=t).length){const s=r-1;if(o9(n[s])){if((e=s-(512&(i|=256)?0:-1))>=1024)throw Error("pvtlmt");i=-33521665&i|(1023&e)<<15;break e}}if(e){if((e=Math.max(e,r-(512&i?0:-1)))>1024)throw Error("spvt");i=-33521665&i|(1023&e)<<15}}}return $r(t,i),t}function ZL(t,e,n=JL){if(t!=null){if(Rue&&t instanceof Uint8Array)return e?t:new Uint8Array(t);if(Array.isArray(t)){var r=0|t[ze];return 2&r?t:(e&&=r===0||!!(32&r)&&!(64&r||!(16&r)),e?($r(t,-12293&(34|r)),t):y9(t,ZL,4&r?JL:n,!0,!0))}return t.W===z_?t=2&(r=0|(n=t.u)[ze])?t:new t.constructor(CR(n,r,!0)):t instanceof Ca&&!(2&t.L)&&(n=s0(t.X(ZL)),t=new Ca(n,t.S,t.R,t.Y)),t}}function CR(t,e,n){const r=n||2&e?JL:AWe,i=!!(32&e);return t=function(s,o,a){const c=Js(s);var l=c.length;const d=256&o?c[l-1]:void 0;for(l+=d?-1:0,o=512&o?1:0;o<l;o++)c[o]=a(c[o]);if(d){o=c[o]={};for(const h in d)o[h]=a(d[h])}return(s=c9(s))&&(c[Tv]=Js(s)),c}(t,e,s=>ZL(s,i,r)),yR(t,32|(n?2:0)),t}function TR(t){const e=t.u,n=0|e[ze];return 2&n?new t.constructor(CR(e,n,!1)):t}function kv(t,e){return Yu(t=t.u,0|t[ze],e)}function Yu(t,e,n,r){if(n===-1)return null;var i=n+(512&e?0:-1);const s=t.length-1;return i>=s&&256&e?t[s][n]:r&&256&e&&(e=t[s][n])!=null?(t[i]!=null&&Hx!=null&&((i=(t=IWe??={})[Hx]||0)>=4||(t[Hx]=i+1,Aue(t=Error(),"incident"),function(o){vp.setTimeout(()=>{throw o},0)}(t))),e):i<=s?t[i]:void 0}function Fn(t,e,n){const r=t.u;let i=0|r[ze];return Hf(i),ur(r,i,e,n),t}function ur(t,e,n,r){const i=512&e?0:-1,s=n+i;var o=t.length-1;return s>=o&&256&e?(t[o][n]=r,e):s<=o?(t[s]=r,256&e&&n in(t=t[o])&&delete t[n],e):(r!==void 0&&(n>=(o=e>>15&1023||536870912)?r!=null&&(t[o+i]={[n]:r},$r(t,e|=256)):t[s]=r),e)}function Hw(t,e){let n=0|(t=t.u)[ze];const r=Yu(t,n,e),i=Vf(r);return i!=null&&i!==r&&ur(t,n,e,i),i}function Vue(t){let e=0|(t=t.u)[ze];const n=Yu(t,e,1),r=a9(n,!0);return r!=null&&r!==n&&ur(t,e,1,r),r}function Fh(){return PWe===void 0?2:4}function $h(t,e,n,r,i){const s=t.u,o=2&(t=0|s[ze])?1:r;i=!!i;let a=0|(r=b9(s,t,e))[ze];if(!(4&a)){4&a&&(r=Js(r),a=Ru(a,t),t=ur(s,t,e,r));let c=0,l=0;for(;c<r.length;c++){const d=n(r[c]);d!=null&&(r[l++]=d)}l<c&&(r.length=l),a=_9(a,t),n=-4097&(20|a),a=n&=-8193,$r(r,a),2&a&&Object.freeze(r)}return o===1||o===4&&32&a?gu(a)||(i=a,a|=2,a!==i&&$r(r,a),Object.freeze(r)):(o===2&&gu(a)&&(r=Js(r),a=Ru(a,t),a=uf(a,t,i),$r(r,a),t=ur(s,t,e,r)),gu(a)||(e=a,a=uf(a,t,i),a!==e&&$r(r,a))),r}function b9(t,e,n,r){return t=Yu(t,e,n,r),Array.isArray(t)?t:s9}function _9(t,e){return t===0&&(t=Ru(t,e)),1|t}function gu(t){return!!(2&t)&&!!(4&t)||!!(2048&t)}function que(t){t=Js(t);for(let e=0;e<t.length;e++){const n=t[e]=Js(t[e]);Array.isArray(n[1])&&(n[1]=s0(n[1]))}return t}function eO(t,e,n,r){let i=0|(t=t.u)[ze];Hf(i),ur(t,i,e,(r==="0"?Number(n)===0:n===r)?void 0:n)}function c0(t,e,n,r,i){Hf(e);var s=!(!(64&e)&&16384&e);const o=(i=b9(t,e,n,i))!==s9;if(s||!o){let a=s=o?0|i[ze]:0;(!o||2&a||gu(a)||4&a&&!(32&a))&&(i=Js(i),a=Ru(a,e),e=ur(t,e,n,i)),a=-13&_9(a,e),a=uf(r?-17&a:16|a,e,!0),a!==s&&$r(i,a)}return i}function Gx(t,e){var n=Ode;return E9(S9(t=t.u),t,0|t[ze],n)===e?e:-1}function S9(t){if(vR)return t[Y1]??(t[Y1]=new Map);if(Y1 in t)return t[Y1];const e=new Map;return Object.defineProperty(t,Y1,{value:e}),e}function Gue(t,e,n,r){const i=S9(t),s=E9(i,t,e,n);return s!==r&&(s&&(e=ur(t,e,s)),i.set(n,r)),e}function E9(t,e,n,r){let i=t.get(r);if(i!=null)return i;i=0;for(let s=0;s<r.length;s++){const o=r[s];Yu(e,n,o)!=null&&(i!==0&&(n=ur(e,n,i)),i=o)}return t.set(r,i),i}function w9(t,e,n,r){let i,s=0|t[ze];if((r=Yu(t,s,n,r))!=null&&r.W===z_)return(e=TR(r))!==r&&ur(t,s,n,e),e.u;if(Array.isArray(r)){const o=0|r[ze];i=2&o?lf(CR(r,o,!1),e,!0):64&o?r:lf(i,e,!0)}else i=lf(void 0,e,!0);return i!==r&&ur(t,s,n,i),i}function Kue(t,e,n,r){let i=0|(t=t.u)[ze];return(e=g9(r=Yu(t,i,n,r),e,!1,i))!==r&&e!=null&&ur(t,i,n,e),e}function zt(t,e,n,r=!1){if((e=Kue(t,e,n,r))==null)return e;if(!(2&(r=0|(t=t.u)[ze]))){const i=TR(e);i!==e&&ur(t,r,n,e=i)}return e}function zue(t,e,n,r,i,s,o){t=t.u;var a=!!(2&e);const c=a?1:i;s=!!s,o&&=!a;var l=0|(i=b9(t,e,r))[ze];if(!(a=!!(4&l))){var d=i,h=e;const m=!!(2&(l=_9(l,e)));m&&(h|=2);let g=!m,y=!0,v=0,w=0;for(;v<d.length;v++){const S=g9(d[v],n,!1,h);if(S instanceof n){if(!m){const R=!!(2&(0|S.u[ze]));g&&=!R,y&&=R}d[w++]=S}}w<v&&(d.length=w),l|=4,l=y?16|l:-17&l,$r(d,l=g?8|l:-9&l),m&&Object.freeze(d)}if(o&&!(8&l||!i.length&&(c===1||c===4&&32&l))){for(gu(l)&&(i=Js(i),l=Ru(l,e),e=ur(t,e,r,i)),n=i,o=l,d=0;d<n.length;d++)(l=n[d])!==(h=TR(l))&&(n[d]=h);o|=8,$r(n,o=n.length?-17&o:16|o),l=o}return c===1||c===4&&32&l?gu(l)||(e=l,(l|=!i.length||16&l&&(!a||32&l)?2:2048)!==e&&$r(i,l),Object.freeze(i)):(c===2&&gu(l)&&($r(i=Js(i),l=uf(l=Ru(l,e),e,s)),e=ur(t,e,r,i)),gu(l)||(r=l,(l=uf(l,e,s))!==r&&$r(i,l))),i}function $u(t,e,n){const r=0|t.u[ze];return zue(t,r,e,n,Fh(),!1,!(2&r))}function Ye(t,e,n,r){return r==null&&(r=void 0),Fn(t,n,r)}function Xy(t,e,n,r){r==null&&(r=void 0);e:{let i=0|(t=t.u)[ze];if(Hf(i),r==null){const s=S9(t);if(E9(s,t,i,n)!==e)break e;s.set(n,0)}else i=Gue(t,i,n,e);ur(t,i,e,r)}}function Ru(t,e){return-2049&(t=32|(2&e?2|t:-3&t))}function uf(t,e,n){return 32&e&&n||(t&=-33),t}function C3(t,e,n,r){const i=0|t.u[ze];Hf(i),t=zue(t,i,n,e,2,!0),r=r??new n,t.push(r),t[ze]=2&(0|r.u[ze])?-9&t[ze]:-17&t[ze]}function fa(t,e){return o0(kv(t,e))}function Ta(t,e){return Iv(kv(t,e))}function Tr(t,e){return Hw(t,e)??0}function Xb(t,e,n){if(n!=null&&typeof n!="boolean")throw t=typeof n,Error(`Expected boolean but got ${t!="object"?t:n?Array.isArray(n)?"array":t:"null"}: ${n}`);Fn(t,e,n)}function sl(t,e,n){if(n!=null){if(typeof n!="number"||!ER(n))throw XL("int32");n|=0}Fn(t,e,n)}function Ve(t,e,n){if(n!=null&&typeof n!="number")throw Error(`Value of float/double field must be a number, found ${typeof n}: ${n}`);Fn(t,e,n)}function T3(t,e,n){{const o=t.u;let a=0|o[ze];if(Hf(a),n==null)ur(o,a,e);else{var r=t=0|n[ze],i=gu(t),s=i||Object.isFrozen(n);for(i||(t=0),s||(n=Js(n),r=0,t=uf(t=Ru(t,a),a,!0),s=!1),t|=21,i=0;i<n.length;i++){const c=n[i],l=jue(c);Object.is(c,l)||(s&&(n=Js(n),r=0,t=uf(t=Ru(t,a),a,!0),s=!1),n[i]=l)}t!==r&&(s&&(n=Js(n),t=uf(t=Ru(t,a),a,!0)),$r(n,t)),ur(o,a,e,n)}}}function RR(t,e,n){Hf(0|t.u[ze]),$h(t,e,Iv,2,!0).push(jue(n))}function Wue(t,e){return Error(`Invalid wire type: ${t} (at position ${e})`)}function C9(){return Error("Failed to read varint, encoding is invalid.")}function Yue(t,e){return Error(`Tried to read past the end of the data ${e} > ${t}`)}function T9(t){if(typeof t=="string")return{buffer:kue(t),N:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),N:!1};if(t.constructor===Uint8Array)return{buffer:t,N:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),N:!1};if(t.constructor===Tu)return{buffer:r9(t)||new Uint8Array(0),N:!0};if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),N:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function R9(t,e){let n,r=0,i=0,s=0;const o=t.h;let a=t.g;do n=o[a++],r|=(127&n)<<s,s+=7;while(s<32&&128&n);for(s>32&&(i|=(127&n)>>4),s=3;s<32&&128&n;s+=7)n=o[a++],i|=(127&n)<<s;if(Qh(t,a),n<128)return e(r>>>0,i>>>0);throw C9()}function I9(t){let e=0,n=t.g;const r=n+10,i=t.h;for(;n<r;){const s=i[n++];if(e|=s,(128&s)==0)return Qh(t,n),!!(127&e)}throw C9()}function If(t){const e=t.h;let n=t.g,r=e[n++],i=127&r;if(128&r&&(r=e[n++],i|=(127&r)<<7,128&r&&(r=e[n++],i|=(127&r)<<14,128&r&&(r=e[n++],i|=(127&r)<<21,128&r&&(r=e[n++],i|=r<<28,128&r&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++])))))throw C9();return Qh(t,n),i}function Bu(t){return If(t)>>>0}function tO(t){var e=t.h;const n=t.g,r=e[n],i=e[n+1],s=e[n+2];return e=e[n+3],Qh(t,t.g+4),(r<<0|i<<8|s<<16|e<<24)>>>0}function nO(t){var e=tO(t);t=2*(e>>31)+1;const n=e>>>23&255;return e&=8388607,n==255?e?NaN:t*(1/0):n==0?1401298464324817e-60*t*e:t*Math.pow(2,n-150)*(e+8388608)}function JWe(t){return If(t)}function Kx(t,e,{ba:n=!1}={}){t.ba=n,e&&(e=T9(e),t.h=e.buffer,t.m=e.N,t.j=0,t.l=t.h.length,t.g=t.j)}function Qh(t,e){if(t.g=e,e>t.l)throw Yue(t.l,e)}function Xue(t,e){if(e<0)throw Error(`Tried to read a negative byte length: ${e}`);const n=t.g,r=n+e;if(r>t.l)throw Yue(e,t.l-n);return t.g=r,n}function Jue(t,e){if(e==0)return yp();var n=Xue(t,e);return t.ba&&t.m?n=t.h.subarray(n,n+e):(t=t.h,n=n===(e=n+e)?new Uint8Array(0):jWe?t.slice(n,e):new Uint8Array(t.subarray(n,e))),n.length==0?yp():new Tu(n,Cv)}Ca.prototype.toJSON=void 0,Ca.prototype.Ia=Oue;var Oz=[];function Que(t){var e=t.g;if(e.g==e.l)return!1;t.l=t.g.g;var n=Bu(t.g);if(e=n>>>3,!((n&=7)>=0&&n<=5))throw Wue(n,t.l);if(e<1)throw Error(`Invalid field number: ${e} (at position ${t.l})`);return t.m=e,t.h=n,!0}function Vw(t){switch(t.h){case 0:t.h!=0?Vw(t):I9(t.g);break;case 1:Qh(t=t.g,t.g+8);break;case 2:if(t.h!=2)Vw(t);else{var e=Bu(t.g);Qh(t=t.g,t.g+e)}break;case 5:Qh(t=t.g,t.g+4);break;case 3:for(e=t.m;;){if(!Que(t))throw Error("Unmatched start-group tag: stream EOF");if(t.h==4){if(t.m!=e)throw Error("Unmatched end-group tag");break}Vw(t)}break;default:throw Wue(t.h,t.l)}}function W_(t,e,n){const r=t.g.l,i=Bu(t.g),s=t.g.g+i;let o=s-r;if(o<=0&&(t.g.l=s,n(e,t,void 0,void 0,void 0),o=s-t.g.g),o)throw Error(`Message parsing ended unexpectedly. Expected to read ${i} bytes, instead read ${i-o} bytes, either the data ended unexpectedly or the message misreported its own length`);return t.g.g=s,t.g.l=r,e}function k9(t){var e=Bu(t.g),n=Xue(t=t.g,e);if(t=t.h,bWe){var r,i=t;(r=jx)||(r=jx=new TextDecoder("utf-8",{fatal:!0})),e=n+e,i=n===0&&e===i.length?i:i.subarray(n,e);try{var s=r.decode(i)}catch(a){if(EE===void 0){try{r.decode(new Uint8Array([128]))}catch{}try{r.decode(new Uint8Array([97])),EE=!0}catch{EE=!1}}throw!EE&&(jx=void 0),a}}else{e=(s=n)+e,n=[];let a,c=null;for(;s<e;){var o=t[s++];o<128?n.push(o):o<224?s>=e?Sh():(a=t[s++],o<194||(192&a)!=128?(s--,Sh()):n.push((31&o)<<6|63&a)):o<240?s>=e-1?Sh():(a=t[s++],(192&a)!=128||o===224&&a<160||o===237&&a>=160||(192&(r=t[s++]))!=128?(s--,Sh()):n.push((15&o)<<12|(63&a)<<6|63&r)):o<=244?s>=e-2?Sh():(a=t[s++],(192&a)!=128||a-144+(o<<28)>>30!=0||(192&(r=t[s++]))!=128||(192&(i=t[s++]))!=128?(s--,Sh()):(o=(7&o)<<18|(63&a)<<12|(63&r)<<6|63&i,o-=65536,n.push(55296+(o>>10&1023),56320+(1023&o)))):Sh(),n.length>=8192&&(c=mz(c,n),n.length=0)}s=mz(c,n)}return s}function Zue(t){const e=Bu(t.g);return Jue(t.g,e)}function IR(t,e,n){var r=Bu(t.g);for(r=t.g.g+r;t.g.g<r;)n.push(e(t.g))}var wE=[];function QWe(t){return t}let Kg;function dc(t,e,n){e.g?e.m(t,e.g,e.h,n):e.m(t,e.h,n)}var He=class{constructor(t,e){this.u=Hue(t,e)}toJSON(){const t=!Kg;try{return t&&(Kg=Bue),ede(this)}finally{t&&(Kg=void 0)}}l(){var t=MYe;return t.g?t.l(this,t.g,t.h,!0):t.l(this,t.h,t.defaultValue,!0)}clone(){const t=this.u;return new this.constructor(CR(t,0|t[ze],!1))}N(){return!!(2&(0|this.u[ze]))}};function ede(t){var e=t.u;{e=(t=Kg(e))!==e;let l=t.length;if(l){var n=t[l-1],r=o9(n);r?l--:n=void 0;var i=t;if(r){e:{var s,o=n,a=!1;if(o)for(let d in o)isNaN(+d)?(s??={})[d]=o[d]:(r=o[d],Array.isArray(r)&&(S3(r)||Ez(r)&&r.size===0)&&(r=null),r==null&&(a=!0),r!=null&&((s??={})[d]=r));if(a||(s=o),s)for(let d in s){a=s;break e}a=null}o=a==null?n!=null:a!==n}for(;l>0&&((s=i[l-1])==null||S3(s)||Ez(s)&&s.size===0);l--)var c=!0;(i!==t||o||c)&&(e?(c||o||a)&&(i.length=l):i=Array.prototype.slice.call(i,0,l),a&&i.push(a)),c=i}else c=t}return c}function Mz(t){return t?/^\d+$/.test(t)?(SR(t),new rO(An,br)):null:ZWe||=new rO(0,0)}He.prototype.W=z_,He.prototype.toString=function(){try{return Kg=QWe,ede(this).toString()}finally{Kg=void 0}};var rO=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let ZWe;function Dz(t){return t?/^-?\d+$/.test(t)?(SR(t),new iO(An,br)):null:eYe||=new iO(0,0)}var iO=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let eYe;function zg(t,e,n){for(;n>0||e>127;)t.g.push(127&e|128),e=(e>>>7|n<<25)>>>0,n>>>=7;t.g.push(e)}function l0(t,e){for(;e>127;)t.g.push(127&e|128),e>>>=7;t.g.push(e)}function kR(t,e){if(e>=0)l0(t,e);else{for(let n=0;n<9;n++)t.g.push(127&e|128),e>>=7;t.g.push(1)}}function Jb(t,e){t.g.push(e>>>0&255),t.g.push(e>>>8&255),t.g.push(e>>>16&255),t.g.push(e>>>24&255)}function xv(t,e){e.length!==0&&(t.l.push(e),t.h+=e.length)}function Lo(t,e,n){l0(t.g,8*e+n)}function x9(t,e){return Lo(t,e,2),e=t.g.end(),xv(t,e),e.push(t.h),e}function A9(t,e){var n=e.pop();for(n=t.h+t.g.length()-n;n>127;)e.push(127&n|128),n>>>=7,t.h++;e.push(n),t.h++}function xR(t,e,n){Lo(t,e,2),l0(t.g,n.length),xv(t,t.g.end()),xv(t,n)}function R3(t,e,n,r){n!=null&&(e=x9(t,e),r(n,t),A9(t,e))}function fc(){const t=class{constructor(){throw Error()}};return Object.setPrototypeOf(t,t.prototype),t}var P9=fc(),tde=fc(),L9=fc(),O9=fc(),nde=fc(),rde=fc(),M9=fc(),ide=fc(),sde=fc(),u0=class{constructor(e,n,r){this.g=e,this.h=n,e=P9,this.l=!!e&&r===e||!1}};function AR(t,e){return new u0(t,e,P9)}function ode(t,e,n,r,i){R3(t,n,ude(e,r),i)}const tYe=AR(function(t,e,n,r,i){return t.h===2&&(W_(t,w9(e,r,n),i),!0)},ode),nYe=AR(function(t,e,n,r,i){return t.h===2&&(W_(t,w9(e,r,n,!0),i),!0)},ode);var PR=Symbol(),D9=Symbol(),Nz=Symbol(),Uz=Symbol();let ade,cde;function Fp(t,e,n,r){var i=r[t];if(i)return i;(i={}).Pa=r,i.V=function(h){switch(typeof h){case"boolean":return Fue||=[0,void 0,!0];case"number":return h>0?void 0:h===0?YWe||=[0,void 0]:[-h,void 0];case"string":return[0,h];case"object":return h}}(r[0]);var s=r[1];let o=1;s&&s.constructor===Object&&(i.ga=s,typeof(s=r[++o])=="function"&&(i.la=!0,ade??=s,cde??=r[o+1],s=r[o+=2]));const a={};for(;s&&Array.isArray(s)&&s.length&&typeof s[0]=="number"&&s[0]>0;){for(var c=0;c<s.length;c++)a[s[c]]=s;s=r[++o]}for(c=1;s!==void 0;){let h;typeof s=="number"&&(c+=s,s=r[++o]);var l=void 0;if(s instanceof u0?h=s:(h=tYe,o--),h?.l){s=r[++o],l=r;var d=o;typeof s=="function"&&(s=s(),l[d]=s),l=s}for(d=c+1,typeof(s=r[++o])=="number"&&s<0&&(d-=s,s=r[++o]);c<d;c++){const m=a[c];l?n(i,c,h,l,m):e(i,c,h,m)}}return r[t]=i}function lde(t){return Array.isArray(t)?t[0]instanceof u0?t:[nYe,t]:[t,void 0]}function ude(t,e){return t instanceof He?t.u:Array.isArray(t)?lf(t,e,!1):void 0}function N9(t,e,n,r){const i=n.g;t[e]=r?(s,o,a)=>i(s,o,a,r):i}function U9(t,e,n,r,i){const s=n.g;let o,a;t[e]=(c,l,d)=>s(c,l,d,a||=Fp(D9,N9,U9,r).V,o||=j9(r),i)}function j9(t){let e=t[Nz];if(e!=null)return e;const n=Fp(D9,N9,U9,t);return e=n.la?(r,i)=>ade(r,i,n):(r,i)=>{const s=0|r[ze];for(;Que(i)&&i.h!=4;){var o=i.m,a=n[o];if(a==null){var c=n.ga;c&&(c=c[o])&&(c=rYe(c))!=null&&(a=n[o]=c)}a!=null&&a(i,r,o)||(o=(a=i).l,Vw(a),a.fa?a=void 0:(c=a.g.g-o,a.g.g=o,a=Jue(a.g,c)),o=r,a&&((c=o[Tv])?c.push(a):o[Tv]=[a]))}return 16384&s&&s0(r),!0},t[Nz]=e}function rYe(t){const e=(t=lde(t))[0].g;if(t=t[1]){const n=j9(t),r=Fp(D9,N9,U9,t).V;return(i,s,o)=>e(i,s,o,r,n)}return e}function LR(t,e,n){t[e]=n.h}function OR(t,e,n,r){let i,s;const o=n.h;t[e]=(a,c,l)=>o(a,c,l,s||=Fp(PR,LR,OR,r).V,i||=dde(r))}function dde(t){let e=t[Uz];if(!e){const n=Fp(PR,LR,OR,t);e=(r,i)=>fde(r,i,n),t[Uz]=e}return e}function fde(t,e,n){for(var r=0|t[ze],i=512&r?0:-1,s=t.length,o=512&r?1:0,a=s+(256&r?-1:0);o<a;o++){const c=t[o];if(c==null)continue;const l=o-i,d=jz(n,l);d&&d(e,c,l)}if(256&r){r=t[s-1];for(const c in r)i=+c,Number.isNaN(i)||(s=r[i])!=null&&(a=jz(n,i))&&a(e,s,i)}if(t=c9(t))for(xv(e,e.g.end()),n=0;n<t.length;n++)xv(e,r9(t[n])||new Uint8Array(0))}function jz(t,e){var n=t[e];if(n)return n;if((n=t.ga)&&(n=n[e])){var r=(n=lde(n))[0].h;if(n=n[1]){const i=dde(n),s=Fp(PR,LR,OR,n).V;n=t.la?cde(s,i):(o,a,c)=>r(o,a,c,s,i)}else n=r;return t[e]=n}}function d0(t,e){if(Array.isArray(e)){var n=0|e[ze];if(4&n)return e;for(var r=0,i=0;r<e.length;r++){const s=t(e[r]);s!=null&&(e[i++]=s)}return i<r&&(e.length=i),$r(e,-12289&(5|n)),2&n&&Object.freeze(e),e}}function Ts(t,e,n){return new u0(t,e,n)}function f0(t,e,n){return new u0(t,e,n)}function Rs(t,e,n){ur(t,0|t[ze],e,n)}var iYe=AR(function(t,e,n,r,i){return t.h===2&&(t=W_(t,lf([void 0,void 0],r,!0),i),Hf(r=0|e[ze]),(i=Yu(e,r,n))instanceof Ca?(2&i.L)!=0?((i=i.X()).push(t),ur(e,r,n,i)):i.Na(t):Array.isArray(i)?(2&(0|i[ze])&&ur(e,r,n,i=que(i)),i.push(t)):ur(e,r,n,[t]),!0)},function(t,e,n,r,i){if(e instanceof Ca)e.forEach((s,o)=>{R3(t,n,lf([o,s],r,!1),i)});else if(Array.isArray(e))for(let s=0;s<e.length;s++){const o=e[s];Array.isArray(o)&&R3(t,n,lf(o,r,!1),i)}});function hde(t,e,n){if(e=function(r){if(r==null)return r;const i=typeof r;if(i==="bigint")return String(h9(64,r));if(wR(r)){if(i==="string")return m9(r);if(i==="number")return p9(r)}}(e),e!=null&&(typeof e=="string"&&Dz(e),e!=null))switch(Lo(t,n,0),typeof e){case"number":t=t.g,Rv(e),zg(t,An,br);break;case"bigint":n=BigInt.asUintN(64,e),n=new iO(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),zg(t.g,n.h,n.g);break;default:n=Dz(e),zg(t.g,n.h,n.g)}}function pde(t,e,n){(e=o0(e))!=null&&e!=null&&(Lo(t,n,0),kR(t.g,e))}function mde(t,e,n){(e=Nue(e))!=null&&(Lo(t,n,0),t.g.g.push(e?1:0))}function gde(t,e,n){(e=Iv(e))!=null&&xR(t,n,wue(e))}function vde(t,e,n,r,i){R3(t,n,ude(e,r),i)}function yde(t,e,n){(e=e==null||typeof e=="string"||G_(e)||e instanceof Tu?e:void 0)!=null&&xR(t,n,T9(e).buffer)}function bde(t,e,n){return(t.h===5||t.h===2)&&(e=c0(e,0|e[ze],n,!1,!1),t.h==2?IR(t,nO,e):e.push(nO(t.g)),!0)}var tu=Ts(function(t,e,n){if(t.h!==1)return!1;var r=t.g;t=tO(r);const i=tO(r);r=2*(i>>31)+1;const s=i>>>20&2047;return t=4294967296*(1048575&i)+t,Rs(e,n,s==2047?t?NaN:r*(1/0):s==0?5e-324*r*t:r*Math.pow(2,s-1075)*(t+4503599627370496)),!0},function(t,e,n){(e=Vf(e))!=null&&(Lo(t,n,1),t=t.g,(n=Due||=new DataView(new ArrayBuffer(8))).setFloat64(0,+e,!0),An=n.getUint32(0,!0),br=n.getUint32(4,!0),Jb(t,An),Jb(t,br))},fc()),Hr=Ts(function(t,e,n){return t.h===5&&(Rs(e,n,nO(t.g)),!0)},function(t,e,n){(e=Vf(e))!=null&&(Lo(t,n,5),t=t.g,l9(e),Jb(t,An))},M9),sYe=f0(bde,function(t,e,n){if((e=d0(Vf,e))!=null)for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];s!=null&&(Lo(r,i,5),r=r.g,l9(s),Jb(r,An))}},M9),F9=f0(bde,function(t,e,n){if((e=d0(Vf,e))!=null&&e.length){Lo(t,n,2),l0(t.g,4*e.length);for(let r=0;r<e.length;r++)n=t.g,l9(e[r]),Jb(n,An)}},M9),kf=Ts(function(t,e,n){return t.h===0&&(Rs(e,n,R9(t.g,d9)),!0)},hde,rde),zx=Ts(function(t,e,n){return t.h===0&&(Rs(e,n,(t=R9(t.g,d9))===0?void 0:t),!0)},hde,rde),oYe=Ts(function(t,e,n){return t.h===0&&(Rs(e,n,R9(t.g,u9)),!0)},function(t,e,n){if((e=BWe(e))!=null&&(typeof e=="string"&&Mz(e),e!=null))switch(Lo(t,n,0),typeof e){case"number":t=t.g,Rv(e),zg(t,An,br);break;case"bigint":n=BigInt.asUintN(64,e),n=new rO(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),zg(t.g,n.h,n.g);break;default:n=Mz(e),zg(t.g,n.h,n.g)}},fc()),Er=Ts(function(t,e,n){return t.h===0&&(Rs(e,n,If(t.g)),!0)},pde,O9),MR=f0(function(t,e,n){return(t.h===0||t.h===2)&&(e=c0(e,0|e[ze],n,!1,!1),t.h==2?IR(t,If,e):e.push(If(t.g)),!0)},function(t,e,n){if((e=d0(o0,e))!=null&&e.length){n=x9(t,n);for(let r=0;r<e.length;r++)kR(t.g,e[r]);A9(t,n)}},O9),bg=Ts(function(t,e,n){return t.h===0&&(Rs(e,n,(t=If(t.g))===0?void 0:t),!0)},pde,O9),er=Ts(function(t,e,n){return t.h===0&&(Rs(e,n,I9(t.g)),!0)},mde,tde),Wg=Ts(function(t,e,n){return t.h===0&&(Rs(e,n,(t=I9(t.g))===!1?void 0:t),!0)},mde,tde),Qi=f0(function(t,e,n){return t.h===2&&(t=k9(t),c0(e,0|e[ze],n,!1).push(t),!0)},function(t,e,n){if((e=d0(Iv,e))!=null)for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];s!=null&&xR(r,i,wue(s))}},L9),Hd=Ts(function(t,e,n){return t.h===2&&(Rs(e,n,(t=k9(t))===""?void 0:t),!0)},gde,L9),fn=Ts(function(t,e,n){return t.h===2&&(Rs(e,n,k9(t)),!0)},gde,L9),ni=function(t,e,n=P9){return new u0(t,e,n)}(function(t,e,n,r,i){return t.h===2&&(r=lf(void 0,r,!0),c0(e,0|e[ze],n,!0).push(r),W_(t,r,i),!0)},function(t,e,n,r,i){if(Array.isArray(e))for(let s=0;s<e.length;s++)vde(t,e[s],n,r,i)}),gn=AR(function(t,e,n,r,i,s){return t.h===2&&(Gue(e,0|e[ze],s,n),W_(t,e=w9(e,r,n),i),!0)},vde),_de=Ts(function(t,e,n){return t.h===2&&(Rs(e,n,Zue(t)),!0)},yde,ide),aYe=f0(function(t,e,n){return(t.h===0||t.h===2)&&(e=c0(e,0|e[ze],n,!1,!1),t.h==2?IR(t,Bu,e):e.push(Bu(t.g)),!0)},function(t,e,n){if((e=d0(Uue,e))!=null)for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];s!=null&&(Lo(r,i,0),l0(r.g,s))}},nde),cYe=Ts(function(t,e,n){return t.h===0&&(Rs(e,n,(t=Bu(t.g))===0?void 0:t),!0)},function(t,e,n){(e=Uue(e))!=null&&e!=null&&(Lo(t,n,0),l0(t.g,e))},nde),Ra=Ts(function(t,e,n){return t.h===0&&(Rs(e,n,If(t.g)),!0)},function(t,e,n){(e=o0(e))!=null&&(e=parseInt(e,10),Lo(t,n,0),kR(t.g,e))},sde);class lYe{constructor(e,n){this.h=e,this.g=n,this.l=zt,this.m=Ye,this.defaultValue=void 0}}function hc(t,e){return new lYe(t,e)}function qf(t,e){return(n,r)=>{if(wE.length){const s=wE.pop();s.o(r),Kx(s.g,n,r),n=s}else n=new class{constructor(s,o){if(Oz.length){const a=Oz.pop();Kx(a,s,o),s=a}else s=new class{constructor(a,c){this.h=null,this.m=!1,this.g=this.l=this.j=0,Kx(this,a,c)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ba=!1}}(s,o);this.g=s,this.l=this.g.g,this.h=this.m=-1,this.o(o)}o({fa:s=!1}={}){this.fa=s}}(n,r);try{const s=new t,o=s.u;j9(e)(o,n);var i=s}finally{n.g.clear(),n.m=-1,n.h=-1,wE.length<100&&wE.push(n)}return i}}function DR(t){return function(){const e=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const o=this.g;return this.g=[],o}}}};fde(this.u,e,Fp(PR,LR,OR,t)),xv(e,e.g.end());const n=new Uint8Array(e.h),r=e.l,i=r.length;let s=0;for(let o=0;o<i;o++){const a=r[o];n.set(a,s),s+=a.length}return e.l=[n],n}}var Fz=class extends He{constructor(t){super(t)}},$z=[0,Hd,Ts(function(t,e,n){return t.h===2&&(Rs(e,n,(t=Zue(t))===yp()?void 0:t),!0)},function(t,e,n){if(e!=null){if(e instanceof He){const r=e.Ra;return void(r&&(e=r(e),e!=null&&xR(t,n,T9(e).buffer)))}if(Array.isArray(e))return}yde(t,e,n)},ide)];let Wx,Bz=globalThis.trustedTypes;function Hz(t){Wx===void 0&&(Wx=function(){let n=null;if(!Bz)return n;try{const r=i=>i;n=Bz.createPolicy("goog#html",{createHTML:r,createScript:r,createScriptURL:r})}catch{}return n}());var e=Wx;return new class{constructor(n){this.g=n}toString(){return this.g+""}}(e?e.createScriptURL(t):t)}function uYe(t,...e){if(e.length===0)return Hz(t[0]);let n=t[0];for(let r=0;r<e.length;r++)n+=encodeURIComponent(e[r])+t[r+1];return Hz(n)}var Sde=[0,Er,Ra,er,-1,MR,Ra,-1],dYe=class extends He{constructor(t){super(t)}},Ede=[0,er,fn,er,Ra,-1,f0(function(t,e,n){return(t.h===0||t.h===2)&&(e=c0(e,0|e[ze],n,!1,!1),t.h==2?IR(t,JWe,e):e.push(If(t.g)),!0)},function(t,e,n){if((e=d0(o0,e))!=null&&e.length){n=x9(t,n);for(let r=0;r<e.length;r++)kR(t.g,e[r]);A9(t,n)}},sde),fn,-1,[0,er,-1],Ra,er,-1],wde=[0,fn,-2],Vz=class extends He{constructor(t){super(t)}},Cde=[0],Tde=[0,Er,er,1,er,-3],xo=class extends He{constructor(t){super(t,2)}},Vr={};Vr[336783863]=[0,fn,er,-1,Er,[0,[1,2,3,4,5,6,7,8],gn,Cde,gn,Ede,gn,wde,gn,Tde,gn,Sde,gn,[0,fn,-2],gn,[0,fn,Ra],gn,[0,Ra,fn]],[0,fn],er,[0,[1,3],[2,4],gn,[0,MR],-1,gn,[0,Qi],-1,ni,[0,fn,-1]],fn];var qz=[0,zx,-1,Wg,-3,zx,MR,Hd,bg,zx,-1,Wg,bg,Wg,-2,Hd];function Oo(t,e){eO(t,2,a0(e),"")}function $n(t,e){RR(t,3,e)}function $t(t,e){RR(t,4,e)}var Ss=class extends He{constructor(t){super(t,500)}o(t){return Ye(this,0,7,t)}},Jy=[-1,{}],Gz=[0,fn,1,Jy],Kz=[0,fn,Qi,Jy];function Mo(t,e){C3(t,1,Ss,e)}function zn(t,e){RR(t,10,e)}function Zt(t,e){RR(t,15,e)}var ro=class extends He{constructor(t){super(t,500)}o(t){return Ye(this,0,1001,t)}},Rde=[-500,ni,[-500,Hd,-1,Qi,-3,[-2,Vr,er],ni,$z,bg,-1,Gz,Kz,ni,[0,Hd,Wg],Hd,qz,bg,Qi,987,Qi],4,ni,[-500,fn,-1,[-1,{}],998,fn],ni,[-500,fn,Qi,-1,[-2,{},er],997,Qi,-1],bg,ni,[-500,fn,Qi,Jy,998,Qi],Qi,bg,Gz,Kz,ni,[0,Hd,-1,Jy],Qi,-2,qz,Hd,-1,Wg,[0,Wg,cYe],978,Jy,ni,$z];ro.prototype.g=DR(Rde);var fYe=qf(ro,Rde),hYe=class extends He{constructor(t){super(t)}},Ide=class extends He{constructor(e){super(e)}g(){return $u(this,hYe,1)}},kde=[0,ni,[0,Er,Hr,fn,-1]],NR=qf(Ide,kde),pYe=class extends He{constructor(t){super(t)}},mYe=class extends He{constructor(e){super(e)}},Yx=class extends He{constructor(t){super(t)}h(){return zt(this,pYe,2)}g(){return $u(this,mYe,5)}},xde=qf(class extends He{constructor(t){super(t)}},[0,Qi,MR,F9,[0,Ra,[0,Er,-3],[0,Hr,-3],[0,Er,-1,[0,ni,[0,Er,-2]]],ni,[0,Hr,-1,fn,Hr]],fn,-1,kf,ni,[0,Er,Hr],Qi,kf]),Ade=class extends He{constructor(t){super(t)}},Yg=qf(class extends He{constructor(t){super(t)}},[0,ni,[0,Hr,-4]]),Pde=class extends He{constructor(t){super(t)}},Y_=qf(class extends He{constructor(t){super(t)}},[0,ni,[0,Hr,-4]]),gYe=class extends He{constructor(t){super(t)}},vYe=[0,Er,-1,F9,Ra],Lde=class extends He{constructor(t){super(t)}};Lde.prototype.g=DR([0,Hr,-4,kf]);var yYe=class extends He{constructor(t){super(t)}},bYe=qf(class extends He{constructor(t){super(t)}},[0,ni,[0,1,Er,fn,kde],kf]),zz=class extends He{constructor(t){super(t)}},_Ye=class extends He{constructor(t){super(t)}oa(){const t=Vue(this);return t??yp()}},SYe=class extends He{constructor(t){super(t)}},Ode=[1,2],EYe=qf(class extends He{constructor(t){super(t)}},[0,ni,[0,Ode,gn,[0,F9],gn,[0,_de],Er,fn],kf]),$9=class extends He{constructor(t){super(t)}},Mde=[0,fn,Er,Hr,Qi,-1],Wz=class extends He{constructor(t){super(t)}},wYe=[0,er,-1],Yz=class extends He{constructor(t){super(t)}},qw=[1,2,3,4,5],I3=class extends He{constructor(t){super(t)}g(){return Vue(this)!=null}h(){return Ta(this,2)!=null}},rr=class extends He{constructor(t){super(t)}g(){return Nue(kv(this,2))??!1}},Dde=[0,_de,fn,[0,Er,kf,-1],[0,oYe,kf]],xr=[0,Dde,er,[0,qw,gn,Tde,gn,Ede,gn,Sde,gn,Cde,gn,wde],Ra],UR=class extends He{constructor(t){super(t)}},B9=[0,xr,Hr,-1,Er],CYe=hc(502141897,UR);Vr[502141897]=B9;var TYe=qf(class extends He{constructor(t){super(t)}},[0,[0,Ra,-1,sYe,aYe],vYe]),Nde=class extends He{constructor(t){super(t)}},Ude=class extends He{constructor(t){super(t)}},H9=[0,xr,Hr,[0,xr],er],jde=[0,xr,B9,H9,Hr,[0,[0,Dde]]],RYe=hc(508968150,Ude);Vr[508968150]=jde,Vr[508968149]=H9;var Fde=class extends He{constructor(t){super(t)}},IYe=hc(513916220,Fde);Vr[513916220]=[0,xr,jde,Er];var Vm=class extends He{constructor(t){super(t)}h(){return zt(this,$9,2)}g(){Fn(this,2)}},$de=[0,xr,Mde];Vr[478825465]=$de;var kYe=class extends He{constructor(t){super(t)}},Bde=class extends He{constructor(e){super(e)}},V9=class extends He{constructor(e){super(e)}},q9=class extends He{constructor(t){super(t)}},Hde=class extends He{constructor(t){super(t)}},Xz=[0,xr,[0,xr],$de,-1],Vde=[0,xr,Hr,Er],G9=[0,xr,Hr],qde=[0,xr,Vde,G9,Hr],xYe=hc(479097054,Hde);Vr[479097054]=[0,xr,qde,Xz],Vr[463370452]=Xz,Vr[464864288]=Vde;var AYe=hc(462713202,q9);Vr[462713202]=qde,Vr[474472470]=G9;var PYe=class extends He{constructor(t){super(t)}},Gde=class extends He{constructor(t){super(t)}},Kde=class extends He{constructor(t){super(t)}},zde=class extends He{constructor(t){super(t)}},K9=[0,xr,Hr,-1,Er],sO=[0,xr,Hr,er];zde.prototype.g=DR([0,xr,G9,[0,xr],B9,H9,K9,sO]);var Wde=class extends He{constructor(t){super(t)}},LYe=hc(456383383,Wde);Vr[456383383]=[0,xr,Mde];var Yde=class extends He{constructor(t){super(t)}},OYe=hc(476348187,Yde);Vr[476348187]=[0,xr,wYe];var Xde=class extends He{constructor(t){super(t)}},Jz=class extends He{constructor(t){super(t)}},Jde=[0,Ra,-1],MYe=hc(458105876,class extends He{constructor(t){super(t)}g(){var t=this.u;const e=0|t[ze],n=2&e;return t=function(r,i,s){var o=Jz;const a=2&i;let c=!1;if(s==null){if(a)return Lz();s=[]}else if(s.constructor===Ca){if((2&s.L)==0||a)return s;s=s.X()}else Array.isArray(s)?c=!!(2&(0|s[ze])):s=[];if(a){if(!s.length)return Lz();c||(c=!0,s0(s))}else c&&(c=!1,s=que(s));return c||(64&(0|s[ze])?s[ze]&=-33:32&i&&yR(s,32)),ur(r,i,2,o=new Ca(s,o,HWe,void 0)),o}(t,e,Yu(t,e,2)),!n&&Jz&&(t.ra=!0),t}});Vr[458105876]=[0,Jde,iYe,[!0,kf,[0,fn,-1,Qi]]];var z9=class extends He{constructor(t){super(t)}},Qde=hc(458105758,z9);Vr[458105758]=[0,xr,fn,Jde];var Zde=class extends He{constructor(t){super(t)}},DYe=hc(443442058,Zde);Vr[443442058]=[0,xr,fn,Er,Hr,Qi,-1,er,Hr],Vr[514774813]=K9;var efe=class extends He{constructor(t){super(t)}},NYe=hc(516587230,efe);function oO(t,e){return e=e?e.clone():new $9,t.displayNamesLocale!==void 0?Fn(e,1,a0(t.displayNamesLocale)):t.displayNamesLocale===void 0&&Fn(e,1),t.maxResults!==void 0?sl(e,2,t.maxResults):"maxResults"in t&&Fn(e,2),t.scoreThreshold!==void 0?Ve(e,3,t.scoreThreshold):"scoreThreshold"in t&&Fn(e,3),t.categoryAllowlist!==void 0?T3(e,4,t.categoryAllowlist):"categoryAllowlist"in t&&Fn(e,4),t.categoryDenylist!==void 0?T3(e,5,t.categoryDenylist):"categoryDenylist"in t&&Fn(e,5),e}function W9(t,e=-1,n=""){return{categories:t.map(r=>({index:fa(r,1)??0??-1,score:Tr(r,2)??0,categoryName:Ta(r,3)??""??"",displayName:Ta(r,4)??""??""})),headIndex:e,headName:n}}function tfe(t){var e=$h(t,3,Vf,Fh()),n=$h(t,2,o0,Fh()),r=$h(t,1,Iv,Fh()),i=$h(t,9,Iv,Fh());const s={categories:[],keypoints:[]};for(let o=0;o<e.length;o++)s.categories.push({score:e[o],index:n[o]??-1,categoryName:r[o]??"",displayName:i[o]??""});if((e=zt(t,Yx,4)?.h())&&(s.boundingBox={originX:fa(e,1)??0,originY:fa(e,2)??0,width:fa(e,3)??0,height:fa(e,4)??0,angle:0}),zt(t,Yx,4)?.g().length)for(const o of zt(t,Yx,4).g())s.keypoints.push({x:Hw(o,1)??0,y:Hw(o,2)??0,score:Hw(o,4)??0,label:Ta(o,3)??""});return s}function jR(t){const e=[];for(const n of $u(t,Pde,1))e.push({x:Tr(n,1)??0,y:Tr(n,2)??0,z:Tr(n,3)??0,visibility:Tr(n,4)??0});return e}function Qy(t){const e=[];for(const n of $u(t,Ade,1))e.push({x:Tr(n,1)??0,y:Tr(n,2)??0,z:Tr(n,3)??0,visibility:Tr(n,4)??0});return e}function Qz(t){return Array.from(t,e=>e>127?e-256:e)}function Zz(t,e){if(t.length!==e.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${t.length} vs. ${e.length}).`);let n=0,r=0,i=0;for(let s=0;s<t.length;s++)n+=t[s]*e[s],r+=t[s]*t[s],i+=e[s]*e[s];if(r<=0||i<=0)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return n/Math.sqrt(r*i)}let CE;Vr[516587230]=[0,xr,K9,sO,Hr],Vr[518928384]=sO;const UYe=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function nfe(){if(CE===void 0)try{await WebAssembly.instantiate(UYe),CE=!0}catch{CE=!1}return CE}async function X1(t,e=uYe``){const n=await nfe()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${e}/${t}_${n}.js`,wasmBinaryPath:`${e}/${t}_${n}.wasm`}}var Ph=class{};function rfe(){var t=navigator;return typeof OffscreenCanvas<"u"&&(!function(e=navigator){return(e=e.userAgent).includes("Safari")&&!e.includes("Chrome")}(t)||!!((t=t.userAgent.match(/Version\/([\d]+).*Safari/))&&t.length>=1&&Number(t[1])>=17))}async function eW(t){if(typeof importScripts!="function"){const e=document.createElement("script");return e.src=t.toString(),e.crossOrigin="anonymous",new Promise((n,r)=>{e.addEventListener("load",()=>{n()},!1),e.addEventListener("error",i=>{r(i)},!1),document.body.appendChild(e)})}importScripts(t.toString())}function ife(t){return t.videoWidth!==void 0?[t.videoWidth,t.videoHeight]:t.naturalWidth!==void 0?[t.naturalWidth,t.naturalHeight]:t.displayWidth!==void 0?[t.displayWidth,t.displayHeight]:[t.width,t.height]}function Ke(t,e,n){t.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),n(e=t.i.stringToNewUTF8(e)),t.i._free(e)}function tW(t,e,n){if(!t.i.canvas)throw Error("No OpenGL canvas configured.");if(n?t.i._bindTextureToStream(n):t.i._bindTextureToCanvas(),!(n=t.i.canvas.getContext("webgl2")||t.i.canvas.getContext("webgl")))throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);const[r,i]=ife(e);return!t.l||r===t.i.canvas.width&&i===t.i.canvas.height||(t.i.canvas.width=r,t.i.canvas.height=i),[r,i]}function nW(t,e,n){t.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const r=new Uint32Array(e.length);for(let i=0;i<e.length;i++)r[i]=t.i.stringToNewUTF8(e[i]);e=t.i._malloc(4*r.length),t.i.HEAPU32.set(r,e>>2),n(e);for(const i of r)t.i._free(i);t.i._free(e)}function Ic(t,e,n){t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=n}function Cd(t,e,n){let r=[];t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=(i,s,o)=>{s?(n(r,o),r=[]):r.push(i)}}Ph.forVisionTasks=function(t){return X1("vision",t)},Ph.forTextTasks=function(t){return X1("text",t)},Ph.forGenAiExperimentalTasks=function(t){return X1("genai_experimental",t)},Ph.forGenAiTasks=function(t){return X1("genai",t)},Ph.forAudioTasks=function(t){return X1("audio",t)},Ph.isSimdSupported=function(){return nfe()};async function jYe(t,e,n,r){return t=await(async(i,s,o,a,c)=>{if(s&&await eW(s),!self.ModuleFactory||o&&(await eW(o),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&c&&((s=self.Module).locateFile=c.locateFile,c.mainScriptUrlOrBlob&&(s.mainScriptUrlOrBlob=c.mainScriptUrlOrBlob)),c=await self.ModuleFactory(self.Module||c),self.ModuleFactory=self.Module=void 0,new i(c,a)})(t,n.wasmLoaderPath,n.assetLoaderPath,e,{locateFile:i=>i.endsWith(".wasm")?n.wasmBinaryPath.toString():n.assetBinaryPath&&i.endsWith(".data")?n.assetBinaryPath.toString():i}),await t.o(r),t}function Xx(t,e){const n=zt(t.baseOptions,I3,1)||new I3;typeof e=="string"?(Fn(n,2,a0(e)),Fn(n,1)):e instanceof Uint8Array&&(Fn(n,1,a9(e,!1)),Fn(n,2)),Ye(t.baseOptions,0,1,n)}function rW(t){try{const e=t.G.length;if(e===1)throw Error(t.G[0].message);if(e>1)throw Error("Encountered multiple errors: "+t.G.map(n=>n.message).join(", "))}finally{t.G=[]}}function je(t,e){t.B=Math.max(t.B,e)}function FR(t,e){t.A=new Ss,Oo(t.A,"PassThroughCalculator"),$n(t.A,"free_memory"),$t(t.A,"free_memory_unused_out"),zn(e,"free_memory"),Mo(e,t.A)}function Av(t,e){$n(t.A,e),$t(t.A,e+"_unused_out")}function $R(t){t.g.addBoolToStream(!0,"free_memory",t.B)}var Gw=class{constructor(t){this.g=t,this.G=[],this.B=0,this.g.setAutoRenderToScreen(!1)}l(t,e=!0){if(e){const n=t.baseOptions||{};if(t.baseOptions?.modelAssetBuffer&&t.baseOptions?.modelAssetPath)throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!(zt(this.baseOptions,I3,1)?.g()||zt(this.baseOptions,I3,1)?.h()||t.baseOptions?.modelAssetBuffer||t.baseOptions?.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if(function(r,i){let s=zt(r.baseOptions,Yz,3);if(!s){var o=s=new Yz,a=new Vz;Xy(o,4,qw,a)}"delegate"in i&&(i.delegate==="GPU"?(i=s,o=new dYe,Xy(i,2,qw,o)):(i=s,o=new Vz,Xy(i,4,qw,o))),Ye(r.baseOptions,0,3,s)}(this,n),n.modelAssetPath)return fetch(n.modelAssetPath.toString()).then(r=>{if(r.ok)return r.arrayBuffer();throw Error(`Failed to fetch model: ${n.modelAssetPath} (${r.status})`)}).then(r=>{try{this.g.i.FS_unlink("/model.dat")}catch{}this.g.i.FS_createDataFile("/","model.dat",new Uint8Array(r),!0,!1,!1),Xx(this,"/model.dat"),this.m(),this.I()});if(n.modelAssetBuffer instanceof Uint8Array)Xx(this,n.modelAssetBuffer);else if(n.modelAssetBuffer)return async function(r){const i=[];for(var s=0;;){const{done:o,value:a}=await r.read();if(o)break;i.push(a),s+=a.length}if(i.length===0)return new Uint8Array(0);if(i.length===1)return i[0];r=new Uint8Array(s),s=0;for(const o of i)r.set(o,s),s+=o.length;return r}(n.modelAssetBuffer).then(r=>{Xx(this,r),this.m(),this.I()})}return this.m(),this.I(),Promise.resolve()}I(){}da(){let t;if(this.g.da(e=>{t=fYe(e)}),!t)throw Error("Failed to retrieve CalculatorGraphConfig");return t}setGraph(t,e){this.g.attachErrorListener((n,r)=>{this.G.push(Error(r))}),this.g.La(),this.g.setGraph(t,e),this.A=void 0,rW(this)}finishProcessing(){this.g.finishProcessing(),rW(this)}close(){this.A=void 0,this.g.closeGraph()}};function Iu(t,e){if(!t)throw Error(`Unable to obtain required WebGL resource: ${e}`);return t}Gw.prototype.close=Gw.prototype.close,function(t,e){t=t.split(".");var n,r=vp;for((t[0]in r)||r.execScript===void 0||r.execScript("var "+t[0]);t.length&&(n=t.shift());)t.length||e===void 0?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=e}("TaskRunner",Gw);class FYe{constructor(e,n,r,i){this.g=e,this.h=n,this.m=r,this.l=i}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function iW(t,e,n){const r=t.g;if(n=Iu(r.createShader(n),"Failed to create WebGL shader"),r.shaderSource(n,e),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw Error(`Could not compile WebGL shader: ${r.getShaderInfoLog(n)}`);return r.attachShader(t.h,n),n}function sW(t,e){const n=t.g,r=Iu(n.createVertexArray(),"Failed to create vertex array");n.bindVertexArray(r);const i=Iu(n.createBuffer(),"Failed to create buffer");n.bindBuffer(n.ARRAY_BUFFER,i),n.enableVertexAttribArray(t.O),n.vertexAttribPointer(t.O,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW);const s=Iu(n.createBuffer(),"Failed to create buffer");return n.bindBuffer(n.ARRAY_BUFFER,s),n.enableVertexAttribArray(t.I),n.vertexAttribPointer(t.I,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array(e?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindVertexArray(null),new FYe(n,r,i,s)}function Y9(t,e){if(t.g){if(e!==t.g)throw Error("Cannot change GL context once initialized")}else t.g=e}function X9(t,e,n,r){return Y9(t,e),t.h||(t.m(),t.C()),n?(t.s||(t.s=sW(t,!0)),n=t.s):(t.v||(t.v=sW(t,!1)),n=t.v),e.useProgram(t.h),n.bind(),t.l(),t=r(),n.g.bindVertexArray(null),t}function BR(t,e,n){return Y9(t,e),t=Iu(e.createTexture(),"Failed to create texture"),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n??e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n??e.LINEAR),e.bindTexture(e.TEXTURE_2D,null),t}function HR(t,e,n){Y9(t,e),t.A||(t.A=Iu(e.createFramebuffer(),"Failed to create framebuffe.")),e.bindFramebuffer(e.FRAMEBUFFER,t.A),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}function J9(t){t.g?.bindFramebuffer(t.g.FRAMEBUFFER,null)}var Q9=class{G(){return`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D inputTexture;
  void main() {
    gl_FragColor = texture2D(inputTexture, vTex);
  }
 `}m(){const t=this.g;if(this.h=Iu(t.createProgram(),"Failed to create WebGL program"),this.aa=iW(this,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,t.VERTEX_SHADER),this.Z=iW(this,this.G(),t.FRAGMENT_SHADER),t.linkProgram(this.h),!t.getProgramParameter(this.h,t.LINK_STATUS))throw Error(`Error during program linking: ${t.getProgramInfoLog(this.h)}`);this.O=t.getAttribLocation(this.h,"aVertex"),this.I=t.getAttribLocation(this.h,"aTex")}C(){}l(){}close(){if(this.h){const t=this.g;t.deleteProgram(this.h),t.deleteShader(this.aa),t.deleteShader(this.Z)}this.A&&this.g.deleteFramebuffer(this.A),this.v&&this.v.close(),this.s&&this.s.close()}};function fu(t,e){switch(e){case 0:return t.g.find(n=>n instanceof Uint8Array);case 1:return t.g.find(n=>n instanceof Float32Array);case 2:return t.g.find(n=>typeof WebGLTexture<"u"&&n instanceof WebGLTexture);default:throw Error(`Type is not supported: ${e}`)}}function aO(t){var e=fu(t,1);if(!e){if(e=fu(t,0))e=new Float32Array(e).map(r=>r/255);else{e=new Float32Array(t.width*t.height);const r=Pv(t);var n=Z9(t);if(HR(n,r,sfe(t)),"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"document"in self&&"ontouchend"in self.document){n=new Float32Array(t.width*t.height*4),r.readPixels(0,0,t.width,t.height,r.RGBA,r.FLOAT,n);for(let i=0,s=0;i<e.length;++i,s+=4)e[i]=n[s]}else r.readPixels(0,0,t.width,t.height,r.RED,r.FLOAT,e)}t.g.push(e)}return e}function sfe(t){let e=fu(t,2);if(!e){const n=Pv(t);e=afe(t);const r=aO(t),i=ofe(t);n.texImage2D(n.TEXTURE_2D,0,i,t.width,t.height,0,n.RED,n.FLOAT,r),cO(t)}return e}function Pv(t){if(!t.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return t.h||(t.h=Iu(t.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),t.h}function ofe(t){if(t=Pv(t),!TE)if(t.getExtension("EXT_color_buffer_float")&&t.getExtension("OES_texture_float_linear")&&t.getExtension("EXT_float_blend"))TE=t.R32F;else{if(!t.getExtension("EXT_color_buffer_half_float"))throw Error("GPU does not fully support 4-channel float32 or float16 formats");TE=t.R16F}return TE}function Z9(t){return t.l||(t.l=new Q9),t.l}function afe(t){const e=Pv(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=fu(t,2);return n||(n=BR(Z9(t),e,t.m?e.LINEAR:e.NEAREST),t.g.push(n),t.j=!0),e.bindTexture(e.TEXTURE_2D,n),n}function cO(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}var TE,vi=class{constructor(t,e,n,r,i,s,o){this.g=t,this.m=e,this.j=n,this.canvas=r,this.l=i,this.width=s,this.height=o,this.j&&--oW===0&&console.error("You seem to be creating MPMask instances without invoking .close(). This leaks resources.")}Fa(){return!!fu(this,0)}ja(){return!!fu(this,1)}P(){return!!fu(this,2)}ia(){return(e=fu(t=this,0))||(e=aO(t),e=new Uint8Array(e.map(n=>255*n)),t.g.push(e)),e;var t,e}ha(){return aO(this)}M(){return sfe(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof Uint8Array)n=new Uint8Array(e);else if(e instanceof Float32Array)n=new Float32Array(e);else{if(!(e instanceof WebGLTexture))throw Error(`Type is not supported: ${e}`);{const r=Pv(this),i=Z9(this);r.activeTexture(r.TEXTURE1),n=BR(i,r,this.m?r.LINEAR:r.NEAREST),r.bindTexture(r.TEXTURE_2D,n);const s=ofe(this);r.texImage2D(r.TEXTURE_2D,0,s,this.width,this.height,0,r.RED,r.FLOAT,null),r.bindTexture(r.TEXTURE_2D,null),HR(i,r,n),X9(i,r,!1,()=>{afe(this),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.drawArrays(r.TRIANGLE_FAN,0,4),cO(this)}),J9(i),cO(this)}}t.push(n)}return new vi(t,this.m,this.P(),this.canvas,this.l,this.width,this.height)}close(){this.j&&Pv(this).deleteTexture(fu(this,2)),oW=-1}};vi.prototype.close=vi.prototype.close,vi.prototype.clone=vi.prototype.clone,vi.prototype.getAsWebGLTexture=vi.prototype.M,vi.prototype.getAsFloat32Array=vi.prototype.ha,vi.prototype.getAsUint8Array=vi.prototype.ia,vi.prototype.hasWebGLTexture=vi.prototype.P,vi.prototype.hasFloat32Array=vi.prototype.ja,vi.prototype.hasUint8Array=vi.prototype.Fa;var oW=250;function qc(t,e){switch(e){case 0:return t.g.find(n=>n instanceof ImageData);case 1:return t.g.find(n=>typeof ImageBitmap<"u"&&n instanceof ImageBitmap);case 2:return t.g.find(n=>typeof WebGLTexture<"u"&&n instanceof WebGLTexture);default:throw Error(`Type is not supported: ${e}`)}}function cfe(t){var e=qc(t,0);if(!e){e=Lv(t);const n=VR(t),r=new Uint8Array(t.width*t.height*4);HR(n,e,Kw(t)),e.readPixels(0,0,t.width,t.height,e.RGBA,e.UNSIGNED_BYTE,r),J9(n),e=new ImageData(new Uint8ClampedArray(r.buffer),t.width,t.height),t.g.push(e)}return e}function Kw(t){let e=qc(t,2);if(!e){const n=Lv(t);e=zw(t);const r=qc(t,1)||cfe(t);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r),_y(t)}return e}function Lv(t){if(!t.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return t.h||(t.h=Iu(t.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),t.h}function VR(t){return t.l||(t.l=new Q9),t.l}function zw(t){const e=Lv(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=qc(t,2);return n||(n=BR(VR(t),e),t.g.push(n),t.m=!0),e.bindTexture(e.TEXTURE_2D,n),n}function _y(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}function aW(t){const e=Lv(t);return X9(VR(t),e,!0,()=>function(n,r){const i=n.canvas;if(i.width===n.width&&i.height===n.height)return r();const s=i.width,o=i.height;return i.width=n.width,i.height=n.height,n=r(),i.width=s,i.height=o,n}(t,()=>{if(e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),!(t.canvas instanceof OffscreenCanvas))throw Error("Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas");return t.canvas.transferToImageBitmap()}))}var yi=class{constructor(t,e,n,r,i,s,o){this.g=t,this.j=e,this.m=n,this.canvas=r,this.l=i,this.width=s,this.height=o,(this.j||this.m)&&--cW===0&&console.error("You seem to be creating MPImage instances without invoking .close(). This leaks resources.")}Ea(){return!!qc(this,0)}ka(){return!!qc(this,1)}P(){return!!qc(this,2)}Ca(){return cfe(this)}Ba(){var t=qc(this,1);return t||(Kw(this),zw(this),t=aW(this),_y(this),this.g.push(t),this.j=!0),t}M(){return Kw(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof ImageData)n=new ImageData(e.data,this.width,this.height);else if(e instanceof WebGLTexture){const r=Lv(this),i=VR(this);r.activeTexture(r.TEXTURE1),n=BR(i,r),r.bindTexture(r.TEXTURE_2D,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.bindTexture(r.TEXTURE_2D,null),HR(i,r,n),X9(i,r,!1,()=>{zw(this),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.drawArrays(r.TRIANGLE_FAN,0,4),_y(this)}),J9(i),_y(this)}else{if(!(e instanceof ImageBitmap))throw Error(`Type is not supported: ${e}`);Kw(this),zw(this),n=aW(this),_y(this)}t.push(n)}return new yi(t,this.ka(),this.P(),this.canvas,this.l,this.width,this.height)}close(){this.j&&qc(this,1).close(),this.m&&Lv(this).deleteTexture(qc(this,2)),cW=-1}};yi.prototype.close=yi.prototype.close,yi.prototype.clone=yi.prototype.clone,yi.prototype.getAsWebGLTexture=yi.prototype.M,yi.prototype.getAsImageBitmap=yi.prototype.Ba,yi.prototype.getAsImageData=yi.prototype.Ca,yi.prototype.hasWebGLTexture=yi.prototype.P,yi.prototype.hasImageBitmap=yi.prototype.ka,yi.prototype.hasImageData=yi.prototype.Ea;var cW=250;function pc(...t){return t.map(([e,n])=>({start:e,end:n}))}const $Ye=function(t){return class extends t{La(){this.i._registerModelResourcesGraphService()}}}((lW=class{constructor(t,e){this.l=!0,this.i=t,this.g=null,this.h=0,this.m=typeof this.i._addIntToInputStream=="function",e!==void 0?this.i.canvas=e:rfe()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.i.canvas=document.createElement("canvas"))}async initializeGraph(t){const e=await(await fetch(t)).arrayBuffer();t=!(t.endsWith(".pbtxt")||t.endsWith(".textproto")),this.setGraph(new Uint8Array(e),t)}setGraphFromString(t){this.setGraph(new TextEncoder().encode(t),!1)}setGraph(t,e){const n=t.length,r=this.i._malloc(n);this.i.HEAPU8.set(t,r),e?this.i._changeBinaryGraph(n,r):this.i._changeTextGraph(n,r),this.i._free(r)}configureAudio(t,e,n,r,i){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),Ke(this,r||"input_audio",s=>{Ke(this,i=i||"audio_header",o=>{this.i._configureAudio(s,o,t,e??0,n)})})}setAutoResizeCanvas(t){this.l=t}setAutoRenderToScreen(t){this.i._setAutoRenderToScreen(t)}setGpuBufferVerticalFlip(t){this.i.gpuOriginForWebTexturesIsBottomLeft=t}da(t){Ic(this,"__graph_config__",e=>{t(e)}),Ke(this,"__graph_config__",e=>{this.i._getGraphConfig(e,void 0)}),delete this.i.simpleListeners.__graph_config__}attachErrorListener(t){this.i.errorListener=t}attachEmptyPacketListener(t,e){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[t]=e}addAudioToStream(t,e,n){this.addAudioToStreamWithShape(t,0,0,e,n)}addAudioToStreamWithShape(t,e,n,r,i){const s=4*t.length;this.h!==s&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(s),this.h=s),this.i.HEAPF32.set(t,this.g/4),Ke(this,r,o=>{this.i._addAudioToInputStream(this.g,e,n,o,i)})}addGpuBufferToStream(t,e,n){Ke(this,e,r=>{const[i,s]=tW(this,t,r);this.i._addBoundTextureToStream(r,i,s,n)})}addBoolToStream(t,e,n){Ke(this,e,r=>{this.i._addBoolToInputStream(t,r,n)})}addDoubleToStream(t,e,n){Ke(this,e,r=>{this.i._addDoubleToInputStream(t,r,n)})}addFloatToStream(t,e,n){Ke(this,e,r=>{this.i._addFloatToInputStream(t,r,n)})}addIntToStream(t,e,n){Ke(this,e,r=>{this.i._addIntToInputStream(t,r,n)})}addUintToStream(t,e,n){Ke(this,e,r=>{this.i._addUintToInputStream(t,r,n)})}addStringToStream(t,e,n){Ke(this,e,r=>{Ke(this,t,i=>{this.i._addStringToInputStream(i,r,n)})})}addStringRecordToStream(t,e,n){Ke(this,e,r=>{nW(this,Object.keys(t),i=>{nW(this,Object.values(t),s=>{this.i._addFlatHashMapToInputStream(i,s,Object.keys(t).length,r,n)})})})}addProtoToStream(t,e,n,r){Ke(this,n,i=>{Ke(this,e,s=>{const o=this.i._malloc(t.length);this.i.HEAPU8.set(t,o),this.i._addProtoToInputStream(o,t.length,s,i,r),this.i._free(o)})})}addEmptyPacketToStream(t,e){Ke(this,t,n=>{this.i._addEmptyPacketToInputStream(n,e)})}addBoolVectorToStream(t,e,n){Ke(this,e,r=>{const i=this.i._allocateBoolVector(t.length);if(!i)throw Error("Unable to allocate new bool vector on heap.");for(const s of t)this.i._addBoolVectorEntry(i,s);this.i._addBoolVectorToInputStream(i,r,n)})}addDoubleVectorToStream(t,e,n){Ke(this,e,r=>{const i=this.i._allocateDoubleVector(t.length);if(!i)throw Error("Unable to allocate new double vector on heap.");for(const s of t)this.i._addDoubleVectorEntry(i,s);this.i._addDoubleVectorToInputStream(i,r,n)})}addFloatVectorToStream(t,e,n){Ke(this,e,r=>{const i=this.i._allocateFloatVector(t.length);if(!i)throw Error("Unable to allocate new float vector on heap.");for(const s of t)this.i._addFloatVectorEntry(i,s);this.i._addFloatVectorToInputStream(i,r,n)})}addIntVectorToStream(t,e,n){Ke(this,e,r=>{const i=this.i._allocateIntVector(t.length);if(!i)throw Error("Unable to allocate new int vector on heap.");for(const s of t)this.i._addIntVectorEntry(i,s);this.i._addIntVectorToInputStream(i,r,n)})}addUintVectorToStream(t,e,n){Ke(this,e,r=>{const i=this.i._allocateUintVector(t.length);if(!i)throw Error("Unable to allocate new unsigned int vector on heap.");for(const s of t)this.i._addUintVectorEntry(i,s);this.i._addUintVectorToInputStream(i,r,n)})}addStringVectorToStream(t,e,n){Ke(this,e,r=>{const i=this.i._allocateStringVector(t.length);if(!i)throw Error("Unable to allocate new string vector on heap.");for(const s of t)Ke(this,s,o=>{this.i._addStringVectorEntry(i,o)});this.i._addStringVectorToInputStream(i,r,n)})}addBoolToInputSidePacket(t,e){Ke(this,e,n=>{this.i._addBoolToInputSidePacket(t,n)})}addDoubleToInputSidePacket(t,e){Ke(this,e,n=>{this.i._addDoubleToInputSidePacket(t,n)})}addFloatToInputSidePacket(t,e){Ke(this,e,n=>{this.i._addFloatToInputSidePacket(t,n)})}addIntToInputSidePacket(t,e){Ke(this,e,n=>{this.i._addIntToInputSidePacket(t,n)})}addUintToInputSidePacket(t,e){Ke(this,e,n=>{this.i._addUintToInputSidePacket(t,n)})}addStringToInputSidePacket(t,e){Ke(this,e,n=>{Ke(this,t,r=>{this.i._addStringToInputSidePacket(r,n)})})}addProtoToInputSidePacket(t,e,n){Ke(this,n,r=>{Ke(this,e,i=>{const s=this.i._malloc(t.length);this.i.HEAPU8.set(t,s),this.i._addProtoToInputSidePacket(s,t.length,i,r),this.i._free(s)})})}addBoolVectorToInputSidePacket(t,e){Ke(this,e,n=>{const r=this.i._allocateBoolVector(t.length);if(!r)throw Error("Unable to allocate new bool vector on heap.");for(const i of t)this.i._addBoolVectorEntry(r,i);this.i._addBoolVectorToInputSidePacket(r,n)})}addDoubleVectorToInputSidePacket(t,e){Ke(this,e,n=>{const r=this.i._allocateDoubleVector(t.length);if(!r)throw Error("Unable to allocate new double vector on heap.");for(const i of t)this.i._addDoubleVectorEntry(r,i);this.i._addDoubleVectorToInputSidePacket(r,n)})}addFloatVectorToInputSidePacket(t,e){Ke(this,e,n=>{const r=this.i._allocateFloatVector(t.length);if(!r)throw Error("Unable to allocate new float vector on heap.");for(const i of t)this.i._addFloatVectorEntry(r,i);this.i._addFloatVectorToInputSidePacket(r,n)})}addIntVectorToInputSidePacket(t,e){Ke(this,e,n=>{const r=this.i._allocateIntVector(t.length);if(!r)throw Error("Unable to allocate new int vector on heap.");for(const i of t)this.i._addIntVectorEntry(r,i);this.i._addIntVectorToInputSidePacket(r,n)})}addUintVectorToInputSidePacket(t,e){Ke(this,e,n=>{const r=this.i._allocateUintVector(t.length);if(!r)throw Error("Unable to allocate new unsigned int vector on heap.");for(const i of t)this.i._addUintVectorEntry(r,i);this.i._addUintVectorToInputSidePacket(r,n)})}addStringVectorToInputSidePacket(t,e){Ke(this,e,n=>{const r=this.i._allocateStringVector(t.length);if(!r)throw Error("Unable to allocate new string vector on heap.");for(const i of t)Ke(this,i,s=>{this.i._addStringVectorEntry(r,s)});this.i._addStringVectorToInputSidePacket(r,n)})}attachBoolListener(t,e){Ic(this,t,e),Ke(this,t,n=>{this.i._attachBoolListener(n)})}attachBoolVectorListener(t,e){Cd(this,t,e),Ke(this,t,n=>{this.i._attachBoolVectorListener(n)})}attachIntListener(t,e){Ic(this,t,e),Ke(this,t,n=>{this.i._attachIntListener(n)})}attachIntVectorListener(t,e){Cd(this,t,e),Ke(this,t,n=>{this.i._attachIntVectorListener(n)})}attachUintListener(t,e){Ic(this,t,e),Ke(this,t,n=>{this.i._attachUintListener(n)})}attachUintVectorListener(t,e){Cd(this,t,e),Ke(this,t,n=>{this.i._attachUintVectorListener(n)})}attachDoubleListener(t,e){Ic(this,t,e),Ke(this,t,n=>{this.i._attachDoubleListener(n)})}attachDoubleVectorListener(t,e){Cd(this,t,e),Ke(this,t,n=>{this.i._attachDoubleVectorListener(n)})}attachFloatListener(t,e){Ic(this,t,e),Ke(this,t,n=>{this.i._attachFloatListener(n)})}attachFloatVectorListener(t,e){Cd(this,t,e),Ke(this,t,n=>{this.i._attachFloatVectorListener(n)})}attachStringListener(t,e){Ic(this,t,e),Ke(this,t,n=>{this.i._attachStringListener(n)})}attachStringVectorListener(t,e){Cd(this,t,e),Ke(this,t,n=>{this.i._attachStringVectorListener(n)})}attachProtoListener(t,e,n){Ic(this,t,e),Ke(this,t,r=>{this.i._attachProtoListener(r,n||!1)})}attachProtoVectorListener(t,e,n){Cd(this,t,e),Ke(this,t,r=>{this.i._attachProtoVectorListener(r,n||!1)})}attachAudioListener(t,e,n){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),Ic(this,t,(r,i)=>{r=new Float32Array(r.buffer,r.byteOffset,r.length/4),e(r,i)}),Ke(this,t,r=>{this.i._attachAudioListener(r,n||!1)})}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends lW{get ea(){return this.i}qa(t,e,n){Ke(this,e,r=>{const[i,s]=tW(this,t,r);this.ea._addBoundTextureAsImageToStream(r,i,s,n)})}U(t,e){Ic(this,t,e),Ke(this,t,n=>{this.ea._attachImageListener(n)})}ca(t,e){Cd(this,t,e),Ke(this,t,n=>{this.ea._attachImageVectorListener(n)})}}));var lW,ka=class extends $Ye{};async function jt(t,e,n){return async function(r,i,s,o){return jYe(r,i,s,o)}(t,n.canvas??(rfe()?void 0:document.createElement("canvas")),e,n)}function lfe(t,e,n,r){if(t.T){const s=new Lde;if(n?.regionOfInterest){if(!t.pa)throw Error("This task doesn't support region-of-interest.");var i=n.regionOfInterest;if(i.left>=i.right||i.top>=i.bottom)throw Error("Expected RectF with left < right and top < bottom.");if(i.left<0||i.top<0||i.right>1||i.bottom>1)throw Error("Expected RectF values to be in [0,1].");Ve(s,1,(i.left+i.right)/2),Ve(s,2,(i.top+i.bottom)/2),Ve(s,4,i.right-i.left),Ve(s,3,i.bottom-i.top)}else Ve(s,1,.5),Ve(s,2,.5),Ve(s,4,1),Ve(s,3,1);if(n?.rotationDegrees){if(n?.rotationDegrees%90!=0)throw Error("Expected rotation to be a multiple of 90°.");if(Ve(s,5,-Math.PI*n.rotationDegrees/180),n?.rotationDegrees%180!=0){const[o,a]=ife(e);n=Tr(s,3)*a/o,i=Tr(s,4)*o/a,Ve(s,4,n),Ve(s,3,i)}}t.g.addProtoToStream(s.g(),"mediapipe.NormalizedRect",t.T,r)}t.g.qa(e,t.aa,r??performance.now()),t.finishProcessing()}function xa(t,e,n){if(t.baseOptions?.g())throw Error("Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.");lfe(t,e,n,t.B+1)}function vl(t,e,n,r){if(!t.baseOptions?.g())throw Error("Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.");lfe(t,e,n,r)}function Ov(t,e,n,r){var i=e.data;const s=e.width,o=s*(e=e.height);if((i instanceof Uint8Array||i instanceof Float32Array)&&i.length!==o)throw Error("Unsupported channel count: "+i.length/o);return t=new vi([i],n,!1,t.g.i.canvas,t.O,s,e),r?t.clone():t}var eo=class extends Gw{constructor(t,e,n,r){super(t),this.g=t,this.aa=e,this.T=n,this.pa=r,this.O=new Q9}l(t,e=!0){if("runningMode"in t&&Xb(this.baseOptions,2,!!t.runningMode&&t.runningMode!=="IMAGE"),t.canvas!==void 0&&this.g.i.canvas!==t.canvas)throw Error("You must create a new task to reset the canvas.");return super.l(t,e)}close(){this.O.close(),super.close()}};eo.prototype.close=eo.prototype.close;var Wo=class extends eo{constructor(t,e){super(new ka(t,e),"image_in","norm_rect_in",!1),this.j={detections:[]},Ye(t=this.h=new UR,0,1,e=new rr),Ve(this.h,2,.5),Ve(this.h,3,.3)}get baseOptions(){return zt(this.h,rr,1)}set baseOptions(t){Ye(this.h,0,1,t)}o(t){return"minDetectionConfidence"in t&&Ve(this.h,2,t.minDetectionConfidence??.5),"minSuppressionThreshold"in t&&Ve(this.h,3,t.minSuppressionThreshold??.3),this.l(t)}D(t,e){return this.j={detections:[]},xa(this,t,e),this.j}F(t,e,n){return this.j={detections:[]},vl(this,t,n,e),this.j}m(){var t=new ro;zn(t,"image_in"),zn(t,"norm_rect_in"),Zt(t,"detections");const e=new xo;dc(e,CYe,this.h);const n=new Ss;Oo(n,"mediapipe.tasks.vision.face_detector.FaceDetectorGraph"),$n(n,"IMAGE:image_in"),$n(n,"NORM_RECT:norm_rect_in"),$t(n,"DETECTIONS:detections"),n.o(e),Mo(t,n),this.g.attachProtoVectorListener("detections",(r,i)=>{for(const s of r)r=xde(s),this.j.detections.push(tfe(r));je(this,i)}),this.g.attachEmptyPacketListener("detections",r=>{je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Wo.prototype.detectForVideo=Wo.prototype.F,Wo.prototype.detect=Wo.prototype.D,Wo.prototype.setOptions=Wo.prototype.o,Wo.createFromModelPath=async function(t,e){return jt(Wo,t,{baseOptions:{modelAssetPath:e}})},Wo.createFromModelBuffer=function(t,e){return jt(Wo,t,{baseOptions:{modelAssetBuffer:e}})},Wo.createFromOptions=function(t,e){return jt(Wo,t,e)};var eD=pc([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),tD=pc([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),nD=pc([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),ufe=pc([474,475],[475,476],[476,477],[477,474]),rD=pc([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),iD=pc([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),dfe=pc([469,470],[470,471],[471,472],[472,469]),sD=pc([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),ffe=[...eD,...tD,...nD,...rD,...iD,...sD],hfe=pc([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function uW(t){t.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var mr=class extends eo{constructor(t,e){super(new ka(t,e),"image_in","norm_rect",!1),this.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,Ye(t=this.h=new Ude,0,1,e=new rr),this.v=new Nde,Ye(this.h,0,3,this.v),this.s=new UR,Ye(this.h,0,2,this.s),sl(this.s,4,1),Ve(this.s,2,.5),Ve(this.v,2,.5),Ve(this.h,4,.5)}get baseOptions(){return zt(this.h,rr,1)}set baseOptions(t){Ye(this.h,0,1,t)}o(t){return"numFaces"in t&&sl(this.s,4,t.numFaces??1),"minFaceDetectionConfidence"in t&&Ve(this.s,2,t.minFaceDetectionConfidence??.5),"minTrackingConfidence"in t&&Ve(this.h,4,t.minTrackingConfidence??.5),"minFacePresenceConfidence"in t&&Ve(this.v,2,t.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),"outputFacialTransformationMatrixes"in t&&(this.outputFacialTransformationMatrixes=!!t.outputFacialTransformationMatrixes),this.l(t)}D(t,e){return uW(this),xa(this,t,e),this.j}F(t,e,n){return uW(this),vl(this,t,n,e),this.j}m(){var t=new ro;zn(t,"image_in"),zn(t,"norm_rect"),Zt(t,"face_landmarks");const e=new xo;dc(e,RYe,this.h);const n=new Ss;Oo(n,"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph"),$n(n,"IMAGE:image_in"),$n(n,"NORM_RECT:norm_rect"),$t(n,"NORM_LANDMARKS:face_landmarks"),n.o(e),Mo(t,n),this.g.attachProtoVectorListener("face_landmarks",(r,i)=>{for(const s of r)r=Y_(s),this.j.faceLandmarks.push(jR(r));je(this,i)}),this.g.attachEmptyPacketListener("face_landmarks",r=>{je(this,r)}),this.outputFaceBlendshapes&&(Zt(t,"blendshapes"),$t(n,"BLENDSHAPES:blendshapes"),this.g.attachProtoVectorListener("blendshapes",(r,i)=>{if(this.outputFaceBlendshapes)for(const s of r)r=NR(s),this.j.faceBlendshapes.push(W9(r.g()??[]));je(this,i)}),this.g.attachEmptyPacketListener("blendshapes",r=>{je(this,r)})),this.outputFacialTransformationMatrixes&&(Zt(t,"face_geometry"),$t(n,"FACE_GEOMETRY:face_geometry"),this.g.attachProtoVectorListener("face_geometry",(r,i)=>{if(this.outputFacialTransformationMatrixes)for(const s of r)(r=zt(TYe(s),gYe,2))&&this.j.facialTransformationMatrixes.push({rows:fa(r,1)??0??0,columns:fa(r,2)??0??0,data:$h(r,3,Vf,Fh()).slice()??[]});je(this,i)}),this.g.attachEmptyPacketListener("face_geometry",r=>{je(this,r)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};mr.prototype.detectForVideo=mr.prototype.F,mr.prototype.detect=mr.prototype.D,mr.prototype.setOptions=mr.prototype.o,mr.createFromModelPath=function(t,e){return jt(mr,t,{baseOptions:{modelAssetPath:e}})},mr.createFromModelBuffer=function(t,e){return jt(mr,t,{baseOptions:{modelAssetBuffer:e}})},mr.createFromOptions=function(t,e){return jt(mr,t,e)},mr.FACE_LANDMARKS_LIPS=eD,mr.FACE_LANDMARKS_LEFT_EYE=tD,mr.FACE_LANDMARKS_LEFT_EYEBROW=nD,mr.FACE_LANDMARKS_LEFT_IRIS=ufe,mr.FACE_LANDMARKS_RIGHT_EYE=rD,mr.FACE_LANDMARKS_RIGHT_EYEBROW=iD,mr.FACE_LANDMARKS_RIGHT_IRIS=dfe,mr.FACE_LANDMARKS_FACE_OVAL=sD,mr.FACE_LANDMARKS_CONTOURS=ffe,mr.FACE_LANDMARKS_TESSELATION=hfe;var kc=class extends eo{constructor(t,e){super(new ka(t,e),"image_in","norm_rect",!0),Ye(t=this.j=new Fde,0,1,e=new rr)}get baseOptions(){return zt(this.j,rr,1)}set baseOptions(t){Ye(this.j,0,1,t)}o(t){return super.l(t)}Oa(t,e,n){const r=typeof e!="function"?e:{};if(this.h=typeof e=="function"?e:n,xa(this,t,r??{}),!this.h)return this.s}m(){var t=new ro;zn(t,"image_in"),zn(t,"norm_rect"),Zt(t,"stylized_image");const e=new xo;dc(e,IYe,this.j);const n=new Ss;Oo(n,"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph"),$n(n,"IMAGE:image_in"),$n(n,"NORM_RECT:norm_rect"),$t(n,"STYLIZED_IMAGE:stylized_image"),n.o(e),Mo(t,n),this.g.U("stylized_image",(r,i)=>{var s=!this.h,o=r.data,a=r.width;const c=a*(r=r.height);if(o instanceof Uint8Array)if(o.length===3*c){const l=new Uint8ClampedArray(4*c);for(let d=0;d<c;++d)l[4*d]=o[3*d],l[4*d+1]=o[3*d+1],l[4*d+2]=o[3*d+2],l[4*d+3]=255;o=new ImageData(l,a,r)}else{if(o.length!==4*c)throw Error("Unsupported channel count: "+o.length/c);o=new ImageData(new Uint8ClampedArray(o.buffer,o.byteOffset,o.length),a,r)}else if(!(o instanceof WebGLTexture))throw Error(`Unsupported format: ${o.constructor.name}`);a=new yi([o],!1,!1,this.g.i.canvas,this.O,a,r),this.s=s=s?a.clone():a,this.h&&this.h(s),je(this,i)}),this.g.attachEmptyPacketListener("stylized_image",r=>{this.s=null,this.h&&this.h(null),je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};kc.prototype.stylize=kc.prototype.Oa,kc.prototype.setOptions=kc.prototype.o,kc.createFromModelPath=function(t,e){return jt(kc,t,{baseOptions:{modelAssetPath:e}})},kc.createFromModelBuffer=function(t,e){return jt(kc,t,{baseOptions:{modelAssetBuffer:e}})},kc.createFromOptions=function(t,e){return jt(kc,t,e)};var oD=pc([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function dW(t){t.gestures=[],t.landmarks=[],t.worldLandmarks=[],t.handedness=[]}function fW(t){return t.gestures.length===0?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:t.gestures,landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handedness:t.handedness,handednesses:t.handedness}}function hW(t,e=!0){const n=[];for(const i of t){var r=NR(i);t=[];for(const s of r.g())r=e&&fa(s,1)!=null?fa(s,1)??0:-1,t.push({score:Tr(s,2)??0,index:r,categoryName:Ta(s,3)??""??"",displayName:Ta(s,4)??""??""});n.push(t)}return n}var po=class extends eo{constructor(t,e){super(new ka(t,e),"image_in","norm_rect",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Ye(t=this.j=new Hde,0,1,e=new rr),this.s=new q9,Ye(this.j,0,2,this.s),this.C=new V9,Ye(this.s,0,3,this.C),this.v=new Bde,Ye(this.s,0,2,this.v),this.h=new kYe,Ye(this.j,0,3,this.h),Ve(this.v,2,.5),Ve(this.s,4,.5),Ve(this.C,2,.5)}get baseOptions(){return zt(this.j,rr,1)}set baseOptions(t){Ye(this.j,0,1,t)}o(t){if(sl(this.v,3,t.numHands??1),"minHandDetectionConfidence"in t&&Ve(this.v,2,t.minHandDetectionConfidence??.5),"minTrackingConfidence"in t&&Ve(this.s,4,t.minTrackingConfidence??.5),"minHandPresenceConfidence"in t&&Ve(this.C,2,t.minHandPresenceConfidence??.5),t.cannedGesturesClassifierOptions){var e=new Vm,n=e,r=oO(t.cannedGesturesClassifierOptions,zt(this.h,Vm,3)?.h());Ye(n,0,2,r),Ye(this.h,0,3,e)}else t.cannedGesturesClassifierOptions===void 0&&zt(this.h,Vm,3)?.g();return t.customGesturesClassifierOptions?(Ye(n=e=new Vm,0,2,r=oO(t.customGesturesClassifierOptions,zt(this.h,Vm,4)?.h())),Ye(this.h,0,4,e)):t.customGesturesClassifierOptions===void 0&&zt(this.h,Vm,4)?.g(),this.l(t)}Ja(t,e){return dW(this),xa(this,t,e),fW(this)}Ka(t,e,n){return dW(this),vl(this,t,n,e),fW(this)}m(){var t=new ro;zn(t,"image_in"),zn(t,"norm_rect"),Zt(t,"hand_gestures"),Zt(t,"hand_landmarks"),Zt(t,"world_hand_landmarks"),Zt(t,"handedness");const e=new xo;dc(e,xYe,this.j);const n=new Ss;Oo(n,"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph"),$n(n,"IMAGE:image_in"),$n(n,"NORM_RECT:norm_rect"),$t(n,"HAND_GESTURES:hand_gestures"),$t(n,"LANDMARKS:hand_landmarks"),$t(n,"WORLD_LANDMARKS:world_hand_landmarks"),$t(n,"HANDEDNESS:handedness"),n.o(e),Mo(t,n),this.g.attachProtoVectorListener("hand_landmarks",(r,i)=>{for(const s of r){r=Y_(s);const o=[];for(const a of $u(r,Pde,1))o.push({x:Tr(a,1)??0,y:Tr(a,2)??0,z:Tr(a,3)??0,visibility:Tr(a,4)??0});this.landmarks.push(o)}je(this,i)}),this.g.attachEmptyPacketListener("hand_landmarks",r=>{je(this,r)}),this.g.attachProtoVectorListener("world_hand_landmarks",(r,i)=>{for(const s of r){r=Yg(s);const o=[];for(const a of $u(r,Ade,1))o.push({x:Tr(a,1)??0,y:Tr(a,2)??0,z:Tr(a,3)??0,visibility:Tr(a,4)??0});this.worldLandmarks.push(o)}je(this,i)}),this.g.attachEmptyPacketListener("world_hand_landmarks",r=>{je(this,r)}),this.g.attachProtoVectorListener("hand_gestures",(r,i)=>{this.gestures.push(...hW(r,!1)),je(this,i)}),this.g.attachEmptyPacketListener("hand_gestures",r=>{je(this,r)}),this.g.attachProtoVectorListener("handedness",(r,i)=>{this.handedness.push(...hW(r)),je(this,i)}),this.g.attachEmptyPacketListener("handedness",r=>{je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};function pW(t){return{landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handednesses:t.handedness,handedness:t.handedness}}po.prototype.recognizeForVideo=po.prototype.Ka,po.prototype.recognize=po.prototype.Ja,po.prototype.setOptions=po.prototype.o,po.createFromModelPath=function(t,e){return jt(po,t,{baseOptions:{modelAssetPath:e}})},po.createFromModelBuffer=function(t,e){return jt(po,t,{baseOptions:{modelAssetBuffer:e}})},po.createFromOptions=function(t,e){return jt(po,t,e)},po.HAND_CONNECTIONS=oD;var mo=class extends eo{constructor(t,e){super(new ka(t,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Ye(t=this.h=new q9,0,1,e=new rr),this.s=new V9,Ye(this.h,0,3,this.s),this.j=new Bde,Ye(this.h,0,2,this.j),sl(this.j,3,1),Ve(this.j,2,.5),Ve(this.s,2,.5),Ve(this.h,4,.5)}get baseOptions(){return zt(this.h,rr,1)}set baseOptions(t){Ye(this.h,0,1,t)}o(t){return"numHands"in t&&sl(this.j,3,t.numHands??1),"minHandDetectionConfidence"in t&&Ve(this.j,2,t.minHandDetectionConfidence??.5),"minTrackingConfidence"in t&&Ve(this.h,4,t.minTrackingConfidence??.5),"minHandPresenceConfidence"in t&&Ve(this.s,2,t.minHandPresenceConfidence??.5),this.l(t)}D(t,e){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],xa(this,t,e),pW(this)}F(t,e,n){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],vl(this,t,n,e),pW(this)}m(){var t=new ro;zn(t,"image_in"),zn(t,"norm_rect"),Zt(t,"hand_landmarks"),Zt(t,"world_hand_landmarks"),Zt(t,"handedness");const e=new xo;dc(e,AYe,this.h);const n=new Ss;Oo(n,"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph"),$n(n,"IMAGE:image_in"),$n(n,"NORM_RECT:norm_rect"),$t(n,"LANDMARKS:hand_landmarks"),$t(n,"WORLD_LANDMARKS:world_hand_landmarks"),$t(n,"HANDEDNESS:handedness"),n.o(e),Mo(t,n),this.g.attachProtoVectorListener("hand_landmarks",(r,i)=>{for(const s of r)r=Y_(s),this.landmarks.push(jR(r));je(this,i)}),this.g.attachEmptyPacketListener("hand_landmarks",r=>{je(this,r)}),this.g.attachProtoVectorListener("world_hand_landmarks",(r,i)=>{for(const s of r)r=Yg(s),this.worldLandmarks.push(Qy(r));je(this,i)}),this.g.attachEmptyPacketListener("world_hand_landmarks",r=>{je(this,r)}),this.g.attachProtoVectorListener("handedness",(r,i)=>{var s=this.handedness,o=s.push;const a=[];for(const c of r){r=NR(c);const l=[];for(const d of r.g())l.push({score:Tr(d,2)??0,index:fa(d,1)??0??-1,categoryName:Ta(d,3)??""??"",displayName:Ta(d,4)??""??""});a.push(l)}o.call(s,...a),je(this,i)}),this.g.attachEmptyPacketListener("handedness",r=>{je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};mo.prototype.detectForVideo=mo.prototype.F,mo.prototype.detect=mo.prototype.D,mo.prototype.setOptions=mo.prototype.o,mo.createFromModelPath=function(t,e){return jt(mo,t,{baseOptions:{modelAssetPath:e}})},mo.createFromModelBuffer=function(t,e){return jt(mo,t,{baseOptions:{modelAssetBuffer:e}})},mo.createFromOptions=function(t,e){return jt(mo,t,e)},mo.HAND_CONNECTIONS=oD;var pfe=pc([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function mW(t){t.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function gW(t){try{if(!t.C)return t.h;t.C(t.h)}finally{$R(t)}}function RE(t,e){t=Y_(t),e.push(jR(t))}var Jn=class extends eo{constructor(t,e){super(new ka(t,e),"input_frames_image",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,Ye(t=this.j=new zde,0,1,e=new rr),this.J=new V9,Ye(this.j,0,2,this.J),this.Z=new PYe,Ye(this.j,0,3,this.Z),this.s=new UR,Ye(this.j,0,4,this.s),this.H=new Nde,Ye(this.j,0,5,this.H),this.v=new Gde,Ye(this.j,0,6,this.v),this.K=new Kde,Ye(this.j,0,7,this.K),Ve(this.s,2,.5),Ve(this.s,3,.3),Ve(this.H,2,.5),Ve(this.v,2,.5),Ve(this.v,3,.3),Ve(this.K,2,.5),Ve(this.J,2,.5)}get baseOptions(){return zt(this.j,rr,1)}set baseOptions(t){Ye(this.j,0,1,t)}o(t){return"minFaceDetectionConfidence"in t&&Ve(this.s,2,t.minFaceDetectionConfidence??.5),"minFaceSuppressionThreshold"in t&&Ve(this.s,3,t.minFaceSuppressionThreshold??.3),"minFacePresenceConfidence"in t&&Ve(this.H,2,t.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),"minPoseDetectionConfidence"in t&&Ve(this.v,2,t.minPoseDetectionConfidence??.5),"minPoseSuppressionThreshold"in t&&Ve(this.v,3,t.minPoseSuppressionThreshold??.3),"minPosePresenceConfidence"in t&&Ve(this.K,2,t.minPosePresenceConfidence??.5),"outputPoseSegmentationMasks"in t&&(this.outputPoseSegmentationMasks=!!t.outputPoseSegmentationMasks),"minHandLandmarksConfidence"in t&&Ve(this.J,2,t.minHandLandmarksConfidence??.5),this.l(t)}D(t,e,n){const r=typeof e!="function"?e:{};return this.C=typeof e=="function"?e:n,mW(this),xa(this,t,r),gW(this)}F(t,e,n,r){const i=typeof n!="function"?n:{};return this.C=typeof n=="function"?n:r,mW(this),vl(this,t,i,e),gW(this)}m(){var t=new ro;zn(t,"input_frames_image"),Zt(t,"pose_landmarks"),Zt(t,"pose_world_landmarks"),Zt(t,"face_landmarks"),Zt(t,"left_hand_landmarks"),Zt(t,"left_hand_world_landmarks"),Zt(t,"right_hand_landmarks"),Zt(t,"right_hand_world_landmarks");const e=new xo,n=new Fz;eO(n,1,a0("type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions"),""),function(i,s){if(s!=null)if(Array.isArray(s))Fn(i,2,Bue(s));else{if(!(typeof s=="string"||s instanceof Tu||G_(s)))throw Error("invalid value in Any.value field: "+s+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");eO(i,2,a9(s,!1),yp())}}(n,this.j.g());const r=new Ss;Oo(r,"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph"),C3(r,8,Fz,n),$n(r,"IMAGE:input_frames_image"),$t(r,"POSE_LANDMARKS:pose_landmarks"),$t(r,"POSE_WORLD_LANDMARKS:pose_world_landmarks"),$t(r,"FACE_LANDMARKS:face_landmarks"),$t(r,"LEFT_HAND_LANDMARKS:left_hand_landmarks"),$t(r,"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks"),$t(r,"RIGHT_HAND_LANDMARKS:right_hand_landmarks"),$t(r,"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks"),r.o(e),Mo(t,r),FR(this,t),this.g.attachProtoListener("pose_landmarks",(i,s)=>{RE(i,this.h.poseLandmarks),je(this,s)}),this.g.attachEmptyPacketListener("pose_landmarks",i=>{je(this,i)}),this.g.attachProtoListener("pose_world_landmarks",(i,s)=>{var o=this.h.poseWorldLandmarks;i=Yg(i),o.push(Qy(i)),je(this,s)}),this.g.attachEmptyPacketListener("pose_world_landmarks",i=>{je(this,i)}),this.outputPoseSegmentationMasks&&($t(r,"POSE_SEGMENTATION_MASK:pose_segmentation_mask"),Av(this,"pose_segmentation_mask"),this.g.U("pose_segmentation_mask",(i,s)=>{this.h.poseSegmentationMasks=[Ov(this,i,!0,!this.C)],je(this,s)}),this.g.attachEmptyPacketListener("pose_segmentation_mask",i=>{this.h.poseSegmentationMasks=[],je(this,i)})),this.g.attachProtoListener("face_landmarks",(i,s)=>{RE(i,this.h.faceLandmarks),je(this,s)}),this.g.attachEmptyPacketListener("face_landmarks",i=>{je(this,i)}),this.outputFaceBlendshapes&&(Zt(t,"extra_blendshapes"),$t(r,"FACE_BLENDSHAPES:extra_blendshapes"),this.g.attachProtoListener("extra_blendshapes",(i,s)=>{var o=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(i=NR(i),o.push(W9(i.g()??[]))),je(this,s)}),this.g.attachEmptyPacketListener("extra_blendshapes",i=>{je(this,i)})),this.g.attachProtoListener("left_hand_landmarks",(i,s)=>{RE(i,this.h.leftHandLandmarks),je(this,s)}),this.g.attachEmptyPacketListener("left_hand_landmarks",i=>{je(this,i)}),this.g.attachProtoListener("left_hand_world_landmarks",(i,s)=>{var o=this.h.leftHandWorldLandmarks;i=Yg(i),o.push(Qy(i)),je(this,s)}),this.g.attachEmptyPacketListener("left_hand_world_landmarks",i=>{je(this,i)}),this.g.attachProtoListener("right_hand_landmarks",(i,s)=>{RE(i,this.h.rightHandLandmarks),je(this,s)}),this.g.attachEmptyPacketListener("right_hand_landmarks",i=>{je(this,i)}),this.g.attachProtoListener("right_hand_world_landmarks",(i,s)=>{var o=this.h.rightHandWorldLandmarks;i=Yg(i),o.push(Qy(i)),je(this,s)}),this.g.attachEmptyPacketListener("right_hand_world_landmarks",i=>{je(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Jn.prototype.detectForVideo=Jn.prototype.F,Jn.prototype.detect=Jn.prototype.D,Jn.prototype.setOptions=Jn.prototype.o,Jn.createFromModelPath=function(t,e){return jt(Jn,t,{baseOptions:{modelAssetPath:e}})},Jn.createFromModelBuffer=function(t,e){return jt(Jn,t,{baseOptions:{modelAssetBuffer:e}})},Jn.createFromOptions=function(t,e){return jt(Jn,t,e)},Jn.HAND_CONNECTIONS=oD,Jn.POSE_CONNECTIONS=pfe,Jn.FACE_LANDMARKS_LIPS=eD,Jn.FACE_LANDMARKS_LEFT_EYE=tD,Jn.FACE_LANDMARKS_LEFT_EYEBROW=nD,Jn.FACE_LANDMARKS_LEFT_IRIS=ufe,Jn.FACE_LANDMARKS_RIGHT_EYE=rD,Jn.FACE_LANDMARKS_RIGHT_EYEBROW=iD,Jn.FACE_LANDMARKS_RIGHT_IRIS=dfe,Jn.FACE_LANDMARKS_FACE_OVAL=sD,Jn.FACE_LANDMARKS_CONTOURS=ffe,Jn.FACE_LANDMARKS_TESSELATION=hfe;var Yo=class extends eo{constructor(t,e){super(new ka(t,e),"input_image","norm_rect",!0),this.j={classifications:[]},Ye(t=this.h=new Wde,0,1,e=new rr)}get baseOptions(){return zt(this.h,rr,1)}set baseOptions(t){Ye(this.h,0,1,t)}o(t){return Ye(this.h,0,2,oO(t,zt(this.h,$9,2))),this.l(t)}sa(t,e){return this.j={classifications:[]},xa(this,t,e),this.j}ta(t,e,n){return this.j={classifications:[]},vl(this,t,n,e),this.j}m(){var t=new ro;zn(t,"input_image"),zn(t,"norm_rect"),Zt(t,"classifications");const e=new xo;dc(e,LYe,this.h);const n=new Ss;Oo(n,"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph"),$n(n,"IMAGE:input_image"),$n(n,"NORM_RECT:norm_rect"),$t(n,"CLASSIFICATIONS:classifications"),n.o(e),Mo(t,n),this.g.attachProtoListener("classifications",(r,i)=>{this.j=function(s){const o={classifications:$u(s,yYe,1).map(a=>W9(zt(a,Ide,4)?.g()??[],fa(a,2)??0,Ta(a,3)??""))};return w3(kv(s,2))!=null&&(o.timestampMs=w3(kv(s,2))??0),o}(bYe(r)),je(this,i)}),this.g.attachEmptyPacketListener("classifications",r=>{je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Yo.prototype.classifyForVideo=Yo.prototype.ta,Yo.prototype.classify=Yo.prototype.sa,Yo.prototype.setOptions=Yo.prototype.o,Yo.createFromModelPath=function(t,e){return jt(Yo,t,{baseOptions:{modelAssetPath:e}})},Yo.createFromModelBuffer=function(t,e){return jt(Yo,t,{baseOptions:{modelAssetBuffer:e}})},Yo.createFromOptions=function(t,e){return jt(Yo,t,e)};var go=class extends eo{constructor(t,e){super(new ka(t,e),"image_in","norm_rect",!0),this.h=new Yde,this.embeddings={embeddings:[]},Ye(t=this.h,0,1,e=new rr)}get baseOptions(){return zt(this.h,rr,1)}set baseOptions(t){Ye(this.h,0,1,t)}o(t){var e=this.h,n=zt(this.h,Wz,2);return n=n?n.clone():new Wz,t.l2Normalize!==void 0?Xb(n,1,t.l2Normalize):"l2Normalize"in t&&Fn(n,1),t.quantize!==void 0?Xb(n,2,t.quantize):"quantize"in t&&Fn(n,2),Ye(e,0,2,n),this.l(t)}za(t,e){return xa(this,t,e),this.embeddings}Aa(t,e,n){return vl(this,t,n,e),this.embeddings}m(){var t=new ro;zn(t,"image_in"),zn(t,"norm_rect"),Zt(t,"embeddings_out");const e=new xo;dc(e,OYe,this.h);const n=new Ss;Oo(n,"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph"),$n(n,"IMAGE:image_in"),$n(n,"NORM_RECT:norm_rect"),$t(n,"EMBEDDINGS:embeddings_out"),n.o(e),Mo(t,n),this.g.attachProtoListener("embeddings_out",(r,i)=>{r=EYe(r),this.embeddings=function(s){return{embeddings:$u(s,SYe,1).map(o=>{const a={headIndex:fa(o,3)??0??-1,headName:Ta(o,4)??""??""};if(Kue(o,zz,Gx(o,1))!==void 0)o=$h(o=zt(o,zz,Gx(o,1)),1,Vf,Fh()),a.floatEmbedding=o.slice();else{const c=new Uint8Array(0);a.quantizedEmbedding=zt(o,_Ye,Gx(o,2))?.oa()?.h()??c}return a}),timestampMs:w3(kv(s,2))??0}}(r),je(this,i)}),this.g.attachEmptyPacketListener("embeddings_out",r=>{je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};go.cosineSimilarity=function(t,e){if(t.floatEmbedding&&e.floatEmbedding)t=Zz(t.floatEmbedding,e.floatEmbedding);else{if(!t.quantizedEmbedding||!e.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");t=Zz(Qz(t.quantizedEmbedding),Qz(e.quantizedEmbedding))}return t},go.prototype.embedForVideo=go.prototype.Aa,go.prototype.embed=go.prototype.za,go.prototype.setOptions=go.prototype.o,go.createFromModelPath=function(t,e){return jt(go,t,{baseOptions:{modelAssetPath:e}})},go.createFromModelBuffer=function(t,e){return jt(go,t,{baseOptions:{modelAssetBuffer:e}})},go.createFromOptions=function(t,e){return jt(go,t,e)};var lO=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){this.confidenceMasks?.forEach(t=>{t.close()}),this.categoryMask?.close()}};function vW(t){t.categoryMask=void 0,t.confidenceMasks=void 0,t.qualityScores=void 0}function yW(t){try{const e=new lO(t.confidenceMasks,t.categoryMask,t.qualityScores);if(!t.j)return e;t.j(e)}finally{$R(t)}}lO.prototype.close=lO.prototype.close;var Xi=class extends eo{constructor(t,e){super(new ka(t,e),"image_in","norm_rect",!1),this.s=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new z9,this.v=new Xde,Ye(this.h,0,3,this.v),Ye(t=this.h,0,1,e=new rr)}get baseOptions(){return zt(this.h,rr,1)}set baseOptions(t){Ye(this.h,0,1,t)}o(t){return t.displayNamesLocale!==void 0?Fn(this.h,2,a0(t.displayNamesLocale)):"displayNamesLocale"in t&&Fn(this.h,2),"outputCategoryMask"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),"outputConfidenceMasks"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}I(){(function(t){const e=$u(t.da(),Ss,1).filter(n=>(Ta(n,1)??"").includes("mediapipe.tasks.TensorsToSegmentationCalculator"));if(t.s=[],e.length>1)throw Error("The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.");e.length===1&&(zt(e[0],xo,7)?.l()?.g()??new Map).forEach((n,r)=>{t.s[Number(r)]=Ta(n,1)??""})})(this)}segment(t,e,n){const r=typeof e!="function"?e:{};return this.j=typeof e=="function"?e:n,vW(this),xa(this,t,r),yW(this)}Ma(t,e,n,r){const i=typeof n!="function"?n:{};return this.j=typeof n=="function"?n:r,vW(this),vl(this,t,i,e),yW(this)}Da(){return this.s}m(){var t=new ro;zn(t,"image_in"),zn(t,"norm_rect");const e=new xo;dc(e,Qde,this.h);const n=new Ss;Oo(n,"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph"),$n(n,"IMAGE:image_in"),$n(n,"NORM_RECT:norm_rect"),n.o(e),Mo(t,n),FR(this,t),this.outputConfidenceMasks&&(Zt(t,"confidence_masks"),$t(n,"CONFIDENCE_MASKS:confidence_masks"),Av(this,"confidence_masks"),this.g.ca("confidence_masks",(r,i)=>{this.confidenceMasks=r.map(s=>Ov(this,s,!0,!this.j)),je(this,i)}),this.g.attachEmptyPacketListener("confidence_masks",r=>{this.confidenceMasks=[],je(this,r)})),this.outputCategoryMask&&(Zt(t,"category_mask"),$t(n,"CATEGORY_MASK:category_mask"),Av(this,"category_mask"),this.g.U("category_mask",(r,i)=>{this.categoryMask=Ov(this,r,!1,!this.j),je(this,i)}),this.g.attachEmptyPacketListener("category_mask",r=>{this.categoryMask=void 0,je(this,r)})),Zt(t,"quality_scores"),$t(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(r,i)=>{this.qualityScores=r,je(this,i)}),this.g.attachEmptyPacketListener("quality_scores",r=>{this.categoryMask=void 0,je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Xi.prototype.getLabels=Xi.prototype.Da,Xi.prototype.segmentForVideo=Xi.prototype.Ma,Xi.prototype.segment=Xi.prototype.segment,Xi.prototype.setOptions=Xi.prototype.o,Xi.createFromModelPath=function(t,e){return jt(Xi,t,{baseOptions:{modelAssetPath:e}})},Xi.createFromModelBuffer=function(t,e){return jt(Xi,t,{baseOptions:{modelAssetBuffer:e}})},Xi.createFromOptions=function(t,e){return jt(Xi,t,e)};var uO=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){this.confidenceMasks?.forEach(t=>{t.close()}),this.categoryMask?.close()}};uO.prototype.close=uO.prototype.close;var BYe=class extends He{constructor(t){super(t)}},qm=[0,Er,-2],k3=[0,tu,-3,er,tu,-1],bW=[0,k3],_W=[0,k3,Er,-1],Jx=class extends He{constructor(t){super(t)}},SW=[0,tu,-1,er],HYe=class extends He{constructor(t){super(t)}},EW=class extends He{constructor(t){super(t)}},dO=[1,2,3,4,5,6,7,8,9,10,14,15],mfe=class extends He{constructor(t){super(t)}};mfe.prototype.g=DR([0,ni,[0,dO,gn,k3,gn,[0,k3,qm],gn,bW,gn,[0,bW,qm],gn,SW,gn,[0,tu,-3,er,Ra],gn,[0,tu,-3,er],gn,[0,fn,tu,-2,er,Er,er,-1,2,tu,qm],gn,_W,gn,[0,_W,qm],tu,qm,fn,gn,[0,tu,-3,er,qm,-1],gn,[0,ni,SW]],fn,[0,fn,Er,-1,er]]);var xc=class extends eo{constructor(t,e){super(new ka(t,e),"image_in","norm_rect_in",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new z9,this.s=new Xde,Ye(this.h,0,3,this.s),Ye(t=this.h,0,1,e=new rr)}get baseOptions(){return zt(this.h,rr,1)}set baseOptions(t){Ye(this.h,0,1,t)}o(t){return"outputCategoryMask"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),"outputConfidenceMasks"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}segment(t,e,n,r){const i=typeof n!="function"?n:{};this.j=typeof n=="function"?n:r,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,n=this.B+1,r=new mfe;const s=new EW;var o=new BYe;if(sl(o,1,255),Ye(s,0,12,o),e.keypoint&&e.scribble)throw Error("Cannot provide both keypoint and scribble.");if(e.keypoint){var a=new Jx;Xb(a,3,!0),Ve(a,1,e.keypoint.x),Ve(a,2,e.keypoint.y),Xy(s,5,dO,a)}else{if(!e.scribble)throw Error("Must provide either a keypoint or a scribble.");for(a of(o=new HYe,e.scribble))Xb(e=new Jx,3,!0),Ve(e,1,a.x),Ve(e,2,a.y),C3(o,1,Jx,e);Xy(s,15,dO,o)}C3(r,1,EW,s),this.g.addProtoToStream(r.g(),"drishti.RenderData","roi_in",n),xa(this,t,i);e:{try{const l=new uO(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var c=l;break e}this.j(l)}finally{$R(this)}c=void 0}return c}m(){var t=new ro;zn(t,"image_in"),zn(t,"roi_in"),zn(t,"norm_rect_in");const e=new xo;dc(e,Qde,this.h);const n=new Ss;Oo(n,"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph"),$n(n,"IMAGE:image_in"),$n(n,"ROI:roi_in"),$n(n,"NORM_RECT:norm_rect_in"),n.o(e),Mo(t,n),FR(this,t),this.outputConfidenceMasks&&(Zt(t,"confidence_masks"),$t(n,"CONFIDENCE_MASKS:confidence_masks"),Av(this,"confidence_masks"),this.g.ca("confidence_masks",(r,i)=>{this.confidenceMasks=r.map(s=>Ov(this,s,!0,!this.j)),je(this,i)}),this.g.attachEmptyPacketListener("confidence_masks",r=>{this.confidenceMasks=[],je(this,r)})),this.outputCategoryMask&&(Zt(t,"category_mask"),$t(n,"CATEGORY_MASK:category_mask"),Av(this,"category_mask"),this.g.U("category_mask",(r,i)=>{this.categoryMask=Ov(this,r,!1,!this.j),je(this,i)}),this.g.attachEmptyPacketListener("category_mask",r=>{this.categoryMask=void 0,je(this,r)})),Zt(t,"quality_scores"),$t(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(r,i)=>{this.qualityScores=r,je(this,i)}),this.g.attachEmptyPacketListener("quality_scores",r=>{this.categoryMask=void 0,je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};xc.prototype.segment=xc.prototype.segment,xc.prototype.setOptions=xc.prototype.o,xc.createFromModelPath=function(t,e){return jt(xc,t,{baseOptions:{modelAssetPath:e}})},xc.createFromModelBuffer=function(t,e){return jt(xc,t,{baseOptions:{modelAssetBuffer:e}})},xc.createFromOptions=function(t,e){return jt(xc,t,e)};var Xo=class extends eo{constructor(t,e){super(new ka(t,e),"input_frame_gpu","norm_rect",!1),this.j={detections:[]},Ye(t=this.h=new Zde,0,1,e=new rr)}get baseOptions(){return zt(this.h,rr,1)}set baseOptions(t){Ye(this.h,0,1,t)}o(t){return t.displayNamesLocale!==void 0?Fn(this.h,2,a0(t.displayNamesLocale)):"displayNamesLocale"in t&&Fn(this.h,2),t.maxResults!==void 0?sl(this.h,3,t.maxResults):"maxResults"in t&&Fn(this.h,3),t.scoreThreshold!==void 0?Ve(this.h,4,t.scoreThreshold):"scoreThreshold"in t&&Fn(this.h,4),t.categoryAllowlist!==void 0?T3(this.h,5,t.categoryAllowlist):"categoryAllowlist"in t&&Fn(this.h,5),t.categoryDenylist!==void 0?T3(this.h,6,t.categoryDenylist):"categoryDenylist"in t&&Fn(this.h,6),this.l(t)}D(t,e){return this.j={detections:[]},xa(this,t,e),this.j}F(t,e,n){return this.j={detections:[]},vl(this,t,n,e),this.j}m(){var t=new ro;zn(t,"input_frame_gpu"),zn(t,"norm_rect"),Zt(t,"detections");const e=new xo;dc(e,DYe,this.h);const n=new Ss;Oo(n,"mediapipe.tasks.vision.ObjectDetectorGraph"),$n(n,"IMAGE:input_frame_gpu"),$n(n,"NORM_RECT:norm_rect"),$t(n,"DETECTIONS:detections"),n.o(e),Mo(t,n),this.g.attachProtoVectorListener("detections",(r,i)=>{for(const s of r)r=xde(s),this.j.detections.push(tfe(r));je(this,i)}),this.g.attachEmptyPacketListener("detections",r=>{je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Xo.prototype.detectForVideo=Xo.prototype.F,Xo.prototype.detect=Xo.prototype.D,Xo.prototype.setOptions=Xo.prototype.o,Xo.createFromModelPath=async function(t,e){return jt(Xo,t,{baseOptions:{modelAssetPath:e}})},Xo.createFromModelBuffer=function(t,e){return jt(Xo,t,{baseOptions:{modelAssetBuffer:e}})},Xo.createFromOptions=function(t,e){return jt(Xo,t,e)};var fO=class{constructor(t,e,n){this.landmarks=t,this.worldLandmarks=e,this.segmentationMasks=n}close(){this.segmentationMasks?.forEach(t=>{t.close()})}};function wW(t){t.landmarks=[],t.worldLandmarks=[],t.segmentationMasks=void 0}function CW(t){try{const e=new fO(t.landmarks,t.worldLandmarks,t.segmentationMasks);if(!t.s)return e;t.s(e)}finally{$R(t)}}fO.prototype.close=fO.prototype.close;var vo=class extends eo{constructor(t,e){super(new ka(t,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,Ye(t=this.h=new efe,0,1,e=new rr),this.v=new Kde,Ye(this.h,0,3,this.v),this.j=new Gde,Ye(this.h,0,2,this.j),sl(this.j,4,1),Ve(this.j,2,.5),Ve(this.v,2,.5),Ve(this.h,4,.5)}get baseOptions(){return zt(this.h,rr,1)}set baseOptions(t){Ye(this.h,0,1,t)}o(t){return"numPoses"in t&&sl(this.j,4,t.numPoses??1),"minPoseDetectionConfidence"in t&&Ve(this.j,2,t.minPoseDetectionConfidence??.5),"minTrackingConfidence"in t&&Ve(this.h,4,t.minTrackingConfidence??.5),"minPosePresenceConfidence"in t&&Ve(this.v,2,t.minPosePresenceConfidence??.5),"outputSegmentationMasks"in t&&(this.outputSegmentationMasks=t.outputSegmentationMasks??!1),this.l(t)}D(t,e,n){const r=typeof e!="function"?e:{};return this.s=typeof e=="function"?e:n,wW(this),xa(this,t,r),CW(this)}F(t,e,n,r){const i=typeof n!="function"?n:{};return this.s=typeof n=="function"?n:r,wW(this),vl(this,t,i,e),CW(this)}m(){var t=new ro;zn(t,"image_in"),zn(t,"norm_rect"),Zt(t,"normalized_landmarks"),Zt(t,"world_landmarks"),Zt(t,"segmentation_masks");const e=new xo;dc(e,NYe,this.h);const n=new Ss;Oo(n,"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph"),$n(n,"IMAGE:image_in"),$n(n,"NORM_RECT:norm_rect"),$t(n,"NORM_LANDMARKS:normalized_landmarks"),$t(n,"WORLD_LANDMARKS:world_landmarks"),n.o(e),Mo(t,n),FR(this,t),this.g.attachProtoVectorListener("normalized_landmarks",(r,i)=>{this.landmarks=[];for(const s of r)r=Y_(s),this.landmarks.push(jR(r));je(this,i)}),this.g.attachEmptyPacketListener("normalized_landmarks",r=>{this.landmarks=[],je(this,r)}),this.g.attachProtoVectorListener("world_landmarks",(r,i)=>{this.worldLandmarks=[];for(const s of r)r=Yg(s),this.worldLandmarks.push(Qy(r));je(this,i)}),this.g.attachEmptyPacketListener("world_landmarks",r=>{this.worldLandmarks=[],je(this,r)}),this.outputSegmentationMasks&&($t(n,"SEGMENTATION_MASK:segmentation_masks"),Av(this,"segmentation_masks"),this.g.ca("segmentation_masks",(r,i)=>{this.segmentationMasks=r.map(s=>Ov(this,s,!0,!this.s)),je(this,i)}),this.g.attachEmptyPacketListener("segmentation_masks",r=>{this.segmentationMasks=[],je(this,r)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};vo.prototype.detectForVideo=vo.prototype.F,vo.prototype.detect=vo.prototype.D,vo.prototype.setOptions=vo.prototype.o,vo.createFromModelPath=function(t,e){return jt(vo,t,{baseOptions:{modelAssetPath:e}})},vo.createFromModelBuffer=function(t,e){return jt(vo,t,{baseOptions:{modelAssetBuffer:e}})},vo.createFromOptions=function(t,e){return jt(vo,t,e)},vo.POSE_CONNECTIONS=pfe;var VYe=()=>typeof OffscreenCanvas<"u";async function TW(t){return new Promise(e=>setTimeout(e,t))}async function qYe(t){await TW(10);const n=Date.now();for(;Date.now()-n<500;){const{width:r,height:i}=t.getSettings();if(r&&i)return{width:r,height:i};await TW(50)}return{width:void 0,height:void 0}}function x3(t,e){if(VYe())return new OffscreenCanvas(t,e);const n=document.createElement("canvas");return n.width=t,n.height=e,n}var gfe=class vfe{constructor(e,n,r={}){this.useStreamFallback=!1,this.processingEnabled=!1;var i;this.name=n,this.transformer=e,this.maxFps=(i=r.maxFps)!=null?i:30}static get isSupported(){const e=typeof MediaStreamTrackGenerator<"u"&&typeof MediaStreamTrackProcessor<"u",n=typeof HTMLCanvasElement<"u"&&typeof VideoFrame<"u"&&"captureStream"in HTMLCanvasElement.prototype;return e||n}static get hasModernApiSupport(){return typeof MediaStreamTrackGenerator<"u"&&typeof MediaStreamTrackProcessor<"u"}async setup(e){this.source=e.track;const{width:n,height:r}=await qYe(this.source);if(this.sourceDummy=e.element,!(this.sourceDummy instanceof HTMLVideoElement))throw TypeError("Currently only video transformers are supported");if(this.sourceDummy instanceof HTMLVideoElement&&(this.sourceDummy.height=r??300,this.sourceDummy.width=n??300),this.useStreamFallback=!vfe.hasModernApiSupport,this.useStreamFallback){const i=document.querySelector('canvas[data-livekit-processor="'+this.name+'"]');i?(this.displayCanvas=i,this.displayCanvas.width=n??300,this.displayCanvas.height=r??300):(this.displayCanvas=document.createElement("canvas"),this.displayCanvas.width=n??300,this.displayCanvas.height=r??300,this.displayCanvas.style.display="none",this.displayCanvas.dataset.livekitProcessor=this.name,document.body.appendChild(this.displayCanvas)),this.renderContext=this.displayCanvas.getContext("2d"),this.capturedStream=this.displayCanvas.captureStream(),this.canvas=x3(n??300,r??300)}else this.processor=new MediaStreamTrackProcessor({track:this.source}),this.trackGenerator=new MediaStreamTrackGenerator({kind:"video",signalTarget:this.source}),this.canvas=x3(n??300,r??300)}async init(e){if(await this.setup(e),!this.canvas)throw new TypeError("Expected canvas to be defined after setup");await this.transformer.init({outputCanvas:this.canvas,inputElement:this.sourceDummy}),this.useStreamFallback?this.initFallbackPath():this.initStreamProcessorPath()}initStreamProcessorPath(){if(!this.processor||!this.trackGenerator)throw new TypeError("Expected processor and trackGenerator to be defined for stream processor path");const n=this.processor.readable.pipeThrough(this.transformer.transformer),r=Symbol("stream");this.symbol=r,n.pipeTo(this.trackGenerator.writable).then(()=>this.destroy(r)).catch(i=>{i instanceof DOMException&&i.name==="AbortError"?console.log("stream processor path aborted"):(console.error("error when trying to pipe",i),this.destroy(r))}),this.processedTrack=this.trackGenerator}initFallbackPath(){if(!this.capturedStream||!this.source||!this.canvas||!this.renderContext)throw new TypeError("Missing required components for fallback implementation");this.processedTrack=this.capturedStream.getVideoTracks()[0],this.processingEnabled=!0,this.frameCallback=e=>{if(!this.processingEnabled||!e){e.close();return}const n={enqueue:r=>{this.renderContext&&this.displayCanvas&&(this.renderContext.drawImage(r,0,0,this.displayCanvas.width,this.displayCanvas.height),r.close())}};try{this.transformer.transform(e,n)}catch(r){console.error("Error in transform:",r),e.close()}},this.startRenderLoop()}startRenderLoop(){if(!this.sourceDummy||!(this.sourceDummy instanceof HTMLVideoElement))return;let e=-1,n=0;const r=this.sourceDummy,i=1e3/this.maxFps;let s=this.maxFps,o=[],a=0,c=0,l=0;const d=()=>{if(!this.processingEnabled||!this.sourceDummy||!(this.sourceDummy instanceof HTMLVideoElement))return;if(this.sourceDummy.paused){console.warn("Video is paused, trying to play"),this.sourceDummy.play();return}const h=r.currentTime,m=performance.now(),g=m-n,y=h!==e;if(y){if(a>0){const w=m-a;o.push(w),o.length>10&&o.shift(),o.length>2&&(s=1e3/(o.reduce((x,T)=>x+T,0)/o.length),(typeof window<"u"&&window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&m-l>5e3&&(console.debug(`[${this.name}] Estimated video FPS: ${s.toFixed(1)}, Processing at: ${(c/5).toFixed(1)} FPS`),c=0,l=m))}a=m}const v=g>=i;if(y&&v){e=h,n=m,c++;try{if(r.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA){const w=new VideoFrame(r);this.frameCallback?this.frameCallback(w):w.close()}}catch(w){console.error("Error in render loop:",w)}}this.animationFrameId=requestAnimationFrame(d)};this.animationFrameId=requestAnimationFrame(d)}async restart(e){await this.destroy(),await this.init(e)}async restartTransformer(...e){await this.transformer.restart(e[0])}async updateTransformerOptions(...e){await this.transformer.update(e[0])}async destroy(e){var n,r,i,s;e&&this.symbol!==e||(this.useStreamFallback?(this.processingEnabled=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=void 0),this.displayCanvas&&this.displayCanvas.parentNode&&this.displayCanvas.parentNode.removeChild(this.displayCanvas),(n=this.capturedStream)==null||n.getTracks().forEach(o=>o.stop())):(await((i=(r=this.processor)==null?void 0:r.writableControl)==null?void 0:i.close()),(s=this.trackGenerator)==null||s.stop()),await this.transformer.destroy())}},GYe={"@mediapipe/tasks-vision":"0.10.14"};function Eh(t,e){const n=t.TEXTURE0+e;t.activeTexture(n);const r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.bindTexture(t.TEXTURE_2D,r),r}function xf(t,e,n){const r=t.createShader(e);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw console.error("Shader compile failed:",t.getShaderInfoLog(r)),t.deleteShader(r),new Error("Shader compile failed");return r}function qR(t,e,n){const r=t.createProgram();if(t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw console.error("Program link failed:",t.getProgramInfoLog(r)),new Error("Program link failed");return r}function J1(t,e,n,r){const i=t.createFramebuffer();if(t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,r,0,t.RGBA,t.UNSIGNED_BYTE,null),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer not complete");return t.bindFramebuffer(t.FRAMEBUFFER,null),i}function KYe(t){const e=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,-1,-1,1,1,1,-1]),t.STATIC_DRAW),e}async function zYe(t,e,n){const r=t.width/t.height,i=e/n;let s=0,o=0,a=t.width,c=t.height;return r>i?(a=Math.round(t.height*i),s=Math.round((t.width-a)/2)):r<i&&(c=Math.round(t.width/i),o=Math.round((t.height-c)/2)),createImageBitmap(t,s,o,a,c,{resizeWidth:e,resizeHeight:n,resizeQuality:"medium"})}var wh;function Qx(){return wh||(wh=new ImageData(2,2),wh.data[0]=0,wh.data[1]=0,wh.data[2]=0,wh.data[3]=0),wh}var aD=t=>t,cD=(t=!0)=>`#version 300 es
  in vec2 position;
  out vec2 texCoords;

  void main() {
    texCoords = (position + 1.0) / 2.0;
    texCoords.y = ${t?"1.0 - texCoords.y":"texCoords.y"};
    gl_Position = vec4(position, 0, 1.0);
  }
`,WYe=aD`#version 300 es
  precision mediump float;
  in vec2 texCoords;
  uniform sampler2D u_texture;
  uniform vec2 u_texelSize;
  uniform vec2 u_direction;
  uniform float u_radius;
  out vec4 fragColor;

  void main() {
    float sigma = u_radius;
    float twoSigmaSq = 2.0 * sigma * sigma;
    float totalWeight = 0.0;
    vec3 result = vec3(0.0);
    const int MAX_SAMPLES = 16;
    int radius = int(min(float(MAX_SAMPLES), ceil(u_radius)));

    for (int i = -MAX_SAMPLES; i <= MAX_SAMPLES; ++i) {
      float offset = float(i);
      if (abs(offset) > float(radius)) continue;
      float weight = exp(-(offset * offset) / twoSigmaSq);
      vec2 sampleCoord = texCoords + u_direction * u_texelSize * offset;
      result += texture(u_texture, sampleCoord).rgb * weight;
      totalWeight += weight;
    }

    fragColor = vec4(result / totalWeight, 1.0);
  }
`;function YYe(t){const e=xf(t,t.VERTEX_SHADER,cD()),n=xf(t,t.FRAGMENT_SHADER,WYe),r=qR(t,e,n),i={position:t.getAttribLocation(r,"position"),texture:t.getUniformLocation(r,"u_texture"),texelSize:t.getUniformLocation(r,"u_texelSize"),direction:t.getUniformLocation(r,"u_direction"),radius:t.getUniformLocation(r,"u_radius")};return{program:r,shader:n,vertexShader:e,uniforms:i}}function RW(t,e,n,r,i,s,o,a,c,l){t.useProgram(s),t.bindBuffer(t.ARRAY_BUFFER,a),t.vertexAttribPointer(o.position,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o.position);const d=1/n,h=1/r;return t.bindFramebuffer(t.FRAMEBUFFER,c[0]),t.viewport(0,0,n,r),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.uniform1i(o.texture,0),t.uniform2f(o.texelSize,d,h),t.uniform2f(o.direction,1,0),t.uniform1f(o.radius,i),t.drawArrays(t.TRIANGLES,0,6),t.bindFramebuffer(t.FRAMEBUFFER,c[1]),t.viewport(0,0,n,r),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,l[0]),t.uniform1i(o.texture,0),t.uniform2f(o.direction,0,1),t.drawArrays(t.TRIANGLES,0,6),t.bindFramebuffer(t.FRAMEBUFFER,null),l[1]}var XYe=aD`#version 300 es
precision mediump float;

in vec2 texCoords;

uniform sampler2D u_texture;
uniform vec2 u_texelSize;    // 1.0 / texture size
uniform vec2 u_direction;    // (1.0, 0.0) for horizontal, (0.0, 1.0) for vertical
uniform float u_radius;      // blur radius in texels

out vec4 fragColor;

void main() {
    vec3 sum = vec3(0.0);
    float count = 0.0;

    // Limit radius to avoid excessive loop cost
    const int MAX_RADIUS = 16;
    int radius = int(min(float(MAX_RADIUS), u_radius));

    for (int i = -MAX_RADIUS; i <= MAX_RADIUS; ++i) {
        if (abs(i) > radius) continue;

        vec2 offset = u_direction * u_texelSize * float(i);
        sum += texture(u_texture, texCoords + offset).rgb;
        count += 1.0;
  }

  fragColor = vec4(sum / count, 1.0);
}
`;function JYe(t){const e=xf(t,t.VERTEX_SHADER,cD()),n=xf(t,t.FRAGMENT_SHADER,XYe),r=qR(t,e,n),i={position:t.getAttribLocation(r,"position"),texture:t.getUniformLocation(r,"u_texture"),texelSize:t.getUniformLocation(r,"u_texelSize"),direction:t.getUniformLocation(r,"u_direction"),radius:t.getUniformLocation(r,"u_radius")};return{program:r,vertexShader:e,fragmentShader:n,uniforms:i}}var QYe=aD`#version 300 es
  precision mediump float;
  in vec2 texCoords;
  uniform sampler2D background;
  uniform sampler2D frame;
  uniform sampler2D mask;
  out vec4 fragColor;
  
  void main() {
      
    vec4 frameTex = texture(frame, texCoords);
    vec4 bgTex = texture(background, texCoords);

    float maskVal = texture(mask, texCoords).r;

    // Compute screen-space gradient to detect edge sharpness
    float grad = length(vec2(dFdx(maskVal), dFdy(maskVal)));

    float edgeSoftness = 2.0; // higher = softer
    
    // Create a smooth edge around binary transition
    float smoothAlpha = smoothstep(0.5 - grad * edgeSoftness, 0.5 + grad * edgeSoftness, maskVal);

    // Optional: preserve frame alpha, or override as fully opaque
    vec4 blended = mix(bgTex, vec4(frameTex.rgb, 1.0), 1.0 - smoothAlpha);
    
    fragColor = blended;
  
  }
`;function ZYe(t){const e=xf(t,t.VERTEX_SHADER,cD()),n=xf(t,t.FRAGMENT_SHADER,QYe),r=qR(t,e,n),i={position:t.getAttribLocation(r,"position")},s={mask:t.getUniformLocation(r,"mask"),frame:t.getUniformLocation(r,"frame"),background:t.getUniformLocation(r,"background"),stepWidth:t.getUniformLocation(r,"u_stepWidth")};return{program:r,vertexShader:e,fragmentShader:n,attribLocations:i,uniformLocations:s}}function eXe(t,e,n){const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const s=`
      attribute vec2 position;
      varying vec2 v_uv;
      void main() {
        v_uv = (position + 1.0) * 0.5;
        gl_Position = vec4(position, 0.0, 1.0);
      }
    `,o=`
      precision mediump float;
      varying vec2 v_uv;
      uniform sampler2D u_texture;
      void main() {
        gl_FragColor = texture2D(u_texture, v_uv);
      }
    `,a=xf(t,t.VERTEX_SHADER,s),c=xf(t,t.FRAGMENT_SHADER,o),l=qR(t,a,c),d={texture:t.getUniformLocation(l,"u_texture"),position:t.getAttribLocation(l,"position")};return{framebuffer:i,texture:r,program:l,uniforms:d}}function tXe(t,e,n,r,i,s){return t.useProgram(n.program),t.bindFramebuffer(t.FRAMEBUFFER,n.framebuffer),t.viewport(0,0,i,s),t.bindBuffer(t.ARRAY_BUFFER,r),t.enableVertexAttribArray(n.uniforms.position),t.vertexAttribPointer(n.uniforms.position,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.uniform1i(n.uniforms.texture,0),t.drawArrays(t.TRIANGLES,0,6),t.bindFramebuffer(t.FRAMEBUFFER,null),n.texture}var IW=t=>{const e=t.getContext("webgl2",{antialias:!0,premultipliedAlpha:!0});let n=null,r=8;const i=4;if(!e){console.error("Failed to create WebGL context");return}e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);const s=ZYe(e),o=s.program,a=s.attribLocations.position,{mask:c,frame:l,background:d}=s.uniformLocations,h=YYe(e),m=h.program,g=h.uniforms,y=JYe(e),v=y.program,w=y.uniforms,S=Eh(e,0),R=Eh(e,1),x=KYe(e);if(!x)throw new Error("Failed to create vertex buffer");let T=[],I=[],k=[],A=0,O=1;T.push(Eh(e,3)),T.push(Eh(e,4));const D=Math.floor(t.width/i),N=Math.floor(t.height/i),U=eXe(e,D,N);I.push(J1(e,T[0],D,N)),I.push(J1(e,T[1],D,N));const $=Eh(e,5),K=J1(e,$,t.width,t.height);k.push(Eh(e,6)),k.push(Eh(e,7));const Y=[J1(e,k[0],t.width,t.height),J1(e,k[1],t.width,t.height)];e.useProgram(o),e.uniform1i(d,0),e.uniform1i(l,1),e.uniform1i(c,2);let G=Qx();function F(X){if(X.codedWidth===0||k.length===0)return;const ne=X.displayWidth,fe=X.displayHeight;e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,R),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,X);let ye=S;if(n){const Ae=tXe(e,R,U,x,D,N);ye=RW(e,Ae,D,N,n,m,g,x,I,T)}else e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,S),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,G),ye=S;e.viewport(0,0,ne,fe),e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(o),e.bindBuffer(e.ARRAY_BUFFER,x),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,ye),e.uniform1i(d,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,R),e.uniform1i(l,1),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,k[A]),e.uniform1i(c,2),e.drawArrays(e.TRIANGLES,0,6)}async function q(X){if(G=Qx(),X)try{G=await zYe(X,t.width,t.height)}catch(ne){console.error("Error processing background image, falling back to black background:",ne)}e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,S),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,G)}function z(X){n=X?Math.max(1,Math.floor(X/i)):null,q(null)}function W(X){const ne=[K,Y[O]],fe=[$,k[O]];RW(e,X,t.width,t.height,r,v,w,x,ne,fe),A=O,O=1-O}function V(){e.deleteProgram(o),e.deleteProgram(m),e.deleteProgram(v),e.deleteTexture(S),e.deleteTexture(R),e.deleteTexture($),e.deleteFramebuffer(K);for(const X of T)e.deleteTexture(X);for(const X of I)e.deleteFramebuffer(X);for(const X of k)e.deleteTexture(X);for(const X of Y)e.deleteFramebuffer(X);e.deleteBuffer(x),U&&(e.deleteTexture(U.texture),e.deleteFramebuffer(U.framebuffer),e.deleteProgram(U.program)),G&&(G instanceof ImageBitmap&&G.close(),G=Qx()),T=[],I=[],k=[]}return{renderFrame:F,updateMask:W,setBackgroundImage:q,setBlurRadius:z,cleanup:V}},yfe=class{constructor(){this.isDisabled=!1}async init({outputCanvas:t,inputElement:e}){if(!(e instanceof HTMLVideoElement))throw TypeError("Video transformer needs a HTMLVideoElement as input");this.transformer=new TransformStream({transform:(n,r)=>this.transform(n,r)}),this.canvas=t||null,t&&(this.gl=IW(this.canvas||x3(e.videoWidth,e.videoHeight))),this.inputVideo=e,this.isDisabled=!1}async restart({outputCanvas:t,inputElement:e}){var n;this.canvas=t||null,(n=this.gl)==null||n.cleanup(),this.gl=IW(this.canvas||x3(e.videoWidth,e.videoHeight)),this.inputVideo=e,this.isDisabled=!1}async destroy(){var t;this.isDisabled=!0,this.canvas=void 0,(t=this.gl)==null||t.cleanup(),this.gl=void 0}},bfe=class extends yfe{constructor(t){super(),this.backgroundImage=null,this.segmentationTimeMs=0,this.options=t,this.update(t)}static get isSupported(){return typeof OffscreenCanvas<"u"&&typeof VideoFrame<"u"&&typeof createImageBitmap<"u"&&!!document.createElement("canvas").getContext("webgl2")}async init({outputCanvas:t,inputElement:e}){var n,r,i,s,o,a;await super.init({outputCanvas:t,inputElement:e});const c=await Ph.forVisionTasks((r=(n=this.options.assetPaths)==null?void 0:n.tasksVisionFileSet)!=null?r:`https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@${GYe["@mediapipe/tasks-vision"]}/wasm`);this.imageSegmenter=await Xi.createFromOptions(c,{baseOptions:{modelAssetPath:(s=(i=this.options.assetPaths)==null?void 0:i.modelAssetPath)!=null?s:"https://storage.googleapis.com/mediapipe-models/image_segmenter/selfie_segmenter/float16/latest/selfie_segmenter.tflite",delegate:"GPU",...this.options.segmenterOptions},canvas:this.canvas,runningMode:"VIDEO",outputCategoryMask:!0,outputConfidenceMasks:!1}),(o=this.options)!=null&&o.imagePath&&!this.backgroundImage&&await this.loadBackground(this.options.imagePath).catch(l=>console.error("Error while loading processor background image: ",l)),this.options.blurRadius&&((a=this.gl)==null||a.setBlurRadius(this.options.blurRadius))}async destroy(){var t;await super.destroy(),await((t=this.imageSegmenter)==null?void 0:t.close()),this.backgroundImage=null}async loadBackground(t){var e;const n=new Image;await new Promise((i,s)=>{n.crossOrigin="Anonymous",n.onload=()=>i(n),n.onerror=o=>s(o),n.src=t});const r=await createImageBitmap(n);(e=this.gl)==null||e.setBackgroundImage(r)}async transform(t,e){var n,r;try{if(!(t instanceof VideoFrame)||t.codedWidth===0||t.codedHeight===0){console.debug("empty frame detected, ignoring");return}if(this.isDisabled){e.enqueue(t);return}const i=Date.now();if(!this.canvas)throw TypeError("Canvas needs to be initialized first");this.canvas.width=t.displayWidth,this.canvas.height=t.displayHeight;const s=new Promise((a,c)=>{var l;try{let d=performance.now();(l=this.imageSegmenter)==null||l.segmentForVideo(t,d,h=>{this.segmentationTimeMs=performance.now()-d,this.segmentationResults=h,this.updateMask(h.categoryMask),h.close(),a()})}catch(d){c(d)}}),o=performance.now();if(this.drawFrame(t),this.canvas&&this.canvas.width>0&&this.canvas.height>0){const a=new VideoFrame(this.canvas,{timestamp:t.timestamp||i});e.enqueue(a);const c=performance.now()-o,l={processingTimeMs:this.segmentationTimeMs+c,segmentationTimeMs:this.segmentationTimeMs,filterTimeMs:c};(r=(n=this.options).onFrameProcessed)==null||r.call(n,l)}else e.enqueue(t);await s}catch(i){console.error("Error while processing frame: ",i)}finally{t.close()}}async update(t){var e;this.options={...this.options,...t},t.blurRadius?(e=this.gl)==null||e.setBlurRadius(t.blurRadius):t.imagePath&&await this.loadBackground(t.imagePath)}async drawFrame(t){var e;this.gl&&((e=this.gl)==null||e.renderFrame(t))}async updateMask(t){var e;t&&((e=this.gl)==null||e.updateMask(t.getAsWebGLTexture()))}},nXe=()=>bfe.isSupported&&gfe.isSupported;const rXe=""+new URL("selfie_segmenter-DF05sdL4.tflite",import.meta.url).href,iXe={wasmLoaderPath:new URL(""+new URL("vision_wasm_internal-CEyeacG0.js",import.meta.url).href,import.meta.url).href,wasmBinaryPath:new URL(""+new URL("vision_wasm_internal-TmjHuG4I.wasm",import.meta.url).href,import.meta.url).href};class sXe extends bfe{async init({outputCanvas:e,inputElement:n}){await yfe.prototype.init.call(this,{outputCanvas:e,inputElement:n}),this.imageSegmenter=await Xi.createFromOptions(iXe,{baseOptions:{modelAssetPath:rXe,delegate:"GPU",...this.options.segmenterOptions},canvas:this.canvas,runningMode:"VIDEO",outputCategoryMask:!0,outputConfidenceMasks:!1}),this.options.blurRadius&&this.gl?.setBlurRadius(this.options.blurRadius)}}const _fe=_.createContext(void 0);function GR(){const t=_.use(_fe);if(t===void 0)throw new Error("useTrackProcessor must be used within a ProcessorProvider");return t}const Sfe=t=>{const{processor:e}=GR();_.useEffect(()=>{t&&(e&&!t.getProcessor()&&t.setProcessor(e),!e&&t.getProcessor()&&t.stopProcessor())},[e,t])},oXe=({children:t})=>{const[e]=Gn(xle),n=_.useMemo(()=>nXe(),[]),r=_.useMemo(()=>new gfe(new sXe({blurRadius:15}),"background-blur"),[]),i=_.useMemo(()=>({supported:n,processor:n&&e?r:void 0}),[n,e,r]);return E.jsx(_fe,{value:i,children:t})},aXe={},cXe={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_VERSION:"embedded-v0.16.3",VITE_PACKAGE:"embedded"},lXe=({client:t,livekitRoom:e})=>{const{t:n}=We(),[r,i]=Gn(Ile),[s,o]=Gn(B8),[a,c]=Gn(kle),[l,d]=Gn(Gb),[h,m]=Gn(Ole),[g,y]=Gn(Dle),[v,w]=Gn(V8),[S,R]=Gn(Mle),x=no(),T=_.useMemo(()=>{if(e?.engine.client.ws?.url){const I=new URL(e.engine.client.ws.url);return I.search="",I}return null},[e]);return E.jsxs(E.Fragment,{children:[E.jsx("p",{children:n("developer_mode.hostname",{hostname:window.location.hostname||"unknown"})}),E.jsx("p",{children:n("version",{productName:"Element Call",version:"embedded-v0.16.3"})}),E.jsx("p",{children:n("developer_mode.crypto_version",{version:t.getCrypto()?.getVersion()||"unknown"})}),E.jsx("p",{children:n("developer_mode.matrix_id",{id:t.getUserId()||"unknown"})}),E.jsx("p",{children:n("developer_mode.device_id",{id:t.getDeviceId()||"unknown"})}),E.jsx(yt,{children:E.jsx(Tn,{id:"duplicateTiles",type:"number",label:n("developer_mode.duplicate_tiles_label"),value:r.toString(),min:0,onChange:_.useCallback(I=>{const k=I.target.valueAsNumber;k<0||i(Number.isNaN(k)?0:k)},[i])})}),E.jsx(yt,{children:E.jsx(Tn,{id:"debugTileLayout",type:"checkbox",checked:s,label:n("developer_mode.debug_tile_layout_label"),onChange:I=>o(I.target.checked)})}),E.jsx(yt,{children:E.jsx(Tn,{id:"showNonMemberTiles",type:"checkbox",label:n("developer_mode.show_non_member_tiles"),checked:!!a,onChange:_.useCallback(I=>{c(I.target.checked)},[c])})}),E.jsx(yt,{children:E.jsx(Tn,{id:"showConnectionStats",type:"checkbox",label:n("developer_mode.show_connection_stats"),checked:!!l,onChange:_.useCallback(I=>{d(I.target.checked)},[d])})}),E.jsx(yt,{children:E.jsx(Tn,{id:"useNewMembershipManager",type:"checkbox",label:n("developer_mode.use_new_membership_manager"),checked:!!h,onChange:_.useCallback(I=>{m(I.target.checked)},[m])})}),E.jsx(yt,{children:E.jsx(Tn,{id:"useToDeviceKeyTransport",type:"checkbox",label:n("developer_mode.use_to_device_key_transport"),checked:!!v,onChange:_.useCallback(I=>{w(I.target.checked)},[w])})}),E.jsx(yt,{children:E.jsx(Tn,{id:"muteAllAudio",type:"checkbox",label:n("developer_mode.mute_all_audio"),checked:S,onChange:_.useCallback(I=>{R(I.target.checked)},[R])})})," ",E.jsxs(yt,{children:[E.jsx(Tn,{id:"alwaysShowIphoneEarpiece",type:"checkbox",label:n("developer_mode.always_show_iphone_earpiece"),checked:g,onChange:_.useCallback(I=>{y(I.target.checked)},[y])})," "]}),e?E.jsxs(E.Fragment,{children:[E.jsx("p",{children:n("developer_mode.livekit_sfu",{url:T?.href||"unknown"})}),E.jsx("p",{children:n("developer_mode.livekit_server_info")}),E.jsxs("pre",{className:aXe.pre,children:[e.serverInfo?JSON.stringify(e.serverInfo,null,2):"undefined",e.metadata]})]}):null,E.jsx("p",{children:n("developer_mode.environment_variables")}),E.jsx("pre",{children:JSON.stringify(cXe,null,2)}),E.jsx("p",{children:n("developer_mode.url_params")}),E.jsx("pre",{children:JSON.stringify(x,null,2)})]})},lD="audio",uD=({open:t,onDismiss:e,tab:n,onTabChange:r,client:i,roomId:s,livekitRoom:o})=>{const{t:a}=We(),c=()=>{const{supported:D}=GR(),[N,U]=Gn(xle);return E.jsxs(E.Fragment,{children:[E.jsx("h4",{children:a("settings.background_blur_header")}),E.jsx(yt,{children:E.jsx(Tn,{id:"activateBackgroundBlur",label:a("settings.background_blur_label"),description:D?"":a("settings.blur_not_supported_by_browser"),type:"checkbox",checked:!!N,onChange:$=>U($.target.checked),disabled:!D})})]})},l=Wu();_.useEffect(()=>{t&&l.requestDeviceNames()},[t,l]);const[d,h]=Gn(Lle),[m,g]=_.useState(d),[y]=Gn($8),{available:v}=hR(),{controlledAudioDevices:w}=no(),S=Qe(tue),R={key:"audio",name:a("common.audio"),content:E.jsx(E.Fragment,{children:E.jsxs(zq,{children:[!w&&E.jsx(Ux,{device:l.audioInput,title:a("settings.devices.microphone"),numberedLabel:D=>a("settings.devices.microphone_numbered",{n:D})}),S&&w&&E.jsx(Bt,{onClick:D=>{D.preventDefault(),window.controls.showNativeAudioDevicePicker?.(),window.controls.showNativeOutputDevicePicker?.()},children:a("settings.devices.change_device_button")}),E.jsx(Ux,{device:l.audioOutput,title:a("settings.devices.speaker"),numberedLabel:D=>a("settings.devices.speaker_numbered",{n:D})}),E.jsxs("div",{className:rz.volumeSlider,children:[E.jsx("label",{children:a("settings.audio_tab.effect_volume_label")}),E.jsx("p",{children:a("settings.audio_tab.effect_volume_description")}),E.jsx(Eue,{label:a("video_tile.volume"),value:m,onValueChange:g,onValueCommit:h,min:0,max:1,step:.01})]})]})})},x={key:"video",name:a("common.video"),content:E.jsxs(E.Fragment,{children:[E.jsx(zq,{children:E.jsx(Ux,{device:l.videoInput,title:a("settings.devices.camera"),numberedLabel:D=>a("settings.devices.camera_numbered",{n:D})})}),E.jsx(QM,{}),E.jsx(c,{})]})},T={key:"preferences",name:a("common.preferences"),content:E.jsx(kze,{})},I={key:"profile",name:a("common.profile"),content:E.jsx(WKe,{client:i})},k={key:"feedback",name:a("settings.feedback_tab_title"),content:E.jsx(XKe,{roomId:s})},A={key:"developer",name:a("settings.developer_tab_title"),content:E.jsx(lXe,{client:i,livekitRoom:o})},O=[R,x];return ut===null&&O.push(I),O.push(T),v&&O.push(k),y&&O.push(A),E.jsx(Up,{title:a("common.settings"),className:rz.settingsModal,open:t,onDismiss:e,tabbed:!0,children:E.jsx(RKe,{label:a("common.settings"),tab:n,onTabChange:r,tabs:O})})},uXe=(t,e)=>_.createElement("svg",{width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("mask",{id:"path-1-inside-1_898_2641",fill:"white"},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z"})),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z",fill:"white"}),_.createElement("path",{d:"M17.1502 20.1214L17.9339 21.2814L17.1502 20.1214ZM4.4 19.8008L3.55919 20.9202H3.55919L4.4 19.8008ZM17.1197 17.3237L18.0934 18.3296L18.7717 17.6731L18.4173 16.7981L17.1197 17.3237ZM4.88028 17.3237L3.58268 16.7981L3.22829 17.6731L3.90659 18.3296L4.88028 17.3237ZM11 23.4C13.5662 23.4 15.9541 22.619 17.9339 21.2814L16.3665 18.9613C14.835 19.9959 12.9902 20.6 11 20.6V23.4ZM3.55919 20.9202C5.63176 22.477 8.21011 23.4 11 23.4V20.6C8.83723 20.6 6.84514 19.8865 5.24081 18.6814L3.55919 20.9202ZM-1.4 11C-1.4 15.0577 0.55052 18.6603 3.55919 20.9202L5.24081 18.6814C2.90591 16.9276 1.4 14.1399 1.4 11H-1.4ZM11 -1.4C4.15167 -1.4 -1.4 4.15167 -1.4 11H1.4C1.4 5.69807 5.69807 1.4 11 1.4V-1.4ZM23.4 11C23.4 4.15167 17.8483 -1.4 11 -1.4V1.4C16.3019 1.4 20.6 5.69807 20.6 11H23.4ZM17.9339 21.2814C21.2288 19.0554 23.4 15.2815 23.4 11H20.6C20.6 14.3124 18.9236 17.2337 16.3665 18.9613L17.9339 21.2814ZM12.9 7.975C12.9 9.28384 11.9459 10.15 11 10.15V12.95C13.6991 12.95 15.7 10.615 15.7 7.975H12.9ZM11 5.8C11.9459 5.8 12.9 6.66616 12.9 7.975H15.7C15.7 5.335 13.6991 3 11 3V5.8ZM9.1 7.975C9.1 6.66616 10.0541 5.8 11 5.8V3C8.30086 3 6.3 5.335 6.3 7.975H9.1ZM11 10.15C10.0541 10.15 9.1 9.28384 9.1 7.975H6.3C6.3 10.615 8.30086 12.95 11 12.95V10.15ZM16.146 16.3178C14.8129 17.6081 13.0004 18.4 11 18.4V21.2C13.756 21.2 16.2591 20.1051 18.0934 18.3296L16.146 16.3178ZM11 14.6C13.1797 14.6 15.0494 15.9415 15.8221 17.8493L18.4173 16.7981C17.2312 13.8697 14.359 11.8 11 11.8V14.6ZM6.17788 17.8493C6.95058 15.9415 8.8203 14.6 11 14.6V11.8C7.64102 11.8 4.7688 13.8697 3.58268 16.7981L6.17788 17.8493ZM11 18.4C8.99963 18.4 7.18709 17.6081 5.85397 16.3178L3.90659 18.3296C5.74088 20.1051 8.24402 21.2 11 21.2V18.4Z",fill:"white",mask:"url(#path-1-inside-1_898_2641)"})),kW=_.forwardRef(uXe),dXe=(t,e)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.0988 9.01625C20.3188 9.59375 20.8825 9.97875 21.5013 9.97875C22.3263 9.97875 23 10.6525 23 11.4775V12.5225C23 13.3475 22.3263 14.0213 21.5013 14.0213C20.8825 14.0213 20.3188 14.4062 20.0988 14.9838C20.0806 15.0292 20.0624 15.0753 20.0441 15.1218C19.9792 15.2863 19.9125 15.4555 19.8375 15.6163C19.5763 16.18 19.7 16.84 20.14 17.28C20.7313 17.8575 20.7313 18.8062 20.14 19.3975L19.3975 20.14C18.82 20.7313 17.8713 20.7313 17.28 20.14C16.8538 19.7 16.18 19.5763 15.6163 19.8375C15.41 19.9338 15.2037 20.0163 14.9838 20.0988C14.4062 20.3188 14.0213 20.8825 14.0213 21.5013C14.0213 22.3263 13.3475 23 12.5225 23H11.4775C10.6525 23 9.97875 22.3263 9.97875 21.5013C9.97875 20.8825 9.59375 20.3188 9.01625 20.0988C8.97079 20.0806 8.92466 20.0624 8.87815 20.044C8.71368 19.9792 8.54454 19.9125 8.38375 19.8375C7.82 19.5763 7.16 19.7 6.72 20.14C6.1425 20.7313 5.19375 20.7313 4.6025 20.14L3.86 19.3975C3.26875 18.82 3.26875 17.8713 3.86 17.28C4.3 16.8538 4.42375 16.18 4.1625 15.6163C4.06625 15.41 3.98375 15.2037 3.90125 14.9838C3.68125 14.4062 3.1175 14.0213 2.49875 14.0213C1.67375 14.0213 1 13.3475 1 12.5225V11.4775C1 10.6525 1.67375 9.97875 2.49875 9.97875C3.1175 9.97875 3.68125 9.59375 3.90125 9.01625C3.94464 8.87742 3.99897 8.74406 4.0539 8.60926C4.086 8.53046 4.11831 8.45117 4.14875 8.37C4.41 7.80625 4.28625 7.14625 3.84625 6.70625C3.255 6.12875 3.255 5.18 3.84625 4.58875L4.6025 3.86C5.18 3.26875 6.12875 3.26875 6.72 3.86C7.14625 4.3 7.82 4.42375 8.38375 4.1625C8.59 4.06625 8.79625 3.97 9.01625 3.90125C9.59375 3.68125 9.97875 3.1175 9.97875 2.49875C9.97875 1.67375 10.6525 1 11.4775 1H12.5225C13.3475 1 14.0213 1.67375 14.0213 2.49875C14.0213 3.13125 14.4062 3.68125 14.9838 3.90125C15.0292 3.91943 15.0753 3.93762 15.1218 3.95595C15.2863 4.02079 15.4555 4.08746 15.6163 4.1625C16.18 4.42375 16.84 4.3 17.28 3.86C17.8575 3.26875 18.8062 3.26875 19.3975 3.86L20.14 4.6025C20.7313 5.18 20.7313 6.12875 20.14 6.72C19.7 7.14625 19.5763 7.82 19.8375 8.38375C19.9338 8.59 20.0163 8.79625 20.0988 9.01625ZM12 17.5C8.96125 17.5 6.5 15.0387 6.5 12C6.5 8.96125 8.96125 6.5 12 6.5C15.0387 6.5 17.5 8.96125 17.5 12C17.5 15.0387 15.0387 17.5 12 17.5Z",fill:"#ffffff"})),fXe=_.forwardRef(dXe),hXe=(t,e)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.49966 2.38889C7.49966 1.89797 7.89763 1.5 8.38855 1.5H20.1108C20.6017 1.5 20.9997 1.89797 20.9997 2.38889V21.6111C20.9997 22.102 20.6017 22.5 20.1108 22.5H8.38855C7.89763 22.5 7.49966 22.102 7.49966 21.6111V12.6667H7.49089H7.4821H7.47331H7.46452H7.45573H7.44694H7.43815H7.42936H7.42057H7.41178H7.403H7.39421H7.38542H7.37663H7.36784H7.35905H7.35026H7.34147H7.33268H7.32389H7.3151H7.30632H7.29753H7.28874H7.27995H7.27116H7.26237H7.25358H7.24479H7.236H7.22721H7.21842H7.20964H7.20085H7.19206H7.18327H7.17448H7.16569H7.1569H7.14811H7.13932H7.13053H7.12175H7.11296H7.10417H7.09538H7.08659H7.0778H7.06901H7.06022H7.05143H7.04264H7.03385H7.02507H7.01628H7.00749H6.9987H6.98991H6.98112H6.97233H6.96354H6.95475H6.94596H6.93717H6.92839H6.9196H6.91081H6.90202H6.89323H6.88444H6.87565H6.86686H6.85807H6.84928H6.8405H6.83171H6.82292H6.81413H6.80534H6.79655H6.78776H6.77897H6.77018H6.76139H6.7526H6.74382H6.73503H6.72624H6.71745H6.70866H6.69987H6.69108H6.68229H6.6735H6.66471H6.65592H6.64714H6.63835H6.62956H6.62077H6.61198H6.60319H6.5944H6.58561H6.57682H6.56803H6.55925H6.55046H6.54167H6.53288H6.52409H6.5153H6.50651H6.49772H6.48893H6.48014H6.47135H6.46257H6.45378H6.44499H6.4362H6.42741H6.41862H6.40983H6.40104H6.39225H6.38346H6.37467H6.36589H6.3571H6.34831H6.33952H6.33073H6.32194H6.31315H6.30436H6.29557H6.28678H6.27799H6.26921H6.26042H6.25163H6.24284H6.23405H6.22526H6.21647H6.20768H6.19889H6.1901H6.18132H6.17253H6.16374H6.15495H6.14616H6.13737H6.12858H6.11979H6.111H6.10221H6.09342H6.08464H6.07585H6.06706H6.05827H6.04948H6.04069H6.0319H6.02311H6.01432H6.00553H5.99674H5.98796H5.97917H5.97038H5.96159H5.9528H5.94401H5.93522H5.92643H5.91764H5.90885H5.90007H5.89128H5.88249H5.8737H5.86491H5.85612H5.84733H5.83854H5.82975H5.82096H5.81217H5.80339H5.7946H5.78581H5.77702H5.76823H5.75944H5.75065H5.74186H5.73307H5.72428H5.71549H5.70671H5.69792H5.68913H5.68034H5.67155H5.66276H5.65397H5.64518H5.63639H5.6276H5.61882H5.61003H5.60124H5.59245H5.58366H5.57487H5.56608H5.55729H5.5485H5.53971H5.53092H5.52214H5.51335H5.50456H5.49577H5.48698H5.47819H5.4694H5.46061H5.45182H5.44303H5.43424H5.42546H5.41667H5.40788H5.39909H5.3903H5.38151H5.37272H5.36393H5.35514H5.34635H5.33757H5.32878H5.31999H5.3112H5.30241H5.29362H5.28483H5.27604H5.26725H5.25846H5.24967H5.24089H5.2321H5.22331H5.21452H5.20573H5.19694H5.18815H5.17936H5.17057H5.16178H5.15299H5.14421H5.13542H5.12663H5.11784H5.10905H5.10026H5.09147H5.08268H5.07389H5.0651H5.05632H5.04753H5.03874H5.02995H5.02116H5.01237H5.00358H4.99479H4.986H4.97721H4.96842H4.95964H4.95085H4.94206H4.93327H4.92448H4.91569H4.9069H4.89811H4.88932H4.88053H4.87174H4.86296H4.85417H4.84538H4.83659H4.8278H4.81901H4.81022H4.80143H4.79264H4.78385H4.77507H4.76628H4.75749H4.7487H4.73991H4.73112H4.72233H4.71354H4.70475H4.69596H4.68717H4.67839H4.6696H4.66081H4.65202H4.64323H4.63444H4.62565H4.61686H4.60807H4.59928H4.59049H4.58171H4.57292H4.56413H4.55534H4.54655H4.53776H4.52897H4.52018H4.51139H4.5026H4.49382H4.48503H4.47624H4.46745H4.45866H4.44987H4.44108H4.43229H4.4235H4.41471H4.40592H4.39714H4.38835H4.37956H4.37077H4.36198H4.35319H4.3444H4.33561H4.32682H4.31803H4.30924H4.30046H4.29167H4.28288H4.27409H4.2653H4.25651H4.24772H4.23893H4.23014H4.22135H4.21257H4.20378H4.19499H4.1862H4.17741H4.16862H4.15983H4.15104H4.14225H4.13346H4.12467H4.11589H4.1071H4.09831H4.08952H4.08073H4.07194H4.06315H4.05436H4.04557H4.03678H4.02799H4.01921H4.01042H4.00163H3.99284H3.98405H3.97526H3.96647H3.95768H3.94889H3.9401H3.93132H3.92253H3.91374H3.90495H3.89616H3.88737H3.87858H3.86979H3.861H3.85221H3.84342H3.83464H3.82585H3.81706H3.80827H3.79948H3.79069H3.7819H3.77311H3.76432H3.75553H3.74674H3.73796H3.72917H3.72038H3.71159H3.7028H3.69401H3.68522H3.67643H3.66764H3.65885H3.65007H3.64128H3.63249H3.6237H3.61491H3.60612H3.59733H3.58854H3.57975H3.57096H3.56217H3.55339H3.5446H3.53581H3.52702H3.51823H3.50944H3.50065H3.49186H3.48307H3.47428H3.46549H3.45671H3.44792H3.43913H3.43034H3.42155H3.41276H3.40397H3.39518H3.38639H3.3776H3.36882H3.36003H3.35124H3.34245H3.33366H3.32487H3.31608H3.30729H3.2985H3.28971H3.28092H3.27214H3.26335H3.25456H3.24577H3.23698H3.22819H3.2194H3.21061H3.20182H3.19303H3.18424H3.17546H3.16667H3.15788H3.14909H3.1403H3.13151H3.12272H3.11393H3.10514H3.09635H3.08757H3.07878H3.06999H3.0612H3.05241H3.04362H3.03483H3.02604H3.01725H3.00846H2.99967C2.63148 12.6667 2.33301 12.3682 2.33301 12C2.33301 11.6318 2.63148 11.3333 2.99967 11.3333H3.00846H3.01725H3.02604H3.03483H3.04362H3.05241H3.0612H3.06999H3.07878H3.08757H3.09635H3.10514H3.11393H3.12272H3.13151H3.1403H3.14909H3.15788H3.16667H3.17546H3.18424H3.19303H3.20182H3.21061H3.2194H3.22819H3.23698H3.24577H3.25456H3.26335H3.27214H3.28092H3.28971H3.2985H3.30729H3.31608H3.32487H3.33366H3.34245H3.35124H3.36003H3.36882H3.3776H3.38639H3.39518H3.40397H3.41276H3.42155H3.43034H3.43913H3.44792H3.45671H3.46549H3.47428H3.48307H3.49186H3.50065H3.50944H3.51823H3.52702H3.53581H3.5446H3.55339H3.56217H3.57096H3.57975H3.58854H3.59733H3.60612H3.61491H3.6237H3.63249H3.64128H3.65007H3.65885H3.66764H3.67643H3.68522H3.69401H3.7028H3.71159H3.72038H3.72917H3.73796H3.74674H3.75553H3.76432H3.77311H3.7819H3.79069H3.79948H3.80827H3.81706H3.82585H3.83464H3.84342H3.85221H3.861H3.86979H3.87858H3.88737H3.89616H3.90495H3.91374H3.92253H3.93132H3.9401H3.94889H3.95768H3.96647H3.97526H3.98405H3.99284H4.00163H4.01042H4.01921H4.02799H4.03678H4.04557H4.05436H4.06315H4.07194H4.08073H4.08952H4.09831H4.1071H4.11589H4.12467H4.13346H4.14225H4.15104H4.15983H4.16862H4.17741H4.1862H4.19499H4.20378H4.21257H4.22135H4.23014H4.23893H4.24772H4.25651H4.2653H4.27409H4.28288H4.29167H4.30046H4.30924H4.31803H4.32682H4.33561H4.3444H4.35319H4.36198H4.37077H4.37956H4.38835H4.39714H4.40592H4.41471H4.4235H4.43229H4.44108H4.44987H4.45866H4.46745H4.47624H4.48503H4.49382H4.5026H4.51139H4.52018H4.52897H4.53776H4.54655H4.55534H4.56413H4.57292H4.58171H4.59049H4.59928H4.60807H4.61686H4.62565H4.63444H4.64323H4.65202H4.66081H4.6696H4.67839H4.68717H4.69596H4.70475H4.71354H4.72233H4.73112H4.73991H4.7487H4.75749H4.76628H4.77507H4.78385H4.79264H4.80143H4.81022H4.81901H4.8278H4.83659H4.84538H4.85417H4.86296H4.87174H4.88053H4.88932H4.89811H4.9069H4.91569H4.92448H4.93327H4.94206H4.95085H4.95964H4.96842H4.97721H4.986H4.99479H5.00358H5.01237H5.02116H5.02995H5.03874H5.04753H5.05631H5.0651H5.07389H5.08268H5.09147H5.10026H5.10905H5.11784H5.12663H5.13542H5.14421H5.15299H5.16178H5.17057H5.17936H5.18815H5.19694H5.20573H5.21452H5.22331H5.2321H5.24089H5.24967H5.25846H5.26725H5.27604H5.28483H5.29362H5.30241H5.3112H5.31999H5.32878H5.33757H5.34635H5.35514H5.36393H5.37272H5.38151H5.3903H5.39909H5.40788H5.41667H5.42546H5.43424H5.44303H5.45182H5.46061H5.4694H5.47819H5.48698H5.49577H5.50456H5.51335H5.52214H5.53092H5.53971H5.5485H5.55729H5.56608H5.57487H5.58366H5.59245H5.60124H5.61003H5.61882H5.6276H5.63639H5.64518H5.65397H5.66276H5.67155H5.68034H5.68913H5.69792H5.70671H5.71549H5.72428H5.73307H5.74186H5.75065H5.75944H5.76823H5.77702H5.78581H5.7946H5.80339H5.81217H5.82096H5.82975H5.83854H5.84733H5.85612H5.86491H5.8737H5.88249H5.89128H5.90007H5.90885H5.91764H5.92643H5.93522H5.94401H5.9528H5.96159H5.97038H5.97917H5.98796H5.99674H6.00553H6.01432H6.02311H6.0319H6.04069H6.04948H6.05827H6.06706H6.07585H6.08464H6.09342H6.10221H6.111H6.11979H6.12858H6.13737H6.14616H6.15495H6.16374H6.17253H6.18132H6.1901H6.19889H6.20768H6.21647H6.22526H6.23405H6.24284H6.25163H6.26042H6.26921H6.27799H6.28678H6.29557H6.30436H6.31315H6.32194H6.33073H6.33952H6.34831H6.3571H6.36589H6.37467H6.38346H6.39225H6.40104H6.40983H6.41862H6.42741H6.4362H6.44499H6.45378H6.46257H6.47135H6.48014H6.48893H6.49772H6.50651H6.5153H6.52409H6.53288H6.54167H6.55046H6.55925H6.56803H6.57682H6.58561H6.5944H6.60319H6.61198H6.62077H6.62956H6.63835H6.64714H6.65592H6.66471H6.6735H6.68229H6.69108H6.69987H6.70866H6.71745H6.72624H6.73503H6.74382H6.7526H6.76139H6.77018H6.77897H6.78776H6.79655H6.80534H6.81413H6.82292H6.83171H6.8405H6.84928H6.85807H6.86686H6.87565H6.88444H6.89323H6.90202H6.91081H6.9196H6.92839H6.93717H6.94596H6.95475H6.96354H6.97233H6.98112H6.98991H6.9987H7.00749H7.01628H7.02507H7.03385H7.04264H7.05143H7.06022H7.06901H7.0778H7.08659H7.09538H7.10417H7.11296H7.12175H7.13053H7.13932H7.14811H7.1569H7.16569H7.17448H7.18327H7.19206H7.20085H7.20964H7.21842H7.22721H7.236H7.24479H7.25358H7.26237H7.27116H7.27995H7.28874H7.29753H7.30632H7.3151H7.32389H7.33268H7.34147H7.35026H7.35905H7.36784H7.37663H7.38542H7.39421H7.403H7.41178H7.42057H7.42936H7.43815H7.44694H7.45573H7.46452H7.47331H7.4821H7.49089H7.49966V2.38889ZM13.3687 6.24853C13.1172 5.9796 12.7095 5.9796 12.458 6.24853C12.2065 6.51747 12.2065 6.9535 12.458 7.22243L16.3022 11.3336L16.2894 11.3336L16.2726 11.3336L16.2558 11.3336L16.239 11.3335L16.2223 11.3335L16.2055 11.3335L16.1887 11.3335L16.1719 11.3335L16.1552 11.3334L16.1384 11.3334L16.1216 11.3334L16.1048 11.3334L16.088 11.3334L16.0713 11.3333L16.0545 11.3333L16.0377 11.3333L16.0209 11.3333L16.0041 11.3333L15.9874 11.3332L15.9706 11.3332L15.9538 11.3332L15.937 11.3332L15.9202 11.3332L15.9035 11.3331L15.8867 11.3331L15.8699 11.3331L15.8531 11.3331L15.8364 11.3331L15.8196 11.333L15.8028 11.333L15.786 11.333L15.7692 11.333L15.7525 11.333L15.7357 11.3329L15.7189 11.3329L15.7021 11.3329L15.6853 11.3329L15.6686 11.3329L15.6518 11.3328L15.635 11.3328L15.6182 11.3328L15.6014 11.3328L15.5847 11.3328L15.5679 11.3327L15.5511 11.3327L15.5343 11.3327L15.5175 11.3327L15.5008 11.3327L15.484 11.3326L15.4672 11.3326L15.4504 11.3326L15.4337 11.3326L15.4169 11.3326L15.4001 11.3325L15.3833 11.3325L15.3665 11.3325L15.3498 11.3325L15.333 11.3324L15.3162 11.3324L15.2994 11.3324L15.2826 11.3324L15.2659 11.3324L15.2491 11.3323L15.2323 11.3323L15.2155 11.3323L15.1987 11.3323L15.182 11.3323L15.1652 11.3322L15.1484 11.3322L15.1316 11.3322L15.1148 11.3322L15.0981 11.3322L15.0813 11.3321L15.0645 11.3321L15.0477 11.3321L15.031 11.3321L15.0142 11.3321L14.9974 11.332L14.9806 11.332L14.9638 11.332L14.9471 11.332L14.9303 11.332L14.9135 11.3319L14.8967 11.3319L14.8799 11.3319L14.8632 11.3319L14.8464 11.3319L14.8296 11.3318L14.8128 11.3318L14.796 11.3318L14.7793 11.3318L14.7625 11.3318L14.7457 11.3317L14.7289 11.3317L14.7122 11.3317L14.6954 11.3317L14.6786 11.3317L14.6618 11.3316L14.645 11.3316L14.6283 11.3316L14.6115 11.3316L14.5947 11.3316L14.5779 11.3315L14.5611 11.3315L14.5444 11.3315L14.5276 11.3315L14.5108 11.3315L14.494 11.3314L14.4772 11.3314L14.4605 11.3314L14.4437 11.3314L14.4269 11.3314L14.4101 11.3313L14.3933 11.3313L14.3766 11.3313L14.3598 11.3313L14.343 11.3313L14.3262 11.3312L14.3095 11.3312L14.2927 11.3312L14.2759 11.3312L14.2591 11.3312L14.2423 11.3311L14.2256 11.3311L14.2088 11.3311L14.192 11.3311L14.1752 11.3311L14.1584 11.331L14.1417 11.331L14.1249 11.331L14.1081 11.331L14.0913 11.331L14.0745 11.3309L14.0578 11.3309L14.041 11.3309L14.0242 11.3309L14.0074 11.3309L13.9906 11.3308L13.9739 11.3308L13.9571 11.3308L13.9403 11.3308L13.9235 11.3308L13.9068 11.3307L13.89 11.3307L13.8732 11.3307L13.8564 11.3307L13.8396 11.3307L13.8229 11.3306L13.8061 11.3306L13.7893 11.3306L13.7725 11.3306L13.7557 11.3306L13.739 11.3305L13.7222 11.3305L13.7054 11.3305L13.6886 11.3305L13.6718 11.3305L13.6551 11.3304L13.6383 11.3304L13.6215 11.3304L13.6047 11.3304L13.5879 11.3304L13.5712 11.3303L13.5544 11.3303L13.5376 11.3303L13.5208 11.3303L13.5041 11.3303L13.4873 11.3302L13.4705 11.3302L13.4537 11.3302L13.4369 11.3302L13.4202 11.3302L13.4034 11.3301L13.3866 11.3301L13.3698 11.3301L13.353 11.3301L13.3363 11.33L13.3195 11.33L13.3027 11.33L13.2859 11.33L13.2691 11.33L13.2524 11.3299L13.2356 11.3299L13.2188 11.3299L13.202 11.3299L13.1853 11.3299L13.1685 11.3298L13.1517 11.3298L13.1349 11.3298L13.1181 11.3298L13.1014 11.3298L13.0846 11.3297L13.0678 11.3297L13.051 11.3297L13.0342 11.3297L13.0175 11.3297L13.0007 11.3296L12.9839 11.3296L12.9671 11.3296L12.9503 11.3296L12.9336 11.3296L12.9168 11.3295L12.9 11.3295L12.8832 11.3295L12.8664 11.3295L12.8497 11.3295L12.8329 11.3294L12.8161 11.3294L12.7993 11.3294L12.7826 11.3294L12.7658 11.3294L12.749 11.3293L12.7322 11.3293L12.7154 11.3293L12.6987 11.3293L12.6819 11.3293L12.6651 11.3292L12.6483 11.3292L12.6315 11.3292L12.6148 11.3292L12.598 11.3292L12.5812 11.3291L12.5644 11.3291L12.5476 11.3291L12.5309 11.3291L12.5141 11.3291L12.4973 11.329L12.4805 11.329L12.4637 11.329L12.447 11.329L12.4302 11.329L12.4134 11.3289L12.3966 11.3289L12.3799 11.3289L12.3631 11.3289L12.3463 11.3289L12.3295 11.3288L12.3127 11.3288L12.296 11.3288L12.2792 11.3288L12.2624 11.3288L12.2456 11.3287L12.2288 11.3287L12.2121 11.3287L12.1953 11.3287L12.1785 11.3287L12.1617 11.3286L12.1449 11.3286L12.1282 11.3286L12.1114 11.3286L12.0946 11.3286L12.0778 11.3285L12.0611 11.3285L12.0443 11.3285L12.0275 11.3285L12.0107 11.3285L11.9939 11.3284L11.9772 11.3284L11.9604 11.3284L11.9436 11.3284L11.9268 11.3284L11.91 11.3283L11.8933 11.3283L11.8765 11.3283L11.8597 11.3283L11.8429 11.3283L11.8261 11.3282L11.8094 11.3282L11.7926 11.3282L11.7758 11.3282L11.759 11.3282L11.7422 11.3281L11.7255 11.3281L11.7087 11.3281L11.6919 11.3281L11.6751 11.3281L11.6583 11.328L11.6416 11.328L11.6248 11.328L11.608 11.328L11.5912 11.328L11.5745 11.3279L11.5577 11.3279L11.5409 11.3279L11.5241 11.3279L11.5073 11.3279L11.4906 11.3278L11.4738 11.3278L11.457 11.3278L11.4402 11.3278L11.4234 11.3278L11.4067 11.3277L11.3899 11.3277L11.3731 11.3277L11.3563 11.3277L11.3395 11.3277L11.3228 11.3276L11.306 11.3276L11.2892 11.3276L11.2724 11.3276L11.2557 11.3275L11.2389 11.3275L11.2221 11.3275L11.2053 11.3275L11.1885 11.3275L11.1718 11.3274L11.155 11.3274L11.1382 11.3274L11.1214 11.3274L11.1046 11.3274L11.0879 11.3273L11.0711 11.3273L11.0543 11.3273L11.0375 11.3273L11.0207 11.3273L11.004 11.3272L10.9872 11.3272L10.9704 11.3272L10.9536 11.3272L10.9368 11.3272L10.9201 11.3271L10.9033 11.3271L10.8865 11.3271L10.8697 11.3271L10.853 11.3271L10.8362 11.327L10.8194 11.327L10.8026 11.327L10.7858 11.327L10.7691 11.327L10.7523 11.3269L10.7355 11.3269L10.7187 11.3269L10.7019 11.3269L10.6852 11.3269L10.6684 11.3268L10.6516 11.3268L10.6348 11.3268L10.618 11.3268L10.6013 11.3268L10.5845 11.3267L10.5677 11.3267L10.5509 11.3267L10.5341 11.3267L10.5174 11.3267L10.5006 11.3266L10.4838 11.3266L10.467 11.3266L10.4503 11.3266L10.4335 11.3266L10.4167 11.3265L10.3999 11.3265L10.3831 11.3265L10.3664 11.3265L10.3496 11.3265L10.3328 11.3264L10.316 11.3264L10.2992 11.3264L10.2825 11.3264L10.2657 11.3264L10.2489 11.3263L10.2321 11.3263L10.2153 11.3263L10.1986 11.3263L10.1818 11.3263L10.165 11.3262L10.1482 11.3262L10.1315 11.3262L10.1147 11.3262L10.0979 11.3262L10.0811 11.3261L10.0643 11.3261L10.0476 11.3261L10.0308 11.3261L10.014 11.3261L9.99722 11.326L9.98044 11.326L9.96366 11.326L9.94688 11.326L9.9301 11.326L9.91332 11.3259L9.89654 11.3259L9.87977 11.3259L9.86299 11.3259L9.84621 11.3259L9.82943 11.3258L9.81265 11.3258L9.79587 11.3258L9.77909 11.3258L9.76231 11.3258L9.74553 11.3257L9.72875 11.3257L9.71197 11.3257L9.69519 11.3257L9.67841 11.3257L9.66163 11.3256L9.64486 11.3256L9.62808 11.3256L9.6113 11.3256L9.59452 11.3256L9.57774 11.3255L9.56096 11.3255L9.54418 11.3255L9.5274 11.3255L9.51062 11.3255L9.49384 11.3254L9.47706 11.3254L9.46029 11.3254L9.44351 11.3254L9.42673 11.3254L9.40995 11.3253L9.39317 11.3253L9.37639 11.3253L9.35961 11.3253L9.34283 11.3253L9.32605 11.3252L9.30927 11.3252L9.29249 11.3252L9.27572 11.3252L9.25894 11.3252L9.24216 11.3251L9.22538 11.3251L9.2086 11.3251L9.19182 11.3251L9.17504 11.325L9.15826 11.325L9.14148 11.325L9.1247 11.325L9.10792 11.325L9.09115 11.3249L9.07437 11.3249L9.05759 11.3249L9.04081 11.3249L9.02403 11.3249L9.00725 11.3248L8.99047 11.3248L8.97369 11.3248L8.95691 11.3248L8.94013 11.3248L8.92335 11.3247L8.90658 11.3247L8.8898 11.3247L8.87302 11.3247L8.85624 11.3247L8.83946 11.3246L8.82268 11.3246L8.8059 11.3246L8.78912 11.3246L8.77234 11.3246L8.75556 11.3245L8.73878 11.3245L8.722 11.3245L8.70523 11.3245L8.68845 11.3245L8.67167 11.3244L8.65489 11.3244L8.63811 11.3244L8.62133 11.3244L8.60455 11.3244L8.58777 11.3243L8.57099 11.3243L8.55421 11.3243L8.53743 11.3243L8.52066 11.3243L8.50388 11.3242L8.4871 11.3242L8.47032 11.3242L8.45354 11.3242L8.43676 11.3242L8.41998 11.3241L8.4032 11.3241L8.38642 11.3241L8.36964 11.3241L8.35286 11.3241L8.33608 11.324L8.31931 11.324L8.30253 11.324L8.28575 11.324L8.26897 11.324L8.25219 11.3239L8.23541 11.3239L8.21863 11.3239L8.20185 11.3239L8.18507 11.3239L8.16829 11.3238L8.15151 11.3238L8.13474 11.3238L8.11796 11.3238L8.10118 11.3238L8.0844 11.3237L8.06762 11.3237L8.05084 11.3237L8.03406 11.3237L8.01728 11.3237L8.0005 11.3236L7.99885 12.657L8.01563 12.657L8.03241 12.657L8.04919 12.657L8.06597 12.6571L8.08274 12.6571L8.09952 12.6571L8.1163 12.6571L8.13308 12.6571L8.14986 12.6572L8.16664 12.6572L8.18342 12.6572L8.2002 12.6572L8.21698 12.6572L8.23376 12.6573L8.25054 12.6573L8.26731 12.6573L8.28409 12.6573L8.30087 12.6573L8.31765 12.6574L8.33443 12.6574L8.35121 12.6574L8.36799 12.6574L8.38477 12.6574L8.40155 12.6575L8.41833 12.6575L8.43511 12.6575L8.45189 12.6575L8.46866 12.6575L8.48544 12.6576L8.50222 12.6576L8.519 12.6576L8.53578 12.6576L8.55256 12.6576L8.56934 12.6577L8.58612 12.6577L8.6029 12.6577L8.61968 12.6577L8.63646 12.6577L8.65323 12.6578L8.67001 12.6578L8.68679 12.6578L8.70357 12.6578L8.72035 12.6578L8.73713 12.6579L8.75391 12.6579L8.77069 12.6579L8.78747 12.6579L8.80425 12.6579L8.82103 12.658L8.83781 12.658L8.85458 12.658L8.87136 12.658L8.88814 12.658L8.90492 12.6581L8.9217 12.6581L8.93848 12.6581L8.95526 12.6581L8.97204 12.6581L8.98882 12.6582L9.0056 12.6582L9.02238 12.6582L9.03915 12.6582L9.05593 12.6582L9.07271 12.6583L9.08949 12.6583L9.10627 12.6583L9.12305 12.6583L9.13983 12.6583L9.15661 12.6584L9.17339 12.6584L9.19017 12.6584L9.20695 12.6584L9.22373 12.6584L9.2405 12.6585L9.25728 12.6585L9.27406 12.6585L9.29084 12.6585L9.30762 12.6585L9.3244 12.6586L9.34118 12.6586L9.35796 12.6586L9.37474 12.6586L9.39152 12.6586L9.4083 12.6587L9.42507 12.6587L9.44185 12.6587L9.45863 12.6587L9.47541 12.6587L9.49219 12.6588L9.50897 12.6588L9.52575 12.6588L9.54253 12.6588L9.55931 12.6588L9.57609 12.6589L9.59287 12.6589L9.60964 12.6589L9.62642 12.6589L9.6432 12.6589L9.65998 12.659L9.67676 12.659L9.69354 12.659L9.71032 12.659L9.7271 12.659L9.74388 12.6591L9.76066 12.6591L9.77744 12.6591L9.79421 12.6591L9.81099 12.6591L9.82777 12.6592L9.84455 12.6592L9.86133 12.6592L9.87811 12.6592L9.89489 12.6592L9.91167 12.6593L9.92845 12.6593L9.94523 12.6593L9.96201 12.6593L9.97879 12.6594L9.99556 12.6594L10.0123 12.6594L10.0291 12.6594L10.0459 12.6594L10.0627 12.6595L10.0795 12.6595L10.0962 12.6595L10.113 12.6595L10.1298 12.6595L10.1466 12.6596L10.1634 12.6596L10.1801 12.6596L10.1969 12.6596L10.2137 12.6596L10.2305 12.6597L10.2473 12.6597L10.264 12.6597L10.2808 12.6597L10.2976 12.6597L10.3144 12.6598L10.3311 12.6598L10.3479 12.6598L10.3647 12.6598L10.3815 12.6598L10.3983 12.6599L10.415 12.6599L10.4318 12.6599L10.4486 12.6599L10.4654 12.6599L10.4822 12.66L10.4989 12.66L10.5157 12.66L10.5325 12.66L10.5493 12.66L10.5661 12.6601L10.5828 12.6601L10.5996 12.6601L10.6164 12.6601L10.6332 12.6601L10.65 12.6602L10.6667 12.6602L10.6835 12.6602L10.7003 12.6602L10.7171 12.6602L10.7338 12.6603L10.7506 12.6603L10.7674 12.6603L10.7842 12.6603L10.801 12.6603L10.8177 12.6604L10.8345 12.6604L10.8513 12.6604L10.8681 12.6604L10.8849 12.6604L10.9016 12.6605L10.9184 12.6605L10.9352 12.6605L10.952 12.6605L10.9688 12.6605L10.9855 12.6606L11.0023 12.6606L11.0191 12.6606L11.0359 12.6606L11.0526 12.6606L11.0694 12.6607L11.0862 12.6607L11.103 12.6607L11.1198 12.6607L11.1365 12.6607L11.1533 12.6608L11.1701 12.6608L11.1869 12.6608L11.2037 12.6608L11.2204 12.6608L11.2372 12.6609L11.254 12.6609L11.2708 12.6609L11.2876 12.6609L11.3043 12.6609L11.3211 12.661L11.3379 12.661L11.3547 12.661L11.3715 12.661L11.3882 12.661L11.405 12.6611L11.4218 12.6611L11.4386 12.6611L11.4553 12.6611L11.4721 12.6611L11.4889 12.6612L11.5057 12.6612L11.5225 12.6612L11.5392 12.6612L11.556 12.6612L11.5728 12.6613L11.5896 12.6613L11.6064 12.6613L11.6231 12.6613L11.6399 12.6613L11.6567 12.6614L11.6735 12.6614L11.6903 12.6614L11.707 12.6614L11.7238 12.6614L11.7406 12.6615L11.7574 12.6615L11.7742 12.6615L11.7909 12.6615L11.8077 12.6615L11.8245 12.6616L11.8413 12.6616L11.858 12.6616L11.8748 12.6616L11.8916 12.6616L11.9084 12.6617L11.9252 12.6617L11.9419 12.6617L11.9587 12.6617L11.9755 12.6617L11.9923 12.6618L12.0091 12.6618L12.0258 12.6618L12.0426 12.6618L12.0594 12.6618L12.0762 12.6619L12.093 12.6619L12.1097 12.6619L12.1265 12.6619L12.1433 12.662L12.1601 12.662L12.1768 12.662L12.1936 12.662L12.2104 12.662L12.2272 12.6621L12.244 12.6621L12.2607 12.6621L12.2775 12.6621L12.2943 12.6621L12.3111 12.6622L12.3279 12.6622L12.3446 12.6622L12.3614 12.6622L12.3782 12.6622L12.395 12.6623L12.4118 12.6623L12.4285 12.6623L12.4453 12.6623L12.4621 12.6623L12.4789 12.6624L12.4957 12.6624L12.5124 12.6624L12.5292 12.6624L12.546 12.6624L12.5628 12.6625L12.5795 12.6625L12.5963 12.6625L12.6131 12.6625L12.6299 12.6625L12.6467 12.6626L12.6634 12.6626L12.6802 12.6626L12.697 12.6626L12.7138 12.6626L12.7306 12.6627L12.7473 12.6627L12.7641 12.6627L12.7809 12.6627L12.7977 12.6627L12.8145 12.6628L12.8312 12.6628L12.848 12.6628L12.8648 12.6628L12.8816 12.6628L12.8984 12.6629L12.9151 12.6629L12.9319 12.6629L12.9487 12.6629L12.9655 12.6629L12.9822 12.663L12.999 12.663L13.0158 12.663L13.0326 12.663L13.0494 12.663L13.0661 12.6631L13.0829 12.6631L13.0997 12.6631L13.1165 12.6631L13.1333 12.6631L13.15 12.6632L13.1668 12.6632L13.1836 12.6632L13.2004 12.6632L13.2172 12.6632L13.2339 12.6633L13.2507 12.6633L13.2675 12.6633L13.2843 12.6633L13.3011 12.6633L13.3178 12.6634L13.3346 12.6634L13.3514 12.6634L13.3682 12.6634L13.3849 12.6634L13.4017 12.6635L13.4185 12.6635L13.4353 12.6635L13.4521 12.6635L13.4688 12.6635L13.4856 12.6636L13.5024 12.6636L13.5192 12.6636L13.536 12.6636L13.5527 12.6636L13.5695 12.6637L13.5863 12.6637L13.6031 12.6637L13.6199 12.6637L13.6366 12.6637L13.6534 12.6638L13.6702 12.6638L13.687 12.6638L13.7038 12.6638L13.7205 12.6638L13.7373 12.6639L13.7541 12.6639L13.7709 12.6639L13.7876 12.6639L13.8044 12.6639L13.8212 12.664L13.838 12.664L13.8548 12.664L13.8715 12.664L13.8883 12.664L13.9051 12.6641L13.9219 12.6641L13.9387 12.6641L13.9554 12.6641L13.9722 12.6641L13.989 12.6642L14.0058 12.6642L14.0226 12.6642L14.0393 12.6642L14.0561 12.6642L14.0729 12.6643L14.0897 12.6643L14.1064 12.6643L14.1232 12.6643L14.14 12.6644L14.1568 12.6644L14.1736 12.6644L14.1903 12.6644L14.2071 12.6644L14.2239 12.6645L14.2407 12.6645L14.2575 12.6645L14.2742 12.6645L14.291 12.6645L14.3078 12.6646L14.3246 12.6646L14.3414 12.6646L14.3581 12.6646L14.3749 12.6646L14.3917 12.6647L14.4085 12.6647L14.4253 12.6647L14.442 12.6647L14.4588 12.6647L14.4756 12.6648L14.4924 12.6648L14.5091 12.6648L14.5259 12.6648L14.5427 12.6648L14.5595 12.6649L14.5763 12.6649L14.593 12.6649L14.6098 12.6649L14.6266 12.6649L14.6434 12.665L14.6602 12.665L14.6769 12.665L14.6937 12.665L14.7105 12.665L14.7273 12.6651L14.7441 12.6651L14.7608 12.6651L14.7776 12.6651L14.7944 12.6651L14.8112 12.6652L14.828 12.6652L14.8447 12.6652L14.8615 12.6652L14.8783 12.6652L14.8951 12.6653L14.9118 12.6653L14.9286 12.6653L14.9454 12.6653L14.9622 12.6653L14.979 12.6654L14.9957 12.6654L15.0125 12.6654L15.0293 12.6654L15.0461 12.6654L15.0629 12.6655L15.0796 12.6655L15.0964 12.6655L15.1132 12.6655L15.13 12.6655L15.1468 12.6656L15.1635 12.6656L15.1803 12.6656L15.1971 12.6656L15.2139 12.6656L15.2306 12.6657L15.2474 12.6657L15.2642 12.6657L15.281 12.6657L15.2978 12.6657L15.3145 12.6658L15.3313 12.6658L15.3481 12.6658L15.3649 12.6658L15.3817 12.6658L15.3984 12.6659L15.4152 12.6659L15.432 12.6659L15.4488 12.6659L15.4656 12.6659L15.4823 12.666L15.4991 12.666L15.5159 12.666L15.5327 12.666L15.5495 12.666L15.5662 12.6661L15.583 12.6661L15.5998 12.6661L15.6166 12.6661L15.6333 12.6661L15.6501 12.6662L15.6669 12.6662L15.6837 12.6662L15.7005 12.6662L15.7172 12.6662L15.734 12.6663L15.7508 12.6663L15.7676 12.6663L15.7844 12.6663L15.8011 12.6663L15.8179 12.6664L15.8347 12.6664L15.8515 12.6664L15.8683 12.6664L15.885 12.6664L15.9018 12.6665L15.9186 12.6665L15.9354 12.6665L15.9522 12.6665L15.9689 12.6665L15.9857 12.6666L16.0025 12.6666L16.0193 12.6666L16.036 12.6666L16.0528 12.6666L16.0696 12.6667L16.0864 12.6667L16.1032 12.6667L16.1199 12.6667L16.1367 12.6667L16.1535 12.6668L16.1703 12.6668L16.1871 12.6668L16.2038 12.6668L16.2206 12.6669L16.2374 12.6669L16.2542 12.6669L16.271 12.6669L16.2836 12.6669L12.458 16.7581C12.2065 17.0271 12.2065 17.4631 12.458 17.732C12.7095 18.001 13.1172 18.001 13.3687 17.732L18.2822 12.4772C18.5337 12.2083 18.5337 11.7723 18.2822 11.5033L13.3687 6.24853Z",fill:"white"})),pXe=_.forwardRef(hXe),mXe=(t,e)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.2139 2.44646L12 3.99992H5.4375C4.64359 3.99992 4 4.64352 4 5.43742V18.5624C4 19.3563 4.64359 19.9999 5.4375 19.9999H12L18.2139 21.5534C19.1211 21.7802 20 21.094 20 20.1588V3.84104C20 2.90584 19.1211 2.21964 18.2139 2.44646ZM12 17.9999V5.99992H6V17.9999H12Z",fill:"white"})),gXe=_.forwardRef(mXe),vXe="_userButton_t5z8t_15",yXe={userButton:vXe},bXe=({preventNavigation:t,isAuthenticated:e,isPasswordlessUser:n,userId:r,displayName:i,avatarUrl:s,onAction:o})=>{const{t:a}=We(),c=rs(),l=_.useMemo(()=>{const m=[];return e&&(m.push({key:"user",icon:kW,label:i,dataTestid:"usermenu_user"}),m.push({key:"settings",icon:fXe,label:a("common.settings")}),n&&!t&&m.push({key:"login",label:a("action.sign_in"),icon:pXe,dataTestid:"usermenu_login"}),!n&&!t&&m.push({key:"logout",label:a("action.sign_out"),icon:gXe,dataTestid:"usermenu_logout"})),m},[e,n,i,t,a]),[d,h]=_.useState(!1);return e?E.jsx(qM,{title:a("a11y.user_menu"),showTitle:!1,align:"end",open:d,onOpenChange:h,trigger:E.jsx("button",{"aria-label":a("common.profile"),className:yXe.userButton,"data-testid":"usermenu_open",children:e&&(!n||s)?E.jsx(Op,{id:r,name:i,size:Lp.SM,src:s}):E.jsx(kW,{})}),children:l.map(({key:m,icon:g,label:y,dataTestid:v})=>E.jsx(yv,{Icon:g,label:y,"data-testid":v,onSelect:()=>o(m)},m))}):E.jsx(q8,{to:{pathname:"/login"},state:{from:c},children:a("log_in")})},dD=({preventNavigation:t=!1})=>{const e=rs(),n=hl(),{client:r,logout:i,authenticated:s,passwordlessUser:o}=W8(),{displayName:a,avatarUrl:c}=V_(r),[l,d]=_.useState(!1),h=_.useCallback(()=>d(!1),[d]),[m,g]=_.useState(lD),y=_.useCallback(w=>{switch(w){case"user":g("profile"),d(!0);break;case"settings":g("audio"),d(!0);break;case"logout":i?.();break;case"login":n("/login",{state:{from:e}})?.catch(S=>M.error("Failed to navigate to login",S));break}},[n,e,i,d]),v=r?.getUserIdLocalpart()??"";return E.jsxs(E.Fragment,{children:[E.jsx(bXe,{preventNavigation:t,isAuthenticated:s,isPasswordlessUser:o,avatarUrl:c,onAction:y,userId:r?.getUserId()??"",displayName:a||(v?v.replace("@",""):"")}),r&&E.jsx(uD,{client:r,open:l,onDismiss:h,tab:m,onTabChange:g})]})};function _Xe(t){return new Worker(""+new URL("IndexedDBWorker-DiQk_BNn.js",import.meta.url).href,{name:t?.name})}const Efe=new On;function SXe(t){const e=gp(Efe,t,_.useCallback(()=>localStorage.getItem(t),[t])),n=_.useCallback(r=>wfe(t,r),[t]);return[e,n]}const wfe=(t,e)=>{localStorage.setItem(t,e),Efe.emit(t)};function Cfe(t,e){localStorage.getItem(Qb(t))!==e&&wfe(Qb(t),e)}const Qb=t=>`room-shared-key-${t}`,EXe=(t,e)=>{const[n,r]=SXe(Qb(t));return _.useEffect(()=>{e&&r(e)},[e,r]),[e??n,r]};function Tfe(t){const{roomId:e,password:n}=Br();return t!==e&&M.warn("requested key for a roomId which is not the current call room id (from the URL)",t,e),n??localStorage.getItem(Qb(t))}function X_(t){const{client:e}=jp(),[n]=EXe(Qb(t),Tfe(t)??void 0),r=e?.getRoom(t);return _.useMemo(()=>r?n?{kind:hn.SHARED_KEY,secret:n}:r.hasEncryptionStateEvent()?{kind:hn.PER_PARTICIPANT}:{kind:hn.NONE}:{kind:hn.NONE},[r,n])}const xW=!1,wXe="element-call-sync";async function CXe(t){let e=!!await t.store.getSavedSyncToken();return new Promise((n,r)=>{const i=(s,o,a)=>{s==="PREPARED"?e?e=!1:(t.removeListener(Le.Sync,i),n()):s==="ERROR"&&(t.removeListener(Le.Sync,i),r(a?.error))};t.on(Le.Sync,i)})}async function Rfe(t,e){let n;try{n=window.indexedDB}catch(a){M.warn("Could not get indexDB from window.",a)}const r={fallbackICEServerAllowed:xW,isVoipWithNoMediaAllowed:sn.get().features?.feature_group_calls_without_video_and_audio};n&&localStorage?r.store=new LQ({indexedDB:window.indexedDB,localStorage,dbName:wXe,workerFactory:()=>new _Xe}):localStorage&&(r.store=new vb({localStorage}));const{e2eEnabled:i}=Br();i||M.info("Disabling E2E: group call signalling will NOT be encrypted.");const s=aT({...r,...t,useAuthorizationHeader:!0,localTimeoutMs:5e3,useE2eForGroupCall:i,fallbackICEServerAllowed:xW});e||await s.clearStores();try{await s.store.startup()}catch(a){M.error("Error starting matrix client indexDB store. Falling back to memory store.",a),s.store=new vb({localStorage}),await s.store.startup()}try{await s.initRustCrypto()}catch(a){M.warn(a,"Make sure to clear client stores before initializing the rust crypto.")}const o=CXe(s);return await s.startClient({clientWellKnownPollPeriod:60*10}),await o,s}function J_(t){return t.trim().replace(/\s/g,"-").replace(/[^\w-]/g,"").toLowerCase()}function TXe(t,e){return`#${J_(t)}:${e.getDomain()}`}function Ife(t){const e=t.split(":",2);if(e.length===2&&e[0][0]==="#"){if(e[1]===sn.defaultServerName())return e[0];throw new Error("Unsupported remote room alias")}return t}async function kfe(t,e,n){M.log("Creating room for group call");const r=t.createRoom({visibility:GJ.Private,preset:nT.PublicChat,name:e,room_alias_name:n?void 0:J_(e),power_level_content_override:{invite:100,kick:100,ban:100,redact:50,state_default:0,events_default:0,users_default:0,events:{"m.room.power_levels":100,"m.room.history_visibility":100,"m.room.tombstone":100,"m.room.encryption":100,"m.room.name":50,"m.room.message":0,"m.room.encrypted":50,"m.sticker":50,"org.matrix.msc3401.call.member":0},users:{[t.getUserId()]:100}}}),i=await new Promise((o,a)=>{r.catch(d=>{a(d),l()});const c=d=>{r.then(h=>{d.roomId===h.room_id&&(o(d.roomId),l())},h=>{M.error("Failed to wait for the room to arrive",h)})},l=()=>{t.off(Le.Room,c)};t.on(Le.Room,c)});let s;return n==hn.SHARED_KEY&&(s=BJ(16),Cfe(i,s)),{roomId:i,alias:n?void 0:TXe(e,t),password:s}}function xfe(t,e,n,r){return`${window.location.protocol}//${window.location.host}${KR(t,e,n)}`}function KR(t,e,n,r){return`/room/#${n?"/"+J_(n):""}?${Tje(t,e).toString()}`}async function RXe(t){let e=0;for(;;)try{return await t()}catch(n){e++;const r=GO(n,e,!0);if(r<0)throw n;await _p(r)}}const fD=t=>{const[e,n]=_.useState(void 0),[r,i]=_.useState(void 0),s=_.useRef(void 0);s.current||(s.current=aT({baseUrl:sn.defaultHomeserverUrl()})),_.useEffect(()=>{ut||s.current.registerRequest({}).catch(a=>{n(a.data?.params["m.login.terms"]?.policies?.privacy_policy?.en?.url),i(a.data?.params["m.login.recaptcha"]?.public_key)})},[]);const o=_.useCallback(async(a,c,l,d,h)=>{const m=new l7({matrixClient:s.current,doRequest:async x=>s.current.registerRequest({username:a,password:c,auth:x||void 0}),stateUpdated:(x,T)=>{if(T.error)throw new Error(T.error);x==="m.login.terms"?m.submitAuthDict({type:"m.login.terms"}).catch(I=>{M.error(I)}):x==="m.login.recaptcha"&&m.submitAuthDict({type:"m.login.recaptcha",response:d}).catch(I=>{M.error(I)})},requestEmailToken:async()=>Promise.resolve({sid:"dummy"})}),{user_id:g,access_token:y,device_id:v}=await m.attemptAuth();await t?.logout(!0);const w=await Rfe({baseUrl:sn.defaultHomeserverUrl(),accessToken:y,userId:g,deviceId:v},!1);await w.setDisplayName(l);const S={user_id:g,device_id:v,access_token:y,passwordlessUser:h};h&&(S.tempPassword=c);const R=w.getUser(w.getUserId());return R.setRawDisplayName(l),R.setDisplayName(l),[w,S]},[t]);return{privacyPolicyUrl:e,recaptchaKey:r,register:o}},IXe="_buttons_1arp2_8",kXe={buttons:IXe},Afe=({onJoin:t,open:e,onDismiss:n})=>{const{t:r}=We();return E.jsxs(Up,{title:r("join_existing_call_modal.title"),open:e,onDismiss:n,children:[E.jsx("p",{children:r("join_existing_call_modal.text")}),E.jsxs(yt,{rightAlign:!0,className:kXe.buttons,children:[E.jsx(Bt,{onClick:n,children:r("action.no")}),E.jsx(Bt,{onClick:t,"data-testid":"home_joinExistingRoom",children:r("join_existing_call_modal.join_button")})]})]})},AW="https://www.recaptcha.net/recaptcha/api.js?onload=mxOnRecaptchaLoaded&render=explicit";function hD(t){const{t:e}=We(),[n]=_.useState(()=>To(16)),r=_.useRef(void 0);_.useEffect(()=>{if(!t)return;const o=()=>{document.getElementById(n)&&window.grecaptcha.render(n,{sitekey:t,size:"invisible",callback:a=>r.current?.resolve(a),"error-callback":()=>r.current?.reject(new Error)})};if(typeof window.grecaptcha?.render=="function")o();else if(window.mxOnRecaptchaLoaded=o,!document.querySelector(`script[src="${AW}"]`)){const a=document.createElement("script");a.src=AW,a.async=!0,document.body.appendChild(a)}},[n,t]);const i=_.useCallback(async()=>t?window.grecaptcha?new Promise((o,a)=>{const c=new MutationObserver(d=>{for(const h of d)if(h.target?.style?.visibility!=="visible"){a(sz("recaptcha_dismissed",e)),c.disconnect();return}});r.current={resolve:d=>{o(d),c.disconnect()},reject:d=>{a(d),c.disconnect()}},window.grecaptcha.execute().then(()=>{},d=>{M.error("Recaptcha execution failed",d)});const l=document.querySelector('iframe[src*="recaptcha/api2/bframe"]');l?.parentNode?.parentNode&&c.observe(l?.parentNode?.parentNode,{attributes:!0})}):(M.log("Recaptcha not loaded"),Promise.reject(sz("recaptcha_not_loaded",e))):Promise.resolve(""),[t,e]),s=_.useCallback(()=>{window.grecaptcha?.reset()},[]);return{execute:i,reset:s,recaptchaId:n}}const xXe="_form_jcuzc_8",AXe={form:xXe},zR=({ref:t,children:e,className:n,onSubmit:r})=>E.jsx("form",{onSubmit:r,className:Oe(AXe.form,n),ref:t,children:e});zR.displayName="Form";const PXe="_footer_106jg_8",LXe="_mobileLoginLink_106jg_19",OXe="_form_106jg_24",MXe="_notice_106jg_40",Q1={footer:PXe,mobileLoginLink:LXe,form:OXe,notice:MXe},DXe="_container_dwllg_8",NXe="_main_dwllg_15",UXe="_logo_dwllg_23",Xg={container:DXe,main:NXe,logo:UXe},PW=t=>{t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296};class jXe{constructor(e){this.dictionaries=void 0,this.length=void 0,this.separator=void 0,this.style=void 0,this.seed=void 0;const{length:n,separator:r,dictionaries:i,style:s,seed:o}=e;this.dictionaries=i,this.separator=r,this.length=n,this.style=s,this.seed=o}generate(){if(!this.dictionaries)throw new Error('Cannot find any dictionary. Please provide at least one, or leave the "dictionary" field empty in the config object');if(this.length<=0)throw new Error("Invalid length provided");if(this.length>this.dictionaries.length)throw new Error(`The length cannot be bigger than the number of dictionaries.
Length provided: ${this.length}. Number of dictionaries provided: ${this.dictionaries.length}`);let e=this.seed;return this.dictionaries.slice(0,this.length).reduce((n,r)=>{let i;e?(i=(o=>{if(typeof o=="string"){const a=o.split("").map(l=>l.charCodeAt(0)).reduce((l,d)=>l+d,1),c=Math.floor(Number(a));return PW(c)}return PW(o)})(e),e=4294967296*i):i=Math.random();let s=r[Math.floor(i*r.length)]||"";if(this.style==="lowerCase")s=s.toLowerCase();else if(this.style==="capital"){const[o,...a]=s.split("");s=o.toUpperCase()+a.join("")}else this.style==="upperCase"&&(s=s.toUpperCase());return n?`${n}${this.separator}${s}`:`${s}`},"")}}const LW={separator:"_",dictionaries:[]},FXe=t=>{const e=[...t&&t.dictionaries||LW.dictionaries],n={...LW,...t,length:t&&t.length||e.length,dictionaries:e};if(!t||!t.dictionaries||!t.dictionaries.length)throw new Error('A "dictionaries" array must be provided. This is a breaking change introduced starting from Unique Name Generator v4. Read more about the breaking change here: https://github.com/andreasonny83/unique-names-generator#migration-guide');return new jXe(n).generate()};var $Xe=["able","above","absent","absolute","abstract","abundant","academic","acceptable","accepted","accessible","accurate","accused","active","actual","acute","added","additional","adequate","adjacent","administrative","adorable","advanced","adverse","advisory","aesthetic","afraid","aggregate","aggressive","agreeable","agreed","agricultural","alert","alive","alleged","allied","alone","alright","alternative","amateur","amazing","ambitious","amused","ancient","angry","annoyed","annual","anonymous","anxious","appalling","apparent","applicable","appropriate","arbitrary","architectural","armed","arrogant","artificial","artistic","ashamed","asleep","assistant","associated","atomic","attractive","automatic","autonomous","available","average","awake","aware","awful","awkward","back","bad","balanced","bare","basic","beautiful","beneficial","better","bewildered","big","binding","biological","bitter","bizarre","blank","blind","blonde","bloody","blushing","boiling","bold","bored","boring","bottom","brainy","brave","breakable","breezy","brief","bright","brilliant","broad","broken","bumpy","burning","busy","calm","capable","capitalist","careful","casual","causal","cautious","central","certain","changing","characteristic","charming","cheap","cheerful","chemical","chief","chilly","chosen","christian","chronic","chubby","circular","civic","civil","civilian","classic","classical","clean","clear","clever","clinical","close","closed","cloudy","clumsy","coastal","cognitive","coherent","cold","collective","colonial","colorful","colossal","coloured","colourful","combative","combined","comfortable","coming","commercial","common","communist","compact","comparable","comparative","compatible","competent","competitive","complete","complex","complicated","comprehensive","compulsory","conceptual","concerned","concrete","condemned","confident","confidential","confused","conscious","conservation","conservative","considerable","consistent","constant","constitutional","contemporary","content","continental","continued","continuing","continuous","controlled","controversial","convenient","conventional","convinced","convincing","cooing","cool","cooperative","corporate","correct","corresponding","costly","courageous","crazy","creative","creepy","criminal","critical","crooked","crowded","crucial","crude","cruel","cuddly","cultural","curious","curly","current","curved","cute","daily","damaged","damp","dangerous","dark","dead","deaf","deafening","dear","decent","decisive","deep","defeated","defensive","defiant","definite","deliberate","delicate","delicious","delighted","delightful","democratic","dependent","depressed","desirable","desperate","detailed","determined","developed","developing","devoted","different","difficult","digital","diplomatic","direct","dirty","disabled","disappointed","disastrous","disciplinary","disgusted","distant","distinct","distinctive","distinguished","disturbed","disturbing","diverse","divine","dizzy","domestic","dominant","double","doubtful","drab","dramatic","dreadful","driving","drunk","dry","dual","due","dull","dusty","dutch","dying","dynamic","eager","early","eastern","easy","economic","educational","eerie","effective","efficient","elaborate","elated","elderly","eldest","electoral","electric","electrical","electronic","elegant","eligible","embarrassed","embarrassing","emotional","empirical","empty","enchanting","encouraging","endless","energetic","enormous","enthusiastic","entire","entitled","envious","environmental","equal","equivalent","essential","established","estimated","ethical","ethnic","eventual","everyday","evident","evil","evolutionary","exact","excellent","exceptional","excess","excessive","excited","exciting","exclusive","existing","exotic","expected","expensive","experienced","experimental","explicit","extended","extensive","external","extra","extraordinary","extreme","exuberant","faint","fair","faithful","familiar","famous","fancy","fantastic","far","fascinating","fashionable","fast","fat","fatal","favourable","favourite","federal","fellow","female","feminist","few","fierce","filthy","final","financial","fine","firm","fiscal","fit","fixed","flaky","flat","flexible","fluffy","fluttering","flying","following","fond","foolish","foreign","formal","formidable","forthcoming","fortunate","forward","fragile","frail","frantic","free","frequent","fresh","friendly","frightened","front","frozen","full","fun","functional","fundamental","funny","furious","future","fuzzy","gastric","gay","general","generous","genetic","gentle","genuine","geographical","giant","gigantic","given","glad","glamorous","gleaming","global","glorious","golden","good","gorgeous","gothic","governing","graceful","gradual","grand","grateful","greasy","great","grieving","grim","gross","grotesque","growing","grubby","grumpy","guilty","handicapped","handsome","happy","hard","harsh","head","healthy","heavy","helpful","helpless","hidden","high","hilarious","hissing","historic","historical","hollow","holy","homeless","homely","hon","honest","horizontal","horrible","hostile","hot","huge","human","hungry","hurt","hushed","husky","icy","ideal","identical","ideological","ill","illegal","imaginative","immediate","immense","imperial","implicit","important","impossible","impressed","impressive","improved","inadequate","inappropriate","inc","inclined","increased","increasing","incredible","independent","indirect","individual","industrial","inevitable","influential","informal","inherent","initial","injured","inland","inner","innocent","innovative","inquisitive","instant","institutional","insufficient","intact","integral","integrated","intellectual","intelligent","intense","intensive","interested","interesting","interim","interior","intermediate","internal","international","intimate","invisible","involved","irrelevant","isolated","itchy","jealous","jittery","joint","jolly","joyous","judicial","juicy","junior","just","keen","key","kind","known","labour","large","late","latin","lazy","leading","left","legal","legislative","legitimate","lengthy","lesser","level","lexical","liable","liberal","light","like","likely","limited","linear","linguistic","liquid","literary","little","live","lively","living","local","logical","lonely","long","loose","lost","loud","lovely","low","loyal","ltd","lucky","mad","magic","magnetic","magnificent","main","major","male","mammoth","managerial","managing","manual","many","marginal","marine","marked","married","marvellous","marxist","mass","massive","mathematical","mature","maximum","mean","meaningful","mechanical","medical","medieval","melodic","melted","mental","mere","metropolitan","mid","middle","mighty","mild","military","miniature","minimal","minimum","ministerial","minor","miserable","misleading","missing","misty","mixed","moaning","mobile","moderate","modern","modest","molecular","monetary","monthly","moral","motionless","muddy","multiple","mushy","musical","mute","mutual","mysterious","naked","narrow","nasty","national","native","natural","naughty","naval","near","nearby","neat","necessary","negative","neighbouring","nervous","net","neutral","new","nice","noble","noisy","normal","northern","nosy","notable","novel","nuclear","numerous","nursing","nutritious","nutty","obedient","objective","obliged","obnoxious","obvious","occasional","occupational","odd","official","ok","okay","old","olympic","only","open","operational","opposite","optimistic","oral","ordinary","organic","organisational","original","orthodox","other","outdoor","outer","outrageous","outside","outstanding","overall","overseas","overwhelming","painful","pale","panicky","parallel","parental","parliamentary","partial","particular","passing","passive","past","patient","payable","peaceful","peculiar","perfect","permanent","persistent","personal","petite","philosophical","physical","plain","planned","plastic","pleasant","pleased","poised","polite","political","poor","popular","positive","possible","potential","powerful","practical","precious","precise","preferred","pregnant","preliminary","premier","prepared","present","presidential","pretty","previous","prickly","primary","prime","primitive","principal","printed","prior","private","probable","productive","professional","profitable","profound","progressive","prominent","promising","proper","proposed","prospective","protective","protestant","proud","provincial","psychiatric","psychological","public","puny","pure","purring","puzzled","quaint","qualified","quarrelsome","querulous","quick","quickest","quiet","quintessential","quixotic","racial","radical","rainy","random","rapid","rare","raspy","rational","ratty","raw","ready","real","realistic","rear","reasonable","recent","reduced","redundant","regional","registered","regular","regulatory","related","relative","relaxed","relevant","reliable","relieved","religious","reluctant","remaining","remarkable","remote","renewed","representative","repulsive","required","resident","residential","resonant","respectable","respective","responsible","resulting","retail","retired","revolutionary","rich","ridiculous","right","rigid","ripe","rising","rival","roasted","robust","rolling","romantic","rotten","rough","round","royal","rubber","rude","ruling","running","rural","sacred","sad","safe","salty","satisfactory","satisfied","scared","scary","scattered","scientific","scornful","scrawny","screeching","secondary","secret","secure","select","selected","selective","selfish","semantic","senior","sensible","sensitive","separate","serious","severe","sexual","shaggy","shaky","shallow","shared","sharp","sheer","shiny","shivering","shocked","short","shrill","shy","sick","significant","silent","silky","silly","similar","simple","single","skilled","skinny","sleepy","slight","slim","slimy","slippery","slow","small","smart","smiling","smoggy","smooth","social","socialist","soft","solar","sole","solid","sophisticated","sore","sorry","sound","sour","southern","soviet","spare","sparkling","spatial","special","specific","specified","spectacular","spicy","spiritual","splendid","spontaneous","sporting","spotless","spotty","square","squealing","stable","stale","standard","static","statistical","statutory","steady","steep","sticky","stiff","still","stingy","stormy","straight","straightforward","strange","strategic","strict","striking","striped","strong","structural","stuck","stupid","subjective","subsequent","substantial","subtle","successful","successive","sudden","sufficient","suitable","sunny","super","superb","superior","supporting","supposed","supreme","sure","surprised","surprising","surrounding","surviving","suspicious","sweet","swift","symbolic","sympathetic","systematic","tall","tame","tart","tasteless","tasty","technical","technological","teenage","temporary","tender","tense","terrible","territorial","testy","then","theoretical","thick","thin","thirsty","thorough","thoughtful","thoughtless","thundering","tight","tiny","tired","top","tory","total","tough","toxic","traditional","tragic","tremendous","tricky","tropical","troubled","typical","ugliest","ugly","ultimate","unable","unacceptable","unaware","uncertain","unchanged","uncomfortable","unconscious","underground","underlying","unemployed","uneven","unexpected","unfair","unfortunate","unhappy","uniform","uninterested","unique","united","universal","unknown","unlikely","unnecessary","unpleasant","unsightly","unusual","unwilling","upper","upset","uptight","urban","urgent","used","useful","useless","usual","vague","valid","valuable","variable","varied","various","varying","vast","verbal","vertical","very","vicarious","vicious","victorious","violent","visible","visiting","visual","vital","vitreous","vivacious","vivid","vocal","vocational","voiceless","voluminous","voluntary","vulnerable","wandering","warm","wasteful","watery","weak","wealthy","weary","wee","weekly","weird","welcome","well","western","wet","whispering","whole","wicked","wide","widespread","wild","wilful","willing","willowy","wily","wise","wispy","wittering","witty","wonderful","wooden","working","worldwide","worried","worrying","worthwhile","worthy","written","wrong","xenacious","xenial","xenogeneic","xenophobic","xeric","xerothermic","yabbering","yammering","yappiest","yappy","yawning","yearling","yearning","yeasty","yelling","yelping","yielding","yodelling","young","youngest","youthful","ytterbic","yucky","yummy","zany","zealous","zeroth","zestful","zesty","zippy","zonal","zoophagous","zygomorphic","zygotic"],BXe=["aardvark","aardwolf","albatross","alligator","alpaca","amphibian","anaconda","angelfish","anglerfish","ant","anteater","antelope","antlion","ape","aphid","armadillo","asp","baboon","badger","bandicoot","barnacle","barracuda","basilisk","bass","bat","bear","beaver","bedbug","bee","beetle","bird","bison","blackbird","boa","boar","bobcat","bobolink","bonobo","booby","bovid","bug","butterfly","buzzard","camel","canid","canidae","capybara","cardinal","caribou","carp","cat","caterpillar","catfish","catshark","cattle","centipede","cephalopod","chameleon","cheetah","chickadee","chicken","chimpanzee","chinchilla","chipmunk","cicada","clam","clownfish","cobra","cockroach","cod","condor","constrictor","coral","cougar","cow","coyote","crab","crane","crawdad","crayfish","cricket","crocodile","crow","cuckoo","damselfly","deer","dingo","dinosaur","dog","dolphin","donkey","dormouse","dove","dragon","dragonfly","duck","eagle","earthworm","earwig","echidna","eel","egret","elephant","elk","emu","ermine","falcon","felidae","ferret","finch","firefly","fish","flamingo","flea","fly","flyingfish","fowl","fox","frog","galliform","gamefowl","gayal","gazelle","gecko","gerbil","gibbon","giraffe","goat","goldfish","goose","gopher","gorilla","grasshopper","grouse","guan","guanaco","guineafowl","gull","guppy","haddock","halibut","hamster","hare","harrier","hawk","hedgehog","heron","herring","hippopotamus","hookworm","hornet","horse","hoverfly","hummingbird","hyena","iguana","impala","jackal","jaguar","jay","jellyfish","junglefowl","kangaroo","kingfisher","kite","kiwi","koala","koi","krill","ladybug","lamprey","landfowl","lark","leech","lemming","lemur","leopard","leopon","limpet","lion","lizard","llama","lobster","locust","loon","louse","lungfish","lynx","macaw","mackerel","magpie","mammal","manatee","mandrill","marlin","marmoset","marmot","marsupial","marten","mastodon","meadowlark","meerkat","mink","minnow","mite","mockingbird","mole","mollusk","mongoose","monkey","moose","mosquito","moth","mouse","mule","muskox","narwhal","newt","nightingale","ocelot","octopus","opossum","orangutan","orca","ostrich","otter","owl","ox","panda","panther","parakeet","parrot","parrotfish","partridge","peacock","peafowl","pelican","penguin","perch","pheasant","pig","pigeon","pike","pinniped","piranha","planarian","platypus","pony","porcupine","porpoise","possum","prawn","primate","ptarmigan","puffin","puma","python","quail","quelea","quokka","rabbit","raccoon","rat","rattlesnake","raven","reindeer","reptile","rhinoceros","roadrunner","rodent","rook","rooster","roundworm","sailfish","salamander","salmon","sawfish","scallop","scorpion","seahorse","shark","sheep","shrew","shrimp","silkworm","silverfish","skink","skunk","sloth","slug","smelt","snail","snake","snipe","sole","sparrow","spider","spoonbill","squid","squirrel","starfish","stingray","stoat","stork","sturgeon","swallow","swan","swift","swordfish","swordtail","tahr","takin","tapir","tarantula","tarsier","termite","tern","thrush","tick","tiger","tiglon","toad","tortoise","toucan","trout","tuna","turkey","turtle","tyrannosaurus","unicorn","urial","vicuna","viper","vole","vulture","wallaby","walrus","warbler","wasp","weasel","whale","whippet","whitefish","wildcat","wildebeest","wildfowl","wolf","wolverine","wombat","woodpecker","worm","wren","xerinae","yak","zebra"],HXe=["amaranth","amber","amethyst","apricot","aqua","aquamarine","azure","beige","black","blue","blush","bronze","brown","chocolate","coffee","copper","coral","crimson","cyan","emerald","fuchsia","gold","gray","green","harlequin","indigo","ivory","jade","lavender","lime","magenta","maroon","moccasin","olive","orange","peach","pink","plum","purple","red","rose","salmon","sapphire","scarlet","silver","tan","teal","tomato","turquoise","violet","white","yellow"];const VXe=["hydrogen","helium","lithium","beryllium","boron","carbon","nitrogen","oxygen","fluorine","neon","sodium","magnesium","aluminum","silicon","phosphorus","sulfur","chlorine","argon","potassium","calcium","scandium","titanium","vanadium","chromium","manganese","iron","cobalt","nickel","copper","zinc","gallium","germanium","arsenic","selenium","bromine","krypton","rubidium","strontium","yttrium","zirconium","niobium","molybdenum","technetium","ruthenium","rhodium","palladium","silver","cadmium","indium","tin","antimony","tellurium","iodine","xenon","cesium","barium","lanthanum","cerium","praseodymium","neodymium","promethium","samarium","europium","gadolinium","terbium","dysprosium","holmium","erbium","thulium","ytterbium","lutetium","hafnium","tantalum","wolfram","rhenium","osmium","iridium","platinum","gold","mercury","thallium","lead","bismuth","polonium","astatine","radon","francium","radium","actinium","thorium","protactinium","uranium","neptunium","plutonium","americium","curium","berkelium","californium","einsteinium","fermium","mendelevium","nobelium","lawrencium","rutherfordium","dubnium","seaborgium","bohrium","hassium","meitnerium","darmstadtium","roentgenium","copernicium","nihonium","flerovium","moscovium","livermorium","tennessine","oganesson"];function Pfe(){return FXe({dictionaries:[HXe,$Xe,BXe,VXe],style:"lowerCase",length:3,separator:"-"})}const qXe=()=>{const{setClient:t}=jp(),{header:e}=no(),[n,r]=_.useState(!1),[i,s]=_.useState(),[o]=uR(),{recaptchaKey:a,register:c}=fD(),{execute:l,reset:d,recaptchaId:h}=hD(a),[m,g]=_.useState(!1),y=_.useCallback(()=>g(!1),[g]),[v,w]=_.useState(),S=hl(),{t:R}=We(),x=_.useCallback(T=>{T.preventDefault();const I=new FormData(T.target),k=Ife(I.get("callName")),A=I.get("displayName");async function O(){s(void 0),r(!0);const D=await l(),N=Pfe(),[U,$]=await c(N,To(16),A,D,!0);let K;try{K=await kfe(U,k,hn.SHARED_KEY)}catch(Y){if(!t)throw Y;if(Y.errcode==="M_ROOM_IN_USE"){w(()=>{t(U,$);const G=J_(k);S(`/${G}`)?.catch(F=>{M.error("Failed to navigate to alias localpart",F)})}),r(!1),g(!0);return}else throw Y}if(!t)throw new Error("setClient is undefined");if(!K.password)throw new Error("Failed to create room with shared secret");t(U,$),await S(KR(K.roomId,{kind:hn.SHARED_KEY,secret:K.password},k))}O().catch(D=>{M.error(D),r(!1),s(D),d()})},[c,d,l,S,g,t]);return E.jsxs(E.Fragment,{children:[E.jsxs("div",{className:Xg.container,children:[e==="standard"&&E.jsxs(qu,{children:[E.jsx(jf,{children:E.jsx(fp,{})}),E.jsx(Ff,{hideMobile:!0,children:E.jsx(dD,{})})]}),E.jsxs("main",{className:Xg.main,children:[E.jsx(fp,{className:Xg.logo}),E.jsx(gl,{size:"lg",weight:"semibold",children:R("start_new_call")}),E.jsxs(zR,{className:Q1.form,onSubmit:x,children:[E.jsx(yt,{children:E.jsx(Tn,{id:"callName",name:"callName",label:R("call_name"),placeholder:R("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"})}),E.jsx(yt,{children:E.jsx(Tn,{id:"displayName",name:"displayName",label:R("common.display_name"),placeholder:R("common.display_name"),type:"text",required:!0,"data-testid":"home_displayName",autoComplete:"off"})}),o===null&&E.jsx(an,{size:"sm",className:Q1.notice,children:E.jsx(Xle,{})}),E.jsx(an,{size:"sm",className:Q1.notice,children:E.jsxs(Ys,{i18nKey:"unauthenticated_view_ssla_caption",children:['By clicking "Go", you agree to our'," ",E.jsx(Jh,{href:sn.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),i&&E.jsx(yt,{children:E.jsx(Bf,{error:i})}),E.jsx(Bt,{type:"submit",size:"lg",disabled:n,"data-testid":"home_go",children:R(n?"common.loading":"action.go")}),E.jsx("div",{id:h})]})]}),E.jsxs("footer",{className:Q1.footer,children:[E.jsx(an,{className:Q1.mobileLoginLink,children:E.jsx(il,{to:"/login","data-testid":"home_login",children:R("unauthenticated_view_login_button")})}),E.jsx(an,{children:E.jsxs(Ys,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",E.jsx(il,{to:"/register","data-testid":"home_register",children:"Create an account"})]})})]})]}),v&&E.jsx(Afe,{onJoin:v,open:m,onDismiss:y})]})},Gm={};function OW(t,e){if(Gm[e.roomId])return Gm[e.roomId];if(!e||!e.timeline){const i=Number.MAX_SAFE_INTEGER;return Gm[e.roomId]=i,i}const n=t.getUserId();if(e.getMyMembership()!==Be.Join){const i=e.currentState.getStateEvents("m.room.member",n);if(i&&!Array.isArray(i)){const s=i.getTs();return Gm[e.roomId]=s,s}}for(let i=e.timeline.length-1;i>=0;--i){const o=e.timeline[i].getTs();if(o)return Gm[e.roomId]=o,o}const r=Number.MAX_SAFE_INTEGER;return Gm[e.roomId]=r,r}function GXe(t,e){return e.sort((n,r)=>OW(t,r)-OW(t,n))}const KXe=t=>{const e=Tfe(t.roomId);if(!t.hasEncryptionStateEvent()&&!e)return!1;switch(t.getJoinRule()){case ef.Public:return!0;case ef.Knock:switch(t.getMyMembership()){case Be.Join:case Be.Knock:return!0;case Be.Invite:return t.getLiveTimeline().getState(Me.FORWARDS)?.getStateEvents(Z.RoomMember,t.myUserId)?.getPrevContent().membership===ef.Knock;default:return!1}default:return t.getMyMembership()===Be.Join}},zXe=t=>{switch(t.getMyMembership()){case Be.Join:return!!t.getLiveTimeline().getState(Me.FORWARDS)?.events?.get(Z.GroupCallMemberPrefix);case Be.Knock:return!0;default:return!1}};function WXe(t){const[e,n]=_.useState([]);return _.useEffect(()=>{function r(){const i=t.getRooms().filter(zXe).filter(KXe),o=GXe(t,i).map(a=>{const c=t.matrixRTC.getRoomSession(a);return{roomAlias:a.getCanonicalAlias()??void 0,roomName:a.name,avatarUrl:a.getMxcAvatarUrl(),room:a,session:c,participants:c.memberships.filter(l=>l.sender).map(l=>a.getMember(l.sender)).filter(l=>l)}});n(o)}return r(),t.matrixRTC.on(hC.SessionStarted,r),t.on(ke.MyMembership,r),()=>{t.matrixRTC.off(hC.SessionStarted,r),t.off(ke.MyMembership,r)}},[t]),e}const YXe="_form_1vjc2_8",XXe="_fieldRow_1vjc2_16",JXe="_button_1vjc2_24",QXe="_notice_1vjc2_32",Z1={form:YXe,fieldRow:XXe,button:JXe,notice:QXe},ZXe="_callTileSpacer_l4ywf_8",eJe="_callTile_l4ywf_8",tJe="_callTileLink_l4ywf_28",nJe="_callInfo_l4ywf_40",rJe="_callName_l4ywf_53",iJe="_callList_l4ywf_63",sJe="_disabled_l4ywf_74",nu={callTileSpacer:ZXe,callTile:eJe,callTileLink:tJe,callInfo:nJe,callName:rJe,callList:iJe,disabled:sJe},oJe=({rooms:t,client:e})=>E.jsx(E.Fragment,{children:E.jsxs("div",{className:nu.callList,children:[t.map(({room:n,roomName:r,avatarUrl:i,participants:s})=>E.jsx(aJe,{client:e,name:r,avatarUrl:i,room:n,participants:s},n.roomId)),t.length>3&&E.jsxs(E.Fragment,{children:[E.jsx("div",{className:nu.callTileSpacer}),E.jsx("div",{className:nu.callTileSpacer})]})]})}),aJe=({name:t,avatarUrl:e,room:n,client:r})=>{const{t:i}=We(),s=X_(n.roomId),[o,a]=_.useState(!1),c=_.useCallback(d=>{d.stopPropagation(),d.preventDefault(),a(!0),r.leave(n.roomId).catch(()=>a(!1))},[n,r]),l=E.jsxs(E.Fragment,{children:[E.jsx(Op,{id:n.roomId,name:t,size:Lp.LG,src:e}),E.jsx("div",{className:nu.callInfo,children:E.jsx(an,{weight:"semibold",className:nu.callName,children:t})}),E.jsx(UT,{onClick:c,disabled:o,"aria-label":i("action.remove"),children:E.jsx(LT,{})})]});return E.jsx("div",{className:nu.callTile,children:o?E.jsx("span",{className:Oe(nu.callTileLink,nu.disabled),children:l}):E.jsx(yT,{to:KR(n.roomId,s,n.name),className:nu.callTileLink,children:l})})},cJe=({client:t})=>{const{header:e}=no(),[n,r]=_.useState(!1),[i,s]=_.useState(),[o]=uR(),a=hl(),{t:c}=We(),[l,d]=_.useState(!1),h=_.useCallback(()=>d(!1),[d]),m=_.useCallback(S=>{S.preventDefault();const x=new FormData(S.target).get("callName"),T=typeof x=="string"?Ife(x):"";async function I(){s(void 0),r(!0);const k=await kfe(t,T,hn.SHARED_KEY);if(!k.password)throw new Error("Failed to create room with shared secret");await a(KR(k.roomId,{kind:hn.SHARED_KEY,secret:k.password},T))}I().catch(k=>{k.errcode==="M_ROOM_IN_USE"?(v(J_(T)),r(!1),s(void 0),d(!0)):(M.error(k),r(!1),s(k))})},[t,a,d]),g=WXe(t),[y,v]=_.useState(),w=_.useCallback(()=>{a(`/${y}`)?.catch(S=>{M.error("Failed to navigate to existing alias",S)})},[a,y]);return E.jsxs(E.Fragment,{children:[E.jsxs("div",{className:Xg.container,children:[e==="standard"&&E.jsxs(qu,{children:[E.jsx(jf,{children:E.jsx(fp,{})}),E.jsx(Ff,{children:E.jsx(dD,{})})]}),E.jsxs("main",{className:Xg.main,children:[E.jsx(fp,{className:Xg.logo}),E.jsx(gl,{size:"lg",weight:"semibold",children:c("start_new_call")}),E.jsxs(zR,{className:Z1.form,onSubmit:m,children:[E.jsxs(yt,{className:Z1.fieldRow,children:[E.jsx(Tn,{id:"callName",name:"callName",label:c("call_name"),placeholder:c("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"}),E.jsx(Bt,{type:"submit",size:"lg",className:Z1.button,disabled:n,"data-testid":"home_go",children:c(n?"common.loading":"action.go")})]}),o===null&&E.jsx(an,{size:"sm",className:Z1.notice,children:E.jsx(Xle,{})}),i&&E.jsx(yt,{className:Z1.fieldRow,children:E.jsx(Bf,{error:i})})]}),g.length>0&&E.jsx(oJe,{rooms:g,client:t})]})]}),E.jsx(Afe,{onJoin:w,open:l,onDismiss:h})]})};function Q_(t){_.useEffect(()=>{const e="Element Call";document.title=t?`${e} | ${t}`:e},[t])}const Lfe=()=>{const{t}=We();Q_(t("common.home"));const e=r0();return e?e.state==="error"?E.jsx(zb,{widget:ut,error:e.error}):e.authenticated?E.jsx(cJe,{client:e.authenticated.client}):E.jsx(qXe,{}):E.jsx(pR,{})},lJe=(t,e)=>_.createElement("svg",{width:300,height:66,viewBox:"0 0 300 66",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("circle",{cx:32.6901,cy:32.6904,r:23.496,fill:"white"}),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32.6137 65.2274C50.6257 65.2274 65.2274 50.6257 65.2274 32.6137C65.2274 14.6016 50.6257 0 32.6137 0C14.6016 0 0 14.6016 0 32.6137C0 50.6257 14.6016 65.2274 32.6137 65.2274ZM26.6511 15.1961C26.6511 13.8796 27.7205 12.8124 29.0397 12.8124C37.9808 12.8124 45.2291 20.0456 45.2291 28.9681C45.2291 30.2846 44.1596 31.3518 42.8405 31.3518C41.5213 31.3518 40.4519 30.2846 40.4519 28.9681C40.4519 22.6785 35.3425 17.5797 29.0397 17.5797C27.7205 17.5797 26.6511 16.5125 26.6511 15.1961ZM52.4139 28.9683C52.4139 27.6518 51.3445 26.5846 50.0253 26.5846C48.7061 26.5846 47.6367 27.6518 47.6367 28.9683C47.6367 35.2579 42.5274 40.3567 36.2246 40.3567C34.9054 40.3567 33.836 41.4239 33.836 42.7404C33.836 44.0568 34.9054 45.124 36.2246 45.124C45.1657 45.124 52.4139 37.8909 52.4139 28.9683ZM38.6134 50.031C38.6134 51.3475 37.544 52.4146 36.2248 52.4146C27.2837 52.4146 20.0355 45.1815 20.0355 36.2589C20.0355 34.9425 21.1049 33.8753 22.4241 33.8753C23.7432 33.8753 24.8127 34.9425 24.8127 36.2589C24.8127 42.5486 29.922 47.6474 36.2248 47.6474C37.544 47.6474 38.6134 48.7146 38.6134 50.031ZM12.8113 36.2589C12.8113 37.5754 13.8808 38.6426 15.1999 38.6426C16.5191 38.6426 17.5885 37.5754 17.5885 36.2589C17.5885 29.9693 22.6979 24.8705 29.0007 24.8705C30.3198 24.8705 31.3893 23.8033 31.3893 22.4869C31.3893 21.1704 30.3198 20.1032 29.0007 20.1032C20.0595 20.1032 12.8113 27.3364 12.8113 36.2589Z",fill:"#0DBD8B"}),_.createElement("path",{d:"M114.73 36.9816H91.7256C91.9974 39.3888 92.871 41.3107 94.3464 42.7472C95.8217 44.1449 97.763 44.8438 100.17 44.8438C101.762 44.8438 103.199 44.4555 104.48 43.679C105.761 42.9025 106.674 41.8542 107.217 40.5341H114.206C113.274 43.6014 111.527 46.0862 108.964 47.9887C106.441 49.8523 103.451 50.7842 99.9955 50.7842C95.4917 50.7842 91.8421 49.2894 89.0466 46.2998C86.29 43.3102 84.9117 39.5247 84.9117 34.9432C84.9117 30.4783 86.3094 26.7316 89.1049 23.7032C91.9003 20.6747 95.5111 19.1605 99.9373 19.1605C104.363 19.1605 107.935 20.6553 110.653 23.6449C113.41 26.5957 114.788 30.323 114.788 34.8267L114.73 36.9816ZM99.9373 24.8097C97.763 24.8097 95.9576 25.4503 94.5211 26.7316C93.0845 28.0128 92.1915 29.7212 91.8421 31.8566H107.916C107.605 29.7212 106.751 28.0128 105.353 26.7316C103.956 25.4503 102.15 24.8097 99.9373 24.8097Z",fill:"white"}),_.createElement("path",{d:"M119.557 41.0583V6.40625H126.488V41.1748C126.488 42.7278 127.342 43.5043 129.05 43.5043L130.273 43.4461V50.0271C129.613 50.1435 128.914 50.2018 128.177 50.2018C125.187 50.2018 122.993 49.4447 121.596 47.9305C120.237 46.4163 119.557 44.1255 119.557 41.0583Z",fill:"white"}),_.createElement("path",{d:"M162.549 36.9816H139.545C139.817 39.3888 140.69 41.3107 142.166 42.7472C143.641 44.1449 145.582 44.8438 147.99 44.8438C149.582 44.8438 151.018 44.4555 152.299 43.679C153.581 42.9025 154.493 41.8542 155.037 40.5341H162.025C161.093 43.6014 159.346 46.0862 156.784 47.9887C154.26 49.8523 151.27 50.7842 147.815 50.7842C143.311 50.7842 139.662 49.2894 136.866 46.2998C134.109 43.3102 132.731 39.5247 132.731 34.9432C132.731 30.4783 134.129 26.7316 136.924 23.7032C139.72 20.6747 143.331 19.1605 147.757 19.1605C152.183 19.1605 155.755 20.6553 158.473 23.6449C161.229 26.5957 162.608 30.323 162.608 34.8267L162.549 36.9816ZM147.757 24.8097C145.582 24.8097 143.777 25.4503 142.341 26.7316C140.904 28.0128 140.011 29.7212 139.662 31.8566H155.735C155.425 29.7212 154.571 28.0128 153.173 26.7316C151.775 25.4503 149.97 24.8097 147.757 24.8097Z",fill:"white"}),_.createElement("path",{d:"M193.817 32.7302V50.0853H186.887V31.973C186.887 27.3916 184.984 25.1009 181.179 25.1009C179.122 25.1009 177.471 25.7609 176.229 27.081C175.025 28.4011 174.424 30.2065 174.424 32.4972V50.0853H167.493V19.8594H173.9V23.8779C174.637 22.519 175.763 21.393 177.277 20.5C178.792 19.607 180.675 19.1605 182.927 19.1605C187.12 19.1605 190.148 20.7524 192.012 23.9361C194.574 20.7524 197.991 19.1605 202.262 19.1605C205.795 19.1605 208.513 20.2671 210.415 22.4801C212.318 24.6544 213.269 27.5275 213.269 31.0995V50.0853H206.338V31.973C206.338 27.3916 204.436 25.1009 200.631 25.1009C198.535 25.1009 196.865 25.7803 195.623 27.1392C194.419 28.4593 193.817 30.323 193.817 32.7302Z",fill:"white"}),_.createElement("path",{d:"M247.735 36.9816H224.731C225.002 39.3888 225.876 41.3107 227.351 42.7472C228.827 44.1449 230.768 44.8438 233.175 44.8438C234.767 44.8438 236.204 44.4555 237.485 43.679C238.766 42.9025 239.678 41.8542 240.222 40.5341H247.211C246.279 43.6014 244.532 46.0862 241.969 47.9887C239.446 49.8523 236.456 50.7842 233 50.7842C228.497 50.7842 224.847 49.2894 222.052 46.2998C219.295 43.3102 217.917 39.5247 217.917 34.9432C217.917 30.4783 219.314 26.7316 222.11 23.7032C224.905 20.6747 228.516 19.1605 232.942 19.1605C237.368 19.1605 240.94 20.6553 243.658 23.6449C246.415 26.5957 247.793 30.323 247.793 34.8267L247.735 36.9816ZM232.942 24.8097C230.768 24.8097 228.963 25.4503 227.526 26.7316C226.089 28.0128 225.196 29.7212 224.847 31.8566H240.921C240.61 29.7212 239.756 28.0128 238.358 26.7316C236.961 25.4503 235.155 24.8097 232.942 24.8097Z",fill:"white"}),_.createElement("path",{d:"M259.085 19.8594V23.8779C259.784 22.5578 260.929 21.4513 262.521 20.5583C264.152 19.6264 266.113 19.1605 268.403 19.1605C271.975 19.1605 274.732 20.2477 276.673 22.4219C278.653 24.5961 279.643 27.4887 279.643 31.0995V50.0853H272.713V31.973C272.713 29.8376 272.208 28.1681 271.199 26.9645C270.228 25.7221 268.733 25.1009 266.714 25.1009C264.501 25.1009 262.754 25.7609 261.473 27.081C260.23 28.4011 259.609 30.2259 259.609 32.5554V50.0853H252.679V19.8594H259.085Z",fill:"white"}),_.createElement("path",{d:"M299.884 43.912V49.9106C299.029 50.1435 297.826 50.26 296.273 50.26C290.371 50.26 287.42 47.2898 287.42 41.3495V25.3921H282.82V19.8594H287.42V11.9972H294.351V19.8594H300V25.3921H294.351V40.6506C294.351 43.019 295.477 44.2032 297.729 44.2032L299.884 43.912Z",fill:"white"})),Ofe=_.forwardRef(lJe),uJe="_logo_1gx2r_8",dJe="_container_1gx2r_14",fJe="_content_1gx2r_22",hJe="_formContainer_1gx2r_30",pJe="_authLinks_1gx2r_62",zc={logo:uJe,container:dJe,content:fJe,formContainer:hJe,authLinks:pJe};function mJe(t){return _.useCallback(async(e,n,r)=>{const i=aT({baseUrl:e}),s=new l7({matrixClient:i,doRequest:async()=>i.login("m.login.password",{identifier:{type:"m.id.user",user:n},password:r}),stateUpdated:()=>{},requestEmailToken:async()=>Promise.resolve({sid:""})}),{user_id:o,access_token:a,device_id:c}=await s.attemptAuth(),l={user_id:o,access_token:a,device_id:c,passwordlessUser:!1};return await t?.logout(!0),[await Rfe({baseUrl:e,accessToken:a,userId:o,deviceId:c},!1),l]},[t])}const gJe=()=>{const{t}=We();Q_(t("login_title"));const{client:e,setClient:n}=jp(),r=mJe(e),i=sn.defaultHomeserverUrl(),s=_.useRef(null),o=_.useRef(null),a=hl(),c=rs(),[l,d]=_.useState(!1),[h,m]=_.useState(),g=_.useCallback(v=>{if(v.preventDefault(),d(!0),!i||!s.current||!o.current){m(Error("Login parameters are undefined")),d(!1);return}r(i,s.current.value,o.current.value).then(async([w,S])=>{if(!n)return;n(w,S);const R=c.state;R&&R.from?await a(R.from):await a("/"),Ut.instance.eventLogin.track()}).catch(w=>{m(w),d(!1)})},[r,c,a,i,n]);let y=sn.defaultServerName()?.slice(0,25);return y=y?.length!==sn.defaultServerName()?.length?y+"...":y,E.jsx(E.Fragment,{children:E.jsx("div",{className:zc.container,children:E.jsxs("div",{className:zc.content,children:[E.jsxs("div",{className:zc.formContainer,children:[E.jsx(Ofe,{width:"auto",height:"auto",className:zc.logo}),E.jsx("h2",{children:t("log_in")}),E.jsx("h4",{children:t("login_subheading")}),E.jsxs("form",{onSubmit:g,children:[E.jsx(yt,{children:E.jsx(Tn,{type:"text",ref:s,placeholder:t("common.username"),label:t("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${y}`,"data-testid":"login_username"})}),E.jsx(yt,{children:E.jsx(Tn,{type:"password",ref:o,placeholder:t("common.password"),label:t("common.password"),"data-testid":"login_password"})}),h&&E.jsx(yt,{children:E.jsx(Bf,{error:h})}),E.jsx(yt,{children:E.jsx(Bt,{type:"submit",disabled:l,"data-testid":"login_login",children:t(l?"logging_in":"login_title")})})]})]}),E.jsxs("div",{className:zc.authLinks,children:[E.jsx("p",{children:t("login_auth_links_prompt")}),E.jsx("p",{children:E.jsxs(Ys,{i18nKey:"login_auth_links",children:[E.jsx(il,{to:"/register",children:"Create an account"})," Or ",E.jsx(il,{to:"/",children:"Access as a guest"})]})})]})]})})})},vJe=()=>{const{t}=We();Q_(t("action.register"));const{loading:e,authenticated:n,passwordlessUser:r,client:i,setClient:s}=W8(),o=_.useRef(null),a=hl(),c=rs(),[l,d]=_.useState(!1),[h,m]=_.useState(),[g,y]=_.useState(""),[v,w]=_.useState(""),{recaptchaKey:S,register:R}=fD(i),{execute:x,reset:T,recaptchaId:I}=hD(S),k=_.useCallback(A=>{A.preventDefault();const O=new FormData(A.target),D=O.get("userName"),N=O.get("password"),U=O.get("passwordConfirmation");if(N!==U)return;(async()=>{d(!0);const K=await x(),[Y,G]=await R(D,N,D,K,r);if(i&&i?.groupCallEventHandler&&r)for(const F of i.groupCallEventHandler.groupCalls.values()){const q=F.room.roomId;try{await Y.joinRoom(q)}catch(z){z.errcode==="M_LIMIT_EXCEEDED"?(await _p(z.data.retry_after_ms),await Y.joinRoom(q)):(IT(z),M.error(`Couldn't join room ${q}`,z))}}s?.(Y,G),Ut.instance.eventSignup.cacheSignupEnd(new Date)})().then(async()=>{c.state?.from?await a(c.state?.from):await a("/")}).catch(K=>{m(K),d(!1),T()})},[R,c,a,r,T,x,i,s]);return _.useEffect(()=>{g&&v&&g!==v?o.current?.setCustomValidity(t("register.passwords_must_match")):o.current?.setCustomValidity("")},[g,v,t]),_.useEffect(()=>{!e&&n&&!r&&!l&&a("/")?.catch(A=>{M.error("Failed to navigate to /",A)})},[e,a,n,r,l]),e?E.jsx(pR,{}):(Ut.instance.eventSignup.cacheSignupStart(new Date),E.jsx(E.Fragment,{children:E.jsx("div",{className:zc.container,children:E.jsxs("div",{className:zc.content,children:[E.jsxs("div",{className:zc.formContainer,children:[E.jsx(Ofe,{width:"auto",height:"auto",className:zc.logo}),E.jsx("h2",{children:t("register_heading")}),E.jsxs("form",{onSubmit:k,children:[E.jsx(yt,{children:E.jsx(Tn,{type:"text",name:"userName",placeholder:t("common.username"),label:t("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${sn.defaultServerName()}`,"data-testid":"register_username"})}),E.jsx(yt,{children:E.jsx(Tn,{required:!0,name:"password",type:"password",onChange:A=>y(A.target.value),value:g,placeholder:t("common.password"),label:t("common.password"),"data-testid":"register_password"})}),E.jsx(yt,{children:E.jsx(Tn,{required:!0,type:"password",name:"passwordConfirmation",onChange:A=>w(A.target.value),value:v,placeholder:t("register_confirm_password_label"),label:t("register_confirm_password_label"),ref:o,"data-testid":"register_confirm_password"})}),E.jsx(an,{size:"sm",children:E.jsxs(Ys,{i18nKey:"recaptcha_ssla_caption",children:["This site is protected by ReCAPTCHA and the Google"," ",E.jsx(Jh,{href:"https://www.google.com/policies/privacy/",children:"Privacy Policy"})," ","and"," ",E.jsx(Jh,{href:"https://policies.google.com/terms",children:"Terms of Service"})," ","apply.",E.jsx("br",{}),'By clicking "Register", you agree to our'," ",E.jsx(Jh,{href:sn.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),h&&E.jsx(yt,{children:E.jsx(Bf,{error:h})}),E.jsx(yt,{children:E.jsx(Bt,{type:"submit",disabled:l,"data-testid":"register_register",children:t(l?"register.registering":"action.register")})}),E.jsx("div",{id:I})]})]}),E.jsx("div",{className:zc.authLinks,children:E.jsxs(Ys,{i18nKey:"register_auth_links",children:[E.jsx("p",{children:"Already have an account?"}),E.jsxs("p",{children:[E.jsx(il,{to:"/login",children:"Log in"})," Or ",E.jsx(il,{to:"/",children:"Access as a guest"})]})]})})]})})}))},yJe="_form_1wfyo_8",bJe="_headline_1wfyo_18",_Je="_container_1wfyo_37",SJe="_main_1wfyo_45",EJe="_footer_1wfyo_62",ey={form:yJe,headline:bJe,container:_Je,main:SJe,footer:EJe};function Mfe(){const{setClient:t}=jp(),{privacyPolicyUrl:e,recaptchaKey:n,register:r}=fD(),{execute:i,reset:s,recaptchaId:o}=hD(n),a=_.useCallback(async c=>{if(!t)throw new Error("No client context");if(ut)throw new Error("Registration was skipped: We should never try to register password-less user in embedded mode.");try{const l=await i(),d=Pfe(),[h,m]=await r(d,To(16),c,l,!0);t(h,m)}catch(l){throw s(),l}},[i,s,r,t]);return{privacyPolicyUrl:e,registerPasswordlessUser:a,recaptchaId:o}}const wJe=()=>{const{header:t}=no(),[e,n]=_.useState(!1),[r,i]=_.useState(),{registerPasswordlessUser:s,recaptchaId:o}=Mfe(),a=_.useCallback(d=>{d.preventDefault(),n(!0);const m=new FormData(d.target).get("displayName");s(typeof m=="string"?m:"").catch(y=>{M.error("Failed to register passwordless user",d),n(!1),i(y)})},[s]),{t:c}=We(),l=rs();return E.jsxs(E.Fragment,{children:[t==="standard"&&E.jsxs(qu,{children:[E.jsx(jf,{children:E.jsx(fp,{})}),E.jsx(Ff,{children:E.jsx(dD,{preventNavigation:!0})})]}),E.jsxs("div",{className:ey.container,children:[E.jsxs("main",{className:ey.main,children:[E.jsx(gl,{size:"xl",weight:"semibold",className:ey.headline,children:c("lobby.join_as_guest")}),E.jsxs(zR,{className:ey.form,onSubmit:a,children:[E.jsx(yt,{children:E.jsx(Tn,{id:"displayName",name:"displayName",label:c("common.display_name"),placeholder:c("common.display_name"),"data-testid":"joincall_displayName",type:"text",required:!0,autoComplete:"off"})}),E.jsx(an,{size:"sm",children:E.jsxs(Ys,{i18nKey:"room_auth_view_ssla_caption",children:['By clicking "Join call now", you agree to our'," ",E.jsx(Jh,{href:sn.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),r&&E.jsx(yt,{children:E.jsx(Bf,{error:r})}),E.jsx(Bt,{type:"submit",size:"lg",disabled:e,"data-testid":"joincall_joincall",children:c(e?"common.loading":"room_auth_view_continue_button")}),E.jsx("div",{id:o})]})]}),E.jsx(an,{className:ey.footer,children:E.jsxs(Ys,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",E.jsx(il,{to:"/register",state:{from:l},children:"Create an account"})]})})]})]})};var IE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dfe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var hO={exports:{}},CJe=hO.exports,MW;function TJe(){return MW||(MW=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(CJe,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(v,w){var S=v[w];if(typeof S.bind=="function")return S.bind(v);try{return Function.prototype.bind.call(S,v)}catch{return function(){return Function.prototype.apply.apply(S,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&r?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function d(){for(var v=this.getLevel(),w=0;w<i.length;w++){var S=i[w];this[S]=w<v?e:this.methodFactory(S,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function h(v){return function(){typeof console!==n&&(d.call(this),this[v].apply(this,arguments))}}function m(v,w,S){return l(v)||h.apply(this,arguments)}function g(v,w){var S=this,R,x,T,I="loglevel";typeof v=="string"?I+=":"+v:typeof v=="symbol"&&(I=void 0);function k(U){var $=(i[U]||"silent").toUpperCase();if(!(typeof window===n||!I)){try{window.localStorage[I]=$;return}catch{}try{window.document.cookie=encodeURIComponent(I)+"="+$+";"}catch{}}}function A(){var U;if(!(typeof window===n||!I)){try{U=window.localStorage[I]}catch{}if(typeof U===n)try{var $=window.document.cookie,K=encodeURIComponent(I),Y=$.indexOf(K+"=");Y!==-1&&(U=/^([^;]+)/.exec($.slice(Y+K.length+1))[1])}catch{}return S.levels[U]===void 0&&(U=void 0),U}}function O(){if(!(typeof window===n||!I)){try{window.localStorage.removeItem(I)}catch{}try{window.document.cookie=encodeURIComponent(I)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function D(U){var $=U;if(typeof $=="string"&&S.levels[$.toUpperCase()]!==void 0&&($=S.levels[$.toUpperCase()]),typeof $=="number"&&$>=0&&$<=S.levels.SILENT)return $;throw new TypeError("log.setLevel() called with invalid level: "+U)}S.name=v,S.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},S.methodFactory=w||m,S.getLevel=function(){return T??x??R},S.setLevel=function(U,$){return T=D(U),$!==!1&&k(T),d.call(S)},S.setDefaultLevel=function(U){x=D(U),A()||S.setLevel(U,!1)},S.resetLevel=function(){T=null,O(),d.call(S)},S.enableAll=function(U){S.setLevel(S.levels.TRACE,U)},S.disableAll=function(U){S.setLevel(S.levels.SILENT,U)},S.rebuild=function(){if(o!==S&&(R=D(o.getLevel())),d.call(S),o===S)for(var U in s)s[U].rebuild()},R=D(o?o.getLevel():"WARN");var N=A();N!=null&&(T=D(N)),d.call(S)}o=new g,o.getLogger=function(v){if(typeof v!="symbol"&&typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var w=s[v];return w||(w=s[v]=new g(v,o.methodFactory)),w};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return s},o.default=o,o})}(hO)),hO.exports}var RJe=TJe();const IJe=Dfe(RJe);var pO=function(t,e){return pO=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},pO(t,e)};function Xu(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");pO(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function kJe(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{l(r.next(d))}catch(h){o(h)}}function c(d){try{l(r.throw(d))}catch(h){o(h)}}function l(d){d.done?s(d.value):i(d.value).then(a,c)}l((r=r.apply(t,[])).next())})}function Nfe(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(d){return c([l,d])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(d){l=[6,d],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Mv(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function A3(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function P3(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function Jg(t){return this instanceof Jg?(this.v=t,this):new Jg(t)}function xJe(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(g){return function(y){return Promise.resolve(y).then(g,h)}}function a(g,y){r[g]&&(i[g]=function(v){return new Promise(function(w,S){s.push([g,v,w,S])>1||c(g,v)})},y&&(i[g]=y(i[g])))}function c(g,y){try{l(r[g](y))}catch(v){m(s[0][3],v)}}function l(g){g.value instanceof Jg?Promise.resolve(g.value.v).then(d,h):m(s[0][2],g)}function d(g){c("next",g)}function h(g){c("throw",g)}function m(g,y){g(y),s.shift(),s.length&&c(s[0][0],s[0][1])}}function AJe(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Mv=="function"?Mv(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function ci(t){return typeof t=="function"}function pD(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Zx=pD(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,r){return r+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function L3(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Z_=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Mv(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(v){e={error:v}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var d=this.initialTeardown;if(ci(d))try{d()}catch(v){s=v instanceof Zx?v.errors:[v]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var m=Mv(h),g=m.next();!g.done;g=m.next()){var y=g.value;try{DW(y)}catch(v){s=s??[],v instanceof Zx?s=P3(P3([],A3(s)),A3(v.errors)):s.push(v)}}}catch(v){r={error:v}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(r)throw r.error}}}if(s)throw new Zx(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)DW(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&L3(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&L3(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),Ufe=Z_.EMPTY;function jfe(t){return t instanceof Z_||t&&"closed"in t&&ci(t.remove)&&ci(t.add)&&ci(t.unsubscribe)}function DW(t){ci(t)?t():t.unsubscribe()}var PJe={Promise:void 0},LJe={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,P3([t,e],A3(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Ffe(t){LJe.setTimeout(function(){throw t})}function NW(){}function Ww(t){t()}var mD=function(t){Xu(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,jfe(n)&&n.add(r)):r.destination=DJe,r}return e.create=function(n,r,i){return new mO(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Z_),OJe=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){kE(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){kE(r)}else kE(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){kE(n)}},t}(),mO=function(t){Xu(e,t);function e(n,r,i){var s=t.call(this)||this,o;return ci(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new OJe(o),s}return e}(mD);function kE(t){Ffe(t)}function MJe(t){throw t}var DJe={closed:!0,next:NW,error:MJe,complete:NW},gD=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function $fe(t){return t}function NJe(t){return t.length===0?$fe:t.length===1?t[0]:function(e){return t.reduce(function(n,r){return r(n)},e)}}var Ao=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=jJe(e)?e:new mO(e,n,r);return Ww(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=UW(n),new n(function(i,s){var o=new mO({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[gD]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return NJe(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=UW(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t}();function UW(t){var e;return(e=t??PJe.Promise)!==null&&e!==void 0?e:Promise}function UJe(t){return t&&ci(t.next)&&ci(t.error)&&ci(t.complete)}function jJe(t){return t&&t instanceof mD||UJe(t)&&jfe(t)}function FJe(t){return ci(t?.lift)}function eS(t){return function(e){if(FJe(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function O3(t,e,n,r,i){return new $Je(t,e,n,r,i)}var $Je=function(t){Xu(e,t);function e(n,r,i,s,o,a){var c=t.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(d){n.error(d)}}:t.prototype._next,c._error=s?function(l){try{s(l)}catch(d){n.error(d)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=i?function(){try{i()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(mD),BJe=pD(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Bfe=function(t){Xu(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new jW(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new BJe},e.prototype.next=function(n){var r=this;Ww(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=Mv(r.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;Ww(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;Ww(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?Ufe:(this.currentObservers=null,a.push(n),new Z_(function(){r.currentObservers=null,L3(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new Ao;return n.source=this,n},e.create=function(n,r){return new jW(n,r)},e}(Ao),jW=function(t){Xu(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:Ufe},e}(Bfe);(function(t){Xu(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(Bfe);var HJe={now:function(){return Date.now()}},VJe=function(t){Xu(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(Z_),FW={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,P3([t,e],A3(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},qJe=function(t){Xu(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),FW.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&FW.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,L3(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(VJe),$W=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=HJe.now,t}(),GJe=function(t){Xu(e,t);function e(n,r){r===void 0&&(r=$W.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e}($W);new GJe(qJe);function KJe(t){return t&&ci(t.schedule)}function zJe(t){return t[t.length-1]}function Hfe(t){return KJe(zJe(t))?t.pop():void 0}var Vfe=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function qfe(t){return ci(t?.then)}function Gfe(t){return ci(t[gD])}function Kfe(t){return Symbol.asyncIterator&&ci(t?.[Symbol.asyncIterator])}function zfe(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function WJe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Wfe=WJe();function Yfe(t){return ci(t?.[Wfe])}function Xfe(t){return xJe(this,arguments,function(){var e,n,r,i;return Nfe(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,Jg(e.read())];case 3:return n=s.sent(),r=n.value,i=n.done,i?[4,Jg(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,Jg(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function Jfe(t){return ci(t?.getReader)}function tS(t){if(t instanceof Ao)return t;if(t!=null){if(Gfe(t))return YJe(t);if(Vfe(t))return XJe(t);if(qfe(t))return JJe(t);if(Kfe(t))return Qfe(t);if(Yfe(t))return QJe(t);if(Jfe(t))return ZJe(t)}throw zfe(t)}function YJe(t){return new Ao(function(e){var n=t[gD]();if(ci(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function XJe(t){return new Ao(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function JJe(t){return new Ao(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Ffe)})}function QJe(t){return new Ao(function(e){var n,r;try{for(var i=Mv(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function Qfe(t){return new Ao(function(e){eQe(t,e).catch(function(n){return e.error(n)})})}function ZJe(t){return Qfe(Xfe(t))}function eQe(t,e){var n,r,i,s;return kJe(this,void 0,void 0,function(){var o,a;return Nfe(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=AJe(t),c.label=1;case 1:return[4,n.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Zh(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function Zfe(t,e){return e===void 0&&(e=0),eS(function(n,r){n.subscribe(O3(r,function(i){return Zh(r,t,function(){return r.next(i)},e)},function(){return Zh(r,t,function(){return r.complete()},e)},function(i){return Zh(r,t,function(){return r.error(i)},e)}))})}function ehe(t,e){return e===void 0&&(e=0),eS(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function tQe(t,e){return tS(t).pipe(ehe(e),Zfe(e))}function nQe(t,e){return tS(t).pipe(ehe(e),Zfe(e))}function rQe(t,e){return new Ao(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function iQe(t,e){return new Ao(function(n){var r;return Zh(n,e,function(){r=t[Wfe](),Zh(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return ci(r?.return)&&r.return()}})}function the(t,e){if(!t)throw new Error("Iterable cannot be null");return new Ao(function(n){Zh(n,e,function(){var r=t[Symbol.asyncIterator]();Zh(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function sQe(t,e){return the(Xfe(t),e)}function oQe(t,e){if(t!=null){if(Gfe(t))return tQe(t,e);if(Vfe(t))return rQe(t,e);if(qfe(t))return nQe(t,e);if(Kfe(t))return the(t,e);if(Yfe(t))return iQe(t,e);if(Jfe(t))return sQe(t,e)}throw zfe(t)}function aQe(t,e){return e?oQe(t,e):tS(t)}pD(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function WR(t,e){return eS(function(n,r){var i=0;n.subscribe(O3(r,function(s){r.next(t.call(e,s,i++))}))})}function cQe(t,e,n,r,i,s,o,a){var c=[],l=0,d=0,h=!1,m=function(){h&&!c.length&&!l&&e.complete()},g=function(v){return l<r?y(v):c.push(v)},y=function(v){l++;var w=!1;tS(n(v,d++)).subscribe(O3(e,function(S){e.next(S)},function(){w=!0},void 0,function(){if(w)try{l--;for(var S=function(){var R=c.shift();o||y(R)};c.length&&l<r;)S();m()}catch(R){e.error(R)}}))};return t.subscribe(O3(e,g,function(){h=!0,m()})),function(){}}function nhe(t,e,n){return n===void 0&&(n=1/0),ci(e)?nhe(function(r,i){return WR(function(s,o){return e(r,s,i,o)})(tS(t(r,i)))},n):(typeof e=="number"&&(n=e),eS(function(r,i){return cQe(r,i,t,n)}))}function lQe(t){return nhe($fe,t)}function uQe(){return lQe(1)}function BW(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return uQe()(aQe(t,Hfe(t)))}function YR(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Hfe(t);return eS(function(r,i){(n?BW(t,r,n):BW(t,r)).subscribe(i)})}var dQe="lk";function rhe(t){return typeof t>"u"?!1:fQe(t)||hQe(t)}function fQe(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function hQe(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}var pQe=[ue.ConnectionStateChanged,ue.RoomMetadataChanged,ue.ActiveSpeakersChanged,ue.ConnectionQualityChanged,ue.ParticipantConnected,ue.ParticipantDisconnected,ue.ParticipantPermissionsChanged,ue.ParticipantMetadataChanged,ue.ParticipantNameChanged,ue.ParticipantAttributesChanged,ue.TrackMuted,ue.TrackUnmuted,ue.TrackPublished,ue.TrackUnpublished,ue.TrackStreamStateChanged,ue.TrackSubscriptionFailed,ue.TrackSubscriptionPermissionChanged,ue.TrackSubscriptionStatusChanged],mQe=[...pQe,ue.LocalTrackPublished,ue.LocalTrackUnpublished];ce.TrackPublished,ce.TrackUnpublished,ce.TrackMuted,ce.TrackUnmuted,ce.TrackStreamStateChanged,ce.TrackSubscribed,ce.TrackUnsubscribed,ce.TrackSubscriptionPermissionChanged,ce.TrackSubscriptionFailed,ce.LocalTrackPublished,ce.LocalTrackUnpublished;var gQe=[ce.ConnectionQualityChanged,ce.IsSpeakingChanged,ce.ParticipantMetadataChanged,ce.ParticipantPermissionsChanged,ce.TrackMuted,ce.TrackUnmuted,ce.TrackPublished,ce.TrackUnpublished,ce.TrackStreamStateChanged,ce.TrackSubscriptionFailed,ce.TrackSubscriptionPermissionChanged,ce.TrackSubscriptionStatusChanged];[...gQe,ce.LocalTrackPublished,ce.LocalTrackUnpublished];var Af=IJe.getLogger("lk-components-js");Af.setDefaultLevel("WARN");function ihe(t){return typeof t=="object"}function she(t){return Array.isArray(t)&&t.filter(ihe).length>0}function vQe(t){return`${dQe}-${t}`}function yQe(t){const e=gO(t),n=ohe(t.participant).pipe(WR(()=>gO(t)),YR(e));return{className:vQe(t.source===he.Source.Camera||t.source===he.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}function gO(t){if(rhe(t))return t.publication;{const{source:e,name:n,participant:r}=t;if(e&&n)return r.getTrackPublications().find(i=>i.source===e&&i.trackName===n);if(n)return r.getTrackPublicationByName(n);if(e)return r.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function bQe(t,...e){return new Ao(n=>{const r=()=>{n.next(t)};return e.forEach(i=>{t.on(i,r)}),()=>{e.forEach(i=>{t.off(i,r)})}}).pipe(YR(t))}function _Qe(t,...e){return new Ao(n=>{const r=()=>{n.next(t)};return e.forEach(i=>{t.on(i,r)}),()=>{e.forEach(i=>{t.off(i,r)})}}).pipe(YR(t))}function ohe(t){return _Qe(t,ce.TrackMuted,ce.TrackUnmuted,ce.ParticipantPermissionsChanged,ce.TrackPublished,ce.TrackUnpublished,ce.LocalTrackPublished,ce.LocalTrackUnpublished,ce.MediaDevicesError,ce.TrackSubscriptionStatusChanged).pipe(WR(e=>{const{isMicrophoneEnabled:n,isCameraEnabled:r,isScreenShareEnabled:i}=e,s=e.getTrackPublication(he.Source.Microphone),o=e.getTrackPublication(he.Source.Camera);return{isCameraEnabled:r,isMicrophoneEnabled:n,isScreenShareEnabled:i,cameraTrack:o,microphoneTrack:s,participant:e}}))}function HW(t,e,n=!0){const r=[t.localParticipant,...Array.from(t.remoteParticipants.values())],i=[];return r.forEach(s=>{e.forEach(o=>{const a=Array.from(s.trackPublications.values()).filter(c=>c.source===o&&(!n||c.track)).map(c=>({participant:s,publication:c,source:c.source}));i.push(...a)})}),{trackReferences:i,participants:r}}function SQe(t,e,n){var r,i;const s=(r=n.additionalRoomEvents)!=null?r:mQe,o=(i=n.onlySubscribed)!=null?i:!0,a=Array.from(new Set([ue.ParticipantConnected,ue.ParticipantDisconnected,ue.ConnectionStateChanged,ue.LocalTrackPublished,ue.LocalTrackUnpublished,ue.TrackPublished,ue.TrackUnpublished,ue.TrackSubscriptionStatusChanged,...s]).values());return bQe(t,...a).pipe(WR(c=>{const l=HW(c,e,o);return Af.debug(`TrackReference[] was updated. (length ${l.trackReferences.length})`,l),l}),YR(HW(t,e,o)))}_.createContext(void 0);const EQe=_.createContext(void 0);function wQe(){return _.useContext(EQe)}function ahe(t){const e=wQe(),n=t??e;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}_.createContext(void 0);const che=_.createContext(void 0);function CQe(){return _.useContext(che)}function lhe(t){const e=CQe(),n=t??e;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}_.createContext(void 0);function uhe(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=uhe(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function TQe(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=uhe(t))&&(r&&(r+=" "),r+=e);return r}function RQe(...t){return(...e)=>{for(const n of t)if(typeof n=="function")try{n(...e)}catch(r){console.error(r)}}}function IQe(...t){const e={...t[0]};for(let n=1;n<t.length;n++){const r=t[n];for(const i in r){const s=e[i],o=r[i];typeof s=="function"&&typeof o=="function"&&i[0]==="o"&&i[1]==="n"&&i.charCodeAt(2)>=65&&i.charCodeAt(2)<=90?e[i]=RQe(s,o):(i==="className"||i==="UNSAFE_className")&&typeof s=="string"&&typeof o=="string"?e[i]=TQe(s,o):e[i]=o!==void 0?o:s}}return e}function kQe(t){return t!==void 0}function xQe(...t){return IQe(...t.filter(kQe))}function AQe(t,e){return t==="processor"&&e&&typeof e=="object"&&"name"in e?e.name:t==="e2ee"&&e?"e2ee-enabled":e}function PQe(t={}){const e=lhe(t.room),[n,r]=_.useState(e.localParticipant),[i,s]=_.useState(n.isMicrophoneEnabled),[o,a]=_.useState(n.isCameraEnabled),[c,l]=_.useState(n.isScreenShareEnabled),[d,h]=_.useState(n.lastMicrophoneError),[m,g]=_.useState(n.lastCameraError),[y,v]=_.useState(void 0),[w,S]=_.useState(void 0),R=x=>{a(x.isCameraEnabled),s(x.isMicrophoneEnabled),l(x.isScreenShareEnabled),S(x.cameraTrack),v(x.microphoneTrack),h(x.participant.lastMicrophoneError),g(x.participant.lastCameraError),r(x.participant)};return _.useEffect(()=>{const x=ohe(e.localParticipant).subscribe(R);return()=>x.unsubscribe()},[e]),{isMicrophoneEnabled:i,isScreenShareEnabled:c,isCameraEnabled:o,microphoneTrack:y,cameraTrack:w,lastMicrophoneError:d,lastCameraError:m,localParticipant:n}}function LQe(t=[he.Source.Camera,he.Source.Microphone,he.Source.ScreenShare,he.Source.ScreenShareAudio,he.Source.Unknown],e={}){const n=lhe(e.room),[r,i]=_.useState([]),[s,o]=_.useState([]),a=_.useMemo(()=>t.map(c=>ihe(c)?c.source:c),[JSON.stringify(t)]);return _.useEffect(()=>{const c=SQe(n,a,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:l,participants:d})=>{Af.debug("setting track bundles",l,d),i(l),o(d)});return()=>c.unsubscribe()},[n,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(t)]),_.useMemo(()=>{if(she(t)){const c=MQe(t,s),l=Array.from(r);return s.forEach(d=>{c.has(d.identity)&&(c.get(d.identity)??[]).forEach(h=>{if(r.find(({participant:g,publication:y})=>d.identity===g.identity&&y.source===h))return;Af.debug(`Add ${h} placeholder for participant ${d.identity}.`);const m={participant:d,source:h};l.push(m)})}),l}else return r},[r,s,t])}function OQe(t,e){const n=new Set(t);for(const r of e)n.delete(r);return n}function MQe(t,e){const n=new Map;if(she(t)){const r=t.filter(i=>i.withPlaceholder).map(i=>i.source);e.forEach(i=>{const s=i.getTrackPublications().map(a=>{var c;return(c=a.track)==null?void 0:c.source}).filter(a=>a!==void 0),o=Array.from(OQe(new Set(r),new Set(s)));o.length>0&&n.set(i.identity,o)})}return n}function dhe(t,e={}){const[n,r]=_.useState(gO(t)),[i,s]=_.useState(n?.isMuted),[o,a]=_.useState(n?.isSubscribed),[c,l]=_.useState(n?.track),[d,h]=_.useState("landscape"),m=_.useRef(),{className:g,trackObserver:y}=_.useMemo(()=>yQe(t),[t.participant.sid??t.participant.identity,t.source,rhe(t)&&t.publication.trackSid]);return _.useEffect(()=>{const v=y.subscribe(w=>{Af.debug("update track",w),r(w),s(w?.isMuted),a(w?.isSubscribed),l(w?.track)});return()=>v?.unsubscribe()},[y]),_.useEffect(()=>{var v,w;return c&&(m.current&&c.detach(m.current),(v=e.element)!=null&&v.current&&!(t.participant.isLocal&&c?.kind==="audio")&&c.attach(e.element.current)),m.current=(w=e.element)==null?void 0:w.current,()=>{m.current&&c?.detach(m.current)}},[c,e.element]),_.useEffect(()=>{var v,w;if(typeof((v=n?.dimensions)==null?void 0:v.width)=="number"&&typeof((w=n?.dimensions)==null?void 0:w.height)=="number"){const S=n.dimensions.width>n.dimensions.height?"landscape":"portrait";h(S)}},[n]),{publication:n,isMuted:i,isSubscribed:o,track:c,elementProps:xQe(e.props,{className:g,"data-lk-local-participant":t.participant.isLocal,"data-lk-source":n?.source,...n?.kind==="video"&&{"data-lk-orientation":d}})}}var e5,VW;function DQe(){if(VW)return e5;VW=1;var t="Expected a function",e=NaN,n="[object Symbol]",r=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt,c=typeof IE=="object"&&IE&&IE.Object===Object&&IE,l=typeof self=="object"&&self&&self.Object===Object&&self,d=c||l||Function("return this")(),h=Object.prototype,m=h.toString,g=Math.max,y=Math.min,v=function(){return d.Date.now()};function w(I,k,A){var O,D,N,U,$,K,Y=0,G=!1,F=!1,q=!0;if(typeof I!="function")throw new TypeError(t);k=T(k)||0,S(A)&&(G=!!A.leading,F="maxWait"in A,N=F?g(T(A.maxWait)||0,k):N,q="trailing"in A?!!A.trailing:q);function z(_e){var Ie=O,Ue=D;return O=D=void 0,Y=_e,U=I.apply(Ue,Ie),U}function W(_e){return Y=_e,$=setTimeout(ne,k),G?z(_e):U}function V(_e){var Ie=_e-K,Ue=_e-Y,et=k-Ie;return F?y(et,N-Ue):et}function X(_e){var Ie=_e-K,Ue=_e-Y;return K===void 0||Ie>=k||Ie<0||F&&Ue>=N}function ne(){var _e=v();if(X(_e))return fe(_e);$=setTimeout(ne,V(_e))}function fe(_e){return $=void 0,q&&O?z(_e):(O=D=void 0,U)}function ye(){$!==void 0&&clearTimeout($),Y=0,O=K=D=$=void 0}function Ae(){return $===void 0?U:fe(v())}function be(){var _e=v(),Ie=X(_e);if(O=arguments,D=this,K=_e,Ie){if($===void 0)return W(K);if(F)return $=setTimeout(ne,k),z(K)}return $===void 0&&($=setTimeout(ne,k)),U}return be.cancel=ye,be.flush=Ae,be}function S(I){var k=typeof I;return!!I&&(k=="object"||k=="function")}function R(I){return!!I&&typeof I=="object"}function x(I){return typeof I=="symbol"||R(I)&&m.call(I)==n}function T(I){if(typeof I=="number")return I;if(x(I))return e;if(S(I)){var k=typeof I.valueOf=="function"?I.valueOf():I;I=S(k)?k+"":k}if(typeof I!="string")return I===0?I:+I;I=I.replace(r,"");var A=s.test(I);return A||o.test(I)?a(I.slice(2),A?2:8):i.test(I)?e:+I}return e5=w,e5}var NQe=DQe();const qW=Dfe(NQe);function UQe(t){const e=_.useRef(t);e.current=t,_.useEffect(()=>()=>{e.current()},[])}function jQe(t,e=500,n){const r=_.useRef();UQe(()=>{r.current&&r.current.cancel()});const i=_.useMemo(()=>{const s=qW(t,e,n),o=(...a)=>s(...a);return o.cancel=()=>{s.cancel()},o.isPending=()=>!!r.current,o.flush=()=>s.flush(),o},[t,e,n]);return _.useEffect(()=>{r.current=qW(t,e,n)},[t,e,n]),i}function FQe(t,e,n){const r=(l,d)=>l===d,i=t instanceof Function?t():t,[s,o]=_.useState(i),a=_.useRef(i),c=jQe(o,e,n);return r(a.current,i)||(c(i),a.current=i),[s,c]}function $Qe({threshold:t=0,root:e=null,rootMargin:n="0%",freezeOnceVisible:r=!1,initialIsIntersecting:i=!1,onChange:s}={}){var o;const[a,c]=_.useState(null),[l,d]=_.useState(()=>({isIntersecting:i,entry:void 0})),h=_.useRef();h.current=s;const m=((o=l.entry)==null?void 0:o.isIntersecting)&&r;_.useEffect(()=>{if(!a||!("IntersectionObserver"in window)||m)return;const v=new IntersectionObserver(w=>{const S=Array.isArray(v.thresholds)?v.thresholds:[v.thresholds];w.forEach(R=>{const x=R.isIntersecting&&S.some(T=>R.intersectionRatio>=T);d({isIntersecting:x,entry:R}),h.current&&h.current(x,R)})},{threshold:t,root:e,rootMargin:n});return v.observe(a),()=>{v.disconnect()}},[a,JSON.stringify(t),e,n,m,r]);const g=_.useRef(null);_.useEffect(()=>{var v;!a&&(v=l.entry)!=null&&v.target&&!r&&!m&&g.current!==l.entry.target&&(g.current=l.entry.target,d({isIntersecting:i,entry:void 0}))},[a,l.entry,r,m,i]);const y=[c,!!l.isIntersecting,l.entry];return y.ref=y[0],y.isIntersecting=y[1],y.entry=y[2],y}const BQe=_.forwardRef(function({onTrackClick:t,onClick:e,onSubscriptionStatusChanged:n,trackRef:r,manageSubscription:i,...s},o){const a=ahe(r),c=_.useRef(null);_.useImperativeHandle(o,()=>c.current);const l=$Qe({root:c.current}),[d]=FQe(l,3e3);_.useEffect(()=>{i&&a.publication instanceof xC&&d?.isIntersecting===!1&&l?.isIntersecting===!1&&a.publication.setSubscribed(!1)},[d,a,i]),_.useEffect(()=>{i&&a.publication instanceof xC&&l?.isIntersecting===!0&&a.publication.setSubscribed(!0)},[l,a,i]);const{elementProps:h,publication:m,isSubscribed:g}=dhe(a,{element:c,props:s});_.useEffect(()=>{n?.(!!g)},[g,n]);const y=v=>{e?.(v),t?.({participant:a?.participant,track:m})};return _.createElement("video",{ref:c,...h,muted:!0,onClick:y})}),HQe=_.forwardRef(function({trackRef:t,onSubscriptionStatusChanged:e,volume:n,...r},i){const s=ahe(t),o=_.useRef(null);_.useImperativeHandle(i,()=>o.current);const{elementProps:a,isSubscribed:c,track:l,publication:d}=dhe(s,{element:o,props:r});return _.useEffect(()=>{e?.(!!c)},[c,e]),_.useEffect(()=>{l===void 0||n===void 0||(l instanceof kee?l.setVolume(n):Af.warn("Volume can only be set on remote audio tracks."))},[n,l]),_.useEffect(()=>{d===void 0||r.muted===void 0||(d instanceof xC?d.setEnabled(!r.muted):Af.warn("Can only call setEnabled on remote track publications."))},[r.muted,d,l]),_.createElement("audio",{ref:o,...a})});function VQe(t,e){const[n,r]=_.useState(),i=_.useMemo(()=>new ms,[]);return _.useEffect(()=>{let s=!1,o=[];return i.lock().then(async a=>{try{(t.audio||t.video)&&(o=await v_(t),s?o.forEach(c=>c.stop()):r(o))}catch(c){e&&c instanceof Error?e(c):Af.error(c)}finally{a()}}),()=>{s=!0,o.forEach(a=>{a.stop()})}},[JSON.stringify(t,AQe),e,i]),n}const qQe="_inRoom_110p2_8",GQe="_header_110p2_17",KQe="_filler_110p2_29",zQe="_footer_110p2_34",WQe="_hidden_110p2_53",YQe="_overlay_110p2_57",XQe="_logo_110p2_75",JQe="_buttons_110p2_84",QQe="_layout_110p2_91",ZQe="_shareScreen_110p2_111",eZe="_invite_110p2_123",tZe="_raiseHand_110p2_124",nZe="_fixedGrid_110p2_147",rZe="_scrollingGrid_110p2_153",iZe="_tile_110p2_172",sZe="_maximised_110p2_177",gr={inRoom:qQe,header:GQe,filler:KQe,footer:zQe,hidden:WQe,overlay:YQe,logo:XQe,buttons:JQe,layout:QQe,shareScreen:ZQe,invite:eZe,raiseHand:tZe,fixedGrid:nZe,scrollingGrid:rZe,tile:iZe,maximised:sZe},oZe="_content_1cy0f_8",aZe="_wait_1cy0f_19",cZe="_join_1cy0f_32",ty={content:oZe,wait:aZe,join:cZe};function GW(t,e){let n;return(...r)=>{window.clearTimeout(n),n=window.setTimeout(()=>t(...r),e)}}function Zy({debounce:t,scroll:e,polyfill:n,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const i=n||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,o]=_.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=_.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),c=t?typeof t=="number"?t:t.scroll:null,l=t?typeof t=="number"?t:t.resize:null,d=_.useRef(!1);_.useEffect(()=>(d.current=!0,()=>void(d.current=!1)));const[h,m,g]=_.useMemo(()=>{const S=()=>{if(!a.current.element)return;const{left:R,top:x,width:T,height:I,bottom:k,right:A,x:O,y:D}=a.current.element.getBoundingClientRect(),N={left:R,top:x,width:T,height:I,bottom:k,right:A,x:O,y:D};a.current.element instanceof HTMLElement&&r&&(N.height=a.current.element.offsetHeight,N.width=a.current.element.offsetWidth),Object.freeze(N),d.current&&!fZe(a.current.lastBounds,N)&&o(a.current.lastBounds=N)};return[S,l?GW(S,l):S,c?GW(S,c):S]},[o,r,c,l]);function y(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(S=>S.removeEventListener("scroll",g,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function v(){a.current.element&&(a.current.resizeObserver=new i(g),a.current.resizeObserver.observe(a.current.element),e&&a.current.scrollContainers&&a.current.scrollContainers.forEach(S=>S.addEventListener("scroll",g,{capture:!0,passive:!0})),a.current.orientationHandler=()=>{g()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}const w=S=>{!S||S===a.current.element||(y(),a.current.element=S,a.current.scrollContainers=fhe(S),v())};return uZe(g,!!e),lZe(m),_.useEffect(()=>{y(),v()},[e,g,m]),_.useEffect(()=>y,[]),[w,s,h]}function lZe(t){_.useEffect(()=>{const e=t;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[t])}function uZe(t,e){_.useEffect(()=>{if(e){const n=t;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[t,e])}function fhe(t){const e=[];if(!t||t===document.body)return e;const{overflow:n,overflowX:r,overflowY:i}=window.getComputedStyle(t);return[n,r,i].some(s=>s==="auto"||s==="scroll")&&e.push(t),[...e,...fhe(t.parentElement)]}const dZe=["x","y","top","bottom","left","right","width","height"],fZe=(t,e)=>dZe.every(n=>t[n]===e[n]),hZe="_loading_14w06_8",pZe={loading:hZe},mZe=({size:t,loading:e,...n})=>E.jsxs("div",{children:[e&&E.jsx("div",{className:pZe.loading,children:E.jsx(AMe,{size:t/3})}),E.jsx(Op,{size:t,...n})]}),gZe="_preview_1jjvr_8",vZe="_mirror_1jjvr_24",yZe="_cameraStarting_1jjvr_28",bZe="_avatarContainer_1jjvr_39",_Ze="_buttonBar_1jjvr_51",ny={preview:gZe,mirror:vZe,cameraStarting:yZe,avatarContainer:bZe,buttonBar:_Ze},SZe=({matrixInfo:t,muteStates:e,videoTrack:n,children:r})=>{const{t:i}=We(),[s,o]=Zy(),a=_.useRef(null);_.useEffect(()=>(a.current&&n?.attach(a.current),()=>{n?.detach()}),[n]);const c=_.useMemo(()=>e.video.enabled&&!n,[e.video.enabled,n]);return E.jsxs("div",{className:Oe(ny.preview),ref:s,children:[E.jsx("video",{className:n&&rP(n).facingMode==="user"?ny.mirror:void 0,ref:a,muted:!0,playsInline:!0,tabIndex:-1,disablePictureInPicture:!0}),(!e.video.enabled||c)&&E.jsx(E.Fragment,{children:E.jsxs("div",{className:ny.avatarContainer,children:[c&&E.jsx("div",{className:ny.cameraStarting,role:"status",children:i("video_tile.camera_starting")}),E.jsx(mZe,{id:t.userId,name:t.displayName,size:Math.min(o.width,o.height)/2,src:t.avatarUrl,loading:c})]})}),E.jsx("div",{className:ny.buttonBar,children:r})]})},hhe=t=>{const{t:e}=We();return E.jsx(Bt,{kind:"secondary",size:"sm",Icon:D8e,...t,children:e("action.invite")})};function ic(t){const e=_.useRef(void 0);return e.current??={value:t()},e.current.value}function Pf(t){const e=_.useRef(t);return e.current=t,e}const phe=({client:t,matrixInfo:e,muteStates:n,onEnter:r,enterLabel:i,confineToRoom:s,hideHeader:o,participantCount:a,onShareClick:c,waitingForInvite:l})=>{_.useEffect(()=>(M.info("[Lifecycle] GroupCallView Component mounted"),()=>{M.info("[Lifecycle] GroupCallView Component unmounted")}),[]);const{t:d}=We();Q_(e.roomName);const h=_.useCallback(()=>n.audio.setEnabled?.(q=>!q),[n]),m=_.useCallback(()=>n.video.setEnabled?.(q=>!q),[n]),[g,y]=_.useState(!1),[v,w]=_.useState(lD),S=_.useCallback(()=>y(!0),[y]),R=_.useCallback(()=>y(!1),[y]),x=hl(),T=_.useCallback(()=>{x("/")?.catch(q=>{M.error("Failed to navigate to /",q)})},[x]),I=YT("(max-height: 500px)"),k=!s&&E.jsx(il,{className:ty.recents,to:"/",children:d("lobby.leave_button")}),A=Wu(),O=ai(A.videoInput.selected$)?.id,D=ic(()=>n.audio.enabled&&{deviceId:Bw(A.audioInput.selected$)?.id}),{processor:N}=GR(),U=ic(()=>N),$=_.useMemo(()=>({audio:Object.assign({},D),video:n.video.enabled&&{deviceId:O,processor:U}}),[D,n.video.enabled,O,U]),K=Pf(n),Y=_.useCallback(q=>{M.error("Error while creating preview Tracks:",q),K.current.audio.setEnabled?.(!1),K.current.video.setEnabled?.(!1)},[K]),G=VQe($,Y),F=_.useMemo(()=>G?.find(q=>q.kind===he.Kind.Video)??null,[G]);return _.useEffect(()=>{F&&O===void 0&&A.requestDeviceNames()},[A,O,F]),Sfe(F),E.jsxs(E.Fragment,{children:[E.jsxs("div",{className:Oe(ty.room,gr.inRoom),children:[!o&&E.jsxs(qu,{children:[E.jsx(jf,{children:E.jsx(vae,{id:e.roomId,name:e.roomName,avatarUrl:e.roomAvatar,encrypted:e.e2eeSystem.kind!==hn.NONE,participantCount:a})}),E.jsx(Ff,{children:c!==null&&E.jsx(hhe,{onClick:c})})]}),E.jsxs("div",{className:ty.content,children:[E.jsx(SZe,{matrixInfo:e,muteStates:n,videoTrack:F,children:E.jsx(Bt,{className:Oe(ty.join,{[ty.wait]:l}),size:l?"sm":"lg",onClick:()=>{l||r()},"data-testid":"lobby_joinCall",children:i??d("lobby.join_button")})}),!I&&k]}),E.jsxs("div",{className:gr.footer,children:[I&&k,E.jsxs("div",{className:gr.buttons,children:[E.jsx(Ule,{muted:!n.audio.enabled,onClick:h,disabled:n.audio.setEnabled===null}),E.jsx(jle,{muted:!n.video.enabled,onClick:m,disabled:n.video.setEnabled===null}),E.jsx($le,{onClick:S}),!s&&E.jsx(Fle,{onClick:T})]})]})]}),t&&E.jsx(uD,{client:t,open:g,onDismiss:R,tab:v,onTabChange:w})]})},EZe="_headline_1em2y_8",wZe="_callEndedContent_1em2y_15",CZe="_callEndedButton_1em2y_35",TZe="_submitButton_1em2y_40",RZe="_container_1em2y_47",IZe="_main_1em2y_55",kZe="_footer_1em2y_72",Td={headline:EZe,callEndedContent:wZe,callEndedButton:CZe,submitButton:TZe,container:RZe,main:IZe,footer:kZe},xZe="_starIcon_1m09w_8",AZe="_starRating_1m09w_12",PZe="_inputContainer_1m09w_18",LZe="_hideElement_1m09w_22",ry={starIcon:xZe,starRating:AZe,inputContainer:PZe,hideElement:LZe},OZe=(t,e)=>_.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{d:"M14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267Z",fill:"white"})),MZe=_.forwardRef(OZe),DZe=(t,e)=>_.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{id:"Vector",d:"M14 7.50675L15.2933 10.5601L15.92 12.0401L17.52 12.1734L20.8133 12.4534L18.3066 14.6267L17.0933 15.6801L17.4533 17.2534L18.2 20.4667L15.3733 18.7601L14 17.9067L12.6266 18.7334L9.79996 20.4401L10.5466 17.2267L10.9066 15.6534L9.69329 14.6001L7.18663 12.4267L10.48 12.1467L12.08 12.0134L12.7066 10.5334L14 7.50675M14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748Z",fill:"white"})),NZe=_.forwardRef(DZe);function UZe({starCount:t,onChange:e,required:n}){const[r,i]=_.useState(0),[s,o]=_.useState(0),{t:a}=We();return E.jsx("div",{className:ry.starRating,children:[...Array(t)].map((c,l)=>(l+=1,E.jsxs("div",{className:ry.inputContainer,onMouseEnter:()=>o(l),onMouseLeave:()=>o(r),children:[E.jsx("input",{className:ry.hideElement,type:"radio",id:"starInput"+String(l),value:String(l)+"Star",name:"star rating",onChange:d=>{i(l),e(l)},required:!0}),E.jsx("label",{className:ry.hideElement,id:"starInvisibleLabel"+String(l),htmlFor:"starInput"+String(l),children:a("star_rating_input_label",{count:l})}),E.jsx("label",{className:ry.starIcon,id:"starIcon"+String(l),htmlFor:"starInput"+String(l),children:l<=(s||r)?E.jsx(MZe,{}):E.jsx(NZe,{})})]},l)))})}const jZe=({client:t,isPasswordlessUser:e,hideHeader:n,confineToRoom:r,endedCallId:i})=>{const{t:s}=We(),o=hl(),{displayName:a}=V_(t),[c,l]=_.useState(!1),[d,h]=_.useState(0),[m,g]=_.useState(!1),[y,v]=_.useState(!1),w=_.useCallback(x=>{x.preventDefault();const I=new FormData(x.target).get("feedbackText");Ut.instance.eventQualitySurvey.track(i,I,d),g(!0),setTimeout(()=>{v(!0),setTimeout(()=>{e?l(!0):r||o("/")?.catch(k=>{M.error("Failed to navigate to /",k)})},1e3)},1e3)},[i,o,e,r,d]),S=e&&E.jsxs("div",{className:Td.callEndedContent,children:[E.jsxs(Ys,{i18nKey:"call_ended_view.create_account_prompt",children:[E.jsx("p",{children:"Why not finish by setting up a password to keep your account?"}),E.jsx("p",{children:"You'll be able to keep your name and set an avatar for use on future calls"})]}),E.jsx(q8,{className:Td.callEndedButton,to:"/register",children:s("call_ended_view.create_account_button")})]}),R=E.jsxs("div",{className:Td.callEndedContent,children:[E.jsx(Ys,{i18nKey:"call_ended_view.feedback_prompt",children:E.jsx("p",{children:"We'd love to hear your feedback so we can improve your experience."})}),E.jsxs("form",{onSubmit:w,children:[E.jsx(yt,{children:E.jsx(UZe,{starCount:5,onChange:h,required:!0})}),E.jsx(yt,{children:E.jsx(Tn,{className:Yle.feedback,id:"feedbackText",name:"feedbackText",label:s("settings.feedback_tab_description_label"),placeholder:s("settings.feedback_tab_description_label"),type:"textarea"})})," ",E.jsx(yt,{children:y?E.jsx(Ys,{i18nKey:"call_ended_view.feedback_done",children:E.jsx("p",{children:"Thanks for your feedback!"})}):E.jsx(Bt,{type:"submit",className:Td.submitButton,"data-testid":"home_go",children:s(m?"submitting":"action.submit")})})]})]});return E.jsxs(E.Fragment,{children:[!n&&E.jsxs(qu,{children:[E.jsx(jf,{children:!r&&E.jsx(fp,{})}),E.jsx(Ff,{})]}),E.jsxs("div",{className:Td.container,children:[E.jsxs("main",{className:Td.main,children:[E.jsx(gl,{size:"xl",weight:"semibold",className:Td.headline,children:c?s("call_ended_view.headline",{displayName:a}):s("call_ended_view.headline",{displayName:a})+`
`+s("call_ended_view.survey_prompt")}),(!c||r)&&Ut.instance.isEnabled()?R:S]}),!r&&E.jsx(an,{className:Td.footer,children:E.jsxs(il,{to:"/",children:[" ",s("call_ended_view.not_now_button")," "]})})]})]})};function KW(t,e,n){return n.find(i=>i.kind===e&&i.label===t)?.deviceId}const FZe=(t,e)=>_.createElement("svg",{width:48,height:48,viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("g",{id:"Logo Mark"},_.createElement("rect",{width:47.86,height:48,rx:23.93,fill:"#0DBD8B"}),_.createElement("g",{id:"Union"},_.createElement("path",{d:"M21.3075 9.42871C20.3396 9.42871 19.5549 10.214 19.5549 11.1828C19.5549 12.1516 20.3396 12.9369 21.3075 12.9369C25.9321 12.9369 29.6811 16.689 29.6811 21.3175C29.6811 22.2863 30.4657 23.0716 31.4337 23.0716C32.4016 23.0716 33.1863 22.2863 33.1863 21.3175C33.1863 14.7515 27.868 9.42871 21.3075 9.42871Z",fill:"white"}),_.createElement("path",{d:"M38.4591 21.3174C38.4591 20.3486 37.6745 19.5633 36.7065 19.5633C35.7386 19.5633 34.9539 20.3486 34.9539 21.3174C34.9539 25.9459 31.2049 29.698 26.5804 29.698C25.6124 29.698 24.8277 30.4833 24.8277 31.4521C24.8277 32.4209 25.6124 33.2062 26.5804 33.2062C33.1408 33.2062 38.4591 27.8834 38.4591 21.3174Z",fill:"white"}),_.createElement("path",{d:"M28.3329 36.8173C28.3329 37.786 27.5482 38.5714 26.5803 38.5714C20.0198 38.5714 14.7015 33.2486 14.7015 26.6826C14.7015 25.7138 15.4862 24.9285 16.4541 24.9285C17.4221 24.9285 18.2067 25.7138 18.2067 26.6826C18.2067 31.3111 21.9557 35.0632 26.5803 35.0632C27.5482 35.0632 28.3329 35.8485 28.3329 36.8173Z",fill:"white"}),_.createElement("path",{d:"M9.40112 26.6827C9.40112 27.6514 10.1858 28.4368 11.1537 28.4368C12.1217 28.4368 12.9064 27.6514 12.9064 26.6827C12.9064 22.0542 16.6553 18.3021 21.2799 18.3021C22.2478 18.3021 23.0325 17.5167 23.0325 16.548C23.0325 15.5792 22.2478 14.7939 21.2799 14.7939C14.7194 14.7939 9.40112 20.1167 9.40112 26.6827Z",fill:"white"})))),$Ze=_.forwardRef(FZe),BZe=(t,e)=>_.createElement("svg",{width:160,height:22,viewBox:"0 0 160 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("g",{id:"Logo Type"},_.createElement("g",{id:"Vector"},_.createElement("path",{d:"M14.8673 15.1575H3.39742C3.53293 16.3508 3.96849 17.3036 4.70411 18.0157C5.43974 18.7087 6.40766 19.0551 7.60789 19.0551C8.40159 19.0551 9.11785 18.8626 9.75668 18.4777C10.3955 18.0927 10.8504 17.5731 11.1215 16.9186H14.606C14.1414 18.4392 13.2702 19.671 11.9926 20.6142C10.7343 21.5381 9.24368 22 7.52078 22C5.27519 22 3.45549 21.259 2.06168 19.7769C0.687227 18.2948 0 16.4182 0 14.147C0 11.9335 0.696906 10.0761 2.09072 8.5748C3.48453 7.07349 5.28487 6.32283 7.49174 6.32283C9.69861 6.32283 11.4796 7.06387 12.8347 8.54593C14.2091 10.0087 14.8964 11.8565 14.8964 14.0892L14.8673 15.1575ZM7.49174 9.12336C6.40766 9.12336 5.50749 9.44095 4.79123 10.0761C4.07496 10.7113 3.62972 11.5582 3.45549 12.6168H11.4699C11.315 11.5582 10.8892 10.7113 10.1922 10.0761C9.49534 9.44095 8.59517 9.12336 7.49174 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M17.2743 17.1785V0H20.7298V17.2362C20.7298 18.0061 21.1557 18.3911 22.0074 18.3911L22.6172 18.3622V21.6247C22.2881 21.6824 21.9397 21.7113 21.5719 21.7113C20.0813 21.7113 18.9875 21.336 18.2906 20.5853C17.6131 19.8346 17.2743 18.699 17.2743 17.1785Z",fill:"currentColor"}),_.createElement("path",{d:"M38.71 15.1575H27.2401C27.3756 16.3508 27.8112 17.3036 28.5468 18.0157C29.2824 18.7087 30.2504 19.0551 31.4506 19.0551C32.2443 19.0551 32.9606 18.8626 33.5994 18.4777C34.2382 18.0927 34.6931 17.5731 34.9642 16.9186H38.4487C37.9841 18.4392 37.113 19.671 35.8353 20.6142C34.577 21.5381 33.0864 22 31.3635 22C29.1179 22 27.2982 21.259 25.9044 19.7769C24.5299 18.2948 23.8427 16.4182 23.8427 14.147C23.8427 11.9335 24.5396 10.0761 25.9334 8.5748C27.3272 7.07349 29.1276 6.32283 31.3344 6.32283C33.5413 6.32283 35.3223 7.06387 36.6774 8.54593C38.0518 10.0087 38.7391 11.8565 38.7391 14.0892L38.71 15.1575ZM31.3344 9.12336C30.2504 9.12336 29.3502 9.44095 28.6339 10.0761C27.9177 10.7113 27.4724 11.5582 27.2982 12.6168H35.3126C35.1577 11.5582 34.7319 10.7113 34.035 10.0761C33.3381 9.44095 32.4379 9.12336 31.3344 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M54.3001 13.0499V21.6535H50.8446V12.6745C50.8446 10.4033 49.8961 9.26772 47.9989 9.26772C46.9729 9.26772 46.1502 9.59493 45.5307 10.2493C44.9306 10.9038 44.6306 11.7988 44.6306 12.9344V21.6535H41.1751V6.66929H44.3692V8.66142C44.737 7.98775 45.2984 7.42957 46.0534 6.98688C46.8084 6.54418 47.7473 6.32283 48.8701 6.32283C50.9608 6.32283 52.4707 7.11199 53.4 8.69029C54.6776 7.11199 56.3812 6.32283 58.5106 6.32283C60.2722 6.32283 61.6273 6.87139 62.5759 7.9685C63.5244 9.04637 63.9987 10.4707 63.9987 12.2415V21.6535H60.5432V12.6745C60.5432 10.4033 59.5947 9.26772 57.6975 9.26772C56.6522 9.26772 55.8198 9.60455 55.2003 10.2782C54.6002 10.9326 54.3001 11.8565 54.3001 13.0499Z",fill:"currentColor"}),_.createElement("path",{d:"M81.1834 15.1575H69.7135C69.849 16.3508 70.2846 17.3036 71.0202 18.0157C71.7558 18.7087 72.7237 19.0551 73.924 19.0551C74.7177 19.0551 75.4339 18.8626 76.0728 18.4777C76.7116 18.0927 77.1665 17.5731 77.4375 16.9186H80.9221C80.4575 18.4392 79.5863 19.671 78.3087 20.6142C77.0504 21.5381 75.5598 22 73.8369 22C71.5913 22 69.7716 21.259 68.3778 19.7769C67.0033 18.2948 66.3161 16.4182 66.3161 14.147C66.3161 11.9335 67.013 10.0761 68.4068 8.5748C69.8006 7.07349 71.601 6.32283 73.8078 6.32283C76.0147 6.32283 77.7957 7.06387 79.1508 8.54593C80.5252 10.0087 81.2124 11.8565 81.2124 14.0892L81.1834 15.1575ZM73.8078 9.12336C72.7237 9.12336 71.8236 9.44095 71.1073 10.0761C70.391 10.7113 69.9458 11.5582 69.7716 12.6168H77.786C77.6311 11.5582 77.2052 10.7113 76.5083 10.0761C75.8114 9.44095 74.9113 9.12336 73.8078 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M86.8426 6.66929V8.66142C87.191 8.007 87.7621 7.45844 88.5558 7.01575C89.3689 6.55381 90.3465 6.32283 91.4886 6.32283C93.2696 6.32283 94.6441 6.86177 95.612 7.93963C96.5993 9.0175 97.0929 10.4514 97.0929 12.2415V21.6535H93.6374V12.6745C93.6374 11.6159 93.3858 10.7883 92.8824 10.1916C92.3985 9.57568 91.6532 9.26772 90.6465 9.26772C89.5431 9.26772 88.672 9.59493 88.0331 10.2493C87.4137 10.9038 87.1039 11.8084 87.1039 12.9633V21.6535H83.6484V6.66929H86.8426Z",fill:"currentColor"}),_.createElement("path",{d:"M107.185 18.5932V21.5669C106.759 21.6824 106.159 21.7402 105.384 21.7402C102.442 21.7402 100.971 20.2677 100.971 17.3228V9.41208H98.6766V6.66929H100.971V2.77165H104.426V6.66929H107.243V9.41208H104.426V16.9764C104.426 18.1505 104.987 18.7375 106.11 18.7375L107.185 18.5932Z",fill:"currentColor"}),_.createElement("path",{d:"M116.115 18.9881C114.474 17.2035 113.653 14.9429 113.653 12.2064C113.653 9.4699 114.474 7.21782 116.115 5.45015C117.773 3.66548 119.953 2.77314 122.654 2.77314C124.876 2.77314 126.756 3.38503 128.295 4.6088C129.833 5.83258 130.816 7.47277 131.244 9.52939H129.269C128.91 7.99967 128.132 6.7844 126.936 5.88357C125.739 4.98273 124.312 4.53232 122.654 4.53232C120.534 4.53232 118.824 5.23769 117.525 6.64842C116.243 8.05916 115.602 9.91182 115.602 12.2064C115.602 14.501 116.243 16.3536 117.525 17.7644C118.824 19.1751 120.534 19.8805 122.654 19.8805C124.312 19.8805 125.739 19.4301 126.936 18.5292C128.132 17.6284 128.91 16.4131 129.269 14.8834H131.244C130.816 16.94 129.833 18.5802 128.295 19.804C126.756 21.0278 124.876 21.6397 122.654 21.6397C119.953 21.6397 117.773 20.7558 116.115 18.9881Z",fill:"currentColor"}),_.createElement("path",{d:"M143.174 15.0874C140.832 15.0874 139.233 15.1384 138.379 15.2403C137.541 15.3253 136.926 15.4698 136.532 15.6738C135.831 16.0647 135.481 16.6936 135.481 17.5604C135.481 19.2261 136.473 20.0589 138.456 20.0589C139.977 20.0589 141.139 19.719 141.943 19.0391C142.763 18.3593 143.174 17.4499 143.174 16.3111V15.0874ZM138.25 21.5632C136.763 21.5632 135.626 21.2062 134.84 20.4924C134.071 19.7615 133.686 18.8012 133.686 17.6114C133.686 16.8295 133.891 16.1327 134.301 15.5208C134.729 14.9089 135.31 14.4585 136.045 14.1695C136.661 13.9316 137.455 13.7786 138.43 13.7106C139.404 13.6256 140.986 13.5831 143.174 13.5831V12.7418C143.174 10.6002 141.943 9.52939 139.481 9.52939C137.361 9.52939 136.131 10.3877 135.789 12.1044H134.019C134.207 10.8466 134.746 9.84383 135.635 9.09597C136.541 8.34811 137.849 7.97418 139.558 7.97418C141.387 7.97418 142.746 8.3991 143.635 9.24894C144.541 10.0988 144.994 11.2716 144.994 12.7673V21.2572H143.251V19.3706C142.345 20.8323 140.678 21.5632 138.25 21.5632Z",fill:"currentColor"}),_.createElement("path",{d:"M149.358 18.4018V2.13576H151.178V18.1978C151.178 18.7247 151.264 19.0901 151.435 19.2941C151.623 19.498 151.956 19.6 152.435 19.6L152.948 19.549V21.2062C152.657 21.2572 152.341 21.2827 151.999 21.2827C150.238 21.2827 149.358 20.3224 149.358 18.4018Z",fill:"currentColor"}),_.createElement("path",{d:"M155.944 18.4018V2.13576H157.764V18.1978C157.764 18.7247 157.85 19.0901 158.021 19.2941C158.209 19.498 158.542 19.6 159.021 19.6L159.534 19.549V21.2062C159.243 21.2572 158.927 21.2827 158.585 21.2827C156.824 21.2827 155.944 20.3224 155.944 18.4018Z",fill:"currentColor"})))),HZe=_.forwardRef(BZe),zW=t=>{const e=document.activeElement;return e!==null&&e.contains(t)},WW=Object.fromEntries(qb.slice(0,jL).map((t,e)=>[(e+1).toString(),t]));function VZe(t,e,n,r,i,s){const o=_.useRef(!1);Fw(window,"keydown",_.useCallback(a=>{t.current!==null&&zW(t.current)&&(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey||(a.key==="m"?(a.preventDefault(),e()):a.key=="v"?(a.preventDefault(),n()):a.key===" "?(a.preventDefault(),o.current||(o.current=!0,r(!1))):a.key==="h"?(a.preventDefault(),s()):WW[a.key]&&(a.preventDefault(),i(WW[a.key]))))},[t,n,e,r,i,s]),_.useMemo(()=>({capture:!0}),[])),Fw(window,"keyup",_.useCallback(a=>{t.current!==null&&zW(t.current)&&a.key===" "&&(o.current=!1,r(!0))},[t,r])),Fw(window,"blur",_.useCallback(()=>{o.current&&(o.current=!1,r(!0))},[r,o]))}const qZe="_tile_31vx3_8",GZe="_speaking_31vx3_28",KZe="_handRaised_31vx3_48",zZe="_muteIcon_31vx3_75",WZe="_volumeSlider_31vx3_83",YZe="_switchCamera_31vx3_87",_g={tile:qZe,speaking:GZe,handRaised:KZe,muteIcon:zZe,volumeSlider:WZe,switchCamera:YZe},YW=Symbol("nothing");class XR{constructor(){this.ended$=new ii,this.bindImpl=Cle(this.ended$)}bind(){return this.bindImpl}behavior(e,n=YW){const r=new _s(n);if(e.pipe(this.bind(),Kc()).subscribe({next(i){r.next(i)},error(i){r.error(i)}}),r.value===YW)throw new Error("Behavior failed to synchronously emit an initial value");return r}end(){this.ended$.next(),this.ended$.complete()}}const XZe=new XR;class nS{constructor(){this.scope=new XR}destroy(){this.scope.end()}}function vD(t,e){return X8(t).pipe(Re(()=>({participant:t,publication:t.getTrackPublication(e),source:e})),uGe("publication"))}function mhe(t,e,n){return Xt([vD(t,e),Zqe(1e3).pipe(dn(0))]).pipe(Ot(async([r])=>{const i=r?.publication?.track;if(!i||!(i instanceof N7||i instanceof D7))return;const s=await i.getRTCStatsReport();if(s){for(const o of s.values())if(o.type===n)return o}}),dn(void 0))}function vO(t,e){return mhe(t,e,"inbound-rtp").pipe(Re(n=>n))}function XW(t,e){return mhe(t,e,"outbound-rtp").pipe(Re(n=>n))}function xE(t,e){let n={framesDecoded:void 0,framesReceived:void 0};return vO(t,e).pipe(Re(r=>{if(!r)return;const{framesDecoded:i,framesDropped:s,framesReceived:o}=r;return{framesDecoded:i,framesDropped:s,framesReceived:o}}),es(r=>!!r),Re(r=>{const i=n;if(n=r,typeof r.framesReceived=="number"&&typeof i.framesReceived=="number"&&typeof r.framesDecoded=="number"&&typeof i.framesDecoded=="number"){const s=r.framesReceived-i.framesReceived,o=r.framesDecoded-i.framesDecoded;if(s>0)return o>0}}),es(r=>typeof r=="boolean"),dn(void 0))}function t5(t,e,n,r){return fze(t,ue.EncryptionError).pipe(Re(i=>{const[s]=i;return n.kind===hn.PER_PARTICIPANT?(s?.message.includes(e.identity)&&s?.message.includes(r))??!1:n.kind===hn.SHARED_KEY?!!s?.message.includes(r):!1}),BL(1e3),dn(!1))}class ghe extends nS{constructor(e,n,r,i,s,o,a,c){super(),this.id=e,this.member=n,this.participant$=r,this.displayName$=c;const l=this.observeTrackReference$(s);this.video$=this.observeTrackReference$(o),this.unencryptedWarning$=this.scope.behavior(Xt([l,this.video$],(d,h)=>i.kind!==hn.NONE&&(d?.publication?.isEncrypted===!1||h?.publication?.isEncrypted===!1))),this.encryptionStatus$=this.scope.behavior(this.participant$.pipe(Ot(d=>d?d.isLocal||i.kind===hn.NONE?Ct(1):i.kind===hn.PER_PARTICIPANT?Xt([t5(a,d,i,"MissingKey"),t5(a,d,i,"InvalidKey"),xE(d,s),xE(d,o)]).pipe(Re(([h,m,g,y])=>{if(h)return 2;if(m)return 3;if(g||y)return 1}),es(h=>!!h),dn(0)):Xt([t5(a,d,i,"InvalidKey"),xE(d,s),xE(d,o)]).pipe(Re(([h,m,g])=>{if(h)return 4;if(m||g)return 1}),es(h=>!!h),dn(0)):Ct(0))))}observeTrackReference$(e){return this.scope.behavior(this.participant$.pipe(Ot(n=>n===void 0?Ct(void 0):vD(n,e))))}}class vhe extends ghe{constructor(e,n,r,i,s,o,a,c){super(e,n,r,i,he.Source.Microphone,he.Source.Camera,s,o),this.handRaised$=a,this.reaction$=c,this._speaking$=this.scope.behavior(this.participant$.pipe(Ot(d=>d?Y8(d,ce.IsSpeakingChanged).pipe(Re(h=>h.isSpeaking)):Ct(!1)))),this._cropVideo$=new _s(!0),this.cropVideo$=this._cropVideo$;const l=this.scope.behavior(r.pipe(Ot(d=>(d&&X8(d))??Ct(void 0))));this.audioEnabled$=this.scope.behavior(l.pipe(Re(d=>d?.microphoneTrack?.isMuted===!1))),this._videoEnabled$=this.scope.behavior(l.pipe(Re(d=>d?.cameraTrack?.isMuted===!1)))}get speaking$(){return this._speaking$}get videoEnabled$(){return this._videoEnabled$}toggleFitContain(){this._cropVideo$.next(!this._cropVideo$.value)}get local(){return this instanceof Dv}}class Dv extends vhe{constructor(e,n,r,i,s,o,a,c,l){super(e,n,r,i,s,a,c,l),this.mediaDevices=o,this.videoTrack$=this.video$.pipe(Ot(d=>{const h=d?.publication?.track;return h instanceof cv?H_(Zo(h,Te.Restarted).pipe(dn(null),Re(()=>h)),Zo(h,Te.Muted).pipe(Re(()=>null))):Ct(null)})),this.mirror$=this.scope.behavior(this.videoTrack$.pipe(Re(d=>d!==null&&rP(d).facingMode==="user"))),this.alwaysShow$=JK.value$,this.setAlwaysShow=JK.setValue,this.switchCamera$=this.scope.behavior(va==="desktop"?Ct(null):this.videoTrack$.pipe(Re(d=>{if(d===null)return null;const h=rP(d).facingMode;return h!=="user"&&h!=="environment"?null:()=>void d.restartTrack({facingMode:h==="user"?"environment":"user"}).then(()=>{const m=d.mediaStreamTrack.getSettings().deviceId;m!==void 0&&this.mediaDevices.videoInput.select(m)}).catch(m=>M.error("Failed to switch camera",h,m))}))),this.audioStreamStats$=Xt([this.participant$,Gb.value$]).pipe(Ot(([d,h])=>!d||!h?Ct(void 0):XW(d,he.Source.Microphone))),this.videoStreamStats$=Xt([this.participant$,Gb.value$]).pipe(Ot(([d,h])=>!d||!h?Ct(void 0):XW(d,he.Source.Camera)))}}class JZe extends vhe{constructor(e,n,r,i,s,o,a,c,l){super(e,n,r,i,s,a,c,l),this.pretendToBeDisconnected$=o,this.locallyMutedToggle$=new ii,this.localVolumeAdjustment$=new ii,this.localVolumeCommit$=new ii,this.localVolume$=this.scope.behavior(H_(this.locallyMutedToggle$.pipe(Re(()=>"toggle mute")),this.localVolumeAdjustment$,this.localVolumeCommit$.pipe(Re(()=>"commit"))).pipe(qL({volume:1,committedVolume:1},(d,h)=>{switch(h){case"toggle mute":return{...d,volume:d.volume===0?d.committedVolume:0};case"commit":return{...d,committedVolume:d.volume===0?d.committedVolume:d.volume};default:return{...d,volume:h}}}),Re(({volume:d})=>d))),this.locallyMuted$=this.scope.behavior(this.localVolume$.pipe(Re(d=>d===0))),this.audioStreamStats$=Xt([this.participant$,Gb.value$]).pipe(Ot(([d,h])=>!d||!h?Ct(void 0):vO(d,he.Source.Microphone))),this.videoStreamStats$=Xt([this.participant$,Gb.value$]).pipe(Ot(([d,h])=>!d||!h?Ct(void 0):vO(d,he.Source.Camera))),this.__speaking$=this.scope.behavior(o.pipe(Ot(d=>d?Ct(!1):super.speaking$))),this.__videoEnabled$=this.scope.behavior(o.pipe(Ot(d=>d?Ct(!1):super.videoEnabled$))),Xt([r,this.pretendToBeDisconnected$.pipe(Ot(d=>d?Ct(0):this.localVolume$),this.scope.bind())]).subscribe(([d,h])=>d?.setVolume(h))}get speaking$(){return this.__speaking$}get videoEnabled$(){return this.__videoEnabled$}toggleLocallyMuted(){this.locallyMutedToggle$.next()}setLocalVolume(e){this.localVolumeAdjustment$.next(e)}commitLocalVolume(){this.localVolumeCommit$.next()}}class Sg extends ghe{constructor(e,n,r,i,s,o,a,c){super(e,n,r,i,he.Source.ScreenShareAudio,he.Source.ScreenShare,s,a),this.pretendToBeDisconnected$=o,this.local=c,this.videoEnabled$=this.scope.behavior(this.pretendToBeDisconnected$.pipe(Re(l=>!l)))}}var yD=iS(),mt=t=>rS(t,yD),bD=iS();mt.write=t=>rS(t,bD);var JR=iS();mt.onStart=t=>rS(t,JR);var _D=iS();mt.onFrame=t=>rS(t,_D);var SD=iS();mt.onFinish=t=>rS(t,SD);var Qg=[];mt.setTimeout=(t,e)=>{const n=mt.now()+e,r=()=>{const s=Qg.findIndex(o=>o.cancel==r);~s&&Qg.splice(s,1),Jd-=~s?1:0},i={time:n,handler:t,cancel:r};return Qg.splice(yhe(n),0,i),Jd+=1,bhe(),i};var yhe=t=>~(~Qg.findIndex(e=>e.time>t)||~Qg.length);mt.cancel=t=>{JR.delete(t),_D.delete(t),SD.delete(t),yD.delete(t),bD.delete(t)};mt.sync=t=>{yO=!0,mt.batchedUpdates(t),yO=!1};mt.throttle=t=>{let e;function n(){try{t(...e)}finally{e=null}}function r(...i){e=i,mt.onStart(n)}return r.handler=t,r.cancel=()=>{JR.delete(n),e=null},r};var ED=typeof window<"u"?window.requestAnimationFrame:()=>{};mt.use=t=>ED=t;mt.now=typeof performance<"u"?()=>performance.now():Date.now;mt.batchedUpdates=t=>t();mt.catch=console.error;mt.frameLoop="always";mt.advance=()=>{mt.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):She()};var Xd=-1,Jd=0,yO=!1;function rS(t,e){yO?(e.delete(t),t(0)):(e.add(t),bhe())}function bhe(){Xd<0&&(Xd=0,mt.frameLoop!=="demand"&&ED(_he))}function QZe(){Xd=-1}function _he(){~Xd&&(ED(_he),mt.batchedUpdates(She))}function She(){const t=Xd;Xd=mt.now();const e=yhe(Xd);if(e&&(Ehe(Qg.splice(0,e),n=>n.handler()),Jd-=e),!Jd){QZe();return}JR.flush(),yD.flush(t?Math.min(64,Xd-t):16.667),_D.flush(),bD.flush(),SD.flush()}function iS(){let t=new Set,e=t;return{add(n){Jd+=e==t&&!t.has(n)?1:0,t.add(n)},delete(n){return Jd-=e==t&&t.has(n)?1:0,t.delete(n)},flush(n){e.size&&(t=new Set,Jd-=e.size,Ehe(e,r=>r(n)&&t.add(r)),Jd+=t.size,e=t)}}}function Ehe(t,e){t.forEach(n=>{try{e(n)}catch(r){mt.catch(r)}})}var ZZe=Object.defineProperty,eet=(t,e)=>{for(var n in e)ZZe(t,n,{get:e[n],enumerable:!0})},ac={};eet(ac,{assign:()=>net,colors:()=>df,createStringInterpolator:()=>CD,skipAnimation:()=>Che,to:()=>whe,willAdvance:()=>TD});function bO(){}var tet=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),we={arr:Array.isArray,obj:t=>!!t&&t.constructor.name==="Object",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",und:t=>t===void 0};function Ql(t,e){if(we.arr(t)){if(!we.arr(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return t===e}var _t=(t,e)=>t.forEach(e);function ol(t,e,n){if(we.arr(t)){for(let r=0;r<t.length;r++)e.call(n,t[r],`${r}`);return}for(const r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r)}var ps=t=>we.und(t)?[]:we.arr(t)?t:[t];function eb(t,e){if(t.size){const n=Array.from(t);t.clear(),_t(n,e)}}var Sy=(t,...e)=>eb(t,n=>n(...e)),wD=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),CD,whe,df=null,Che=!1,TD=bO,net=t=>{t.to&&(whe=t.to),t.now&&(mt.now=t.now),t.colors!==void 0&&(df=t.colors),t.skipAnimation!=null&&(Che=t.skipAnimation),t.createStringInterpolator&&(CD=t.createStringInterpolator),t.requestAnimationFrame&&mt.use(t.requestAnimationFrame),t.batchedUpdates&&(mt.batchedUpdates=t.batchedUpdates),t.willAdvance&&(TD=t.willAdvance),t.frameLoop&&(mt.frameLoop=t.frameLoop)},tb=new Set,aa=[],n5=[],M3=0,QR={get idle(){return!tb.size&&!aa.length},start(t){M3>t.priority?(tb.add(t),mt.onStart(ret)):(The(t),mt(_O))},advance:_O,sort(t){if(M3)mt.onFrame(()=>QR.sort(t));else{const e=aa.indexOf(t);~e&&(aa.splice(e,1),Rhe(t))}},clear(){aa=[],tb.clear()}};function ret(){tb.forEach(The),tb.clear(),mt(_O)}function The(t){aa.includes(t)||Rhe(t)}function Rhe(t){aa.splice(iet(aa,e=>e.priority>t.priority),0,t)}function _O(t){const e=n5;for(let n=0;n<aa.length;n++){const r=aa[n];M3=r.priority,r.idle||(TD(r),r.advance(t),r.idle||e.push(r))}return M3=0,n5=aa,n5.length=0,aa=e,aa.length>0}function iet(t,e){const n=t.findIndex(e);return n<0?t.length:n}var set={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},tc="[-+]?\\d*\\.?\\d+",D3=tc+"%";function ZR(...t){return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}var oet=new RegExp("rgb"+ZR(tc,tc,tc)),aet=new RegExp("rgba"+ZR(tc,tc,tc,tc)),cet=new RegExp("hsl"+ZR(tc,D3,D3)),uet=new RegExp("hsla"+ZR(tc,D3,D3,tc)),det=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,fet=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,het=/^#([0-9a-fA-F]{6})$/,pet=/^#([0-9a-fA-F]{8})$/;function met(t){let e;return typeof t=="number"?t>>>0===t&&t>=0&&t<=4294967295?t:null:(e=het.exec(t))?parseInt(e[1]+"ff",16)>>>0:df&&df[t]!==void 0?df[t]:(e=oet.exec(t))?(Km(e[1])<<24|Km(e[2])<<16|Km(e[3])<<8|255)>>>0:(e=aet.exec(t))?(Km(e[1])<<24|Km(e[2])<<16|Km(e[3])<<8|ZW(e[4]))>>>0:(e=det.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=pet.exec(t))?parseInt(e[1],16)>>>0:(e=fet.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=cet.exec(t))?(JW(QW(e[1]),AE(e[2]),AE(e[3]))|255)>>>0:(e=uet.exec(t))?(JW(QW(e[1]),AE(e[2]),AE(e[3]))|ZW(e[4]))>>>0:null}function r5(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function JW(t,e,n){const r=n<.5?n*(1+e):n+e-n*e,i=2*n-r,s=r5(i,r,t+1/3),o=r5(i,r,t),a=r5(i,r,t-1/3);return Math.round(s*255)<<24|Math.round(o*255)<<16|Math.round(a*255)<<8}function Km(t){const e=parseInt(t,10);return e<0?0:e>255?255:e}function QW(t){return(parseFloat(t)%360+360)%360/360}function ZW(t){const e=parseFloat(t);return e<0?0:e>1?255:Math.round(e*255)}function AE(t){const e=parseFloat(t);return e<0?0:e>100?1:e/100}function eY(t){let e=met(t);if(e===null)return t;e=e||0;const n=(e&4278190080)>>>24,r=(e&16711680)>>>16,i=(e&65280)>>>8,s=(e&255)/255;return`rgba(${n}, ${r}, ${i}, ${s})`}var Zb=(t,e,n)=>{if(we.fun(t))return t;if(we.arr(t))return Zb({range:t,output:e,extrapolate:n});if(we.str(t.output[0]))return CD(t);const r=t,i=r.output,s=r.range||[0,1],o=r.extrapolateLeft||r.extrapolate||"extend",a=r.extrapolateRight||r.extrapolate||"extend",c=r.easing||(l=>l);return l=>{const d=vet(l,s);return get(l,s[d],s[d+1],i[d],i[d+1],c,o,a,r.map)}};function get(t,e,n,r,i,s,o,a,c){let l=c?c(t):t;if(l<e){if(o==="identity")return l;o==="clamp"&&(l=e)}if(l>n){if(a==="identity")return l;a==="clamp"&&(l=n)}return r===i?r:e===n?t<=e?r:i:(e===-1/0?l=-l:n===1/0?l=l-e:l=(l-e)/(n-e),l=s(l),r===-1/0?l=-l:i===1/0?l=l+r:l=l*(i-r)+r,l)}function vet(t,e){for(var n=1;n<e.length-1&&!(e[n]>=t);++n);return n-1}var yet={linear:t=>t},e_=Symbol.for("FluidValue.get"),Nv=Symbol.for("FluidValue.observers"),sa=t=>!!(t&&t[e_]),js=t=>t&&t[e_]?t[e_]():t,tY=t=>t[Nv]||null;function bet(t,e){t.eventObserved?t.eventObserved(e):t(e)}function t_(t,e){const n=t[Nv];n&&n.forEach(r=>{bet(r,e)})}var Ihe=class{constructor(t){if(!t&&!(t=this.get))throw Error("Unknown getter");_et(this,t)}},_et=(t,e)=>khe(t,e_,e);function h0(t,e){if(t[e_]){let n=t[Nv];n||khe(t,Nv,n=new Set),n.has(e)||(n.add(e),t.observerAdded&&t.observerAdded(n.size,e))}return e}function n_(t,e){const n=t[Nv];if(n&&n.has(e)){const r=n.size-1;r?n.delete(e):t[Nv]=null,t.observerRemoved&&t.observerRemoved(r,e)}}var khe=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),Yw=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Eet=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,nY=new RegExp(`(${Yw.source})(%|[a-z]+)`,"i"),wet=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,e4=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,xhe=t=>{const[e,n]=Cet(t);if(!e||wD())return t;const r=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(r)return r.trim();if(n&&n.startsWith("--")){const i=window.getComputedStyle(document.documentElement).getPropertyValue(n);return i||t}else{if(n&&e4.test(n))return xhe(n);if(n)return n}return t},Cet=t=>{const e=e4.exec(t);if(!e)return[,];const[,n,r]=e;return[n,r]},i5,Tet=(t,e,n,r,i)=>`rgba(${Math.round(e)}, ${Math.round(n)}, ${Math.round(r)}, ${i})`,Ahe=t=>{i5||(i5=df?new RegExp(`(${Object.keys(df).join("|")})(?!\\w)`,"g"):/^\b$/);const e=t.output.map(s=>js(s).replace(e4,xhe).replace(Eet,eY).replace(i5,eY)),n=e.map(s=>s.match(Yw).map(Number)),i=n[0].map((s,o)=>n.map(a=>{if(!(o in a))throw Error('The arity of each "output" value must be equal');return a[o]})).map(s=>Zb({...t,output:s}));return s=>{const o=!nY.test(e[0])&&e.find(c=>nY.test(c))?.replace(Yw,"");let a=0;return e[0].replace(Yw,()=>`${i[a++](s)}${o||""}`).replace(wet,Tet)}},RD="react-spring: ",Phe=t=>{const e=t;let n=!1;if(typeof e!="function")throw new TypeError(`${RD}once requires a function parameter`);return(...r)=>{n||(e(...r),n=!0)}},Ret=Phe(console.warn);function Iet(){Ret(`${RD}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var ket=Phe(console.warn);function xet(){ket(`${RD}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function t4(t){return we.str(t)&&(t[0]=="#"||/\d/.test(t)||!wD()&&e4.test(t)||t in(df||{}))}var Eg=wD()?_.useEffect:_.useLayoutEffect,Aet=()=>{const t=_.useRef(!1);return Eg(()=>(t.current=!0,()=>{t.current=!1}),[]),t};function Lhe(){const t=_.useState()[1],e=Aet();return()=>{e.current&&t(Math.random())}}var Ohe=t=>_.useEffect(t,Pet),Pet=[];function Let(t){const e=_.useRef(void 0);return _.useEffect(()=>{e.current=t}),e.current}var r_=Symbol.for("Animated:node"),Oet=t=>!!t&&t[r_]===t,Hc=t=>t&&t[r_],ID=(t,e)=>tet(t,r_,e),n4=t=>t&&t[r_]&&t[r_].getPayload(),Mhe=class{constructor(){ID(this,this)}getPayload(){return this.payload||[]}},r4=class Dhe extends Mhe{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,we.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new Dhe(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,n){return we.num(e)&&(this.lastPosition=e,n&&(e=Math.round(e/n)*n,this.done&&(this.lastPosition=e))),this._value===e?!1:(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,we.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}},N3=class Nhe extends r4{constructor(e){super(0),this._string=null,this._toString=Zb({output:[e,e]})}static create(e){return new Nhe(e)}getValue(){const e=this._string;return e??(this._string=this._toString(this._value))}setValue(e){if(we.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else if(super.setValue(e))this._string=null;else return!1;return!0}reset(e){e&&(this._toString=Zb({output:[this.getValue(),e]})),this._value=0,super.reset()}},U3={dependencies:null},i4=class extends Mhe{constructor(t){super(),this.source=t,this.setValue(t)}getValue(t){const e={};return ol(this.source,(n,r)=>{Oet(n)?e[r]=n.getValue(t):sa(n)?e[r]=js(n):t||(e[r]=n)}),e}setValue(t){this.source=t,this.payload=this._makePayload(t)}reset(){this.payload&&_t(this.payload,t=>t.reset())}_makePayload(t){if(t){const e=new Set;return ol(t,this._addToPayload,e),Array.from(e)}}_addToPayload(t){U3.dependencies&&sa(t)&&U3.dependencies.add(t);const e=n4(t);e&&_t(e,n=>this.add(n))}},Met=class Uhe extends i4{constructor(e){super(e)}static create(e){return new Uhe(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){const n=this.getPayload();return e.length==n.length?n.map((r,i)=>r.setValue(e[i])).some(Boolean):(super.setValue(e.map(Det)),!0)}};function Det(t){return(t4(t)?N3:r4).create(t)}function SO(t){const e=Hc(t);return e?e.constructor:we.arr(t)?Met:t4(t)?N3:r4}var rY=(t,e)=>{const n=!we.fun(t)||t.prototype&&t.prototype.isReactComponent;return _.forwardRef((r,i)=>{const s=_.useRef(null),o=n&&_.useCallback(y=>{s.current=jet(i,y)},[i]),[a,c]=Uet(r,e),l=Lhe(),d=()=>{const y=s.current;if(n&&!y)return;(y?e.applyAnimatedValues(y,a.getValue(!0)):!1)===!1&&l()},h=new Net(d,c),m=_.useRef(void 0);Eg(()=>(m.current=h,_t(c,y=>h0(y,h)),()=>{m.current&&(_t(m.current.deps,y=>n_(y,m.current)),mt.cancel(m.current.update))})),_.useEffect(d,[]),Ohe(()=>()=>{const y=m.current;_t(y.deps,v=>n_(v,y))});const g=e.getComponentProps(a.getValue());return _.createElement(t,{...g,ref:o})})},Net=class{constructor(t,e){this.update=t,this.deps=e}eventObserved(t){t.type=="change"&&mt.write(this.update)}};function Uet(t,e){const n=new Set;return U3.dependencies=n,t.style&&(t={...t,style:e.createAnimatedStyle(t.style)}),t=new i4(t),U3.dependencies=null,[t,n]}function jet(t,e){return t&&(we.fun(t)?t(e):t.current=e),e}var iY=Symbol.for("AnimatedComponent"),Fet=(t,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:n=i=>new i4(i),getComponentProps:r=i=>i}={})=>{const i={applyAnimatedValues:e,createAnimatedStyle:n,getComponentProps:r},s=o=>{const a=sY(o)||"Anonymous";return we.str(o)?o=s[o]||(s[o]=rY(o,i)):o=o[iY]||(o[iY]=rY(o,i)),o.displayName=`Animated(${a})`,o};return ol(t,(o,a)=>{we.arr(t)&&(a=sY(o)),s[a]=s(o)}),{animated:s}},sY=t=>we.str(t)?t:t&&we.str(t.displayName)?t.displayName:we.fun(t)&&t.name||null;function Fs(t,...e){return we.fun(t)?t(...e):t}var nb=(t,e)=>t===!0||!!(e&&t&&(we.fun(t)?t(e):ps(t).includes(e))),jhe=(t,e)=>we.obj(t)?e&&t[e]:t,Fhe=(t,e)=>t.default===!0?t[e]:t.default?t.default[e]:void 0,$et=t=>t,kD=(t,e=$et)=>{let n=Bet;t.default&&t.default!==!0&&(t=t.default,n=Object.keys(t));const r={};for(const i of n){const s=e(t[i],i);we.und(s)||(r[i]=s)}return r},Bet=["config","onProps","onStart","onChange","onPause","onResume","onRest"],Het={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function Vet(t){const e={};let n=0;if(ol(t,(r,i)=>{Het[i]||(e[i]=r,n++)}),n)return e}function xD(t){const e=Vet(t);if(e){const n={to:e};return ol(t,(r,i)=>i in e||(n[i]=r)),n}return{...t}}function i_(t){return t=js(t),we.arr(t)?t.map(i_):t4(t)?ac.createStringInterpolator({range:[0,1],output:[t,t]})(1):t}function qet(t){for(const e in t)return!0;return!1}function EO(t){return we.fun(t)||we.arr(t)&&we.obj(t[0])}function oY(t,e){t.ref?.delete(t),e?.delete(t)}function Get(t,e){e&&t.ref!==e&&(t.ref?.delete(t),e.add(t),t.ref=e)}var Ket={default:{tension:170,friction:26}},wO={...Ket.default,mass:1,damping:1,easing:yet.linear,clamp:!1},zet=class{constructor(){this.velocity=0,Object.assign(this,wO)}};function Wet(t,e,n){n&&(n={...n},aY(n,e),e={...n,...e}),aY(t,e),Object.assign(t,e);for(const o in wO)t[o]==null&&(t[o]=wO[o]);let{frequency:r,damping:i}=t;const{mass:s}=t;return we.und(r)||(r<.01&&(r=.01),i<0&&(i=0),t.tension=Math.pow(2*Math.PI/r,2)*s,t.friction=4*Math.PI*i*s/r),t}function aY(t,e){if(!we.und(e.decay))t.duration=void 0;else{const n=!we.und(e.tension)||!we.und(e.friction);(n||!we.und(e.frequency)||!we.und(e.damping)||!we.und(e.mass))&&(t.duration=void 0,t.decay=void 0),n&&(t.frequency=void 0)}}var cY=[],Yet=class{constructor(){this.changed=!1,this.values=cY,this.toValues=null,this.fromValues=cY,this.config=new zet,this.immediate=!1}};function $he(t,{key:e,props:n,defaultProps:r,state:i,actions:s}){return new Promise((o,a)=>{let c,l,d=nb(n.cancel??r?.cancel,e);if(d)g();else{we.und(n.pause)||(i.paused=nb(n.pause,e));let y=r?.pause;y!==!0&&(y=i.paused||nb(y,e)),c=Fs(n.delay||0,e),y?(i.resumeQueue.add(m),s.pause()):(s.resume(),m())}function h(){i.resumeQueue.add(m),i.timeouts.delete(l),l.cancel(),c=l.time-mt.now()}function m(){c>0&&!ac.skipAnimation?(i.delayed=!0,l=mt.setTimeout(g,c),i.pauseQueue.add(h),i.timeouts.add(l)):g()}function g(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(h),i.timeouts.delete(l),t<=(i.cancelId||0)&&(d=!0);try{s.start({...n,callId:t,cancel:d},o)}catch(y){a(y)}}})}var AD=(t,e)=>e.length==1?e[0]:e.some(n=>n.cancelled)?Zg(t.get()):e.every(n=>n.noop)?Bhe(t.get()):Ya(t.get(),e.every(n=>n.finished)),Bhe=t=>({value:t,noop:!0,finished:!0,cancelled:!1}),Ya=(t,e,n=!1)=>({value:t,finished:e,cancelled:n}),Zg=t=>({value:t,cancelled:!0,finished:!1});function Hhe(t,e,n,r){const{callId:i,parentId:s,onRest:o}=e,{asyncTo:a,promise:c}=n;return!s&&t===a&&!e.reset?c:n.promise=(async()=>{n.asyncId=i,n.asyncTo=t;const l=kD(e,(w,S)=>S==="onRest"?void 0:w);let d,h;const m=new Promise((w,S)=>(d=w,h=S)),g=w=>{const S=i<=(n.cancelId||0)&&Zg(r)||i!==n.asyncId&&Ya(r,!1);if(S)throw w.result=S,h(w),w},y=(w,S)=>{const R=new lY,x=new uY;return(async()=>{if(ac.skipAnimation)throw s_(n),x.result=Ya(r,!1),h(x),x;g(R);const T=we.obj(w)?{...w}:{...S,to:w};T.parentId=i,ol(l,(k,A)=>{we.und(T[A])&&(T[A]=k)});const I=await r.start(T);return g(R),n.paused&&await new Promise(k=>{n.resumeQueue.add(k)}),I})()};let v;if(ac.skipAnimation)return s_(n),Ya(r,!1);try{let w;we.arr(t)?w=(async S=>{for(const R of S)await y(R)})(t):w=Promise.resolve(t(y,r.stop.bind(r))),await Promise.all([w.then(d),m]),v=Ya(r.get(),!0,!1)}catch(w){if(w instanceof lY)v=w.result;else if(w instanceof uY)v=w.result;else throw w}finally{i==n.asyncId&&(n.asyncId=s,n.asyncTo=s?a:void 0,n.promise=s?c:void 0)}return we.fun(o)&&mt.batchedUpdates(()=>{o(v,r,r.item)}),v})()}function s_(t,e){eb(t.timeouts,n=>n.cancel()),t.pauseQueue.clear(),t.resumeQueue.clear(),t.asyncId=t.asyncTo=t.promise=void 0,e&&(t.cancelId=e)}var lY=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},uY=class extends Error{constructor(){super("SkipAnimationSignal")}},CO=t=>t instanceof PD,Xet=1,PD=class extends Ihe{constructor(){super(...arguments),this.id=Xet++,this._priority=0}get priority(){return this._priority}set priority(t){this._priority!=t&&(this._priority=t,this._onPriorityChange(t))}get(){const t=Hc(this);return t&&t.getValue()}to(...t){return ac.to(this,t)}interpolate(...t){return Iet(),ac.to(this,t)}toJSON(){return this.get()}observerAdded(t){t==1&&this._attach()}observerRemoved(t){t==0&&this._detach()}_attach(){}_detach(){}_onChange(t,e=!1){t_(this,{type:"change",parent:this,value:t,idle:e})}_onPriorityChange(t){this.idle||QR.sort(this),t_(this,{type:"priority",parent:this,priority:t})}},bp=Symbol.for("SpringPhase"),Vhe=1,TO=2,RO=4,s5=t=>(t[bp]&Vhe)>0,Rd=t=>(t[bp]&TO)>0,iy=t=>(t[bp]&RO)>0,dY=(t,e)=>e?t[bp]|=TO|Vhe:t[bp]&=~TO,fY=(t,e)=>e?t[bp]|=RO:t[bp]&=~RO,Jet=class extends PD{constructor(t,e){if(super(),this.animation=new Yet,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!we.und(t)||!we.und(e)){const n=we.obj(t)?{...t}:{...e,from:t};we.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(Rd(this)||this._state.asyncTo)||iy(this)}get goal(){return js(this.animation.to)}get velocity(){const t=Hc(this);return t instanceof r4?t.lastVelocity||0:t.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return s5(this)}get isAnimating(){return Rd(this)}get isPaused(){return iy(this)}get isDelayed(){return this._state.delayed}advance(t){let e=!0,n=!1;const r=this.animation;let{toValues:i}=r;const{config:s}=r,o=n4(r.to);!o&&sa(r.to)&&(i=ps(js(r.to))),r.values.forEach((l,d)=>{if(l.done)return;const h=l.constructor==N3?1:o?o[d].lastPosition:i[d];let m=r.immediate,g=h;if(!m){if(g=l.lastPosition,s.tension<=0){l.done=!0;return}let y=l.elapsedTime+=t;const v=r.fromValues[d],w=l.v0!=null?l.v0:l.v0=we.arr(s.velocity)?s.velocity[d]:s.velocity;let S;const R=s.precision||(v==h?.005:Math.min(1,Math.abs(h-v)*.001));if(we.und(s.duration))if(s.decay){const x=s.decay===!0?.998:s.decay,T=Math.exp(-(1-x)*y);g=v+w/(1-x)*(1-T),m=Math.abs(l.lastPosition-g)<=R,S=w*T}else{S=l.lastVelocity==null?w:l.lastVelocity;const x=s.restVelocity||R/10,T=s.clamp?0:s.bounce,I=!we.und(T),k=v==h?l.v0>0:v<h;let A,O=!1;const D=1,N=Math.ceil(t/D);for(let U=0;U<N&&(A=Math.abs(S)>x,!(!A&&(m=Math.abs(h-g)<=R,m)));++U){I&&(O=g==h||g>h==k,O&&(S=-S*T,g=h));const $=-s.tension*1e-6*(g-h),K=-s.friction*.001*S,Y=($+K)/s.mass;S=S+Y*D,g=g+S*D}}else{let x=1;s.duration>0&&(this._memoizedDuration!==s.duration&&(this._memoizedDuration=s.duration,l.durationProgress>0&&(l.elapsedTime=s.duration*l.durationProgress,y=l.elapsedTime+=t)),x=(s.progress||0)+y/this._memoizedDuration,x=x>1?1:x<0?0:x,l.durationProgress=x),g=v+s.easing(x)*(h-v),S=(g-l.lastPosition)/t,m=x==1}l.lastVelocity=S,Number.isNaN(g)&&(console.warn("Got NaN while animating:",this),m=!0)}o&&!o[d].done&&(m=!1),m?l.done=!0:e=!1,l.setValue(g,s.round)&&(n=!0)});const a=Hc(this),c=a.getValue();if(e){const l=js(r.to);(c!==l||n)&&!s.decay?(a.setValue(l),this._onChange(l)):n&&s.decay&&this._onChange(c),this._stop()}else n&&this._onChange(c)}set(t){return mt.batchedUpdates(()=>{this._stop(),this._focus(t),this._set(t)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(Rd(this)){const{to:t,config:e}=this.animation;mt.batchedUpdates(()=>{this._onStart(),e.decay||this._set(t,!1),this._stop()})}return this}update(t){return(this.queue||(this.queue=[])).push(t),this}start(t,e){let n;return we.und(t)?(n=this.queue||[],this.queue=[]):n=[we.obj(t)?t:{...e,to:t}],Promise.all(n.map(r=>this._update(r))).then(r=>AD(this,r))}stop(t){const{to:e}=this.animation;return this._focus(this.get()),s_(this._state,t&&this._lastCallId),mt.batchedUpdates(()=>this._stop(e,t)),this}reset(){this._update({reset:!0})}eventObserved(t){t.type=="change"?this._start():t.type=="priority"&&(this.priority=t.priority+1)}_prepareNode(t){const e=this.key||"";let{to:n,from:r}=t;n=we.obj(n)?n[e]:n,(n==null||EO(n))&&(n=void 0),r=we.obj(r)?r[e]:r,r==null&&(r=void 0);const i={to:n,from:r};return s5(this)||(t.reverse&&([n,r]=[r,n]),r=js(r),we.und(r)?Hc(this)||this._set(n):this._set(r)),i}_update({...t},e){const{key:n,defaultProps:r}=this;t.default&&Object.assign(r,kD(t,(o,a)=>/^on/.test(a)?jhe(o,n):o)),pY(this,t,"onProps"),oy(this,"onProps",t,this);const i=this._prepareNode(t);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const s=this._state;return $he(++this._lastCallId,{key:n,props:t,defaultProps:r,state:s,actions:{pause:()=>{iy(this)||(fY(this,!0),Sy(s.pauseQueue),oy(this,"onPause",Ya(this,sy(this,this.animation.to)),this))},resume:()=>{iy(this)&&(fY(this,!1),Rd(this)&&this._resume(),Sy(s.resumeQueue),oy(this,"onResume",Ya(this,sy(this,this.animation.to)),this))},start:this._merge.bind(this,i)}}).then(o=>{if(t.loop&&o.finished&&!(e&&o.noop)){const a=qhe(t);if(a)return this._update(a,!0)}return o})}_merge(t,e,n){if(e.cancel)return this.stop(!0),n(Zg(this));const r=!we.und(t.to),i=!we.und(t.from);if(r||i)if(e.callId>this._lastToId)this._lastToId=e.callId;else return n(Zg(this));const{key:s,defaultProps:o,animation:a}=this,{to:c,from:l}=a;let{to:d=c,from:h=l}=t;i&&!r&&(!e.default||we.und(d))&&(d=h),e.reverse&&([d,h]=[h,d]);const m=!Ql(h,l);m&&(a.from=h),h=js(h);const g=!Ql(d,c);g&&this._focus(d);const y=EO(e.to),{config:v}=a,{decay:w,velocity:S}=v;(r||i)&&(v.velocity=0),e.config&&!y&&Wet(v,Fs(e.config,s),e.config!==o.config?Fs(o.config,s):void 0);let R=Hc(this);if(!R||we.und(d))return n(Ya(this,!0));const x=we.und(e.reset)?i&&!e.default:!we.und(h)&&nb(e.reset,s),T=x?h:this.get(),I=i_(d),k=we.num(I)||we.arr(I)||t4(I),A=!y&&(!k||nb(o.immediate||e.immediate,s));if(g){const U=SO(d);if(U!==R.constructor)if(A)R=this._set(I);else throw Error(`Cannot animate between ${R.constructor.name} and ${U.name}, as the "to" prop suggests`)}const O=R.constructor;let D=sa(d),N=!1;if(!D){const U=x||!s5(this)&&m;(g||U)&&(N=Ql(i_(T),I),D=!N),(!Ql(a.immediate,A)&&!A||!Ql(v.decay,w)||!Ql(v.velocity,S))&&(D=!0)}if(N&&Rd(this)&&(a.changed&&!x?D=!0:D||this._stop(c)),!y&&((D||sa(c))&&(a.values=R.getPayload(),a.toValues=sa(d)?null:O==N3?[1]:ps(I)),a.immediate!=A&&(a.immediate=A,!A&&!x&&this._set(c)),D)){const{onRest:U}=a;_t(Qet,K=>pY(this,e,K));const $=Ya(this,sy(this,c));Sy(this._pendingCalls,$),this._pendingCalls.add(n),a.changed&&mt.batchedUpdates(()=>{a.changed=!x,U?.($,this),x?Fs(o.onRest,$):a.onStart?.($,this)})}x&&this._set(T),y?n(Hhe(e.to,e,this._state,this)):D?this._start():Rd(this)&&!g?this._pendingCalls.add(n):n(Bhe(T))}_focus(t){const e=this.animation;t!==e.to&&(tY(this)&&this._detach(),e.to=t,tY(this)&&this._attach())}_attach(){let t=0;const{to:e}=this.animation;sa(e)&&(h0(e,this),CO(e)&&(t=e.priority+1)),this.priority=t}_detach(){const{to:t}=this.animation;sa(t)&&n_(t,this)}_set(t,e=!0){const n=js(t);if(!we.und(n)){const r=Hc(this);if(!r||!Ql(n,r.getValue())){const i=SO(n);!r||r.constructor!=i?ID(this,i.create(n)):r.setValue(n),r&&mt.batchedUpdates(()=>{this._onChange(n,e)})}}return Hc(this)}_onStart(){const t=this.animation;t.changed||(t.changed=!0,oy(this,"onStart",Ya(this,sy(this,t.to)),this))}_onChange(t,e){e||(this._onStart(),Fs(this.animation.onChange,t,this)),Fs(this.defaultProps.onChange,t,this),super._onChange(t,e)}_start(){const t=this.animation;Hc(this).reset(js(t.to)),t.immediate||(t.fromValues=t.values.map(e=>e.lastPosition)),Rd(this)||(dY(this,!0),iy(this)||this._resume())}_resume(){ac.skipAnimation?this.finish():QR.start(this)}_stop(t,e){if(Rd(this)){dY(this,!1);const n=this.animation;_t(n.values,i=>{i.done=!0}),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),t_(this,{type:"idle",parent:this});const r=e?Zg(this.get()):Ya(this.get(),sy(this,t??n.to));Sy(this._pendingCalls,r),n.changed&&(n.changed=!1,oy(this,"onRest",r,this))}}};function sy(t,e){const n=i_(e),r=i_(t.get());return Ql(r,n)}function qhe(t,e=t.loop,n=t.to){const r=Fs(e);if(r){const i=r!==!0&&xD(r),s=(i||t).reverse,o=!i||i.reset;return j3({...t,loop:e,default:!1,pause:void 0,to:!s||EO(n)?n:void 0,from:o?t.from:void 0,reset:o,...i})}}function j3(t){const{to:e,from:n}=t=xD(t),r=new Set;return we.obj(e)&&hY(e,r),we.obj(n)&&hY(n,r),t.keys=r.size?Array.from(r):null,t}function hY(t,e){ol(t,(n,r)=>n!=null&&e.add(r))}var Qet=["onStart","onRest","onChange","onPause","onResume"];function pY(t,e,n){t.animation[n]=e[n]!==Fhe(e,n)?jhe(e[n],t.key):void 0}function oy(t,e,...n){t.animation[e]?.(...n),t.defaultProps[e]?.(...n)}var Zet=["onStart","onChange","onRest"],ett=1,ttt=class{constructor(e,n){this.id=ett++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),n&&(this._flush=n),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each((n,r)=>e[r]=n.get()),e}set(e){for(const n in e){const r=e[n];we.und(r)||this.springs[n].set(r)}}update(e){return e&&this.queue.push(j3(e)),this}start(e){let{queue:n}=this;return e?n=ps(e).map(j3):this.queue=[],this._flush?this._flush(this,n):(Whe(this,n),ntt(this,n))}stop(e,n){if(e!==!!e&&(n=e),n){const r=this.springs;_t(ps(n),i=>r[i].stop(!!e))}else s_(this._state,this._lastAsyncId),this.each(r=>r.stop(!!e));return this}pause(e){if(we.und(e))this.start({pause:!0});else{const n=this.springs;_t(ps(e),r=>n[r].pause())}return this}resume(e){if(we.und(e))this.start({pause:!1});else{const n=this.springs;_t(ps(e),r=>n[r].resume())}return this}each(e){ol(this.springs,e)}_onFrame(){const{onStart:e,onChange:n,onRest:r}=this._events,i=this._active.size>0,s=this._changed.size>0;(i&&!this._started||s&&!this._started)&&(this._started=!0,eb(e,([c,l])=>{l.value=this.get(),c(l,this,this._item)}));const o=!i&&this._started,a=s||o&&r.size?this.get():null;s&&n.size&&eb(n,([c,l])=>{l.value=a,c(l,this,this._item)}),o&&(this._started=!1,eb(r,([c,l])=>{l.value=a,c(l,this,this._item)}))}eventObserved(e){if(e.type=="change")this._changed.add(e.parent),e.idle||this._active.add(e.parent);else if(e.type=="idle")this._active.delete(e.parent);else return;mt.onFrame(this._onFrame)}};function ntt(t,e){return Promise.all(e.map(n=>Ghe(t,n))).then(n=>AD(t,n))}async function Ghe(t,e,n){const{keys:r,to:i,from:s,loop:o,onRest:a,onResolve:c}=e,l=we.obj(e.default)&&e.default;o&&(e.loop=!1),i===!1&&(e.to=null),s===!1&&(e.from=null);const d=we.arr(i)||we.fun(i)?i:void 0;d?(e.to=void 0,e.onRest=void 0,l&&(l.onRest=void 0)):_t(Zet,v=>{const w=e[v];if(we.fun(w)){const S=t._events[v];e[v]=({finished:R,cancelled:x})=>{const T=S.get(w);T?(R||(T.finished=!1),x&&(T.cancelled=!0)):S.set(w,{value:null,finished:R||!1,cancelled:x||!1})},l&&(l[v]=e[v])}});const h=t._state;e.pause===!h.paused?(h.paused=e.pause,Sy(e.pause?h.pauseQueue:h.resumeQueue)):h.paused&&(e.pause=!0);const m=(r||Object.keys(t.springs)).map(v=>t.springs[v].start(e)),g=e.cancel===!0||Fhe(e,"cancel")===!0;(d||g&&h.asyncId)&&m.push($he(++t._lastAsyncId,{props:e,state:h,actions:{pause:bO,resume:bO,start(v,w){g?(s_(h,t._lastAsyncId),w(Zg(t))):(v.onRest=a,w(Hhe(d,v,h,t)))}}})),h.paused&&await new Promise(v=>{h.resumeQueue.add(v)});const y=AD(t,await Promise.all(m));if(o&&y.finished&&!(n&&y.noop)){const v=qhe(e,o,i);if(v)return Whe(t,[v]),Ghe(t,v,!0)}return c&&mt.batchedUpdates(()=>c(y,t,t.item)),y}function rtt(t,e){const n={...t.springs};return e&&_t(ps(e),r=>{we.und(r.keys)&&(r=j3(r)),we.obj(r.to)||(r={...r,to:void 0}),zhe(n,r,i=>Khe(i))}),itt(t,n),n}function itt(t,e){ol(e,(n,r)=>{t.springs[r]||(t.springs[r]=n,h0(n,t))})}function Khe(t,e){const n=new Jet;return n.key=t,e&&h0(n,e),n}function zhe(t,e,n){e.keys&&_t(e.keys,r=>{(t[r]||(t[r]=n(r)))._prepareNode(e)})}function Whe(t,e){_t(e,n=>{zhe(t.springs,n,r=>Khe(r,t))})}var stt=_.createContext({pause:!1,immediate:!1}),ott=()=>{const t=[],e=function(r){xet();const i=[];return _t(t,(s,o)=>{if(we.und(r))i.push(s.start());else{const a=n(r,s,o);a&&i.push(s.start(a))}}),i};e.current=t,e.add=function(r){t.includes(r)||t.push(r)},e.delete=function(r){const i=t.indexOf(r);~i&&t.splice(i,1)},e.pause=function(){return _t(t,r=>r.pause(...arguments)),this},e.resume=function(){return _t(t,r=>r.resume(...arguments)),this},e.set=function(r){_t(t,(i,s)=>{const o=we.fun(r)?r(s,i):r;o&&i.set(o)})},e.start=function(r){const i=[];return _t(t,(s,o)=>{if(we.und(r))i.push(s.start());else{const a=this._getProps(r,s,o);a&&i.push(s.start(a))}}),i},e.stop=function(){return _t(t,r=>r.stop(...arguments)),this},e.update=function(r){return _t(t,(i,s)=>i.update(this._getProps(r,i,s))),this};const n=function(r,i,s){return we.fun(r)?r(s,i):r};return e._getProps=n,e};function att(t,e,n){const r=we.fun(e)&&e,{reset:i,sort:s,trail:o=0,expires:a=!0,exitBeforeEnter:c=!1,onDestroyed:l,ref:d,config:h}=r?r():e,m=_.useMemo(()=>r||arguments.length==3?ott():void 0,[]),g=ps(t),y=[],v=_.useRef(null),w=i?null:v.current;Eg(()=>{v.current=y}),Ohe(()=>(_t(y,Y=>{m?.add(Y.ctrl),Y.ctrl.ref=m}),()=>{_t(v.current,Y=>{Y.expired&&clearTimeout(Y.expirationId),oY(Y.ctrl,m),Y.ctrl.stop(!0)})}));const S=ltt(g,r?r():e,w),R=i&&v.current||[];Eg(()=>_t(R,({ctrl:Y,item:G,key:F})=>{oY(Y,m),Fs(l,G,F)}));const x=[];if(w&&_t(w,(Y,G)=>{Y.expired?(clearTimeout(Y.expirationId),R.push(Y)):(G=x[G]=S.indexOf(Y.key),~G&&(y[G]=Y))}),_t(g,(Y,G)=>{y[G]||(y[G]={key:S[G],item:Y,phase:"mount",ctrl:new ttt},y[G].ctrl.item=Y)}),x.length){let Y=-1;const{leave:G}=r?r():e;_t(x,(F,q)=>{const z=w[q];~F?(Y=y.indexOf(z),y[Y]={...z,item:g[F]}):G&&y.splice(++Y,0,z)})}we.fun(s)&&y.sort((Y,G)=>s(Y.item,G.item));let T=-o;const I=Lhe(),k=kD(e),A=new Map,O=_.useRef(new Map),D=_.useRef(!1);_t(y,(Y,G)=>{const F=Y.key,q=Y.phase,z=r?r():e;let W,V;const X=Fs(z.delay||0,F);if(q=="mount")W=z.enter,V="enter";else{const Ae=S.indexOf(F)<0;if(q!="leave")if(Ae)W=z.leave,V="leave";else if(W=z.update)V="update";else return;else if(!Ae)W=z.enter,V="enter";else return}if(W=Fs(W,Y.item,G),W=we.obj(W)?xD(W):{to:W},!W.config){const Ae=h||k.config;W.config=Fs(Ae,Y.item,G,V)}T+=o;const ne={...k,delay:X+T,ref:d,immediate:z.immediate,reset:!1,...W};if(V=="enter"&&we.und(ne.from)){const Ae=r?r():e,be=we.und(Ae.initial)||w?Ae.from:Ae.initial;ne.from=Fs(be,Y.item,G)}const{onResolve:fe}=ne;ne.onResolve=Ae=>{Fs(fe,Ae);const be=v.current,_e=be.find(Ie=>Ie.key===F);if(_e&&!(Ae.cancelled&&_e.phase!="update")&&_e.ctrl.idle){const Ie=be.every(Ue=>Ue.ctrl.idle);if(_e.phase=="leave"){const Ue=Fs(a,_e.item);if(Ue!==!1){const et=Ue===!0?0:Ue;if(_e.expired=!0,!Ie&&et>0){et<=2147483647&&(_e.expirationId=setTimeout(I,et));return}}}Ie&&be.some(Ue=>Ue.expired)&&(O.current.delete(_e),c&&(D.current=!0),I())}};const ye=rtt(Y.ctrl,ne);V==="leave"&&c?O.current.set(Y,{phase:V,springs:ye,payload:ne}):A.set(Y,{phase:V,springs:ye,payload:ne})});const N=_.useContext(stt),U=Let(N),$=N!==U&&qet(N);Eg(()=>{$&&_t(y,Y=>{Y.ctrl.start({default:N})})},[N]),_t(A,(Y,G)=>{if(O.current.size){const F=y.findIndex(q=>q.key===G.key);y.splice(F,1)}}),Eg(()=>{_t(O.current.size?O.current:A,({phase:Y,payload:G},F)=>{const{ctrl:q}=F;F.phase=Y,m?.add(q),$&&Y=="enter"&&q.start({default:N}),G&&(Get(q,G.ref),(q.ref||m)&&!D.current?q.update(G):(q.start(G),D.current&&(D.current=!1)))})},i?void 0:n);const K=Y=>_.createElement(_.Fragment,null,y.map((G,F)=>{const{springs:q}=A.get(G)||G.ctrl,z=Y({...q},G.item,G,F);return z&&z.type?_.createElement(z.type,{...z.props,key:we.str(G.key)||we.num(G.key)?G.key:G.ctrl.id,ref:z.ref}):z}));return m?[K,m]:K}var ctt=1;function ltt(t,{key:e,keys:n=e},r){if(n===null){const i=new Set;return t.map(s=>{const o=r&&r.find(a=>a.item===s&&a.phase!=="leave"&&!i.has(a));return o?(i.add(o),o.key):ctt++})}return we.und(n)?t:we.fun(n)?t.map(n):ps(n)}var utt=class extends PD{constructor(t,e){super(),this.source=t,this.idle=!0,this._active=new Set,this.calc=Zb(...e);const n=this._get(),r=SO(n);ID(this,r.create(n))}advance(t){const e=this._get(),n=this.get();Ql(e,n)||(Hc(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&mY(this._active)&&o5(this)}_get(){const t=we.arr(this.source)?this.source.map(js):ps(js(this.source));return this.calc(...t)}_start(){this.idle&&!mY(this._active)&&(this.idle=!1,_t(n4(this),t=>{t.done=!1}),ac.skipAnimation?(mt.batchedUpdates(()=>this.advance()),o5(this)):QR.start(this))}_attach(){let t=1;_t(ps(this.source),e=>{sa(e)&&h0(e,this),CO(e)&&(e.idle||this._active.add(e),t=Math.max(t,e.priority+1))}),this.priority=t,this._start()}_detach(){_t(ps(this.source),t=>{sa(t)&&n_(t,this)}),this._active.clear(),o5(this)}eventObserved(t){t.type=="change"?t.idle?this.advance():(this._active.add(t.parent),this._start()):t.type=="idle"?this._active.delete(t.parent):t.type=="priority"&&(this.priority=ps(this.source).reduce((e,n)=>Math.max(e,(CO(n)?n.priority:0)+1),0))}};function dtt(t){return t.idle!==!1}function mY(t){return!t.size||Array.from(t).every(dtt)}function o5(t){t.idle||(t.idle=!0,_t(n4(t),e=>{e.done=!0}),t_(t,{type:"idle",parent:t}))}ac.assign({createStringInterpolator:Ahe,to:(t,e)=>new utt(t,e)});var Yhe=/^--/;function ftt(t,e){return e==null||typeof e=="boolean"||e===""?"":typeof e=="number"&&e!==0&&!Yhe.test(t)&&!(rb.hasOwnProperty(t)&&rb[t])?e+"px":(""+e).trim()}var gY={};function htt(t,e){if(!t.nodeType||!t.setAttribute)return!1;const n=t.nodeName==="filter"||t.parentNode&&t.parentNode.nodeName==="filter",{className:r,style:i,children:s,scrollTop:o,scrollLeft:a,viewBox:c,...l}=e,d=Object.values(l),h=Object.keys(l).map(m=>n||t.hasAttribute(m)?m:gY[m]||(gY[m]=m.replace(/([A-Z])/g,g=>"-"+g.toLowerCase())));s!==void 0&&(t.textContent=s);for(const m in i)if(i.hasOwnProperty(m)){const g=ftt(m,i[m]);Yhe.test(m)?t.style.setProperty(m,g):t.style[m]=g}h.forEach((m,g)=>{t.setAttribute(m,d[g])}),r!==void 0&&(t.className=r),o!==void 0&&(t.scrollTop=o),a!==void 0&&(t.scrollLeft=a),c!==void 0&&t.setAttribute("viewBox",c)}var rb={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ptt=(t,e)=>t+e.charAt(0).toUpperCase()+e.substring(1),mtt=["Webkit","Ms","Moz","O"];rb=Object.keys(rb).reduce((t,e)=>(mtt.forEach(n=>t[ptt(n,e)]=t[e]),t),rb);var gtt=/^(matrix|translate|scale|rotate|skew)/,vtt=/^(translate)/,ytt=/^(rotate|skew)/,a5=(t,e)=>we.num(t)&&t!==0?t+e:t,Xw=(t,e)=>we.arr(t)?t.every(n=>Xw(n,e)):we.num(t)?t===e:parseFloat(t)===e,btt=class extends i4{constructor({x:t,y:e,z:n,...r}){const i=[],s=[];(t||e||n)&&(i.push([t||0,e||0,n||0]),s.push(o=>[`translate3d(${o.map(a=>a5(a,"px")).join(",")})`,Xw(o,0)])),ol(r,(o,a)=>{if(a==="transform")i.push([o||""]),s.push(c=>[c,c===""]);else if(gtt.test(a)){if(delete r[a],we.und(o))return;const c=vtt.test(a)?"px":ytt.test(a)?"deg":"";i.push(ps(o)),s.push(a==="rotate3d"?([l,d,h,m])=>[`rotate3d(${l},${d},${h},${a5(m,c)})`,Xw(m,0)]:l=>[`${a}(${l.map(d=>a5(d,c)).join(",")})`,Xw(l,a.startsWith("scale")?1:0)])}}),i.length&&(r.transform=new _tt(i,s)),super(r)}},_tt=class extends Ihe{constructor(t,e){super(),this.inputs=t,this.transforms=e,this._value=null}get(){return this._value||(this._value=this._get())}_get(){let t="",e=!0;return _t(this.inputs,(n,r)=>{const i=js(n[0]),[s,o]=this.transforms[r](we.arr(i)?i:n.map(js));t+=" "+s,e=e&&o}),e?"none":t}observerAdded(t){t==1&&_t(this.inputs,e=>_t(e,n=>sa(n)&&h0(n,this)))}observerRemoved(t){t==0&&_t(this.inputs,e=>_t(e,n=>sa(n)&&n_(n,this)))}eventObserved(t){t.type=="change"&&(this._value=null),t_(this,t)}},Stt=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"];ac.assign({batchedUpdates:qv.unstable_batchedUpdates,createStringInterpolator:Ahe,colors:set});var Ett=Fet(Stt,{applyAnimatedValues:htt,createAnimatedStyle:t=>new btt(t),getComponentProps:({scrollTop:t,scrollLeft:e,...n})=>n}),Xhe=Ett.animated;const wtt="_media_1yzvo_8",Ctt="_mirror_1yzvo_27",Ttt="_bg_1yzvo_39",Rtt="_avatar_1yzvo_47",Itt="_fg_1yzvo_72",ktt="_nameTag_1yzvo_86",xtt="_status_1yzvo_103",Att="_reactions_1yzvo_122",Ptt="_name_1yzvo_86",Ltt="_errorIcon_1yzvo_141",Fa={media:wtt,mirror:Ctt,bg:Ttt,avatar:Rtt,fg:Itt,nameTag:ktt,status:xtt,reactions:Att,name:Ptt,errorIcon:Ltt},Ott="_reactionIndicatorWidget_14f9a_1",Mtt="_reactionIndicatorWidgetLarge_14f9a_21",Dtt="_reactionLarge_14f9a_28",Ntt="_reaction_14f9a_1",PE={reactionIndicatorWidget:Ott,reactionIndicatorWidgetLarge:Mtt,reactionLarge:Dtt,reaction:Ntt};function Jhe({emoji:t,miniature:e,children:n}){const{t:r}=We();return E.jsxs("div",{className:Oe(PE.reactionIndicatorWidget,{[PE.reactionIndicatorWidgetLarge]:!e}),children:[E.jsx("div",{className:Oe(PE.reaction,{[PE.reactionLarge]:!e}),children:E.jsx("span",{role:"img","aria-label":r("common.reaction"),children:t})}),n]})}function Utt({raisedHandTime:t,miniature:e,showTimer:n,onClick:r,tabIndex:i}){const{t:s}=We(),[o,a]=_.useState(""),c=_.useMemo(()=>new Intl.DurationFormat(void 0,{minutesDisplay:"always",secondsDisplay:"always",hoursDisplay:"auto",style:"digital"}),[]),l=_.useCallback(h=>{r&&(h.preventDefault(),r())},[r]);if(_.useEffect(()=>{if(!t||!n)return;const h=()=>{const g=Math.ceil((new Date().getTime()-t.getTime())/1e3);a(c.format({seconds:g%60,minutes:Math.floor(g/60)}))};h();const m=setInterval(h,1e3);return()=>clearInterval(m)},[a,t,n,c]),!t)return;const d=E.jsx(Jhe,{emoji:"✋",miniature:e,children:n&&E.jsx("p",{children:o})});return r?E.jsx("button",{"aria-label":s("action.lower_hand"),style:{display:"contents",background:"none"},onClick:l,tabIndex:i,children:d}):d}const jtt="_modal_13thw_8",Ftt="_statsPill_13thw_12",vY={modal:jtt,statsPill:Ftt},$tt=({audio:t,video:e,...n})=>{const[r,i]=_.useState(!1),[s,o]=_.useState("none"),a=l=>{i(!0),o(l)},c=()=>{i(!1),o("none")};return E.jsxs("div",{className:Oe(Fa.nameTag,vY.statsPill),children:[E.jsx(Up,{title:"RTC Connection Stats",open:r,onDismiss:c,children:E.jsx("div",{className:vY.modal,children:E.jsx("pre",{children:s!=="none"&&JSON.stringify(s==="video"?e:t,null,2)})})}),t&&E.jsx("div",{children:E.jsx(Bt,{onClick:()=>a("audio"),size:"sm",kind:"tertiary",Icon:t8,children:"jitter"in t&&typeof t.jitter=="number"&&E.jsxs(an,{as:"span",size:"xs",title:"jitter",children:[" ",(t.jitter*1e3).toFixed(0),"ms"]})})}),e&&E.jsx("div",{children:E.jsxs(Bt,{onClick:()=>a("video"),size:"sm",kind:"tertiary",Icon:lae,children:[!!e?.framesPerSecond&&E.jsxs(an,{as:"span",size:"xs",title:"frame rate",children:[" ",e.framesPerSecond.toFixed(0),"fps"]}),"jitter"in e&&typeof e.jitter=="number"&&E.jsxs(an,{as:"span",size:"xs",title:"jitter",children:[" ",(e.jitter*1e3).toFixed(0),"ms"]}),"frameHeight"in e&&typeof e.frameHeight=="number"&&"frameWidth"in e&&typeof e.frameWidth=="number"&&E.jsxs(an,{as:"span",size:"xs",title:"frame size",children:[" ",e.frameWidth,"x",e.frameHeight]}),"qualityLimitationReason"in e&&typeof e.qualityLimitationReason=="string"&&e.qualityLimitationReason!=="none"&&E.jsxs(an,{as:"span",size:"xs",title:"quality limitation reason",children:[" ",e.qualityLimitationReason]})]})})]})},sS=({ref:t,className:e,style:n,targetWidth:r,targetHeight:i,video:s,videoFit:o,mirror:a,member:c,videoEnabled:l,unencryptedWarning:d,nameTagLeadingIcon:h,displayName:m,focusable:g,primaryButton:y,encryptionStatus:v,raisedHandTime:w,currentReaction:S,raisedHandOnClick:R,localParticipant:x,audioStreamStats:T,videoStreamStats:I,...k})=>{const{t:A}=We(),[O]=Gn(Ale),D=Math.round(Math.min(r,i)/2);return E.jsxs(Xhe.div,{className:Oe(Fa.media,e,{[Fa.mirror]:a}),style:n,ref:t,"data-testid":"videoTile","data-video-fit":o,...k,children:[E.jsxs("div",{className:Fa.bg,children:[E.jsx(Op,{id:c?.userId??m,name:m,size:D,src:c?.getMxcAvatarUrl(),className:Fa.avatar,style:{display:s&&l?"none":"initial"}}),s?.publication!==void 0&&E.jsx(BQe,{trackRef:s,tabIndex:-1,disablePictureInPicture:!0,style:{display:s&&l?"block":"none"},"data-testid":"video"})]}),E.jsxs("div",{className:Fa.fg,children:[E.jsxs("div",{className:Fa.reactions,children:[E.jsx(Utt,{raisedHandTime:w,miniature:D<96,showTimer:O,onClick:R,tabIndex:g?void 0:-1}),S&&E.jsx(Jhe,{miniature:D<96,emoji:S.emoji})]}),!s&&!x&&E.jsx("div",{className:Fa.status,children:A("video_tile.waiting_for_media")}),(T||I)&&E.jsx($tt,{audio:T,video:I}),E.jsxs("div",{className:Fa.nameTag,children:[h,E.jsx(an,{as:"span",size:"sm",weight:"medium",className:Fa.name,"data-testid":"name_tag",children:m}),d&&E.jsx(qi,{label:A("common.unencrypted"),placement:"bottom",isTriggerInteractive:!1,nonInteractiveTriggerTabIndex:g?void 0:-1,children:E.jsx(PT,{width:20,height:20,className:Fa.errorIcon,role:"img","aria-label":A("common.unencrypted")})})]}),y]})]})};sS.displayName="MediaView";const oS=(...t)=>_.useCallback(e=>t.forEach(n=>{typeof n=="function"?n(e):n&&(n.current=e)}),t),LD=({ref:t,vm:e,showSpeakingIndicators:n,locallyMuted:r,primaryButton:i,menuStart:s,menuEnd:o,className:a,displayName:c,focusable:l,...d})=>{const{toggleRaisedHand:h}=K8(),{t:m}=We(),g=Qe(e.video$),y=Qe(e.unencryptedWarning$),v=Qe(e.encryptionStatus$),w=ai(e.audioStreamStats$),S=ai(e.videoStreamStats$),R=Qe(e.audioEnabled$),x=Qe(e.videoEnabled$),T=Qe(e.speaking$),I=Qe(e.cropVideo$),k=_.useCallback(q=>{q.preventDefault(),e.toggleFitContain()},[e]),A=Qe(e.handRaised$),O=Qe(e.reaction$),D=r?F8e:R?t8:Hoe,N=m(r?"video_tile.muted_for_me":R?"microphone_on":"microphone_off"),[U,$]=_.useState(!1),K=E.jsxs(E.Fragment,{children:[s,E.jsx(ZM,{Icon:Doe,label:m("video_tile.change_fit_contain"),checked:I,onSelect:k}),o]}),Y=e.local?()=>void h():void 0,G=n&&T,F=E.jsx(sS,{ref:t,video:g,member:e.member,unencryptedWarning:y,encryptionStatus:v,videoEnabled:x,videoFit:I?"cover":"contain",className:Oe(a,_g.tile,{[_g.speaking]:G,[_g.handRaised]:!G&&A}),nameTagLeadingIcon:E.jsx(D,{width:20,height:20,"aria-label":N,"data-muted":r||!R,className:_g.muteIcon}),displayName:c,focusable:l,primaryButton:i??E.jsx(qM,{open:U,onOpenChange:$,title:c,trigger:E.jsx("button",{"aria-label":m("common.options"),tabIndex:l?void 0:-1,children:E.jsx(I8e,{"aria-hidden":!0,width:20,height:20})}),side:"left",align:"start",children:K}),raisedHandTime:A??void 0,currentReaction:O??void 0,raisedHandOnClick:Y,localParticipant:e.local,audioStreamStats:w,videoStreamStats:S,...d});return E.jsx(i7e,{title:c,trigger:F,hasAccessibleAlternative:!0,children:K})};LD.displayName="UserMediaTile";const Qhe=({ref:t,vm:e,onOpenProfile:n,focusable:r,...i})=>{const{t:s}=We(),o=Qe(e.mirror$),a=Qe(e.alwaysShow$),c=Qe(e.switchCamera$),l=Pf(a),d=_.useCallback(h=>{h.preventDefault(),e.setAlwaysShow(!l.current)},[e,l]);return E.jsx(LD,{ref:t,vm:e,locallyMuted:!1,mirror:o,primaryButton:c===null?void 0:E.jsx("button",{className:_g.switchCamera,"aria-label":s("switch_camera"),onClick:c,tabIndex:r?void 0:-1,children:E.jsx(O8e,{"aria-hidden":!0,width:20,height:20})}),menuStart:E.jsx(ZM,{Icon:OMe,label:s("video_tile.always_show"),checked:a,onSelect:d}),menuEnd:n&&E.jsx(yv,{Icon:oae,label:s("common.profile"),onSelect:n}),focusable:r,...i})};Qhe.displayName="LocalUserMediaTile";const Zhe=({ref:t,vm:e,...n})=>{const{t:r}=We(),i=Qe(e.locallyMuted$),s=Qe(e.localVolume$),o=_.useCallback(d=>{d.preventDefault(),e.toggleLocallyMuted()},[e]),a=_.useCallback(d=>e.setLocalVolume(d),[e]),c=_.useCallback(()=>e.commitLocalVolume(),[e]),l=i?$8e:H8e;return E.jsx(LD,{ref:t,vm:e,locallyMuted:i,mirror:!1,menuStart:E.jsxs(E.Fragment,{children:[E.jsx(ZM,{Icon:T8e,label:r("video_tile.mute_for_me"),checked:i,onSelect:o}),E.jsx(yv,{as:"div",Icon:l,label:null,onSelect:null,children:E.jsx(Eue,{className:_g.volumeSlider,label:r("video_tile.volume"),value:s,onValueChange:a,onValueCommit:c,min:0,max:1,step:.01})})]}),...n})};Zhe.displayName="RemoteUserMediaTile";const epe=({ref:t,vm:e,onOpenProfile:n,...r})=>{const i=_.useRef(null),s=oS(i,t),o=Qe(e.media$),a=Qe(o.displayName$);return o instanceof Dv?E.jsx(Qhe,{ref:s,vm:o,onOpenProfile:n,displayName:a,...r}):E.jsx(Zhe,{ref:s,vm:o,displayName:a,...r})};epe.displayName="GridTile";const Btt=({rageshakeRequestId:t,roomId:e,open:n,onDismiss:r})=>{const{t:i}=We(),{submitRageshake:s,sending:o,sent:a,error:c}=hR();return _.useEffect(()=>{a&&r()},[a,r]),E.jsxs(Up,{title:i("rageshake_request_modal.title"),open:n,onDismiss:r,children:[E.jsx(an,{children:i("rageshake_request_modal.body")}),E.jsx(yt,{children:E.jsx(Bt,{onClick:()=>void s({sendLogs:!0,rageshakeRequestId:t,roomId:e}),disabled:o,children:i(o?"rageshake_sending_logs":"rageshake_send_logs")})}),c&&E.jsx(yt,{children:E.jsx(Bf,{error:c})})]})};function yY(t){return new Worker(""+new URL("livekit-client.e2ee.worker-DjoLe7BK.js",import.meta.url).href,{name:t?.name})}const Htt={audioPreset:IC.music,dtx:!0,red:!1,forceStereo:!1,simulcast:!0,videoSimulcastLayers:[Yc.h180,Yc.h360],screenShareEncoding:pT.h1080fps30.encoding,stopMicTrackOnMute:!1,videoCodec:"vp8",videoEncoding:Yc.h720.encoding,backupCodec:{codec:"vp8",encoding:Yc.h720.encoding}},c5={adaptiveStream:!0,dynacast:!0,videoCaptureDefaults:{resolution:Yc.h720.resolution},publishDefaults:Htt,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new LZ,disconnectOnPageLeave:!0,webAudioMix:!1};function Vtt(t){const e=_.useRef(void 0);return gp(t,ei.MembershipsChanged,_.useCallback(()=>{const n=t.getActiveFocus();if(n&&ZJ(n)&&!ff(n,e.current)){const r=t.getOldestMembership();M.info(`Got new active focus from membership: ${r?.sender}/${r?.deviceId}.
          Updated focus (focus switch) from ${JSON.stringify(e.current)} to ${JSON.stringify(n)}`),e.current=n}return e.current},[t]))}function qtt(){const[t,e]=_.useState(null),n=_.useMemo(()=>({showErrorBoundary:r=>e(r)}),[]);if(t)throw t;return n}const dt=t=>typeof t=="string",ay=()=>{let t,e;const n=new Promise((r,i)=>{t=r,e=i});return n.resolve=t,n.reject=e,n},bY=t=>t==null?"":""+t,Gtt=(t,e,n)=>{t.forEach(r=>{e[r]&&(n[r]=e[r])})},Ktt=/###/g,_Y=t=>t&&t.indexOf("###")>-1?t.replace(Ktt,"."):t,SY=t=>!t||dt(t),ib=(t,e,n)=>{const r=dt(e)?e.split("."):e;let i=0;for(;i<r.length-1;){if(SY(t))return{};const s=_Y(r[i]);!t[s]&&n&&(t[s]=new n),Object.prototype.hasOwnProperty.call(t,s)?t=t[s]:t={},++i}return SY(t)?{}:{obj:t,k:_Y(r[i])}},EY=(t,e,n)=>{const{obj:r,k:i}=ib(t,e,Object);if(r!==void 0||e.length===1){r[i]=n;return}let s=e[e.length-1],o=e.slice(0,e.length-1),a=ib(t,o,Object);for(;a.obj===void 0&&o.length;)s=`${o[o.length-1]}.${s}`,o=o.slice(0,o.length-1),a=ib(t,o,Object),a?.obj&&typeof a.obj[`${a.k}.${s}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${s}`]=n},ztt=(t,e,n,r)=>{const{obj:i,k:s}=ib(t,e,Object);i[s]=i[s]||[],i[s].push(n)},F3=(t,e)=>{const{obj:n,k:r}=ib(t,e);if(n&&Object.prototype.hasOwnProperty.call(n,r))return n[r]},Wtt=(t,e,n)=>{const r=F3(t,n);return r!==void 0?r:F3(e,n)},tpe=(t,e,n)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in t?dt(t[r])||t[r]instanceof String||dt(e[r])||e[r]instanceof String?n&&(t[r]=e[r]):tpe(t[r],e[r],n):t[r]=e[r]);return t},zm=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var Ytt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Xtt=t=>dt(t)?t.replace(/[&<>"'\/]/g,e=>Ytt[e]):t;class Jtt{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const n=this.regExpMap.get(e);if(n!==void 0)return n;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const Qtt=[" ",",","?","!",";"],Ztt=new Jtt(20),ent=(t,e,n)=>{e=e||"",n=n||"";const r=Qtt.filter(o=>e.indexOf(o)<0&&n.indexOf(o)<0);if(r.length===0)return!0;const i=Ztt.getRegExp(`(${r.map(o=>o==="?"?"\\?":o).join("|")})`);let s=!i.test(t);if(!s){const o=t.indexOf(n);o>0&&!i.test(t.substring(0,o))&&(s=!0)}return s},IO=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!t)return;if(t[e])return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0;const r=e.split(n);let i=t;for(let s=0;s<r.length;){if(!i||typeof i!="object")return;let o,a="";for(let c=s;c<r.length;++c)if(c!==s&&(a+=n),a+=r[c],o=i[a],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&c<r.length-1)continue;s+=c-s+1;break}i=o}return i},$3=t=>t?.replace("_","-"),tnt={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console?.[t]?.apply?.(console,e)}};class B3{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,n)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=n.prefix||"i18next:",this.logger=e||tnt,this.options=n,this.debug=n.debug}log(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.forward(n,"log","",!0)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.forward(n,"warn","",!0)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.forward(n,"error","")}deprecate(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.forward(n,"warn","WARNING DEPRECATED: ",!0)}forward(e,n,r,i){return i&&!this.debug?null:(dt(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[n](e))}create(e){return new B3(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new B3(this.logger,e)}}var Jc=new B3;class s4{constructor(){this.observers={}}on(e,n){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const i=this.observers[r].get(n)||0;this.observers[r].set(n,i+1)}),this}off(e,n){if(this.observers[e]){if(!n){delete this.observers[e];return}this.observers[e].delete(n)}}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(o=>{let[a,c]=o;for(let l=0;l<c;l++)a(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(o=>{let[a,c]=o;for(let l=0;l<c;l++)a.apply(a,[e,...r])})}}class wY extends s4{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const n=this.options.ns.indexOf(e);n>-1&&this.options.ns.splice(n,1)}getResource(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,o=i.ignoreJSONStructure!==void 0?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let a;e.indexOf(".")>-1?a=e.split("."):(a=[e,n],r&&(Array.isArray(r)?a.push(...r):dt(r)&&s?a.push(...r.split(s)):a.push(r)));const c=F3(this.data,a);return!c&&!n&&!r&&e.indexOf(".")>-1&&(e=a[0],n=a[1],r=a.slice(2).join(".")),c||!o||!dt(r)?c:IO(this.data?.[e]?.[n],r,s)}addResource(e,n,r,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let a=[e,n];r&&(a=a.concat(o?r.split(o):r)),e.indexOf(".")>-1&&(a=e.split("."),i=n,n=a[1]),this.addNamespaces(n),EY(this.data,a,i),s.silent||this.emit("added",e,n,r,i)}addResources(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const s in r)(dt(r[s])||Array.isArray(r[s]))&&this.addResource(e,n,s,r[s],{silent:!0});i.silent||this.emit("added",e,n,r)}addResourceBundle(e,n,r,i,s){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},a=[e,n];e.indexOf(".")>-1&&(a=e.split("."),i=r,r=n,n=a[1]),this.addNamespaces(n);let c=F3(this.data,a)||{};o.skipCopy||(r=JSON.parse(JSON.stringify(r))),i?tpe(c,r,s):c={...c,...r},EY(this.data,a,c),o.silent||this.emit("added",e,n,r)}removeResourceBundle(e,n){this.hasResourceBundle(e,n)&&delete this.data[e][n],this.removeNamespaces(n),this.emit("removed",e,n)}hasResourceBundle(e,n){return this.getResource(e,n)!==void 0}getResourceBundle(e,n){return n||(n=this.options.defaultNS),this.getResource(e,n)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const n=this.getDataByLanguage(e);return!!(n&&Object.keys(n)||[]).find(i=>n[i]&&Object.keys(n[i]).length>0)}toJSON(){return this.data}}var npe={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,n,r,i){return t.forEach(s=>{e=this.processors[s]?.process(e,n,r,i)??e}),e}};const CY={},TY=t=>!dt(t)&&typeof t!="boolean"&&typeof t!="number";class H3 extends s4{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Gtt(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Jc.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};return e==null?!1:this.resolve(e,n)?.res!==void 0}extractFromKey(e,n){let r=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const i=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let s=n.ns||this.options.defaultNS||[];const o=r&&e.indexOf(r)>-1,a=!this.options.userDefinedKeySeparator&&!n.keySeparator&&!this.options.userDefinedNsSeparator&&!n.nsSeparator&&!ent(e,r,i);if(o&&!a){const c=e.match(this.interpolator.nestingRegexp);if(c&&c.length>0)return{key:e,namespaces:dt(s)?[s]:s};const l=e.split(r);(r!==i||r===i&&this.options.ns.indexOf(l[0])>-1)&&(s=l.shift()),e=l.join(i)}return{key:e,namespaces:dt(s)?[s]:s}}translate(e,n,r){if(typeof n!="object"&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),typeof n=="object"&&(n={...n}),n||(n={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const i=n.returnDetails!==void 0?n.returnDetails:this.options.returnDetails,s=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,{key:o,namespaces:a}=this.extractFromKey(e[e.length-1],n),c=a[a.length-1],l=n.lng||this.language,d=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(l?.toLowerCase()==="cimode"){if(d){const U=n.nsSeparator||this.options.nsSeparator;return i?{res:`${c}${U}${o}`,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:c,usedParams:this.getUsedParamsDetails(n)}:`${c}${U}${o}`}return i?{res:o,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:c,usedParams:this.getUsedParamsDetails(n)}:o}const h=this.resolve(e,n);let m=h?.res;const g=h?.usedKey||o,y=h?.exactUsedKey||o,v=["[object Number]","[object Function]","[object RegExp]"],w=n.joinArrays!==void 0?n.joinArrays:this.options.joinArrays,S=!this.i18nFormat||this.i18nFormat.handleAsObject,R=n.count!==void 0&&!dt(n.count),x=H3.hasDefaultValue(n),T=R?this.pluralResolver.getSuffix(l,n.count,n):"",I=n.ordinal&&R?this.pluralResolver.getSuffix(l,n.count,{ordinal:!1}):"",k=R&&!n.ordinal&&n.count===0,A=k&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${T}`]||n[`defaultValue${I}`]||n.defaultValue;let O=m;S&&!m&&x&&(O=A);const D=TY(O),N=Object.prototype.toString.apply(O);if(S&&O&&D&&v.indexOf(N)<0&&!(dt(w)&&Array.isArray(O))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const U=this.options.returnedObjectHandler?this.options.returnedObjectHandler(g,O,{...n,ns:a}):`key '${o} (${this.language})' returned an object instead of string.`;return i?(h.res=U,h.usedParams=this.getUsedParamsDetails(n),h):U}if(s){const U=Array.isArray(O),$=U?[]:{},K=U?y:g;for(const Y in O)if(Object.prototype.hasOwnProperty.call(O,Y)){const G=`${K}${s}${Y}`;x&&!m?$[Y]=this.translate(G,{...n,defaultValue:TY(A)?A[Y]:void 0,joinArrays:!1,ns:a}):$[Y]=this.translate(G,{...n,joinArrays:!1,ns:a}),$[Y]===G&&($[Y]=O[Y])}m=$}}else if(S&&dt(w)&&Array.isArray(m))m=m.join(w),m&&(m=this.extendTranslation(m,e,n,r));else{let U=!1,$=!1;!this.isValidLookup(m)&&x&&(U=!0,m=A),this.isValidLookup(m)||($=!0,m=o);const Y=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&$?void 0:m,G=x&&A!==m&&this.options.updateMissing;if($||U||G){if(this.logger.log(G?"updateKey":"missingKey",l,c,o,G?A:m),s){const W=this.resolve(o,{...n,keySeparator:!1});W&&W.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let F=[];const q=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if(this.options.saveMissingTo==="fallback"&&q&&q[0])for(let W=0;W<q.length;W++)F.push(q[W]);else this.options.saveMissingTo==="all"?F=this.languageUtils.toResolveHierarchy(n.lng||this.language):F.push(n.lng||this.language);const z=(W,V,X)=>{const ne=x&&X!==m?X:Y;this.options.missingKeyHandler?this.options.missingKeyHandler(W,c,V,ne,G,n):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(W,c,V,ne,G,n),this.emit("missingKey",W,c,V,m)};this.options.saveMissing&&(this.options.saveMissingPlurals&&R?F.forEach(W=>{const V=this.pluralResolver.getSuffixes(W,n);k&&n[`defaultValue${this.options.pluralSeparator}zero`]&&V.indexOf(`${this.options.pluralSeparator}zero`)<0&&V.push(`${this.options.pluralSeparator}zero`),V.forEach(X=>{z([W],o+X,n[`defaultValue${X}`]||A)})}):z(F,o,A))}m=this.extendTranslation(m,e,n,h,r),$&&m===o&&this.options.appendNamespaceToMissingKey&&(m=`${c}:${o}`),($||U)&&this.options.parseMissingKeyHandler&&(m=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${c}:${o}`:o,U?m:void 0))}return i?(h.res=m,h.usedParams=this.getUsedParamsDetails(n),h):m}extendTranslation(e,n,r,i,s){var o=this;if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const l=dt(e)&&(r?.interpolation?.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let d;if(l){const m=e.match(this.interpolator.nestingRegexp);d=m&&m.length}let h=r.replace&&!dt(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(h={...this.options.interpolation.defaultVariables,...h}),e=this.interpolator.interpolate(e,h,r.lng||this.language||i.usedLng,r),l){const m=e.match(this.interpolator.nestingRegexp),g=m&&m.length;d<g&&(r.nest=!1)}!r.lng&&i&&i.res&&(r.lng=this.language||i.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var m=arguments.length,g=new Array(m),y=0;y<m;y++)g[y]=arguments[y];return s?.[0]===g[0]&&!r.context?(o.logger.warn(`It seems you are nesting recursively key: ${g[0]} in key: ${n[0]}`),null):o.translate(...g,n)},r)),r.interpolation&&this.interpolator.reset()}const a=r.postProcess||this.options.postProcess,c=dt(a)?[a]:a;return e!=null&&c?.length&&r.applyPostProcessor!==!1&&(e=npe.handle(c,e,n,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r,i,s,o,a;return dt(e)&&(e=[e]),e.forEach(c=>{if(this.isValidLookup(r))return;const l=this.extractFromKey(c,n),d=l.key;i=d;let h=l.namespaces;this.options.fallbackNS&&(h=h.concat(this.options.fallbackNS));const m=n.count!==void 0&&!dt(n.count),g=m&&!n.ordinal&&n.count===0,y=n.context!==void 0&&(dt(n.context)||typeof n.context=="number")&&n.context!=="",v=n.lngs?n.lngs:this.languageUtils.toResolveHierarchy(n.lng||this.language,n.fallbackLng);h.forEach(w=>{this.isValidLookup(r)||(a=w,!CY[`${v[0]}-${w}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(a)&&(CY[`${v[0]}-${w}`]=!0,this.logger.warn(`key "${i}" for languages "${v.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),v.forEach(S=>{if(this.isValidLookup(r))return;o=S;const R=[d];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(R,d,S,w,n);else{let T;m&&(T=this.pluralResolver.getSuffix(S,n.count,n));const I=`${this.options.pluralSeparator}zero`,k=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(m&&(R.push(d+T),n.ordinal&&T.indexOf(k)===0&&R.push(d+T.replace(k,this.options.pluralSeparator)),g&&R.push(d+I)),y){const A=`${d}${this.options.contextSeparator}${n.context}`;R.push(A),m&&(R.push(A+T),n.ordinal&&T.indexOf(k)===0&&R.push(A+T.replace(k,this.options.pluralSeparator)),g&&R.push(A+I))}}let x;for(;x=R.pop();)this.isValidLookup(r)||(s=x,r=this.getResource(S,w,x,n))}))})}),{res:r,usedKey:i,exactUsedKey:s,usedLng:o,usedNS:a}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,n,r,i):this.resourceStore.getResource(e,n,r,i)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!dt(e.replace);let i=r?e.replace:e;if(r&&typeof e.count<"u"&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!r){i={...i};for(const s of n)delete i[s]}return i}static hasDefaultValue(e){const n="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&n===r.substring(0,n.length)&&e[r]!==void 0)return!0;return!1}}class RY{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Jc.create("languageUtils")}getScriptPartFromCode(e){if(e=$3(e),!e||e.indexOf("-")<0)return null;const n=e.split("-");return n.length===2||(n.pop(),n[n.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(n.join("-"))}getLanguagePartFromCode(e){if(e=$3(e),!e||e.indexOf("-")<0)return e;const n=e.split("-");return this.formatLanguageCode(n[0])}formatLanguageCode(e){if(dt(e)&&e.indexOf("-")>-1){let n;try{n=Intl.getCanonicalLocales(e)[0]}catch{}return n&&this.options.lowerCaseLng&&(n=n.toLowerCase()),n||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let n;return e.forEach(r=>{if(n)return;const i=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(i))&&(n=i)}),!n&&this.options.supportedLngs&&e.forEach(r=>{if(n)return;const i=this.getLanguagePartFromCode(r);if(this.isSupportedCode(i))return n=i;n=this.options.supportedLngs.find(s=>{if(s===i)return s;if(!(s.indexOf("-")<0&&i.indexOf("-")<0)&&(s.indexOf("-")>0&&i.indexOf("-")<0&&s.substring(0,s.indexOf("-"))===i||s.indexOf(i)===0&&i.length>1))return s})}),n||(n=this.getFallbackCodes(this.options.fallbackLng)[0]),n}getFallbackCodes(e,n){if(!e)return[];if(typeof e=="function"&&(e=e(n)),dt(e)&&(e=[e]),Array.isArray(e))return e;if(!n)return e.default||[];let r=e[n];return r||(r=e[this.getScriptPartFromCode(n)]),r||(r=e[this.formatLanguageCode(n)]),r||(r=e[this.getLanguagePartFromCode(n)]),r||(r=e.default),r||[]}toResolveHierarchy(e,n){const r=this.getFallbackCodes(n||this.options.fallbackLng||[],e),i=[],s=o=>{o&&(this.isSupportedCode(o)?i.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return dt(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&s(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&s(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&s(this.getLanguagePartFromCode(e))):dt(e)&&s(this.formatLanguageCode(e)),r.forEach(o=>{i.indexOf(o)<0&&s(this.formatLanguageCode(o))}),i}}const IY={zero:0,one:1,two:2,few:3,many:4,other:5},kY={select:t=>t===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class nnt{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=n,this.logger=Jc.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,n){this.rules[e]=n}clearCache(){this.pluralRulesCache={}}getRule(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=$3(e==="dev"?"en":e),i=n.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:r,type:i});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let o;try{o=new Intl.PluralRules(r,{type:i})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),kY;if(!e.match(/-|_/))return kY;const c=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(c,n)}return this.pluralRulesCache[s]=o,o}needsPlural(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.getRule(e,n);return r||(r=this.getRule("dev",n)),r?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,r).map(i=>`${n}${i}`)}getSuffixes(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.getRule(e,n);return r||(r=this.getRule("dev",n)),r?r.resolvedOptions().pluralCategories.sort((i,s)=>IY[i]-IY[s]).map(i=>`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${i}`):[]}getSuffix(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=this.getRule(e,r);return i?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${i.select(n)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",n,r))}}const xY=function(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=Wtt(t,e,n);return!s&&i&&dt(n)&&(s=IO(t,n,r),s===void 0&&(s=IO(e,n,r))),s},l5=t=>t.replace(/\$/g,"$$$$");class rnt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Jc.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(n=>n),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:n,escapeValue:r,useRawValueToEscape:i,prefix:s,prefixEscaped:o,suffix:a,suffixEscaped:c,formatSeparator:l,unescapeSuffix:d,unescapePrefix:h,nestingPrefix:m,nestingPrefixEscaped:g,nestingSuffix:y,nestingSuffixEscaped:v,nestingOptionsSeparator:w,maxReplaces:S,alwaysFormat:R}=e.interpolation;this.escape=n!==void 0?n:Xtt,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=i!==void 0?i:!1,this.prefix=s?zm(s):o||"{{",this.suffix=a?zm(a):c||"}}",this.formatSeparator=l||",",this.unescapePrefix=d?"":h||"-",this.unescapeSuffix=this.unescapePrefix?"":d||"",this.nestingPrefix=m?zm(m):g||zm("$t("),this.nestingSuffix=y?zm(y):v||zm(")"),this.nestingOptionsSeparator=w||",",this.maxReplaces=S||1e3,this.alwaysFormat=R!==void 0?R:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(n,r)=>n?.source===r?(n.lastIndex=0,n):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,n,r,i){let s,o,a;const c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=g=>{if(g.indexOf(this.formatSeparator)<0){const S=xY(n,c,g,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(S,void 0,r,{...i,...n,interpolationkey:g}):S}const y=g.split(this.formatSeparator),v=y.shift().trim(),w=y.join(this.formatSeparator).trim();return this.format(xY(n,c,v,this.options.keySeparator,this.options.ignoreJSONStructure),w,r,{...i,...n,interpolationkey:v})};this.resetRegExp();const d=i?.missingInterpolationHandler||this.options.missingInterpolationHandler,h=i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:g=>l5(g)},{regex:this.regexp,safeValue:g=>this.escapeValue?l5(this.escape(g)):l5(g)}].forEach(g=>{for(a=0;s=g.regex.exec(e);){const y=s[1].trim();if(o=l(y),o===void 0)if(typeof d=="function"){const w=d(e,s,i);o=dt(w)?w:""}else if(i&&Object.prototype.hasOwnProperty.call(i,y))o="";else if(h){o=s[0];continue}else this.logger.warn(`missed to pass in variable ${y} for interpolating ${e}`),o="";else!dt(o)&&!this.useRawValueToEscape&&(o=bY(o));const v=g.safeValue(o);if(e=e.replace(s[0],v),h?(g.regex.lastIndex+=o.length,g.regex.lastIndex-=s[0].length):g.regex.lastIndex=0,a++,a>=this.maxReplaces)break}}),e}nest(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i,s,o;const a=(c,l)=>{const d=this.nestingOptionsSeparator;if(c.indexOf(d)<0)return c;const h=c.split(new RegExp(`${d}[ ]*{`));let m=`{${h[1]}`;c=h[0],m=this.interpolate(m,o);const g=m.match(/'/g),y=m.match(/"/g);((g?.length??0)%2===0&&!y||y.length%2!==0)&&(m=m.replace(/'/g,'"'));try{o=JSON.parse(m),l&&(o={...l,...o})}catch(v){return this.logger.warn(`failed parsing options string in nesting for key ${c}`,v),`${c}${d}${m}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,c};for(;i=this.nestingRegexp.exec(e);){let c=[];o={...r},o=o.replace&&!dt(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;let l=!1;if(i[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(i[1])){const d=i[1].split(this.formatSeparator).map(h=>h.trim());i[1]=d.shift(),c=d,l=!0}if(s=n(a.call(this,i[1].trim(),o),o),s&&i[0]===e&&!dt(s))return s;dt(s)||(s=bY(s)),s||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),s=""),l&&(s=c.reduce((d,h)=>this.format(d,h,r.lng,{...r,interpolationkey:i[1].trim()}),s.trim())),e=e.replace(i[0],s),this.regexp.lastIndex=0}return e}}const int=t=>{let e=t.toLowerCase().trim();const n={};if(t.indexOf("(")>-1){const r=t.split("(");e=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);e==="currency"&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):e==="relativetime"&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach(o=>{if(o){const[a,...c]=o.split(":"),l=c.join(":").trim().replace(/^'+|'+$/g,""),d=a.trim();n[d]||(n[d]=l),l==="false"&&(n[d]=!1),l==="true"&&(n[d]=!0),isNaN(l)||(n[d]=parseInt(l,10))}})}return{formatName:e,formatOptions:n}},Wm=t=>{const e={};return(n,r,i)=>{let s=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(s={...s,[i.interpolationkey]:void 0});const o=r+JSON.stringify(s);let a=e[o];return a||(a=t($3(r),i),e[o]=a),a(n)}};class snt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Jc.create("formatter"),this.options=e,this.formats={number:Wm((n,r)=>{const i=new Intl.NumberFormat(n,{...r});return s=>i.format(s)}),currency:Wm((n,r)=>{const i=new Intl.NumberFormat(n,{...r,style:"currency"});return s=>i.format(s)}),datetime:Wm((n,r)=>{const i=new Intl.DateTimeFormat(n,{...r});return s=>i.format(s)}),relativetime:Wm((n,r)=>{const i=new Intl.RelativeTimeFormat(n,{...r});return s=>i.format(s,r.range||"day")}),list:Wm((n,r)=>{const i=new Intl.ListFormat(n,{...r});return s=>i.format(s)})},this.init(e)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=n.interpolation.formatSeparator||","}add(e,n){this.formats[e.toLowerCase().trim()]=n}addCached(e,n){this.formats[e.toLowerCase().trim()]=Wm(n)}format(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=n.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(a=>a.indexOf(")")>-1)){const a=s.findIndex(c=>c.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,a)].join(this.formatSeparator)}return s.reduce((a,c)=>{const{formatName:l,formatOptions:d}=int(c);if(this.formats[l]){let h=a;try{const m=i?.formatParams?.[i.interpolationkey]||{},g=m.locale||m.lng||i.locale||i.lng||r;h=this.formats[l](a,g,{...d,...i,...m})}catch(m){this.logger.warn(m)}return h}else this.logger.warn(`there was no format function for ${l}`);return a},e)}}const ont=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class ant extends s4{constructor(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=n,this.services=r,this.languageUtils=r.languageUtils,this.options=i,this.logger=Jc.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(r,i.backend,i)}queueLoad(e,n,r,i){const s={},o={},a={},c={};return e.forEach(l=>{let d=!0;n.forEach(h=>{const m=`${l}|${h}`;!r.reload&&this.store.hasResourceBundle(l,h)?this.state[m]=2:this.state[m]<0||(this.state[m]===1?o[m]===void 0&&(o[m]=!0):(this.state[m]=1,d=!1,o[m]===void 0&&(o[m]=!0),s[m]===void 0&&(s[m]=!0),c[h]===void 0&&(c[h]=!0)))}),d||(a[l]=!0)}),(Object.keys(s).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(s),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(c)}}loaded(e,n,r){const i=e.split("|"),s=i[0],o=i[1];n&&this.emit("failedLoading",s,o,n),!n&&r&&this.store.addResourceBundle(s,o,r,void 0,void 0,{skipCopy:!0}),this.state[e]=n?-1:2,n&&r&&(this.state[e]=0);const a={};this.queue.forEach(c=>{ztt(c.loaded,[s],o),ont(c,e),n&&c.errors.push(n),c.pendingCount===0&&!c.done&&(Object.keys(c.loaded).forEach(l=>{a[l]||(a[l]={});const d=c.loaded[l];d.length&&d.forEach(h=>{a[l][h]===void 0&&(a[l][h]=!0)})}),c.done=!0,c.errors.length?c.callback(c.errors):c.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(c=>!c.done)}read(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:n,fcName:r,tried:i,wait:s,callback:o});return}this.readingCalls++;const a=(l,d)=>{if(this.readingCalls--,this.waitingReads.length>0){const h=this.waitingReads.shift();this.read(h.lng,h.ns,h.fcName,h.tried,h.wait,h.callback)}if(l&&d&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,e,n,r,i+1,s*2,o)},s);return}o(l,d)},c=this.backend[r].bind(this.backend);if(c.length===2){try{const l=c(e,n);l&&typeof l.then=="function"?l.then(d=>a(null,d)).catch(a):a(null,l)}catch(l){a(l)}return}return c(e,n,a)}prepareLoading(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();dt(e)&&(e=this.languageUtils.toResolveHierarchy(e)),dt(n)&&(n=[n]);const s=this.queueLoad(e,n,r,i);if(!s.toLoad.length)return s.pending.length||i(),null;s.toLoad.forEach(o=>{this.loadOne(o)})}load(e,n,r){this.prepareLoading(e,n,{},r)}reload(e,n,r){this.prepareLoading(e,n,{reload:!0},r)}loadOne(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=e.split("|"),i=r[0],s=r[1];this.read(i,s,"read",void 0,void 0,(o,a)=>{o&&this.logger.warn(`${n}loading namespace ${s} for language ${i} failed`,o),!o&&a&&this.logger.log(`${n}loaded namespace ${s} for language ${i}`,a),this.loaded(e,o,a)})}saveMissing(e,n,r,i,s){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(n)){this.logger.warn(`did not save key "${r}" as the namespace "${n}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if(this.backend?.create){const c={...o,isUpdate:s},l=this.backend.create.bind(this.backend);if(l.length<6)try{let d;l.length===5?d=l(e,n,r,i,c):d=l(e,n,r,i),d&&typeof d.then=="function"?d.then(h=>a(null,h)).catch(a):a(null,d)}catch(d){a(d)}else l(e,n,r,i,a,c)}!e||!e[0]||this.store.addResource(e[0],n,r,i)}}}const AY=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),dt(t[1])&&(e.defaultValue=t[1]),dt(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const n=t[3]||t[2];Object.keys(n).forEach(r=>{e[r]=n[r]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),PY=t=>(dt(t.ns)&&(t.ns=[t.ns]),dt(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),dt(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs?.indexOf?.("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),typeof t.initImmediate=="boolean"&&(t.initAsync=t.initImmediate),t),LE=()=>{},cnt=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(n=>{typeof t[n]=="function"&&(t[n]=t[n].bind(t))})};class o_ extends s4{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(super(),this.options=PY(e),this.services={},this.logger=Jc,this.modules={external:[]},cnt(this),n&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,n),this;setTimeout(()=>{this.init(e,n)},0)}}init(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof n=="function"&&(r=n,n={}),n.defaultNS==null&&n.ns&&(dt(n.ns)?n.defaultNS=n.ns:n.ns.indexOf("translation")<0&&(n.defaultNS=n.ns[0]));const i=AY();this.options={...i,...this.options,...PY(n)},this.options.interpolation={...i.interpolation,...this.options.interpolation},n.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=n.keySeparator),n.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=n.nsSeparator);const s=d=>d?typeof d=="function"?new d:d:null;if(!this.options.isClone){this.modules.logger?Jc.init(s(this.modules.logger),this.options):Jc.init(null,this.options);let d;this.modules.formatter?d=this.modules.formatter:d=snt;const h=new RY(this.options);this.store=new wY(this.options.resources,this.options);const m=this.services;m.logger=Jc,m.resourceStore=this.store,m.languageUtils=h,m.pluralResolver=new nnt(h,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),d&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(m.formatter=s(d),m.formatter.init(m,this.options),this.options.interpolation.format=m.formatter.format.bind(m.formatter)),m.interpolator=new rnt(this.options),m.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},m.backendConnector=new ant(s(this.modules.backend),m.resourceStore,m,this.options),m.backendConnector.on("*",function(g){for(var y=arguments.length,v=new Array(y>1?y-1:0),w=1;w<y;w++)v[w-1]=arguments[w];e.emit(g,...v)}),this.modules.languageDetector&&(m.languageDetector=s(this.modules.languageDetector),m.languageDetector.init&&m.languageDetector.init(m,this.options.detection,this.options)),this.modules.i18nFormat&&(m.i18nFormat=s(this.modules.i18nFormat),m.i18nFormat.init&&m.i18nFormat.init(this)),this.translator=new H3(this.services,this.options),this.translator.on("*",function(g){for(var y=arguments.length,v=new Array(y>1?y-1:0),w=1;w<y;w++)v[w-1]=arguments[w];e.emit(g,...v)}),this.modules.external.forEach(g=>{g.init&&g.init(this)})}if(this.format=this.options.interpolation.format,r||(r=LE),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const d=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);d.length>0&&d[0]!=="dev"&&(this.options.lng=d[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(d=>{this[d]=function(){return e.store[d](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(d=>{this[d]=function(){return e.store[d](...arguments),e}});const c=ay(),l=()=>{const d=(h,m)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),c.resolve(m),r(h,m)};if(this.languages&&!this.isInitialized)return d(null,this.t.bind(this));this.changeLanguage(this.options.lng,d)};return this.options.resources||!this.options.initAsync?l():setTimeout(l,0),c}loadResources(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:LE;const i=dt(e)?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if(i?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const s=[],o=a=>{if(!a||a==="cimode")return;this.services.languageUtils.toResolveHierarchy(a).forEach(l=>{l!=="cimode"&&s.indexOf(l)<0&&s.push(l)})};i?o(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(c=>o(c)),this.options.preload?.forEach?.(a=>o(a)),this.services.backendConnector.load(s,this.options.ns,a=>{!a&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(a)})}else r(null)}reloadResources(e,n,r){const i=ay();return typeof e=="function"&&(r=e,e=void 0),typeof n=="function"&&(r=n,n=void 0),e||(e=this.languages),n||(n=this.options.ns),r||(r=LE),this.services.backendConnector.reload(e,n,s=>{i.resolve(),r(s)}),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&npe.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let n=0;n<this.languages.length;n++){const r=this.languages[n];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}}changeLanguage(e,n){var r=this;this.isLanguageChangingTo=e;const i=ay();this.emit("languageChanging",e);const s=c=>{this.language=c,this.languages=this.services.languageUtils.toResolveHierarchy(c),this.resolvedLanguage=void 0,this.setResolvedLanguage(c)},o=(c,l)=>{l?(s(l),this.translator.changeLanguage(l),this.isLanguageChangingTo=void 0,this.emit("languageChanged",l),this.logger.log("languageChanged",l)):this.isLanguageChangingTo=void 0,i.resolve(function(){return r.t(...arguments)}),n&&n(c,function(){return r.t(...arguments)})},a=c=>{!e&&!c&&this.services.languageDetector&&(c=[]);const l=dt(c)?c:this.services.languageUtils.getBestMatchFromCodes(c);l&&(this.language||s(l),this.translator.language||this.translator.changeLanguage(l),this.services.languageDetector?.cacheUserLanguage?.(l)),this.loadResources(l,d=>{o(d,l)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?a(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e),i}getFixedT(e,n,r){var i=this;const s=function(o,a){let c;if(typeof a!="object"){for(var l=arguments.length,d=new Array(l>2?l-2:0),h=2;h<l;h++)d[h-2]=arguments[h];c=i.options.overloadTranslationOptionHandler([o,a].concat(d))}else c={...a};c.lng=c.lng||s.lng,c.lngs=c.lngs||s.lngs,c.ns=c.ns||s.ns,c.keyPrefix!==""&&(c.keyPrefix=c.keyPrefix||r||s.keyPrefix);const m=i.options.keySeparator||".";let g;return c.keyPrefix&&Array.isArray(o)?g=o.map(y=>`${c.keyPrefix}${m}${y}`):g=c.keyPrefix?`${c.keyPrefix}${m}${o}`:o,i.t(g,c)};return dt(e)?s.lng=e:s.lngs=e,s.ns=n,s.keyPrefix=r,s}t(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.translator?.translate(...n)}exists(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.translator?.exists(...n)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=n.lng||this.resolvedLanguage||this.languages[0],i=this.options?this.options.fallbackLng:!1,s=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const o=(a,c)=>{const l=this.services.backendConnector.state[`${a}|${c}`];return l===-1||l===0||l===2};if(n.precheck){const a=n.precheck(this,o);if(a!==void 0)return a}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(r,e)&&(!i||o(s,e)))}loadNamespaces(e,n){const r=ay();return this.options.ns?(dt(e)&&(e=[e]),e.forEach(i=>{this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}),this.loadResources(i=>{r.resolve(),n&&n(i)}),r):(n&&n(),Promise.resolve())}loadLanguages(e,n){const r=ay();dt(e)&&(e=[e]);const i=this.options.preload||[],s=e.filter(o=>i.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return s.length?(this.options.preload=i.concat(s),this.loadResources(o=>{r.resolve(),n&&n(o)}),r):(n&&n(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";const n=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=this.services?.languageUtils||new RY(AY());return n.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return new o_(e,n)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:LE;const r=e.forkResourceStore;r&&delete e.forkResourceStore;const i={...this.options,...e,isClone:!0},s=new o_(i);if((e.debug!==void 0||e.prefix!==void 0)&&(s.logger=s.logger.clone(e)),["store","services","language"].forEach(a=>{s[a]=this[a]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},r){const a=Object.keys(this.store.data).reduce((c,l)=>(c[l]={...this.store.data[l]},Object.keys(c[l]).reduce((d,h)=>(d[h]={...c[l][h]},d),{})),{});s.store=new wY(a,i),s.services.resourceStore=s.store}return s.translator=new H3(s.services,i),s.translator.on("*",function(a){for(var c=arguments.length,l=new Array(c>1?c-1:0),d=1;d<c;d++)l[d-1]=arguments[d];s.emit(a,...l)}),s.init(i,n),s.translator.options=i,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Gi=o_.createInstance();Gi.createInstance=o_.createInstance;Gi.createInstance;Gi.dir;Gi.init;Gi.loadResources;Gi.reloadResources;Gi.use;Gi.changeLanguage;Gi.getFixedT;const Po=Gi.t;Gi.exists;Gi.setDefaultNamespace;Gi.hasLoadedNamespace;Gi.loadNamespaces;Gi.loadLanguages;var rpe=(t=>(t.MISSING_MATRIX_RTC_FOCUS="MISSING_MATRIX_RTC_FOCUS",t.CONNECTION_LOST_ERROR="CONNECTION_LOST_ERROR",t.INSUFFICIENT_CAPACITY_ERROR="INSUFFICIENT_CAPACITY_ERROR",t.E2EE_NOT_SUPPORTED="E2EE_NOT_SUPPORTED",t.OPEN_ID_ERROR="OPEN_ID_ERROR",t.SFU_ERROR="SFU_ERROR",t.UNKNOWN_ERROR="UNKNOWN_ERROR",t))(rpe||{}),Jw=(t=>(t.CONFIGURATION_ISSUE="CONFIGURATION_ISSUE",t.NETWORK_CONNECTIVITY="NETWORK_CONNECTIVITY",t.CLIENT_CONFIGURATION="CLIENT_CONFIGURATION",t.UNKNOWN="UNKNOWN",t))(Jw||{});class yl extends Error{constructor(e,n,r,i,s){super(e,{cause:s}),this.localisedTitle=e,this.localisedMessage=i,this.category=r,this.code=n}}class lnt extends yl{constructor(e){super(Po("error.call_is_not_supported"),"MISSING_MATRIX_RTC_FOCUS","CONFIGURATION_ISSUE",Po("error.matrix_rtc_focus_missing",{domain:e,brand:"Element Call",errorCode:"MISSING_MATRIX_RTC_FOCUS"})),this.domain=e}}class OD extends yl{constructor(){super(Po("error.connection_lost"),"CONNECTION_LOST_ERROR","NETWORK_CONNECTIVITY",Po("error.connection_lost_description"))}}class unt extends yl{constructor(){super(Po("error.e2ee_unsupported"),"E2EE_NOT_SUPPORTED","CLIENT_CONFIGURATION",Po("error.e2ee_unsupported_description"))}}class MD extends yl{constructor(e){super(Po("error.generic"),"UNKNOWN_ERROR","UNKNOWN",void 0,e)}}class ipe extends yl{constructor(e){super(Po("error.generic"),"OPEN_ID_ERROR","CONFIGURATION_ISSUE",void 0,e)}}class dnt extends yl{constructor(){super(Po("error.insufficient_capacity"),"INSUFFICIENT_CAPACITY_ERROR","UNKNOWN",Po("error.insufficient_capacity_description"))}}class fnt extends yl{constructor(){super(Po("error.room_creation_restricted"),"SFU_ERROR","CONFIGURATION_ISSUE",Po("error.room_creation_restricted_description"))}}function hnt(t,e){return t===void 0&&e===void 0?!0:t===void 0||e===void 0?!1:t.jwt===e.jwt&&t.url===e.url}function pnt(t,e){const[n,r]=_.useState(void 0),i=Vtt(e),{showErrorBoundary:s}=qtt();return _.useEffect(()=>{i?spe(t,i).then(o=>{r(o)},o=>{s(new ipe(o)),M.error("Failed to get SFU config",o)}):r(void 0)},[t,i,s]),n}async function spe(t,e){let n;try{n=await RXe(async()=>t.getOpenIdToken())}catch(r){throw new ipe(r instanceof Error?r:new Error("Unknown error"))}M.debug("Got openID token",n);try{M.info(`Trying to get JWT from call's active focus URL of ${e.livekit_service_url}...`);const r=await mnt(t,e.livekit_service_url,e.livekit_alias,n);return M.info("Got JWT from call's active focus URL."),r}catch(r){M.warn(`Failed to get JWT from RTC session's active focus URL of ${e.livekit_service_url}.`,r);return}}async function mnt(t,e,n,r){try{const i=await fetch(e+"/sfu/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room:n,openid_token:r,device_id:t.getDeviceId()})});if(!i.ok)throw new Error("SFU Config fetch failed with status code "+i.status);return await i.json()}catch(i){throw new Error("SFU Config fetch failed with exception "+i)}}class gnt{constructor(e=!1){this.aborted=e}abort(){this.aborted=!0}isAborted(){return this.aborted}}var kO=(t=>(t.ECSwitchingFocus="ec_switching_focus",t.ECWaiting="ec_waiting",t))(kO||{});function OE(t){return!!t?.url&&!!t?.jwt}async function vnt(t,e,n,r,i){if(t.localParticipant.getTrackPublication(he.Source.Microphone)){M.warn("Pre-creating audio track but participant already appears to have an microphone track: this shouldn't happen!"),vTe("Pre-creating audio track but participant already appears to have an microphone track!");return}M.info("Pre-creating microphone track");let s;try{const o=await t.localParticipant.createTracks({audio:{deviceId:r}});if(o.length<1?M.info("Tried to pre-create local audio track but got no tracks"):s=o[0],i.isAborted()){M.info("[Lifecycle] Signal Aborted: Pre-created audio track but connection aborted"),s?.stop();return}M.info("Pre-created microphone track")}catch(o){M.error("Failed to pre-create microphone track",o)}if(!n&&(await s?.mute(),i.isAborted())){M.info("[Lifecycle] Signal Aborted: Pre-created audio track but connection aborted"),s?.stop();return}if(t.localParticipant.getTrackPublication(he.Source.Microphone)){M.warn("Pre-created audio track but participant already appears to have an microphone track: this shouldn't happen!"),s?.stop();return}M.info("[Lifecycle] Connecting & publishing");try{if(await ope(t,e,s,[]),i.isAborted()){M.info("[Lifecycle] Signal Aborted: Connected but operation was cancelled. Force disconnect"),t?.disconnect().catch(o=>{M.error("Failed to disconnect from SFU",o)});return}}catch(o){throw s?.stop(),M.debug("Stopped precreated audio tracks."),o}}async function ope(t,e,n,r){const i=Ut.instance.eventCallConnectDuration;i.cacheConnectStart(),t.once(ue.SignalConnected,i.cacheWsConnect);try{M.info(`[Lifecycle] Connecting to livekit room ${e.url} ...`),await t.connect(e.url,e.jwt),M.info("[Lifecycle] ... connected to livekit room")}catch(s){if(M.error("[Lifecycle] Failed to connect",s),s instanceof Qt){if(s.status===503||s.status===200||s.status===429)throw new dnt;if(s.status===404)throw new fnt}throw s}t.off(ue.SignalConnected,i.cacheWsConnect),i.track({log:!0}),n&&(M.info("Publishing precreated mic track"),await t.localParticipant.publishTrack(n,{source:he.Source.Microphone})),M.info(`Publishing ${r.length} precreated screenshare tracks`);for(const s of r)t.localParticipant.publishTrack(s,{source:he.Source.ScreenShare}).catch(o=>{M.error("Failed to publish screenshare track",o)})}function ynt(t,e,n,r){const[i,s]=_.useState(r&&n?n.state:"ec_waiting"),[o,a]=_.useState(!1),[c,l]=_.useState(!1),[d,h]=_.useState(null);if(d!==null)throw d;const m=_.useCallback(w=>{w==xt.Connected&&a(!1),s(w)},[]);_.useEffect(()=>{const w=n;return n&&n.on(ue.ConnectionStateChanged,m),()=>{w&&w.off(ue.ConnectionStateChanged,m)}},[n,m]);const g=_.useCallback(async()=>{const w=[];for(const S of n.localParticipant.videoTrackPublications.values())if(S.track&&S.source==he.Source.ScreenShare){const R=S.track.mediaStreamTrack.clone();R.enabled=!0,w.push(R)}a(!0),await n?.disconnect(),l(!0);try{await ope(n,r,void 0,w)}finally{l(!1)}},[n,r]),y=_.useRef(Object.assign({},r)),v=_.useRef(new Set);return _.useEffect(()=>{const w=v.current;return()=>{w.forEach(S=>{S.abort()})}},[]),_.useEffect(()=>{if(OE(r)&&OE(y.current)&&!hnt(y.current,r))M.info(`SFU config changed! URL was ${y.current?.url} now ${r?.url}`),g().catch(w=>{M.error("Failed to switch focus",w)});else if(!OE(y.current)&&OE(r)){l(!0);const w=new gnt;v.current.add(w),vnt(n,r,e,t,w).catch(S=>{S instanceof yl?h(S):S instanceof Error?h(new MD(S)):M.error("Failed to connect to SFU",S)}).finally(()=>{v.current.delete(w),l(!1)})}y.current=Object.assign({},r)},[r,n,t,e,g]),o?"ec_switching_focus":c?xt.Connecting:i}class bnt extends fee{constructor(){super({ratchetWindowSize:10,keyringSize:256}),this.onEncryptionKeyChanged=(e,n,r)=>{crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveBits","deriveKey"]).then(i=>{this.onSetEncryptionKey(i,r,n),M.debug(`Sent new key to livekit room=${this.rtcSession?.room.roomId} participantId=${r} encryptionKeyIndex=${n}`)},i=>{M.error(`Failed to create key material from buffer for livekit room=${this.rtcSession?.room.roomId} participantId=${r} encryptionKeyIndex=${n}`,i)})}}setRTCSession(e){this.rtcSession&&this.rtcSession.off(ei.EncryptionKeyChanged,this.onEncryptionKeyChanged),this.rtcSession=e,this.rtcSession.on(ei.EncryptionKeyChanged,this.onEncryptionKeyChanged),this.rtcSession.reemitEncryptionKeys()}}function _nt(t,e,n,r){const{controlledAudioDevices:i}=no(),s=ic(()=>e),o=Wu(),a=ic(()=>Bw(o.audioInput.selected$)?.id),c=_.useRef(!1),l=_.useRef(!1),d=_.useRef({audio:s.audio.enabled,video:s.video.enabled}),{processor:h}=GR(),m=ic(()=>{M.info("[LivekitRoom] Create LiveKit room");let y;r.kind===hn.PER_PARTICIPANT?(M.info("Created MatrixKeyProvider (per participant)"),y={keyProvider:new bnt,worker:new yY}):r.kind===hn.SHARED_KEY&&r.secret&&(M.info("Created ExternalE2EEKeyProvider (shared key)"),y={keyProvider:new jSe,worker:new yY});const v={...c5,videoCaptureDefaults:{...c5.videoCaptureDefaults,deviceId:Bw(o.videoInput.selected$)?.id,processor:h},audioCaptureDefaults:{...c5.audioCaptureDefaults,deviceId:a},audioOutput:{deviceId:i?void 0:Bw(o.audioOutput.selected$)?.id},e2ee:y},w=new xu(v);return w.setE2EEEnabled(r.kind!==hn.NONE).catch(S=>{M.error("Failed to set E2EE enabled on room",S)}),w});_.useEffect(()=>{const y=m.options.e2ee;r.kind===hn.NONE||!(y&&"keyProvider"in y)||(r.kind===hn.PER_PARTICIPANT?y.keyProvider.setRTCSession(t):r.kind===hn.SHARED_KEY&&r.secret&&y.keyProvider.setKey(r.secret).catch(v=>{M.error("Failed to set shared key for E2EE",v)}))},[m.options.e2ee,r,t]),Sfe(ai(Z8(y=>y.pipe(Ot(([v])=>vD(v.localParticipant,he.Source.Camera)),Re(v=>{const w=v?.publication?.track;return w instanceof cv?w:null})),[m])));const g=ynt(a,s.audio.enabled,m,n);return _.useEffect(()=>{const y=w=>{M.info("Local track unpublished",w.trackName,w.trackInfo)},v=w=>{M.warn("Media devices error when publishing a track",w)};return m.localParticipant.on("localTrackUnpublished",y),m.localParticipant.on("mediaDevicesError",v),()=>{m.localParticipant.off("localTrackUnpublished",y),m.localParticipant.off("mediaDevicesError",v)}},[m.localParticipant]),_.useEffect(()=>{if(m!==void 0&&g===xt.Connected){const y=m.localParticipant;d.current={audio:e.audio.enabled,video:e.video.enabled};let v;(S=>{S[S.Microphone=0]="Microphone",S[S.Camera=1]="Camera"})(v||(v={}));const w=async(S,R)=>{if(S>10){M.error("Stop trying to sync the input device with current mute state after 10 failed tries");return}let x,T,I;switch(R){case 0:x=y.isMicrophoneEnabled,T=d.current.audio,I=c.current;break;case 1:x=y.isCameraEnabled,T=d.current.video,I=l.current;break}if(x!==T&&!I)try{let k;switch(R){case 0:c.current=!0,k=await y.setMicrophoneEnabled(d.current.audio,m.options.audioCaptureDefaults),c.current=!1;break;case 1:l.current=!0,k=await y.setCameraEnabled(d.current.video,m.options.videoCaptureDefaults),l.current=!1;break}if(k)await new Promise(A=>setTimeout(A,100)),await w(S+1,R);else throw new Error("track with new mute state could not be published")}catch(k){k.name==="NotAllowedError"?(M.error("Fatal error while syncing mute state: resetting",k),R===0?(c.current=!1,e.audio.setEnabled?.(!1)):(l.current=!1,e.video.setEnabled?.(!1))):(M.error("Failed to sync audio mute state with LiveKit (will retry to sync in 1s):",k),setTimeout(()=>{w(S+1,R).catch(A=>{M.error(`Failed to sync ${v[R]} mute state with LiveKit iterCount=${S+1}`,A)})},1e3))}};w(0,0).catch(S=>{M.error("Failed to sync audio mute state with LiveKit",S)}),w(0,1).catch(S=>{M.error("Failed to sync video mute state with LiveKit",S)})}},[m,e,g]),_.useEffect(()=>{if(m!==void 0&&g===xt.Connected){const y=(w,S)=>S.subscribe(R=>{M.info("[LivekitRoom] syncDevice room.getActiveDevice(kind) !== d.id :",m.getActiveDevice(w)," !== ",R?.id),R!==void 0&&m.getActiveDevice(w)!==R.id&&m.switchActiveDevice(w,R.id).catch(x=>M.error(`Failed to sync ${w} device with LiveKit`,x))}),v=[y("audioinput",o.audioInput.selected$),i?void 0:y("audiooutput",o.audioOutput.selected$),y("videoinput",o.videoInput.selected$),o.audioInput.selected$.pipe(Ot(w=>w?.hardwareDeviceChange$??$L)).subscribe(()=>{const w=Array.from(m.localParticipant.audioTrackPublications.values()).find(S=>S.source===he.Source.Microphone)?.track;w&&w.mediaStreamTrack.readyState!=="ended"&&m.localParticipant.getTrackPublication(he.Source.Microphone)?.audioTrack?.restartTrack().catch(S=>{M.error("Failed to restart audio device track",S)})})];return()=>{for(const w of v)w?.unsubscribe()}}},[m,o,g,i]),{connState:g,livekitRoom:m}}function Snt(){_.useEffect(()=>{if("wakeLock"in navigator){let t=!0,e=null;const n=()=>{document.visibilityState==="visible"&&navigator.wakeLock.request("screen").then(r=>{e=r,t||e.release().catch(i=>M.warn("Can't release wake lock",i))},r=>{M.warn("Can't acquire wake lock",r)})};return n(),document.addEventListener("visibilitychange",n),()=>{t=!1,e!==null&&e.release().catch(r=>M.warn("Can't release wake lock",r)),document.removeEventListener("visibilitychange",n)}}},[])}const Ent="_toggle_z1rxf_8",wnt={toggle:Ent},Cnt=({layout:t,setLayout:e,className:n,onTouchEnd:r})=>{const{t:i}=We(),s=_.useCallback(o=>e(o.target.value),[e]);return E.jsxs("div",{className:Oe(wnt.toggle,n),children:[E.jsx(qi,{label:i("layout_spotlight_label"),children:E.jsx("input",{type:"radio",name:"layout",value:"spotlight",checked:t==="spotlight",onChange:s,onTouchEnd:r})}),E.jsx(L8e,{"aria-hidden":!0,width:24,height:24}),E.jsx(qi,{label:i("layout_grid_label"),children:E.jsx("input",{type:"radio",name:"layout",value:"grid",checked:t==="grid",onChange:s,onTouchEnd:r})}),E.jsx(_8e,{"aria-hidden":!0,width:24,height:24})]})};let Tnt=0;function Rnt(){return(Tnt++).toString()}class ape extends nS{constructor(e){super(),this.media$=e,this.id=Rnt()}}class Int extends nS{constructor(e,n){super(),this.media$=e,this.maximised$=n}}function knt(t,e){return{[Symbol.iterator](){const n=t[Symbol.iterator](),r=e[Symbol.iterator]();return{next(){let i;do{if(i=n.next(),!i.done&&i.value!==void 0)return i;const s=r.next();if(!s.done)return s}while(!i.done);return i}}}}}function ME(t){return t.map(e=>e.media.member?.rawDisplayName??"[👻]")}let Qw=!1;B8.value$.subscribe(t=>Qw=t);class xnt{get media(){return this.media$.value}set media(e){this.media$.next(e)}get maximised(){return this.maximised$.value}set maximised(e){this.maximised$.next(e)}constructor(e,n){this.media$=new _s(e),this.maximised$=new _s(n),this.vm=new Int(this.media$,this.maximised$)}destroy(){this.vm.destroy()}}class LY{get media(){return this.media$.value}set media(e){this.media$.next(e)}constructor(e){this.media$=new _s(e),this.vm=new ape(this.media$)}destroy(){this.vm.destroy()}}class V3{constructor(e,n,r){this.spotlight=e,this.grid=n,this.generation=r,this.spotlightTile=this.spotlight?.vm,this.gridTiles=this.grid.map(({vm:i})=>i),this.gridTilesByMedia=new Map(this.grid.map(({vm:i,media:s})=>[s,i]))}static empty(){return new V3(null,[],0)}from(e){return new Ant(this.spotlight,this.grid,(n,r)=>new V3(n,r,this.generation+1),e,this.generation)}}class Ant{constructor(e,n,r,i,s){this.prevSpotlight=e,this.prevGrid=n,this.construct=r,this.visibleTiles=i,this.generation=s,this.spotlight=null,this.prevSpotlightSpeaker=this.prevSpotlight?.media.length===1&&"speaking"in this.prevSpotlight.media[0]&&this.prevSpotlight.media[0],this.prevGridByMedia=new Map(this.prevGrid.map((o,a)=>[o.media,[o,a]])),this.numGridEntries=0,this.stationaryGridEntries=new Array(this.prevGrid.length),this.visibleGridEntries=[],this.invisibleGridEntries=[]}registerSpotlight(e,n){if(Qw&&M.debug(`[TileStore, ${this.generation}] register spotlight: ${e.map(r=>r.member?.rawDisplayName??"[👻]")}`),this.spotlight!==null)throw new Error("Spotlight already set");if(this.numGridEntries>0)throw new Error("Spotlight must be registered before grid tiles");this.prevSpotlight===null?this.spotlight=new xnt(e,n):(this.spotlight=this.prevSpotlight,this.spotlight.media=e,this.spotlight.maximised=n)}registerGridTile(e){if(Qw&&M.debug(`[TileStore, ${this.generation}] register grid tile: ${e.member?.rawDisplayName??"[👻]"}`),this.spotlight!==null){if(!e.local&&this.spotlight.media.includes(e))return;if(e===this.prevSpotlightSpeaker&&this.spotlight.media.length===1&&"speaking"in this.spotlight.media[0]&&this.prevSpotlightSpeaker!==this.spotlight.media[0]){const r=this.prevGridByMedia.get(this.spotlight.media[0]);if(r!==void 0){const[i,s]=r,o=s<this.visibleTiles,a=this.numGridEntries<this.visibleTiles;o===a?(this.stationaryGridEntries[s]=i,i.media=e,this.prevGridByMedia.delete(this.spotlight.media[0]),this.prevGridByMedia.set(e,r)):(a?this.visibleGridEntries:this.invisibleGridEntries).push(new LY(e)),this.numGridEntries++;return}}}const n=this.prevGridByMedia.get(e);if(n===void 0)(this.numGridEntries<this.visibleTiles?this.visibleGridEntries:this.invisibleGridEntries).push(new LY(e));else{const[r,i]=n,s=i<this.visibleTiles,o=this.numGridEntries<this.visibleTiles;s===o?this.stationaryGridEntries[i]=r:(o?this.visibleGridEntries:this.invisibleGridEntries).push(r)}this.numGridEntries++}build(){const e=[...knt(this.stationaryGridEntries,[...this.visibleGridEntries,...this.invisibleGridEntries])];Qw&&(M.debug(`[TileStore, ${this.generation}] stationary: ${ME(this.stationaryGridEntries)}`),M.debug(`[TileStore, ${this.generation}] visible: ${ME(this.visibleGridEntries)}`),M.debug(`[TileStore, ${this.generation}] invisible: ${ME(this.invisibleGridEntries)}`),M.debug(`[TileStore, ${this.generation}] result: ${ME(e)}`)),this.spotlight===null&&this.prevSpotlight!==null&&this.prevSpotlight.destroy();const n=new Set(e);for(const r of this.prevGrid)n.has(r)||r.destroy();return this.construct(this.spotlight,e)}}function Pnt(t,e,n,r){const i=r.from(e);t.spotlight!==void 0&&i.registerSpotlight(t.spotlight,t.type==="spotlight-portrait");for(const o of t.grid)i.registerGridTile(o);const s=i.build();return[{type:t.type,spotlight:s.spotlightTile,grid:s.gridTiles,setVisibleTiles:n},s]}function Lnt(t,e){const n=e.from(1);n.registerSpotlight(t.spotlight,!0),t.pip!==void 0&&n.registerGridTile(t.pip);const r=n.build();return[{type:t.type,spotlight:r.spotlightTile,pip:r.gridTiles[0]},r]}function Ont(t,e){const n=e.from(2);n.registerGridTile(t.local),n.registerGridTile(t.remote);const r=n.build();return[{type:t.type,local:r.gridTilesByMedia.get(t.local),remote:r.gridTilesByMedia.get(t.remote)},r]}function Mnt(t,e){const n=e.from(0);n.registerSpotlight(t.spotlight,!0);const r=n.build();return[{type:t.type,spotlight:r.spotlightTile},r]}function Dnt(t){const e=t.pipe(Kc());return e.pipe(wle(n=>H_(du(n?1e3:6e4),e.pipe(es(r=>r!==n)))),dn(!1),Kc())}function OY(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}const cy=new Map;function xO(t){if(cy.has(t))return cy.get(t);const e=Qd(t);return cy.size>500&&cy.clear(),cy.set(t,e),e}function Nnt(t,e,n){const{rawDisplayName:r,userId:i}=t;if(!r||r===i)return!1;const s=xO(r);return s?/@.+:.+/.test(r)||/[\u200E\u200F\u202A-\u202F]/.test(r)?!0:e.map(o=>o.sender&&n.getMember(o.sender)).filter(o=>!!o).filter(o=>o.userId!==i).some(o=>xO(cpe(o,!1))===s):!1}function cpe(t,e){const{rawDisplayName:n,userId:r}=t;if(!n||n===r)return r;const i=nC(n);return e?i+" ("+r+")":xO(n)?i:r}const Unt=3e3,MY=8,DY=500,jnt=3,u5=4e3;class DE{constructor(e,n,r,i,s,o,a,c,l,d){this.id=e,this.scope=new XR,this.participant$=new _s(r),r?.isLocal?this.vm=new Dv(this.id,n,this.participant$,i,s,o,this.scope.behavior(c),this.scope.behavior(l),this.scope.behavior(d)):this.vm=new JZe(e,n,this.participant$.asObservable(),i,s,a,this.scope.behavior(c),this.scope.behavior(l),this.scope.behavior(d)),this.speaker$=this.scope.behavior(Dnt(this.vm.speaking$)),this.presenter$=this.scope.behavior(this.participant$.pipe(Ot(h=>(h&&Y8(h,ce.TrackPublished,ce.TrackUnpublished,ce.LocalTrackPublished,ce.LocalTrackUnpublished).pipe(Re(m=>m.isScreenShareEnabled)))??Ct(!1))))}updateParticipant(e){this.participant$.value!==e&&this.participant$.next(e)}destroy(){this.scope.end(),this.vm.destroy()}}class NY{constructor(e,n,r,i,s,o,a){this.scope=new XR,this.participant$=new _s(r),this.vm=new Sg(e,n,this.participant$.asObservable(),i,s,o,this.scope.behavior(a),r.isLocal)}destroy(){this.scope.end(),this.vm.destroy()}}function UY(t,e){let n=t.sender+":"+t.deviceId;if(!t.sender)return{id:n,member:void 0};t.sender===e.client.getUserId()&&t.deviceId===e.client.getDeviceId()&&(n="local");const r=e.getMember(t.sender)??void 0;return{id:n,member:r}}class Fnt extends nS{constructor(e,n,r,i,s,o,a,c){super(),this.matrixRTCSession=e,this.matrixRoom=n,this.livekitRoom=r,this.mediaDevices=i,this.options=s,this.livekitConnectionState$=o,this.handsRaisedSubject$=a,this.reactionsSubject$=c,this.userId=this.matrixRoom.client.getUserId(),this.matrixConnected$=this.scope.behavior(dz(Zo(this.matrixRoom.client,Le.Sync).pipe(dn([this.matrixRoom.client.getSyncState()]),Re(([l])=>l===Gt.Syncing)),Zo(this.matrixRTCSession,Hh.StatusChanged).pipe(dn(null),Re(()=>this.matrixRTCSession.membershipStatus===Ad.Connected)),Zo(this.matrixRTCSession,Hh.ProbablyLeft).pipe(dn(null),Re(()=>this.matrixRTCSession.probablyLeft!==!0)))),this.connected$=this.scope.behavior(dz(this.matrixConnected$,this.livekitConnectionState$.pipe(Re(l=>l===xt.Connected)))),this.reconnecting$=this.scope.behavior(this.connected$.pipe(ql(({connectedPreviously:l,reconnecting:d},h)=>({connectedPreviously:l||h,reconnecting:l&&!h}),{connectedPreviously:!1,reconnecting:!1}),Re(({reconnecting:l})=>l))),this.pretendToBeDisconnected$=this.reconnecting$,this.rawRemoteParticipants$=this.scope.behavior(hze(this.livekitRoom),[]),this.remoteParticipantHolds$=this.scope.behavior(this.livekitConnectionState$.pipe(Tle(this.rawRemoteParticipants$),B_(([l,d])=>l===kO.ECSwitchingFocus?mp(Ct({hold:d}),Kqe([du(Unt),this.livekitConnectionState$.pipe(es(h=>h!==kO.ECSwitchingFocus),Uw(1))]).pipe(Re(()=>({unhold:d})))):vg),qL([],(l,d)=>"hold"in d?[d.hold,...l]:l.filter(h=>h!==d.unhold)))),this.remoteParticipants$=this.scope.behavior(Xt([this.rawRemoteParticipants$,this.remoteParticipantHolds$],(l,d)=>{const h=[...l],m=new Set(h.map(g=>g.identity));for(const g of d)for(const y of g)m.has(y.identity)||(h.push(y),m.add(y.identity));return h})).pipe(z1(this.pretendToBeDisconnected$)),this.memberships$=this.scope.behavior(Zo(this.matrixRTCSession,ei.MembershipsChanged).pipe(dn(null),z1(this.pretendToBeDisconnected$),Re(()=>this.matrixRTCSession.memberships))),this.memberDisplaynames$=this.scope.behavior(Xt([this.memberships$,Zo(this.matrixRoom,pt.Members).pipe(dn(null),z1(this.pretendToBeDisconnected$))],(l,d)=>{const h=new Map,m=this.matrixRoom;for(const g of l){const y=`${g.sender}:${g.deviceId}`,{member:v}=UY(g,m);if(!v){M.error("Could not find member for media id:",y);continue}const w=Nnt(v,l,m);h.set(y,cpe(v,w))}return h})),this.handsRaised$=this.scope.behavior(this.handsRaisedSubject$.pipe(z1(this.pretendToBeDisconnected$))),this.reactions$=this.scope.behavior(this.reactionsSubject$.pipe(Re(l=>Object.fromEntries(Object.entries(l).map(([d,{reactionOption:h}])=>[d,h]))),z1(this.pretendToBeDisconnected$))),this.mediaItems$=this.scope.behavior(Xt([this.remoteParticipants$,X8(this.livekitRoom.localParticipant),Ile.value$,this.memberships$,kle.value$]).pipe(ql((l,[d,{participant:h},m,g,y])=>{const v=new Map((function*(){const R=this.matrixRoom;for(const x of g){const{member:T,id:I}=UY(x,R),k=`${x.sender}:${x.deviceId}`;let A;I==="local"?A=h:A=d.find(O=>O.identity===I),T||M.error("Could not find member for media id: ",I);for(let O=0;O<1+m;O++){const D=`${I}:${O}`;let N=l.get(D);if(N&&N instanceof DE&&(N.updateParticipant(A),N.vm.member===void 0&&(N=void 0)),yield[D,N??new DE(D,T,A,this.options.encryptionSystem,this.livekitRoom,this.mediaDevices,this.pretendToBeDisconnected$,this.memberDisplaynames$.pipe(Re(U=>U.get(k)??"[👻]")),this.handsRaised$.pipe(Re(U=>U[k]?.time??null)),this.reactions$.pipe(Re(U=>U[k]??void 0)))],A?.isScreenShareEnabled){const U=`${D}:screen-share`;yield[U,l.get(U)??new NY(U,T,A,this.options.encryptionSystem,this.livekitRoom,this.pretendToBeDisconnected$,this.memberDisplaynames$.pipe(Re($=>$.get(k)??"[👻]")))]}}}}).bind(this)()),w=y?new Map((function*(){for(const R of d)for(let x=0;x<1+m;x++){const T=R.identity+":"+x;if(!v.has(T)){const I=T;yield[I,l.get(I)??new DE(I,void 0,R,this.options.encryptionSystem,this.livekitRoom,this.mediaDevices,this.pretendToBeDisconnected$,this.memberDisplaynames$.pipe(Re(k=>k.get(R.identity)??"[👻]")),Ct(null),Ct(null))]}}}).bind(this)()):new Map;w.size>0&&M.debug("Added NonMember items: ",w);const S=new Map([...w.entries(),...v.entries()]);for(const[R,x]of l)S.has(R)||x.destroy();return S},new Map),Re(l=>[...l.values()]),pze(l=>{for(const d of l)d.destroy()}))),this.userMedia$=this.scope.behavior(this.mediaItems$.pipe(Re(l=>l.filter(d=>d instanceof DE)))),this.joinSoundEffect$=this.userMedia$.pipe(jw(),es(([l,d])=>d.length<=MY&&d.length>l.length),Re(()=>{}),BL(DY)),this.participantCount$=this.scope.behavior(this.memberships$.pipe(Re(l=>l.length))),this.allOthersLeft$=this.memberships$.pipe(jw(),es(([l,d])=>d.every(h=>h.sender===this.userId)&&l.some(h=>h.sender!==this.userId)),Re(()=>{}),Uw(1)),this.autoLeave$=this.options.autoLeaveWhenOthersLeft?this.allOthersLeft$:$L,this.didSendCallNotification$=Zo(this.matrixRTCSession,ei.DidSendCallNotification),this.ring$=this.scope.behavior(this.didSendCallNotification$.pipe(es(([l])=>l.notification_type==="ring"),Re(([l])=>{const d=l?.lifetime??0;return mp(d===0?vg:du(d).pipe(sGe(),dn("ringing")),Ct("timeout"),$L).pipe(Cle(Zo(this.matrixRoom,ke.Timeline).pipe(es(([h])=>h.getType()===Z.RTCDecline&&h.getRelation()?.rel_type==="m.reference"&&h.getRelation()?.event_id===l.event_id&&h.getSender()!==this.userId))),dGe("decline"))})),vg),this.someoneElseJoined$=this.memberships$.pipe(Re(l=>l.some(d=>d.sender!==this.userId))),this.callPickupState$=this.options.waitForCallPickup?this.scope.behavior(Xt([this.livekitConnectionState$,this.someoneElseJoined$]).pipe(Ot(([l,d])=>l===xt.Disconnected?Ct("unknown"):d?Ct("success"):this.ring$.pipe(zK())),dn("unknown"))):eue(null),this.leaveSoundEffect$=Xt([this.callPickupState$,this.userMedia$]).pipe(pGe(([l])=>l!==null&&l!=="success"),Re(([,l])=>l),jw(),es(([l,d])=>d.length<=MY&&d.length<l.length),Re(()=>{}),BL(DY)),this.screenShares$=this.scope.behavior(this.mediaItems$.pipe(Re(l=>l.filter(d=>d instanceof NY)))),this.spotlightSpeaker$=this.scope.behavior(this.userMedia$.pipe(Ot(l=>l.length===0?Ct([]):Xt(l.map(d=>d.vm.speaking$.pipe(Re(h=>[d,h]))))),ql((l,d)=>{const[h,m]=!l?.vm.local&&d.find(([g])=>g===l)||[];return m?h:d.find(([g,y])=>!g.vm.local&&y)?.[0]??h??d.find(([g])=>!g.vm.local)?.[0]??d.find(([g])=>g.vm.local)?.[0]},null),Re(l=>l?.vm??null))),this.grid$=this.scope.behavior(this.userMedia$.pipe(Ot(l=>{const d=l.map(h=>Xt([h.speaker$,h.presenter$,h.vm.videoEnabled$,h.vm.handRaised$,h.vm instanceof Dv?h.vm.alwaysShow$:Ct(!1)],(m,g,y,v,w)=>{let S;return h.vm.local?S=w?0:6:g?S=1:m?S=2:v?S=3:y?S=4:S=5,[h,S]}));return d.length===0?Ct([]):Xt(d,(...h)=>h.sort(([,m],[,g])=>m-g).map(([m])=>m.vm))}),Kc(OY))),this.spotlight$=this.scope.behavior(this.screenShares$.pipe(Ot(l=>l.length>0?Ct(l.map(d=>d.vm)):this.spotlightSpeaker$.pipe(Re(d=>d?[d]:[]))),Kc(OY))),this.pip$=this.scope.behavior(Xt([this.screenShares$,this.spotlightSpeaker$,this.mediaItems$]).pipe(Ot(([l,d,h])=>{if(l.length>0)return this.spotlightSpeaker$;if(!d||d.local)return Ct(null);const g=h.find(y=>y.vm instanceof Dv)?.vm;return g?g.alwaysShow$.pipe(Re(y=>y?g:null)):Ct(null)}))),this.hasRemoteScreenShares$=this.spotlight$.pipe(Re(l=>l.some(d=>!d.local&&d instanceof Sg)),Kc()),this.pipEnabled$=this.scope.behavior(sg,!1),this.naturalWindowMode$=this.scope.behavior(Zo(window,"resize").pipe(dn(null),Re(()=>{const l=window.innerHeight,d=window.innerWidth;return l<=400&&d<=340?"pip":l<=600?"flat":d<=600?"narrow":"normal"}))),this.windowMode$=this.scope.behavior(this.pipEnabled$.pipe(Ot(l=>l?Ct("pip"):this.naturalWindowMode$))),this.spotlightExpandedToggle$=new ii,this.spotlightExpanded$=this.scope.behavior(this.spotlightExpandedToggle$.pipe(qL(!1,l=>!l))),this.gridModeUserSelection$=new ii,this.gridMode$=this.scope.behavior(this.gridModeUserSelection$.pipe(dn(null),Ot(l=>(l==="spotlight"?vg:Xt([this.hasRemoteScreenShares$,this.windowMode$]).pipe(hGe(l===null?0:1),Re(([d,h])=>d||h==="flat"?"spotlight":"grid"))).pipe(dn(l??"grid"))))),this.gridLayoutMedia$=Xt([this.grid$,this.spotlight$],(l,d)=>({type:"grid",spotlight:d.some(h=>h instanceof Sg)?d:void 0,grid:l})),this.spotlightLandscapeLayoutMedia$=Xt([this.grid$,this.spotlight$],(l,d)=>({type:"spotlight-landscape",spotlight:d,grid:l})),this.spotlightPortraitLayoutMedia$=Xt([this.grid$,this.spotlight$],(l,d)=>({type:"spotlight-portrait",spotlight:d,grid:l})),this.spotlightExpandedLayoutMedia$=Xt([this.spotlight$,this.pip$],(l,d)=>({type:"spotlight-expanded",spotlight:l,pip:d??void 0})),this.oneOnOneLayoutMedia$=this.mediaItems$.pipe(Re(l=>{if(l.length!==2)return null;const d=l.find(m=>m.vm.local)?.vm,h=l.find(m=>!m.vm.local)?.vm;return!h||!d?null:{type:"one-on-one",local:d,remote:h}})),this.pipLayoutMedia$=this.spotlight$.pipe(Re(l=>({type:"pip",spotlight:l}))),this.layoutMedia$=this.scope.behavior(this.windowMode$.pipe(Ot(l=>{switch(l){case"normal":return this.gridMode$.pipe(Ot(d=>{switch(d){case"grid":return this.oneOnOneLayoutMedia$.pipe(Ot(h=>h===null?this.gridLayoutMedia$:Ct(h)));case"spotlight":return this.spotlightExpanded$.pipe(Ot(h=>h?this.spotlightExpandedLayoutMedia$:this.spotlightLandscapeLayoutMedia$))}}));case"narrow":return this.oneOnOneLayoutMedia$.pipe(Ot(d=>d===null?Xt([this.grid$,this.spotlight$],(h,m)=>h.length>jnt||m.some(g=>g instanceof Sg)?this.spotlightPortraitLayoutMedia$:this.gridLayoutMedia$).pipe(zK()):this.spotlightExpandedLayoutMedia$));case"flat":return this.gridMode$.pipe(Ot(d=>{switch(d){case"grid":return this.spotlightLandscapeLayoutMedia$;case"spotlight":return this.spotlightExpandedLayoutMedia$}}));case"pip":return this.pipLayoutMedia$}}))),this.visibleTiles$=new ii,this.setVisibleTiles=l=>this.visibleTiles$.next(l),this.layoutInternals$=this.scope.behavior(Xt([this.layoutMedia$,this.visibleTiles$.pipe(dn(0),Kc())]).pipe(ql(({tiles:l},[d,h])=>{let m,g;switch(d.type){case"grid":case"spotlight-landscape":case"spotlight-portrait":[m,g]=Pnt(d,h,this.setVisibleTiles,l);break;case"spotlight-expanded":[m,g]=Lnt(d,l);break;case"one-on-one":[m,g]=Ont(d,l);break;case"pip":[m,g]=Mnt(d,l);break}return{layout:m,tiles:g}},{layout:null,tiles:V3.empty()}))),this.layout$=this.scope.behavior(this.layoutInternals$.pipe(Re(({layout:l})=>l))),this.tileStoreGeneration$=this.scope.behavior(this.layoutInternals$.pipe(Re(({tiles:l})=>l.generation))),this.showSpotlightIndicators$=this.scope.behavior(this.layout$.pipe(Re(l=>l.type!=="grid"))),this.showSpeakingIndicators$=this.scope.behavior(this.layout$.pipe(Ot(l=>{switch(l.type){case"spotlight-landscape":case"spotlight-portrait":return l.spotlight.media$.pipe(Re(d=>d.some(h=>h instanceof Sg)));case"spotlight-expanded":case"one-on-one":return Ct(!1);default:return Ct(!0)}}))),this.toggleSpotlightExpanded$=this.scope.behavior(this.windowMode$.pipe(Ot(l=>l==="normal"?this.layout$.pipe(Re(d=>d.type==="spotlight-landscape"||d.type==="spotlight-expanded")):Ct(!1)),Kc(),Re(l=>l?()=>this.spotlightExpandedToggle$.next():null))),this.screenTap$=new ii,this.controlsTap$=new ii,this.screenHover$=new ii,this.screenUnhover$=new ii,this.showHeader$=this.scope.behavior(this.windowMode$.pipe(Re(l=>l!=="pip"&&l!=="flat"))),this.showFooter$=this.scope.behavior(this.windowMode$.pipe(Ot(l=>{switch(l){case"pip":return Ct(!1);case"normal":case"narrow":return Ct(!0);case"flat":return _je()?Ct(!0):H_(this.screenTap$.pipe(Re(()=>"tap screen")),this.controlsTap$.pipe(Re(()=>"tap controls")),this.screenHover$.pipe(Re(()=>"hover"))).pipe(mGe((d,h)=>{switch(h){case"tap screen":return d?Ct(!1):du(u5).pipe(Re(()=>!1),dn(!0));case"tap controls":return du(u5).pipe(Re(()=>!1),dn(!0));case"hover":return nGe(du(u5),this.screenUnhover$.pipe(Uw(1))).pipe(Re(()=>!1),dn(!0))}},!1),dn(!1))}}))),this.earpieceMode$=this.scope.behavior(Xt([this.mediaDevices.audioOutput.available$,this.mediaDevices.audioOutput.selected$],(l,d)=>d!==void 0&&l.get(d.id)?.type==="earpiece")),this.audioOutputSwitcher$=this.scope.behavior(Xt([this.mediaDevices.audioOutput.available$,this.mediaDevices.audioOutput.selected$],(l,d)=>{const m=(d&&l.get(d.id)?.type)==="speaker"?"earpiece":"speaker",g=[...l].find(([,v])=>v.type===m);if(g===void 0)return null;const[y]=g;return{targetOutput:m,switch:()=>this.mediaDevices.audioOutput.select(y)}})),this.visibleReactions$=this.scope.behavior(Ple.value$.pipe(Ot(l=>l?this.reactions$:Ct({})),ql((l,d)=>{const h=[];for(const[m,g]of Object.entries(d)){const y=l.find(v=>v.sender===m&&v.emoji)?.startX??Math.ceil(Math.random()*80)+10;h.push({sender:m,emoji:g.emoji,startX:y})}return h},[]))),this.audibleReactions$=H8.value$.pipe(Ot(l=>l?this.reactions$:Ct({})),Re(l=>Object.values(l).map(d=>d.name)),ql((l,d)=>({playing:d.filter(h=>l.playing.includes(h)||l.newSounds.includes(h)),newSounds:d.filter(h=>!l.playing.includes(h)&&!l.newSounds.includes(h))}),{playing:[],newSounds:[]}),Re(l=>l.newSounds)),this.newHandRaised$=this.handsRaised$.pipe(Re(l=>Object.keys(l).length),ql((l,d)=>({value:d,playSounds:d>l.value}),{value:0,playSounds:!1}),es(l=>l.playSounds)),this.newScreenShare$=this.screenShares$.pipe(Re(l=>l.length),ql((l,d)=>({value:d,playSounds:d>l.value}),{value:0,playSounds:!1}),es(l=>l.playSounds)),this.matrixConnected$.pipe(this.scope.bind()).subscribe(l=>{const d=this.livekitRoom.localParticipant.trackPublications.values();if(l){for(const h of d)if(h.track?.isUpstreamPaused===!0){const m=h.track.kind;M.log(`Resumming ${m} track (MatrixRTC connection present)`),h.track.resumeUpstream().catch(g=>M.error(`Failed to resume ${m} track after MatrixRTC reconnection`,g))}}else for(const h of d)if(h.track?.isUpstreamPaused===!1){const m=h.track.kind;M.log(`Pausing ${m} track (uncertain MatrixRTC connection)`),h.track.pauseUpstream().catch(g=>M.error(`Failed to pause ${m} track after entering uncertain MatrixRTC connection`,g))}})}setGridMode(e){this.gridModeUserSelection$.next(e)}tapScreen(){this.screenTap$.next()}tapControls(){this.controlsTap$.next()}hoverScreen(){this.screenHover$.next()}unhoverScreen(){this.screenUnhover$.next()}}function $nt(t,e,n){return Math.max(e,Math.min(t,n))}const ki={toVector(t,e){return t===void 0&&(t=e),Array.isArray(t)?t:[t,t]},add(t,e){return[t[0]+e[0],t[1]+e[1]]},sub(t,e){return[t[0]-e[0],t[1]-e[1]]},addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function jY(t,e,n){return e===0||Math.abs(e)===1/0?Math.pow(t,n*5):t*e*n/(e+n*t)}function FY(t,e,n,r=.15){return r===0?$nt(t,e,n):t<e?-jY(e-t,n-e,r)+e:t>n?+jY(t-n,n-e,r)+n:t}function Bnt(t,[e,n],[r,i]){const[[s,o],[a,c]]=t;return[FY(e,s,o,r),FY(n,a,c,i)]}function Hnt(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Vnt(t){var e=Hnt(t,"string");return typeof e=="symbol"?e:String(e)}function cs(t,e,n){return e=Vnt(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $Y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function cr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$Y(Object(n),!0).forEach(function(r){cs(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$Y(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const lpe={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function BY(t){return t?t[0].toUpperCase()+t.slice(1):""}const qnt=["enter","leave"];function Gnt(t=!1,e){return t&&!qnt.includes(e)}function Knt(t,e="",n=!1){const r=lpe[t],i=r&&r[e]||e;return"on"+BY(t)+BY(i)+(Gnt(n,i)?"Capture":"")}const znt=["gotpointercapture","lostpointercapture"];function Wnt(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const r=znt.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:n}}function Ynt(t,e=""){const n=lpe[t],r=n&&n[e]||e;return t+r}function o4(t){return"touches"in t}function upe(t){return o4(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function Xnt(t){return Array.from(t.touches).filter(e=>{var n,r;return e.target===t.currentTarget||((n=t.currentTarget)===null||n===void 0||(r=n.contains)===null||r===void 0?void 0:r.call(n,e.target))})}function Jnt(t){return t.type==="touchend"||t.type==="touchcancel"?t.changedTouches:t.targetTouches}function dpe(t){return o4(t)?Jnt(t)[0]:t}function Qnt(t){return Xnt(t).map(e=>e.identifier)}function d5(t){const e=dpe(t);return o4(t)?e.identifier:e.pointerId}function HY(t){const e=dpe(t);return[e.clientX,e.clientY]}function Znt(t){var e,n;const{scrollX:r,scrollY:i,scrollLeft:s,scrollTop:o}=t.currentTarget;return[(e=r??s)!==null&&e!==void 0?e:0,(n=i??o)!==null&&n!==void 0?n:0]}function ert(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:s}=t;Object.assign(e,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:s})}return e}function q3(t,...e){return typeof t=="function"?t(...e):t}function trt(){}function nrt(...t){return t.length===0?trt:t.length===1?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function VY(t,e){return Object.assign({},e,t||{})}const rrt=32;class irt{constructor(e,n,r){this.ctrl=e,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:n,ingKey:r,args:i}=this;n[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const n=this.state,r=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=e.target,n.currentTarget=e.currentTarget,n.lastOffset=r.from?q3(r.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=e.timeStamp)}computeValues(e){const n=this.state;n._values=e,n.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:n,config:r,shared:i}=this;n.args=this.args;let s=0;if(e&&(n.event=e,r.preventDefault&&e.cancelable&&n.event.preventDefault(),n.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,ert(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,s=e.timeStamp-n.timeStamp,n.timeStamp=e.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const k=n._delta.map(Math.abs);ki.addTo(n._distance,k)}this.axisIntent&&this.axisIntent(e);const[o,a]=n._movement,[c,l]=r.threshold,{_step:d,values:h}=n;if(r.hasCustomTransform?(d[0]===!1&&(d[0]=Math.abs(o)>=c&&h[0]),d[1]===!1&&(d[1]=Math.abs(a)>=l&&h[1])):(d[0]===!1&&(d[0]=Math.abs(o)>=c&&Math.sign(o)*c),d[1]===!1&&(d[1]=Math.abs(a)>=l&&Math.sign(a)*l)),n.intentional=d[0]!==!1||d[1]!==!1,!n.intentional)return;const m=[0,0];if(r.hasCustomTransform){const[k,A]=h;m[0]=d[0]!==!1?k-d[0]:0,m[1]=d[1]!==!1?A-d[1]:0}else m[0]=d[0]!==!1?o-d[0]:0,m[1]=d[1]!==!1?a-d[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(m);const g=n.offset,y=n._active&&!n._blocked||n.active;y&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=i[this.ingKey]=n._active,e&&(n.first&&("bounds"in r&&(n._bounds=q3(r.bounds,n)),this.setup&&this.setup()),n.movement=m,this.computeOffset()));const[v,w]=n.offset,[[S,R],[x,T]]=n._bounds;n.overflow=[v<S?-1:v>R?1:0,w<x?-1:w>T?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const I=n._active?r.rubberband||[0,0]:[0,0];if(n.offset=Bnt(n._bounds,n.offset,I),n.delta=ki.sub(n.offset,g),this.computeMovement(),y&&(!n.last||s>rrt)){n.delta=ki.sub(n.offset,g);const k=n.delta.map(Math.abs);ki.addTo(n.distance,k),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&s>0&&(n.velocity=[k[0]/s,k[1]/s],n.timeDelta=s)}}emit(){const e=this.state,n=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const i=this.handler(cr(cr(cr({},n),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function srt([t,e],n){const r=Math.abs(t),i=Math.abs(e);if(r>i&&r>n)return"x";if(i>r&&i>n)return"y"}class fpe extends irt{constructor(...e){super(...e),cs(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=ki.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=ki.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const n=this.state,r=this.config;if(!n.axis&&e){const i=typeof r.axisThreshold=="object"?r.axisThreshold[upe(e)]:r.axisThreshold;n.axis=srt(n._movement,i)}n._blocked=(r.lockDirection||!!r.axis)&&!n.axis||!!r.axis&&r.axis!==n.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const ort=t=>t,qY=.15,hpe={enabled(t=!0){return t},eventOptions(t,e,n){return cr(cr({},n.shared.eventOptions),t)},preventDefault(t=!1){return t},triggerAllEvents(t=!1){return t},rubberband(t=0){switch(t){case!0:return[qY,qY];case!1:return[0,0];default:return ki.toVector(t)}},from(t){if(typeof t=="function")return t;if(t!=null)return ki.toVector(t)},transform(t,e,n){const r=t||n.shared.transform;return this.hasCustomTransform=!!r,r||ort},threshold(t){return ki.toVector(t,0)}},art=0,p0=cr(cr({},hpe),{},{axis(t,e,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(t=art){return t},bounds(t={}){if(typeof t=="function")return s=>p0.bounds(t(s));if("current"in t)return()=>t.current;if(typeof HTMLElement=="function"&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=t;return[[e,n],[r,i]]}}),GY={ArrowRight:(t,e=1)=>[t*e,0],ArrowLeft:(t,e=1)=>[-1*t*e,0],ArrowUp:(t,e=1)=>[0,-1*t*e],ArrowDown:(t,e=1)=>[0,t*e]};class crt extends fpe{constructor(...e){super(...e),cs(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const n=e._bounds.getBoundingClientRect(),r=e.currentTarget.getBoundingClientRect(),i={left:n.left-r.left+e.offset[0],right:n.right-r.right+e.offset[0],top:n.top-r.top+e.offset[1],bottom:n.bottom-r.bottom+e.offset[1]};e._bounds=p0.bounds(i)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const n=this.config,r=this.state;if(e.buttons!=null&&(Array.isArray(n.pointerButtons)?!n.pointerButtons.includes(e.buttons):n.pointerButtons!==-1&&n.pointerButtons!==e.buttons))return;const i=this.ctrl.setEventIds(e);n.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(i&&i.size>1&&r._pointerActive)&&(this.start(e),this.setupPointer(e),r._pointerId=d5(e),r._pointerActive=!0,this.computeValues(HY(e)),this.computeInitial(),n.preventScrollAxis&&upe(e)!=="mouse"?(r._active=!1,this.setupScrollPrevention(e)):n.delay>0?(this.setupDelayTrigger(e),n.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const n=this.state;n._active=!0,n._preventScroll=!0,n._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const n=this.state,r=this.config;if(!n._pointerActive)return;const i=d5(e);if(n._pointerId!==void 0&&i!==n._pointerId)return;const s=HY(e);if(document.pointerLockElement===e.target?n._delta=[e.movementX,e.movementY]:(n._delta=ki.sub(s,n._values),this.computeValues(s)),ki.addTo(n._movement,n._delta),this.compute(e),n._delayed&&n.intentional){this.timeoutStore.remove("dragDelay"),n.active=!1,this.startPointerDrag(e);return}if(r.preventScrollAxis&&!n._preventScroll)if(n.axis)if(n.axis===r.preventScrollAxis||r.preventScrollAxis==="xy"){n._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}else return;this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const n=this.state,r=this.config;if(!n._active||!n._pointerActive)return;const i=d5(e);if(n._pointerId!==void 0&&i!==n._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[s,o]=n._distance;if(n.tap=s<=r.tapsThreshold&&o<=r.tapsThreshold,n.tap&&r.filterTaps)n._force=!0;else{const[a,c]=n._delta,[l,d]=n._movement,[h,m]=r.swipe.velocity,[g,y]=r.swipe.distance,v=r.swipe.duration;if(n.elapsedTime<v){const w=Math.abs(a/n.timeDelta),S=Math.abs(c/n.timeDelta);w>h&&Math.abs(l)>g&&(n.swipe[0]=Math.sign(a)),S>m&&Math.abs(d)>y&&(n.swipe[1]=Math.sign(c))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const n=this.config,r=n.device;n.pointerLock&&e.currentTarget.requestPointerLock(),n.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,lrt(e);const n=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",n),this.eventStore.add(this.sharedConfig.window,"touch","cancel",n),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const n=GY[e.key];if(n){const r=this.state,i=e.shiftKey?10:e.altKey?.1:1;this.start(e),r._delta=n(this.config.keyboardDisplacement,i),r._keyboardActive=!0,ki.addTo(r._movement,r._delta),this.compute(e),this.emit()}}keyUp(e){e.key in GY&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const n=this.config.device;e(n,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(n,"change",this.pointerMove.bind(this)),e(n,"end",this.pointerUp.bind(this)),e(n,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function lrt(t){"persist"in t&&typeof t.persist=="function"&&t.persist()}const aS=typeof window<"u"&&window.document&&window.document.createElement;function ppe(){return aS&&"ontouchstart"in window}function urt(){return ppe()||aS&&window.navigator.maxTouchPoints>1}function drt(){return aS&&"onpointerdown"in window}function frt(){return aS&&"exitPointerLock"in window.document}function hrt(){try{return"constructor"in GestureEvent}catch{return!1}}const oa={isBrowser:aS,gesture:hrt(),touch:ppe(),touchscreen:urt(),pointer:drt(),pointerLock:frt()},prt=250,mrt=180,grt=.5,vrt=50,yrt=250,brt=10,KY={mouse:0,touch:0,pen:8},_rt=cr(cr({},p0),{},{device(t,e,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&oa.pointerLock,oa.touch&&n?"touch":this.pointerLock?"mouse":oa.pointer&&!i?"pointer":oa.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&t?prt:void 0,!(!oa.touchscreen||n===!1))return t||(n!==void 0?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:r=3,axis:i=void 0}){const s=ki.toVector(t,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,s},swipe({velocity:t=grt,distance:e=vrt,duration:n=yrt}={}){return{velocity:this.transform(ki.toVector(t)),distance:this.transform(ki.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return mrt;case!1:return 0;default:return t}},axisThreshold(t){return t?cr(cr({},KY),t):KY},keyboardDisplacement(t=brt){return t}});cr(cr({},hpe),{},{device(t,e,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!oa.touch&&oa.gesture)return"gesture";if(oa.touch&&r)return"touch";if(oa.touchscreen){if(oa.pointer)return"pointer";if(oa.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:r={}}){const i=o=>{const a=VY(q3(n,o),{min:-1/0,max:1/0});return[a.min,a.max]},s=o=>{const a=VY(q3(r,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof n!="function"&&typeof r!="function"?[i(),s()]:o=>[i(o),s(o)]},threshold(t,e,n){return this.lockDirection=n.axis==="lock",ki.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey(t){return t===void 0?"ctrlKey":t},pinchOnWheel(t=!0){return t}});cr(cr({},p0),{},{mouseOnly:(t=!0)=>t});class Srt extends fpe{constructor(...e){super(...e),cs(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();const n=this.state,r=Znt(e);n._delta=ki.sub(r,n._values),ki.addTo(n._movement,n._delta),this.computeValues(r),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}}const Ert=p0;cr(cr({},p0),{},{mouseOnly:(t=!0)=>t});const mpe=new Map,AO=new Map;function gpe(t){mpe.set(t.key,t.engine),AO.set(t.key,t.resolver)}const wrt={key:"drag",engine:crt,resolver:_rt},Crt={key:"scroll",engine:Srt,resolver:Ert};function Trt(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function Rrt(t,e){if(t==null)return{};var n=Trt(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}const Irt={target(t){if(t)return()=>"current"in t?t.current:t},enabled(t=!0){return t},window(t=oa.isBrowser?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform(t){return t}},krt=["target","eventOptions","window","enabled","transform"];function Zw(t={},e){const n={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":n[r]=i.call(n,t[r],r,t);break;case"object":n[r]=Zw(t[r],i);break;case"boolean":i&&(n[r]=t[r]);break}return n}function xrt(t,e,n={}){const r=t,{target:i,eventOptions:s,window:o,enabled:a,transform:c}=r,l=Rrt(r,krt);if(n.shared=Zw({target:i,eventOptions:s,window:o,enabled:a,transform:c},Irt),e){const d=AO.get(e);n[e]=Zw(cr({shared:n.shared},l),d)}else for(const d in l){const h=AO.get(d);h&&(n[d]=Zw(cr({shared:n.shared},l[d]),h))}return n}class vpe{constructor(e,n){cs(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=n}add(e,n,r,i,s){const o=this._listeners,a=Ynt(n,r),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},l=cr(cr({},c),s);e.addEventListener(a,i,l);const d=()=>{e.removeEventListener(a,i,l),o.delete(d)};return o.add(d),d}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class Art{constructor(){cs(this,"_timeouts",new Map)}add(e,n,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(n,r,...i))}remove(e){const n=this._timeouts.get(e);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class Prt{constructor(e){cs(this,"gestures",new Set),cs(this,"_targetEventStore",new vpe(this)),cs(this,"gestureEventStores",{}),cs(this,"gestureTimeoutStores",{}),cs(this,"handlers",{}),cs(this,"config",{}),cs(this,"pointerIds",new Set),cs(this,"touchIds",new Set),cs(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),Lrt(this,e)}setEventIds(e){if(o4(e))return this.touchIds=new Set(Qnt(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,n){this.handlers=e,this.nativeHandlers=n}applyConfig(e,n){this.config=xrt(e,n,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const n=this.config.shared,r={};let i;if(!(n.target&&(i=n.target(),!i))){if(n.enabled){for(const o of this.gestures){const a=this.config[o],c=zY(r,a.eventOptions,!!i);if(a.enabled){const l=mpe.get(o);new l(this,e,o).bind(c)}}const s=zY(r,n.eventOptions,!!i);for(const o in this.nativeHandlers)s(o,"",a=>this.nativeHandlers[o](cr(cr({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const s in r)r[s]=nrt(...r[s]);if(!i)return r;for(const s in r){const{device:o,capture:a,passive:c}=Wnt(s);this._targetEventStore.add(i,o,"",r[s],{capture:a,passive:c})}}}}function Ym(t,e){t.gestures.add(e),t.gestureEventStores[e]=new vpe(t,e),t.gestureTimeoutStores[e]=new Art}function Lrt(t,e){e.drag&&Ym(t,"drag"),e.wheel&&Ym(t,"wheel"),e.scroll&&Ym(t,"scroll"),e.move&&Ym(t,"move"),e.pinch&&Ym(t,"pinch"),e.hover&&Ym(t,"hover")}const zY=(t,e,n)=>(r,i,s,o={},a=!1)=>{var c,l;const d=(c=o.capture)!==null&&c!==void 0?c:e.capture,h=(l=o.passive)!==null&&l!==void 0?l:e.passive;let m=a?r:Knt(r,i,d);n&&h&&(m+="Passive"),t[m]=t[m]||[],t[m].push(s)};function ype(t,e={},n,r){const i=Ce.useMemo(()=>new Prt(t),[]);if(i.applyHandlers(t,r),i.applyConfig(e,n),Ce.useEffect(i.effect.bind(i)),Ce.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function Ort(t,e){return gpe(wrt),ype({drag:t},e||{},"drag")}function Mrt(t,e){return gpe(Crt),ype({scroll:t},e||{},"scroll")}const Drt="_grid_19qx5_8",Nrt="_slot_19qx5_12",f5={grid:Drt,slot:Nrt},Urt="_tile_lwkx2_8",jrt="_draggable_lwkx2_8",WY={tile:Urt,draggable:jrt},bpe=_.memo(({id:t,onDrag:e,targetWidth:n,targetHeight:r,model:i,Tile:s,opacity:o,scale:a,zIndex:c,x:l,y:d,width:h,height:m})=>{const g=_.useRef(null);return Ort(y=>e?.current(t,y),{target:g,filterTaps:!0}),E.jsx(s,{ref:g,className:Oe(WY.tile,{[WY.draggable]:e}),style:{opacity:o,scale:a,zIndex:c,x:l,y:d,width:h,height:m},targetWidth:n,targetHeight:r,model:i})});bpe.displayName="TileWrapper";const Frt=bpe,$rt=()=>YT("(prefers-reduced-motion)");function _pe(t,e){if(!(t.offsetParent instanceof HTMLElement)||t.offsetParent===e)return{x:t.offsetLeft,y:t.offsetTop};{const n=_pe(t.offsetParent,e);return n.x+=t.offsetLeft,n.y+=t.offsetTop,n}}const Spe=_.createContext(null);function Epe(){const t=_.use(Spe);if(t===null)throw new Error("useUpdateLayout called outside a Grid layout context");return t}function al(){const{setGeneration:t}=Epe();_.useEffect(()=>t(e=>e===null?0:e+1))}function DD(t){const{setVisibleTilesCallback:e}=Epe();_.useEffect(()=>e(()=>t),[t,e]),_.useEffect(()=>()=>e(null),[e])}function YY({model:t,Layout:e,Tile:n,className:r,style:i}){const[s,o]=Zy(),[a,c]=_.useState(null),l=oS(s,c),d=_.useSyncExternalStore(_.useCallback(G=>(window.addEventListener("resize",G),()=>window.removeEventListener("resize",G)),[]),_.useCallback(()=>window.innerHeight,[])),[h,m]=_.useState(null),[g,y]=_.useState(null),[v,w]=_.useState(null),S=ic(()=>new Map),R=$rt(),x=_.useMemo(()=>function({id:F,model:q,onDrag:z,style:W,className:V,...X}){const ne=_.useRef(null);return _.useEffect(()=>(S.set(F,{id:F,model:q,onDrag:z}),()=>void S.delete(F)),[F,q,z]),E.jsx("div",{ref:ne,className:Oe(V,f5.slot),"data-id":F,style:W,...X})},[S]),T=_.useMemo(()=>_.memo(function({ref:F,Layout:q,...z}){return E.jsx(q,{...z,ref:F})}),[]),I=_.useMemo(()=>({setGeneration:y,setVisibleTilesCallback:w}),[w]),k=_.useMemo(()=>{const G=[];if(a!==null&&h!==null){const F=h.getElementsByClassName(f5.slot);for(const q of F){const z=q.getAttribute("data-id");q.offsetWidth>0&&q.offsetHeight>0&&G.push({...S.get(z),..._pe(q,a),width:q.offsetWidth,height:q.offsetHeight})}}return G},[a,h,S,o,g]),A=_.useMemo(()=>Math.min(o.bottom,d)-o.top,[o,d]);_.useEffect(()=>{v?.(k.filter(G=>G.y+G.height<=A).length)},[k,v,A]);const O=_.useRef(null),[D,N]=att(k,()=>({key:({id:G})=>G,from:({x:G,y:F,width:q,height:z})=>({opacity:0,scale:0,zIndex:1,x:G,y:F,width:q,height:z,immediate:R}),enter:{opacity:1,scale:1,immediate:R},update:({id:G,x:F,y:q,width:z,height:W})=>G===O.current?.tileId?null:{x:F,y:q,width:z,height:W,immediate:R},leave:{opacity:0,scale:0,immediate:R},config:{mass:.7,tension:252,friction:25}}));_.useEffect(()=>{N.start().forEach(G=>void G.catch(M.error))},[k,N]);const U=(G,F)=>{const{tileId:q,tileX:z,tileY:W}=O.current,V=k.find(X=>X.id===q);N.current.find(X=>X.item.id===q)?.start(G?{scale:1,zIndex:1,x:V.x,y:V.y,width:V.width,height:V.height,immediate:R||(X=>X==="zIndex"),delay:X=>X==="zIndex"?500:0}:{scale:1.1,zIndex:2,x:z,y:W,immediate:R||(X=>X==="zIndex"||X==="x"||X==="y")}).catch(M.error),G&&F({x:z,y:W,xRatio:z/(o.width-V.width),yRatio:W/(o.height-V.height)})},$=(G,{tap:F,initial:[q,z],delta:[W,V],last:X})=>{if(!F){const ne=N.current.find(ye=>ye.item.id===G),fe=S.get(ne.item.id).onDrag;if(fe!=null){if(O.current===null){const ye=ne.get();O.current={tileId:G,tileX:ye.x,tileY:ye.y,cursorX:q-o.x,cursorY:z-o.y+Y.current}}O.current.tileX+=W,O.current.tileY+=V,O.current.cursorX+=W,O.current.cursorY+=V,U(X,fe),X&&(O.current=null)}}},K=_.useRef($);K.current=$;const Y=_.useRef(0);return Mrt(({xy:[,G],delta:[,F]})=>{Y.current=G,O.current!==null&&(O.current.tileY+=F,O.current.cursorY+=F,U(!1,S.get(O.current.tileId).onDrag))},{target:a??void 0}),E.jsxs("div",{ref:l,className:Oe(r,f5.grid),style:i,children:[E.jsx(Spe,{value:I,children:E.jsx(T,{ref:m,Layout:e,model:t,Slot:x})}),D((G,{id:F,model:q,onDrag:z,width:W,height:V})=>E.jsx(Frt,{id:F,onDrag:z?K:null,targetWidth:W,targetHeight:V,model:q,Tile:n,...G},F))]})}const Brt=(t,e)=>_.createElement("svg",{width:24,height:24,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{d:"M4 14C4.55228 14 5 14.4477 5 15V19H9C9.55228 19 10 19.4477 10 20C10 20.5523 9.55228 21 9 21H3V15C3 14.4477 3.44772 14 4 14Z"}),_.createElement("path",{d:"M20 14C20.5523 14 21 14.4477 21 15V21H15C14.4477 21 14 20.5523 14 20C14 19.4477 14.4477 19 15 19H19V15C19 14.4477 19.4477 14 20 14Z"}),_.createElement("path",{d:"M9 3C9.55228 3 10 3.44772 10 4C10 4.55228 9.55228 5 9 5H5V9C5 9.55228 4.55228 10 4 10C3.44772 10 3 9.55228 3 9V3H9Z"}),_.createElement("path",{d:"M21 9C21 9.55228 20.5523 10 20 10C19.4477 10 19 9.55228 19 9V5H15C14.4477 5 14 4.55228 14 4C14 3.44772 14.4477 3 15 3H21V9Z"})),Hrt=_.forwardRef(Brt),Vrt=(t,e)=>_.createElement("svg",{width:24,height:24,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{d:"M10 20C10 20.5523 9.55228 21 9 21C8.44772 21 8 20.5523 8 20V16H4C3.44772 16 3 15.5523 3 15C3 14.4477 3.44772 14 4 14H10V20Z"}),_.createElement("path",{d:"M20 14C20.5523 14 21 14.4477 21 15C21 15.5523 20.5523 16 20 16H16V20C16 20.5523 15.5523 21 15 21C14.4477 21 14 20.5523 14 20V14H20Z"}),_.createElement("path",{d:"M9 3C9.55228 3 10 3.44772 10 4V10H4C3.44772 10 3 9.55228 3 9C3 8.44772 3.44772 8 4 8H8V4C8 3.44772 8.44772 3 9 3Z"}),_.createElement("path",{d:"M15 3C15.5523 3 16 3.44772 16 4V8H20C20.5523 8 21 8.44772 21 9C21 9.55228 20.5523 10 20 10H14V4C14 3.44772 14.4477 3 15 3Z"})),qrt=_.forwardRef(Vrt),Grt="_contents_18q5h_8",Krt="_tile_18q5h_25",zrt="_maximised_18q5h_25",Wrt="_item_18q5h_29",Yrt="_snap_18q5h_36",Xrt="_advance_18q5h_40",Jrt="_back_18q5h_76",Qrt="_next_18q5h_80",Zrt="_expand_18q5h_84",eit="_bottomRightButtons_18q5h_102",tit="_indicators_18q5h_136",nit="_show_18q5h_148",os={contents:Grt,tile:Krt,maximised:zrt,item:Wrt,snap:Yrt,advance:Xrt,back:Jrt,next:Qrt,expand:Zrt,bottomRightButtons:eit,indicators:tit,show:nit},ND=(t,e)=>{const n=_.useRef(void 0);n.current===void 0&&(n.current=t());const r=_.useRef(void 0),[,i]=_.useState(0);return(r.current===void 0||e.length!==r.current.length||e.some((s,o)=>!Object.is(s,r.current[o])))&&(n.current=t(n.current)),r.current=e,[n.current,_.useCallback(s=>{typeof s=="function"?n.current=s(n.current):n.current=s,i(o=>o+1)},[i])]},wpe=({vm:t,...e})=>{const n=Qe(t.mirror$);return E.jsx(sS,{mirror:n,...e})};wpe.displayName="SpotlightLocalUserMediaItem";const Cpe=({vm:t,...e})=>{const r={videoFit:Qe(t.cropVideo$)?"cover":"contain",...e};return t instanceof Dv?E.jsx(wpe,{vm:t,...r}):E.jsx(sS,{mirror:!1,...r})};Cpe.displayName="SpotlightUserMediaItem";const Tpe=({ref:t,vm:e,targetWidth:n,targetHeight:r,focusable:i,intersectionObserver$:s,snap:o,"aria-hidden":a})=>{const c=_.useRef(null),l=oS(c,t),d=Qe(e.displayName$),h=Qe(e.video$),m=Qe(e.videoEnabled$),g=Qe(e.unencryptedWarning$),y=Qe(e.encryptionStatus$);_.useEffect(()=>{const w=c.current;let S=null;const R=s.subscribe(x=>{S?.unobserve(w),x.observe(w),S=x});return()=>{R.unsubscribe(),S?.unobserve(w)}},[s]);const v={ref:l,"data-id":e.id,className:Oe(os.item,{[os.snap]:o}),targetWidth:n,targetHeight:r,video:h,videoEnabled:m,member:e.member,unencryptedWarning:g,displayName:d,focusable:i,encryptionStatus:y,"aria-hidden":a,localParticipant:e.local};return e instanceof Sg?E.jsx(sS,{videoFit:"contain",mirror:!1,...v}):E.jsx(Cpe,{vm:e,...v})};Tpe.displayName="SpotlightItem";const PO=({ref:t,vm:e,expanded:n,onToggleExpanded:r,targetWidth:i,targetHeight:s,showIndicators:o,focusable:a=!0,className:c,style:l})=>{const{t:d}=We(),[h,m]=Rze(null),g=oS(h,t),y=Qe(e.maximised$),v=Qe(e.media$),[w,S]=_.useState(v[0]?.id),R=Pf(v),x=Pf(w),T=v.findIndex(F=>F.id===w),I=T>0,k=T!==-1&&T<v.length-1,A=_.useCallback(()=>!!(document.body&&document.fullscreenElement),[]),O=A()?qrt:Hrt,D=_.useCallback(()=>{const F=document.body;F&&(A()?document?.exitFullscreen():F.requestFullscreen())},[A]),N=ic(()=>m.pipe(Re(F=>new IntersectionObserver(q=>{const z=q.find(W=>W.isIntersecting);z!==void 0&&S(z.target.getAttribute("data-id"))},{root:F,threshold:.5})))),[U,$]=ND(F=>F==null||F===w||v.every(q=>q.id!==F)?null:F,[w]),K=_.useCallback(()=>{const F=R.current,q=F.findIndex(z=>z.id===x.current);q>0&&$(F[q-1].id)},[x,R,$]),Y=_.useCallback(()=>{const F=R.current,q=F.findIndex(z=>z.id===x.current);q!==-1&&q!==F.length-1&&$(F[q+1].id)},[x,R,$]),G=n?xoe:Doe;return E.jsxs(Xhe.div,{ref:g,className:Oe(c,os.tile,{[os.maximised]:y}),style:l,children:[I&&E.jsx("button",{className:Oe(os.advance,os.back),"aria-label":d("common.back"),onClick:K,tabIndex:a?void 0:-1,children:E.jsx(VMe,{"aria-hidden":!0,width:24,height:24})}),E.jsx("div",{className:os.contents,children:v.map(F=>E.jsx(Tpe,{vm:F,targetWidth:i,targetHeight:s,focusable:a,intersectionObserver$:N,snap:U===null||U===F.id,"aria-hidden":(U??w)!==F.id},F.id))}),E.jsxs("div",{className:os.bottomRightButtons,children:[E.jsx("button",{className:Oe(os.expand),"aria-label":"maximise",onClick:D,tabIndex:a?void 0:-1,children:E.jsx(O,{"aria-hidden":!0,width:20,height:20})}),r&&E.jsx("button",{className:Oe(os.expand),"aria-label":d(n?"video_tile.collapse":"video_tile.expand"),onClick:r,tabIndex:a?void 0:-1,children:E.jsx(G,{"aria-hidden":!0,width:20,height:20})})]}),k&&E.jsx("button",{className:Oe(os.advance,os.next),"aria-label":d("common.next"),onClick:Y,tabIndex:a?void 0:-1,children:E.jsx(Zse,{"aria-hidden":!0,width:24,height:24})}),!n&&E.jsx("div",{className:Oe(os.indicators,{[os.show]:o&&v.length>1}),children:v.map(F=>E.jsx("div",{className:os.item,"data-visible":F.id===w},F.id))})]})};PO.displayName="SpotlightTile";const rit="_fixed_r39jt_8",iit="_scrolling_r39jt_9",sit="_slot_r39jt_21",NE={fixed:rit,scrolling:iit,slot:sit},oit={inline:"end",block:"end"},ait={inline:"end",block:"start"},XY=17/9,h5=4/3;function UD(t,e,n){const r=t<800?16:20,i=t*e,s=Math.pow(Math.sqrt(i)/8+125,2),o=Math.min(n,i/s);let a=Math.min(o,Math.round(Math.sqrt(t/e/h5*o))),c=o/a;o===n&&(c=Math.ceil(c),a=Math.ceil(n/c));let l=(t-(a+1)*r)/a,d=(e-(c-1)*r)/c;const h=l/d;return h>XY?l=d*XY:h<h5&&(d=l/h5),{tileWidth:l,tileHeight:d,gap:r,columns:a}}const cit=({minBounds$:t,spotlightAlignment$:e})=>({scrollingOnTop:!1,fixed:function({ref:r,model:i,Slot:s}){al();const o=ai(ic(()=>e.pipe(Kc((c,l)=>c.block===l.block&&c.inline===l.inline)))),a=_.useCallback(({xRatio:c,yRatio:l})=>e.next({block:l<.5?"start":"end",inline:c<.5?"start":"end"}),[]);return E.jsx("div",{ref:r,className:NE.fixed,children:i.spotlight&&E.jsx(s,{className:NE.slot,id:"spotlight",model:i.spotlight,onDrag:a,"data-block-alignment":o.block,"data-inline-alignment":o.inline})})},scrolling:function({ref:r,model:i,Slot:s}){al(),DD(i.setVisibleTiles);const{width:o,height:a}=ai(t),{gap:c,tileWidth:l,tileHeight:d}=_.useMemo(()=>UD(o,a,i.grid.length),[o,a,i.grid.length]);return E.jsx("div",{ref:r,className:NE.scrolling,style:{width:o,"--gap":`${c}px`,"--width":`${Math.floor(l)}px`,"--height":`${Math.floor(d)}px`},children:i.grid.map(h=>E.jsx(s,{className:NE.slot,id:h.id,model:h},h.id))})}}),lit="_layer_mc5gk_8",uit="_container_mc5gk_14",dit="_local_mc5gk_18",fit="_slot_mc5gk_31",UE={layer:lit,container:uit,local:dit,slot:fit},hit=({minBounds$:t,pipAlignment$:e})=>({scrollingOnTop:!1,fixed:function({ref:r}){return al(),E.jsx("div",{ref:r})},scrolling:function({ref:r,model:i,Slot:s}){al();const{width:o,height:a}=ai(t),c=Qe(e),{tileWidth:l,tileHeight:d}=_.useMemo(()=>UD(o,a,1),[o,a]),h=_.useCallback(({xRatio:m,yRatio:g})=>e.next({block:g<.5?"start":"end",inline:m<.5?"start":"end"}),[]);return E.jsx("div",{ref:r,className:UE.layer,children:E.jsx(s,{id:i.remote.id,model:i.remote,className:UE.container,style:{width:l,height:d},children:E.jsx(s,{className:Oe(UE.slot,UE.local),id:i.local.id,model:i.local,onDrag:h,"data-block-alignment":c.block,"data-inline-alignment":c.inline})})})}}),pit="_layer_1swii_8",mit="_spotlight_1swii_12",git="_pip_1swii_17",jE={layer:pit,spotlight:mit,pip:git},vit=({pipAlignment$:t})=>({scrollingOnTop:!0,fixed:function({ref:n,model:r,Slot:i}){return al(),E.jsx("div",{ref:n,className:jE.layer,children:E.jsx(i,{className:jE.spotlight,id:"spotlight",model:r.spotlight})})},scrolling:function({ref:n,model:r,Slot:i}){al();const s=Qe(t),o=_.useCallback(({xRatio:a,yRatio:c})=>t.next({block:c<.5?"start":"end",inline:a<.5?"start":"end"}),[]);return E.jsx("div",{ref:n,className:jE.layer,children:r.pip&&E.jsx(i,{className:jE.pip,id:r.pip.id,model:r.pip,onDrag:o,"data-block-alignment":s.block,"data-inline-alignment":s.inline})})}}),yit="_layer_jsvx2_8",bit="_spotlight_jsvx2_19",_it="_slot_jsvx2_28",Sit="_grid_jsvx2_34",Fl={layer:yit,spotlight:bit,slot:_it,grid:Sit},Eit=({minBounds$:t})=>({scrollingOnTop:!1,fixed:function({ref:n,model:r,Slot:i}){return al(),ai(t),E.jsxs("div",{ref:n,className:Fl.layer,children:[E.jsx("div",{className:Fl.spotlight,children:E.jsx(i,{className:Fl.slot,id:"spotlight",model:r.spotlight})}),E.jsx("div",{className:Fl.grid})]})},scrolling:function({ref:n,model:r,Slot:i}){al(),DD(r.setVisibleTiles),ai(t);const s=ai(r.spotlight.media$).length>1;return E.jsxs("div",{ref:n,className:Fl.layer,children:[E.jsx("div",{className:Oe(Fl.spotlight,{[Fl.withIndicators]:s})}),E.jsx("div",{className:Fl.grid,children:r.grid.map(o=>E.jsx(i,{className:Fl.slot,id:o.id,model:o},o.id))})]})}}),wit="_layer_1q32d_8",Cit="_spotlight_1q32d_17",Tit="_withIndicators_1q32d_26",Rit="_slot_1q32d_30",Iit="_grid_1q32d_35",Id={layer:wit,spotlight:Cit,withIndicators:Tit,slot:Rit,grid:Iit},kit=({minBounds$:t})=>({scrollingOnTop:!1,fixed:function({ref:n,model:r,Slot:i}){return al(),E.jsx("div",{ref:n,className:Id.layer,children:E.jsx("div",{className:Id.spotlight,children:E.jsx(i,{className:Id.slot,id:"spotlight",model:r.spotlight})})})},scrolling:function({ref:n,model:r,Slot:i}){al(),DD(r.setVisibleTiles);const{width:s}=ai(t),{gap:o,tileWidth:a,tileHeight:c}=UD(s,s,r.grid.length),l=Qe(r.spotlight.media$).length>1;return E.jsxs("div",{ref:n,className:Id.layer,style:{"--grid-gap":`${o}px`,"--grid-tile-width":`${Math.floor(a)}px`,"--grid-tile-height":`${Math.floor(c)}px`},children:[E.jsx("div",{className:Oe(Id.spotlight,{[Id.withIndicators]:l})}),E.jsx("div",{className:Id.grid,children:r.grid.map(d=>E.jsx(i,{className:Id.slot,id:d.id,model:d},d.id))})]})}});async function Rpe(t,e,n,r,i=0,s){const o=t.createGain();o.gain.setValueAtTime(n,0);const a=t.createStereoPanner();a.pan.setValueAtTime(r,0);const c=t.createBufferSource();c.buffer=e,s?.signal.addEventListener("abort",()=>{c.disconnect()});const l=new Promise(d=>c.addEventListener("ended",()=>d()));return c.connect(o).connect(a).connect(t.destination),Zle(),c.start(t.currentTime+i),l}function xit(t,e,n,r,i){if(i===0)throw Error("Looping sounds must have a delay");let s,o,a;return(async()=>{a=new AbortController,s=Promise.resolve();do o=Rpe(t,e,n,r,i,a),await s,s=o;while(!a.signal.aborted)})(),async()=>{a?.abort(),await s,await o}}function a4(t){const[e]=Gn(Lle),[n,r]=_.useState(),[i,s]=_.useState();_.useEffect(()=>{const d=t.sounds;if(!d)return;const h=new AudioContext({latencyHint:t.latencyHint});return(async()=>{const m={};for(const[g,y]of Object.entries(await d)){const v=await h.decodeAudioData(y.slice(0));m[g]=v}s(m)})().catch(m=>{M.debug("Failed to setup audio context",m)}),r(h),()=>{h.close().catch(m=>{M.debug("Failed to close audio engine",m)}),r(void 0)}},[t.sounds,t.latencyHint]);const o=ai(Wu().audioOutput.selected$)?.id,{controlledAudioDevices:a}=no();_.useEffect(()=>{n&&"setSinkId"in n&&!a&&n.setSinkId(o).catch(d=>{M.warn("Unable to change sink for audio context",d)})},[n,o,a]);const{pan:c,volume:l}=iue();return!n||!i||t.muted?null:{playSound:async d=>{if(!i[d]){M.debug(`Tried to play a sound that wasn't buffered (${d})`);return}return Rpe(n,i[d],e*l,c)},playSoundLooping:(d,h)=>{if(!i[d])throw Error(`Tried to play a sound that wasn't buffered (${d})`);return xit(n,i[d],e*l,c,h)},soundDuration:Object.fromEntries(Object.entries(i).map(([d,h])=>[d,h.duration]))}}function Ait(){return document.createElement("audio").canPlayType("audio/ogg")==="maybe"?"ogg":"mp3"}const Pit=Ait();async function jD(t){const e={};return await Promise.all(Object.entries(t).map(async([n,r])=>{const{mp3:i,ogg:s}=r,o=await fetch(Pit==="ogg"?s:i??s);if(p8(o)){M.warn(`Could not load sound ${n}, response was not okay`);return}e[n]=await o.arrayBuffer()})),e}const JY=Object.fromEntries([...qb.filter(t=>t.sound!==void 0).map(t=>[t.name,t.sound]),[UL.name,UL.sound]]);function Lit({vm:t,muted:e}){const[n]=Gn(H8),[r,i]=_.useState(null),s=a4({sounds:r,latencyHint:"interactive",muted:e}),o=Pf(s);return _.useEffect(()=>{!n||r||i(jD(JY))},[r,n]),_.useEffect(()=>{const a=t.audibleReactions$.subscribe(c=>{for(const l of c)JY[l]?o.current?.playSound(l):o.current?.playSound("generic")});return()=>{a.unsubscribe()}},[t,o]),null}const Oit="_container_1ux8r_1",Mit="_reaction_1ux8r_12",QY={container:Oit,reaction:Mit};function Dit({vm:t}){const e=Qe(t.visibleReactions$);return E.jsx("div",{className:QY.container,children:e.map(({sender:n,emoji:r,startX:i})=>E.jsx("span",{role:"presentation",style:{left:`${i}vw`},className:QY.reaction,children:r},n))})}const Nit=""+new URL("join_call-dEJCP2wD.mp3",import.meta.url).href,Uit=""+new URL("join_call-DlMV9nHk.ogg",import.meta.url).href,jit=""+new URL("left_call-BbqmRgnC.mp3",import.meta.url).href,Fit=""+new URL("left_call-C7NMl6WI.ogg",import.meta.url).href,$it=""+new URL("raise_hand-CUbxEnt9.ogg",import.meta.url).href,Bit=""+new URL("raise_hand-Bzqn65WB.mp3",import.meta.url).href,Hit=""+new URL("screen_share_started-IZDL-kAw.ogg",import.meta.url).href,Vit=""+new URL("screen_share_started-DH3qxml5.mp3",import.meta.url).href,qit=""+new URL("call_declined-1jWRbd4p.mp3",import.meta.url).href,Git=""+new URL("call_declined-C6gHsCGH.ogg",import.meta.url).href,Kit=""+new URL("call_timeout-BCxXxRD8.mp3",import.meta.url).href,zit=""+new URL("call_timeout-DPKAj6sz.ogg",import.meta.url).href,Ipe=jD({join:{mp3:Nit,ogg:Uit},left:{mp3:jit,ogg:Fit},raiseHand:{mp3:Bit,ogg:$it},screenshareStarted:{mp3:Vit,ogg:Hit},decline:{mp3:qit,ogg:Git},timeout:{mp3:Kit,ogg:zit}});function Wit({vm:t,muted:e}){const n=a4({sounds:Ipe,latencyHint:"interactive",muted:e}),r=Pf(n);return _.useEffect(()=>{const i=t.joinSoundEffect$.subscribe(()=>void r.current?.playSound("join")),s=t.leaveSoundEffect$.subscribe(()=>void r.current?.playSound("left")),o=t.newHandRaised$.subscribe(()=>void r.current?.playSound("raiseHand")),a=t.newScreenShare$.subscribe(()=>void r.current?.playSound("screenshareStarted"));return()=>{i.unsubscribe(),s.unsubscribe(),o.unsubscribe(),a.unsubscribe()}},[r,t]),E.jsx(E.Fragment,{})}const ZY=3e3;class Yit{constructor(e){this.rtcSession=e,this.raisedHandsSubject$=new _s({}),this.reactionsSubject$=new _s({}),this.raisedHands$=this.raisedHandsSubject$.asObservable(),this.reactions$=this.reactionsSubject$.asObservable(),this.onMembershipsChanged=n=>{for(const r of Object.keys(this.raisedHandsSubject$.value).filter(i=>n.find(s=>s.sender==i)))this.removeRaisedHand(r);for(const r of this.rtcSession.memberships){if(!r.sender||!r.eventId)continue;const i=`${r.sender}:${r.deviceId}`;this.raisedHandsSubject$.value[i]&&this.raisedHandsSubject$.value[i].membershipEventId!==r.eventId&&this.removeRaisedHand(i);const s=this.getLastReactionEvent(r.eventId,r.sender);if(s){const o=s?.getId();if(!o)continue;this.addRaisedHand(`${r.sender}:${r.deviceId}`,{membershipEventId:r.eventId,reactionEventId:o,time:new Date(s.localTimestamp)})}}},this.handleReactionEvent=n=>{const r=this.rtcSession.room;if(n.getRoomId()!==r.roomId||n.isSending())return;const i=n.getSender(),s=n.getId();if(!(!i||!s)&&(r.client.decryptEventIfNeeded(n).catch(o=>M.warn(`Failed to decrypt ${n.getId()}`,o)),!(n.isBeingDecrypted()||n.isDecryptionFailure()))){if(n.getType()===O8){const o=n.getContent(),a=o?.["m.relates_to"]?.event_id,c=this.rtcSession.memberships.find(y=>y.eventId===a&&y.sender===i);if(!c){M.warn(`Reaction target was not a membership event for ${i}, ignoring`);return}const l=`${c.sender}:${c.deviceId}`;if(!o.emoji){M.warn(`Reaction had no emoji from ${s}`);return}const h=new Intl.Segmenter(void 0,{granularity:"grapheme"}).segment(o.emoji)[Symbol.iterator]().next().value?.segment;if(!h?.trim()){M.warn(`Reaction had no emoji from ${s} after splitting`);return}const m={...UL,emoji:h,...qb.find(y=>y.name===o.name)},g=this.reactionsSubject$.value;if(g[l]){M.warn(`Got reaction from ${l} but one is still playing`);return}this.reactionsSubject$.next({...g,[l]:{reactionOption:m,expireAfter:new Date(Date.now()+ZY)}})}else if(n.getType()===Z.Reaction){const o=n.getContent(),a=o["m.relates_to"].event_id,c=this.rtcSession.memberships.find(l=>l.eventId===a&&l.sender===i);if(!c){M.warn(`Reaction target was not a membership event for ${i}, ignoring`);return}o?.["m.relates_to"].key==="🖐️"&&this.addRaisedHand(`${c.sender}:${c.deviceId}`,{reactionEventId:s,membershipEventId:a,time:new Date(n.localTimestamp)})}else if(n.getType()===Z.RoomRedaction){const o=n.event.redacts,a=Object.entries(this.raisedHandsSubject$.value).find(([c,l])=>l.reactionEventId===o)?.[0];if(!a)return;this.removeRaisedHand(a)}}},this.reactionsSub=this.reactionsSubject$.pipe(cGe(ZY)).subscribe(n=>{const r=new Date,i=Object.fromEntries(Object.entries(n).filter(([s,o])=>o.expireAfter>r));Object.keys(n).length!==Object.keys(i).length&&this.reactionsSubject$.next(i)}),this.rtcSession.room.on(ke.Timeline,this.handleReactionEvent),this.rtcSession.room.on(ke.Redaction,this.handleReactionEvent),this.rtcSession.room.client.on(Kt.Decrypted,this.handleReactionEvent),this.rtcSession.room.on(ke.LocalEchoUpdated,this.handleReactionEvent),e.on(ei.MembershipsChanged,this.onMembershipsChanged),this.onMembershipsChanged([])}getLastReactionEvent(e,n){return(this.rtcSession.room.relations.getChildEventsForEvent(e,vn.Annotation,Z.Reaction)?.getRelations()??[]).find(s=>s.event.sender===n&&s.getType()===Z.Reaction&&s.getContent()?.["m.relates_to"]?.key==="🖐️")}addRaisedHand(e,n){this.raisedHandsSubject$.next({...this.raisedHandsSubject$.value,[e]:n})}removeRaisedHand(e){this.raisedHandsSubject$.next(Object.fromEntries(Object.entries(this.raisedHandsSubject$.value).filter(([n])=>n!==e)))}destroy(){this.rtcSession.off(ei.MembershipsChanged,this.onMembershipsChanged),this.rtcSession.room.off(ke.Timeline,this.handleReactionEvent),this.rtcSession.room.off(ke.Redaction,this.handleReactionEvent),this.rtcSession.room.client.off(Kt.Decrypted,this.handleReactionEvent),this.rtcSession.room.off(ke.LocalEchoUpdated,this.handleReactionEvent),this.reactionsSub.unsubscribe()}}function Xit({members:t,muted:e}){const n=_.useMemo(()=>new Set(t?.map(m=>`${m.sender}:${m.deviceId}`)),[t]),r=_.useRef(new Set),i=(m,g)=>{r.current.has(m)||(M.warn(`[MatrixAudioRenderer] Audio track ${m} has no matching matrix call member`,`current members: ${Array.from(g.values())}`,"track will not get rendered"),r.current.add(m))},s=LQe([he.Source.Microphone,he.Source.ScreenShareAudio,he.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(m=>{const g=n?.has(m.participant.identity);return!g&&!m.participant.isLocal&&i(m.participant.identity,n),!m.participant.isLocal&&m.publication.kind===he.Kind.Audio&&g});_.useEffect(()=>{s.some(m=>!n.has(m.participant.identity))||(M.debug("[MatrixAudioRenderer] All audio tracks have a matching matrix call member identity."),r.current.clear())},[s,n]);const{pan:o,volume:a}=iue(),c=o!==0,[l,d]=_.useState(void 0);_.useEffect(()=>{const m=new AudioContext;return d(m),()=>{m.close()}},[]);const h=_.useMemo(()=>({gain:l?.createGain(),pan:l?.createStereoPanner()}),[l]);return _.useEffect(()=>{h.pan&&(h.pan.pan.value=o)},[h.pan,o]),_.useEffect(()=>{h.gain&&(h.gain.gain.value=a)},[h.gain,a]),E.jsx("div",{style:{display:"none"},children:s.map(m=>E.jsx(Jit,{trackRef:m,muted:e,audioContext:c?l:void 0,audioNodes:h},oze(m)))})}function Jit({trackRef:t,muted:e,audioContext:n,audioNodes:r,...i}){const[s,o]=ND(()=>!1,[n&&r]);return _.useEffect(()=>{if(!t||s)return;const a=t.publication.track,c=n&&r.gain&&r.pan;a.setAudioContext(c?n:void 0),a.setWebAudioPlugins(c?[r.gain,r.pan]:[]),o(!0),Zle()},[n,r,o,s,t]),s&&E.jsx(HQe,{trackRef:t,muted:e,...i})}const kpe=XZe.behavior(Xt([VL.pipe(dn(!0)),Mle.value$],(t,e)=>!t||e)),Qit="_overlay_5vxkn_1",Zit="_icon_5vxkn_49",est="_spacer_5vxkn_64",p5={overlay:Qit,icon:Zit,spacer:est},tst=({show:t,onBackToVideoPressed:e})=>{const{t:n}=We();return E.jsxs("div",{className:p5.overlay,"data-show":t,"aria-hidden":!t,children:[E.jsx(moe,{className:p5.icon,children:E.jsx(j8e,{"aria-hidden":!0})}),E.jsx(gl,{as:"h2",weight:"semibold",size:"md",children:n("handset.overlay_title")}),E.jsx(an,{children:n("handset.overlay_description")}),E.jsx(Bt,{kind:"primary",size:"sm",onClick:()=>{e?.()},children:n("handset.overlay_back_button")}),E.jsx("div",{className:p5.spacer})]})},nst="_bar_32sbm_1",rst={bar:nst},c4=_.createContext(null),ist=({children:t})=>{const{t:e}=We(),n=_.useCallback(d=>{d.preventDefault(),window.controls.onBackButtonPressed?.()},[]),[r,i]=_.useState(""),[s,o]=_.useState(!1),[a,c]=_.useState(null),l=_.useMemo(()=>({setTitle:i,setSecondaryButton:c,setHidden:o}),[i,o,c]);return E.jsxs(E.Fragment,{children:[E.jsx("div",{style:{display:s?"none":"block"},className:rst.bar,children:E.jsxs(qu,{disconnectedBanner:!1,children:[E.jsx(jf,{children:E.jsx(qi,{label:e("common.back"),children:E.jsx(UT,{onClick:n,children:E.jsx(xoe,{})})})}),r&&E.jsx(gl,{type:"body",size:"lg",weight:va==="android"?"medium":"semibold",children:r}),E.jsx(Ff,{children:a})]})}),E.jsx(c4,{value:l,children:t})]})};function sst(t){const e=_.use(c4)?.setTitle;_.useEffect(()=>{if(e!==void 0)return e(t),()=>e("")},[t,e])}function ost(t){const e=_.use(c4)?.setHidden;_.useEffect(()=>{if(e!==void 0)return e(t),()=>e(!1)},[e,t])}function ast(t){const e=_.use(c4)?.setSecondaryButton;_.useEffect(()=>{if(e!==void 0)return e(t),()=>e("")},[t,e])}const cst="_toast_z5w27_8",lst={toast:cst},xpe=({open:t,onDismiss:e,autoDismiss:n,children:r,Icon:i,modal:s=!0})=>{const o=_.useCallback(c=>{c||e()},[e]);_.useEffect(()=>{if(t&&n!==void 0){const c=setTimeout(e,n);return()=>clearTimeout(c)}},[t,n,e]);const a=E.jsxs(E.Fragment,{children:[E.jsx(NM,{className:Oe(Bs.bg,Bs.animate)}),E.jsx(UM,{"aria-describedby":void 0,asChild:!0,children:E.jsxs(Pse,{className:Oe(Bs.overlay,Bs.animate,lst.toast),children:[E.jsx(jM,{asChild:!0,children:E.jsx(an,{as:"h3",size:"sm",weight:"semibold",children:r})}),i&&E.jsx(i,{width:20,height:20,"aria-hidden":!0})]})})]});return E.jsx(MM,{open:t,onOpenChange:o,modal:s,children:s?E.jsx(DM,{children:a}):a})},ust="_overlay_128zq_1",dst="_content_128zq_10",fst="_pulse_128zq_17",hst="_text_128zq_33",FE={overlay:ust,content:dst,pulse:fst,text:hst},pst=""+new URL("ringtone-B2csBdU4.mp3",import.meta.url).href,mst=""+new URL("ringtone-B-nJXbbw.ogg",import.meta.url).href,gst="getDisplayMedia"in(navigator.mediaDevices??{}),vst=400,yst=t=>{const e=Wu(),n=pnt(t.client,t.rtcSession),{livekitRoom:r,connState:i}=_nt(t.rtcSession,t.muteStates,n,t.e2eeSystem),s=Z8(h=>h.pipe(Re(([m])=>m)),[i]),[o,a]=_.useState(null);_.useEffect(()=>(M.info(`[Lifecycle] InCallView Component mounted, livekit room state ${r?.state}`),()=>{M.info(`[Lifecycle] InCallView Component unmounted, livekit room state ${r?.state}`),r?.disconnect().then(()=>{M.info(`[Lifecycle] Disconnected from livekit room, state:${r?.state}`)}).catch(h=>{M.error("[Lifecycle] Failed to disconnect from livekit room",h)})}),[r]);const{autoLeaveWhenOthersLeft:c,sendNotificationType:l,waitForCallPickup:d}=no();return _.useEffect(()=>{if(r!==void 0){const h=new Yit(t.rtcSession),m=new Fnt(t.rtcSession,t.matrixRoom,r,e,{encryptionSystem:t.e2eeSystem,autoLeaveWhenOthersLeft:c,waitForCallPickup:d&&l==="ring"},s,h.raisedHands$,h.reactions$);return a(m),()=>{m.destroy(),h.destroy()}}},[t.rtcSession,t.matrixRoom,r,e,t.e2eeSystem,s,c,l,d]),r===void 0||o===null?null:E.jsx(che,{value:r,children:E.jsx(DGe,{vm:o,rtcSession:t.rtcSession,children:E.jsx(bst,{...t,vm:o,livekitRoom:r})})})},bst=({client:t,vm:e,matrixInfo:n,rtcSession:r,matrixRoom:i,livekitRoom:s,muteStates:o,onLeave:a,header:c,onShareClick:l})=>{const{t:d}=We(),{supportsReactions:h,sendReaction:m,toggleRaisedHand:g}=K8();if(Snt(),ai(e.livekitConnectionState$)===xt.Disconnected)throw new OD;const v=_.useRef(null),[w,S]=Zy(),R=oS(v,w),{hideScreensharing:x,showControls:T}=no(),{isScreenShareEnabled:I,localParticipant:k}=PQe({room:s}),A=Qe(kpe),O=Qe(e.callPickupState$),D=ic(async()=>jD({waiting:{mp3:pst,ogg:mst}})),N=a4({sounds:D,latencyHint:"interactive",muted:A}),[U,$]=_.useState(!1);Hle(r,p_.EnabledTransportsChanged,qe=>$(qe.room));const[K]=Gn($8),[Y]=Gn(V8),G=X_(i.roomId),F=G8(r),q=_.useMemo(()=>K&&Y&&G.kind===hn.PER_PARTICIPANT&&!U,[K,Y,G.kind,U]),z=_.useCallback(()=>o.audio.setEnabled?.(qe=>!qe),[o]),W=_.useCallback(()=>o.video.setEnabled?.(qe=>!qe),[o]);VZe(v,z,W,qe=>o.audio.setEnabled?.(!qe),qe=>void m(qe),()=>void g());const V=Qe(e.participantCount$),X=Qe(e.reconnecting$),ne=Qe(e.windowMode$),fe=Qe(e.layout$),ye=Qe(e.tileStoreGeneration$),[Ae]=Gn(B8),be=Qe(e.gridMode$),_e=Qe(e.showHeader$),Ie=Qe(e.showFooter$),Ue=Qe(e.earpieceMode$),et=Qe(e.audioOutputSwitcher$);Tze(e.autoLeave$,()=>a("user"));const ln=N?.soundDuration.waiting??1;_.useEffect(()=>(window.document.body.style.setProperty("--call-ring-duration-s",`${ln*2}s`),window.document.body.style.setProperty("--call-ring-delay-s",`${ln}s`),()=>{window.document.body.style.removeProperty("--call-ring-duration-s"),window.document.body.style.removeProperty("--call-ring-delay-s")}),[N?.soundDuration,ln]),_.useEffect(()=>{O==="timeout"&&a("user","timeout"),O==="decline"&&a("user","decline")},[O,a,N]),_.useEffect(()=>{if(O!=="ringing"||!N)return;const qe=N.playSoundLooping("waiting",ln);return()=>{qe().catch(Wt=>{M.error("Failed to stop ringing sound",Wt)})}},[O,N,ln]);const Bn=_.useMemo(()=>{if(O!=="ringing")return null;const qe=[...i.getMembersWithMembership("join"),...i.getMembersWithMembership("invite")].filter(La=>La.userId!==t.getUserId());if(qe.length===0)return null;const Wt=qe.length>0?qe[0]:void 0,Dt=qe.length===1&&Wt,yn=Dt?`Waiting for ${Wt.name??Wt.userId} to join…`:"Waiting for other participants…",dr=Dt?Wt.getMxcAvatarUrl?.()??void 0:i.getMxcAvatarUrl()??void 0;return E.jsx("div",{className:Oe(Bs.bg,FE.overlay),children:E.jsxs("div",{className:Oe(Bs.content,FE.content),children:[E.jsx("div",{className:FE.pulse,children:E.jsx(Op,{id:Dt?Wt.userId:i.roomId,name:Dt?Wt.name:i.name,src:dr,size:Lp.XL})}),E.jsx(an,{size:"md",className:FE.text,children:yn})]})})},[O,t,i]),Mn=_.useRef(null),tt=_.useCallback(()=>Mn.current=Date.now(),[]),Aa=_.useCallback(()=>{const qe=Mn.current;qe!==null&&Date.now()-qe<=vst&&e.tapScreen(),Mn.current=null},[e]),bl=_.useCallback(()=>Mn.current=null,[]),Dn=_.useCallback(qe=>{Ie?(qe.stopPropagation(),e.tapControls()):qe.preventDefault()},[e,Ie]),m0=_.useCallback(qe=>{qe.pointerType==="mouse"&&e.hoverScreen()},[e]),Hp=_.useCallback(()=>e.unhoverScreen(),[e]),[Pa,Is]=_.useState(!1),[g0,Do]=_.useState(lD),v0=_.useCallback(()=>Is(!0),[Is]),Vp=_.useCallback(()=>Is(!1),[Is]),mc=_.useMemo(()=>ut===null?()=>{Do("profile"),Is(!0)}:null,[Do,Is]),[ui,di]=Zy(),[xi,Gf]=Zy(),Ju=_.useMemo(()=>({width:S.width,height:S.height-di.height-(ne==="flat"?0:Gf.height)}),[S.width,S.height,di.height,Gf.height,ne]),gc=Z8(qe=>qe.pipe(Re(([Wt])=>Wt)),[Ju]),vc=ic(()=>new _s(oit)),_l=ic(()=>new _s(ait)),ks=_.useCallback(qe=>e.setGridMode(qe),[e]);_.useEffect(()=>{ut?.api.transport.send(be==="grid"?Ri.TileLayout:Ri.SpotlightLayout,{}).catch(qe=>{M.error("Failed to send layout change to widget API",qe)})},[be]),_.useEffect(()=>{if(ut){const qe=Dt=>{ks("grid"),ut.api.transport.reply(Dt.detail,{})},Wt=Dt=>{ks("spotlight"),ut.api.transport.reply(Dt.detail,{})};return ut.lazyActions.on(Ri.TileLayout,qe),ut.lazyActions.on(Ri.SpotlightLayout,Wt),()=>{ut.lazyActions.off(Ri.TileLayout,qe),ut.lazyActions.off(Ri.SpotlightLayout,Wt)}}},[ks]),ast(_.useMemo(()=>{if(et===null)return null;const qe=et.targetOutput==="earpiece",Wt=qe?U8e:B8e,Dt=d(qe?"settings.devices.handset":"settings.devices.loudspeaker");return E.jsx(qi,{label:Dt,children:E.jsx(UT,{onClick:yn=>{yn.preventDefault(),et.switch()},children:E.jsx(Wt,{})})})},[d,et])),ost(!_e);let yc=null;if(_e)switch(c){case"none":yc=E.jsx("div",{className:Oe(gr.header,gr.filler),ref:ui});break;case"standard":yc=E.jsxs(qu,{className:gr.header,ref:ui,disconnectedBanner:!1,children:[E.jsx(jf,{children:E.jsx(vae,{id:n.roomId,name:n.roomName,avatarUrl:n.roomAvatar,encrypted:n.e2eeSystem.kind!==hn.NONE,participantCount:V})}),E.jsx(Ff,{children:T&&l!==null&&E.jsx(hhe,{className:gr.invite,onClick:l})})]})}const Sl=_.useCallback(()=>{},[]),y0=E.jsxs(E.Fragment,{children:[E.jsx("div",{className:Oe(Bs.bg,Bs.animate),"data-state":X?"open":"closed"}),E.jsx(xpe,{onDismiss:Sl,open:X,modal:!1,children:d("common.reconnecting")})]}),Je=E.jsx(tst,{show:Ue&&!X,onBackToVideoPressed:et?.switch}),Et=X||Ue,Vt=_.useMemo(()=>function({ref:Wt,className:Dt,style:yn,targetWidth:dr,targetHeight:La,model:Kf}){const l4=Qe(e.spotlightExpanded$),u4=Qe(e.toggleSpotlightExpanded$),cS=Qe(e.showSpeakingIndicators$),zf=Qe(e.showSpotlightIndicators$);return Kf instanceof ape?E.jsx(epe,{ref:Wt,vm:Kf,onOpenProfile:mc,targetWidth:dr,targetHeight:La,className:Oe(Dt,gr.tile),style:yn,showSpeakingIndicators:cS,focusable:!Et}):E.jsx(PO,{ref:Wt,vm:Kf,expanded:l4,onToggleExpanded:u4,targetWidth:dr,targetHeight:La,showIndicators:zf,focusable:!Et,className:Oe(Dt,gr.tile),style:yn})},[e,mc,Et]),wt=_.useMemo(()=>{const qe={minBounds$:gc,spotlightAlignment$:vc,pipAlignment$:_l};return{grid:cit(qe),"spotlight-landscape":Eit(qe),"spotlight-portrait":kit(qe),"spotlight-expanded":vit(qe),"one-on-one":hit(qe)}},[gc,vc,_l]),Hn=()=>{if(fe.type==="pip")return E.jsx(PO,{className:Oe(gr.tile,gr.maximised),vm:fe.spotlight,expanded:!0,onToggleExpanded:null,targetWidth:Ju.height,targetHeight:Ju.width,showIndicators:!1,focusable:!Et,"aria-hidden":Et});const qe=wt[fe.type],Wt=E.jsx(YY,{className:gr.fixedGrid,style:{insetBlockStart:di.height>0?di.bottom:S.top,height:Ju.height},model:fe,Layout:qe.fixed,Tile:Vt,"aria-hidden":Et},"fixed"),Dt=E.jsx(YY,{className:gr.scrollingGrid,model:fe,Layout:qe.scrolling,Tile:Vt,"aria-hidden":Et},"scrolling");return fe.type==="spotlight-expanded"?E.jsxs(E.Fragment,{children:[Wt,Dt]}):E.jsxs(E.Fragment,{children:[Dt,Wt]})},Gr=RGe(i.roomId),Or=_.useCallback(()=>{k.setScreenShareEnabled(!I,{audio:!0,selfBrowserSurface:"include",surfaceSwitching:"include",systemAudio:"include"}).catch(M.error)},[k,I]),Kr=[];Kr.push(E.jsx(Ule,{muted:!o.audio.enabled,onClick:z,onTouchEnd:Dn,disabled:o.audio.setEnabled===null,"data-testid":"incall_mute"},"audio"),E.jsx(jle,{muted:!o.video.enabled,onClick:W,onTouchEnd:Dn,disabled:o.video.setEnabled===null,"data-testid":"incall_videomute"},"video")),gst&&!x&&Kr.push(E.jsx(LGe,{className:gr.shareScreen,enabled:I,onClick:Or,onTouchEnd:Dn,"data-testid":"incall_screenshare"},"share_screen")),h&&Kr.push(E.jsx(gKe,{vm:e,className:gr.raiseHand,identifier:`${t.getUserId()}:${t.getDeviceId()}`,onTouchEnd:Dn},"raise_hand")),fe.type!=="pip"&&Kr.push(E.jsx($le,{onClick:v0,onTouchEnd:Dn},"settings")),Kr.push(E.jsx(Fle,{onClick:function(){a("user")},onTouchEnd:Dn,"data-testid":"incall_leave"},"end_call"));const Ai=E.jsxs("div",{ref:xi,className:Oe(gr.footer,{[gr.overlay]:ne==="flat",[gr.hidden]:!Ie||!T&&c==="none"}),children:[c!=="none"&&E.jsxs("div",{className:gr.logo,children:[E.jsx($Ze,{width:24,height:24,"aria-hidden":!0}),E.jsx(HZe,{width:80,height:11,"aria-label":"Element Call"}),Ae?`Tiles generation: ${ye}`:void 0]}),T&&E.jsx("div",{className:gr.buttons,children:Kr}),T&&E.jsx(Cnt,{className:gr.layout,layout:be,setLayout:ks,onTouchEnd:Dn})]});return E.jsxs("div",{className:gr.inRoom,ref:R,onTouchStart:tt,onTouchEnd:Aa,onTouchCancel:bl,onPointerMove:m0,onPointerOut:Hp,children:[yc,q&&E.jsx(an,{style:{height:0,zIndex:1,alignSelf:"center",margin:0},size:"sm",children:"using to Device key transport"}),E.jsx(Xit,{members:F,muted:A}),Hn(),E.jsx(Wit,{vm:e,muted:A}),E.jsx(Lit,{vm:e,muted:A}),y0,Je,E.jsx(Dit,{vm:e}),Bn,Ai,fe.type!=="pip"&&E.jsxs(E.Fragment,{children:[E.jsx(Btt,{...Gr}),E.jsx(uD,{client:t,roomId:i.roomId,open:Pa,onDismiss:Vp,tab:g0,onTabChange:Do,livekitRoom:s})]})]})},_st=8,Sst={enabled:!1,setEnabled:null};function eX(t,e,n=!1){const r=ai(t.available$),[i,s]=ND(o=>o??(r.size>0?e():void 0),[r.size]);return _.useMemo(()=>r.size===0||n?Sst:{enabled:i??!1,setEnabled:s},[r.size,i,n,s])}function Est(t){const e=Wu(),{skipLobby:n,defaultAudioEnabled:r,defaultVideoEnabled:i}=no(),s=eX(e.audioInput,()=>(r??sn.get().media_devices.enable_audio)&&tX(n,t));_.useEffect(()=>{s.enabled&&e.requestDeviceNames()},[s.enabled,e]);const o=Ize(),a=eX(e.videoInput,()=>(i??sn.get().media_devices.enable_video)&&tX(n,t),o);_.useEffect(()=>{ut?.api.transport.send(Ri.DeviceMute,{audio_enabled:s.enabled,video_enabled:a.enabled}).catch(l=>M.warn("Could not send DeviceMute action to widget",l))},[s,a]);const c=_.useCallback(l=>{const d={audio_enabled:s.enabled,video_enabled:a.enabled};l.detail.data.audio_enabled!=null&&typeof l.detail.data.audio_enabled=="boolean"&&(s.setEnabled?.(l.detail.data.audio_enabled),d.audio_enabled=l.detail.data.audio_enabled),l.detail.data.video_enabled!=null&&typeof l.detail.data.video_enabled=="boolean"&&(a.setEnabled?.(l.detail.data.video_enabled),d.video_enabled=l.detail.data.video_enabled),ut.api.transport.reply(l.detail,d)},[s,a]);return _.useEffect(()=>{if(ut)return ut.lazyActions.on(Ri.DeviceMute,c),()=>{ut?.lazyActions.off(Ri.DeviceMute,c)}},[c]),_.useMemo(()=>({audio:s,video:a}),[s,a])}function tX(t,e){return!t&&!e||!0}const wst="org.matrix.msc4143.rtc_foci";function Cst(){return{type:"livekit",focus_selection:"oldest_membership"}}async function Tst(t,e){M.log("Start building foci_preferred list: ",t.room.roomId);const n=[],r=t.getFocusInUse();r&&ZJ(r)&&(M.log("Adding livekit focus from oldest member: ",r),n.push(r));let i;const s=t.room.client.getDomain();if(s){const a=(await lt.getRawClientConfig(s))?.[wst];if(Array.isArray(a)){const c=a.filter(l=>!!l).filter(QJ).map(l=>(M.log("Adding livekit focus from well known: ",l),{...l,livekit_alias:e}));c.length>0&&(i=c[0]),n.push(...c)}}const o=sn.get().livekit?.livekit_service_url;if(o){const a={type:"livekit",livekit_service_url:o,livekit_alias:e};i=i??a,M.log("Adding livekit focus from config: ",a),n.push(a)}if(i&&await spe(t.room.client,i),n.length===0)throw new lnt(s??"");return Promise.resolve(n)}async function Rst(t,e,n=!0,r=!1){Ut.instance.eventCallEnded.cacheStartCall(new Date),Ut.instance.eventCallStarted.track(t.room.roomId);const i=t.room.roomId,{features:s,matrix_rtc_session:o}=sn.get(),a=s?.feature_use_device_session_member_events,{sendNotificationType:c,callIntent:l}=Br();if(t.joinRoomSession(await Tst(t,i),Cst(),{notificationType:c,callIntent:l,useNewMembershipManager:n,manageMediaKeys:e,...a!==void 0&&{useLegacyMemberEvents:!a},delayedLeaveEventRestartMs:o?.delayed_leave_event_restart_ms,delayedLeaveEventDelayMs:o?.delayed_leave_event_delay_ms,delayedLeaveEventRestartLocalTimeoutMs:o?.delayed_leave_event_restart_local_timeout_ms,networkErrorRetryMs:o?.network_error_retry_ms,makeKeyDelay:o?.wait_for_key_rotation_ms,membershipEventExpiryMs:o?.membership_event_expiry_ms,useExperimentalToDeviceTransport:r}),ut)try{await ut.api.transport.send(Ri.JoinCall,{})}catch(d){M.error("Failed to send join action",d)}}const Ist=async(t,e,n)=>{try{await t.api.setAlwaysOnScreen(!1)}catch(r){M.error("Failed to set call widget `alwaysOnScreen` to false",r)}await n;try{await t.api.transport.send(Ri.HangupCall,{})}catch(r){M.error("Failed to send hangup action",r)}if(e==="user"&&!Br().returnToLobby){try{await t.api.transport.send(Ri.Close,{})}catch(r){M.error("Failed to send close action",r)}t.api.transport.stop()}};async function nX(t,e,n){await t.leaveRoomSession(),ut?await Ist(ut,e,n):await n}function Ape(t,e){const n=gp(t,ke.CurrentStateUpdated,_.useCallback(()=>t.currentState,[t]));return gp(n,pt.Update,_.useCallback(()=>e(n),[e,n]))}function kst(t){return Ape(t,_.useCallback(()=>t.getMxcAvatarUrl(),[t]))}function xst(t){return gp(t,ke.Name,_.useCallback(()=>t.name,[t]))}function Ast(t){return Ape(t,_.useCallback(e=>e.getJoinRule(),[]))}var m5,rX;function Pst(){return rX||(rX=1,m5=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,n=[],r=0;r<t.rangeCount;r++)n.push(t.getRangeAt(r));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return t.removeAllRanges(),function(){t.type==="Caret"&&t.removeAllRanges(),t.rangeCount||n.forEach(function(i){t.addRange(i)}),e&&e.focus()}}),m5}var g5,iX;function Lst(){if(iX)return g5;iX=1;var t=Pst(),e={"text/plain":"Text","text/html":"Url",default:"Text"},n="Copy to clipboard: #{key}, Enter";function r(s){var o=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return s.replace(/#{\s*key\s*}/g,o)}function i(s,o){var a,c,l,d,h,m,g=!1;o||(o={}),a=o.debug||!1;try{l=t(),d=document.createRange(),h=document.getSelection(),m=document.createElement("span"),m.textContent=s,m.ariaHidden="true",m.style.all="unset",m.style.position="fixed",m.style.top=0,m.style.clip="rect(0, 0, 0, 0)",m.style.whiteSpace="pre",m.style.webkitUserSelect="text",m.style.MozUserSelect="text",m.style.msUserSelect="text",m.style.userSelect="text",m.addEventListener("copy",function(v){if(v.stopPropagation(),o.format)if(v.preventDefault(),typeof v.clipboardData>"u"){a&&console.warn("unable to use e.clipboardData"),a&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var w=e[o.format]||e.default;window.clipboardData.setData(w,s)}else v.clipboardData.clearData(),v.clipboardData.setData(o.format,s);o.onCopy&&(v.preventDefault(),o.onCopy(v.clipboardData))}),document.body.appendChild(m),d.selectNodeContents(m),h.addRange(d);var y=document.execCommand("copy");if(!y)throw new Error("copy command was unsuccessful");g=!0}catch(v){a&&console.error("unable to copy using execCommand: ",v),a&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(o.format||"text",s),o.onCopy&&o.onCopy(window.clipboardData),g=!0}catch(w){a&&console.error("unable to copy using clipboardData: ",w),a&&console.error("falling back to prompt"),c=r("message"in o?o.message:n),window.prompt(c,s)}}finally{h&&(typeof h.removeRange=="function"?h.removeRange(d):h.removeAllRanges()),m&&document.body.removeChild(m),l()}return g}return g5=i,g5}var Ost=Lst();const Mst=cl(Ost),Dst="_url_1ibuh_8",Nst="_button_1ibuh_15",Ust="_qrCode_1ibuh_19",v5={url:Dst,button:Nst,qrCode:Ust};var Xm={},y5,sX;function jst(){return sX||(sX=1,y5=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),y5}var b5={},kd={},oX;function $p(){if(oX)return kd;oX=1;let t;const e=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return kd.getSymbolSize=function(r){if(!r)throw new Error('"version" cannot be null or undefined');if(r<1||r>40)throw new Error('"version" should be in range from 1 to 40');return r*4+17},kd.getSymbolTotalCodewords=function(r){return e[r]},kd.getBCHDigit=function(n){let r=0;for(;n!==0;)r++,n>>>=1;return r},kd.setToSJISFunction=function(r){if(typeof r!="function")throw new Error('"toSJISFunc" is not a valid function.');t=r},kd.isKanjiModeEnabled=function(){return typeof t<"u"},kd.toSJIS=function(r){return t(r)},kd}var _5={},aX;function FD(){return aX||(aX=1,function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+n)}}t.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},t.from=function(r,i){if(t.isValid(r))return r;try{return e(r)}catch{return i}}}(_5)),_5}var S5,cX;function Fst(){if(cX)return S5;cX=1;function t(){this.buffer=[],this.length=0}return t.prototype={get:function(e){const n=Math.floor(e/8);return(this.buffer[n]>>>7-e%8&1)===1},put:function(e,n){for(let r=0;r<n;r++)this.putBit((e>>>n-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const n=Math.floor(this.length/8);this.buffer.length<=n&&this.buffer.push(0),e&&(this.buffer[n]|=128>>>this.length%8),this.length++}},S5=t,S5}var E5,lX;function $st(){if(lX)return E5;lX=1;function t(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return t.prototype.set=function(e,n,r,i){const s=e*this.size+n;this.data[s]=r,i&&(this.reservedBit[s]=!0)},t.prototype.get=function(e,n){return this.data[e*this.size+n]},t.prototype.xor=function(e,n,r){this.data[e*this.size+n]^=r},t.prototype.isReserved=function(e,n){return this.reservedBit[e*this.size+n]},E5=t,E5}var w5={},uX;function Bst(){return uX||(uX=1,function(t){const e=$p().getSymbolSize;t.getRowColCoords=function(r){if(r===1)return[];const i=Math.floor(r/7)+2,s=e(r),o=s===145?26:Math.ceil((s-13)/(2*i-2))*2,a=[s-7];for(let c=1;c<i-1;c++)a[c]=a[c-1]-o;return a.push(6),a.reverse()},t.getPositions=function(r){const i=[],s=t.getRowColCoords(r),o=s.length;for(let a=0;a<o;a++)for(let c=0;c<o;c++)a===0&&c===0||a===0&&c===o-1||a===o-1&&c===0||i.push([s[a],s[c]]);return i}}(w5)),w5}var C5={},dX;function Hst(){if(dX)return C5;dX=1;const t=$p().getSymbolSize,e=7;return C5.getPositions=function(r){const i=t(r);return[[0,0],[i-e,0],[0,i-e]]},C5}var T5={},fX;function Vst(){return fX||(fX=1,function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(i){return i!=null&&i!==""&&!isNaN(i)&&i>=0&&i<=7},t.from=function(i){return t.isValid(i)?parseInt(i,10):void 0},t.getPenaltyN1=function(i){const s=i.size;let o=0,a=0,c=0,l=null,d=null;for(let h=0;h<s;h++){a=c=0,l=d=null;for(let m=0;m<s;m++){let g=i.get(h,m);g===l?a++:(a>=5&&(o+=e.N1+(a-5)),l=g,a=1),g=i.get(m,h),g===d?c++:(c>=5&&(o+=e.N1+(c-5)),d=g,c=1)}a>=5&&(o+=e.N1+(a-5)),c>=5&&(o+=e.N1+(c-5))}return o},t.getPenaltyN2=function(i){const s=i.size;let o=0;for(let a=0;a<s-1;a++)for(let c=0;c<s-1;c++){const l=i.get(a,c)+i.get(a,c+1)+i.get(a+1,c)+i.get(a+1,c+1);(l===4||l===0)&&o++}return o*e.N2},t.getPenaltyN3=function(i){const s=i.size;let o=0,a=0,c=0;for(let l=0;l<s;l++){a=c=0;for(let d=0;d<s;d++)a=a<<1&2047|i.get(l,d),d>=10&&(a===1488||a===93)&&o++,c=c<<1&2047|i.get(d,l),d>=10&&(c===1488||c===93)&&o++}return o*e.N3},t.getPenaltyN4=function(i){let s=0;const o=i.data.length;for(let c=0;c<o;c++)s+=i.data[c];return Math.abs(Math.ceil(s*100/o/5)-10)*e.N4};function n(r,i,s){switch(r){case t.Patterns.PATTERN000:return(i+s)%2===0;case t.Patterns.PATTERN001:return i%2===0;case t.Patterns.PATTERN010:return s%3===0;case t.Patterns.PATTERN011:return(i+s)%3===0;case t.Patterns.PATTERN100:return(Math.floor(i/2)+Math.floor(s/3))%2===0;case t.Patterns.PATTERN101:return i*s%2+i*s%3===0;case t.Patterns.PATTERN110:return(i*s%2+i*s%3)%2===0;case t.Patterns.PATTERN111:return(i*s%3+(i+s)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}t.applyMask=function(i,s){const o=s.size;for(let a=0;a<o;a++)for(let c=0;c<o;c++)s.isReserved(c,a)||s.xor(c,a,n(i,c,a))},t.getBestMask=function(i,s){const o=Object.keys(t.Patterns).length;let a=0,c=1/0;for(let l=0;l<o;l++){s(l),t.applyMask(l,i);const d=t.getPenaltyN1(i)+t.getPenaltyN2(i)+t.getPenaltyN3(i)+t.getPenaltyN4(i);t.applyMask(l,i),d<c&&(c=d,a=l)}return a}}(T5)),T5}var $E={},hX;function Ppe(){if(hX)return $E;hX=1;const t=FD(),e=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],n=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return $E.getBlocksCount=function(i,s){switch(s){case t.L:return e[(i-1)*4+0];case t.M:return e[(i-1)*4+1];case t.Q:return e[(i-1)*4+2];case t.H:return e[(i-1)*4+3];default:return}},$E.getTotalCodewordsCount=function(i,s){switch(s){case t.L:return n[(i-1)*4+0];case t.M:return n[(i-1)*4+1];case t.Q:return n[(i-1)*4+2];case t.H:return n[(i-1)*4+3];default:return}},$E}var R5={},ly={},pX;function qst(){if(pX)return ly;pX=1;const t=new Uint8Array(512),e=new Uint8Array(256);return function(){let r=1;for(let i=0;i<255;i++)t[i]=r,e[r]=i,r<<=1,r&256&&(r^=285);for(let i=255;i<512;i++)t[i]=t[i-255]}(),ly.log=function(r){if(r<1)throw new Error("log("+r+")");return e[r]},ly.exp=function(r){return t[r]},ly.mul=function(r,i){return r===0||i===0?0:t[e[r]+e[i]]},ly}var mX;function Gst(){return mX||(mX=1,function(t){const e=qst();t.mul=function(r,i){const s=new Uint8Array(r.length+i.length-1);for(let o=0;o<r.length;o++)for(let a=0;a<i.length;a++)s[o+a]^=e.mul(r[o],i[a]);return s},t.mod=function(r,i){let s=new Uint8Array(r);for(;s.length-i.length>=0;){const o=s[0];for(let c=0;c<i.length;c++)s[c]^=e.mul(i[c],o);let a=0;for(;a<s.length&&s[a]===0;)a++;s=s.slice(a)}return s},t.generateECPolynomial=function(r){let i=new Uint8Array([1]);for(let s=0;s<r;s++)i=t.mul(i,new Uint8Array([1,e.exp(s)]));return i}}(R5)),R5}var I5,gX;function Kst(){if(gX)return I5;gX=1;const t=Gst();function e(n){this.genPoly=void 0,this.degree=n,this.degree&&this.initialize(this.degree)}return e.prototype.initialize=function(r){this.degree=r,this.genPoly=t.generateECPolynomial(this.degree)},e.prototype.encode=function(r){if(!this.genPoly)throw new Error("Encoder not initialized");const i=new Uint8Array(r.length+this.degree);i.set(r);const s=t.mod(i,this.genPoly),o=this.degree-s.length;if(o>0){const a=new Uint8Array(this.degree);return a.set(s,o),a}return s},I5=e,I5}var k5={},x5={},A5={},vX;function Lpe(){return vX||(vX=1,A5.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),A5}var Ac={},yX;function Ope(){if(yX)return Ac;yX=1;const t="[0-9]+",e="[A-Z $%*+\\-./:]+";let n="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";n=n.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+n+`)(?:.|[\r
]))+`;Ac.KANJI=new RegExp(n,"g"),Ac.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),Ac.BYTE=new RegExp(r,"g"),Ac.NUMERIC=new RegExp(t,"g"),Ac.ALPHANUMERIC=new RegExp(e,"g");const i=new RegExp("^"+n+"$"),s=new RegExp("^"+t+"$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return Ac.testKanji=function(c){return i.test(c)},Ac.testNumeric=function(c){return s.test(c)},Ac.testAlphanumeric=function(c){return o.test(c)},Ac}var bX;function Bp(){return bX||(bX=1,function(t){const e=Lpe(),n=Ope();t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(s,o){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!e.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?s.ccBits[0]:o<27?s.ccBits[1]:s.ccBits[2]},t.getBestModeForData=function(s){return n.testNumeric(s)?t.NUMERIC:n.testAlphanumeric(s)?t.ALPHANUMERIC:n.testKanji(s)?t.KANJI:t.BYTE},t.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},t.isValid=function(s){return s&&s.bit&&s.ccBits};function r(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+i)}}t.from=function(s,o){if(t.isValid(s))return s;try{return r(s)}catch{return o}}}(x5)),x5}var _X;function zst(){return _X||(_X=1,function(t){const e=$p(),n=Ppe(),r=FD(),i=Bp(),s=Lpe(),o=7973,a=e.getBCHDigit(o);function c(m,g,y){for(let v=1;v<=40;v++)if(g<=t.getCapacity(v,y,m))return v}function l(m,g){return i.getCharCountIndicator(m,g)+4}function d(m,g){let y=0;return m.forEach(function(v){const w=l(v.mode,g);y+=w+v.getBitsLength()}),y}function h(m,g){for(let y=1;y<=40;y++)if(d(m,y)<=t.getCapacity(y,g,i.MIXED))return y}t.from=function(g,y){return s.isValid(g)?parseInt(g,10):y},t.getCapacity=function(g,y,v){if(!s.isValid(g))throw new Error("Invalid QR Code version");typeof v>"u"&&(v=i.BYTE);const w=e.getSymbolTotalCodewords(g),S=n.getTotalCodewordsCount(g,y),R=(w-S)*8;if(v===i.MIXED)return R;const x=R-l(v,g);switch(v){case i.NUMERIC:return Math.floor(x/10*3);case i.ALPHANUMERIC:return Math.floor(x/11*2);case i.KANJI:return Math.floor(x/13);case i.BYTE:default:return Math.floor(x/8)}},t.getBestVersionForData=function(g,y){let v;const w=r.from(y,r.M);if(Array.isArray(g)){if(g.length>1)return h(g,w);if(g.length===0)return 1;v=g[0]}else v=g;return c(v.mode,v.getLength(),w)},t.getEncodedBits=function(g){if(!s.isValid(g)||g<7)throw new Error("Invalid QR Code version");let y=g<<12;for(;e.getBCHDigit(y)-a>=0;)y^=o<<e.getBCHDigit(y)-a;return g<<12|y}}(k5)),k5}var P5={},SX;function Wst(){if(SX)return P5;SX=1;const t=$p(),e=1335,n=21522,r=t.getBCHDigit(e);return P5.getEncodedBits=function(s,o){const a=s.bit<<3|o;let c=a<<10;for(;t.getBCHDigit(c)-r>=0;)c^=e<<t.getBCHDigit(c)-r;return(a<<10|c)^n},P5}var L5={},O5,EX;function Yst(){if(EX)return O5;EX=1;const t=Bp();function e(n){this.mode=t.NUMERIC,this.data=n.toString()}return e.getBitsLength=function(r){return 10*Math.floor(r/3)+(r%3?r%3*3+1:0)},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(r){let i,s,o;for(i=0;i+3<=this.data.length;i+=3)s=this.data.substr(i,3),o=parseInt(s,10),r.put(o,10);const a=this.data.length-i;a>0&&(s=this.data.substr(i),o=parseInt(s,10),r.put(o,a*3+1))},O5=e,O5}var M5,wX;function Xst(){if(wX)return M5;wX=1;const t=Bp(),e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function n(r){this.mode=t.ALPHANUMERIC,this.data=r}return n.getBitsLength=function(i){return 11*Math.floor(i/2)+6*(i%2)},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(i){let s;for(s=0;s+2<=this.data.length;s+=2){let o=e.indexOf(this.data[s])*45;o+=e.indexOf(this.data[s+1]),i.put(o,11)}this.data.length%2&&i.put(e.indexOf(this.data[s]),6)},M5=n,M5}var D5,CX;function Jst(){if(CX)return D5;CX=1;const t=Bp();function e(n){this.mode=t.BYTE,typeof n=="string"?this.data=new TextEncoder().encode(n):this.data=new Uint8Array(n)}return e.getBitsLength=function(r){return r*8},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(n){for(let r=0,i=this.data.length;r<i;r++)n.put(this.data[r],8)},D5=e,D5}var N5,TX;function Qst(){if(TX)return N5;TX=1;const t=Bp(),e=$p();function n(r){this.mode=t.KANJI,this.data=r}return n.getBitsLength=function(i){return i*13},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(r){let i;for(i=0;i<this.data.length;i++){let s=e.toSJIS(this.data[i]);if(s>=33088&&s<=40956)s-=33088;else if(s>=57408&&s<=60351)s-=49472;else throw new Error("Invalid SJIS character: "+this.data[i]+`
Make sure your charset is UTF-8`);s=(s>>>8&255)*192+(s&255),r.put(s,13)}},N5=n,N5}var U5={exports:{}},RX;function Zst(){return RX||(RX=1,function(t){var e={single_source_shortest_paths:function(n,r,i){var s={},o={};o[r]=0;var a=e.PriorityQueue.make();a.push(r,0);for(var c,l,d,h,m,g,y,v,w;!a.empty();){c=a.pop(),l=c.value,h=c.cost,m=n[l]||{};for(d in m)m.hasOwnProperty(d)&&(g=m[d],y=h+g,v=o[d],w=typeof o[d]>"u",(w||v>y)&&(o[d]=y,a.push(d,y),s[d]=l))}if(typeof i<"u"&&typeof o[i]>"u"){var S=["Could not find a path from ",r," to ",i,"."].join("");throw new Error(S)}return s},extract_shortest_path_from_predecessor_list:function(n,r){for(var i=[],s=r;s;)i.push(s),n[s],s=n[s];return i.reverse(),i},find_path:function(n,r,i){var s=e.single_source_shortest_paths(n,r,i);return e.extract_shortest_path_from_predecessor_list(s,i)},PriorityQueue:{make:function(n){var r=e.PriorityQueue,i={},s;n=n||{};for(s in r)r.hasOwnProperty(s)&&(i[s]=r[s]);return i.queue=[],i.sorter=n.sorter||r.default_sorter,i},default_sorter:function(n,r){return n.cost-r.cost},push:function(n,r){var i={value:n,cost:r};this.queue.push(i),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e}(U5)),U5.exports}var IX;function eot(){return IX||(IX=1,function(t){const e=Bp(),n=Yst(),r=Xst(),i=Jst(),s=Qst(),o=Ope(),a=$p(),c=Zst();function l(S){return unescape(encodeURIComponent(S)).length}function d(S,R,x){const T=[];let I;for(;(I=S.exec(x))!==null;)T.push({data:I[0],index:I.index,mode:R,length:I[0].length});return T}function h(S){const R=d(o.NUMERIC,e.NUMERIC,S),x=d(o.ALPHANUMERIC,e.ALPHANUMERIC,S);let T,I;return a.isKanjiModeEnabled()?(T=d(o.BYTE,e.BYTE,S),I=d(o.KANJI,e.KANJI,S)):(T=d(o.BYTE_KANJI,e.BYTE,S),I=[]),R.concat(x,T,I).sort(function(A,O){return A.index-O.index}).map(function(A){return{data:A.data,mode:A.mode,length:A.length}})}function m(S,R){switch(R){case e.NUMERIC:return n.getBitsLength(S);case e.ALPHANUMERIC:return r.getBitsLength(S);case e.KANJI:return s.getBitsLength(S);case e.BYTE:return i.getBitsLength(S)}}function g(S){return S.reduce(function(R,x){const T=R.length-1>=0?R[R.length-1]:null;return T&&T.mode===x.mode?(R[R.length-1].data+=x.data,R):(R.push(x),R)},[])}function y(S){const R=[];for(let x=0;x<S.length;x++){const T=S[x];switch(T.mode){case e.NUMERIC:R.push([T,{data:T.data,mode:e.ALPHANUMERIC,length:T.length},{data:T.data,mode:e.BYTE,length:T.length}]);break;case e.ALPHANUMERIC:R.push([T,{data:T.data,mode:e.BYTE,length:T.length}]);break;case e.KANJI:R.push([T,{data:T.data,mode:e.BYTE,length:l(T.data)}]);break;case e.BYTE:R.push([{data:T.data,mode:e.BYTE,length:l(T.data)}])}}return R}function v(S,R){const x={},T={start:{}};let I=["start"];for(let k=0;k<S.length;k++){const A=S[k],O=[];for(let D=0;D<A.length;D++){const N=A[D],U=""+k+D;O.push(U),x[U]={node:N,lastCount:0},T[U]={};for(let $=0;$<I.length;$++){const K=I[$];x[K]&&x[K].node.mode===N.mode?(T[K][U]=m(x[K].lastCount+N.length,N.mode)-m(x[K].lastCount,N.mode),x[K].lastCount+=N.length):(x[K]&&(x[K].lastCount=N.length),T[K][U]=m(N.length,N.mode)+4+e.getCharCountIndicator(N.mode,R))}}I=O}for(let k=0;k<I.length;k++)T[I[k]].end=0;return{map:T,table:x}}function w(S,R){let x;const T=e.getBestModeForData(S);if(x=e.from(R,T),x!==e.BYTE&&x.bit<T.bit)throw new Error('"'+S+'" cannot be encoded with mode '+e.toString(x)+`.
 Suggested mode is: `+e.toString(T));switch(x===e.KANJI&&!a.isKanjiModeEnabled()&&(x=e.BYTE),x){case e.NUMERIC:return new n(S);case e.ALPHANUMERIC:return new r(S);case e.KANJI:return new s(S);case e.BYTE:return new i(S)}}t.fromArray=function(R){return R.reduce(function(x,T){return typeof T=="string"?x.push(w(T,null)):T.data&&x.push(w(T.data,T.mode)),x},[])},t.fromString=function(R,x){const T=h(R,a.isKanjiModeEnabled()),I=y(T),k=v(I,x),A=c.find_path(k.map,"start","end"),O=[];for(let D=1;D<A.length-1;D++)O.push(k.table[A[D]].node);return t.fromArray(g(O))},t.rawSplit=function(R){return t.fromArray(h(R,a.isKanjiModeEnabled()))}}(L5)),L5}var kX;function tot(){if(kX)return b5;kX=1;const t=$p(),e=FD(),n=Fst(),r=$st(),i=Bst(),s=Hst(),o=Vst(),a=Ppe(),c=Kst(),l=zst(),d=Wst(),h=Bp(),m=eot();function g(k,A){const O=k.size,D=s.getPositions(A);for(let N=0;N<D.length;N++){const U=D[N][0],$=D[N][1];for(let K=-1;K<=7;K++)if(!(U+K<=-1||O<=U+K))for(let Y=-1;Y<=7;Y++)$+Y<=-1||O<=$+Y||(K>=0&&K<=6&&(Y===0||Y===6)||Y>=0&&Y<=6&&(K===0||K===6)||K>=2&&K<=4&&Y>=2&&Y<=4?k.set(U+K,$+Y,!0,!0):k.set(U+K,$+Y,!1,!0))}}function y(k){const A=k.size;for(let O=8;O<A-8;O++){const D=O%2===0;k.set(O,6,D,!0),k.set(6,O,D,!0)}}function v(k,A){const O=i.getPositions(A);for(let D=0;D<O.length;D++){const N=O[D][0],U=O[D][1];for(let $=-2;$<=2;$++)for(let K=-2;K<=2;K++)$===-2||$===2||K===-2||K===2||$===0&&K===0?k.set(N+$,U+K,!0,!0):k.set(N+$,U+K,!1,!0)}}function w(k,A){const O=k.size,D=l.getEncodedBits(A);let N,U,$;for(let K=0;K<18;K++)N=Math.floor(K/3),U=K%3+O-8-3,$=(D>>K&1)===1,k.set(N,U,$,!0),k.set(U,N,$,!0)}function S(k,A,O){const D=k.size,N=d.getEncodedBits(A,O);let U,$;for(U=0;U<15;U++)$=(N>>U&1)===1,U<6?k.set(U,8,$,!0):U<8?k.set(U+1,8,$,!0):k.set(D-15+U,8,$,!0),U<8?k.set(8,D-U-1,$,!0):U<9?k.set(8,15-U-1+1,$,!0):k.set(8,15-U-1,$,!0);k.set(D-8,8,1,!0)}function R(k,A){const O=k.size;let D=-1,N=O-1,U=7,$=0;for(let K=O-1;K>0;K-=2)for(K===6&&K--;;){for(let Y=0;Y<2;Y++)if(!k.isReserved(N,K-Y)){let G=!1;$<A.length&&(G=(A[$]>>>U&1)===1),k.set(N,K-Y,G),U--,U===-1&&($++,U=7)}if(N+=D,N<0||O<=N){N-=D,D=-D;break}}}function x(k,A,O){const D=new n;O.forEach(function(Y){D.put(Y.mode.bit,4),D.put(Y.getLength(),h.getCharCountIndicator(Y.mode,k)),Y.write(D)});const N=t.getSymbolTotalCodewords(k),U=a.getTotalCodewordsCount(k,A),$=(N-U)*8;for(D.getLengthInBits()+4<=$&&D.put(0,4);D.getLengthInBits()%8!==0;)D.putBit(0);const K=($-D.getLengthInBits())/8;for(let Y=0;Y<K;Y++)D.put(Y%2?17:236,8);return T(D,k,A)}function T(k,A,O){const D=t.getSymbolTotalCodewords(A),N=a.getTotalCodewordsCount(A,O),U=D-N,$=a.getBlocksCount(A,O),K=D%$,Y=$-K,G=Math.floor(D/$),F=Math.floor(U/$),q=F+1,z=G-F,W=new c(z);let V=0;const X=new Array($),ne=new Array($);let fe=0;const ye=new Uint8Array(k.buffer);for(let Ue=0;Ue<$;Ue++){const et=Ue<Y?F:q;X[Ue]=ye.slice(V,V+et),ne[Ue]=W.encode(X[Ue]),V+=et,fe=Math.max(fe,et)}const Ae=new Uint8Array(D);let be=0,_e,Ie;for(_e=0;_e<fe;_e++)for(Ie=0;Ie<$;Ie++)_e<X[Ie].length&&(Ae[be++]=X[Ie][_e]);for(_e=0;_e<z;_e++)for(Ie=0;Ie<$;Ie++)Ae[be++]=ne[Ie][_e];return Ae}function I(k,A,O,D){let N;if(Array.isArray(k))N=m.fromArray(k);else if(typeof k=="string"){let G=A;if(!G){const F=m.rawSplit(k);G=l.getBestVersionForData(F,O)}N=m.fromString(k,G||40)}else throw new Error("Invalid data");const U=l.getBestVersionForData(N,O);if(!U)throw new Error("The amount of data is too big to be stored in a QR Code");if(!A)A=U;else if(A<U)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+U+`.
`);const $=x(A,O,N),K=t.getSymbolSize(A),Y=new r(K);return g(Y,A),y(Y),v(Y,A),S(Y,O,0),A>=7&&w(Y,A),R(Y,$),isNaN(D)&&(D=o.getBestMask(Y,S.bind(null,Y,O))),o.applyMask(D,Y),S(Y,O,D),{modules:Y,version:A,errorCorrectionLevel:O,maskPattern:D,segments:N}}return b5.create=function(A,O){if(typeof A>"u"||A==="")throw new Error("No input text");let D=e.M,N,U;return typeof O<"u"&&(D=e.from(O.errorCorrectionLevel,e.M),N=l.from(O.version),U=o.from(O.maskPattern),O.toSJISFunc&&t.setToSJISFunction(O.toSJISFunc)),I(A,N,D,U)},b5}var j5={},F5={},xX;function Mpe(){return xX||(xX=1,function(t){function e(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let r=n.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+n);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(s){return[s,s]}))),r.length===6&&r.push("F","F");const i=parseInt(r.join(""),16);return{r:i>>24&255,g:i>>16&255,b:i>>8&255,a:i&255,hex:"#"+r.slice(0,6).join("")}}t.getOptions=function(r){r||(r={}),r.color||(r.color={});const i=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,s=r.width&&r.width>=21?r.width:void 0,o=r.scale||4;return{width:s,scale:s?4:o,margin:i,color:{dark:e(r.color.dark||"#000000ff"),light:e(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},t.getScale=function(r,i){return i.width&&i.width>=r+i.margin*2?i.width/(r+i.margin*2):i.scale},t.getImageWidth=function(r,i){const s=t.getScale(r,i);return Math.floor((r+i.margin*2)*s)},t.qrToImageData=function(r,i,s){const o=i.modules.size,a=i.modules.data,c=t.getScale(o,s),l=Math.floor((o+s.margin*2)*c),d=s.margin*c,h=[s.color.light,s.color.dark];for(let m=0;m<l;m++)for(let g=0;g<l;g++){let y=(m*l+g)*4,v=s.color.light;if(m>=d&&g>=d&&m<l-d&&g<l-d){const w=Math.floor((m-d)/c),S=Math.floor((g-d)/c);v=h[a[w*o+S]?1:0]}r[y++]=v.r,r[y++]=v.g,r[y++]=v.b,r[y]=v.a}}}(F5)),F5}var AX;function not(){return AX||(AX=1,function(t){const e=Mpe();function n(i,s,o){i.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=o,s.width=o,s.style.height=o+"px",s.style.width=o+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(s,o,a){let c=a,l=o;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),o||(l=r()),c=e.getOptions(c);const d=e.getImageWidth(s.modules.size,c),h=l.getContext("2d"),m=h.createImageData(d,d);return e.qrToImageData(m.data,s,c),n(h,l,d),h.putImageData(m,0,0),l},t.renderToDataURL=function(s,o,a){let c=a;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),c||(c={});const l=t.render(s,o,c),d=c.type||"image/png",h=c.rendererOpts||{};return l.toDataURL(d,h.quality)}}(j5)),j5}var $5={},PX;function rot(){if(PX)return $5;PX=1;const t=Mpe();function e(i,s){const o=i.a/255,a=s+'="'+i.hex+'"';return o<1?a+" "+s+'-opacity="'+o.toFixed(2).slice(1)+'"':a}function n(i,s,o){let a=i+s;return typeof o<"u"&&(a+=" "+o),a}function r(i,s,o){let a="",c=0,l=!1,d=0;for(let h=0;h<i.length;h++){const m=Math.floor(h%s),g=Math.floor(h/s);!m&&!l&&(l=!0),i[h]?(d++,h>0&&m>0&&i[h-1]||(a+=l?n("M",m+o,.5+g+o):n("m",c,0),c=0,l=!1),m+1<s&&i[h+1]||(a+=n("h",d),d=0)):c++}return a}return $5.render=function(s,o,a){const c=t.getOptions(o),l=s.modules.size,d=s.modules.data,h=l+c.margin*2,m=c.color.light.a?"<path "+e(c.color.light,"fill")+' d="M0 0h'+h+"v"+h+'H0z"/>':"",g="<path "+e(c.color.dark,"stroke")+' d="'+r(d,l,c.margin)+'"/>',y='viewBox="0 0 '+h+" "+h+'"',w='<svg xmlns="http://www.w3.org/2000/svg" '+(c.width?'width="'+c.width+'" height="'+c.width+'" ':"")+y+' shape-rendering="crispEdges">'+m+g+`</svg>
`;return typeof a=="function"&&a(null,w),w},$5}var LX;function iot(){if(LX)return Xm;LX=1;const t=jst(),e=tot(),n=not(),r=rot();function i(s,o,a,c,l){const d=[].slice.call(arguments,1),h=d.length,m=typeof d[h-1]=="function";if(!m&&!t())throw new Error("Callback required as last argument");if(m){if(h<2)throw new Error("Too few arguments provided");h===2?(l=a,a=o,o=c=void 0):h===3&&(o.getContext&&typeof l>"u"?(l=c,c=void 0):(l=c,c=a,a=o,o=void 0))}else{if(h<1)throw new Error("Too few arguments provided");return h===1?(a=o,o=c=void 0):h===2&&!o.getContext&&(c=a,a=o,o=void 0),new Promise(function(g,y){try{const v=e.create(a,c);g(s(v,o,c))}catch(v){y(v)}})}try{const g=e.create(a,c);l(null,s(g,o,c))}catch(g){l(g)}}return Xm.create=e.create,Xm.toCanvas=i.bind(null,n.render),Xm.toDataURL=i.bind(null,n.renderToDataURL),Xm.toString=i.bind(null,function(s,o,a){return r.render(s,a)}),Xm}var sot=iot();const oot="_qrCode_h54ia_8",aot={qrCode:oot},cot=({data:t,className:e})=>{const[n,r]=_.useState(null);return _.useEffect(()=>{let i=!1;return sot.toDataURL(t,{errorCorrectionLevel:"L"}).then(s=>{i||r(s)}).catch(s=>{i||r(null)}),()=>{i=!0}},[t]),E.jsx("div",{className:Oe(aot.qrCode,e),children:n&&E.jsx("img",{src:n,alt:Po("qr_code")})})},lot=({room:t,open:e,onDismiss:n})=>{const{t:r}=We(),i=X_(t.roomId),s=_.useMemo(()=>xfe(t.roomId,i,t.name),[i,t.name,t.roomId]),[o,a]=_.useState(!1),c=_.useCallback(()=>a(!1),[a]),l=_.useCallback(d=>{d.stopPropagation(),Mst(s),n(),a(!0)},[s,n]);return E.jsxs(E.Fragment,{children:[E.jsxs(Up,{title:r("invite_modal.title"),open:e,onDismiss:n,children:[E.jsx(cot,{className:v5.qrCode,data:s}),E.jsx(an,{className:v5.url,size:"sm",weight:"semibold",children:s}),E.jsx(Bt,{className:v5.button,Icon:E8e,onClick:l,"data-testid":"modal_inviteLink",children:r("action.copy_link")})]}),E.jsx(xpe,{open:o,onDismiss:c,autoDismiss:2e3,Icon:foe,children:r("invite_modal.link_copied_toast")})]})},uot=({error:t,recoveryActionHandler:e,widget:n})=>{const{t:r}=We();let i;switch(t.category){case Jw.CONFIGURATION_ISSUE:i=S8e;break;case Jw.NETWORK_CONNECTIVITY:i=R8e;break;case Jw.CLIENT_CONFIGURATION:i=V8e;break;default:i=PT}const s=[];return t instanceof OD&&s.push({label:r("call_ended_view.reconnect_button"),onClick:()=>void e("reconnect")}),E.jsx(qg,{children:E.jsxs(Kb,{Icon:i,title:t.localisedTitle,rageshake:t.code==rpe.UNKNOWN_ERROR,widget:n,children:[E.jsx("p",{children:t.localisedMessage??E.jsx(Ys,{i18nKey:"error.unexpected_ec_error",components:[E.jsx("b",{}),E.jsx("code",{})],values:{errorCode:t.code}})}),s&&s.map((o,a)=>E.jsx(Bt,{kind:"secondary",onClick:o.onClick,children:o.label},`action${a}`))]})})},dot=({recoveryActionHandler:t,onError:e,children:n,widget:r})=>{const i=_.useCallback(({error:s,resetError:o})=>{const a=s instanceof yl?s:new MD(s instanceof Error?s:new Error);return E.jsx(uot,{widget:r??null,error:a,resetError:o,recoveryActionHandler:async c=>{await t(c),o()}})},[t,r]);return E.jsx(AT,{fallback:i,onError:s=>e?.(s),children:n})},fot=({client:t,isPasswordlessUser:e,confineToRoom:n,preload:r,skipLobby:i,header:s,rtcSession:o,isJoined:a,muteStates:c,widget:l})=>{const[d,h]=_.useState(null),m=G8(o),g=Qe(kpe),y=Pf(a4({sounds:Ipe,latencyHint:"interactive",muted:g}));_.useEffect(()=>{m.length>=_st&&c.audio.setEnabled?.(!1)},[]),_.useEffect(()=>{a&&o.updateCallIntent(c.video.enabled?"video":"audio")},[o,a,c.video.enabled]),_.useEffect(()=>(M.info("[Lifecycle] GroupCallView Component mounted"),()=>{M.info("[Lifecycle] GroupCallView Component unmounted")}),[]),_.useEffect(()=>(document.body.classList.add("no-scroll-body"),()=>{document.body.classList.remove("no-scroll-body")}),[]),_.useEffect(()=>(window.rtcSession=o,()=>{delete window.rtcSession}),[o]),Hle(o,ei.MembershipManagerError,Ie=>h(new OD)),_.useEffect(()=>{t.getRoom(o.room.roomId)!==o.room&&M.warn(`We've ended up with multiple rooms for the same ID (${o.room.roomId}). This indicates a bug in the group call loading code, and may lead to incomplete room state.`)},[t,o.room]);const v=o.room,{displayName:w,avatarUrl:S}=V_(t),R=xst(v),x=kst(v),{perParticipantE2EE:T,returnToLobby:I,password:k}=no(),A=X_(v.roomId),[O]=Gn(Ole),[D]=Gn(V8);_.useEffect(()=>{k&&Cfe(v.roomId,k)},[k,v.roomId]),Q_(R),sst(R);const N=_.useMemo(()=>({userId:t.getUserId(),displayName:w,avatarUrl:S,roomId:v.roomId,roomName:R,roomAlias:v.getCanonicalAlias(),roomAvatar:x,e2eeSystem:A}),[t,w,S,R,v,x,A]),U=_.useMemo(()=>new Set(m.map(Ie=>Ie.sender)).size,[m]),$=Wu(),K=Pf(c),Y=_.useCallback(async Ie=>{try{await Rst(Ie,T,O,D)}catch(Ue){if(Ue instanceof yl)h(Ue);else{M.error("Unknown Error while entering RTC session",Ue);const et=new MD(Ue instanceof Error?Ue:new Error("Unknown error",{cause:Ue}));h(et)}}},[T,D,O]);_.useEffect(()=>{const Ie=async({audioInput:Ue,videoInput:et})=>{const ln=await xu.getLocalDevices(void 0,!0);if(Ue){const Bn=KW(Ue,"audioinput",ln);Bn?(M.debug(`Found audio input ID ${Bn} for name ${Ue}`),$.audioInput.select(Bn)):(M.warn("Unknown audio input: "+Ue),K.current.audio.setEnabled?.(!1))}if(et){const Bn=KW(et,"videoinput",ln);Bn?(M.debug(`Found video input ID ${Bn} for name ${et}`),$.videoInput.select(Bn)):(M.warn("Unknown video input: "+et),K.current.video.setEnabled?.(!1))}};if(i)if(l&&r){const Ue=et=>{(async()=>{await Ie(et.detail.data),await Y(o),l.api.transport.reply(et.detail,{})})().catch(ln=>{M.error("Error joining RTC session on preload",ln)})};return l.lazyActions.on(Ri.JoinCall,Ue),()=>{l.lazyActions.off(Ri.JoinCall,Ue)}}else(async()=>{await Y(o)})().catch(Ue=>{M.error("Error joining RTC session immediately",Ue)})},[l,o,r,i,T,$,K,Y,O]);const[G,F]=_.useState(!1),q=hl(),z=_.useCallback((Ie="user",Ue="left")=>{const et=y.current?.playSound(Ue),ln=!!l;F(!0);const Bn=new Promise(Mn=>{Ut.instance.eventCallEnded.track(v.roomId,o.memberships.length,ln,o),window.setTimeout(Mn,10)});nX(o,Ie,Promise.all([et,Bn])).then(async()=>{!e&&!n&&!Ut.instance.isEnabled()&&await q("/")}).catch(Mn=>{M.error("Error leaving RTC session",Mn)})},[y,l,o,v.roomId,e,n,q]);_.useEffect(()=>{if(l&&a){l.api.setAlwaysOnScreen(!0).catch(Ue=>{M.error("Error calling setAlwaysOnScreen(true)",Ue)});const Ie=Ue=>{l.api.transport.reply(Ue.detail,{}),nX(o,"user").catch(et=>{M.error("Failed to leave RTC session",et)})};return l.lazyActions.once(Ri.HangupCall,Ie),()=>{l.lazyActions.off(Ri.HangupCall,Ie)}}},[l,a,o]);const W=Ast(v),[V,X]=_.useState(!1),ne=_.useCallback(()=>X(!1),[X]),fe=_.useCallback(()=>X(!0),[X]),ye=W===ef.Public?fe:null;if(!dee()&&A.kind!==hn.NONE)throw new unt;const Ae=E.jsx(lot,{room:v,open:V,onDismiss:ne}),be=E.jsxs(E.Fragment,{children:[Ae,E.jsx(phe,{client:t,matrixInfo:N,muteStates:c,onEnter:()=>void Y(o),confineToRoom:n,hideHeader:s===Nb.None,participantCount:U,onShareClick:ye})]});let _e;if(d){const Ie=()=>{throw d};_e=E.jsx(Ie,{})}else a?_e=E.jsxs(E.Fragment,{children:[Ae,E.jsx(yst,{client:t,matrixInfo:N,rtcSession:o,matrixRoom:v,onLeave:z,header:s,muteStates:c,e2eeSystem:A,onShareClick:ye})]}):G&&l===null?e||Ut.instance.isEnabled()&&l===null?_e=E.jsx(jZe,{endedCallId:o.room.roomId,client:t,isPasswordlessUser:e,hideHeader:s===Nb.None,confineToRoom:n}):_e=null:G&&l!==null?_e=I?be:null:r||i?_e=null:_e=be;return E.jsx(dot,{widget:l,recoveryActionHandler:async Ie=>{h(null),Ie=="reconnect"&&(F(!1),await Y(o).catch(Ue=>{M.error("Error re-entering RTC session",Ue)}))},onError:()=>{o.isJoined()&&z("error")},children:_e})},hot="_modal_1tnec_8",pot={modal:hot},mot=({roomId:t})=>{const{t:e}=We(),[n,r]=_.useState(!0),i=_.useCallback(a=>{a.preventDefault(),a.stopPropagation(),r(!1)},[r]),s=X_(t);s.kind===hn.NONE&&M.error("Generating app redirect URL for encrypted room but don't have key available!");const o=_.useMemo(()=>{const a=new URL(t===null?window.location.href:xfe(t,s));a.hash=Sje(a.hash,l=>(l.set("appPrompt","false"),l.set("confineToRoom","true"),l));const c=new URL("io.element.call:/");return c.searchParams.set("url",a.toString()),c.toString()},[s,t]);return E.jsxs(Up,{className:pot.modal,title:e("app_selection_modal.title"),open:n,children:[E.jsx(an,{size:"md",weight:"semibold",children:e("app_selection_modal.text")}),E.jsx(Bt,{kind:"secondary",onClick:i,children:e("app_selection_modal.continue_in_browser")}),E.jsx(Bt,{as:"a",href:o,Icon:Woe,children:e("app_selection_modal.open_in_app")})]})},got=3,vot=3e3;async function Dpe(t,e=0,...n){try{return await t.joinRoom(...n)}catch(r){if(r instanceof tr&&r.errcode==="M_FORBIDDEN"&&e<got)return await new Promise(i=>setTimeout(i,vot)),Dpe(t,e+1,...n);throw r}}class eC extends Error{constructor(e,n,r,i){super(n),this.icon=e,this.messageBody=r,this.reason=i}}const yot=(t,e,n)=>{const[r,i]=_.useState({kind:"loading"}),s=_.useRef(void 0),{t:o}=We(),a=_.useCallback(()=>new eC(v8e,o("group_call_loader.banned_heading"),o("group_call_loader.banned_body"),d()),[o]),c=_.useCallback(()=>new eC(LT,o("group_call_loader.knock_reject_heading"),o("group_call_loader.knock_reject_body"),d()),[o]),l=_.useCallback(()=>new eC(Ooe,o("group_call_loader.call_ended_heading"),o("group_call_loader.call_ended_body"),d()),[o]),d=()=>s.current?.currentState.getStateEvents(Z.RoomMember,s.current?.myUserId)?.getContent().reason;return _.useEffect(()=>{if(!t||!e)return;const h=async S=>{let R=null;const x=await t.getRoomIdForAlias(S.toLowerCase());return M.info(`${S} resolved to ${x.room_id}`),R=t.getRoom(x.room_id),R?M.info(`Already in room ${x.room_id}, not rejoining.`):(M.info(`Room ${x.room_id} not found, joining.`),R=await t.joinRoom(x.room_id,{viaServers:x.servers})),R},m=async(S,R,x)=>(await t.knockRoom(S,{viaServers:R}),x(),await new Promise((T,I)=>{t.on(ke.MyMembership,(k,A,O)=>{S===k.roomId&&(s.current=k,A===Be.Invite&&O===Be.Knock&&Dpe(t,0,k.roomId,{viaServers:R}).then(D=>{M.log("Auto-joined %s",D.roomId),T(D)},I),A===Be.Ban&&I(a()),A===Be.Leave&&I(c()))})})),g=async()=>{let S=null;if(e[0]==="#")S=await h(e),s.current=S;else{const R=e;S=t.getRoom(R),s.current=S??void 0;const x=S?.getMyMembership();if(x===Be.Join)return S;if(ut)throw new Error("Room not found. The widget-api did not pass over the relevant room events/information.");if(x===Be.Ban)throw a();if(x===Be.Invite)S=await t.joinRoom(R,{viaServers:n});else{let T;try{T=await t.getRoomSummary(R,n)}catch(I){M.warn("Could not load room summary to decide whether we want to join or knock.\n              EC will fallback to join as if this would be a public room.\n              Reach out to your homeserver admin to ask them about supporting the `/summary` endpoint (im.nheko.summary):",I)}if(T===void 0||T.join_rule===ef.Public)S=await t.joinRoom(R,{viaServers:n});else if(T.join_rule===ef.Knock){const I=T;let k=()=>{};const A=new Promise(O=>{I.membership!==Be.Knock?k=O:O()});i({kind:"canKnock",roomSummary:I,knock:k}),await A,S=await m(T.room_id,n,()=>i({kind:"waitForInvite",roomSummary:I}))}else throw new Error(`Room ${T.room_id} is not joinable. This likely means, that the conference owner has changed the room settings to private.`)}}return M.info(`Joined ${e}, waiting room to be ready for group calls`),await t.waitUntilRoomReadyForGroupCalls(S.roomId),M.info(`${e}, is ready for group calls`),S},y=async()=>{const S=await g();return s.current=S,M.debug(`Fetched / joined room ${e}`),t.matrixRTC.getRoomSession(S)},v=async()=>{t.getSyncState()!==Gt.Syncing&&(M.debug("useLoadGroupCall: waiting for client to start syncing..."),await new Promise(S=>{const R=()=>{if(t.getSyncState()===Gt.Syncing)return t.off(Le.Sync,R),S()};t.on(Le.Sync,R)}),M.debug("useLoadGroupCall: client is now syncing."))},w=async()=>{await new Promise((S,R)=>{t.on(ke.MyMembership,(x,T)=>{T===Be.Leave&&R(l()),T===Be.Ban&&R(a())})})};r.kind==="loading"&&(M.log("Start loading group call"),v().then(y).then(S=>i({kind:"loaded",rtcSession:S})).then(w).catch(S=>i({kind:"failed",error:S})))},[a,t,c,l,e,r,o,n]),r},bot=new On;function _ot(t){const e=gp(t??bot,ei.JoinStateChanged,_.useCallback(()=>t?.isJoined()??!1,[t]));return _.useEffect(()=>{M.info(`Session in room ${t?.room.roomId} changed to ${e?"joined":"left"}`)},[t,e]),e}const Sot=()=>{const{confineToRoom:t,appPrompt:e,preload:n,header:r,displayName:i,skipLobby:s}=no(),{t:o}=We(),{roomAlias:a,roomId:c,viaServers:l}=Cje(),d=c??a;d||M.error("No room specified");const{registerPasswordlessUser:h}=Mfe(),[m,g]=_.useState(!1),{loading:y,authenticated:v,client:w,error:S,passwordlessUser:R}=W8(),{avatarUrl:x,displayName:T}=V_(w),I=yot(w,d,l),k=_ot(I.kind==="loaded"?I.rtcSession:void 0),A=Est(k);_.useEffect(()=>{!y&&!v&&i&&!ut&&(g(!0),h(i).catch(K=>{M.error("Failed to register passwordless user",K)}).finally(()=>{g(!1)}))},[y,v,i,g,h]);const[O,D]=uR();_.useEffect(()=>{O===null&&D&&D(!0)},[O,D]);const N=_.useRef(!1);_.useEffect(()=>{I.kind==="loaded"&&N.current&&M.log("Play join sound 'Not yet implemented'")},[I.kind]);const U=()=>{switch(I.kind){case"loaded":return E.jsx(fot,{widget:ut,client:w,rtcSession:I.rtcSession,isJoined:k,isPasswordlessUser:R,confineToRoom:t,preload:n,skipLobby:s||N.current,header:r,muteStates:A});case"waitForInvite":case"canKnock":{N.current=N.current||I.kind==="waitForInvite";const K=I.kind==="canKnock"?I.knock:null,Y=I.kind==="canKnock"?o("lobby.ask_to_join"):E.jsxs(E.Fragment,{children:[o("lobby.waiting_for_invite"),E.jsx(foe,{})]});return E.jsx(phe,{client:w,matrixInfo:{userId:w.getUserId()??"",displayName:T??"",avatarUrl:x??"",roomAlias:null,roomId:I.roomSummary.room_id,roomName:I.roomSummary.name??"",roomAvatar:I.roomSummary.avatar_url??null,e2eeSystem:{kind:I.roomSummary["im.nheko.summary.encryption"]?hn.PER_PARTICIPANT:hn.NONE}},onEnter:()=>K?.(),enterLabel:Y,waitingForInvite:I.kind==="waitForInvite",confineToRoom:t,hideHeader:r!=="standard",participantCount:null,muteStates:A,onShareClick:null})}case"loading":return E.jsx(qg,{children:E.jsx("h1",{children:o("common.loading")})});case"failed":return N.current=!1,I.error.errcode==="M_NOT_FOUND"?E.jsx(qg,{children:E.jsx(Kb,{Icon:M8e,title:o("error.call_not_found"),widget:ut,children:E.jsx(Ys,{i18nKey:"error.call_not_found_description",children:E.jsxs("p",{children:["That link doesn't appear to belong to any existing call. Check that you have the right link, or"," ",E.jsx(il,{to:"/",children:"create a new one"}),"."]})})})}):I.error instanceof eC?E.jsx(qg,{children:E.jsxs(Kb,{Icon:I.error.icon,title:I.error.message,widget:ut,children:[E.jsx("p",{children:I.error.messageBody}),I.error.reason&&E.jsx("p",{children:o("group_call_loader.reason",{reason:I.error.reason})})]})}):E.jsx(zb,{widget:ut,error:I.error});default:return E.jsx(E.Fragment,{children:" "})}};let $;return y||m?$=E.jsx(pR,{}):S?$=E.jsx(zb,{widget:ut,error:S}):w?d?$=U():$=E.jsx(Lfe,{}):$=E.jsx(wJe,{}),E.jsxs(E.Fragment,{children:[$,e&&sn.get().app_prompt&&(va==="android"||va==="ios")&&c&&E.jsx(mot,{roomId:c})]})},Eot="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICLQn9C+0YLRgNC10LHQuNGC0LXQu9GB0LrQviDQvNC10L3RjiIKICB9LAogICJhY3Rpb24iOiB7CiAgICAiY2xvc2UiOiAi0JfQsNGC0LLQvtGA0LgiLAogICAgImNvcHlfbGluayI6ICLQmtC+0L/QuNGA0LDQvdC1INC90LAg0LLRgNGK0LfQutCw0YLQsCIsCiAgICAiZ28iOiAi0J3QsNC/0YDQtdC0IiwKICAgICJpbnZpdGUiOiAi0J/QvtC60LDQvdCwIiwKICAgICJubyI6ICLQndC1IiwKICAgICJyZWdpc3RlciI6ICLQoNC10LPQuNGB0YLRgNCw0YbQuNGPIiwKICAgICJyZW1vdmUiOiAi0J/RgNC10LzQsNGF0L3QuCIsCiAgICAic2lnbl9pbiI6ICLQktC70LXQtyIsCiAgICAic2lnbl9vdXQiOiAi0JjQt9C70LXQtyIKICB9LAogICJjYWxsX2VuZGVkX3ZpZXciOiB7CiAgICAiY3JlYXRlX2FjY291bnRfYnV0dG9uIjogItCh0YrQt9C00LDQuSDQsNC60LDRg9C90YIiLAogICAgImNyZWF0ZV9hY2NvdW50X3Byb21wdCI6ICI8MD7Ql9Cw0YnQviDQvdC1INC90LDRgdGC0YDQvtC50YLQtSDQv9Cw0YDQvtC70LAg0LfQsCDQtNCwINC30LDQv9Cw0LfQuNGC0LUg0LDQutCw0YPQvdGC0LAg0YHQuD88LzA+PDE+0KnQtSDQvNC+0LbQtdGC0LUg0LTQsCDQt9Cw0L/QsNC30LjRgtC1INC40LzQtdGC0L4g0Lgg0LDQstCw0YLQsNGA0LAg0YHQuCDQt9CwINCx0YrQtNC10YnQuCDRgNCw0LfQs9C+0LLQvtGA0Lg8LzE+IiwKICAgICJub3Rfbm93X2J1dHRvbiI6ICLQndC1INGB0LXQs9CwLCDQstGK0YDQvdC4INGB0LUg0L3QsCDQvdCw0YfQsNC70L3QuNGPINC10LrRgNCw0L0iCiAgfSwKICAiY29tbW9uIjogewogICAgImF1ZGlvIjogItCX0LLRg9C6IiwKICAgICJhdmF0YXIiOiAi0JDQstCw0YLQsNGAIiwKICAgICJkaXNwbGF5X25hbWUiOiAi0JjQvNC1L9C/0YHQtdCy0LTQvtC90LjQvCIsCiAgICAiaG9tZSI6ICLQndCw0YfQsNC70L4iLAogICAgImxvYWRpbmciOiAi0JfQsNGA0LXQttC00LDQvdC14oCmIiwKICAgICJwYXNzd29yZCI6ICLQn9Cw0YDQvtC70LAiLAogICAgInByb2ZpbGUiOiAi0J/RgNC+0YTQuNC7IiwKICAgICJzZXR0aW5ncyI6ICLQndCw0YHRgtGA0L7QudC60LgiLAogICAgInVzZXJuYW1lIjogItCf0L7RgtGA0LXQsdC40YLQtdC70YHQutC+INC40LzQtSIsCiAgICAidmlkZW8iOiAi0JLQuNC00LXQviIKICB9LAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAi0JTQsCwg0L/RgNC40YHRitC10LTQuNC90Lgg0YHQtSIsCiAgICAidGV4dCI6ICLQotC+0LfQuCDRgNCw0LfQs9C+0LLQvtGAINCy0LXRh9C1INGB0YrRidC10YHRgtCy0YPQstCwLCDQuNGB0LrQsNGC0LUg0LvQuCDQtNCwINGB0LUg0L/RgNC40YHRitC10LTQuNC90LjRgtC1PyIsCiAgICAidGl0bGUiOiAi0J/RgNC40YHRitC10LTQuNC90Y/QstCw0L3QtSDQutGK0Lwg0YHRitGJ0LXRgdGC0LLRg9Cy0LDRiSDRgNCw0LfQs9C+0LLQvtGAPyIKICB9LAogICJsYXlvdXRfc3BvdGxpZ2h0X2xhYmVsIjogItCf0YDQvtC20LXQutGC0L7RgCIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogItCS0LvQtdC3INCyINGA0LDQt9Cz0L7QstC+0YDQsCIKICB9LAogICJsb2dnaW5nX2luIjogItCS0LvQuNC30LDQvdC14oCmIiwKICAibG9naW5fYXV0aF9saW5rcyI6ICI8MD7QodGK0LfQtNCw0LnRgtC1INCw0LrQsNGD0L3RgjwvMD4g0LjQu9C4IDwyPtCS0LvQtdC30YLQtSDQutCw0YLQviDQs9C+0YHRgjwvMj4iLAogICJsb2dpbl90aXRsZSI6ICLQktC70LXQtyIsCiAgInJhZ2VzaGFrZV9yZXF1ZXN0X21vZGFsIjogewogICAgImJvZHkiOiAi0JTRgNGD0LMg0L/QvtGC0YDQtdCx0LjRgtC10Lsg0LIg0YLQvtC30Lgg0YDQsNC30LPQvtCy0L7RgCDQuNC80LAg0L/RgNC+0LHQu9C10LwuINCX0LAg0LTQsCDQtNC40LDQs9C90L7RgdGC0LjRhtC40YDQsNC80LUg0YLQvtC30Lgg0L/RgNC+0LHQu9C10Lwg0L/Qvi3QtNC+0LHRgNC1INC90Lgg0YHQtSDQuNGB0LrQsCDQtNCwINGB0YrQsdC10YDQtdC8IGRlYnVnINC70L7Qs9C+0LLQtS4iLAogICAgInRpdGxlIjogItCX0LDRj9Cy0LrQsCDQt9CwIGRlYnVnINC70L7Qs9C+0LLQtSIKICB9LAogICJyYWdlc2hha2Vfc2VuZF9sb2dzIjogItCY0LfQv9GA0LDRgtC10YLQtSBkZWJ1ZyDQu9C+0LPQvtCy0LUiLAogICJyYWdlc2hha2Vfc2VuZGluZyI6ICLQmNC30L/RgNCw0YnQsNC90LXigKYiLAogICJyZWNhcHRjaGFfZGlzbWlzc2VkIjogIlJlY2FwdGNoYSDQvtGC0YXQstGK0YDQu9C10L3QsCIsCiAgInJlY2FwdGNoYV9ub3RfbG9hZGVkIjogIlJlY2FwdGNoYSDQvdC1INC1INC30LDRgNC10LTQtdC90LAiLAogICJyZWdpc3RlciI6IHsKICAgICJwYXNzd29yZHNfbXVzdF9tYXRjaCI6ICLQn9Cw0YDQvtC70LjRgtC1INC90LUg0YHRitCy0L/QsNC00LDRgiIsCiAgICAicmVnaXN0ZXJpbmciOiAi0KDQtdCz0LjRgdGC0YDQuNGA0LDQvdC14oCmIgogIH0sCiAgInJlZ2lzdGVyX2F1dGhfbGlua3MiOiAiPDA+0JLQtdGH0LUg0LjQvNCw0YLQtSDQsNC60LDRg9C90YI/PC8wPjwxPjwwPtCS0LvQtdC30YLQtSDRgSDQvdC10LPQvjwvMD4g0LjQu9C4IDwyPtCS0LvQtdC30YLQtSDQutCw0YLQviDQs9C+0YHRgjwvMj48LzE+IiwKICAicmVnaXN0ZXJfY29uZmlybV9wYXNzd29yZF9sYWJlbCI6ICLQn9C+0YLQstGK0YDQtNC4INC/0LDRgNC+0LvQsNGC0LAiLAogICJyZXR1cm5faG9tZV9idXR0b24iOiAi0JLRgNGK0YnQsNC90LUg0L3QsCDQvdCw0YfQsNC70L3QuNGPINC10LrRgNCw0L0iLAogICJzY3JlZW5zaGFyZV9idXR0b25fbGFiZWwiOiAi0KHQv9C+0LTQtdC70Lgg0LXQutGA0LDQvdCwIiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICLQoNCw0LfRgNCw0LHQvtGC0YfQuNC6IiwKICAgICJmZWVkYmFja190YWJfaDQiOiAi0JjQt9C/0YDQsNGC0Lgg0L7QsdGA0LDRgtC90LAg0LLRgNGK0LfQutCwIiwKICAgICJmZWVkYmFja190YWJfc2VuZF9sb2dzX2xhYmVsIjogItCS0LrQu9GO0YfQuCBkZWJ1ZyDQu9C+0LPQvtCy0LUiCiAgfSwKICAidW5hdXRoZW50aWNhdGVkX3ZpZXdfYm9keSI6ICLQktGB0LUg0L7RidC1INC90LUg0YHRgtC1INGA0LXQs9C40YHRgtGA0LjRgNCw0L3QuD8gPDI+0KHRitC30LTQsNC50YLQtSDQsNC60LDRg9C90YI8LzI+IiwKICAidW5hdXRoZW50aWNhdGVkX3ZpZXdfbG9naW5fYnV0dG9uIjogItCS0LvQtdC30YLQtSDQsiDQsNC60LDRg9C90YLQsCDRgdC4IiwKICAidmVyc2lvbiI6ICLQktC10YDRgdC40Y86IHt7dmVyc2lvbn19Igp9Cg==",wot=""+new URL("cs-app-Du_5mVg3.json",import.meta.url).href,Cot=""+new URL("da-app-BBz-lePm.json",import.meta.url).href,Tot=""+new URL("de-app-DjOuqT-j.json",import.meta.url).href,Rot=""+new URL("el-app-BBr3LLTK.json",import.meta.url).href,Iot=""+new URL("en-app-I8blcx-e.json",import.meta.url).href,kot=""+new URL("es-app-Q3c7lmEj.json",import.meta.url).href,xot=""+new URL("et-app-DLvuR7m2.json",import.meta.url).href,Aot="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICLZgdmH2LHYs9iqINqp2KfYsdio2LEiCiAgfSwKICAiYWN0aW9uIjogewogICAgImNsb3NlIjogItio2LPYqtmGIiwKICAgICJnbyI6ICLYsdmB2KrZhiIsCiAgICAibm8iOiAi2K7bjNixIiwKICAgICJyZWdpc3RlciI6ICLYq9io2KrigIzZhtin2YUiLAogICAgInJlbW92ZSI6ICLYrdiw2YEiLAogICAgInNpZ25faW4iOiAi2YjYsdmI2K8iLAogICAgInNpZ25fb3V0IjogItiu2LHZiNisIgogIH0sCiAgImNhbGxfZW5kZWRfdmlldyI6IHsKICAgICJjcmVhdGVfYWNjb3VudF9idXR0b24iOiAi2LPYp9iu2Kog2K3Ys9in2Kgg2qnYp9ix2KjYsduMIiwKICAgICJjcmVhdGVfYWNjb3VudF9wcm9tcHQiOiAiPDA+2obYsdinINuM2qkg2LHZhdiyINi52KjZiNixINio2LHYp9uMINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2KrZhti424zZhSDZhtmF24zigIzaqdmG24zYr9ifPC8wPjwxPti02YXYpyDZhduM4oCM2KrZiNin2YbbjNivINmG2KfZhSDYrtmI2K8g2LHYpyDYrdmB2Lgg2qnZhtuM2K8g2Ygg24zaqSDYotmI2KfYqtin2LEg2KjYsdin24wg2KrZhdin2LPigIzZh9in24wg2KLbjNmG2K/ZhyDYqNiz2KfYstuM2K88LzE+IiwKICAgICJub3Rfbm93X2J1dHRvbiI6ICLYp9mE2KfZhiDZhtmH2Iwg2KjZhyDYtdmB2K3ZhyDYp9i12YTbjCDYqNix2q/Ysdiv24zYryIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAi2LXYr9inIiwKICAgICJhdmF0YXIiOiAi2KLZiNin2KrYp9ixIiwKICAgICJkaXNwbGF5X25hbWUiOiAi2YbYp9mFINmG2YXYp9uM2LTbjCIsCiAgICAiaG9tZSI6ICLYrtin2YbZhyIsCiAgICAibG9hZGluZyI6ICLYqNin2LHar9iy2KfYsduM4oCmIiwKICAgICJwYXNzd29yZCI6ICLYsdmF2LIg2LnYqNmI2LEiLAogICAgInByb2ZpbGUiOiAi2b7YsdmI2YHYp9uM2YQiLAogICAgInNldHRpbmdzIjogItiq2YbYuNuM2YXYp9iqIiwKICAgICJ1c2VybmFtZSI6ICLZhtin2YUg2qnYp9ix2KjYsduMIiwKICAgICJ2aWRlbyI6ICLZiNuM2K/bjNmIIgogIH0sCiAgImhlYWRlcl9sYWJlbCI6ICLYrtin2YbZh9mUINiq2YXYp9izINin2YTZhdmG2KoiLAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAi2KjZhNmH2Iwg2KjZhyDYqtmF2KfYsyDYqNm+24zZiNmG2K/bjNivIiwKICAgICJ0ZXh0IjogItin24zZhiDYqtmF2KfYsyDYp9iyINmC2KjZhCDZiNis2YjYryDYr9in2LHYr9iMINmF24zigIzYrtmI2KfZh9uM2K8g2KjZvtuM2YjZhtiv24zYr9ifIiwKICAgICJ0aXRsZSI6ICLZvtuM2YjYs9iqINio2Ycg2KrZhdin2LPYnyIKICB9LAogICJsYXlvdXRfc3BvdGxpZ2h0X2xhYmVsIjogItmG2YjYsSDYp9mB2qnZhiIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogItm+24zZiNiz2KrZhiDYqNmHINiq2YXYp9izIgogIH0sCiAgImxvZ2dpbmdfaW4iOiAi2YjYsdmI2K/igKYiLAogICJsb2dpbl9hdXRoX2xpbmtzIjogIjwwPtiz2KfYrtiqINit2LPYp9ioINqp2KfYsdio2LHbjDwvMD4gT3IgPDI+2K/Ys9iq2LHYs9uMINio2Ycg2LnZhtmI2KfZhiDZhduM2YfZhdin2YY8LzI+IiwKICAibG9naW5fdGl0bGUiOiAi2YjYsdmI2K8iLAogICJyYWdlc2hha2VfcmVxdWVzdF9tb2RhbCI6IHsKICAgICJib2R5IjogItqp2KfYsdio2LEg2K/bjNqv2LHbjCDYr9ixINin24zZhiDYqtmF2KfYsyDZhdi02qnZhNuMINiv2KfYsdivLiDYqNix2KfbjCDYqti02K7bjNi1INio2YfYqtixINmF2LTaqdmE2Iwg2KjZh9iq2LEg2KfYs9iqINmF2Kcg2YTYp9qvINi524zYqOKAjNuM2KfYqNuMINix2Kcg2KzZhdi54oCM2KLZiNix24wg2qnZhtuM2YUuIiwKICAgICJ0aXRsZSI6ICLYr9ix2K7ZiNin2LPYqiDZhNin2q8g2LnbjNio4oCM24zYp9io24wiCiAgfSwKICAicmFnZXNoYWtlX3NlbmRfbG9ncyI6ICLYp9ix2LPYp9mEINmE2Kfar+KAjNmH2KfbjCDYuduM2KjigIzbjNin2KjbjCIsCiAgInJhZ2VzaGFrZV9zZW5kaW5nIjogItiv2LEg2K3Yp9mEINin2LHYs9in2YTigKYiLAogICJyYWdlc2hha2Vfc2VuZGluZ19sb2dzIjogItiv2LEg2K3Yp9mEINin2LHYs9in2YQg2KjYp9qv4oCM2YfYp9uMINi524zYqOKAjNuM2KfYqNuM4oCmIiwKICAicmVjYXB0Y2hhX2Rpc21pc3NlZCI6ICLYsduM2qnZvtqG2Kcg2LHYryDYtNivIiwKICAicmVjYXB0Y2hhX25vdF9sb2FkZWQiOiAi2qnZvtqG2Kcg2KjYp9ix2q/bjNix24wg2YbYtNivIiwKICAicmVnaXN0ZXIiOiB7CiAgICAicGFzc3dvcmRzX211c3RfbWF0Y2giOiAi2LHZhdiyINi52KjZiNixINio2KfbjNivINmH2YXYrtmI2KfZhtuMINiv2KfYtNiq2Ycg2KjYp9i02K8iLAogICAgInJlZ2lzdGVyaW5nIjogItir2KjYquKAjNmG2KfZheKApiIKICB9LAogICJyZWdpc3Rlcl9hdXRoX2xpbmtzIjogIjwwPtin2LIg2YLYqNmEINit2LPYp9ioINqp2KfYsdio2LHbjCDYr9in2LHbjNiv2J88LzA+PDE+PDA+2YjYsdmI2K88LzA+IE9yIDwyPtio2Ycg2LnZhtmI2KfZhiDbjNqpINmF24zZh9mF2KfZhiDZiNin2LHYryDYtNmI24zYrzwvMj48LzE+IiwKICAicmVnaXN0ZXJfY29uZmlybV9wYXNzd29yZF9sYWJlbCI6ICLYqtin24zbjNivINix2YXYsti52KjZiNixIiwKICAicmV0dXJuX2hvbWVfYnV0dG9uIjogItio2LHar9i02Kog2KjZhyDYtdmB2K3ZhyDYp9i12YTbjCIsCiAgInNjcmVlbnNoYXJlX2J1dHRvbl9sYWJlbCI6ICLYp9i02KrYsdin2qkg2q/YsNin2LHbjCDYtdmB2K3ZhyDZhtmF2KfbjNi0IiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICLYqtmI2LPYudmHINiv2YfZhtiv2YciLAogICAgImZlZWRiYWNrX3RhYl9oNCI6ICLYqNin2LLYrtmI2LHYryDYp9ix2KfYptmHINiv2YfbjNivIiwKICAgICJmZWVkYmFja190YWJfc2VuZF9sb2dzX2xhYmVsIjogIti02KfZhdmEINmE2Kfar+KAjNmH2KfbjCDYuduM2KjigIzbjNin2KjbjCIKICB9LAogICJ1bmF1dGhlbnRpY2F0ZWRfdmlld19ib2R5IjogItmH2YbZiNiyINir2KjYquKAjNmG2KfZhSDZhtqp2LHYr9mH4oCM2KfbjNiv2J8gPDI+2LPYp9iu2Kog2K3Ys9in2Kgg2qnYp9ix2KjYsduMPC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICLYqNmHINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2YjYp9ix2K8g2LTZiNuM2K8iLAogICJ2ZXJzaW9uIjogItmG2LPYrtmHOiB7e9mG2LPYrtmHfX0iCn0K",Pot=""+new URL("fi-app-tnO3DMdi.json",import.meta.url).href,Lot=""+new URL("fr-app-BxTYbDfK.json",import.meta.url).href,Oot=""+new URL("id-app-BEz8ptLJ.json",import.meta.url).href,Mot=""+new URL("it-app-Cik25Qgd.json",import.meta.url).href,Dot=""+new URL("ja-app-Cp_00ujI.json",import.meta.url).href,Not=""+new URL("lv-app-D-ZV3Ytk.json",import.meta.url).href,Uot=""+new URL("pl-app-CUkXVSZk.json",import.meta.url).href,jot=""+new URL("ro-app-CdYgKCOW.json",import.meta.url).href,Fot=""+new URL("ru-app-CIijOjFj.json",import.meta.url).href,$ot=""+new URL("sk-app-DaVEeQWZ.json",import.meta.url).href,Bot=""+new URL("sv-app-DHLBEOTp.json",import.meta.url).href,Hot=""+new URL("tr-app-Dk--6BpP.json",import.meta.url).href,Vot=""+new URL("uk-app-DZD01h76.json",import.meta.url).href,qot="data:application/json;base64,ewogICJhY3Rpb24iOiB7CiAgICAiY2xvc2UiOiAixJDDs25nIiwKICAgICJubyI6ICJLaMO0bmciLAogICAgInJlZ2lzdGVyIjogIsSQxINuZyBrw70iLAogICAgInNpZ25faW4iOiAixJDEg25nIG5o4bqtcCIsCiAgICAic2lnbl9vdXQiOiAixJDEg25nIHh14bqldCIsCiAgICAic3VibWl0IjogIkfhu61pIgogIH0sCiAgImNhbGxfZW5kZWRfdmlldyI6IHsKICAgICJjcmVhdGVfYWNjb3VudF9idXR0b24iOiAiVOG6oW8gdMOgaSBraG/huqNuIiwKICAgICJjcmVhdGVfYWNjb3VudF9wcm9tcHQiOiAiPDA+VOG6oWkgc2FvIGzhuqFpIGtow7RuZyBob8OgbiB0aGnhu4duIGLhurFuZyBjw6FjaCDEkeG6t3QgbeG6rXQga2jhuql1IMSR4buDIGdp4buvIHTDoGkga2hv4bqjbiBj4bunYSBi4bqhbj88LzA+PDE+QuG6oW4gc+G6vSBjw7MgdGjhu4MgZ2nhu68gdMOqbiB2w6AgxJHhurd0IOG6o25oIMSR4bqhaSBkaeG7h24gY2hvIG5o4buvbmcgY3Xhu5ljIGfhu41pIHRp4bq/cCB0aGVvLjwvMT4iLAogICAgImZlZWRiYWNrX2RvbmUiOiAiPDA+Q+G6o20gaMahbiB2w6wgxJHDoyBwaOG6o24gaOG7k2khPC8wPiIsCiAgICAiZmVlZGJhY2tfcHJvbXB0IjogIjwwPkNow7puZyB0w7RpIG114buRbiBuZ2hlIHBo4bqjbiBo4buTaSBj4bunYSBi4bqhbiDEkeG7gyBjw7JuIGPhuqNpIHRoaeG7h24gdHLhuqNpIG5naGnhu4dtIGNobyBi4bqhbi48LzA+IiwKICAgICJoZWFkbGluZSI6ICJ7e2Rpc3BsYXlOYW1lfX0sIGN14buZYyBn4buNaSDEkcOjIGvhur90IHRow7pjLiIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAiw4JtIHRoYW5oIiwKICAgICJhdmF0YXIiOiAi4bqibmggxJHhuqFpIGRp4buHbiIsCiAgICAiZGlzcGxheV9uYW1lIjogIlTDqm4gaGnhu4NuIHRo4buLIiwKICAgICJsb2FkaW5nIjogIsSQYW5nIHThuqNp4oCmIiwKICAgICJwYXNzd29yZCI6ICJN4bqtdCBraOG6qXUiLAogICAgInByb2ZpbGUiOiAiSOG7kyBzxqEiLAogICAgInNldHRpbmdzIjogIkPDoGkgxJHhurd0IiwKICAgICJ1c2VybmFtZSI6ICJUw6puIG5nxrDhu51pIGTDuW5nIiwKICAgICJ2aWRlbyI6ICJUcnV54buBbiBow6xuaCIKICB9LAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAiVsOibmcsIHRoYW0gZ2lhIGN14buZYyBn4buNaSIsCiAgICAidGV4dCI6ICJDdeG7mWMgZ+G7jWkgxJHDoyB04buTbiB04bqhaSwgYuG6oW4gY8OzIG114buRbiB0aGFtIGdpYSBraMO0bmc/IiwKICAgICJ0aXRsZSI6ICJUaGFtIGdpYSBjdeG7mWMgZ+G7jWk/IgogIH0sCiAgImxheW91dF9zcG90bGlnaHRfbGFiZWwiOiAiVGnDqnUgxJFp4buDbSIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogIlRoYW0gZ2lhIGN14buZYyBn4buNaSIKICB9LAogICJsb2dnaW5nX2luIjogIsSQYW5nIMSRxINuZyBuaOG6rXDigKYiLAogICJsb2dpbl9hdXRoX2xpbmtzIjogIjwwPlThuqFvIHTDoGkga2hv4bqjbjwvMD4gSGF5IDwyPlRoYW0gZ2lhIGTGsOG7m2kgdMOqbiBraMOhYzwvMj4iLAogICJsb2dpbl90aXRsZSI6ICLEkMSDbmcgbmjhuq1wIiwKICAicmFnZXNoYWtlX3JlcXVlc3RfbW9kYWwiOiB7CiAgICAiYm9keSI6ICJN4buZdCBuZ8aw4budaSBkw7luZyBraMOhYyB0cm9uZyBjdeG7mWMgZ+G7jWkgxJFhbmcgZ+G6t3AgduG6pW4gxJHhu4EuIMSQ4buDIGPDsyB0aOG7gyBjaOG6qW4gxJFvw6FuIHThu5F0IGjGoW4gY2jDum5nIHTDtGkgbXXhu5FuIHRodSB0aOG6rXAgbmjhuq10IGvDvSBn4buhIGzhu5dpLiIsCiAgICAidGl0bGUiOiAiWcOqdSBj4bqndSBuaOG6rXQga8O9IGfhu6EgbOG7l2kiCiAgfSwKICAicmFnZXNoYWtlX3NlbmRpbmciOiAixJBhbmcgZ+G7rWnigKYiLAogICJyZWNhcHRjaGFfbm90X2xvYWRlZCI6ICJDaMawYSB04bqjaSDEkcaw4bujYyBSZWNhcHRjaGEiLAogICJyZWdpc3RlciI6IHsKICAgICJwYXNzd29yZHNfbXVzdF9tYXRjaCI6ICJN4bqtdCBraOG6qXUgcGjhuqNpIGto4bubcCIsCiAgICAicmVnaXN0ZXJpbmciOiAixJBhbmcgxJHEg25nIGvDveKApiIKICB9LAogICJyZWdpc3Rlcl9hdXRoX2xpbmtzIjogIjwwPsSQw6MgY8OzIHTDoGkga2hv4bqjbj88LzA+PDE+PDA+xJDEg25nIG5o4bqtcDwvMD4gSGF5IDwyPlRoYW0gZ2lhIGTGsOG7m2kgdMOqbiBLaMOhY2g8LzI+PC8xPiIsCiAgInJlZ2lzdGVyX2NvbmZpcm1fcGFzc3dvcmRfbGFiZWwiOiAiWMOhYyBuaOG6rW4gbeG6rXQga2jhuql1IiwKICAic2NyZWVuc2hhcmVfYnV0dG9uX2xhYmVsIjogIkNoaWEgc+G6uyBtw6BuIGjDrG5oIiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICJOaMOgIHBow6F0IHRyaeG7g24iLAogICAgImZlZWRiYWNrX3RhYl9kZXNjcmlwdGlvbl9sYWJlbCI6ICJQaOG6o24gaOG7k2kgY+G7p2EgYuG6oW4iLAogICAgImZlZWRiYWNrX3RhYl9oNCI6ICJH4butaSBwaOG6o24gaOG7k2kiLAogICAgImZlZWRiYWNrX3RhYl9zZW5kX2xvZ3NfbGFiZWwiOiAiS8OobSB0aGVvIG5o4bqtdCBrw70gZ+G7oSBs4buXaSIsCiAgICAiZmVlZGJhY2tfdGFiX3RoYW5rX3lvdSI6ICJD4bqjbSDGoW4sIGNow7puZyB0w7RpIMSRw6Mgbmjhuq1uIMSRxrDhu6NjIHBo4bqjbiBo4buTaSEiLAogICAgImZlZWRiYWNrX3RhYl90aXRsZSI6ICJQaOG6o24gaOG7k2kiCiAgfSwKICAic3VibWl0dGluZyI6ICLEkGFuZyBn4butaeKApiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2JvZHkiOiAiQ2jGsGEgxJHEg25nIGvDvT8gPDI+VOG6oW8gdMOgaSBraG/huqNuPC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICLEkMSDbmcgbmjhuq1wIHbDoG8gdMOgaSBraG/huqNuIGPhu6dhIGLhuqFuIiwKICAidmVyc2lvbiI6ICJQaGnDqm4gYuG6o246IHt7dmVyc2lvbn19Igp9Cg==",Got=""+new URL("zh-Hans-app-BY5jJGyr.json",import.meta.url).href,Kot=""+new URL("zh-Hant-app-BV1LKS_j.json",import.meta.url).href,{slice:zot,forEach:Wot}=[];function Yot(t){return Wot.call(zot.call(arguments,1),e=>{if(e)for(const n in e)t[n]===void 0&&(t[n]=e[n])}),t}function Xot(t){return typeof t!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(n=>n.test(t))}const OX=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Jot=function(t,e){const r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},i=encodeURIComponent(e);let s=`${t}=${i}`;if(r.maxAge>0){const o=r.maxAge-0;if(Number.isNaN(o))throw new Error("maxAge should be a Number");s+=`; Max-Age=${Math.floor(o)}`}if(r.domain){if(!OX.test(r.domain))throw new TypeError("option domain is invalid");s+=`; Domain=${r.domain}`}if(r.path){if(!OX.test(r.path))throw new TypeError("option path is invalid");s+=`; Path=${r.path}`}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");s+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return r.partitioned&&(s+="; Partitioned"),s},MX={create(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};n&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+n*60*1e3)),r&&(i.domain=r),document.cookie=Jot(t,e,i)},read(t){const e=`${t}=`,n=document.cookie.split(";");for(let r=0;r<n.length;r++){let i=n[r];for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return i.substring(e.length,i.length)}return null},remove(t,e){this.create(t,"",-1,e)}};var Qot={name:"cookie",lookup(t){let{lookupCookie:e}=t;if(e&&typeof document<"u")return MX.read(e)||void 0},cacheUserLanguage(t,e){let{lookupCookie:n,cookieMinutes:r,cookieDomain:i,cookieOptions:s}=e;n&&typeof document<"u"&&MX.create(n,t,r,i,s)}},Zot={name:"querystring",lookup(t){let{lookupQuerystring:e}=t,n;if(typeof window<"u"){let{search:r}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(r=window.location.hash.substring(window.location.hash.indexOf("?")));const s=r.substring(1).split("&");for(let o=0;o<s.length;o++){const a=s[o].indexOf("=");a>0&&s[o].substring(0,a)===e&&(n=s[o].substring(a+1))}}return n}},eat={name:"hash",lookup(t){let{lookupHash:e,lookupFromHashIndex:n}=t,r;if(typeof window<"u"){const{hash:i}=window.location;if(i&&i.length>2){const s=i.substring(1);if(e){const o=s.split("&");for(let a=0;a<o.length;a++){const c=o[a].indexOf("=");c>0&&o[a].substring(0,c)===e&&(r=o[a].substring(c+1))}}if(r)return r;if(!r&&n>-1){const o=i.match(/\/([a-zA-Z-]*)/g);return Array.isArray(o)?o[typeof n=="number"?n:0]?.replace("/",""):void 0}}}return r}};let Jm=null;const DX=()=>{if(Jm!==null)return Jm;try{if(Jm=typeof window<"u"&&window.localStorage!==null,!Jm)return!1;const t="i18next.translate.boo";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch{Jm=!1}return Jm};var tat={name:"localStorage",lookup(t){let{lookupLocalStorage:e}=t;if(e&&DX())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupLocalStorage:n}=e;n&&DX()&&window.localStorage.setItem(n,t)}};let Qm=null;const NX=()=>{if(Qm!==null)return Qm;try{if(Qm=typeof window<"u"&&window.sessionStorage!==null,!Qm)return!1;const t="i18next.translate.boo";window.sessionStorage.setItem(t,"foo"),window.sessionStorage.removeItem(t)}catch{Qm=!1}return Qm};var nat={name:"sessionStorage",lookup(t){let{lookupSessionStorage:e}=t;if(e&&NX())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupSessionStorage:n}=e;n&&NX()&&window.sessionStorage.setItem(n,t)}},rat={name:"navigator",lookup(t){const e=[];if(typeof navigator<"u"){const{languages:n,userLanguage:r,language:i}=navigator;if(n)for(let s=0;s<n.length;s++)e.push(n[s]);r&&e.push(r),i&&e.push(i)}return e.length>0?e:void 0}},iat={name:"htmlTag",lookup(t){let{htmlTag:e}=t,n;const r=e||(typeof document<"u"?document.documentElement:null);return r&&typeof r.getAttribute=="function"&&(n=r.getAttribute("lang")),n}},sat={name:"path",lookup(t){let{lookupFromPathIndex:e}=t;if(typeof window>"u")return;const n=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(n)?n[typeof e=="number"?e:0]?.replace("/",""):void 0}},oat={name:"subdomain",lookup(t){let{lookupFromSubdomainIndex:e}=t;const n=typeof e=="number"?e+1:1,r=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(r)return r[n]}};let Npe=!1;try{document.cookie,Npe=!0}catch{}const Upe=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Npe||Upe.splice(1,1);const aat=()=>({order:Upe,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:t=>t});class jpe{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,n)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=Yot(n,this.options||{},aat()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=i=>i.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(Qot),this.addDetector(Zot),this.addDetector(tat),this.addDetector(nat),this.addDetector(rat),this.addDetector(iat),this.addDetector(sat),this.addDetector(oat),this.addDetector(eat)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,n=[];return e.forEach(r=>{if(this.detectors[r]){let i=this.detectors[r].lookup(this.options);i&&typeof i=="string"&&(i=[i]),i&&(n=n.concat(i))}}),n=n.filter(r=>r!=null&&!Xot(r)).map(r=>this.options.convertDetectedLanguage(r)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?n:n.length>0?n[0]:null}cacheUserLanguage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;n&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||n.forEach(r=>{this.detectors[r]&&this.detectors[r].cacheUserLanguage(e,this.options)}))}}jpe.type="languageDetector";var BE={},UX;function cat(){if(UX)return BE;UX=1,Object.defineProperty(BE,"__esModule",{value:!0}),BE.shouldPolyfill=t;function t(){return!Intl.Segmenter}return BE}var lat=cat(),HE={},jX;function uat(){if(jX)return HE;jX=1,Object.defineProperty(HE,"__esModule",{value:!0}),HE.shouldPolyfill=t;function t(){return typeof Intl>"u"||!("DurationFormat"in Intl)}return HE}var dat=uat();const Fpe=Object.assign({"../locales/bg/app.json":Eot,"../locales/cs/app.json":wot,"../locales/da/app.json":Cot,"../locales/de/app.json":Tot,"../locales/el/app.json":Rot,"../locales/en/app.json":Iot,"../locales/es/app.json":kot,"../locales/et/app.json":xot,"../locales/fa/app.json":Aot,"../locales/fi/app.json":Pot,"../locales/fr/app.json":Lot,"../locales/id/app.json":Oot,"../locales/it/app.json":Mot,"../locales/ja/app.json":Dot,"../locales/lv/app.json":Not,"../locales/pl/app.json":Uot,"../locales/ro/app.json":jot,"../locales/ru/app.json":Fot,"../locales/sk/app.json":$ot,"../locales/sv/app.json":Bot,"../locales/tr/app.json":Hot,"../locales/uk/app.json":Vot,"../locales/vi/app.json":qot,"../locales/zh-Hans/app.json":Got,"../locales/zh-Hant/app.json":Kot}),fat=(t,e)=>Fpe[`../locales/${t}/${e}.json`],hat=[...new Set(Object.keys(Fpe).map(t=>{const e=t.match(/\/([^/]+)\/[^/]+\.json$/)?.[1];if(!e)throw new Error(`Could not parse locale URL ${t}`);return e}))],pat={type:"backend",init(){},read(t,e,n){(async()=>{const r=fat(t,e);if(!r)throw new Error(`Namespace ${e} for locale ${t} not found`);const i=await fetch(r,{credentials:"omit",headers:{Accept:"application/json"}});if(p8(i))throw Error(`Failed to fetch ${r}`);return await i.json()})().then(r=>n(null,r),r=>n(r,null))}};class mat{constructor(){this.config=0,this.sentry=0,this.openTelemetry=0}allDepsAreLoaded(){return!Object.values(this).some(e=>e!==2)}}class Va{constructor(){this.isInitialized=!1,this.loadStates=new mat}static isInitialized(){return!!Va.internalInstance?.isInitialized}static async initBeforeReact(){const e=[];lat.shouldPolyfill()&&e.push(lb(()=>import("./polyfill-force-C-cqkbSt.js").then(s=>s.p),__vite__mapDeps([2,3]),import.meta.url)),dat.shouldPolyfill()&&e.push(lb(()=>import("./polyfill-force-C5_YvYDd.js").then(s=>s.p),__vite__mapDeps([4,3]),import.meta.url)),await Promise.all(e);const n=new jpe;n.addDetector({name:"urlFragment",lookup:()=>Br().lang??void 0}),Gi.on("languageChanged",s=>{document.documentElement.lang=s}),await Gi.use(pat).use(n).use(h8e).init({fallbackLng:"en",defaultNS:"app",keySeparator:".",nsSeparator:!1,pluralSeparator:"_",contextSeparator:"|",supportedLngs:hat,interpolation:{escapeValue:!1},detection:{order:["urlFragment","navigator"],caches:[]}});const{fonts:r,fontScale:i}=Br();i!==null&&document.documentElement.style.setProperty("--font-scale",i.toString()),r.length>0&&document.documentElement.style.setProperty("--font-family",r.map(s=>`"${s}"`).join(", ")),document.body.setAttribute("data-platform",va)}static init(){return Va?.internalInstance?.initPromise?null:(Va.internalInstance=new Va,Va.internalInstance.initPromise=new Promise(e=>{Va.internalInstance?.initStep(e)}),Va.internalInstance.initPromise)}static reset(){Va.internalInstance=void 0}initStep(e){if(this.loadStates.config===0&&(this.loadStates.config=1,sn.init().then(()=>{this.loadStates.config=2,this.initStep(e)},n=>{M.error("Failed to load config",n)})),this.loadStates.sentry===0&&this.loadStates.config===2){let n,r;n=Br().sentryDsn??void 0,r=Br().sentryEnvironment??void 0,n&&bke({dsn:n,environment:r,integrations:[jke({useEffect:Ce.useEffect,useLocation:rs,useNavigationType:kwe,createRoutesFromChildren:LC,matchRoutes:U7})],tracesSampleRate:1}),this.loadStates.sentry=2}this.loadStates.openTelemetry===0&&this.loadStates.config===2&&(fR.globalInit(),this.loadStates.openTelemetry=2),this.loadStates.allDepsAreLoaded()&&(e(),this.isInitialized=!0)}}const gat=()=>{const[t,e]=_.useState(()=>Br().theme),n=_.useRef(document.body.classList.item(0));_.useEffect(()=>{if(ut){const r=i=>{i.preventDefault(),"name"in i.detail.data&&typeof i.detail.data.name=="string"&&e(i.detail.data.name),ut.api.transport.reply(i.detail,{})};return ut.lazyActions.on(vr.ThemeChange,r),()=>{ut.lazyActions.off(vr.ThemeChange,r)}}},[]),_.useLayoutEffect(()=>{const r=t?.includes("light")?"light":"dark",i=t?.includes("high-contrast")?"-hc":"",s="cpd-theme-"+r+i;s!==n.current&&(document.body.classList.remove("cpd-theme-light","cpd-theme-dark","cpd-theme-light-hc","cpd-theme-dark-hc"),document.body.classList.add(s),n.current=s),document.body.classList.remove("no-theme")},[n,t])},VE=Fke(Hee),vat=({children:t})=>{const{pathname:e}=rs();return _.useEffect(()=>{let n="";!["/login","/register"].includes(e)&&!ut&&(n="var(--background-gradient)"),document.getElementsByTagName("body")[0].style.backgroundImage=n},[e]),E.jsx(E.Fragment,{children:t})},yat=({children:t})=>(gat(),t),bat=({vm:t})=>{const[e,n]=_.useState(!1);_.useEffect(()=>{Va.init()?.then(async()=>{e||(n(!0),await ut?.api.sendContentLoaded())}).catch(M.error)});const{header:r}=_.useMemo(Br,[]),i=e?E.jsx(bKe,{children:E.jsx(rue,{value:t.mediaDevices,children:E.jsx(oXe,{children:E.jsx(AT,{fallback:s=>E.jsx(zb,{error:s,widget:ut}),children:E.jsxs(qwe,{children:[E.jsx(VE,{path:"/",element:E.jsx(Lfe,{})}),E.jsx(VE,{path:"/login",element:E.jsx(gJe,{})}),E.jsx(VE,{path:"/register",element:E.jsx(vJe,{})}),E.jsx(VE,{path:"*",element:E.jsx(Sot,{})})]})})})})}):E.jsx(pR,{});return E.jsx(hCe,{children:E.jsx(vat,{children:E.jsx(yat,{children:E.jsx(sre,{children:E.jsx(_.Suspense,{fallback:null,children:r===Nb.AppBar?E.jsx(ist,{children:i}):i})})})})})};class _at extends nS{constructor(){super(...arguments),this.mediaDevices=new _ze(this.scope)}}window.setLKLogLevel=PZ;Lje().catch(t=>{M.error("Failed to initialize rageshake",t)});PZ("info");ySe((t,e,n)=>{global.mx_rage_logger.log(t,"livekit",e,n)});M.info("Element Call embedded-v0.16.3");const LO=Nbe.createRoot(document.getElementById("root"));let sb=null;window.isSecureContext?navigator.mediaDevices||(sb=new Error("Your browser does not support WebRTC.")):sb=new Error(`This app cannot run in an insecure context. To fix this, access the app via a local loopback address, or serve it over HTTPS.
https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts`);if(sb!==null)throw LO.render(sb.message),sb;Va.initBeforeReact().then(()=>{LO.render(E.jsx(_.StrictMode,{children:E.jsx(bat,{vm:new _at})}))}).catch(t=>{M.error("Failed to initialize app",t),LO.render(t.message)});export{xat as A,W3 as B,sn as C,z1e as D,Z as E,Pat as F,Oat as G,QO as H,Lat as I,To as J,Be as K,Tat as L,tr as M,Kt as N,vu as O,uB as P,K1e as Q,Mat as R,Ih as S,On as T,Aat as U,Dat as V,qt as W,tv as X,Y1e as Y,Ea as _,Eat as a,cc as b,Sat as c,kat as d,B as e,xW as f,cl as g,L as h,Rfe as i,Cat as j,gi as k,M as l,de as m,Bh as n,xe as o,X3 as p,GO as q,IQ as r,_p as s,$at as t,ibe as u,$v as v,ll as w,Xr as x,eye as y,Cy as z};
//# sourceMappingURL=index-BAfhaCa-.js.map
